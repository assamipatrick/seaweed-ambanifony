(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();function Uf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Rh={exports:{}},Po={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qy;function Iw(){if(qy)return Po;qy=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(a,i,l){var c=null;if(l!==void 0&&(c=""+l),i.key!==void 0&&(c=""+i.key),"key"in i){l={};for(var u in i)u!=="key"&&(l[u]=i[u])}else l=i;return i=l.ref,{$$typeof:e,type:a,key:c,ref:i!==void 0?i:null,props:l}}return Po.Fragment=t,Po.jsx=s,Po.jsxs=s,Po}var Vy;function Aw(){return Vy||(Vy=1,Rh.exports=Iw()),Rh.exports}var n=Aw(),Mh={exports:{}},ct={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ky;function kw(){if(Ky)return ct;Ky=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),y=Symbol.iterator;function b($){return $===null||typeof $!="object"?null:($=y&&$[y]||$["@@iterator"],typeof $=="function"?$:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,j={};function E($,ie,ue){this.props=$,this.context=ie,this.refs=j,this.updater=ue||T}E.prototype.isReactComponent={},E.prototype.setState=function($,ie){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,ie,"setState")},E.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function k(){}k.prototype=E.prototype;function C($,ie,ue){this.props=$,this.context=ie,this.refs=j,this.updater=ue||T}var A=C.prototype=new k;A.constructor=C,_(A,E.prototype),A.isPureReactComponent=!0;var M=Array.isArray;function I(){}var P={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function U($,ie,ue){var Ne=ue.ref;return{$$typeof:e,type:$,key:ie,ref:Ne!==void 0?Ne:null,props:ue}}function O($,ie){return U($.type,ie,$.props)}function F($){return typeof $=="object"&&$!==null&&$.$$typeof===e}function q($){var ie={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(ue){return ie[ue]})}var z=/\/+/g;function Y($,ie){return typeof $=="object"&&$!==null&&$.key!=null?q(""+$.key):ie.toString(36)}function J($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(I,I):($.status="pending",$.then(function(ie){$.status==="pending"&&($.status="fulfilled",$.value=ie)},function(ie){$.status==="pending"&&($.status="rejected",$.reason=ie)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function G($,ie,ue,Ne,le){var ne=typeof $;(ne==="undefined"||ne==="boolean")&&($=null);var je=!1;if($===null)je=!0;else switch(ne){case"bigint":case"string":case"number":je=!0;break;case"object":switch($.$$typeof){case e:case t:je=!0;break;case m:return je=$._init,G(je($._payload),ie,ue,Ne,le)}}if(je)return le=le($),je=Ne===""?"."+Y($,0):Ne,M(le)?(ue="",je!=null&&(ue=je.replace(z,"$&/")+"/"),G(le,ie,ue,"",function(ee){return ee})):le!=null&&(F(le)&&(le=O(le,ue+(le.key==null||$&&$.key===le.key?"":(""+le.key).replace(z,"$&/")+"/")+je)),ie.push(le)),1;je=0;var fe=Ne===""?".":Ne+":";if(M($))for(var Z=0;Z<$.length;Z++)Ne=$[Z],ne=fe+Y(Ne,Z),je+=G(Ne,ie,ue,ne,le);else if(Z=b($),typeof Z=="function")for($=Z.call($),Z=0;!(Ne=$.next()).done;)Ne=Ne.value,ne=fe+Y(Ne,Z++),je+=G(Ne,ie,ue,ne,le);else if(ne==="object"){if(typeof $.then=="function")return G(J($),ie,ue,Ne,le);throw ie=String($),Error("Objects are not valid as a React child (found: "+(ie==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":ie)+"). If you meant to render a collection of children, use an array instead.")}return je}function B($,ie,ue){if($==null)return $;var Ne=[],le=0;return G($,Ne,"","",function(ne){return ie.call(ue,ne,le++)}),Ne}function Q($){if($._status===-1){var ie=$._result;ie=ie(),ie.then(function(ue){($._status===0||$._status===-1)&&($._status=1,$._result=ue)},function(ue){($._status===0||$._status===-1)&&($._status=2,$._result=ue)}),$._status===-1&&($._status=0,$._result=ie)}if($._status===1)return $._result.default;throw $._result}var W=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ie=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(ie))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",$);return}console.error($)},ae={map:B,forEach:function($,ie,ue){B($,function(){ie.apply(this,arguments)},ue)},count:function($){var ie=0;return B($,function(){ie++}),ie},toArray:function($){return B($,function(ie){return ie})||[]},only:function($){if(!F($))throw Error("React.Children.only expected to receive a single React element child.");return $}};return ct.Activity=x,ct.Children=ae,ct.Component=E,ct.Fragment=s,ct.Profiler=i,ct.PureComponent=C,ct.StrictMode=a,ct.Suspense=f,ct.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,ct.__COMPILER_RUNTIME={__proto__:null,c:function($){return P.H.useMemoCache($)}},ct.cache=function($){return function(){return $.apply(null,arguments)}},ct.cacheSignal=function(){return null},ct.cloneElement=function($,ie,ue){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var Ne=_({},$.props),le=$.key;if(ie!=null)for(ne in ie.key!==void 0&&(le=""+ie.key),ie)!D.call(ie,ne)||ne==="key"||ne==="__self"||ne==="__source"||ne==="ref"&&ie.ref===void 0||(Ne[ne]=ie[ne]);var ne=arguments.length-2;if(ne===1)Ne.children=ue;else if(1<ne){for(var je=Array(ne),fe=0;fe<ne;fe++)je[fe]=arguments[fe+2];Ne.children=je}return U($.type,le,Ne)},ct.createContext=function($){return $={$$typeof:c,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:l,_context:$},$},ct.createElement=function($,ie,ue){var Ne,le={},ne=null;if(ie!=null)for(Ne in ie.key!==void 0&&(ne=""+ie.key),ie)D.call(ie,Ne)&&Ne!=="key"&&Ne!=="__self"&&Ne!=="__source"&&(le[Ne]=ie[Ne]);var je=arguments.length-2;if(je===1)le.children=ue;else if(1<je){for(var fe=Array(je),Z=0;Z<je;Z++)fe[Z]=arguments[Z+2];le.children=fe}if($&&$.defaultProps)for(Ne in je=$.defaultProps,je)le[Ne]===void 0&&(le[Ne]=je[Ne]);return U($,ne,le)},ct.createRef=function(){return{current:null}},ct.forwardRef=function($){return{$$typeof:u,render:$}},ct.isValidElement=F,ct.lazy=function($){return{$$typeof:m,_payload:{_status:-1,_result:$},_init:Q}},ct.memo=function($,ie){return{$$typeof:h,type:$,compare:ie===void 0?null:ie}},ct.startTransition=function($){var ie=P.T,ue={};P.T=ue;try{var Ne=$(),le=P.S;le!==null&&le(ue,Ne),typeof Ne=="object"&&Ne!==null&&typeof Ne.then=="function"&&Ne.then(I,W)}catch(ne){W(ne)}finally{ie!==null&&ue.types!==null&&(ie.types=ue.types),P.T=ie}},ct.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},ct.use=function($){return P.H.use($)},ct.useActionState=function($,ie,ue){return P.H.useActionState($,ie,ue)},ct.useCallback=function($,ie){return P.H.useCallback($,ie)},ct.useContext=function($){return P.H.useContext($)},ct.useDebugValue=function(){},ct.useDeferredValue=function($,ie){return P.H.useDeferredValue($,ie)},ct.useEffect=function($,ie){return P.H.useEffect($,ie)},ct.useEffectEvent=function($){return P.H.useEffectEvent($)},ct.useId=function(){return P.H.useId()},ct.useImperativeHandle=function($,ie,ue){return P.H.useImperativeHandle($,ie,ue)},ct.useInsertionEffect=function($,ie){return P.H.useInsertionEffect($,ie)},ct.useLayoutEffect=function($,ie){return P.H.useLayoutEffect($,ie)},ct.useMemo=function($,ie){return P.H.useMemo($,ie)},ct.useOptimistic=function($,ie){return P.H.useOptimistic($,ie)},ct.useReducer=function($,ie,ue){return P.H.useReducer($,ie,ue)},ct.useRef=function($){return P.H.useRef($)},ct.useState=function($){return P.H.useState($)},ct.useSyncExternalStore=function($,ie,ue){return P.H.useSyncExternalStore($,ie,ue)},ct.useTransition=function(){return P.H.useTransition()},ct.version="19.2.4",ct}var Wy;function Ff(){return Wy||(Wy=1,Mh.exports=kw()),Mh.exports}var S=Ff();const gt=Uf(S);var Ph={exports:{}},Oo={},Oh={exports:{}},Lh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jy;function Dw(){return Jy||(Jy=1,(function(e){function t(G,B){var Q=G.length;G.push(B);e:for(;0<Q;){var W=Q-1>>>1,ae=G[W];if(0<i(ae,B))G[W]=B,G[Q]=ae,Q=W;else break e}}function s(G){return G.length===0?null:G[0]}function a(G){if(G.length===0)return null;var B=G[0],Q=G.pop();if(Q!==B){G[0]=Q;e:for(var W=0,ae=G.length,$=ae>>>1;W<$;){var ie=2*(W+1)-1,ue=G[ie],Ne=ie+1,le=G[Ne];if(0>i(ue,Q))Ne<ae&&0>i(le,ue)?(G[W]=le,G[Ne]=Q,W=Ne):(G[W]=ue,G[ie]=Q,W=ie);else if(Ne<ae&&0>i(le,Q))G[W]=le,G[Ne]=Q,W=Ne;else break e}}return B}function i(G,B){var Q=G.sortIndex-B.sortIndex;return Q!==0?Q:G.id-B.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();e.unstable_now=function(){return c.now()-u}}var f=[],h=[],m=1,x=null,y=3,b=!1,T=!1,_=!1,j=!1,E=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function A(G){for(var B=s(h);B!==null;){if(B.callback===null)a(h);else if(B.startTime<=G)a(h),B.sortIndex=B.expirationTime,t(f,B);else break;B=s(h)}}function M(G){if(_=!1,A(G),!T)if(s(f)!==null)T=!0,I||(I=!0,q());else{var B=s(h);B!==null&&J(M,B.startTime-G)}}var I=!1,P=-1,D=5,U=-1;function O(){return j?!0:!(e.unstable_now()-U<D)}function F(){if(j=!1,I){var G=e.unstable_now();U=G;var B=!0;try{e:{T=!1,_&&(_=!1,k(P),P=-1),b=!0;var Q=y;try{t:{for(A(G),x=s(f);x!==null&&!(x.expirationTime>G&&O());){var W=x.callback;if(typeof W=="function"){x.callback=null,y=x.priorityLevel;var ae=W(x.expirationTime<=G);if(G=e.unstable_now(),typeof ae=="function"){x.callback=ae,A(G),B=!0;break t}x===s(f)&&a(f),A(G)}else a(f);x=s(f)}if(x!==null)B=!0;else{var $=s(h);$!==null&&J(M,$.startTime-G),B=!1}}break e}finally{x=null,y=Q,b=!1}B=void 0}}finally{B?q():I=!1}}}var q;if(typeof C=="function")q=function(){C(F)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,Y=z.port2;z.port1.onmessage=F,q=function(){Y.postMessage(null)}}else q=function(){E(F,0)};function J(G,B){P=E(function(){G(e.unstable_now())},B)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_next=function(G){switch(y){case 1:case 2:case 3:var B=3;break;default:B=y}var Q=y;y=B;try{return G()}finally{y=Q}},e.unstable_requestPaint=function(){j=!0},e.unstable_runWithPriority=function(G,B){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Q=y;y=G;try{return B()}finally{y=Q}},e.unstable_scheduleCallback=function(G,B,Q){var W=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?W+Q:W):Q=W,G){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Q+ae,G={id:m++,callback:B,priorityLevel:G,startTime:Q,expirationTime:ae,sortIndex:-1},Q>W?(G.sortIndex=Q,t(h,G),s(f)===null&&G===s(h)&&(_?(k(P),P=-1):_=!0,J(M,Q-W))):(G.sortIndex=ae,t(f,G),T||b||(T=!0,I||(I=!0,q()))),G},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(G){var B=y;return function(){var Q=y;y=B;try{return G.apply(this,arguments)}finally{y=Q}}}})(Lh)),Lh}var Yy;function Rw(){return Yy||(Yy=1,Oh.exports=Dw()),Oh.exports}var Uh={exports:{}},Mn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function Mw(){if(Xy)return Mn;Xy=1;var e=Ff();function t(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(f,h,m){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:x==null?null:""+x,children:f,containerInfo:h,implementation:m}}var c=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Mn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Mn.createPortal=function(f,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return l(f,h,null,m)},Mn.flushSync=function(f){var h=c.T,m=a.p;try{if(c.T=null,a.p=2,f)return f()}finally{c.T=h,a.p=m,a.d.f()}},Mn.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,a.d.C(f,h))},Mn.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},Mn.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var m=h.as,x=u(m,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,b=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;m==="style"?a.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:x,integrity:y,fetchPriority:b}):m==="script"&&a.d.X(f,{crossOrigin:x,integrity:y,fetchPriority:b,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Mn.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var m=u(h.as,h.crossOrigin);a.d.M(f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&a.d.M(f)},Mn.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var m=h.as,x=u(m,h.crossOrigin);a.d.L(f,m,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Mn.preloadModule=function(f,h){if(typeof f=="string")if(h){var m=u(h.as,h.crossOrigin);a.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else a.d.m(f)},Mn.requestFormReset=function(f){a.d.r(f)},Mn.unstable_batchedUpdates=function(f,h){return f(h)},Mn.useFormState=function(f,h,m){return c.H.useFormState(f,h,m)},Mn.useFormStatus=function(){return c.H.useHostTransitionStatus()},Mn.version="19.2.4",Mn}var Qy;function Rv(){if(Qy)return Uh.exports;Qy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Uh.exports=Mw(),Uh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zy;function Pw(){if(Zy)return Oo;Zy=1;var e=Rw(),t=Ff(),s=Rv();function a(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var o=r,d=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(d=o.return),r=o.return;while(r)}return o.tag===3?d:null}function c(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function u(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function f(r){if(l(r)!==r)throw Error(a(188))}function h(r){var o=r.alternate;if(!o){if(o=l(r),o===null)throw Error(a(188));return o!==r?null:r}for(var d=r,p=o;;){var N=d.return;if(N===null)break;var w=N.alternate;if(w===null){if(p=N.return,p!==null){d=p;continue}break}if(N.child===w.child){for(w=N.child;w;){if(w===d)return f(N),r;if(w===p)return f(N),o;w=w.sibling}throw Error(a(188))}if(d.return!==p.return)d=N,p=w;else{for(var R=!1,K=N.child;K;){if(K===d){R=!0,d=N,p=w;break}if(K===p){R=!0,p=N,d=w;break}K=K.sibling}if(!R){for(K=w.child;K;){if(K===d){R=!0,d=w,p=N;break}if(K===p){R=!0,p=w,d=N;break}K=K.sibling}if(!R)throw Error(a(189))}}if(d.alternate!==p)throw Error(a(190))}if(d.tag!==3)throw Error(a(188));return d.stateNode.current===d?r:o}function m(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=m(r),o!==null)return o;r=r.sibling}return null}var x=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function q(r){return r===null||typeof r!="object"?null:(r=F&&r[F]||r["@@iterator"],typeof r=="function"?r:null)}var z=Symbol.for("react.client.reference");function Y(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===z?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case _:return"Fragment";case E:return"Profiler";case j:return"StrictMode";case M:return"Suspense";case I:return"SuspenseList";case U:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case T:return"Portal";case C:return r.displayName||"Context";case k:return(r._context.displayName||"Context")+".Consumer";case A:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case P:return o=r.displayName||null,o!==null?o:Y(r.type)||"Memo";case D:o=r._payload,r=r._init;try{return Y(r(o))}catch{}}return null}var J=Array.isArray,G=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},W=[],ae=-1;function $(r){return{current:r}}function ie(r){0>ae||(r.current=W[ae],W[ae]=null,ae--)}function ue(r,o){ae++,W[ae]=r.current,r.current=o}var Ne=$(null),le=$(null),ne=$(null),je=$(null);function fe(r,o){switch(ue(ne,o),ue(le,r),ue(Ne,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?my(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=my(o),r=py(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ie(Ne),ue(Ne,r)}function Z(){ie(Ne),ie(le),ie(ne)}function ee(r){r.memoizedState!==null&&ue(je,r);var o=Ne.current,d=py(o,r.type);o!==d&&(ue(le,r),ue(Ne,d))}function xe(r){le.current===r&&(ie(Ne),ie(le)),je.current===r&&(ie(je),ko._currentValue=Q)}var Oe,De;function Re(r){if(Oe===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Oe=o&&o[1]||"",De=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Oe+r+De}var Ve=!1;function ze(r,o){if(!r||Ve)return"";Ve=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(Te){var ve=Te}Reflect.construct(r,[],Ie)}else{try{Ie.call()}catch(Te){ve=Te}r.call(Ie.prototype)}}else{try{throw Error()}catch(Te){ve=Te}(Ie=r())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(Te){if(Te&&ve&&typeof Te.stack=="string")return[Te.stack,ve.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=p.DetermineComponentFrameRoot(),R=w[0],K=w[1];if(R&&K){var re=R.split(`
`),ge=K.split(`
`);for(N=p=0;p<re.length&&!re[p].includes("DetermineComponentFrameRoot");)p++;for(;N<ge.length&&!ge[N].includes("DetermineComponentFrameRoot");)N++;if(p===re.length||N===ge.length)for(p=re.length-1,N=ge.length-1;1<=p&&0<=N&&re[p]!==ge[N];)N--;for(;1<=p&&0<=N;p--,N--)if(re[p]!==ge[N]){if(p!==1||N!==1)do if(p--,N--,0>N||re[p]!==ge[N]){var Ee=`
`+re[p].replace(" at new "," at ");return r.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",r.displayName)),Ee}while(1<=p&&0<=N);break}}}finally{Ve=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?Re(d):""}function Se(r,o){switch(r.tag){case 26:case 27:case 5:return Re(r.type);case 16:return Re("Lazy");case 13:return r.child!==o&&o!==null?Re("Suspense Fallback"):Re("Suspense");case 19:return Re("SuspenseList");case 0:case 15:return ze(r.type,!1);case 11:return ze(r.type.render,!1);case 1:return ze(r.type,!0);case 31:return Re("Activity");default:return""}}function Le(r){try{var o="",d=null;do o+=Se(r,d),d=r,r=r.return;while(r);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var be=Object.prototype.hasOwnProperty,ye=e.unstable_scheduleCallback,Ue=e.unstable_cancelCallback,et=e.unstable_shouldYield,At=e.unstable_requestPaint,ut=e.unstable_now,Ut=e.unstable_getCurrentPriorityLevel,Ct=e.unstable_ImmediatePriority,vt=e.unstable_UserBlockingPriority,Yt=e.unstable_NormalPriority,Ps=e.unstable_LowPriority,Vs=e.unstable_IdlePriority,kr=e.log,Be=e.unstable_setDisableYieldValue,Je=null,$e=null;function wt(r){if(typeof kr=="function"&&Be(r),$e&&typeof $e.setStrictMode=="function")try{$e.setStrictMode(Je,r)}catch{}}var it=Math.clz32?Math.clz32:jn,kt=Math.log,Tn=Math.LN2;function jn(r){return r>>>=0,r===0?32:31-(kt(r)/Tn|0)|0}var pn=256,Os=262144,Xt=4194304;function cs(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Na(r,o,d){var p=r.pendingLanes;if(p===0)return 0;var N=0,w=r.suspendedLanes,R=r.pingedLanes;r=r.warmLanes;var K=p&134217727;return K!==0?(p=K&~w,p!==0?N=cs(p):(R&=K,R!==0?N=cs(R):d||(d=K&~r,d!==0&&(N=cs(d))))):(K=p&~w,K!==0?N=cs(K):R!==0?N=cs(R):d||(d=p&~r,d!==0&&(N=cs(d)))),N===0?0:o!==0&&o!==N&&(o&w)===0&&(w=N&-N,d=o&-o,w>=d||w===32&&(d&4194048)!==0)?o:N}function Ls(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function wd(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dl(){var r=Xt;return Xt<<=1,(Xt&62914560)===0&&(Xt=4194304),r}function Fi(r){for(var o=[],d=0;31>d;d++)o.push(r);return o}function tr(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Td(r,o,d,p,N,w){var R=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var K=r.entanglements,re=r.expirationTimes,ge=r.hiddenUpdates;for(d=R&~d;0<d;){var Ee=31-it(d),Ie=1<<Ee;K[Ee]=0,re[Ee]=-1;var ve=ge[Ee];if(ve!==null)for(ge[Ee]=null,Ee=0;Ee<ve.length;Ee++){var Te=ve[Ee];Te!==null&&(Te.lane&=-536870913)}d&=~Ie}p!==0&&ul(r,p,0),w!==0&&N===0&&r.tag!==0&&(r.suspendedLanes|=w&~(R&~o))}function ul(r,o,d){r.pendingLanes|=o,r.suspendedLanes&=~o;var p=31-it(o);r.entangledLanes|=o,r.entanglements[p]=r.entanglements[p]|1073741824|d&261930}function hl(r,o){var d=r.entangledLanes|=o;for(r=r.entanglements;d;){var p=31-it(d),N=1<<p;N&o|r[p]&o&&(r[p]|=o),d&=~N}}function fl(r,o){var d=o&-o;return d=(d&42)!==0?1:Bi(d),(d&(r.suspendedLanes|o))!==0?0:d}function Bi(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Gi(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function ml(){var r=B.p;return r!==0?r:(r=window.event,r===void 0?32:Uy(r.type))}function pl(r,o){var d=B.p;try{return B.p=r,o()}finally{B.p=d}}var Us=Math.random().toString(36).slice(2),on="__reactFiber$"+Us,_n="__reactProps$"+Us,Ks="__reactContainer$"+Us,zi="__reactEvents$"+Us,jd="__reactListeners$"+Us,Ws="__reactHandles$"+Us,$i="__reactResources$"+Us,Dr="__reactMarker$"+Us;function gl(r){delete r[on],delete r[_n],delete r[zi],delete r[jd],delete r[Ws]}function nr(r){var o=r[on];if(o)return o;for(var d=r.parentNode;d;){if(o=d[Ks]||d[on]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(r=Sy(r);r!==null;){if(d=r[on])return d;r=Sy(r)}return o}r=d,d=r.parentNode}return null}function sr(r){if(r=r[on]||r[Ks]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function Rr(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(a(33))}function ar(r){var o=r[$i];return o||(o=r[$i]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function gn(r){r[Dr]=!0}var _d=new Set,Ed={};function Sa(r,o){rr(r,o),rr(r+"Capture",o)}function rr(r,o){for(Ed[r]=o,r=0;r<o.length;r++)_d.add(o[r])}var um=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Cd={},Id={};function hm(r){return be.call(Id,r)?!0:be.call(Cd,r)?!1:um.test(r)?Id[r]=!0:(Cd[r]=!0,!1)}function Hi(r,o,d){if(hm(o))if(d===null)r.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+d)}}function qi(r,o,d){if(d===null)r.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+d)}}function Fs(r,o,d,p){if(p===null)r.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(o,d,""+p)}}function Kn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Ad(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function fm(r,o,d){var p=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var N=p.get,w=p.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return N.call(this)},set:function(R){d=""+R,w.call(this,R)}}),Object.defineProperty(r,o,{enumerable:p.enumerable}),{getValue:function(){return d},setValue:function(R){d=""+R},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function yl(r){if(!r._valueTracker){var o=Ad(r)?"checked":"value";r._valueTracker=fm(r,o,""+r[o])}}function kd(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var d=o.getValue(),p="";return r&&(p=Ad(r)?r.checked?"true":"false":r.value),r=p,r!==d?(o.setValue(r),!0):!1}function Vi(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var mm=/[\n"\\]/g;function Wn(r){return r.replace(mm,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function xl(r,o,d,p,N,w,R,K){r.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?r.type=R:r.removeAttribute("type"),o!=null?R==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Kn(o)):r.value!==""+Kn(o)&&(r.value=""+Kn(o)):R!=="submit"&&R!=="reset"||r.removeAttribute("value"),o!=null?vl(r,R,Kn(o)):d!=null?vl(r,R,Kn(d)):p!=null&&r.removeAttribute("value"),N==null&&w!=null&&(r.defaultChecked=!!w),N!=null&&(r.checked=N&&typeof N!="function"&&typeof N!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?r.name=""+Kn(K):r.removeAttribute("name")}function Dd(r,o,d,p,N,w,R,K){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(r.type=w),o!=null||d!=null){if(!(w!=="submit"&&w!=="reset"||o!=null)){yl(r);return}d=d!=null?""+Kn(d):"",o=o!=null?""+Kn(o):d,K||o===r.value||(r.value=o),r.defaultValue=o}p=p??N,p=typeof p!="function"&&typeof p!="symbol"&&!!p,r.checked=K?r.checked:!!p,r.defaultChecked=!!p,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(r.name=R),yl(r)}function vl(r,o,d){o==="number"&&Vi(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function wa(r,o,d,p){if(r=r.options,o){o={};for(var N=0;N<d.length;N++)o["$"+d[N]]=!0;for(d=0;d<r.length;d++)N=o.hasOwnProperty("$"+r[d].value),r[d].selected!==N&&(r[d].selected=N),N&&p&&(r[d].defaultSelected=!0)}else{for(d=""+Kn(d),o=null,N=0;N<r.length;N++){if(r[N].value===d){r[N].selected=!0,p&&(r[N].defaultSelected=!0);return}o!==null||r[N].disabled||(o=r[N])}o!==null&&(o.selected=!0)}}function H(r,o,d){if(o!=null&&(o=""+Kn(o),o!==r.value&&(r.value=o),d==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=d!=null?""+Kn(d):""}function X(r,o,d,p){if(o==null){if(p!=null){if(d!=null)throw Error(a(92));if(J(p)){if(1<p.length)throw Error(a(93));p=p[0]}d=p}d==null&&(d=""),o=d}d=Kn(o),r.defaultValue=d,p=r.textContent,p===d&&p!==""&&p!==null&&(r.value=p),yl(r)}function V(r,o){if(o){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=o;return}}r.textContent=o}var me=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Me(r,o,d){var p=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?p?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":p?r.setProperty(o,d):typeof d!="number"||d===0||me.has(o)?o==="float"?r.cssFloat=d:r[o]=(""+d).trim():r[o]=d+"px"}function Pe(r,o,d){if(o!=null&&typeof o!="object")throw Error(a(62));if(r=r.style,d!=null){for(var p in d)!d.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?r.setProperty(p,""):p==="float"?r.cssFloat="":r[p]="");for(var N in o)p=o[N],o.hasOwnProperty(N)&&d[N]!==p&&Me(r,N,p)}else for(var w in o)o.hasOwnProperty(w)&&Me(r,w,o[w])}function Qe(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),dt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qt(r){return dt.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Kt(){}var Zt=null;function Pn(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var bn=null,en=null;function Ta(r){var o=sr(r);if(o&&(r=o.stateNode)){var d=r[_n]||null;e:switch(r=o.stateNode,o.type){case"input":if(xl(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Wn(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var p=d[o];if(p!==r&&p.form===r.form){var N=p[_n]||null;if(!N)throw Error(a(90));xl(p,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(o=0;o<d.length;o++)p=d[o],p.form===r.form&&kd(p)}break e;case"textarea":H(r,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&wa(r,!!d.multiple,o,!1)}}}var Js=!1;function bl(r,o,d){if(Js)return r(o,d);Js=!0;try{var p=r(o);return p}finally{if(Js=!1,(bn!==null||en!==null)&&(oc(),bn&&(o=bn,r=en,en=bn=null,Ta(o),r)))for(o=0;o<r.length;o++)Ta(r[o])}}function Ki(r,o){var d=r.stateNode;if(d===null)return null;var p=d[_n]||null;if(p===null)return null;d=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(a(231,o,typeof d));return d}var Ys=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rd=!1;if(Ys)try{var Wi={};Object.defineProperty(Wi,"passive",{get:function(){Rd=!0}}),window.addEventListener("test",Wi,Wi),window.removeEventListener("test",Wi,Wi)}catch{Rd=!1}var ja=null,Md=null,Nl=null;function pm(){if(Nl)return Nl;var r,o=Md,d=o.length,p,N="value"in ja?ja.value:ja.textContent,w=N.length;for(r=0;r<d&&o[r]===N[r];r++);var R=d-r;for(p=1;p<=R&&o[d-p]===N[w-p];p++);return Nl=N.slice(r,1<p?1-p:void 0)}function Sl(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function wl(){return!0}function gm(){return!1}function Gn(r){function o(d,p,N,w,R){this._reactName=d,this._targetInst=N,this.type=p,this.nativeEvent=w,this.target=R,this.currentTarget=null;for(var K in r)r.hasOwnProperty(K)&&(d=r[K],this[K]=d?d(w):w[K]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?wl:gm,this.isPropagationStopped=gm,this}return x(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=wl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=wl)},persist:function(){},isPersistent:wl}),o}var ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tl=Gn(ir),Ji=x({},ir,{view:0,detail:0}),EN=Gn(Ji),Pd,Od,Yi,jl=x({},Ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ud,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Yi&&(Yi&&r.type==="mousemove"?(Pd=r.screenX-Yi.screenX,Od=r.screenY-Yi.screenY):Od=Pd=0,Yi=r),Pd)},movementY:function(r){return"movementY"in r?r.movementY:Od}}),ym=Gn(jl),CN=x({},jl,{dataTransfer:0}),IN=Gn(CN),AN=x({},Ji,{relatedTarget:0}),Ld=Gn(AN),kN=x({},ir,{animationName:0,elapsedTime:0,pseudoElement:0}),DN=Gn(kN),RN=x({},ir,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),MN=Gn(RN),PN=x({},ir,{data:0}),xm=Gn(PN),ON={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FN(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=UN[r])?!!o[r]:!1}function Ud(){return FN}var BN=x({},Ji,{key:function(r){if(r.key){var o=ON[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Sl(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?LN[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ud,charCode:function(r){return r.type==="keypress"?Sl(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Sl(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),GN=Gn(BN),zN=x({},jl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vm=Gn(zN),$N=x({},Ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ud}),HN=Gn($N),qN=x({},ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),VN=Gn(qN),KN=x({},jl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),WN=Gn(KN),JN=x({},ir,{newState:0,oldState:0}),YN=Gn(JN),XN=[9,13,27,32],Fd=Ys&&"CompositionEvent"in window,Xi=null;Ys&&"documentMode"in document&&(Xi=document.documentMode);var QN=Ys&&"TextEvent"in window&&!Xi,bm=Ys&&(!Fd||Xi&&8<Xi&&11>=Xi),Nm=" ",Sm=!1;function wm(r,o){switch(r){case"keyup":return XN.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tm(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Mr=!1;function ZN(r,o){switch(r){case"compositionend":return Tm(o);case"keypress":return o.which!==32?null:(Sm=!0,Nm);case"textInput":return r=o.data,r===Nm&&Sm?null:r;default:return null}}function eS(r,o){if(Mr)return r==="compositionend"||!Fd&&wm(r,o)?(r=pm(),Nl=Md=ja=null,Mr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return bm&&o.locale!=="ko"?null:o.data;default:return null}}var tS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jm(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!tS[r.type]:o==="textarea"}function _m(r,o,d,p){bn?en?en.push(p):en=[p]:bn=p,o=mc(o,"onChange"),0<o.length&&(d=new Tl("onChange","change",null,d,p),r.push({event:d,listeners:o}))}var Qi=null,Zi=null;function nS(r){ly(r,0)}function _l(r){var o=Rr(r);if(kd(o))return r}function Em(r,o){if(r==="change")return o}var Cm=!1;if(Ys){var Bd;if(Ys){var Gd="oninput"in document;if(!Gd){var Im=document.createElement("div");Im.setAttribute("oninput","return;"),Gd=typeof Im.oninput=="function"}Bd=Gd}else Bd=!1;Cm=Bd&&(!document.documentMode||9<document.documentMode)}function Am(){Qi&&(Qi.detachEvent("onpropertychange",km),Zi=Qi=null)}function km(r){if(r.propertyName==="value"&&_l(Zi)){var o=[];_m(o,Zi,r,Pn(r)),bl(nS,o)}}function sS(r,o,d){r==="focusin"?(Am(),Qi=o,Zi=d,Qi.attachEvent("onpropertychange",km)):r==="focusout"&&Am()}function aS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return _l(Zi)}function rS(r,o){if(r==="click")return _l(o)}function iS(r,o){if(r==="input"||r==="change")return _l(o)}function oS(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Jn=typeof Object.is=="function"?Object.is:oS;function eo(r,o){if(Jn(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var d=Object.keys(r),p=Object.keys(o);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var N=d[p];if(!be.call(o,N)||!Jn(r[N],o[N]))return!1}return!0}function Dm(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Rm(r,o){var d=Dm(r);r=0;for(var p;d;){if(d.nodeType===3){if(p=r+d.textContent.length,r<=o&&p>=o)return{node:d,offset:o-r};r=p}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Dm(d)}}function Mm(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?Mm(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function Pm(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=Vi(r.document);o instanceof r.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)r=o.contentWindow;else break;o=Vi(r.document)}return o}function zd(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var lS=Ys&&"documentMode"in document&&11>=document.documentMode,Pr=null,$d=null,to=null,Hd=!1;function Om(r,o,d){var p=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Hd||Pr==null||Pr!==Vi(p)||(p=Pr,"selectionStart"in p&&zd(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),to&&eo(to,p)||(to=p,p=mc($d,"onSelect"),0<p.length&&(o=new Tl("onSelect","select",null,o,d),r.push({event:o,listeners:p}),o.target=Pr)))}function or(r,o){var d={};return d[r.toLowerCase()]=o.toLowerCase(),d["Webkit"+r]="webkit"+o,d["Moz"+r]="moz"+o,d}var Or={animationend:or("Animation","AnimationEnd"),animationiteration:or("Animation","AnimationIteration"),animationstart:or("Animation","AnimationStart"),transitionrun:or("Transition","TransitionRun"),transitionstart:or("Transition","TransitionStart"),transitioncancel:or("Transition","TransitionCancel"),transitionend:or("Transition","TransitionEnd")},qd={},Lm={};Ys&&(Lm=document.createElement("div").style,"AnimationEvent"in window||(delete Or.animationend.animation,delete Or.animationiteration.animation,delete Or.animationstart.animation),"TransitionEvent"in window||delete Or.transitionend.transition);function lr(r){if(qd[r])return qd[r];if(!Or[r])return r;var o=Or[r],d;for(d in o)if(o.hasOwnProperty(d)&&d in Lm)return qd[r]=o[d];return r}var Um=lr("animationend"),Fm=lr("animationiteration"),Bm=lr("animationstart"),cS=lr("transitionrun"),dS=lr("transitionstart"),uS=lr("transitioncancel"),Gm=lr("transitionend"),zm=new Map,Vd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vd.push("scrollEnd");function ws(r,o){zm.set(r,o),Sa(o,[r])}var El=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},ds=[],Lr=0,Kd=0;function Cl(){for(var r=Lr,o=Kd=Lr=0;o<r;){var d=ds[o];ds[o++]=null;var p=ds[o];ds[o++]=null;var N=ds[o];ds[o++]=null;var w=ds[o];if(ds[o++]=null,p!==null&&N!==null){var R=p.pending;R===null?N.next=N:(N.next=R.next,R.next=N),p.pending=N}w!==0&&$m(d,N,w)}}function Il(r,o,d,p){ds[Lr++]=r,ds[Lr++]=o,ds[Lr++]=d,ds[Lr++]=p,Kd|=p,r.lanes|=p,r=r.alternate,r!==null&&(r.lanes|=p)}function Wd(r,o,d,p){return Il(r,o,d,p),Al(r)}function cr(r,o){return Il(r,null,null,o),Al(r)}function $m(r,o,d){r.lanes|=d;var p=r.alternate;p!==null&&(p.lanes|=d);for(var N=!1,w=r.return;w!==null;)w.childLanes|=d,p=w.alternate,p!==null&&(p.childLanes|=d),w.tag===22&&(r=w.stateNode,r===null||r._visibility&1||(N=!0)),r=w,w=w.return;return r.tag===3?(w=r.stateNode,N&&o!==null&&(N=31-it(d),r=w.hiddenUpdates,p=r[N],p===null?r[N]=[o]:p.push(o),o.lane=d|536870912),w):null}function Al(r){if(50<To)throw To=0,sh=null,Error(a(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Ur={};function hS(r,o,d,p){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yn(r,o,d,p){return new hS(r,o,d,p)}function Jd(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Xs(r,o){var d=r.alternate;return d===null?(d=Yn(r.tag,o,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=o,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,o=r.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Hm(r,o){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,o=d.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function kl(r,o,d,p,N,w){var R=0;if(p=r,typeof r=="function")Jd(r)&&(R=1);else if(typeof r=="string")R=yw(r,d,Ne.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case U:return r=Yn(31,d,o,N),r.elementType=U,r.lanes=w,r;case _:return dr(d.children,N,w,o);case j:R=8,N|=24;break;case E:return r=Yn(12,d,o,N|2),r.elementType=E,r.lanes=w,r;case M:return r=Yn(13,d,o,N),r.elementType=M,r.lanes=w,r;case I:return r=Yn(19,d,o,N),r.elementType=I,r.lanes=w,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case C:R=10;break e;case k:R=9;break e;case A:R=11;break e;case P:R=14;break e;case D:R=16,p=null;break e}R=29,d=Error(a(130,r===null?"null":typeof r,"")),p=null}return o=Yn(R,d,o,N),o.elementType=r,o.type=p,o.lanes=w,o}function dr(r,o,d,p){return r=Yn(7,r,p,o),r.lanes=d,r}function Yd(r,o,d){return r=Yn(6,r,null,o),r.lanes=d,r}function qm(r){var o=Yn(18,null,null,0);return o.stateNode=r,o}function Xd(r,o,d){return o=Yn(4,r.children!==null?r.children:[],r.key,o),o.lanes=d,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var Vm=new WeakMap;function us(r,o){if(typeof r=="object"&&r!==null){var d=Vm.get(r);return d!==void 0?d:(o={value:r,source:o,stack:Le(o)},Vm.set(r,o),o)}return{value:r,source:o,stack:Le(o)}}var Fr=[],Br=0,Dl=null,no=0,hs=[],fs=0,_a=null,Bs=1,Gs="";function Qs(r,o){Fr[Br++]=no,Fr[Br++]=Dl,Dl=r,no=o}function Km(r,o,d){hs[fs++]=Bs,hs[fs++]=Gs,hs[fs++]=_a,_a=r;var p=Bs;r=Gs;var N=32-it(p)-1;p&=~(1<<N),d+=1;var w=32-it(o)+N;if(30<w){var R=N-N%5;w=(p&(1<<R)-1).toString(32),p>>=R,N-=R,Bs=1<<32-it(o)+N|d<<N|p,Gs=w+r}else Bs=1<<w|d<<N|p,Gs=r}function Qd(r){r.return!==null&&(Qs(r,1),Km(r,1,0))}function Zd(r){for(;r===Dl;)Dl=Fr[--Br],Fr[Br]=null,no=Fr[--Br],Fr[Br]=null;for(;r===_a;)_a=hs[--fs],hs[fs]=null,Gs=hs[--fs],hs[fs]=null,Bs=hs[--fs],hs[fs]=null}function Wm(r,o){hs[fs++]=Bs,hs[fs++]=Gs,hs[fs++]=_a,Bs=o.id,Gs=o.overflow,_a=r}var En=null,$t=null,St=!1,Ea=null,ms=!1,eu=Error(a(519));function Ca(r){var o=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw so(us(o,r)),eu}function Jm(r){var o=r.stateNode,d=r.type,p=r.memoizedProps;switch(o[on]=r,o[_n]=p,d){case"dialog":xt("cancel",o),xt("close",o);break;case"iframe":case"object":case"embed":xt("load",o);break;case"video":case"audio":for(d=0;d<_o.length;d++)xt(_o[d],o);break;case"source":xt("error",o);break;case"img":case"image":case"link":xt("error",o),xt("load",o);break;case"details":xt("toggle",o);break;case"input":xt("invalid",o),Dd(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":xt("invalid",o);break;case"textarea":xt("invalid",o),X(o,p.value,p.defaultValue,p.children)}d=p.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||p.suppressHydrationWarning===!0||hy(o.textContent,d)?(p.popover!=null&&(xt("beforetoggle",o),xt("toggle",o)),p.onScroll!=null&&xt("scroll",o),p.onScrollEnd!=null&&xt("scrollend",o),p.onClick!=null&&(o.onclick=Kt),o=!0):o=!1,o||Ca(r,!0)}function Ym(r){for(En=r.return;En;)switch(En.tag){case 5:case 31:case 13:ms=!1;return;case 27:case 3:ms=!0;return;default:En=En.return}}function Gr(r){if(r!==En)return!1;if(!St)return Ym(r),St=!0,!1;var o=r.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||xh(r.type,r.memoizedProps)),d=!d),d&&$t&&Ca(r),Ym(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(a(317));$t=Ny(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(a(317));$t=Ny(r)}else o===27?(o=$t,za(r.type)?(r=wh,wh=null,$t=r):$t=o):$t=En?gs(r.stateNode.nextSibling):null;return!0}function ur(){$t=En=null,St=!1}function tu(){var r=Ea;return r!==null&&(qn===null?qn=r:qn.push.apply(qn,r),Ea=null),r}function so(r){Ea===null?Ea=[r]:Ea.push(r)}var nu=$(null),hr=null,Zs=null;function Ia(r,o,d){ue(nu,o._currentValue),o._currentValue=d}function ea(r){r._currentValue=nu.current,ie(nu)}function su(r,o,d){for(;r!==null;){var p=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),r===d)break;r=r.return}}function au(r,o,d,p){var N=r.child;for(N!==null&&(N.return=r);N!==null;){var w=N.dependencies;if(w!==null){var R=N.child;w=w.firstContext;e:for(;w!==null;){var K=w;w=N;for(var re=0;re<o.length;re++)if(K.context===o[re]){w.lanes|=d,K=w.alternate,K!==null&&(K.lanes|=d),su(w.return,d,r),p||(R=null);break e}w=K.next}}else if(N.tag===18){if(R=N.return,R===null)throw Error(a(341));R.lanes|=d,w=R.alternate,w!==null&&(w.lanes|=d),su(R,d,r),R=null}else R=N.child;if(R!==null)R.return=N;else for(R=N;R!==null;){if(R===r){R=null;break}if(N=R.sibling,N!==null){N.return=R.return,R=N;break}R=R.return}N=R}}function zr(r,o,d,p){r=null;for(var N=o,w=!1;N!==null;){if(!w){if((N.flags&524288)!==0)w=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var R=N.alternate;if(R===null)throw Error(a(387));if(R=R.memoizedProps,R!==null){var K=N.type;Jn(N.pendingProps.value,R.value)||(r!==null?r.push(K):r=[K])}}else if(N===je.current){if(R=N.alternate,R===null)throw Error(a(387));R.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(r!==null?r.push(ko):r=[ko])}N=N.return}r!==null&&au(o,r,d,p),o.flags|=262144}function Rl(r){for(r=r.firstContext;r!==null;){if(!Jn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function fr(r){hr=r,Zs=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Cn(r){return Xm(hr,r)}function Ml(r,o){return hr===null&&fr(r),Xm(r,o)}function Xm(r,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},Zs===null){if(r===null)throw Error(a(308));Zs=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else Zs=Zs.next=o;return d}var fS=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(d,p){r.push(p)}};this.abort=function(){o.aborted=!0,r.forEach(function(d){return d()})}},mS=e.unstable_scheduleCallback,pS=e.unstable_NormalPriority,ln={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ru(){return{controller:new fS,data:new Map,refCount:0}}function ao(r){r.refCount--,r.refCount===0&&mS(pS,function(){r.controller.abort()})}var ro=null,iu=0,$r=0,Hr=null;function gS(r,o){if(ro===null){var d=ro=[];iu=0,$r=ch(),Hr={status:"pending",value:void 0,then:function(p){d.push(p)}}}return iu++,o.then(Qm,Qm),o}function Qm(){if(--iu===0&&ro!==null){Hr!==null&&(Hr.status="fulfilled");var r=ro;ro=null,$r=0,Hr=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function yS(r,o){var d=[],p={status:"pending",value:null,reason:null,then:function(N){d.push(N)}};return r.then(function(){p.status="fulfilled",p.value=o;for(var N=0;N<d.length;N++)(0,d[N])(o)},function(N){for(p.status="rejected",p.reason=N,N=0;N<d.length;N++)(0,d[N])(void 0)}),p}var Zm=G.S;G.S=function(r,o){Og=ut(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&gS(r,o),Zm!==null&&Zm(r,o)};var mr=$(null);function ou(){var r=mr.current;return r!==null?r:Ft.pooledCache}function Pl(r,o){o===null?ue(mr,mr.current):ue(mr,o.pool)}function ep(){var r=ou();return r===null?null:{parent:ln._currentValue,pool:r}}var qr=Error(a(460)),lu=Error(a(474)),Ol=Error(a(542)),Ll={then:function(){}};function tp(r){return r=r.status,r==="fulfilled"||r==="rejected"}function np(r,o,d){switch(d=r[d],d===void 0?r.push(o):d!==o&&(o.then(Kt,Kt),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,ap(r),r;default:if(typeof o.status=="string")o.then(Kt,Kt);else{if(r=Ft,r!==null&&100<r.shellSuspendCounter)throw Error(a(482));r=o,r.status="pending",r.then(function(p){if(o.status==="pending"){var N=o;N.status="fulfilled",N.value=p}},function(p){if(o.status==="pending"){var N=o;N.status="rejected",N.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,ap(r),r}throw gr=o,qr}}function pr(r){try{var o=r._init;return o(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(gr=d,qr):d}}var gr=null;function sp(){if(gr===null)throw Error(a(459));var r=gr;return gr=null,r}function ap(r){if(r===qr||r===Ol)throw Error(a(483))}var Vr=null,io=0;function Ul(r){var o=io;return io+=1,Vr===null&&(Vr=[]),np(Vr,r,o)}function oo(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function Fl(r,o){throw o.$$typeof===y?Error(a(525)):(r=Object.prototype.toString.call(o),Error(a(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function rp(r){function o(he,ce){if(r){var pe=he.deletions;pe===null?(he.deletions=[ce],he.flags|=16):pe.push(ce)}}function d(he,ce){if(!r)return null;for(;ce!==null;)o(he,ce),ce=ce.sibling;return null}function p(he){for(var ce=new Map;he!==null;)he.key!==null?ce.set(he.key,he):ce.set(he.index,he),he=he.sibling;return ce}function N(he,ce){return he=Xs(he,ce),he.index=0,he.sibling=null,he}function w(he,ce,pe){return he.index=pe,r?(pe=he.alternate,pe!==null?(pe=pe.index,pe<ce?(he.flags|=67108866,ce):pe):(he.flags|=67108866,ce)):(he.flags|=1048576,ce)}function R(he){return r&&he.alternate===null&&(he.flags|=67108866),he}function K(he,ce,pe,Ce){return ce===null||ce.tag!==6?(ce=Yd(pe,he.mode,Ce),ce.return=he,ce):(ce=N(ce,pe),ce.return=he,ce)}function re(he,ce,pe,Ce){var tt=pe.type;return tt===_?Ee(he,ce,pe.props.children,Ce,pe.key):ce!==null&&(ce.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===D&&pr(tt)===ce.type)?(ce=N(ce,pe.props),oo(ce,pe),ce.return=he,ce):(ce=kl(pe.type,pe.key,pe.props,null,he.mode,Ce),oo(ce,pe),ce.return=he,ce)}function ge(he,ce,pe,Ce){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==pe.containerInfo||ce.stateNode.implementation!==pe.implementation?(ce=Xd(pe,he.mode,Ce),ce.return=he,ce):(ce=N(ce,pe.children||[]),ce.return=he,ce)}function Ee(he,ce,pe,Ce,tt){return ce===null||ce.tag!==7?(ce=dr(pe,he.mode,Ce,tt),ce.return=he,ce):(ce=N(ce,pe),ce.return=he,ce)}function Ie(he,ce,pe){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=Yd(""+ce,he.mode,pe),ce.return=he,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case b:return pe=kl(ce.type,ce.key,ce.props,null,he.mode,pe),oo(pe,ce),pe.return=he,pe;case T:return ce=Xd(ce,he.mode,pe),ce.return=he,ce;case D:return ce=pr(ce),Ie(he,ce,pe)}if(J(ce)||q(ce))return ce=dr(ce,he.mode,pe,null),ce.return=he,ce;if(typeof ce.then=="function")return Ie(he,Ul(ce),pe);if(ce.$$typeof===C)return Ie(he,Ml(he,ce),pe);Fl(he,ce)}return null}function ve(he,ce,pe,Ce){var tt=ce!==null?ce.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return tt!==null?null:K(he,ce,""+pe,Ce);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:return pe.key===tt?re(he,ce,pe,Ce):null;case T:return pe.key===tt?ge(he,ce,pe,Ce):null;case D:return pe=pr(pe),ve(he,ce,pe,Ce)}if(J(pe)||q(pe))return tt!==null?null:Ee(he,ce,pe,Ce,null);if(typeof pe.then=="function")return ve(he,ce,Ul(pe),Ce);if(pe.$$typeof===C)return ve(he,ce,Ml(he,pe),Ce);Fl(he,pe)}return null}function Te(he,ce,pe,Ce,tt){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return he=he.get(pe)||null,K(ce,he,""+Ce,tt);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case b:return he=he.get(Ce.key===null?pe:Ce.key)||null,re(ce,he,Ce,tt);case T:return he=he.get(Ce.key===null?pe:Ce.key)||null,ge(ce,he,Ce,tt);case D:return Ce=pr(Ce),Te(he,ce,pe,Ce,tt)}if(J(Ce)||q(Ce))return he=he.get(pe)||null,Ee(ce,he,Ce,tt,null);if(typeof Ce.then=="function")return Te(he,ce,pe,Ul(Ce),tt);if(Ce.$$typeof===C)return Te(he,ce,pe,Ml(ce,Ce),tt);Fl(ce,Ce)}return null}function We(he,ce,pe,Ce){for(var tt=null,Tt=null,Xe=ce,ft=ce=0,Nt=null;Xe!==null&&ft<pe.length;ft++){Xe.index>ft?(Nt=Xe,Xe=null):Nt=Xe.sibling;var jt=ve(he,Xe,pe[ft],Ce);if(jt===null){Xe===null&&(Xe=Nt);break}r&&Xe&&jt.alternate===null&&o(he,Xe),ce=w(jt,ce,ft),Tt===null?tt=jt:Tt.sibling=jt,Tt=jt,Xe=Nt}if(ft===pe.length)return d(he,Xe),St&&Qs(he,ft),tt;if(Xe===null){for(;ft<pe.length;ft++)Xe=Ie(he,pe[ft],Ce),Xe!==null&&(ce=w(Xe,ce,ft),Tt===null?tt=Xe:Tt.sibling=Xe,Tt=Xe);return St&&Qs(he,ft),tt}for(Xe=p(Xe);ft<pe.length;ft++)Nt=Te(Xe,he,ft,pe[ft],Ce),Nt!==null&&(r&&Nt.alternate!==null&&Xe.delete(Nt.key===null?ft:Nt.key),ce=w(Nt,ce,ft),Tt===null?tt=Nt:Tt.sibling=Nt,Tt=Nt);return r&&Xe.forEach(function(Ka){return o(he,Ka)}),St&&Qs(he,ft),tt}function st(he,ce,pe,Ce){if(pe==null)throw Error(a(151));for(var tt=null,Tt=null,Xe=ce,ft=ce=0,Nt=null,jt=pe.next();Xe!==null&&!jt.done;ft++,jt=pe.next()){Xe.index>ft?(Nt=Xe,Xe=null):Nt=Xe.sibling;var Ka=ve(he,Xe,jt.value,Ce);if(Ka===null){Xe===null&&(Xe=Nt);break}r&&Xe&&Ka.alternate===null&&o(he,Xe),ce=w(Ka,ce,ft),Tt===null?tt=Ka:Tt.sibling=Ka,Tt=Ka,Xe=Nt}if(jt.done)return d(he,Xe),St&&Qs(he,ft),tt;if(Xe===null){for(;!jt.done;ft++,jt=pe.next())jt=Ie(he,jt.value,Ce),jt!==null&&(ce=w(jt,ce,ft),Tt===null?tt=jt:Tt.sibling=jt,Tt=jt);return St&&Qs(he,ft),tt}for(Xe=p(Xe);!jt.done;ft++,jt=pe.next())jt=Te(Xe,he,ft,jt.value,Ce),jt!==null&&(r&&jt.alternate!==null&&Xe.delete(jt.key===null?ft:jt.key),ce=w(jt,ce,ft),Tt===null?tt=jt:Tt.sibling=jt,Tt=jt);return r&&Xe.forEach(function(Cw){return o(he,Cw)}),St&&Qs(he,ft),tt}function Ot(he,ce,pe,Ce){if(typeof pe=="object"&&pe!==null&&pe.type===_&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:e:{for(var tt=pe.key;ce!==null;){if(ce.key===tt){if(tt=pe.type,tt===_){if(ce.tag===7){d(he,ce.sibling),Ce=N(ce,pe.props.children),Ce.return=he,he=Ce;break e}}else if(ce.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===D&&pr(tt)===ce.type){d(he,ce.sibling),Ce=N(ce,pe.props),oo(Ce,pe),Ce.return=he,he=Ce;break e}d(he,ce);break}else o(he,ce);ce=ce.sibling}pe.type===_?(Ce=dr(pe.props.children,he.mode,Ce,pe.key),Ce.return=he,he=Ce):(Ce=kl(pe.type,pe.key,pe.props,null,he.mode,Ce),oo(Ce,pe),Ce.return=he,he=Ce)}return R(he);case T:e:{for(tt=pe.key;ce!==null;){if(ce.key===tt)if(ce.tag===4&&ce.stateNode.containerInfo===pe.containerInfo&&ce.stateNode.implementation===pe.implementation){d(he,ce.sibling),Ce=N(ce,pe.children||[]),Ce.return=he,he=Ce;break e}else{d(he,ce);break}else o(he,ce);ce=ce.sibling}Ce=Xd(pe,he.mode,Ce),Ce.return=he,he=Ce}return R(he);case D:return pe=pr(pe),Ot(he,ce,pe,Ce)}if(J(pe))return We(he,ce,pe,Ce);if(q(pe)){if(tt=q(pe),typeof tt!="function")throw Error(a(150));return pe=tt.call(pe),st(he,ce,pe,Ce)}if(typeof pe.then=="function")return Ot(he,ce,Ul(pe),Ce);if(pe.$$typeof===C)return Ot(he,ce,Ml(he,pe),Ce);Fl(he,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,ce!==null&&ce.tag===6?(d(he,ce.sibling),Ce=N(ce,pe),Ce.return=he,he=Ce):(d(he,ce),Ce=Yd(pe,he.mode,Ce),Ce.return=he,he=Ce),R(he)):d(he,ce)}return function(he,ce,pe,Ce){try{io=0;var tt=Ot(he,ce,pe,Ce);return Vr=null,tt}catch(Xe){if(Xe===qr||Xe===Ol)throw Xe;var Tt=Yn(29,Xe,null,he.mode);return Tt.lanes=Ce,Tt.return=he,Tt}finally{}}}var yr=rp(!0),ip=rp(!1),Aa=!1;function cu(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function du(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ka(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Da(r,o,d){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,(It&2)!==0){var N=p.pending;return N===null?o.next=o:(o.next=N.next,N.next=o),p.pending=o,o=Al(r),$m(r,null,d),o}return Il(r,p,o,d),Al(r)}function lo(r,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var p=o.lanes;p&=r.pendingLanes,d|=p,o.lanes=d,hl(r,d)}}function uu(r,o){var d=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var N=null,w=null;if(d=d.firstBaseUpdate,d!==null){do{var R={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};w===null?N=w=R:w=w.next=R,d=d.next}while(d!==null);w===null?N=w=o:w=w.next=o}else N=w=o;d={baseState:p.baseState,firstBaseUpdate:N,lastBaseUpdate:w,shared:p.shared,callbacks:p.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=o:r.next=o,d.lastBaseUpdate=o}var hu=!1;function co(){if(hu){var r=Hr;if(r!==null)throw r}}function uo(r,o,d,p){hu=!1;var N=r.updateQueue;Aa=!1;var w=N.firstBaseUpdate,R=N.lastBaseUpdate,K=N.shared.pending;if(K!==null){N.shared.pending=null;var re=K,ge=re.next;re.next=null,R===null?w=ge:R.next=ge,R=re;var Ee=r.alternate;Ee!==null&&(Ee=Ee.updateQueue,K=Ee.lastBaseUpdate,K!==R&&(K===null?Ee.firstBaseUpdate=ge:K.next=ge,Ee.lastBaseUpdate=re))}if(w!==null){var Ie=N.baseState;R=0,Ee=ge=re=null,K=w;do{var ve=K.lane&-536870913,Te=ve!==K.lane;if(Te?(bt&ve)===ve:(p&ve)===ve){ve!==0&&ve===$r&&(hu=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});e:{var We=r,st=K;ve=o;var Ot=d;switch(st.tag){case 1:if(We=st.payload,typeof We=="function"){Ie=We.call(Ot,Ie,ve);break e}Ie=We;break e;case 3:We.flags=We.flags&-65537|128;case 0:if(We=st.payload,ve=typeof We=="function"?We.call(Ot,Ie,ve):We,ve==null)break e;Ie=x({},Ie,ve);break e;case 2:Aa=!0}}ve=K.callback,ve!==null&&(r.flags|=64,Te&&(r.flags|=8192),Te=N.callbacks,Te===null?N.callbacks=[ve]:Te.push(ve))}else Te={lane:ve,tag:K.tag,payload:K.payload,callback:K.callback,next:null},Ee===null?(ge=Ee=Te,re=Ie):Ee=Ee.next=Te,R|=ve;if(K=K.next,K===null){if(K=N.shared.pending,K===null)break;Te=K,K=Te.next,Te.next=null,N.lastBaseUpdate=Te,N.shared.pending=null}}while(!0);Ee===null&&(re=Ie),N.baseState=re,N.firstBaseUpdate=ge,N.lastBaseUpdate=Ee,w===null&&(N.shared.lanes=0),La|=R,r.lanes=R,r.memoizedState=Ie}}function op(r,o){if(typeof r!="function")throw Error(a(191,r));r.call(o)}function lp(r,o){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)op(d[r],o)}var Kr=$(null),Bl=$(0);function cp(r,o){r=ca,ue(Bl,r),ue(Kr,o),ca=r|o.baseLanes}function fu(){ue(Bl,ca),ue(Kr,Kr.current)}function mu(){ca=Bl.current,ie(Kr),ie(Bl)}var Xn=$(null),ps=null;function Ra(r){var o=r.alternate;ue(an,an.current&1),ue(Xn,r),ps===null&&(o===null||Kr.current!==null||o.memoizedState!==null)&&(ps=r)}function pu(r){ue(an,an.current),ue(Xn,r),ps===null&&(ps=r)}function dp(r){r.tag===22?(ue(an,an.current),ue(Xn,r),ps===null&&(ps=r)):Ma()}function Ma(){ue(an,an.current),ue(Xn,Xn.current)}function Qn(r){ie(Xn),ps===r&&(ps=null),ie(an)}var an=$(0);function Gl(r){for(var o=r;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Nh(d)||Sh(d)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ta=0,ht=null,Mt=null,cn=null,zl=!1,Wr=!1,xr=!1,$l=0,ho=0,Jr=null,xS=0;function tn(){throw Error(a(321))}function gu(r,o){if(o===null)return!1;for(var d=0;d<o.length&&d<r.length;d++)if(!Jn(r[d],o[d]))return!1;return!0}function yu(r,o,d,p,N,w){return ta=w,ht=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,G.H=r===null||r.memoizedState===null?Kp:Du,xr=!1,w=d(p,N),xr=!1,Wr&&(w=hp(o,d,p,N)),up(r),w}function up(r){G.H=po;var o=Mt!==null&&Mt.next!==null;if(ta=0,cn=Mt=ht=null,zl=!1,ho=0,Jr=null,o)throw Error(a(300));r===null||dn||(r=r.dependencies,r!==null&&Rl(r)&&(dn=!0))}function hp(r,o,d,p){ht=r;var N=0;do{if(Wr&&(Jr=null),ho=0,Wr=!1,25<=N)throw Error(a(301));if(N+=1,cn=Mt=null,r.updateQueue!=null){var w=r.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}G.H=Wp,w=o(d,p)}while(Wr);return w}function vS(){var r=G.H,o=r.useState()[0];return o=typeof o.then=="function"?fo(o):o,r=r.useState()[0],(Mt!==null?Mt.memoizedState:null)!==r&&(ht.flags|=1024),o}function xu(){var r=$l!==0;return $l=0,r}function vu(r,o,d){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~d}function bu(r){if(zl){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}zl=!1}ta=0,cn=Mt=ht=null,Wr=!1,ho=$l=0,Jr=null}function On(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cn===null?ht.memoizedState=cn=r:cn=cn.next=r,cn}function rn(){if(Mt===null){var r=ht.alternate;r=r!==null?r.memoizedState:null}else r=Mt.next;var o=cn===null?ht.memoizedState:cn.next;if(o!==null)cn=o,Mt=r;else{if(r===null)throw ht.alternate===null?Error(a(467)):Error(a(310));Mt=r,r={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},cn===null?ht.memoizedState=cn=r:cn=cn.next=r}return cn}function Hl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fo(r){var o=ho;return ho+=1,Jr===null&&(Jr=[]),r=np(Jr,r,o),o=ht,(cn===null?o.memoizedState:cn.next)===null&&(o=o.alternate,G.H=o===null||o.memoizedState===null?Kp:Du),r}function ql(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return fo(r);if(r.$$typeof===C)return Cn(r)}throw Error(a(438,String(r)))}function Nu(r){var o=null,d=ht.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var p=ht.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(N){return N.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Hl(),ht.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(r),p=0;p<r;p++)d[p]=O;return o.index++,d}function na(r,o){return typeof o=="function"?o(r):o}function Vl(r){var o=rn();return Su(o,Mt,r)}function Su(r,o,d){var p=r.queue;if(p===null)throw Error(a(311));p.lastRenderedReducer=d;var N=r.baseQueue,w=p.pending;if(w!==null){if(N!==null){var R=N.next;N.next=w.next,w.next=R}o.baseQueue=N=w,p.pending=null}if(w=r.baseState,N===null)r.memoizedState=w;else{o=N.next;var K=R=null,re=null,ge=o,Ee=!1;do{var Ie=ge.lane&-536870913;if(Ie!==ge.lane?(bt&Ie)===Ie:(ta&Ie)===Ie){var ve=ge.revertLane;if(ve===0)re!==null&&(re=re.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),Ie===$r&&(Ee=!0);else if((ta&ve)===ve){ge=ge.next,ve===$r&&(Ee=!0);continue}else Ie={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(K=re=Ie,R=w):re=re.next=Ie,ht.lanes|=ve,La|=ve;Ie=ge.action,xr&&d(w,Ie),w=ge.hasEagerState?ge.eagerState:d(w,Ie)}else ve={lane:Ie,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},re===null?(K=re=ve,R=w):re=re.next=ve,ht.lanes|=Ie,La|=Ie;ge=ge.next}while(ge!==null&&ge!==o);if(re===null?R=w:re.next=K,!Jn(w,r.memoizedState)&&(dn=!0,Ee&&(d=Hr,d!==null)))throw d;r.memoizedState=w,r.baseState=R,r.baseQueue=re,p.lastRenderedState=w}return N===null&&(p.lanes=0),[r.memoizedState,p.dispatch]}function wu(r){var o=rn(),d=o.queue;if(d===null)throw Error(a(311));d.lastRenderedReducer=r;var p=d.dispatch,N=d.pending,w=o.memoizedState;if(N!==null){d.pending=null;var R=N=N.next;do w=r(w,R.action),R=R.next;while(R!==N);Jn(w,o.memoizedState)||(dn=!0),o.memoizedState=w,o.baseQueue===null&&(o.baseState=w),d.lastRenderedState=w}return[w,p]}function fp(r,o,d){var p=ht,N=rn(),w=St;if(w){if(d===void 0)throw Error(a(407));d=d()}else d=o();var R=!Jn((Mt||N).memoizedState,d);if(R&&(N.memoizedState=d,dn=!0),N=N.queue,_u(gp.bind(null,p,N,r),[r]),N.getSnapshot!==o||R||cn!==null&&cn.memoizedState.tag&1){if(p.flags|=2048,Yr(9,{destroy:void 0},pp.bind(null,p,N,d,o),null),Ft===null)throw Error(a(349));w||(ta&127)!==0||mp(p,o,d)}return d}function mp(r,o,d){r.flags|=16384,r={getSnapshot:o,value:d},o=ht.updateQueue,o===null?(o=Hl(),ht.updateQueue=o,o.stores=[r]):(d=o.stores,d===null?o.stores=[r]:d.push(r))}function pp(r,o,d,p){o.value=d,o.getSnapshot=p,yp(o)&&xp(r)}function gp(r,o,d){return d(function(){yp(o)&&xp(r)})}function yp(r){var o=r.getSnapshot;r=r.value;try{var d=o();return!Jn(r,d)}catch{return!0}}function xp(r){var o=cr(r,2);o!==null&&Vn(o,r,2)}function Tu(r){var o=On();if(typeof r=="function"){var d=r;if(r=d(),xr){wt(!0);try{d()}finally{wt(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:na,lastRenderedState:r},o}function vp(r,o,d,p){return r.baseState=d,Su(r,Mt,typeof p=="function"?p:na)}function bS(r,o,d,p,N){if(Jl(r))throw Error(a(485));if(r=o.action,r!==null){var w={payload:N,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){w.listeners.push(R)}};G.T!==null?d(!0):w.isTransition=!1,p(w),d=o.pending,d===null?(w.next=o.pending=w,bp(o,w)):(w.next=d.next,o.pending=d.next=w)}}function bp(r,o){var d=o.action,p=o.payload,N=r.state;if(o.isTransition){var w=G.T,R={};G.T=R;try{var K=d(N,p),re=G.S;re!==null&&re(R,K),Np(r,o,K)}catch(ge){ju(r,o,ge)}finally{w!==null&&R.types!==null&&(w.types=R.types),G.T=w}}else try{w=d(N,p),Np(r,o,w)}catch(ge){ju(r,o,ge)}}function Np(r,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(p){Sp(r,o,p)},function(p){return ju(r,o,p)}):Sp(r,o,d)}function Sp(r,o,d){o.status="fulfilled",o.value=d,wp(o),r.state=d,o=r.pending,o!==null&&(d=o.next,d===o?r.pending=null:(d=d.next,o.next=d,bp(r,d)))}function ju(r,o,d){var p=r.pending;if(r.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=d,wp(o),o=o.next;while(o!==p)}r.action=null}function wp(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Tp(r,o){return o}function jp(r,o){if(St){var d=Ft.formState;if(d!==null){e:{var p=ht;if(St){if($t){t:{for(var N=$t,w=ms;N.nodeType!==8;){if(!w){N=null;break t}if(N=gs(N.nextSibling),N===null){N=null;break t}}w=N.data,N=w==="F!"||w==="F"?N:null}if(N){$t=gs(N.nextSibling),p=N.data==="F!";break e}}Ca(p)}p=!1}p&&(o=d[0])}}return d=On(),d.memoizedState=d.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tp,lastRenderedState:o},d.queue=p,d=Hp.bind(null,ht,p),p.dispatch=d,p=Tu(!1),w=ku.bind(null,ht,!1,p.queue),p=On(),N={state:o,dispatch:null,action:r,pending:null},p.queue=N,d=bS.bind(null,ht,N,w,d),N.dispatch=d,p.memoizedState=r,[o,d,!1]}function _p(r){var o=rn();return Ep(o,Mt,r)}function Ep(r,o,d){if(o=Su(r,o,Tp)[0],r=Vl(na)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=fo(o)}catch(R){throw R===qr?Ol:R}else p=o;o=rn();var N=o.queue,w=N.dispatch;return d!==o.memoizedState&&(ht.flags|=2048,Yr(9,{destroy:void 0},NS.bind(null,N,d),null)),[p,w,r]}function NS(r,o){r.action=o}function Cp(r){var o=rn(),d=Mt;if(d!==null)return Ep(o,d,r);rn(),o=o.memoizedState,d=rn();var p=d.queue.dispatch;return d.memoizedState=r,[o,p,!1]}function Yr(r,o,d,p){return r={tag:r,create:d,deps:p,inst:o,next:null},o=ht.updateQueue,o===null&&(o=Hl(),ht.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=r.next=r:(p=d.next,d.next=r,r.next=p,o.lastEffect=r),r}function Ip(){return rn().memoizedState}function Kl(r,o,d,p){var N=On();ht.flags|=r,N.memoizedState=Yr(1|o,{destroy:void 0},d,p===void 0?null:p)}function Wl(r,o,d,p){var N=rn();p=p===void 0?null:p;var w=N.memoizedState.inst;Mt!==null&&p!==null&&gu(p,Mt.memoizedState.deps)?N.memoizedState=Yr(o,w,d,p):(ht.flags|=r,N.memoizedState=Yr(1|o,w,d,p))}function Ap(r,o){Kl(8390656,8,r,o)}function _u(r,o){Wl(2048,8,r,o)}function SS(r){ht.flags|=4;var o=ht.updateQueue;if(o===null)o=Hl(),ht.updateQueue=o,o.events=[r];else{var d=o.events;d===null?o.events=[r]:d.push(r)}}function kp(r){var o=rn().memoizedState;return SS({ref:o,nextImpl:r}),function(){if((It&2)!==0)throw Error(a(440));return o.impl.apply(void 0,arguments)}}function Dp(r,o){return Wl(4,2,r,o)}function Rp(r,o){return Wl(4,4,r,o)}function Mp(r,o){if(typeof o=="function"){r=r();var d=o(r);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Pp(r,o,d){d=d!=null?d.concat([r]):null,Wl(4,4,Mp.bind(null,o,r),d)}function Eu(){}function Op(r,o){var d=rn();o=o===void 0?null:o;var p=d.memoizedState;return o!==null&&gu(o,p[1])?p[0]:(d.memoizedState=[r,o],r)}function Lp(r,o){var d=rn();o=o===void 0?null:o;var p=d.memoizedState;if(o!==null&&gu(o,p[1]))return p[0];if(p=r(),xr){wt(!0);try{r()}finally{wt(!1)}}return d.memoizedState=[p,o],p}function Cu(r,o,d){return d===void 0||(ta&1073741824)!==0&&(bt&261930)===0?r.memoizedState=o:(r.memoizedState=d,r=Ug(),ht.lanes|=r,La|=r,d)}function Up(r,o,d,p){return Jn(d,o)?d:Kr.current!==null?(r=Cu(r,d,p),Jn(r,o)||(dn=!0),r):(ta&42)===0||(ta&1073741824)!==0&&(bt&261930)===0?(dn=!0,r.memoizedState=d):(r=Ug(),ht.lanes|=r,La|=r,o)}function Fp(r,o,d,p,N){var w=B.p;B.p=w!==0&&8>w?w:8;var R=G.T,K={};G.T=K,ku(r,!1,o,d);try{var re=N(),ge=G.S;if(ge!==null&&ge(K,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var Ee=yS(re,p);mo(r,o,Ee,ts(r))}else mo(r,o,p,ts(r))}catch(Ie){mo(r,o,{then:function(){},status:"rejected",reason:Ie},ts())}finally{B.p=w,R!==null&&K.types!==null&&(R.types=K.types),G.T=R}}function wS(){}function Iu(r,o,d,p){if(r.tag!==5)throw Error(a(476));var N=Bp(r).queue;Fp(r,N,o,Q,d===null?wS:function(){return Gp(r),d(p)})}function Bp(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:na,lastRenderedState:Q},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:na,lastRenderedState:d},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function Gp(r){var o=Bp(r);o.next===null&&(o=r.alternate.memoizedState),mo(r,o.next.queue,{},ts())}function Au(){return Cn(ko)}function zp(){return rn().memoizedState}function $p(){return rn().memoizedState}function TS(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var d=ts();r=ka(d);var p=Da(o,r,d);p!==null&&(Vn(p,o,d),lo(p,o,d)),o={cache:ru()},r.payload=o;return}o=o.return}}function jS(r,o,d){var p=ts();d={lane:p,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Jl(r)?qp(o,d):(d=Wd(r,o,d,p),d!==null&&(Vn(d,r,p),Vp(d,o,p)))}function Hp(r,o,d){var p=ts();mo(r,o,d,p)}function mo(r,o,d,p){var N={lane:p,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Jl(r))qp(o,N);else{var w=r.alternate;if(r.lanes===0&&(w===null||w.lanes===0)&&(w=o.lastRenderedReducer,w!==null))try{var R=o.lastRenderedState,K=w(R,d);if(N.hasEagerState=!0,N.eagerState=K,Jn(K,R))return Il(r,o,N,0),Ft===null&&Cl(),!1}catch{}finally{}if(d=Wd(r,o,N,p),d!==null)return Vn(d,r,p),Vp(d,o,p),!0}return!1}function ku(r,o,d,p){if(p={lane:2,revertLane:ch(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Jl(r)){if(o)throw Error(a(479))}else o=Wd(r,d,p,2),o!==null&&Vn(o,r,2)}function Jl(r){var o=r.alternate;return r===ht||o!==null&&o===ht}function qp(r,o){Wr=zl=!0;var d=r.pending;d===null?o.next=o:(o.next=d.next,d.next=o),r.pending=o}function Vp(r,o,d){if((d&4194048)!==0){var p=o.lanes;p&=r.pendingLanes,d|=p,o.lanes=d,hl(r,d)}}var po={readContext:Cn,use:ql,useCallback:tn,useContext:tn,useEffect:tn,useImperativeHandle:tn,useLayoutEffect:tn,useInsertionEffect:tn,useMemo:tn,useReducer:tn,useRef:tn,useState:tn,useDebugValue:tn,useDeferredValue:tn,useTransition:tn,useSyncExternalStore:tn,useId:tn,useHostTransitionStatus:tn,useFormState:tn,useActionState:tn,useOptimistic:tn,useMemoCache:tn,useCacheRefresh:tn};po.useEffectEvent=tn;var Kp={readContext:Cn,use:ql,useCallback:function(r,o){return On().memoizedState=[r,o===void 0?null:o],r},useContext:Cn,useEffect:Ap,useImperativeHandle:function(r,o,d){d=d!=null?d.concat([r]):null,Kl(4194308,4,Mp.bind(null,o,r),d)},useLayoutEffect:function(r,o){return Kl(4194308,4,r,o)},useInsertionEffect:function(r,o){Kl(4,2,r,o)},useMemo:function(r,o){var d=On();o=o===void 0?null:o;var p=r();if(xr){wt(!0);try{r()}finally{wt(!1)}}return d.memoizedState=[p,o],p},useReducer:function(r,o,d){var p=On();if(d!==void 0){var N=d(o);if(xr){wt(!0);try{d(o)}finally{wt(!1)}}}else N=o;return p.memoizedState=p.baseState=N,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:N},p.queue=r,r=r.dispatch=jS.bind(null,ht,r),[p.memoizedState,r]},useRef:function(r){var o=On();return r={current:r},o.memoizedState=r},useState:function(r){r=Tu(r);var o=r.queue,d=Hp.bind(null,ht,o);return o.dispatch=d,[r.memoizedState,d]},useDebugValue:Eu,useDeferredValue:function(r,o){var d=On();return Cu(d,r,o)},useTransition:function(){var r=Tu(!1);return r=Fp.bind(null,ht,r.queue,!0,!1),On().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,d){var p=ht,N=On();if(St){if(d===void 0)throw Error(a(407));d=d()}else{if(d=o(),Ft===null)throw Error(a(349));(bt&127)!==0||mp(p,o,d)}N.memoizedState=d;var w={value:d,getSnapshot:o};return N.queue=w,Ap(gp.bind(null,p,w,r),[r]),p.flags|=2048,Yr(9,{destroy:void 0},pp.bind(null,p,w,d,o),null),d},useId:function(){var r=On(),o=Ft.identifierPrefix;if(St){var d=Gs,p=Bs;d=(p&~(1<<32-it(p)-1)).toString(32)+d,o="_"+o+"R_"+d,d=$l++,0<d&&(o+="H"+d.toString(32)),o+="_"}else d=xS++,o="_"+o+"r_"+d.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:Au,useFormState:jp,useActionState:jp,useOptimistic:function(r){var o=On();o.memoizedState=o.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=ku.bind(null,ht,!0,d),d.dispatch=o,[r,o]},useMemoCache:Nu,useCacheRefresh:function(){return On().memoizedState=TS.bind(null,ht)},useEffectEvent:function(r){var o=On(),d={impl:r};return o.memoizedState=d,function(){if((It&2)!==0)throw Error(a(440));return d.impl.apply(void 0,arguments)}}},Du={readContext:Cn,use:ql,useCallback:Op,useContext:Cn,useEffect:_u,useImperativeHandle:Pp,useInsertionEffect:Dp,useLayoutEffect:Rp,useMemo:Lp,useReducer:Vl,useRef:Ip,useState:function(){return Vl(na)},useDebugValue:Eu,useDeferredValue:function(r,o){var d=rn();return Up(d,Mt.memoizedState,r,o)},useTransition:function(){var r=Vl(na)[0],o=rn().memoizedState;return[typeof r=="boolean"?r:fo(r),o]},useSyncExternalStore:fp,useId:zp,useHostTransitionStatus:Au,useFormState:_p,useActionState:_p,useOptimistic:function(r,o){var d=rn();return vp(d,Mt,r,o)},useMemoCache:Nu,useCacheRefresh:$p};Du.useEffectEvent=kp;var Wp={readContext:Cn,use:ql,useCallback:Op,useContext:Cn,useEffect:_u,useImperativeHandle:Pp,useInsertionEffect:Dp,useLayoutEffect:Rp,useMemo:Lp,useReducer:wu,useRef:Ip,useState:function(){return wu(na)},useDebugValue:Eu,useDeferredValue:function(r,o){var d=rn();return Mt===null?Cu(d,r,o):Up(d,Mt.memoizedState,r,o)},useTransition:function(){var r=wu(na)[0],o=rn().memoizedState;return[typeof r=="boolean"?r:fo(r),o]},useSyncExternalStore:fp,useId:zp,useHostTransitionStatus:Au,useFormState:Cp,useActionState:Cp,useOptimistic:function(r,o){var d=rn();return Mt!==null?vp(d,Mt,r,o):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:Nu,useCacheRefresh:$p};Wp.useEffectEvent=kp;function Ru(r,o,d,p){o=r.memoizedState,d=d(p,o),d=d==null?o:x({},o,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Mu={enqueueSetState:function(r,o,d){r=r._reactInternals;var p=ts(),N=ka(p);N.payload=o,d!=null&&(N.callback=d),o=Da(r,N,p),o!==null&&(Vn(o,r,p),lo(o,r,p))},enqueueReplaceState:function(r,o,d){r=r._reactInternals;var p=ts(),N=ka(p);N.tag=1,N.payload=o,d!=null&&(N.callback=d),o=Da(r,N,p),o!==null&&(Vn(o,r,p),lo(o,r,p))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var d=ts(),p=ka(d);p.tag=2,o!=null&&(p.callback=o),o=Da(r,p,d),o!==null&&(Vn(o,r,d),lo(o,r,d))}};function Jp(r,o,d,p,N,w,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,w,R):o.prototype&&o.prototype.isPureReactComponent?!eo(d,p)||!eo(N,w):!0}function Yp(r,o,d,p){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,p),o.state!==r&&Mu.enqueueReplaceState(o,o.state,null)}function vr(r,o){var d=o;if("ref"in o){d={};for(var p in o)p!=="ref"&&(d[p]=o[p])}if(r=r.defaultProps){d===o&&(d=x({},d));for(var N in r)d[N]===void 0&&(d[N]=r[N])}return d}function Xp(r){El(r)}function Qp(r){console.error(r)}function Zp(r){El(r)}function Yl(r,o){try{var d=r.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function eg(r,o,d){try{var p=r.onCaughtError;p(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function Pu(r,o,d){return d=ka(d),d.tag=3,d.payload={element:null},d.callback=function(){Yl(r,o)},d}function tg(r){return r=ka(r),r.tag=3,r}function ng(r,o,d,p){var N=d.type.getDerivedStateFromError;if(typeof N=="function"){var w=p.value;r.payload=function(){return N(w)},r.callback=function(){eg(o,d,p)}}var R=d.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(r.callback=function(){eg(o,d,p),typeof N!="function"&&(Ua===null?Ua=new Set([this]):Ua.add(this));var K=p.stack;this.componentDidCatch(p.value,{componentStack:K!==null?K:""})})}function _S(r,o,d,p,N){if(d.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=d.alternate,o!==null&&zr(o,d,N,!0),d=Xn.current,d!==null){switch(d.tag){case 31:case 13:return ps===null?lc():d.alternate===null&&nn===0&&(nn=3),d.flags&=-257,d.flags|=65536,d.lanes=N,p===Ll?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([p]):o.add(p),ih(r,p,N)),!1;case 22:return d.flags|=65536,p===Ll?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([p]):d.add(p)),ih(r,p,N)),!1}throw Error(a(435,d.tag))}return ih(r,p,N),lc(),!1}if(St)return o=Xn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=N,p!==eu&&(r=Error(a(422),{cause:p}),so(us(r,d)))):(p!==eu&&(o=Error(a(423),{cause:p}),so(us(o,d))),r=r.current.alternate,r.flags|=65536,N&=-N,r.lanes|=N,p=us(p,d),N=Pu(r.stateNode,p,N),uu(r,N),nn!==4&&(nn=2)),!1;var w=Error(a(520),{cause:p});if(w=us(w,d),wo===null?wo=[w]:wo.push(w),nn!==4&&(nn=2),o===null)return!0;p=us(p,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,r=N&-N,d.lanes|=r,r=Pu(d.stateNode,p,r),uu(d,r),!1;case 1:if(o=d.type,w=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ua===null||!Ua.has(w))))return d.flags|=65536,N&=-N,d.lanes|=N,N=tg(N),ng(N,r,d,p),uu(d,N),!1}d=d.return}while(d!==null);return!1}var Ou=Error(a(461)),dn=!1;function In(r,o,d,p){o.child=r===null?ip(o,null,d,p):yr(o,r.child,d,p)}function sg(r,o,d,p,N){d=d.render;var w=o.ref;if("ref"in p){var R={};for(var K in p)K!=="ref"&&(R[K]=p[K])}else R=p;return fr(o),p=yu(r,o,d,R,w,N),K=xu(),r!==null&&!dn?(vu(r,o,N),sa(r,o,N)):(St&&K&&Qd(o),o.flags|=1,In(r,o,p,N),o.child)}function ag(r,o,d,p,N){if(r===null){var w=d.type;return typeof w=="function"&&!Jd(w)&&w.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=w,rg(r,o,w,p,N)):(r=kl(d.type,null,p,o,o.mode,N),r.ref=o.ref,r.return=o,o.child=r)}if(w=r.child,!Hu(r,N)){var R=w.memoizedProps;if(d=d.compare,d=d!==null?d:eo,d(R,p)&&r.ref===o.ref)return sa(r,o,N)}return o.flags|=1,r=Xs(w,p),r.ref=o.ref,r.return=o,o.child=r}function rg(r,o,d,p,N){if(r!==null){var w=r.memoizedProps;if(eo(w,p)&&r.ref===o.ref)if(dn=!1,o.pendingProps=p=w,Hu(r,N))(r.flags&131072)!==0&&(dn=!0);else return o.lanes=r.lanes,sa(r,o,N)}return Lu(r,o,d,p,N)}function ig(r,o,d,p){var N=p.children,w=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(w=w!==null?w.baseLanes|d:d,r!==null){for(p=o.child=r.child,N=0;p!==null;)N=N|p.lanes|p.childLanes,p=p.sibling;p=N&~w}else p=0,o.child=null;return og(r,o,w,d,p)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&Pl(o,w!==null?w.cachePool:null),w!==null?cp(o,w):fu(),dp(o);else return p=o.lanes=536870912,og(r,o,w!==null?w.baseLanes|d:d,d,p)}else w!==null?(Pl(o,w.cachePool),cp(o,w),Ma(),o.memoizedState=null):(r!==null&&Pl(o,null),fu(),Ma());return In(r,o,N,d),o.child}function go(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function og(r,o,d,p,N){var w=ou();return w=w===null?null:{parent:ln._currentValue,pool:w},o.memoizedState={baseLanes:d,cachePool:w},r!==null&&Pl(o,null),fu(),dp(o),r!==null&&zr(r,o,p,!0),o.childLanes=N,null}function Xl(r,o){return o=Zl({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function lg(r,o,d){return yr(o,r.child,null,d),r=Xl(o,o.pendingProps),r.flags|=2,Qn(o),o.memoizedState=null,r}function ES(r,o,d){var p=o.pendingProps,N=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(St){if(p.mode==="hidden")return r=Xl(o,p),o.lanes=536870912,go(null,r);if(pu(o),(r=$t)?(r=by(r,ms),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:_a!==null?{id:Bs,overflow:Gs}:null,retryLane:536870912,hydrationErrors:null},d=qm(r),d.return=o,o.child=d,En=o,$t=null)):r=null,r===null)throw Ca(o);return o.lanes=536870912,null}return Xl(o,p)}var w=r.memoizedState;if(w!==null){var R=w.dehydrated;if(pu(o),N)if(o.flags&256)o.flags&=-257,o=lg(r,o,d);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(a(558));else if(dn||zr(r,o,d,!1),N=(d&r.childLanes)!==0,dn||N){if(p=Ft,p!==null&&(R=fl(p,d),R!==0&&R!==w.retryLane))throw w.retryLane=R,cr(r,R),Vn(p,r,R),Ou;lc(),o=lg(r,o,d)}else r=w.treeContext,$t=gs(R.nextSibling),En=o,St=!0,Ea=null,ms=!1,r!==null&&Wm(o,r),o=Xl(o,p),o.flags|=4096;return o}return r=Xs(r.child,{mode:p.mode,children:p.children}),r.ref=o.ref,o.child=r,r.return=o,r}function Ql(r,o){var d=o.ref;if(d===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(a(284));(r===null||r.ref!==d)&&(o.flags|=4194816)}}function Lu(r,o,d,p,N){return fr(o),d=yu(r,o,d,p,void 0,N),p=xu(),r!==null&&!dn?(vu(r,o,N),sa(r,o,N)):(St&&p&&Qd(o),o.flags|=1,In(r,o,d,N),o.child)}function cg(r,o,d,p,N,w){return fr(o),o.updateQueue=null,d=hp(o,p,d,N),up(r),p=xu(),r!==null&&!dn?(vu(r,o,w),sa(r,o,w)):(St&&p&&Qd(o),o.flags|=1,In(r,o,d,w),o.child)}function dg(r,o,d,p,N){if(fr(o),o.stateNode===null){var w=Ur,R=d.contextType;typeof R=="object"&&R!==null&&(w=Cn(R)),w=new d(p,w),o.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Mu,o.stateNode=w,w._reactInternals=o,w=o.stateNode,w.props=p,w.state=o.memoizedState,w.refs={},cu(o),R=d.contextType,w.context=typeof R=="object"&&R!==null?Cn(R):Ur,w.state=o.memoizedState,R=d.getDerivedStateFromProps,typeof R=="function"&&(Ru(o,d,R,p),w.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(R=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),R!==w.state&&Mu.enqueueReplaceState(w,w.state,null),uo(o,p,w,N),co(),w.state=o.memoizedState),typeof w.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(r===null){w=o.stateNode;var K=o.memoizedProps,re=vr(d,K);w.props=re;var ge=w.context,Ee=d.contextType;R=Ur,typeof Ee=="object"&&Ee!==null&&(R=Cn(Ee));var Ie=d.getDerivedStateFromProps;Ee=typeof Ie=="function"||typeof w.getSnapshotBeforeUpdate=="function",K=o.pendingProps!==K,Ee||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(K||ge!==R)&&Yp(o,w,p,R),Aa=!1;var ve=o.memoizedState;w.state=ve,uo(o,p,w,N),co(),ge=o.memoizedState,K||ve!==ge||Aa?(typeof Ie=="function"&&(Ru(o,d,Ie,p),ge=o.memoizedState),(re=Aa||Jp(o,d,re,p,ve,ge,R))?(Ee||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(o.flags|=4194308)):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=ge),w.props=p,w.state=ge,w.context=R,p=re):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{w=o.stateNode,du(r,o),R=o.memoizedProps,Ee=vr(d,R),w.props=Ee,Ie=o.pendingProps,ve=w.context,ge=d.contextType,re=Ur,typeof ge=="object"&&ge!==null&&(re=Cn(ge)),K=d.getDerivedStateFromProps,(ge=typeof K=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(R!==Ie||ve!==re)&&Yp(o,w,p,re),Aa=!1,ve=o.memoizedState,w.state=ve,uo(o,p,w,N),co();var Te=o.memoizedState;R!==Ie||ve!==Te||Aa||r!==null&&r.dependencies!==null&&Rl(r.dependencies)?(typeof K=="function"&&(Ru(o,d,K,p),Te=o.memoizedState),(Ee=Aa||Jp(o,d,Ee,p,ve,Te,re)||r!==null&&r.dependencies!==null&&Rl(r.dependencies))?(ge||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(p,Te,re),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(p,Te,re)),typeof w.componentDidUpdate=="function"&&(o.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof w.componentDidUpdate!="function"||R===r.memoizedProps&&ve===r.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&ve===r.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=Te),w.props=p,w.state=Te,w.context=re,p=Ee):(typeof w.componentDidUpdate!="function"||R===r.memoizedProps&&ve===r.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&ve===r.memoizedState||(o.flags|=1024),p=!1)}return w=p,Ql(r,o),p=(o.flags&128)!==0,w||p?(w=o.stateNode,d=p&&typeof d.getDerivedStateFromError!="function"?null:w.render(),o.flags|=1,r!==null&&p?(o.child=yr(o,r.child,null,N),o.child=yr(o,null,d,N)):In(r,o,d,N),o.memoizedState=w.state,r=o.child):r=sa(r,o,N),r}function ug(r,o,d,p){return ur(),o.flags|=256,In(r,o,d,p),o.child}var Uu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fu(r){return{baseLanes:r,cachePool:ep()}}function Bu(r,o,d){return r=r!==null?r.childLanes&~d:0,o&&(r|=es),r}function hg(r,o,d){var p=o.pendingProps,N=!1,w=(o.flags&128)!==0,R;if((R=w)||(R=r!==null&&r.memoizedState===null?!1:(an.current&2)!==0),R&&(N=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,r===null){if(St){if(N?Ra(o):Ma(),(r=$t)?(r=by(r,ms),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:_a!==null?{id:Bs,overflow:Gs}:null,retryLane:536870912,hydrationErrors:null},d=qm(r),d.return=o,o.child=d,En=o,$t=null)):r=null,r===null)throw Ca(o);return Sh(r)?o.lanes=32:o.lanes=536870912,null}var K=p.children;return p=p.fallback,N?(Ma(),N=o.mode,K=Zl({mode:"hidden",children:K},N),p=dr(p,N,d,null),K.return=o,p.return=o,K.sibling=p,o.child=K,p=o.child,p.memoizedState=Fu(d),p.childLanes=Bu(r,R,d),o.memoizedState=Uu,go(null,p)):(Ra(o),Gu(o,K))}var re=r.memoizedState;if(re!==null&&(K=re.dehydrated,K!==null)){if(w)o.flags&256?(Ra(o),o.flags&=-257,o=zu(r,o,d)):o.memoizedState!==null?(Ma(),o.child=r.child,o.flags|=128,o=null):(Ma(),K=p.fallback,N=o.mode,p=Zl({mode:"visible",children:p.children},N),K=dr(K,N,d,null),K.flags|=2,p.return=o,K.return=o,p.sibling=K,o.child=p,yr(o,r.child,null,d),p=o.child,p.memoizedState=Fu(d),p.childLanes=Bu(r,R,d),o.memoizedState=Uu,o=go(null,p));else if(Ra(o),Sh(K)){if(R=K.nextSibling&&K.nextSibling.dataset,R)var ge=R.dgst;R=ge,p=Error(a(419)),p.stack="",p.digest=R,so({value:p,source:null,stack:null}),o=zu(r,o,d)}else if(dn||zr(r,o,d,!1),R=(d&r.childLanes)!==0,dn||R){if(R=Ft,R!==null&&(p=fl(R,d),p!==0&&p!==re.retryLane))throw re.retryLane=p,cr(r,p),Vn(R,r,p),Ou;Nh(K)||lc(),o=zu(r,o,d)}else Nh(K)?(o.flags|=192,o.child=r.child,o=null):(r=re.treeContext,$t=gs(K.nextSibling),En=o,St=!0,Ea=null,ms=!1,r!==null&&Wm(o,r),o=Gu(o,p.children),o.flags|=4096);return o}return N?(Ma(),K=p.fallback,N=o.mode,re=r.child,ge=re.sibling,p=Xs(re,{mode:"hidden",children:p.children}),p.subtreeFlags=re.subtreeFlags&65011712,ge!==null?K=Xs(ge,K):(K=dr(K,N,d,null),K.flags|=2),K.return=o,p.return=o,p.sibling=K,o.child=p,go(null,p),p=o.child,K=r.child.memoizedState,K===null?K=Fu(d):(N=K.cachePool,N!==null?(re=ln._currentValue,N=N.parent!==re?{parent:re,pool:re}:N):N=ep(),K={baseLanes:K.baseLanes|d,cachePool:N}),p.memoizedState=K,p.childLanes=Bu(r,R,d),o.memoizedState=Uu,go(r.child,p)):(Ra(o),d=r.child,r=d.sibling,d=Xs(d,{mode:"visible",children:p.children}),d.return=o,d.sibling=null,r!==null&&(R=o.deletions,R===null?(o.deletions=[r],o.flags|=16):R.push(r)),o.child=d,o.memoizedState=null,d)}function Gu(r,o){return o=Zl({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function Zl(r,o){return r=Yn(22,r,null,o),r.lanes=0,r}function zu(r,o,d){return yr(o,r.child,null,d),r=Gu(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function fg(r,o,d){r.lanes|=o;var p=r.alternate;p!==null&&(p.lanes|=o),su(r.return,o,d)}function $u(r,o,d,p,N,w){var R=r.memoizedState;R===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:N,treeForkCount:w}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=p,R.tail=d,R.tailMode=N,R.treeForkCount=w)}function mg(r,o,d){var p=o.pendingProps,N=p.revealOrder,w=p.tail;p=p.children;var R=an.current,K=(R&2)!==0;if(K?(R=R&1|2,o.flags|=128):R&=1,ue(an,R),In(r,o,p,d),p=St?no:0,!K&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&fg(r,d,o);else if(r.tag===19)fg(r,d,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(N){case"forwards":for(d=o.child,N=null;d!==null;)r=d.alternate,r!==null&&Gl(r)===null&&(N=d),d=d.sibling;d=N,d===null?(N=o.child,o.child=null):(N=d.sibling,d.sibling=null),$u(o,!1,N,d,w,p);break;case"backwards":case"unstable_legacy-backwards":for(d=null,N=o.child,o.child=null;N!==null;){if(r=N.alternate,r!==null&&Gl(r)===null){o.child=N;break}r=N.sibling,N.sibling=d,d=N,N=r}$u(o,!0,d,null,w,p);break;case"together":$u(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function sa(r,o,d){if(r!==null&&(o.dependencies=r.dependencies),La|=o.lanes,(d&o.childLanes)===0)if(r!==null){if(zr(r,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(a(153));if(o.child!==null){for(r=o.child,d=Xs(r,r.pendingProps),o.child=d,d.return=o;r.sibling!==null;)r=r.sibling,d=d.sibling=Xs(r,r.pendingProps),d.return=o;d.sibling=null}return o.child}function Hu(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Rl(r)))}function CS(r,o,d){switch(o.tag){case 3:fe(o,o.stateNode.containerInfo),Ia(o,ln,r.memoizedState.cache),ur();break;case 27:case 5:ee(o);break;case 4:fe(o,o.stateNode.containerInfo);break;case 10:Ia(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,pu(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(Ra(o),o.flags|=128,null):(d&o.child.childLanes)!==0?hg(r,o,d):(Ra(o),r=sa(r,o,d),r!==null?r.sibling:null);Ra(o);break;case 19:var N=(r.flags&128)!==0;if(p=(d&o.childLanes)!==0,p||(zr(r,o,d,!1),p=(d&o.childLanes)!==0),N){if(p)return mg(r,o,d);o.flags|=128}if(N=o.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),ue(an,an.current),p)break;return null;case 22:return o.lanes=0,ig(r,o,d,o.pendingProps);case 24:Ia(o,ln,r.memoizedState.cache)}return sa(r,o,d)}function pg(r,o,d){if(r!==null)if(r.memoizedProps!==o.pendingProps)dn=!0;else{if(!Hu(r,d)&&(o.flags&128)===0)return dn=!1,CS(r,o,d);dn=(r.flags&131072)!==0}else dn=!1,St&&(o.flags&1048576)!==0&&Km(o,no,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(r=pr(o.elementType),o.type=r,typeof r=="function")Jd(r)?(p=vr(r,p),o.tag=1,o=dg(null,o,r,p,d)):(o.tag=0,o=Lu(null,o,r,p,d));else{if(r!=null){var N=r.$$typeof;if(N===A){o.tag=11,o=sg(null,o,r,p,d);break e}else if(N===P){o.tag=14,o=ag(null,o,r,p,d);break e}}throw o=Y(r)||r,Error(a(306,o,""))}}return o;case 0:return Lu(r,o,o.type,o.pendingProps,d);case 1:return p=o.type,N=vr(p,o.pendingProps),dg(r,o,p,N,d);case 3:e:{if(fe(o,o.stateNode.containerInfo),r===null)throw Error(a(387));p=o.pendingProps;var w=o.memoizedState;N=w.element,du(r,o),uo(o,p,null,d);var R=o.memoizedState;if(p=R.cache,Ia(o,ln,p),p!==w.cache&&au(o,[ln],d,!0),co(),p=R.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=w,o.memoizedState=w,o.flags&256){o=ug(r,o,p,d);break e}else if(p!==N){N=us(Error(a(424)),o),so(N),o=ug(r,o,p,d);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for($t=gs(r.firstChild),En=o,St=!0,Ea=null,ms=!0,d=ip(o,null,p,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(ur(),p===N){o=sa(r,o,d);break e}In(r,o,p,d)}o=o.child}return o;case 26:return Ql(r,o),r===null?(d=_y(o.type,null,o.pendingProps,null))?o.memoizedState=d:St||(d=o.type,r=o.pendingProps,p=pc(ne.current).createElement(d),p[on]=o,p[_n]=r,An(p,d,r),gn(p),o.stateNode=p):o.memoizedState=_y(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return ee(o),r===null&&St&&(p=o.stateNode=wy(o.type,o.pendingProps,ne.current),En=o,ms=!0,N=$t,za(o.type)?(wh=N,$t=gs(p.firstChild)):$t=N),In(r,o,o.pendingProps.children,d),Ql(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&St&&((N=p=$t)&&(p=aw(p,o.type,o.pendingProps,ms),p!==null?(o.stateNode=p,En=o,$t=gs(p.firstChild),ms=!1,N=!0):N=!1),N||Ca(o)),ee(o),N=o.type,w=o.pendingProps,R=r!==null?r.memoizedProps:null,p=w.children,xh(N,w)?p=null:R!==null&&xh(N,R)&&(o.flags|=32),o.memoizedState!==null&&(N=yu(r,o,vS,null,null,d),ko._currentValue=N),Ql(r,o),In(r,o,p,d),o.child;case 6:return r===null&&St&&((r=d=$t)&&(d=rw(d,o.pendingProps,ms),d!==null?(o.stateNode=d,En=o,$t=null,r=!0):r=!1),r||Ca(o)),null;case 13:return hg(r,o,d);case 4:return fe(o,o.stateNode.containerInfo),p=o.pendingProps,r===null?o.child=yr(o,null,p,d):In(r,o,p,d),o.child;case 11:return sg(r,o,o.type,o.pendingProps,d);case 7:return In(r,o,o.pendingProps,d),o.child;case 8:return In(r,o,o.pendingProps.children,d),o.child;case 12:return In(r,o,o.pendingProps.children,d),o.child;case 10:return p=o.pendingProps,Ia(o,o.type,p.value),In(r,o,p.children,d),o.child;case 9:return N=o.type._context,p=o.pendingProps.children,fr(o),N=Cn(N),p=p(N),o.flags|=1,In(r,o,p,d),o.child;case 14:return ag(r,o,o.type,o.pendingProps,d);case 15:return rg(r,o,o.type,o.pendingProps,d);case 19:return mg(r,o,d);case 31:return ES(r,o,d);case 22:return ig(r,o,d,o.pendingProps);case 24:return fr(o),p=Cn(ln),r===null?(N=ou(),N===null&&(N=Ft,w=ru(),N.pooledCache=w,w.refCount++,w!==null&&(N.pooledCacheLanes|=d),N=w),o.memoizedState={parent:p,cache:N},cu(o),Ia(o,ln,N)):((r.lanes&d)!==0&&(du(r,o),uo(o,null,null,d),co()),N=r.memoizedState,w=o.memoizedState,N.parent!==p?(N={parent:p,cache:p},o.memoizedState=N,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=N),Ia(o,ln,p)):(p=w.cache,Ia(o,ln,p),p!==N.cache&&au(o,[ln],d,!0))),In(r,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(a(156,o.tag))}function aa(r){r.flags|=4}function qu(r,o,d,p,N){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(N&335544128)===N)if(r.stateNode.complete)r.flags|=8192;else if(zg())r.flags|=8192;else throw gr=Ll,lu}else r.flags&=-16777217}function gg(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!ky(o))if(zg())r.flags|=8192;else throw gr=Ll,lu}function ec(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?dl():536870912,r.lanes|=o,ei|=o)}function yo(r,o){if(!St)switch(r.tailMode){case"hidden":o=r.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Ht(r){var o=r.alternate!==null&&r.alternate.child===r.child,d=0,p=0;if(o)for(var N=r.child;N!==null;)d|=N.lanes|N.childLanes,p|=N.subtreeFlags&65011712,p|=N.flags&65011712,N.return=r,N=N.sibling;else for(N=r.child;N!==null;)d|=N.lanes|N.childLanes,p|=N.subtreeFlags,p|=N.flags,N.return=r,N=N.sibling;return r.subtreeFlags|=p,r.childLanes=d,o}function IS(r,o,d){var p=o.pendingProps;switch(Zd(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(o),null;case 1:return Ht(o),null;case 3:return d=o.stateNode,p=null,r!==null&&(p=r.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),ea(ln),Z(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(Gr(o)?aa(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,tu())),Ht(o),null;case 26:var N=o.type,w=o.memoizedState;return r===null?(aa(o),w!==null?(Ht(o),gg(o,w)):(Ht(o),qu(o,N,null,p,d))):w?w!==r.memoizedState?(aa(o),Ht(o),gg(o,w)):(Ht(o),o.flags&=-16777217):(r=r.memoizedProps,r!==p&&aa(o),Ht(o),qu(o,N,r,p,d)),null;case 27:if(xe(o),d=ne.current,N=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==p&&aa(o);else{if(!p){if(o.stateNode===null)throw Error(a(166));return Ht(o),null}r=Ne.current,Gr(o)?Jm(o):(r=wy(N,p,d),o.stateNode=r,aa(o))}return Ht(o),null;case 5:if(xe(o),N=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==p&&aa(o);else{if(!p){if(o.stateNode===null)throw Error(a(166));return Ht(o),null}if(w=Ne.current,Gr(o))Jm(o);else{var R=pc(ne.current);switch(w){case 1:w=R.createElementNS("http://www.w3.org/2000/svg",N);break;case 2:w=R.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;default:switch(N){case"svg":w=R.createElementNS("http://www.w3.org/2000/svg",N);break;case"math":w=R.createElementNS("http://www.w3.org/1998/Math/MathML",N);break;case"script":w=R.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof p.is=="string"?R.createElement("select",{is:p.is}):R.createElement("select"),p.multiple?w.multiple=!0:p.size&&(w.size=p.size);break;default:w=typeof p.is=="string"?R.createElement(N,{is:p.is}):R.createElement(N)}}w[on]=o,w[_n]=p;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)w.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=w;e:switch(An(w,N,p),N){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&aa(o)}}return Ht(o),qu(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,d),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==p&&aa(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(a(166));if(r=ne.current,Gr(o)){if(r=o.stateNode,d=o.memoizedProps,p=null,N=En,N!==null)switch(N.tag){case 27:case 5:p=N.memoizedProps}r[on]=o,r=!!(r.nodeValue===d||p!==null&&p.suppressHydrationWarning===!0||hy(r.nodeValue,d)),r||Ca(o,!0)}else r=pc(r).createTextNode(p),r[on]=o,o.stateNode=r}return Ht(o),null;case 31:if(d=o.memoizedState,r===null||r.memoizedState!==null){if(p=Gr(o),d!==null){if(r===null){if(!p)throw Error(a(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(a(557));r[on]=o}else ur(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ht(o),r=!1}else d=tu(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return o.flags&256?(Qn(o),o):(Qn(o),null);if((o.flags&128)!==0)throw Error(a(558))}return Ht(o),null;case 13:if(p=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(N=Gr(o),p!==null&&p.dehydrated!==null){if(r===null){if(!N)throw Error(a(318));if(N=o.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(a(317));N[on]=o}else ur(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ht(o),N=!1}else N=tu(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=N),N=!0;if(!N)return o.flags&256?(Qn(o),o):(Qn(o),null)}return Qn(o),(o.flags&128)!==0?(o.lanes=d,o):(d=p!==null,r=r!==null&&r.memoizedState!==null,d&&(p=o.child,N=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(N=p.alternate.memoizedState.cachePool.pool),w=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(w=p.memoizedState.cachePool.pool),w!==N&&(p.flags|=2048)),d!==r&&d&&(o.child.flags|=8192),ec(o,o.updateQueue),Ht(o),null);case 4:return Z(),r===null&&fh(o.stateNode.containerInfo),Ht(o),null;case 10:return ea(o.type),Ht(o),null;case 19:if(ie(an),p=o.memoizedState,p===null)return Ht(o),null;if(N=(o.flags&128)!==0,w=p.rendering,w===null)if(N)yo(p,!1);else{if(nn!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(w=Gl(r),w!==null){for(o.flags|=128,yo(p,!1),r=w.updateQueue,o.updateQueue=r,ec(o,r),o.subtreeFlags=0,r=d,d=o.child;d!==null;)Hm(d,r),d=d.sibling;return ue(an,an.current&1|2),St&&Qs(o,p.treeForkCount),o.child}r=r.sibling}p.tail!==null&&ut()>rc&&(o.flags|=128,N=!0,yo(p,!1),o.lanes=4194304)}else{if(!N)if(r=Gl(w),r!==null){if(o.flags|=128,N=!0,r=r.updateQueue,o.updateQueue=r,ec(o,r),yo(p,!0),p.tail===null&&p.tailMode==="hidden"&&!w.alternate&&!St)return Ht(o),null}else 2*ut()-p.renderingStartTime>rc&&d!==536870912&&(o.flags|=128,N=!0,yo(p,!1),o.lanes=4194304);p.isBackwards?(w.sibling=o.child,o.child=w):(r=p.last,r!==null?r.sibling=w:o.child=w,p.last=w)}return p.tail!==null?(r=p.tail,p.rendering=r,p.tail=r.sibling,p.renderingStartTime=ut(),r.sibling=null,d=an.current,ue(an,N?d&1|2:d&1),St&&Qs(o,p.treeForkCount),r):(Ht(o),null);case 22:case 23:return Qn(o),mu(),p=o.memoizedState!==null,r!==null?r.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(d&536870912)!==0&&(o.flags&128)===0&&(Ht(o),o.subtreeFlags&6&&(o.flags|=8192)):Ht(o),d=o.updateQueue,d!==null&&ec(o,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==d&&(o.flags|=2048),r!==null&&ie(mr),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),ea(ln),Ht(o),null;case 25:return null;case 30:return null}throw Error(a(156,o.tag))}function AS(r,o){switch(Zd(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return ea(ln),Z(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return xe(o),null;case 31:if(o.memoizedState!==null){if(Qn(o),o.alternate===null)throw Error(a(340));ur()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(Qn(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(a(340));ur()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return ie(an),null;case 4:return Z(),null;case 10:return ea(o.type),null;case 22:case 23:return Qn(o),mu(),r!==null&&ie(mr),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return ea(ln),null;case 25:return null;default:return null}}function yg(r,o){switch(Zd(o),o.tag){case 3:ea(ln),Z();break;case 26:case 27:case 5:xe(o);break;case 4:Z();break;case 31:o.memoizedState!==null&&Qn(o);break;case 13:Qn(o);break;case 19:ie(an);break;case 10:ea(o.type);break;case 22:case 23:Qn(o),mu(),r!==null&&ie(mr);break;case 24:ea(ln)}}function xo(r,o){try{var d=o.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var N=p.next;d=N;do{if((d.tag&r)===r){p=void 0;var w=d.create,R=d.inst;p=w(),R.destroy=p}d=d.next}while(d!==N)}}catch(K){Rt(o,o.return,K)}}function Pa(r,o,d){try{var p=o.updateQueue,N=p!==null?p.lastEffect:null;if(N!==null){var w=N.next;p=w;do{if((p.tag&r)===r){var R=p.inst,K=R.destroy;if(K!==void 0){R.destroy=void 0,N=o;var re=d,ge=K;try{ge()}catch(Ee){Rt(N,re,Ee)}}}p=p.next}while(p!==w)}}catch(Ee){Rt(o,o.return,Ee)}}function xg(r){var o=r.updateQueue;if(o!==null){var d=r.stateNode;try{lp(o,d)}catch(p){Rt(r,r.return,p)}}}function vg(r,o,d){d.props=vr(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(p){Rt(r,o,p)}}function vo(r,o){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var p=r.stateNode;break;case 30:p=r.stateNode;break;default:p=r.stateNode}typeof d=="function"?r.refCleanup=d(p):d.current=p}}catch(N){Rt(r,o,N)}}function zs(r,o){var d=r.ref,p=r.refCleanup;if(d!==null)if(typeof p=="function")try{p()}catch(N){Rt(r,o,N)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(N){Rt(r,o,N)}else d.current=null}function bg(r){var o=r.type,d=r.memoizedProps,p=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&p.focus();break e;case"img":d.src?p.src=d.src:d.srcSet&&(p.srcset=d.srcSet)}}catch(N){Rt(r,r.return,N)}}function Vu(r,o,d){try{var p=r.stateNode;QS(p,r.type,d,o),p[_n]=o}catch(N){Rt(r,r.return,N)}}function Ng(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&za(r.type)||r.tag===4}function Ku(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Ng(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&za(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Wu(r,o,d){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(r),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Kt));else if(p!==4&&(p===27&&za(r.type)&&(d=r.stateNode,o=null),r=r.child,r!==null))for(Wu(r,o,d),r=r.sibling;r!==null;)Wu(r,o,d),r=r.sibling}function tc(r,o,d){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?d.insertBefore(r,o):d.appendChild(r);else if(p!==4&&(p===27&&za(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(tc(r,o,d),r=r.sibling;r!==null;)tc(r,o,d),r=r.sibling}function Sg(r){var o=r.stateNode,d=r.memoizedProps;try{for(var p=r.type,N=o.attributes;N.length;)o.removeAttributeNode(N[0]);An(o,p,d),o[on]=r,o[_n]=d}catch(w){Rt(r,r.return,w)}}var ra=!1,un=!1,Ju=!1,wg=typeof WeakSet=="function"?WeakSet:Set,Nn=null;function kS(r,o){if(r=r.containerInfo,gh=Sc,r=Pm(r),zd(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var p=d.getSelection&&d.getSelection();if(p&&p.rangeCount!==0){d=p.anchorNode;var N=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{d.nodeType,w.nodeType}catch{d=null;break e}var R=0,K=-1,re=-1,ge=0,Ee=0,Ie=r,ve=null;t:for(;;){for(var Te;Ie!==d||N!==0&&Ie.nodeType!==3||(K=R+N),Ie!==w||p!==0&&Ie.nodeType!==3||(re=R+p),Ie.nodeType===3&&(R+=Ie.nodeValue.length),(Te=Ie.firstChild)!==null;)ve=Ie,Ie=Te;for(;;){if(Ie===r)break t;if(ve===d&&++ge===N&&(K=R),ve===w&&++Ee===p&&(re=R),(Te=Ie.nextSibling)!==null)break;Ie=ve,ve=Ie.parentNode}Ie=Te}d=K===-1||re===-1?null:{start:K,end:re}}else d=null}d=d||{start:0,end:0}}else d=null;for(yh={focusedElem:r,selectionRange:d},Sc=!1,Nn=o;Nn!==null;)if(o=Nn,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,Nn=r;else for(;Nn!==null;){switch(o=Nn,w=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)N=r[d],N.ref.impl=N.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&w!==null){r=void 0,d=o,N=w.memoizedProps,w=w.memoizedState,p=d.stateNode;try{var We=vr(d.type,N);r=p.getSnapshotBeforeUpdate(We,w),p.__reactInternalSnapshotBeforeUpdate=r}catch(st){Rt(d,d.return,st)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,d=r.nodeType,d===9)bh(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":bh(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(a(163))}if(r=o.sibling,r!==null){r.return=o.return,Nn=r;break}Nn=o.return}}function Tg(r,o,d){var p=d.flags;switch(d.tag){case 0:case 11:case 15:oa(r,d),p&4&&xo(5,d);break;case 1:if(oa(r,d),p&4)if(r=d.stateNode,o===null)try{r.componentDidMount()}catch(R){Rt(d,d.return,R)}else{var N=vr(d.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(N,o,r.__reactInternalSnapshotBeforeUpdate)}catch(R){Rt(d,d.return,R)}}p&64&&xg(d),p&512&&vo(d,d.return);break;case 3:if(oa(r,d),p&64&&(r=d.updateQueue,r!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{lp(r,o)}catch(R){Rt(d,d.return,R)}}break;case 27:o===null&&p&4&&Sg(d);case 26:case 5:oa(r,d),o===null&&p&4&&bg(d),p&512&&vo(d,d.return);break;case 12:oa(r,d);break;case 31:oa(r,d),p&4&&Eg(r,d);break;case 13:oa(r,d),p&4&&Cg(r,d),p&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=BS.bind(null,d),iw(r,d))));break;case 22:if(p=d.memoizedState!==null||ra,!p){o=o!==null&&o.memoizedState!==null||un,N=ra;var w=un;ra=p,(un=o)&&!w?la(r,d,(d.subtreeFlags&8772)!==0):oa(r,d),ra=N,un=w}break;case 30:break;default:oa(r,d)}}function jg(r){var o=r.alternate;o!==null&&(r.alternate=null,jg(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&gl(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var qt=null,zn=!1;function ia(r,o,d){for(d=d.child;d!==null;)_g(r,o,d),d=d.sibling}function _g(r,o,d){if($e&&typeof $e.onCommitFiberUnmount=="function")try{$e.onCommitFiberUnmount(Je,d)}catch{}switch(d.tag){case 26:un||zs(d,o),ia(r,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:un||zs(d,o);var p=qt,N=zn;za(d.type)&&(qt=d.stateNode,zn=!1),ia(r,o,d),Co(d.stateNode),qt=p,zn=N;break;case 5:un||zs(d,o);case 6:if(p=qt,N=zn,qt=null,ia(r,o,d),qt=p,zn=N,qt!==null)if(zn)try{(qt.nodeType===9?qt.body:qt.nodeName==="HTML"?qt.ownerDocument.body:qt).removeChild(d.stateNode)}catch(w){Rt(d,o,w)}else try{qt.removeChild(d.stateNode)}catch(w){Rt(d,o,w)}break;case 18:qt!==null&&(zn?(r=qt,xy(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),li(r)):xy(qt,d.stateNode));break;case 4:p=qt,N=zn,qt=d.stateNode.containerInfo,zn=!0,ia(r,o,d),qt=p,zn=N;break;case 0:case 11:case 14:case 15:Pa(2,d,o),un||Pa(4,d,o),ia(r,o,d);break;case 1:un||(zs(d,o),p=d.stateNode,typeof p.componentWillUnmount=="function"&&vg(d,o,p)),ia(r,o,d);break;case 21:ia(r,o,d);break;case 22:un=(p=un)||d.memoizedState!==null,ia(r,o,d),un=p;break;default:ia(r,o,d)}}function Eg(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{li(r)}catch(d){Rt(o,o.return,d)}}}function Cg(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{li(r)}catch(d){Rt(o,o.return,d)}}function DS(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new wg),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new wg),o;default:throw Error(a(435,r.tag))}}function nc(r,o){var d=DS(r);o.forEach(function(p){if(!d.has(p)){d.add(p);var N=GS.bind(null,r,p);p.then(N,N)}})}function $n(r,o){var d=o.deletions;if(d!==null)for(var p=0;p<d.length;p++){var N=d[p],w=r,R=o,K=R;e:for(;K!==null;){switch(K.tag){case 27:if(za(K.type)){qt=K.stateNode,zn=!1;break e}break;case 5:qt=K.stateNode,zn=!1;break e;case 3:case 4:qt=K.stateNode.containerInfo,zn=!0;break e}K=K.return}if(qt===null)throw Error(a(160));_g(w,R,N),qt=null,zn=!1,w=N.alternate,w!==null&&(w.return=null),N.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Ig(o,r),o=o.sibling}var Ts=null;function Ig(r,o){var d=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:$n(o,r),Hn(r),p&4&&(Pa(3,r,r.return),xo(3,r),Pa(5,r,r.return));break;case 1:$n(o,r),Hn(r),p&512&&(un||d===null||zs(d,d.return)),p&64&&ra&&(r=r.updateQueue,r!==null&&(p=r.callbacks,p!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?p:d.concat(p))));break;case 26:var N=Ts;if($n(o,r),Hn(r),p&512&&(un||d===null||zs(d,d.return)),p&4){var w=d!==null?d.memoizedState:null;if(p=r.memoizedState,d===null)if(p===null)if(r.stateNode===null){e:{p=r.type,d=r.memoizedProps,N=N.ownerDocument||N;t:switch(p){case"title":w=N.getElementsByTagName("title")[0],(!w||w[Dr]||w[on]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=N.createElement(p),N.head.insertBefore(w,N.querySelector("head > title"))),An(w,p,d),w[on]=r,gn(w),p=w;break e;case"link":var R=Iy("link","href",N).get(p+(d.href||""));if(R){for(var K=0;K<R.length;K++)if(w=R[K],w.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&w.getAttribute("rel")===(d.rel==null?null:d.rel)&&w.getAttribute("title")===(d.title==null?null:d.title)&&w.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){R.splice(K,1);break t}}w=N.createElement(p),An(w,p,d),N.head.appendChild(w);break;case"meta":if(R=Iy("meta","content",N).get(p+(d.content||""))){for(K=0;K<R.length;K++)if(w=R[K],w.getAttribute("content")===(d.content==null?null:""+d.content)&&w.getAttribute("name")===(d.name==null?null:d.name)&&w.getAttribute("property")===(d.property==null?null:d.property)&&w.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&w.getAttribute("charset")===(d.charSet==null?null:d.charSet)){R.splice(K,1);break t}}w=N.createElement(p),An(w,p,d),N.head.appendChild(w);break;default:throw Error(a(468,p))}w[on]=r,gn(w),p=w}r.stateNode=p}else Ay(N,r.type,r.stateNode);else r.stateNode=Cy(N,p,r.memoizedProps);else w!==p?(w===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):w.count--,p===null?Ay(N,r.type,r.stateNode):Cy(N,p,r.memoizedProps)):p===null&&r.stateNode!==null&&Vu(r,r.memoizedProps,d.memoizedProps)}break;case 27:$n(o,r),Hn(r),p&512&&(un||d===null||zs(d,d.return)),d!==null&&p&4&&Vu(r,r.memoizedProps,d.memoizedProps);break;case 5:if($n(o,r),Hn(r),p&512&&(un||d===null||zs(d,d.return)),r.flags&32){N=r.stateNode;try{V(N,"")}catch(We){Rt(r,r.return,We)}}p&4&&r.stateNode!=null&&(N=r.memoizedProps,Vu(r,N,d!==null?d.memoizedProps:N)),p&1024&&(Ju=!0);break;case 6:if($n(o,r),Hn(r),p&4){if(r.stateNode===null)throw Error(a(162));p=r.memoizedProps,d=r.stateNode;try{d.nodeValue=p}catch(We){Rt(r,r.return,We)}}break;case 3:if(xc=null,N=Ts,Ts=gc(o.containerInfo),$n(o,r),Ts=N,Hn(r),p&4&&d!==null&&d.memoizedState.isDehydrated)try{li(o.containerInfo)}catch(We){Rt(r,r.return,We)}Ju&&(Ju=!1,Ag(r));break;case 4:p=Ts,Ts=gc(r.stateNode.containerInfo),$n(o,r),Hn(r),Ts=p;break;case 12:$n(o,r),Hn(r);break;case 31:$n(o,r),Hn(r),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,nc(r,p)));break;case 13:$n(o,r),Hn(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(ac=ut()),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,nc(r,p)));break;case 22:N=r.memoizedState!==null;var re=d!==null&&d.memoizedState!==null,ge=ra,Ee=un;if(ra=ge||N,un=Ee||re,$n(o,r),un=Ee,ra=ge,Hn(r),p&8192)e:for(o=r.stateNode,o._visibility=N?o._visibility&-2:o._visibility|1,N&&(d===null||re||ra||un||br(r)),d=null,o=r;;){if(o.tag===5||o.tag===26){if(d===null){re=d=o;try{if(w=re.stateNode,N)R=w.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{K=re.stateNode;var Ie=re.memoizedProps.style,ve=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;K.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(We){Rt(re,re.return,We)}}}else if(o.tag===6){if(d===null){re=o;try{re.stateNode.nodeValue=N?"":re.memoizedProps}catch(We){Rt(re,re.return,We)}}}else if(o.tag===18){if(d===null){re=o;try{var Te=re.stateNode;N?vy(Te,!0):vy(re.stateNode,!1)}catch(We){Rt(re,re.return,We)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=r.updateQueue,p!==null&&(d=p.retryQueue,d!==null&&(p.retryQueue=null,nc(r,d))));break;case 19:$n(o,r),Hn(r),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,nc(r,p)));break;case 30:break;case 21:break;default:$n(o,r),Hn(r)}}function Hn(r){var o=r.flags;if(o&2){try{for(var d,p=r.return;p!==null;){if(Ng(p)){d=p;break}p=p.return}if(d==null)throw Error(a(160));switch(d.tag){case 27:var N=d.stateNode,w=Ku(r);tc(r,w,N);break;case 5:var R=d.stateNode;d.flags&32&&(V(R,""),d.flags&=-33);var K=Ku(r);tc(r,K,R);break;case 3:case 4:var re=d.stateNode.containerInfo,ge=Ku(r);Wu(r,ge,re);break;default:throw Error(a(161))}}catch(Ee){Rt(r,r.return,Ee)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function Ag(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;Ag(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function oa(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Tg(r,o.alternate,o),o=o.sibling}function br(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Pa(4,o,o.return),br(o);break;case 1:zs(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&vg(o,o.return,d),br(o);break;case 27:Co(o.stateNode);case 26:case 5:zs(o,o.return),br(o);break;case 22:o.memoizedState===null&&br(o);break;case 30:br(o);break;default:br(o)}r=r.sibling}}function la(r,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,N=r,w=o,R=w.flags;switch(w.tag){case 0:case 11:case 15:la(N,w,d),xo(4,w);break;case 1:if(la(N,w,d),p=w,N=p.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(ge){Rt(p,p.return,ge)}if(p=w,N=p.updateQueue,N!==null){var K=p.stateNode;try{var re=N.shared.hiddenCallbacks;if(re!==null)for(N.shared.hiddenCallbacks=null,N=0;N<re.length;N++)op(re[N],K)}catch(ge){Rt(p,p.return,ge)}}d&&R&64&&xg(w),vo(w,w.return);break;case 27:Sg(w);case 26:case 5:la(N,w,d),d&&p===null&&R&4&&bg(w),vo(w,w.return);break;case 12:la(N,w,d);break;case 31:la(N,w,d),d&&R&4&&Eg(N,w);break;case 13:la(N,w,d),d&&R&4&&Cg(N,w);break;case 22:w.memoizedState===null&&la(N,w,d),vo(w,w.return);break;case 30:break;default:la(N,w,d)}o=o.sibling}}function Yu(r,o){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&ao(d))}function Xu(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&ao(r))}function js(r,o,d,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)kg(r,o,d,p),o=o.sibling}function kg(r,o,d,p){var N=o.flags;switch(o.tag){case 0:case 11:case 15:js(r,o,d,p),N&2048&&xo(9,o);break;case 1:js(r,o,d,p);break;case 3:js(r,o,d,p),N&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&ao(r)));break;case 12:if(N&2048){js(r,o,d,p),r=o.stateNode;try{var w=o.memoizedProps,R=w.id,K=w.onPostCommit;typeof K=="function"&&K(R,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(re){Rt(o,o.return,re)}}else js(r,o,d,p);break;case 31:js(r,o,d,p);break;case 13:js(r,o,d,p);break;case 23:break;case 22:w=o.stateNode,R=o.alternate,o.memoizedState!==null?w._visibility&2?js(r,o,d,p):bo(r,o):w._visibility&2?js(r,o,d,p):(w._visibility|=2,Xr(r,o,d,p,(o.subtreeFlags&10256)!==0||!1)),N&2048&&Yu(R,o);break;case 24:js(r,o,d,p),N&2048&&Xu(o.alternate,o);break;default:js(r,o,d,p)}}function Xr(r,o,d,p,N){for(N=N&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var w=r,R=o,K=d,re=p,ge=R.flags;switch(R.tag){case 0:case 11:case 15:Xr(w,R,K,re,N),xo(8,R);break;case 23:break;case 22:var Ee=R.stateNode;R.memoizedState!==null?Ee._visibility&2?Xr(w,R,K,re,N):bo(w,R):(Ee._visibility|=2,Xr(w,R,K,re,N)),N&&ge&2048&&Yu(R.alternate,R);break;case 24:Xr(w,R,K,re,N),N&&ge&2048&&Xu(R.alternate,R);break;default:Xr(w,R,K,re,N)}o=o.sibling}}function bo(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=r,p=o,N=p.flags;switch(p.tag){case 22:bo(d,p),N&2048&&Yu(p.alternate,p);break;case 24:bo(d,p),N&2048&&Xu(p.alternate,p);break;default:bo(d,p)}o=o.sibling}}var No=8192;function Qr(r,o,d){if(r.subtreeFlags&No)for(r=r.child;r!==null;)Dg(r,o,d),r=r.sibling}function Dg(r,o,d){switch(r.tag){case 26:Qr(r,o,d),r.flags&No&&r.memoizedState!==null&&xw(d,Ts,r.memoizedState,r.memoizedProps);break;case 5:Qr(r,o,d);break;case 3:case 4:var p=Ts;Ts=gc(r.stateNode.containerInfo),Qr(r,o,d),Ts=p;break;case 22:r.memoizedState===null&&(p=r.alternate,p!==null&&p.memoizedState!==null?(p=No,No=16777216,Qr(r,o,d),No=p):Qr(r,o,d));break;default:Qr(r,o,d)}}function Rg(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function So(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var p=o[d];Nn=p,Pg(p,r)}Rg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Mg(r),r=r.sibling}function Mg(r){switch(r.tag){case 0:case 11:case 15:So(r),r.flags&2048&&Pa(9,r,r.return);break;case 3:So(r);break;case 12:So(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,sc(r)):So(r);break;default:So(r)}}function sc(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var p=o[d];Nn=p,Pg(p,r)}Rg(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Pa(8,o,o.return),sc(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,sc(o));break;default:sc(o)}r=r.sibling}}function Pg(r,o){for(;Nn!==null;){var d=Nn;switch(d.tag){case 0:case 11:case 15:Pa(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var p=d.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:ao(d.memoizedState.cache)}if(p=d.child,p!==null)p.return=d,Nn=p;else e:for(d=r;Nn!==null;){p=Nn;var N=p.sibling,w=p.return;if(jg(p),p===d){Nn=null;break e}if(N!==null){N.return=w,Nn=N;break e}Nn=w}}}var RS={getCacheForType:function(r){var o=Cn(ln),d=o.data.get(r);return d===void 0&&(d=r(),o.data.set(r,d)),d},cacheSignal:function(){return Cn(ln).controller.signal}},MS=typeof WeakMap=="function"?WeakMap:Map,It=0,Ft=null,yt=null,bt=0,Dt=0,Zn=null,Oa=!1,Zr=!1,Qu=!1,ca=0,nn=0,La=0,Nr=0,Zu=0,es=0,ei=0,wo=null,qn=null,eh=!1,ac=0,Og=0,rc=1/0,ic=null,Ua=null,yn=0,Fa=null,ti=null,da=0,th=0,nh=null,Lg=null,To=0,sh=null;function ts(){return(It&2)!==0&&bt!==0?bt&-bt:G.T!==null?ch():ml()}function Ug(){if(es===0)if((bt&536870912)===0||St){var r=Os;Os<<=1,(Os&3932160)===0&&(Os=262144),es=r}else es=536870912;return r=Xn.current,r!==null&&(r.flags|=32),es}function Vn(r,o,d){(r===Ft&&(Dt===2||Dt===9)||r.cancelPendingCommit!==null)&&(ni(r,0),Ba(r,bt,es,!1)),tr(r,d),((It&2)===0||r!==Ft)&&(r===Ft&&((It&2)===0&&(Nr|=d),nn===4&&Ba(r,bt,es,!1)),$s(r))}function Fg(r,o,d){if((It&6)!==0)throw Error(a(327));var p=!d&&(o&127)===0&&(o&r.expiredLanes)===0||Ls(r,o),N=p?LS(r,o):rh(r,o,!0),w=p;do{if(N===0){Zr&&!p&&Ba(r,o,0,!1);break}else{if(d=r.current.alternate,w&&!PS(d)){N=rh(r,o,!1),w=!1;continue}if(N===2){if(w=o,r.errorRecoveryDisabledLanes&w)var R=0;else R=r.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var K=r;N=wo;var re=K.current.memoizedState.isDehydrated;if(re&&(ni(K,R).flags|=256),R=rh(K,R,!1),R!==2){if(Qu&&!re){K.errorRecoveryDisabledLanes|=w,Nr|=w,N=4;break e}w=qn,qn=N,w!==null&&(qn===null?qn=w:qn.push.apply(qn,w))}N=R}if(w=!1,N!==2)continue}}if(N===1){ni(r,0),Ba(r,o,0,!0);break}e:{switch(p=r,w=N,w){case 0:case 1:throw Error(a(345));case 4:if((o&4194048)!==o)break;case 6:Ba(p,o,es,!Oa);break e;case 2:qn=null;break;case 3:case 5:break;default:throw Error(a(329))}if((o&62914560)===o&&(N=ac+300-ut(),10<N)){if(Ba(p,o,es,!Oa),Na(p,0,!0)!==0)break e;da=o,p.timeoutHandle=gy(Bg.bind(null,p,d,qn,ic,eh,o,es,Nr,ei,Oa,w,"Throttled",-0,0),N);break e}Bg(p,d,qn,ic,eh,o,es,Nr,ei,Oa,w,null,-0,0)}}break}while(!0);$s(r)}function Bg(r,o,d,p,N,w,R,K,re,ge,Ee,Ie,ve,Te){if(r.timeoutHandle=-1,Ie=o.subtreeFlags,Ie&8192||(Ie&16785408)===16785408){Ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Kt},Dg(o,w,Ie);var We=(w&62914560)===w?ac-ut():(w&4194048)===w?Og-ut():0;if(We=vw(Ie,We),We!==null){da=w,r.cancelPendingCommit=We(Wg.bind(null,r,o,w,d,p,N,R,K,re,Ee,Ie,null,ve,Te)),Ba(r,w,R,!ge);return}}Wg(r,o,w,d,p,N,R,K,re)}function PS(r){for(var o=r;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var p=0;p<d.length;p++){var N=d[p],w=N.getSnapshot;N=N.value;try{if(!Jn(w(),N))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ba(r,o,d,p){o&=~Zu,o&=~Nr,r.suspendedLanes|=o,r.pingedLanes&=~o,p&&(r.warmLanes|=o),p=r.expirationTimes;for(var N=o;0<N;){var w=31-it(N),R=1<<w;p[w]=-1,N&=~R}d!==0&&ul(r,d,o)}function oc(){return(It&6)===0?(jo(0),!1):!0}function ah(){if(yt!==null){if(Dt===0)var r=yt.return;else r=yt,Zs=hr=null,bu(r),Vr=null,io=0,r=yt;for(;r!==null;)yg(r.alternate,r),r=r.return;yt=null}}function ni(r,o){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,tw(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),da=0,ah(),Ft=r,yt=d=Xs(r.current,null),bt=o,Dt=0,Zn=null,Oa=!1,Zr=Ls(r,o),Qu=!1,ei=es=Zu=Nr=La=nn=0,qn=wo=null,eh=!1,(o&8)!==0&&(o|=o&32);var p=r.entangledLanes;if(p!==0)for(r=r.entanglements,p&=o;0<p;){var N=31-it(p),w=1<<N;o|=r[N],p&=~w}return ca=o,Cl(),d}function Gg(r,o){ht=null,G.H=po,o===qr||o===Ol?(o=sp(),Dt=3):o===lu?(o=sp(),Dt=4):Dt=o===Ou?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Zn=o,yt===null&&(nn=1,Yl(r,us(o,r.current)))}function zg(){var r=Xn.current;return r===null?!0:(bt&4194048)===bt?ps===null:(bt&62914560)===bt||(bt&536870912)!==0?r===ps:!1}function $g(){var r=G.H;return G.H=po,r===null?po:r}function Hg(){var r=G.A;return G.A=RS,r}function lc(){nn=4,Oa||(bt&4194048)!==bt&&Xn.current!==null||(Zr=!0),(La&134217727)===0&&(Nr&134217727)===0||Ft===null||Ba(Ft,bt,es,!1)}function rh(r,o,d){var p=It;It|=2;var N=$g(),w=Hg();(Ft!==r||bt!==o)&&(ic=null,ni(r,o)),o=!1;var R=nn;e:do try{if(Dt!==0&&yt!==null){var K=yt,re=Zn;switch(Dt){case 8:ah(),R=6;break e;case 3:case 2:case 9:case 6:Xn.current===null&&(o=!0);var ge=Dt;if(Dt=0,Zn=null,si(r,K,re,ge),d&&Zr){R=0;break e}break;default:ge=Dt,Dt=0,Zn=null,si(r,K,re,ge)}}OS(),R=nn;break}catch(Ee){Gg(r,Ee)}while(!0);return o&&r.shellSuspendCounter++,Zs=hr=null,It=p,G.H=N,G.A=w,yt===null&&(Ft=null,bt=0,Cl()),R}function OS(){for(;yt!==null;)qg(yt)}function LS(r,o){var d=It;It|=2;var p=$g(),N=Hg();Ft!==r||bt!==o?(ic=null,rc=ut()+500,ni(r,o)):Zr=Ls(r,o);e:do try{if(Dt!==0&&yt!==null){o=yt;var w=Zn;t:switch(Dt){case 1:Dt=0,Zn=null,si(r,o,w,1);break;case 2:case 9:if(tp(w)){Dt=0,Zn=null,Vg(o);break}o=function(){Dt!==2&&Dt!==9||Ft!==r||(Dt=7),$s(r)},w.then(o,o);break e;case 3:Dt=7;break e;case 4:Dt=5;break e;case 7:tp(w)?(Dt=0,Zn=null,Vg(o)):(Dt=0,Zn=null,si(r,o,w,7));break;case 5:var R=null;switch(yt.tag){case 26:R=yt.memoizedState;case 5:case 27:var K=yt;if(R?ky(R):K.stateNode.complete){Dt=0,Zn=null;var re=K.sibling;if(re!==null)yt=re;else{var ge=K.return;ge!==null?(yt=ge,cc(ge)):yt=null}break t}}Dt=0,Zn=null,si(r,o,w,5);break;case 6:Dt=0,Zn=null,si(r,o,w,6);break;case 8:ah(),nn=6;break e;default:throw Error(a(462))}}US();break}catch(Ee){Gg(r,Ee)}while(!0);return Zs=hr=null,G.H=p,G.A=N,It=d,yt!==null?0:(Ft=null,bt=0,Cl(),nn)}function US(){for(;yt!==null&&!et();)qg(yt)}function qg(r){var o=pg(r.alternate,r,ca);r.memoizedProps=r.pendingProps,o===null?cc(r):yt=o}function Vg(r){var o=r,d=o.alternate;switch(o.tag){case 15:case 0:o=cg(d,o,o.pendingProps,o.type,void 0,bt);break;case 11:o=cg(d,o,o.pendingProps,o.type.render,o.ref,bt);break;case 5:bu(o);default:yg(d,o),o=yt=Hm(o,ca),o=pg(d,o,ca)}r.memoizedProps=r.pendingProps,o===null?cc(r):yt=o}function si(r,o,d,p){Zs=hr=null,bu(o),Vr=null,io=0;var N=o.return;try{if(_S(r,N,o,d,bt)){nn=1,Yl(r,us(d,r.current)),yt=null;return}}catch(w){if(N!==null)throw yt=N,w;nn=1,Yl(r,us(d,r.current)),yt=null;return}o.flags&32768?(St||p===1?r=!0:Zr||(bt&536870912)!==0?r=!1:(Oa=r=!0,(p===2||p===9||p===3||p===6)&&(p=Xn.current,p!==null&&p.tag===13&&(p.flags|=16384))),Kg(o,r)):cc(o)}function cc(r){var o=r;do{if((o.flags&32768)!==0){Kg(o,Oa);return}r=o.return;var d=IS(o.alternate,o,ca);if(d!==null){yt=d;return}if(o=o.sibling,o!==null){yt=o;return}yt=o=r}while(o!==null);nn===0&&(nn=5)}function Kg(r,o){do{var d=AS(r.alternate,r);if(d!==null){d.flags&=32767,yt=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(r=r.sibling,r!==null)){yt=r;return}yt=r=d}while(r!==null);nn=6,yt=null}function Wg(r,o,d,p,N,w,R,K,re){r.cancelPendingCommit=null;do dc();while(yn!==0);if((It&6)!==0)throw Error(a(327));if(o!==null){if(o===r.current)throw Error(a(177));if(w=o.lanes|o.childLanes,w|=Kd,Td(r,d,w,R,K,re),r===Ft&&(yt=Ft=null,bt=0),ti=o,Fa=r,da=d,th=w,nh=N,Lg=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,zS(Yt,function(){return Zg(),null})):(r.callbackNode=null,r.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=G.T,G.T=null,N=B.p,B.p=2,R=It,It|=4;try{kS(r,o,d)}finally{It=R,B.p=N,G.T=p}}yn=1,Jg(),Yg(),Xg()}}function Jg(){if(yn===1){yn=0;var r=Fa,o=ti,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=G.T,G.T=null;var p=B.p;B.p=2;var N=It;It|=4;try{Ig(o,r);var w=yh,R=Pm(r.containerInfo),K=w.focusedElem,re=w.selectionRange;if(R!==K&&K&&K.ownerDocument&&Mm(K.ownerDocument.documentElement,K)){if(re!==null&&zd(K)){var ge=re.start,Ee=re.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in K)K.selectionStart=ge,K.selectionEnd=Math.min(Ee,K.value.length);else{var Ie=K.ownerDocument||document,ve=Ie&&Ie.defaultView||window;if(ve.getSelection){var Te=ve.getSelection(),We=K.textContent.length,st=Math.min(re.start,We),Ot=re.end===void 0?st:Math.min(re.end,We);!Te.extend&&st>Ot&&(R=Ot,Ot=st,st=R);var he=Rm(K,st),ce=Rm(K,Ot);if(he&&ce&&(Te.rangeCount!==1||Te.anchorNode!==he.node||Te.anchorOffset!==he.offset||Te.focusNode!==ce.node||Te.focusOffset!==ce.offset)){var pe=Ie.createRange();pe.setStart(he.node,he.offset),Te.removeAllRanges(),st>Ot?(Te.addRange(pe),Te.extend(ce.node,ce.offset)):(pe.setEnd(ce.node,ce.offset),Te.addRange(pe))}}}}for(Ie=[],Te=K;Te=Te.parentNode;)Te.nodeType===1&&Ie.push({element:Te,left:Te.scrollLeft,top:Te.scrollTop});for(typeof K.focus=="function"&&K.focus(),K=0;K<Ie.length;K++){var Ce=Ie[K];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}Sc=!!gh,yh=gh=null}finally{It=N,B.p=p,G.T=d}}r.current=o,yn=2}}function Yg(){if(yn===2){yn=0;var r=Fa,o=ti,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=G.T,G.T=null;var p=B.p;B.p=2;var N=It;It|=4;try{Tg(r,o.alternate,o)}finally{It=N,B.p=p,G.T=d}}yn=3}}function Xg(){if(yn===4||yn===3){yn=0,At();var r=Fa,o=ti,d=da,p=Lg;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?yn=5:(yn=0,ti=Fa=null,Qg(r,r.pendingLanes));var N=r.pendingLanes;if(N===0&&(Ua=null),Gi(d),o=o.stateNode,$e&&typeof $e.onCommitFiberRoot=="function")try{$e.onCommitFiberRoot(Je,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=G.T,N=B.p,B.p=2,G.T=null;try{for(var w=r.onRecoverableError,R=0;R<p.length;R++){var K=p[R];w(K.value,{componentStack:K.stack})}}finally{G.T=o,B.p=N}}(da&3)!==0&&dc(),$s(r),N=r.pendingLanes,(d&261930)!==0&&(N&42)!==0?r===sh?To++:(To=0,sh=r):To=0,jo(0)}}function Qg(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,ao(o)))}function dc(){return Jg(),Yg(),Xg(),Zg()}function Zg(){if(yn!==5)return!1;var r=Fa,o=th;th=0;var d=Gi(da),p=G.T,N=B.p;try{B.p=32>d?32:d,G.T=null,d=nh,nh=null;var w=Fa,R=da;if(yn=0,ti=Fa=null,da=0,(It&6)!==0)throw Error(a(331));var K=It;if(It|=4,Mg(w.current),kg(w,w.current,R,d),It=K,jo(0,!1),$e&&typeof $e.onPostCommitFiberRoot=="function")try{$e.onPostCommitFiberRoot(Je,w)}catch{}return!0}finally{B.p=N,G.T=p,Qg(r,o)}}function ey(r,o,d){o=us(d,o),o=Pu(r.stateNode,o,2),r=Da(r,o,2),r!==null&&(tr(r,2),$s(r))}function Rt(r,o,d){if(r.tag===3)ey(r,r,d);else for(;o!==null;){if(o.tag===3){ey(o,r,d);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ua===null||!Ua.has(p))){r=us(d,r),d=tg(2),p=Da(o,d,2),p!==null&&(ng(d,p,o,r),tr(p,2),$s(p));break}}o=o.return}}function ih(r,o,d){var p=r.pingCache;if(p===null){p=r.pingCache=new MS;var N=new Set;p.set(o,N)}else N=p.get(o),N===void 0&&(N=new Set,p.set(o,N));N.has(d)||(Qu=!0,N.add(d),r=FS.bind(null,r,o,d),o.then(r,r))}function FS(r,o,d){var p=r.pingCache;p!==null&&p.delete(o),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,Ft===r&&(bt&d)===d&&(nn===4||nn===3&&(bt&62914560)===bt&&300>ut()-ac?(It&2)===0&&ni(r,0):Zu|=d,ei===bt&&(ei=0)),$s(r)}function ty(r,o){o===0&&(o=dl()),r=cr(r,o),r!==null&&(tr(r,o),$s(r))}function BS(r){var o=r.memoizedState,d=0;o!==null&&(d=o.retryLane),ty(r,d)}function GS(r,o){var d=0;switch(r.tag){case 31:case 13:var p=r.stateNode,N=r.memoizedState;N!==null&&(d=N.retryLane);break;case 19:p=r.stateNode;break;case 22:p=r.stateNode._retryCache;break;default:throw Error(a(314))}p!==null&&p.delete(o),ty(r,d)}function zS(r,o){return ye(r,o)}var uc=null,ai=null,oh=!1,hc=!1,lh=!1,Ga=0;function $s(r){r!==ai&&r.next===null&&(ai===null?uc=ai=r:ai=ai.next=r),hc=!0,oh||(oh=!0,HS())}function jo(r,o){if(!lh&&hc){lh=!0;do for(var d=!1,p=uc;p!==null;){if(r!==0){var N=p.pendingLanes;if(N===0)var w=0;else{var R=p.suspendedLanes,K=p.pingedLanes;w=(1<<31-it(42|r)+1)-1,w&=N&~(R&~K),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(d=!0,ry(p,w))}else w=bt,w=Na(p,p===Ft?w:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(w&3)===0||Ls(p,w)||(d=!0,ry(p,w));p=p.next}while(d);lh=!1}}function $S(){ny()}function ny(){hc=oh=!1;var r=0;Ga!==0&&ew()&&(r=Ga);for(var o=ut(),d=null,p=uc;p!==null;){var N=p.next,w=sy(p,o);w===0?(p.next=null,d===null?uc=N:d.next=N,N===null&&(ai=d)):(d=p,(r!==0||(w&3)!==0)&&(hc=!0)),p=N}yn!==0&&yn!==5||jo(r),Ga!==0&&(Ga=0)}function sy(r,o){for(var d=r.suspendedLanes,p=r.pingedLanes,N=r.expirationTimes,w=r.pendingLanes&-62914561;0<w;){var R=31-it(w),K=1<<R,re=N[R];re===-1?((K&d)===0||(K&p)!==0)&&(N[R]=wd(K,o)):re<=o&&(r.expiredLanes|=K),w&=~K}if(o=Ft,d=bt,d=Na(r,r===o?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p=r.callbackNode,d===0||r===o&&(Dt===2||Dt===9)||r.cancelPendingCommit!==null)return p!==null&&p!==null&&Ue(p),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Ls(r,d)){if(o=d&-d,o===r.callbackPriority)return o;switch(p!==null&&Ue(p),Gi(d)){case 2:case 8:d=vt;break;case 32:d=Yt;break;case 268435456:d=Vs;break;default:d=Yt}return p=ay.bind(null,r),d=ye(d,p),r.callbackPriority=o,r.callbackNode=d,o}return p!==null&&p!==null&&Ue(p),r.callbackPriority=2,r.callbackNode=null,2}function ay(r,o){if(yn!==0&&yn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(dc()&&r.callbackNode!==d)return null;var p=bt;return p=Na(r,r===Ft?p:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p===0?null:(Fg(r,p,o),sy(r,ut()),r.callbackNode!=null&&r.callbackNode===d?ay.bind(null,r):null)}function ry(r,o){if(dc())return null;Fg(r,o,!0)}function HS(){nw(function(){(It&6)!==0?ye(Ct,$S):ny()})}function ch(){if(Ga===0){var r=$r;r===0&&(r=pn,pn<<=1,(pn&261888)===0&&(pn=256)),Ga=r}return Ga}function iy(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Qt(""+r)}function oy(r,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,r.id&&d.setAttribute("form",r.id),o.parentNode.insertBefore(d,o),r=new FormData(r),d.parentNode.removeChild(d),r}function qS(r,o,d,p,N){if(o==="submit"&&d&&d.stateNode===N){var w=iy((N[_n]||null).action),R=p.submitter;R&&(o=(o=R[_n]||null)?iy(o.formAction):R.getAttribute("formAction"),o!==null&&(w=o,R=null));var K=new Tl("action","action",null,p,N);r.push({event:K,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ga!==0){var re=R?oy(N,R):new FormData(N);Iu(d,{pending:!0,data:re,method:N.method,action:w},null,re)}}else typeof w=="function"&&(K.preventDefault(),re=R?oy(N,R):new FormData(N),Iu(d,{pending:!0,data:re,method:N.method,action:w},w,re))},currentTarget:N}]})}}for(var dh=0;dh<Vd.length;dh++){var uh=Vd[dh],VS=uh.toLowerCase(),KS=uh[0].toUpperCase()+uh.slice(1);ws(VS,"on"+KS)}ws(Um,"onAnimationEnd"),ws(Fm,"onAnimationIteration"),ws(Bm,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(cS,"onTransitionRun"),ws(dS,"onTransitionStart"),ws(uS,"onTransitionCancel"),ws(Gm,"onTransitionEnd"),rr("onMouseEnter",["mouseout","mouseover"]),rr("onMouseLeave",["mouseout","mouseover"]),rr("onPointerEnter",["pointerout","pointerover"]),rr("onPointerLeave",["pointerout","pointerover"]),Sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _o="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_o));function ly(r,o){o=(o&4)!==0;for(var d=0;d<r.length;d++){var p=r[d],N=p.event;p=p.listeners;e:{var w=void 0;if(o)for(var R=p.length-1;0<=R;R--){var K=p[R],re=K.instance,ge=K.currentTarget;if(K=K.listener,re!==w&&N.isPropagationStopped())break e;w=K,N.currentTarget=ge;try{w(N)}catch(Ee){El(Ee)}N.currentTarget=null,w=re}else for(R=0;R<p.length;R++){if(K=p[R],re=K.instance,ge=K.currentTarget,K=K.listener,re!==w&&N.isPropagationStopped())break e;w=K,N.currentTarget=ge;try{w(N)}catch(Ee){El(Ee)}N.currentTarget=null,w=re}}}}function xt(r,o){var d=o[zi];d===void 0&&(d=o[zi]=new Set);var p=r+"__bubble";d.has(p)||(cy(o,r,2,!1),d.add(p))}function hh(r,o,d){var p=0;o&&(p|=4),cy(d,r,p,o)}var fc="_reactListening"+Math.random().toString(36).slice(2);function fh(r){if(!r[fc]){r[fc]=!0,_d.forEach(function(d){d!=="selectionchange"&&(WS.has(d)||hh(d,!1,r),hh(d,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[fc]||(o[fc]=!0,hh("selectionchange",!1,o))}}function cy(r,o,d,p){switch(Uy(o)){case 2:var N=Sw;break;case 8:N=ww;break;default:N=Ch}d=N.bind(null,o,d,r),N=void 0,!Rd||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(N=!0),p?N!==void 0?r.addEventListener(o,d,{capture:!0,passive:N}):r.addEventListener(o,d,!0):N!==void 0?r.addEventListener(o,d,{passive:N}):r.addEventListener(o,d,!1)}function mh(r,o,d,p,N){var w=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var K=p.stateNode.containerInfo;if(K===N)break;if(R===4)for(R=p.return;R!==null;){var re=R.tag;if((re===3||re===4)&&R.stateNode.containerInfo===N)return;R=R.return}for(;K!==null;){if(R=nr(K),R===null)return;if(re=R.tag,re===5||re===6||re===26||re===27){p=w=R;continue e}K=K.parentNode}}p=p.return}bl(function(){var ge=w,Ee=Pn(d),Ie=[];e:{var ve=zm.get(r);if(ve!==void 0){var Te=Tl,We=r;switch(r){case"keypress":if(Sl(d)===0)break e;case"keydown":case"keyup":Te=GN;break;case"focusin":We="focus",Te=Ld;break;case"focusout":We="blur",Te=Ld;break;case"beforeblur":case"afterblur":Te=Ld;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Te=ym;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Te=IN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Te=HN;break;case Um:case Fm:case Bm:Te=DN;break;case Gm:Te=VN;break;case"scroll":case"scrollend":Te=EN;break;case"wheel":Te=WN;break;case"copy":case"cut":case"paste":Te=MN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Te=vm;break;case"toggle":case"beforetoggle":Te=YN}var st=(o&4)!==0,Ot=!st&&(r==="scroll"||r==="scrollend"),he=st?ve!==null?ve+"Capture":null:ve;st=[];for(var ce=ge,pe;ce!==null;){var Ce=ce;if(pe=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||pe===null||he===null||(Ce=Ki(ce,he),Ce!=null&&st.push(Eo(ce,Ce,pe))),Ot)break;ce=ce.return}0<st.length&&(ve=new Te(ve,We,null,d,Ee),Ie.push({event:ve,listeners:st}))}}if((o&7)===0){e:{if(ve=r==="mouseover"||r==="pointerover",Te=r==="mouseout"||r==="pointerout",ve&&d!==Zt&&(We=d.relatedTarget||d.fromElement)&&(nr(We)||We[Ks]))break e;if((Te||ve)&&(ve=Ee.window===Ee?Ee:(ve=Ee.ownerDocument)?ve.defaultView||ve.parentWindow:window,Te?(We=d.relatedTarget||d.toElement,Te=ge,We=We?nr(We):null,We!==null&&(Ot=l(We),st=We.tag,We!==Ot||st!==5&&st!==27&&st!==6)&&(We=null)):(Te=null,We=ge),Te!==We)){if(st=ym,Ce="onMouseLeave",he="onMouseEnter",ce="mouse",(r==="pointerout"||r==="pointerover")&&(st=vm,Ce="onPointerLeave",he="onPointerEnter",ce="pointer"),Ot=Te==null?ve:Rr(Te),pe=We==null?ve:Rr(We),ve=new st(Ce,ce+"leave",Te,d,Ee),ve.target=Ot,ve.relatedTarget=pe,Ce=null,nr(Ee)===ge&&(st=new st(he,ce+"enter",We,d,Ee),st.target=pe,st.relatedTarget=Ot,Ce=st),Ot=Ce,Te&&We)t:{for(st=JS,he=Te,ce=We,pe=0,Ce=he;Ce;Ce=st(Ce))pe++;Ce=0;for(var tt=ce;tt;tt=st(tt))Ce++;for(;0<pe-Ce;)he=st(he),pe--;for(;0<Ce-pe;)ce=st(ce),Ce--;for(;pe--;){if(he===ce||ce!==null&&he===ce.alternate){st=he;break t}he=st(he),ce=st(ce)}st=null}else st=null;Te!==null&&dy(Ie,ve,Te,st,!1),We!==null&&Ot!==null&&dy(Ie,Ot,We,st,!0)}}e:{if(ve=ge?Rr(ge):window,Te=ve.nodeName&&ve.nodeName.toLowerCase(),Te==="select"||Te==="input"&&ve.type==="file")var Tt=Em;else if(jm(ve))if(Cm)Tt=iS;else{Tt=aS;var Xe=sS}else Te=ve.nodeName,!Te||Te.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ge&&Qe(ge.elementType)&&(Tt=Em):Tt=rS;if(Tt&&(Tt=Tt(r,ge))){_m(Ie,Tt,d,Ee);break e}Xe&&Xe(r,ve,ge),r==="focusout"&&ge&&ve.type==="number"&&ge.memoizedProps.value!=null&&vl(ve,"number",ve.value)}switch(Xe=ge?Rr(ge):window,r){case"focusin":(jm(Xe)||Xe.contentEditable==="true")&&(Pr=Xe,$d=ge,to=null);break;case"focusout":to=$d=Pr=null;break;case"mousedown":Hd=!0;break;case"contextmenu":case"mouseup":case"dragend":Hd=!1,Om(Ie,d,Ee);break;case"selectionchange":if(lS)break;case"keydown":case"keyup":Om(Ie,d,Ee)}var ft;if(Fd)e:{switch(r){case"compositionstart":var Nt="onCompositionStart";break e;case"compositionend":Nt="onCompositionEnd";break e;case"compositionupdate":Nt="onCompositionUpdate";break e}Nt=void 0}else Mr?wm(r,d)&&(Nt="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Nt="onCompositionStart");Nt&&(bm&&d.locale!=="ko"&&(Mr||Nt!=="onCompositionStart"?Nt==="onCompositionEnd"&&Mr&&(ft=pm()):(ja=Ee,Md="value"in ja?ja.value:ja.textContent,Mr=!0)),Xe=mc(ge,Nt),0<Xe.length&&(Nt=new xm(Nt,r,null,d,Ee),Ie.push({event:Nt,listeners:Xe}),ft?Nt.data=ft:(ft=Tm(d),ft!==null&&(Nt.data=ft)))),(ft=QN?ZN(r,d):eS(r,d))&&(Nt=mc(ge,"onBeforeInput"),0<Nt.length&&(Xe=new xm("onBeforeInput","beforeinput",null,d,Ee),Ie.push({event:Xe,listeners:Nt}),Xe.data=ft)),qS(Ie,r,ge,d,Ee)}ly(Ie,o)})}function Eo(r,o,d){return{instance:r,listener:o,currentTarget:d}}function mc(r,o){for(var d=o+"Capture",p=[];r!==null;){var N=r,w=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||w===null||(N=Ki(r,d),N!=null&&p.unshift(Eo(r,N,w)),N=Ki(r,o),N!=null&&p.push(Eo(r,N,w))),r.tag===3)return p;r=r.return}return[]}function JS(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function dy(r,o,d,p,N){for(var w=o._reactName,R=[];d!==null&&d!==p;){var K=d,re=K.alternate,ge=K.stateNode;if(K=K.tag,re!==null&&re===p)break;K!==5&&K!==26&&K!==27||ge===null||(re=ge,N?(ge=Ki(d,w),ge!=null&&R.unshift(Eo(d,ge,re))):N||(ge=Ki(d,w),ge!=null&&R.push(Eo(d,ge,re)))),d=d.return}R.length!==0&&r.push({event:o,listeners:R})}var YS=/\r\n?/g,XS=/\u0000|\uFFFD/g;function uy(r){return(typeof r=="string"?r:""+r).replace(YS,`
`).replace(XS,"")}function hy(r,o){return o=uy(o),uy(r)===o}function Pt(r,o,d,p,N,w){switch(d){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||V(r,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&V(r,""+p);break;case"className":qi(r,"class",p);break;case"tabIndex":qi(r,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":qi(r,d,p);break;case"style":Pe(r,p,w);break;case"data":if(o!=="object"){qi(r,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||d!=="href")){r.removeAttribute(d);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(d);break}p=Qt(""+p),r.setAttribute(d,p);break;case"action":case"formAction":if(typeof p=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(d==="formAction"?(o!=="input"&&Pt(r,o,"name",N.name,N,null),Pt(r,o,"formEncType",N.formEncType,N,null),Pt(r,o,"formMethod",N.formMethod,N,null),Pt(r,o,"formTarget",N.formTarget,N,null)):(Pt(r,o,"encType",N.encType,N,null),Pt(r,o,"method",N.method,N,null),Pt(r,o,"target",N.target,N,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(d);break}p=Qt(""+p),r.setAttribute(d,p);break;case"onClick":p!=null&&(r.onclick=Kt);break;case"onScroll":p!=null&&xt("scroll",r);break;case"onScrollEnd":p!=null&&xt("scrollend",r);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(a(61));if(d=p.__html,d!=null){if(N.children!=null)throw Error(a(60));r.innerHTML=d}}break;case"multiple":r.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":r.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){r.removeAttribute("xlink:href");break}d=Qt(""+p),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(d,""+p):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":p===!0?r.setAttribute(d,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(d,p):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?r.setAttribute(d,p):r.removeAttribute(d);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?r.removeAttribute(d):r.setAttribute(d,p);break;case"popover":xt("beforetoggle",r),xt("toggle",r),Hi(r,"popover",p);break;case"xlinkActuate":Fs(r,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Fs(r,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Fs(r,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Fs(r,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Fs(r,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Fs(r,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Fs(r,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Fs(r,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Fs(r,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Hi(r,"is",p);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=pt.get(d)||d,Hi(r,d,p))}}function ph(r,o,d,p,N,w){switch(d){case"style":Pe(r,p,w);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(a(61));if(d=p.__html,d!=null){if(N.children!=null)throw Error(a(60));r.innerHTML=d}}break;case"children":typeof p=="string"?V(r,p):(typeof p=="number"||typeof p=="bigint")&&V(r,""+p);break;case"onScroll":p!=null&&xt("scroll",r);break;case"onScrollEnd":p!=null&&xt("scrollend",r);break;case"onClick":p!=null&&(r.onclick=Kt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ed.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(N=d.endsWith("Capture"),o=d.slice(2,N?d.length-7:void 0),w=r[_n]||null,w=w!=null?w[d]:null,typeof w=="function"&&r.removeEventListener(o,w,N),typeof p=="function")){typeof w!="function"&&w!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(o,p,N);break e}d in r?r[d]=p:p===!0?r.setAttribute(d,""):Hi(r,d,p)}}}function An(r,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xt("error",r),xt("load",r);var p=!1,N=!1,w;for(w in d)if(d.hasOwnProperty(w)){var R=d[w];if(R!=null)switch(w){case"src":p=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,o));default:Pt(r,o,w,R,d,null)}}N&&Pt(r,o,"srcSet",d.srcSet,d,null),p&&Pt(r,o,"src",d.src,d,null);return;case"input":xt("invalid",r);var K=w=R=N=null,re=null,ge=null;for(p in d)if(d.hasOwnProperty(p)){var Ee=d[p];if(Ee!=null)switch(p){case"name":N=Ee;break;case"type":R=Ee;break;case"checked":re=Ee;break;case"defaultChecked":ge=Ee;break;case"value":w=Ee;break;case"defaultValue":K=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(a(137,o));break;default:Pt(r,o,p,Ee,d,null)}}Dd(r,w,K,re,ge,R,N,!1);return;case"select":xt("invalid",r),p=R=w=null;for(N in d)if(d.hasOwnProperty(N)&&(K=d[N],K!=null))switch(N){case"value":w=K;break;case"defaultValue":R=K;break;case"multiple":p=K;default:Pt(r,o,N,K,d,null)}o=w,d=R,r.multiple=!!p,o!=null?wa(r,!!p,o,!1):d!=null&&wa(r,!!p,d,!0);return;case"textarea":xt("invalid",r),w=N=p=null;for(R in d)if(d.hasOwnProperty(R)&&(K=d[R],K!=null))switch(R){case"value":p=K;break;case"defaultValue":N=K;break;case"children":w=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(a(91));break;default:Pt(r,o,R,K,d,null)}X(r,p,N,w);return;case"option":for(re in d)if(d.hasOwnProperty(re)&&(p=d[re],p!=null))switch(re){case"selected":r.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Pt(r,o,re,p,d,null)}return;case"dialog":xt("beforetoggle",r),xt("toggle",r),xt("cancel",r),xt("close",r);break;case"iframe":case"object":xt("load",r);break;case"video":case"audio":for(p=0;p<_o.length;p++)xt(_o[p],r);break;case"image":xt("error",r),xt("load",r);break;case"details":xt("toggle",r);break;case"embed":case"source":case"link":xt("error",r),xt("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in d)if(d.hasOwnProperty(ge)&&(p=d[ge],p!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,o));default:Pt(r,o,ge,p,d,null)}return;default:if(Qe(o)){for(Ee in d)d.hasOwnProperty(Ee)&&(p=d[Ee],p!==void 0&&ph(r,o,Ee,p,d,void 0));return}}for(K in d)d.hasOwnProperty(K)&&(p=d[K],p!=null&&Pt(r,o,K,p,d,null))}function QS(r,o,d,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,w=null,R=null,K=null,re=null,ge=null,Ee=null;for(Te in d){var Ie=d[Te];if(d.hasOwnProperty(Te)&&Ie!=null)switch(Te){case"checked":break;case"value":break;case"defaultValue":re=Ie;default:p.hasOwnProperty(Te)||Pt(r,o,Te,null,p,Ie)}}for(var ve in p){var Te=p[ve];if(Ie=d[ve],p.hasOwnProperty(ve)&&(Te!=null||Ie!=null))switch(ve){case"type":w=Te;break;case"name":N=Te;break;case"checked":ge=Te;break;case"defaultChecked":Ee=Te;break;case"value":R=Te;break;case"defaultValue":K=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(a(137,o));break;default:Te!==Ie&&Pt(r,o,ve,Te,p,Ie)}}xl(r,R,K,re,ge,Ee,w,N);return;case"select":Te=R=K=ve=null;for(w in d)if(re=d[w],d.hasOwnProperty(w)&&re!=null)switch(w){case"value":break;case"multiple":Te=re;default:p.hasOwnProperty(w)||Pt(r,o,w,null,p,re)}for(N in p)if(w=p[N],re=d[N],p.hasOwnProperty(N)&&(w!=null||re!=null))switch(N){case"value":ve=w;break;case"defaultValue":K=w;break;case"multiple":R=w;default:w!==re&&Pt(r,o,N,w,p,re)}o=K,d=R,p=Te,ve!=null?wa(r,!!d,ve,!1):!!p!=!!d&&(o!=null?wa(r,!!d,o,!0):wa(r,!!d,d?[]:"",!1));return;case"textarea":Te=ve=null;for(K in d)if(N=d[K],d.hasOwnProperty(K)&&N!=null&&!p.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Pt(r,o,K,null,p,N)}for(R in p)if(N=p[R],w=d[R],p.hasOwnProperty(R)&&(N!=null||w!=null))switch(R){case"value":ve=N;break;case"defaultValue":Te=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(a(91));break;default:N!==w&&Pt(r,o,R,N,p,w)}H(r,ve,Te);return;case"option":for(var We in d)if(ve=d[We],d.hasOwnProperty(We)&&ve!=null&&!p.hasOwnProperty(We))switch(We){case"selected":r.selected=!1;break;default:Pt(r,o,We,null,p,ve)}for(re in p)if(ve=p[re],Te=d[re],p.hasOwnProperty(re)&&ve!==Te&&(ve!=null||Te!=null))switch(re){case"selected":r.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:Pt(r,o,re,ve,p,Te)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in d)ve=d[st],d.hasOwnProperty(st)&&ve!=null&&!p.hasOwnProperty(st)&&Pt(r,o,st,null,p,ve);for(ge in p)if(ve=p[ge],Te=d[ge],p.hasOwnProperty(ge)&&ve!==Te&&(ve!=null||Te!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(a(137,o));break;default:Pt(r,o,ge,ve,p,Te)}return;default:if(Qe(o)){for(var Ot in d)ve=d[Ot],d.hasOwnProperty(Ot)&&ve!==void 0&&!p.hasOwnProperty(Ot)&&ph(r,o,Ot,void 0,p,ve);for(Ee in p)ve=p[Ee],Te=d[Ee],!p.hasOwnProperty(Ee)||ve===Te||ve===void 0&&Te===void 0||ph(r,o,Ee,ve,p,Te);return}}for(var he in d)ve=d[he],d.hasOwnProperty(he)&&ve!=null&&!p.hasOwnProperty(he)&&Pt(r,o,he,null,p,ve);for(Ie in p)ve=p[Ie],Te=d[Ie],!p.hasOwnProperty(Ie)||ve===Te||ve==null&&Te==null||Pt(r,o,Ie,ve,p,Te)}function fy(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ZS(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,d=performance.getEntriesByType("resource"),p=0;p<d.length;p++){var N=d[p],w=N.transferSize,R=N.initiatorType,K=N.duration;if(w&&K&&fy(R)){for(R=0,K=N.responseEnd,p+=1;p<d.length;p++){var re=d[p],ge=re.startTime;if(ge>K)break;var Ee=re.transferSize,Ie=re.initiatorType;Ee&&fy(Ie)&&(re=re.responseEnd,R+=Ee*(re<K?1:(K-ge)/(re-ge)))}if(--p,o+=8*(w+R)/(N.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var gh=null,yh=null;function pc(r){return r.nodeType===9?r:r.ownerDocument}function my(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function py(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function xh(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var vh=null;function ew(){var r=window.event;return r&&r.type==="popstate"?r===vh?!1:(vh=r,!0):(vh=null,!1)}var gy=typeof setTimeout=="function"?setTimeout:void 0,tw=typeof clearTimeout=="function"?clearTimeout:void 0,yy=typeof Promise=="function"?Promise:void 0,nw=typeof queueMicrotask=="function"?queueMicrotask:typeof yy<"u"?function(r){return yy.resolve(null).then(r).catch(sw)}:gy;function sw(r){setTimeout(function(){throw r})}function za(r){return r==="head"}function xy(r,o){var d=o,p=0;do{var N=d.nextSibling;if(r.removeChild(d),N&&N.nodeType===8)if(d=N.data,d==="/$"||d==="/&"){if(p===0){r.removeChild(N),li(o);return}p--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")p++;else if(d==="html")Co(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,Co(d);for(var w=d.firstChild;w;){var R=w.nextSibling,K=w.nodeName;w[Dr]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&w.rel.toLowerCase()==="stylesheet"||d.removeChild(w),w=R}}else d==="body"&&Co(r.ownerDocument.body);d=N}while(d);li(o)}function vy(r,o){var d=r;r=0;do{var p=d.nextSibling;if(d.nodeType===1?o?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(o?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),p&&p.nodeType===8)if(d=p.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=p}while(d)}function bh(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":bh(d),gl(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function aw(r,o,d,p){for(;r.nodeType===1;){var N=d;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(p){if(!r[Dr])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(w=r.getAttribute("rel"),w==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(w!==N.rel||r.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||r.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||r.getAttribute("title")!==(N.title==null?null:N.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(w=r.getAttribute("src"),(w!==(N.src==null?null:N.src)||r.getAttribute("type")!==(N.type==null?null:N.type)||r.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&w&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var w=N.name==null?null:""+N.name;if(N.type==="hidden"&&r.getAttribute("name")===w)return r}else return r;if(r=gs(r.nextSibling),r===null)break}return null}function rw(r,o,d){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=gs(r.nextSibling),r===null))return null;return r}function by(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=gs(r.nextSibling),r===null))return null;return r}function Nh(r){return r.data==="$?"||r.data==="$~"}function Sh(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function iw(r,o){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||d.readyState!=="loading")o();else{var p=function(){o(),d.removeEventListener("DOMContentLoaded",p)};d.addEventListener("DOMContentLoaded",p),r._reactRetry=p}}function gs(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var wh=null;function Ny(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(o===0)return gs(r.nextSibling);o--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||o++}r=r.nextSibling}return null}function Sy(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(o===0)return r;o--}else d!=="/$"&&d!=="/&"||o++}r=r.previousSibling}return null}function wy(r,o,d){switch(o=pc(d),r){case"html":if(r=o.documentElement,!r)throw Error(a(452));return r;case"head":if(r=o.head,!r)throw Error(a(453));return r;case"body":if(r=o.body,!r)throw Error(a(454));return r;default:throw Error(a(451))}}function Co(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);gl(r)}var ys=new Map,Ty=new Set;function gc(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ua=B.d;B.d={f:ow,r:lw,D:cw,C:dw,L:uw,m:hw,X:mw,S:fw,M:pw};function ow(){var r=ua.f(),o=oc();return r||o}function lw(r){var o=sr(r);o!==null&&o.tag===5&&o.type==="form"?Gp(o):ua.r(r)}var ri=typeof document>"u"?null:document;function jy(r,o,d){var p=ri;if(p&&typeof o=="string"&&o){var N=Wn(o);N='link[rel="'+r+'"][href="'+N+'"]',typeof d=="string"&&(N+='[crossorigin="'+d+'"]'),Ty.has(N)||(Ty.add(N),r={rel:r,crossOrigin:d,href:o},p.querySelector(N)===null&&(o=p.createElement("link"),An(o,"link",r),gn(o),p.head.appendChild(o)))}}function cw(r){ua.D(r),jy("dns-prefetch",r,null)}function dw(r,o){ua.C(r,o),jy("preconnect",r,o)}function uw(r,o,d){ua.L(r,o,d);var p=ri;if(p&&r&&o){var N='link[rel="preload"][as="'+Wn(o)+'"]';o==="image"&&d&&d.imageSrcSet?(N+='[imagesrcset="'+Wn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(N+='[imagesizes="'+Wn(d.imageSizes)+'"]')):N+='[href="'+Wn(r)+'"]';var w=N;switch(o){case"style":w=ii(r);break;case"script":w=oi(r)}ys.has(w)||(r=x({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:r,as:o},d),ys.set(w,r),p.querySelector(N)!==null||o==="style"&&p.querySelector(Io(w))||o==="script"&&p.querySelector(Ao(w))||(o=p.createElement("link"),An(o,"link",r),gn(o),p.head.appendChild(o)))}}function hw(r,o){ua.m(r,o);var d=ri;if(d&&r){var p=o&&typeof o.as=="string"?o.as:"script",N='link[rel="modulepreload"][as="'+Wn(p)+'"][href="'+Wn(r)+'"]',w=N;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=oi(r)}if(!ys.has(w)&&(r=x({rel:"modulepreload",href:r},o),ys.set(w,r),d.querySelector(N)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Ao(w)))return}p=d.createElement("link"),An(p,"link",r),gn(p),d.head.appendChild(p)}}}function fw(r,o,d){ua.S(r,o,d);var p=ri;if(p&&r){var N=ar(p).hoistableStyles,w=ii(r);o=o||"default";var R=N.get(w);if(!R){var K={loading:0,preload:null};if(R=p.querySelector(Io(w)))K.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":o},d),(d=ys.get(w))&&Th(r,d);var re=R=p.createElement("link");gn(re),An(re,"link",r),re._p=new Promise(function(ge,Ee){re.onload=ge,re.onerror=Ee}),re.addEventListener("load",function(){K.loading|=1}),re.addEventListener("error",function(){K.loading|=2}),K.loading|=4,yc(R,o,p)}R={type:"stylesheet",instance:R,count:1,state:K},N.set(w,R)}}}function mw(r,o){ua.X(r,o);var d=ri;if(d&&r){var p=ar(d).hoistableScripts,N=oi(r),w=p.get(N);w||(w=d.querySelector(Ao(N)),w||(r=x({src:r,async:!0},o),(o=ys.get(N))&&jh(r,o),w=d.createElement("script"),gn(w),An(w,"link",r),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(N,w))}}function pw(r,o){ua.M(r,o);var d=ri;if(d&&r){var p=ar(d).hoistableScripts,N=oi(r),w=p.get(N);w||(w=d.querySelector(Ao(N)),w||(r=x({src:r,async:!0,type:"module"},o),(o=ys.get(N))&&jh(r,o),w=d.createElement("script"),gn(w),An(w,"link",r),d.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},p.set(N,w))}}function _y(r,o,d,p){var N=(N=ne.current)?gc(N):null;if(!N)throw Error(a(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=ii(d.href),d=ar(N).hoistableStyles,p=d.get(o),p||(p={type:"style",instance:null,count:0,state:null},d.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=ii(d.href);var w=ar(N).hoistableStyles,R=w.get(r);if(R||(N=N.ownerDocument||N,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(r,R),(w=N.querySelector(Io(r)))&&!w._p&&(R.instance=w,R.state.loading=5),ys.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},ys.set(r,d),w||gw(N,r,d,R.state))),o&&p===null)throw Error(a(528,""));return R}if(o&&p!==null)throw Error(a(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=oi(d),d=ar(N).hoistableScripts,p=d.get(o),p||(p={type:"script",instance:null,count:0,state:null},d.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,r))}}function ii(r){return'href="'+Wn(r)+'"'}function Io(r){return'link[rel="stylesheet"]['+r+"]"}function Ey(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function gw(r,o,d,p){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=r.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),An(o,"link",d),gn(o),r.head.appendChild(o))}function oi(r){return'[src="'+Wn(r)+'"]'}function Ao(r){return"script[async]"+r}function Cy(r,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var p=r.querySelector('style[data-href~="'+Wn(d.href)+'"]');if(p)return o.instance=p,gn(p),p;var N=x({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return p=(r.ownerDocument||r).createElement("style"),gn(p),An(p,"style",N),yc(p,d.precedence,r),o.instance=p;case"stylesheet":N=ii(d.href);var w=r.querySelector(Io(N));if(w)return o.state.loading|=4,o.instance=w,gn(w),w;p=Ey(d),(N=ys.get(N))&&Th(p,N),w=(r.ownerDocument||r).createElement("link"),gn(w);var R=w;return R._p=new Promise(function(K,re){R.onload=K,R.onerror=re}),An(w,"link",p),o.state.loading|=4,yc(w,d.precedence,r),o.instance=w;case"script":return w=oi(d.src),(N=r.querySelector(Ao(w)))?(o.instance=N,gn(N),N):(p=d,(N=ys.get(w))&&(p=x({},d),jh(p,N)),r=r.ownerDocument||r,N=r.createElement("script"),gn(N),An(N,"link",p),r.head.appendChild(N),o.instance=N);case"void":return null;default:throw Error(a(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,yc(p,d.precedence,r));return o.instance}function yc(r,o,d){for(var p=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=p.length?p[p.length-1]:null,w=N,R=0;R<p.length;R++){var K=p[R];if(K.dataset.precedence===o)w=K;else if(w!==N)break}w?w.parentNode.insertBefore(r,w.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(r,o.firstChild))}function Th(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function jh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var xc=null;function Iy(r,o,d){if(xc===null){var p=new Map,N=xc=new Map;N.set(d,p)}else N=xc,p=N.get(d),p||(p=new Map,N.set(d,p));if(p.has(r))return p;for(p.set(r,null),d=d.getElementsByTagName(r),N=0;N<d.length;N++){var w=d[N];if(!(w[Dr]||w[on]||r==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var R=w.getAttribute(o)||"";R=r+R;var K=p.get(R);K?K.push(w):p.set(R,[w])}}return p}function Ay(r,o,d){r=r.ownerDocument||r,r.head.insertBefore(d,o==="title"?r.querySelector("head > title"):null)}function yw(r,o,d){if(d===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function ky(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function xw(r,o,d,p){if(d.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var N=ii(p.href),w=o.querySelector(Io(N));if(w){o=w._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=vc.bind(r),o.then(r,r)),d.state.loading|=4,d.instance=w,gn(w);return}w=o.ownerDocument||o,p=Ey(p),(N=ys.get(N))&&Th(p,N),w=w.createElement("link"),gn(w);var R=w;R._p=new Promise(function(K,re){R.onload=K,R.onerror=re}),An(w,"link",p),d.instance=w}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=vc.bind(r),o.addEventListener("load",d),o.addEventListener("error",d))}}var _h=0;function vw(r,o){return r.stylesheets&&r.count===0&&Nc(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var p=setTimeout(function(){if(r.stylesheets&&Nc(r,r.stylesheets),r.unsuspend){var w=r.unsuspend;r.unsuspend=null,w()}},6e4+o);0<r.imgBytes&&_h===0&&(_h=62500*ZS());var N=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Nc(r,r.stylesheets),r.unsuspend)){var w=r.unsuspend;r.unsuspend=null,w()}},(r.imgBytes>_h?50:800)+o);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(p),clearTimeout(N)}}:null}function vc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Nc(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var bc=null;function Nc(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,bc=new Map,o.forEach(bw,r),bc=null,vc.call(r))}function bw(r,o){if(!(o.state.loading&4)){var d=bc.get(r);if(d)var p=d.get(null);else{d=new Map,bc.set(r,d);for(var N=r.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<N.length;w++){var R=N[w];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(d.set(R.dataset.precedence,R),p=R)}p&&d.set(null,p)}N=o.instance,R=N.getAttribute("data-precedence"),w=d.get(R)||p,w===p&&d.set(null,N),d.set(R,N),this.count++,p=vc.bind(this),N.addEventListener("load",p),N.addEventListener("error",p),w?w.parentNode.insertBefore(N,w.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(N,r.firstChild)),o.state.loading|=4}}var ko={$$typeof:C,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function Nw(r,o,d,p,N,w,R,K,re){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fi(0),this.hiddenUpdates=Fi(null),this.identifierPrefix=p,this.onUncaughtError=N,this.onCaughtError=w,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=re,this.incompleteTransitions=new Map}function Dy(r,o,d,p,N,w,R,K,re,ge,Ee,Ie){return r=new Nw(r,o,d,R,re,ge,Ee,Ie,K),o=1,w===!0&&(o|=24),w=Yn(3,null,null,o),r.current=w,w.stateNode=r,o=ru(),o.refCount++,r.pooledCache=o,o.refCount++,w.memoizedState={element:p,isDehydrated:d,cache:o},cu(w),r}function Ry(r){return r?(r=Ur,r):Ur}function My(r,o,d,p,N,w){N=Ry(N),p.context===null?p.context=N:p.pendingContext=N,p=ka(o),p.payload={element:d},w=w===void 0?null:w,w!==null&&(p.callback=w),d=Da(r,p,o),d!==null&&(Vn(d,r,o),lo(d,r,o))}function Py(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<o?d:o}}function Eh(r,o){Py(r,o),(r=r.alternate)&&Py(r,o)}function Oy(r){if(r.tag===13||r.tag===31){var o=cr(r,67108864);o!==null&&Vn(o,r,67108864),Eh(r,67108864)}}function Ly(r){if(r.tag===13||r.tag===31){var o=ts();o=Bi(o);var d=cr(r,o);d!==null&&Vn(d,r,o),Eh(r,o)}}var Sc=!0;function Sw(r,o,d,p){var N=G.T;G.T=null;var w=B.p;try{B.p=2,Ch(r,o,d,p)}finally{B.p=w,G.T=N}}function ww(r,o,d,p){var N=G.T;G.T=null;var w=B.p;try{B.p=8,Ch(r,o,d,p)}finally{B.p=w,G.T=N}}function Ch(r,o,d,p){if(Sc){var N=Ih(p);if(N===null)mh(r,o,p,wc,d),Fy(r,p);else if(jw(N,r,o,d,p))p.stopPropagation();else if(Fy(r,p),o&4&&-1<Tw.indexOf(r)){for(;N!==null;){var w=sr(N);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var R=cs(w.pendingLanes);if(R!==0){var K=w;for(K.pendingLanes|=2,K.entangledLanes|=2;R;){var re=1<<31-it(R);K.entanglements[1]|=re,R&=~re}$s(w),(It&6)===0&&(rc=ut()+500,jo(0))}}break;case 31:case 13:K=cr(w,2),K!==null&&Vn(K,w,2),oc(),Eh(w,2)}if(w=Ih(p),w===null&&mh(r,o,p,wc,d),w===N)break;N=w}N!==null&&p.stopPropagation()}else mh(r,o,p,null,d)}}function Ih(r){return r=Pn(r),Ah(r)}var wc=null;function Ah(r){if(wc=null,r=nr(r),r!==null){var o=l(r);if(o===null)r=null;else{var d=o.tag;if(d===13){if(r=c(o),r!==null)return r;r=null}else if(d===31){if(r=u(o),r!==null)return r;r=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return wc=r,null}function Uy(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ut()){case Ct:return 2;case vt:return 8;case Yt:case Ps:return 32;case Vs:return 268435456;default:return 32}default:return 32}}var kh=!1,$a=null,Ha=null,qa=null,Do=new Map,Ro=new Map,Va=[],Tw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Fy(r,o){switch(r){case"focusin":case"focusout":$a=null;break;case"dragenter":case"dragleave":Ha=null;break;case"mouseover":case"mouseout":qa=null;break;case"pointerover":case"pointerout":Do.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ro.delete(o.pointerId)}}function Mo(r,o,d,p,N,w){return r===null||r.nativeEvent!==w?(r={blockedOn:o,domEventName:d,eventSystemFlags:p,nativeEvent:w,targetContainers:[N]},o!==null&&(o=sr(o),o!==null&&Oy(o)),r):(r.eventSystemFlags|=p,o=r.targetContainers,N!==null&&o.indexOf(N)===-1&&o.push(N),r)}function jw(r,o,d,p,N){switch(o){case"focusin":return $a=Mo($a,r,o,d,p,N),!0;case"dragenter":return Ha=Mo(Ha,r,o,d,p,N),!0;case"mouseover":return qa=Mo(qa,r,o,d,p,N),!0;case"pointerover":var w=N.pointerId;return Do.set(w,Mo(Do.get(w)||null,r,o,d,p,N)),!0;case"gotpointercapture":return w=N.pointerId,Ro.set(w,Mo(Ro.get(w)||null,r,o,d,p,N)),!0}return!1}function By(r){var o=nr(r.target);if(o!==null){var d=l(o);if(d!==null){if(o=d.tag,o===13){if(o=c(d),o!==null){r.blockedOn=o,pl(r.priority,function(){Ly(d)});return}}else if(o===31){if(o=u(d),o!==null){r.blockedOn=o,pl(r.priority,function(){Ly(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Tc(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var d=Ih(r.nativeEvent);if(d===null){d=r.nativeEvent;var p=new d.constructor(d.type,d);Zt=p,d.target.dispatchEvent(p),Zt=null}else return o=sr(d),o!==null&&Oy(o),r.blockedOn=d,!1;o.shift()}return!0}function Gy(r,o,d){Tc(r)&&d.delete(o)}function _w(){kh=!1,$a!==null&&Tc($a)&&($a=null),Ha!==null&&Tc(Ha)&&(Ha=null),qa!==null&&Tc(qa)&&(qa=null),Do.forEach(Gy),Ro.forEach(Gy)}function jc(r,o){r.blockedOn===o&&(r.blockedOn=null,kh||(kh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,_w)))}var _c=null;function zy(r){_c!==r&&(_c=r,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){_c===r&&(_c=null);for(var o=0;o<r.length;o+=3){var d=r[o],p=r[o+1],N=r[o+2];if(typeof p!="function"){if(Ah(p||d)===null)continue;break}var w=sr(d);w!==null&&(r.splice(o,3),o-=3,Iu(w,{pending:!0,data:N,method:d.method,action:p},p,N))}}))}function li(r){function o(re){return jc(re,r)}$a!==null&&jc($a,r),Ha!==null&&jc(Ha,r),qa!==null&&jc(qa,r),Do.forEach(o),Ro.forEach(o);for(var d=0;d<Va.length;d++){var p=Va[d];p.blockedOn===r&&(p.blockedOn=null)}for(;0<Va.length&&(d=Va[0],d.blockedOn===null);)By(d),d.blockedOn===null&&Va.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(p=0;p<d.length;p+=3){var N=d[p],w=d[p+1],R=N[_n]||null;if(typeof w=="function")R||zy(d);else if(R){var K=null;if(w&&w.hasAttribute("formAction")){if(N=w,R=w[_n]||null)K=R.formAction;else if(Ah(N)!==null)continue}else K=R.action;typeof K=="function"?d[p+1]=K:(d.splice(p,3),p-=3),zy(d)}}}function $y(){function r(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(R){return N=R})},focusReset:"manual",scroll:"manual"})}function o(){N!==null&&(N(),N=null),p||setTimeout(d,20)}function d(){if(!p&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,N=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(d,100),function(){p=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),N!==null&&(N(),N=null)}}}function Dh(r){this._internalRoot=r}Ec.prototype.render=Dh.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(a(409));var d=o.current,p=ts();My(d,p,r,o,null,null)},Ec.prototype.unmount=Dh.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;My(r.current,2,null,r,null,null),oc(),o[Ks]=null}};function Ec(r){this._internalRoot=r}Ec.prototype.unstable_scheduleHydration=function(r){if(r){var o=ml();r={blockedOn:null,target:r,priority:o};for(var d=0;d<Va.length&&o!==0&&o<Va[d].priority;d++);Va.splice(d,0,r),d===0&&By(r)}};var Hy=t.version;if(Hy!=="19.2.4")throw Error(a(527,Hy,"19.2.4"));B.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(a(188)):(r=Object.keys(r).join(","),Error(a(268,r)));return r=h(o),r=r!==null?m(r):null,r=r===null?null:r.stateNode,r};var Ew={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cc.isDisabled&&Cc.supportsFiber)try{Je=Cc.inject(Ew),$e=Cc}catch{}}return Oo.createRoot=function(r,o){if(!i(r))throw Error(a(299));var d=!1,p="",N=Xp,w=Qp,R=Zp;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(N=o.onUncaughtError),o.onCaughtError!==void 0&&(w=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=Dy(r,1,!1,null,null,d,p,null,N,w,R,$y),r[Ks]=o.current,fh(r),new Dh(o)},Oo.hydrateRoot=function(r,o,d){if(!i(r))throw Error(a(299));var p=!1,N="",w=Xp,R=Qp,K=Zp,re=null;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(N=d.identifierPrefix),d.onUncaughtError!==void 0&&(w=d.onUncaughtError),d.onCaughtError!==void 0&&(R=d.onCaughtError),d.onRecoverableError!==void 0&&(K=d.onRecoverableError),d.formState!==void 0&&(re=d.formState)),o=Dy(r,1,!0,o,d??null,p,N,re,w,R,K,$y),o.context=Ry(null),d=o.current,p=ts(),p=Bi(p),N=ka(p),N.callback=null,Da(d,N,p),d=p,o.current.lanes=d,tr(o,d),$s(o),r[Ks]=o.current,fh(r),new Ec(o)},Oo.version="19.2.4",Oo}var ex;function Ow(){if(ex)return Ph.exports;ex=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ph.exports=Pw(),Ph.exports}var Lw=Ow();const Uw=Uf(Lw);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var tx="popstate";function Fw(e={}){function t(i,l){let{pathname:c="/",search:u="",hash:f=""}=Ir(i.location.hash.substring(1));return!c.startsWith("/")&&!c.startsWith(".")&&(c="/"+c),af("",{pathname:c,search:u,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function s(i,l){let c=i.document.querySelector("base"),u="";if(c&&c.getAttribute("href")){let f=i.location.href,h=f.indexOf("#");u=h===-1?f:f.slice(0,h)}return u+"#"+(typeof l=="string"?l:Jo(l))}function a(i,l){is(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return Gw(t,s,a,e)}function Vt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function is(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Bw(){return Math.random().toString(36).substring(2,10)}function nx(e,t){return{usr:e.state,key:e.key,idx:t}}function af(e,t,s=null,a){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Ir(t):t,state:s,key:t&&t.key||a||Bw()}}function Jo({pathname:e="/",search:t="",hash:s=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Ir(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substring(s),e=e.substring(0,s));let a=e.indexOf("?");a>=0&&(t.search=e.substring(a),e=e.substring(0,a)),e&&(t.pathname=e)}return t}function Gw(e,t,s,a={}){let{window:i=document.defaultView,v5Compat:l=!1}=a,c=i.history,u="POP",f=null,h=m();h==null&&(h=0,c.replaceState({...c.state,idx:h},""));function m(){return(c.state||{idx:null}).idx}function x(){u="POP";let j=m(),E=j==null?null:j-h;h=j,f&&f({action:u,location:_.location,delta:E})}function y(j,E){u="PUSH";let k=af(_.location,j,E);s&&s(k,j),h=m()+1;let C=nx(k,h),A=_.createHref(k);try{c.pushState(C,"",A)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(A)}l&&f&&f({action:u,location:_.location,delta:1})}function b(j,E){u="REPLACE";let k=af(_.location,j,E);s&&s(k,j),h=m();let C=nx(k,h),A=_.createHref(k);c.replaceState(C,"",A),l&&f&&f({action:u,location:_.location,delta:0})}function T(j){return zw(j)}let _={get action(){return u},get location(){return e(i,c)},listen(j){if(f)throw new Error("A history only accepts one active listener");return i.addEventListener(tx,x),f=j,()=>{i.removeEventListener(tx,x),f=null}},createHref(j){return t(i,j)},createURL:T,encodeLocation(j){let E=T(j);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:y,replace:b,go(j){return c.go(j)}};return _}function zw(e,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),Vt(s,"No window.location.(origin|href) available to create URL");let a=typeof e=="string"?e:Jo(e);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=s+a),new URL(a,s)}function Mv(e,t,s="/"){return $w(e,t,s,!1)}function $w(e,t,s,a){let i=typeof t=="string"?Ir(t):t,l=ga(i.pathname||"/",s);if(l==null)return null;let c=Pv(e);Hw(c);let u=null;for(let f=0;u==null&&f<c.length;++f){let h=tT(l);u=Zw(c[f],h,a)}return u}function Pv(e,t=[],s=[],a="",i=!1){let l=(c,u,f=i,h)=>{let m={relativePath:h===void 0?c.path||"":h,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(a)&&f)return;Vt(m.relativePath.startsWith(a),`Absolute route path "${m.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(a.length)}let x=ma([a,m.relativePath]),y=s.concat(m);c.children&&c.children.length>0&&(Vt(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${x}".`),Pv(c.children,t,y,x,f)),!(c.path==null&&!c.index)&&t.push({path:x,score:Xw(x,c.index),routesMeta:y})};return e.forEach((c,u)=>{var f;if(c.path===""||!((f=c.path)!=null&&f.includes("?")))l(c,u);else for(let h of Ov(c.path))l(c,u,!0,h)}),t}function Ov(e){let t=e.split("/");if(t.length===0)return[];let[s,...a]=t,i=s.endsWith("?"),l=s.replace(/\?$/,"");if(a.length===0)return i?[l,""]:[l];let c=Ov(a.join("/")),u=[];return u.push(...c.map(f=>f===""?l:[l,f].join("/"))),i&&u.push(...c),u.map(f=>e.startsWith("/")&&f===""?"/":f)}function Hw(e){e.sort((t,s)=>t.score!==s.score?s.score-t.score:Qw(t.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}var qw=/^:[\w-]+$/,Vw=3,Kw=2,Ww=1,Jw=10,Yw=-2,sx=e=>e==="*";function Xw(e,t){let s=e.split("/"),a=s.length;return s.some(sx)&&(a+=Yw),t&&(a+=Kw),s.filter(i=>!sx(i)).reduce((i,l)=>i+(qw.test(l)?Vw:l===""?Ww:Jw),a)}function Qw(e,t){return e.length===t.length&&e.slice(0,-1).every((a,i)=>a===t[i])?e[e.length-1]-t[t.length-1]:0}function Zw(e,t,s=!1){let{routesMeta:a}=e,i={},l="/",c=[];for(let u=0;u<a.length;++u){let f=a[u],h=u===a.length-1,m=l==="/"?t:t.slice(l.length)||"/",x=Jc({path:f.relativePath,caseSensitive:f.caseSensitive,end:h},m),y=f.route;if(!x&&h&&s&&!a[a.length-1].route.index&&(x=Jc({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!x)return null;Object.assign(i,x.params),c.push({params:i,pathname:ma([l,x.pathname]),pathnameBase:rT(ma([l,x.pathnameBase])),route:y}),x.pathnameBase!=="/"&&(l=ma([l,x.pathnameBase]))}return c}function Jc(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=eT(e.path,e.caseSensitive,e.end),i=t.match(s);if(!i)return null;let l=i[0],c=l.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:a.reduce((h,{paramName:m,isOptional:x},y)=>{if(m==="*"){let T=u[y]||"";c=l.slice(0,l.length-T.length).replace(/(.)\/+$/,"$1")}const b=u[y];return x&&!b?h[m]=void 0:h[m]=(b||"").replace(/%2F/g,"/"),h},{}),pathname:l,pathnameBase:c,pattern:e}}function eT(e,t=!1,s=!0){is(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let a=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,f)=>(a.push({paramName:u,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(a.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),a]}function tT(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return is(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function ga(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}var nT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function sT(e,t="/"){let{pathname:s,search:a="",hash:i=""}=typeof e=="string"?Ir(e):e,l;return s?(s=s.replace(/\/\/+/g,"/"),s.startsWith("/")?l=ax(s.substring(1),"/"):l=ax(s,t)):l=t,{pathname:l,search:iT(a),hash:oT(i)}}function ax(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function Fh(e,t,s,a){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function aT(e){return e.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Bf(e){let t=aT(e);return t.map((s,a)=>a===t.length-1?s.pathname:s.pathnameBase)}function Gf(e,t,s,a=!1){let i;typeof e=="string"?i=Ir(e):(i={...e},Vt(!i.pathname||!i.pathname.includes("?"),Fh("?","pathname","search",i)),Vt(!i.pathname||!i.pathname.includes("#"),Fh("#","pathname","hash",i)),Vt(!i.search||!i.search.includes("#"),Fh("#","search","hash",i)));let l=e===""||i.pathname==="",c=l?"/":i.pathname,u;if(c==null)u=s;else{let x=t.length-1;if(!a&&c.startsWith("..")){let y=c.split("/");for(;y[0]==="..";)y.shift(),x-=1;i.pathname=y.join("/")}u=x>=0?t[x]:"/"}let f=sT(i,u),h=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(h||m)&&(f.pathname+="/"),f}var ma=e=>e.join("/").replace(/\/\/+/g,"/"),rT=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),iT=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,oT=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,lT=class{constructor(e,t,s,a=!1){this.status=e,this.statusText=t||"",this.internal=a,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function cT(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function dT(e){return e.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Lv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Uv(e,t){let s=e;if(typeof s!="string"||!nT.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let a=s,i=!1;if(Lv)try{let l=new URL(window.location.href),c=s.startsWith("//")?new URL(l.protocol+s):new URL(s),u=ga(c.pathname,t);c.origin===l.origin&&u!=null?s=u+c.search+c.hash:i=!0}catch{is(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:i,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Fv=["POST","PUT","PATCH","DELETE"];new Set(Fv);var uT=["GET",...Fv];new Set(uT);var Ii=S.createContext(null);Ii.displayName="DataRouter";var cd=S.createContext(null);cd.displayName="DataRouterState";var hT=S.createContext(!1),Bv=S.createContext({isTransitioning:!1});Bv.displayName="ViewTransition";var fT=S.createContext(new Map);fT.displayName="Fetchers";var mT=S.createContext(null);mT.displayName="Await";var os=S.createContext(null);os.displayName="Navigation";var rl=S.createContext(null);rl.displayName="Location";var Ss=S.createContext({outlet:null,matches:[],isDataRoute:!1});Ss.displayName="Route";var zf=S.createContext(null);zf.displayName="RouteError";var Gv="REACT_ROUTER_ERROR",pT="REDIRECT",gT="ROUTE_ERROR_RESPONSE";function yT(e){if(e.startsWith(`${Gv}:${pT}:{`))try{let t=JSON.parse(e.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function xT(e){if(e.startsWith(`${Gv}:${gT}:{`))try{let t=JSON.parse(e.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new lT(t.status,t.statusText,t.data)}catch{}}function vT(e,{relative:t}={}){Vt(Ai(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:a}=S.useContext(os),{hash:i,pathname:l,search:c}=il(e,{relative:t}),u=l;return s!=="/"&&(u=l==="/"?s:ma([s,l])),a.createHref({pathname:u,search:c,hash:i})}function Ai(){return S.useContext(rl)!=null}function qs(){return Vt(Ai(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(rl).location}var zv="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function $v(e){S.useContext(os).static||S.useLayoutEffect(e)}function Ds(){let{isDataRoute:e}=S.useContext(Ss);return e?MT():bT()}function bT(){Vt(Ai(),"useNavigate() may be used only in the context of a <Router> component.");let e=S.useContext(Ii),{basename:t,navigator:s}=S.useContext(os),{matches:a}=S.useContext(Ss),{pathname:i}=qs(),l=JSON.stringify(Bf(a)),c=S.useRef(!1);return $v(()=>{c.current=!0}),S.useCallback((f,h={})=>{if(is(c.current,zv),!c.current)return;if(typeof f=="number"){s.go(f);return}let m=Gf(f,JSON.parse(l),i,h.relative==="path");e==null&&t!=="/"&&(m.pathname=m.pathname==="/"?t:ma([t,m.pathname])),(h.replace?s.replace:s.push)(m,h.state,h)},[t,s,l,i,e])}var NT=S.createContext(null);function ST(e){let t=S.useContext(Ss).outlet;return S.useMemo(()=>t&&S.createElement(NT.Provider,{value:e},t),[t,e])}function Hv(){let{matches:e}=S.useContext(Ss),t=e[e.length-1];return t?t.params:{}}function il(e,{relative:t}={}){let{matches:s}=S.useContext(Ss),{pathname:a}=qs(),i=JSON.stringify(Bf(s));return S.useMemo(()=>Gf(e,JSON.parse(i),a,t==="path"),[e,i,a,t])}function wT(e,t){return qv(e,t)}function qv(e,t,s,a,i){var k;Vt(Ai(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=S.useContext(os),{matches:c}=S.useContext(Ss),u=c[c.length-1],f=u?u.params:{},h=u?u.pathname:"/",m=u?u.pathnameBase:"/",x=u&&u.route;{let C=x&&x.path||"";Kv(h,!x||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let y=qs(),b;if(t){let C=typeof t=="string"?Ir(t):t;Vt(m==="/"||((k=C.pathname)==null?void 0:k.startsWith(m)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${C.pathname}" was given in the \`location\` prop.`),b=C}else b=y;let T=b.pathname||"/",_=T;if(m!=="/"){let C=m.replace(/^\//,"").split("/");_="/"+T.replace(/^\//,"").split("/").slice(C.length).join("/")}let j=Mv(e,{pathname:_});is(x||j!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),is(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=CT(j&&j.map(C=>Object.assign({},C,{params:Object.assign({},f,C.params),pathname:ma([m,l.encodeLocation?l.encodeLocation(C.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?m:ma([m,l.encodeLocation?l.encodeLocation(C.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathnameBase])})),c,s,a,i);return t&&E?S.createElement(rl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},E):E}function TT(){let e=RT(),t=cT(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,a="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:a},l={padding:"2px 4px",backgroundColor:a},c=null;return console.error("Error handled by React Router default ErrorBoundary:",e),c=S.createElement(S.Fragment,null,S.createElement("p",null," Hey developer "),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:l},"ErrorBoundary")," or"," ",S.createElement("code",{style:l},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},t),s?S.createElement("pre",{style:i},s):null,c)}var jT=S.createElement(TT,null),Vv=class extends S.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){const s=xT(e.digest);s&&(e=s)}let t=e!==void 0?S.createElement(Ss.Provider,{value:this.props.routeContext},S.createElement(zf.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?S.createElement(_T,{error:e},t):t}};Vv.contextType=hT;var Bh=new WeakMap;function _T({children:e,error:t}){let{basename:s}=S.useContext(os);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=yT(t.digest);if(a){let i=Bh.get(t);if(i)throw i;let l=Uv(a.location,s);if(Lv&&!Bh.get(t))if(l.isExternal||a.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:a.replace}));throw Bh.set(t,c),c}return S.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return e}function ET({routeContext:e,match:t,children:s}){let a=S.useContext(Ii);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),S.createElement(Ss.Provider,{value:e},s)}function CT(e,t=[],s=null,a=null,i=null){if(e==null){if(!s)return null;if(s.errors)e=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let l=e,c=s==null?void 0:s.errors;if(c!=null){let m=l.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);Vt(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,m+1))}let u=!1,f=-1;if(s)for(let m=0;m<l.length;m++){let x=l[m];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(f=m),x.route.id){let{loaderData:y,errors:b}=s,T=x.route.loader&&!y.hasOwnProperty(x.route.id)&&(!b||b[x.route.id]===void 0);if(x.route.lazy||T){u=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let h=s&&a?(m,x)=>{var y,b;a(m,{location:s.location,params:((b=(y=s.matches)==null?void 0:y[0])==null?void 0:b.params)??{},unstable_pattern:dT(s.matches),errorInfo:x})}:void 0;return l.reduceRight((m,x,y)=>{let b,T=!1,_=null,j=null;s&&(b=c&&x.route.id?c[x.route.id]:void 0,_=x.route.errorElement||jT,u&&(f<0&&y===0?(Kv("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,j=null):f===y&&(T=!0,j=x.route.hydrateFallbackElement||null)));let E=t.concat(l.slice(0,y+1)),k=()=>{let C;return b?C=_:T?C=j:x.route.Component?C=S.createElement(x.route.Component,null):x.route.element?C=x.route.element:C=m,S.createElement(ET,{match:x,routeContext:{outlet:m,matches:E,isDataRoute:s!=null},children:C})};return s&&(x.route.ErrorBoundary||x.route.errorElement||y===0)?S.createElement(Vv,{location:s.location,revalidation:s.revalidation,component:_,error:b,children:k(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:h}):k()},null)}function $f(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function IT(e){let t=S.useContext(Ii);return Vt(t,$f(e)),t}function AT(e){let t=S.useContext(cd);return Vt(t,$f(e)),t}function kT(e){let t=S.useContext(Ss);return Vt(t,$f(e)),t}function Hf(e){let t=kT(e),s=t.matches[t.matches.length-1];return Vt(s.route.id,`${e} can only be used on routes that contain a unique "id"`),s.route.id}function DT(){return Hf("useRouteId")}function RT(){var a;let e=S.useContext(zf),t=AT("useRouteError"),s=Hf("useRouteError");return e!==void 0?e:(a=t.errors)==null?void 0:a[s]}function MT(){let{router:e}=IT("useNavigate"),t=Hf("useNavigate"),s=S.useRef(!1);return $v(()=>{s.current=!0}),S.useCallback(async(i,l={})=>{is(s.current,zv),s.current&&(typeof i=="number"?await e.navigate(i):await e.navigate(i,{fromRouteId:t,...l}))},[e,t])}var rx={};function Kv(e,t,s){!t&&!rx[e]&&(rx[e]=!0,is(!1,s))}S.memo(PT);function PT({routes:e,future:t,state:s,onError:a}){return qv(e,void 0,s,a,t)}function Ho({to:e,replace:t,state:s,relative:a}){Vt(Ai(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=S.useContext(os);is(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=S.useContext(Ss),{pathname:c}=qs(),u=Ds(),f=Gf(e,Bf(l),c,a==="path"),h=JSON.stringify(f);return S.useEffect(()=>{u(JSON.parse(h),{replace:t,state:s,relative:a})},[u,h,a,t,s]),null}function Wv(e){return ST(e.context)}function nt(e){Vt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function OT({basename:e="/",children:t=null,location:s,navigationType:a="POP",navigator:i,static:l=!1,unstable_useTransitions:c}){Vt(!Ai(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=e.replace(/^\/*/,"/"),f=S.useMemo(()=>({basename:u,navigator:i,static:l,unstable_useTransitions:c,future:{}}),[u,i,l,c]);typeof s=="string"&&(s=Ir(s));let{pathname:h="/",search:m="",hash:x="",state:y=null,key:b="default"}=s,T=S.useMemo(()=>{let _=ga(h,u);return _==null?null:{location:{pathname:_,search:m,hash:x,state:y,key:b},navigationType:a}},[u,h,m,x,y,b,a]);return is(T!=null,`<Router basename="${u}"> is not able to match the URL "${h}${m}${x}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:S.createElement(os.Provider,{value:f},S.createElement(rl.Provider,{children:t,value:T}))}function LT({children:e,location:t}){return wT(rf(e),t)}function rf(e,t=[]){let s=[];return S.Children.forEach(e,(a,i)=>{if(!S.isValidElement(a))return;let l=[...t,i];if(a.type===S.Fragment){s.push.apply(s,rf(a.props.children,l));return}Vt(a.type===nt,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Vt(!a.props.index||!a.props.children,"An index route cannot have child routes.");let c={id:a.props.id||l.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,middleware:a.props.middleware,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(c.children=rf(a.props.children,l)),s.push(c)}),s}var qc="get",Vc="application/x-www-form-urlencoded";function dd(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function UT(e){return dd(e)&&e.tagName.toLowerCase()==="button"}function FT(e){return dd(e)&&e.tagName.toLowerCase()==="form"}function BT(e){return dd(e)&&e.tagName.toLowerCase()==="input"}function GT(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function zT(e,t){return e.button===0&&(!t||t==="_self")&&!GT(e)}function of(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,s)=>{let a=e[s];return t.concat(Array.isArray(a)?a.map(i=>[s,i]):[[s,a]])},[]))}function $T(e,t){let s=of(e);return t&&t.forEach((a,i)=>{s.has(i)||t.getAll(i).forEach(l=>{s.append(i,l)})}),s}var Ic=null;function HT(){if(Ic===null)try{new FormData(document.createElement("form"),0),Ic=!1}catch{Ic=!0}return Ic}var qT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Gh(e){return e!=null&&!qT.has(e)?(is(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Vc}"`),null):e}function VT(e,t){let s,a,i,l,c;if(FT(e)){let u=e.getAttribute("action");a=u?ga(u,t):null,s=e.getAttribute("method")||qc,i=Gh(e.getAttribute("enctype"))||Vc,l=new FormData(e)}else if(UT(e)||BT(e)&&(e.type==="submit"||e.type==="image")){let u=e.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=e.getAttribute("formaction")||u.getAttribute("action");if(a=f?ga(f,t):null,s=e.getAttribute("formmethod")||u.getAttribute("method")||qc,i=Gh(e.getAttribute("formenctype"))||Gh(u.getAttribute("enctype"))||Vc,l=new FormData(u,e),!HT()){let{name:h,type:m,value:x}=e;if(m==="image"){let y=h?`${h}.`:"";l.append(`${y}x`,"0"),l.append(`${y}y`,"0")}else h&&l.append(h,x)}}else{if(dd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=qc,a=null,i=Vc,c=e}return l&&i==="text/plain"&&(c=l,l=void 0),{action:a,method:s.toLowerCase(),encType:i,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function qf(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function KT(e,t,s,a){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return s?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${a}`:i.pathname=`${i.pathname}.${a}`:i.pathname==="/"?i.pathname=`_root.${a}`:t&&ga(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${a}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${a}`,i}async function WT(e,t){if(e.id in t)return t[e.id];try{let s=await import(e.module);return t[e.id]=s,s}catch(s){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function JT(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function YT(e,t,s){let a=await Promise.all(e.map(async i=>{let l=t.routes[i.route.id];if(l){let c=await WT(l,s);return c.links?c.links():[]}return[]}));return ej(a.flat(1).filter(JT).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function ix(e,t,s,a,i,l){let c=(f,h)=>s[h]?f.route.id!==s[h].route.id:!0,u=(f,h)=>{var m;return s[h].pathname!==f.pathname||((m=s[h].route.path)==null?void 0:m.endsWith("*"))&&s[h].params["*"]!==f.params["*"]};return l==="assets"?t.filter((f,h)=>c(f,h)||u(f,h)):l==="data"?t.filter((f,h)=>{var x;let m=a.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(c(f,h)||u(f,h))return!0;if(f.route.shouldRevalidate){let y=f.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((x=s[0])==null?void 0:x.params)||{},nextUrl:new URL(e,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof y=="boolean")return y}return!0}):[]}function XT(e,t,{includeHydrateFallback:s}={}){return QT(e.map(a=>{let i=t.routes[a.route.id];if(!i)return[];let l=[i.module];return i.clientActionModule&&(l=l.concat(i.clientActionModule)),i.clientLoaderModule&&(l=l.concat(i.clientLoaderModule)),s&&i.hydrateFallbackModule&&(l=l.concat(i.hydrateFallbackModule)),i.imports&&(l=l.concat(i.imports)),l}).flat(1))}function QT(e){return[...new Set(e)]}function ZT(e){let t={},s=Object.keys(e).sort();for(let a of s)t[a]=e[a];return t}function ej(e,t){let s=new Set;return new Set(t),e.reduce((a,i)=>{let l=JSON.stringify(ZT(i));return s.has(l)||(s.add(l),a.push({key:l,link:i})),a},[])}function Jv(){let e=S.useContext(Ii);return qf(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tj(){let e=S.useContext(cd);return qf(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var Vf=S.createContext(void 0);Vf.displayName="FrameworkContext";function Yv(){let e=S.useContext(Vf);return qf(e,"You must render this element inside a <HydratedRouter> element"),e}function nj(e,t){let s=S.useContext(Vf),[a,i]=S.useState(!1),[l,c]=S.useState(!1),{onFocus:u,onBlur:f,onMouseEnter:h,onMouseLeave:m,onTouchStart:x}=t,y=S.useRef(null);S.useEffect(()=>{if(e==="render"&&c(!0),e==="viewport"){let _=E=>{E.forEach(k=>{c(k.isIntersecting)})},j=new IntersectionObserver(_,{threshold:.5});return y.current&&j.observe(y.current),()=>{j.disconnect()}}},[e]),S.useEffect(()=>{if(a){let _=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(_)}}},[a]);let b=()=>{i(!0)},T=()=>{i(!1),c(!1)};return s?e!=="intent"?[l,y,{}]:[l,y,{onFocus:Lo(u,b),onBlur:Lo(f,T),onMouseEnter:Lo(h,b),onMouseLeave:Lo(m,T),onTouchStart:Lo(x,b)}]:[!1,y,{}]}function Lo(e,t){return s=>{e&&e(s),s.defaultPrevented||t(s)}}function sj({page:e,...t}){let{router:s}=Jv(),a=S.useMemo(()=>Mv(s.routes,e,s.basename),[s.routes,e,s.basename]);return a?S.createElement(rj,{page:e,matches:a,...t}):null}function aj(e){let{manifest:t,routeModules:s}=Yv(),[a,i]=S.useState([]);return S.useEffect(()=>{let l=!1;return YT(e,t,s).then(c=>{l||i(c)}),()=>{l=!0}},[e,t,s]),a}function rj({page:e,matches:t,...s}){let a=qs(),{future:i,manifest:l,routeModules:c}=Yv(),{basename:u}=Jv(),{loaderData:f,matches:h}=tj(),m=S.useMemo(()=>ix(e,t,h,l,a,"data"),[e,t,h,l,a]),x=S.useMemo(()=>ix(e,t,h,l,a,"assets"),[e,t,h,l,a]),y=S.useMemo(()=>{if(e===a.pathname+a.search+a.hash)return[];let _=new Set,j=!1;if(t.forEach(k=>{var A;let C=l.routes[k.route.id];!C||!C.hasLoader||(!m.some(M=>M.route.id===k.route.id)&&k.route.id in f&&((A=c[k.route.id])!=null&&A.shouldRevalidate)||C.hasClientLoader?j=!0:_.add(k.route.id))}),_.size===0)return[];let E=KT(e,u,i.unstable_trailingSlashAwareDataRequests,"data");return j&&_.size>0&&E.searchParams.set("_routes",t.filter(k=>_.has(k.route.id)).map(k=>k.route.id).join(",")),[E.pathname+E.search]},[u,i.unstable_trailingSlashAwareDataRequests,f,a,l,m,t,e,c]),b=S.useMemo(()=>XT(x,l),[x,l]),T=aj(x);return S.createElement(S.Fragment,null,y.map(_=>S.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...s})),b.map(_=>S.createElement("link",{key:_,rel:"modulepreload",href:_,...s})),T.map(({key:_,link:j})=>S.createElement("link",{key:_,nonce:s.nonce,...j,crossOrigin:j.crossOrigin??s.crossOrigin})))}function ij(...e){return t=>{e.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var oj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{oj&&(window.__reactRouterVersion="7.13.0")}catch{}function lj({basename:e,children:t,unstable_useTransitions:s,window:a}){let i=S.useRef();i.current==null&&(i.current=Fw({window:a,v5Compat:!0}));let l=i.current,[c,u]=S.useState({action:l.action,location:l.location}),f=S.useCallback(h=>{s===!1?u(h):S.startTransition(()=>u(h))},[s]);return S.useLayoutEffect(()=>l.listen(f),[l,f]),S.createElement(OT,{basename:e,children:t,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:s})}var Xv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bs=S.forwardRef(function({onClick:t,discover:s="render",prefetch:a="none",relative:i,reloadDocument:l,replace:c,state:u,target:f,to:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:y,...b},T){let{basename:_,unstable_useTransitions:j}=S.useContext(os),E=typeof h=="string"&&Xv.test(h),k=Uv(h,_);h=k.to;let C=vT(h,{relative:i}),[A,M,I]=nj(a,b),P=uj(h,{replace:c,state:u,target:f,preventScrollReset:m,relative:i,viewTransition:x,unstable_defaultShouldRevalidate:y,unstable_useTransitions:j});function D(O){t&&t(O),O.defaultPrevented||P(O)}let U=S.createElement("a",{...b,...I,href:k.absoluteURL||C,onClick:k.isExternal||l?t:D,ref:ij(T,M),target:f,"data-discover":!E&&s==="render"?"true":void 0});return A&&!E?S.createElement(S.Fragment,null,U,S.createElement(sj,{page:C})):U});bs.displayName="Link";var Qv=S.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:a="",end:i=!1,style:l,to:c,viewTransition:u,children:f,...h},m){let x=il(c,{relative:h.relative}),y=qs(),b=S.useContext(cd),{navigator:T,basename:_}=S.useContext(os),j=b!=null&&gj(x)&&u===!0,E=T.encodeLocation?T.encodeLocation(x).pathname:x.pathname,k=y.pathname,C=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;s||(k=k.toLowerCase(),C=C?C.toLowerCase():null,E=E.toLowerCase()),C&&_&&(C=ga(C,_)||C);const A=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let M=k===E||!i&&k.startsWith(E)&&k.charAt(A)==="/",I=C!=null&&(C===E||!i&&C.startsWith(E)&&C.charAt(E.length)==="/"),P={isActive:M,isPending:I,isTransitioning:j},D=M?t:void 0,U;typeof a=="function"?U=a(P):U=[a,M?"active":null,I?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let O=typeof l=="function"?l(P):l;return S.createElement(bs,{...h,"aria-current":D,className:U,ref:m,style:O,to:c,viewTransition:u},typeof f=="function"?f(P):f)});Qv.displayName="NavLink";var cj=S.forwardRef(({discover:e="render",fetcherKey:t,navigate:s,reloadDocument:a,replace:i,state:l,method:c=qc,action:u,onSubmit:f,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:y,...b},T)=>{let{unstable_useTransitions:_}=S.useContext(os),j=mj(),E=pj(u,{relative:h}),k=c.toLowerCase()==="get"?"get":"post",C=typeof u=="string"&&Xv.test(u),A=M=>{if(f&&f(M),M.defaultPrevented)return;M.preventDefault();let I=M.nativeEvent.submitter,P=(I==null?void 0:I.getAttribute("formmethod"))||c,D=()=>j(I||M.currentTarget,{fetcherKey:t,method:P,navigate:s,replace:i,state:l,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:y});_&&s!==!1?S.startTransition(()=>D()):D()};return S.createElement("form",{ref:T,method:k,action:E,onSubmit:a?f:A,...b,"data-discover":!C&&e==="render"?"true":void 0})});cj.displayName="Form";function dj(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Zv(e){let t=S.useContext(Ii);return Vt(t,dj(e)),t}function uj(e,{target:t,replace:s,state:a,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:u,unstable_useTransitions:f}={}){let h=Ds(),m=qs(),x=il(e,{relative:l});return S.useCallback(y=>{if(zT(y,t)){y.preventDefault();let b=s!==void 0?s:Jo(m)===Jo(x),T=()=>h(e,{replace:b,state:a,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:u});f?S.startTransition(()=>T()):T()}},[m,h,x,s,a,t,e,i,l,c,u,f])}function Kf(e){is(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=S.useRef(of(e)),s=S.useRef(!1),a=qs(),i=S.useMemo(()=>$T(a.search,s.current?null:t.current),[a.search]),l=Ds(),c=S.useCallback((u,f)=>{const h=of(typeof u=="function"?u(new URLSearchParams(i)):u);s.current=!0,l("?"+h,f)},[l,i]);return[i,c]}var hj=0,fj=()=>`__${String(++hj)}__`;function mj(){let{router:e}=Zv("useSubmit"),{basename:t}=S.useContext(os),s=DT(),a=e.fetch,i=e.navigate;return S.useCallback(async(l,c={})=>{let{action:u,method:f,encType:h,formData:m,body:x}=VT(l,t);if(c.navigate===!1){let y=c.fetcherKey||fj();await a(y,s,c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,flushSync:c.flushSync})}else await i(c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,replace:c.replace,state:c.state,fromRouteId:s,flushSync:c.flushSync,viewTransition:c.viewTransition})},[a,i,t,s])}function pj(e,{relative:t}={}){let{basename:s}=S.useContext(os),a=S.useContext(Ss);Vt(a,"useFormAction must be used inside a RouteContext");let[i]=a.matches.slice(-1),l={...il(e||".",{relative:t})},c=qs();if(e==null){l.search=c.search;let u=new URLSearchParams(l.search),f=u.getAll("index");if(f.some(m=>m==="")){u.delete("index"),f.filter(x=>x).forEach(x=>u.append("index",x));let m=u.toString();l.search=m?`?${m}`:""}}return(!e||e===".")&&i.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(l.pathname=l.pathname==="/"?s:ma([s,l.pathname])),Jo(l)}function gj(e,{relative:t}={}){let s=S.useContext(Bv);Vt(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=Zv("useViewTransitionState"),i=il(e,{relative:t});if(!s.isTransitioning)return!1;let l=ga(s.currentLocation.pathname,a)||s.currentLocation.pathname,c=ga(s.nextLocation.pathname,a)||s.nextLocation.pathname;return Jc(i.pathname,c)!=null||Jc(i.pathname,l)!=null}var yj=Rv(),Yc=(e=>(e.EN="en",e.FR="fr",e))(Yc||{}),Yo=(e=>(e.PENDING="PENDING",e.ACCEPTED="ACCEPTED",e.EXPIRED="EXPIRED",e))(Yo||{}),Wf=(e=>(e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE",e))(Wf||{}),Hs=(e=>(e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE",e))(Hs||{}),Jf=(e=>(e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE",e))(Jf||{}),Wt=(e=>(e.FARMER="FARMER",e.EMPLOYEE="EMPLOYEE",e.SERVICE_PROVIDER="SERVICE_PROVIDER",e))(Wt||{}),Ye=(e=>(e.CREATED="CREATED",e.FREE="FREE",e.ASSIGNED="ASSIGNED",e.CUTTING="CUTTING",e.PLANTED="PLANTED",e.GROWING="GROWING",e.HARVESTED="HARVESTED",e.DRYING="DRYING",e.BAGGING="BAGGING",e.BAGGED="BAGGED",e.IN_STOCK="IN_STOCK",e.EXPORTED="EXPORTED",e.MAINTENANCE="MAINTENANCE",e.STORED="STORED",e))(Ye||{}),ss=(e=>(e.INITIAL_STOCK="INITIAL_STOCK",e.BAGGING_TRANSFER="BAGGING_TRANSFER",e.EXPORT_OUT="EXPORT_OUT",e.FARMER_DELIVERY="FARMER_DELIVERY",e.PRESSING_OUT="PRESSING_OUT",e.PRESSING_IN="PRESSING_IN",e.SITE_TRANSFER_IN="SITE_TRANSFER_IN",e.SITE_TRANSFER_OUT="SITE_TRANSFER_OUT",e.ADJUSTMENT_IN="ADJUSTMENT_IN",e.ADJUSTMENT_OUT="ADJUSTMENT_OUT",e))(ss||{}),mt=(e=>(e.INITIAL_STOCK="INITIAL_STOCK",e.PRESSING_IN="PRESSING_IN",e.EXPORT_OUT="EXPORT_OUT",e.RETURN_TO_SITE="RETURN_TO_SITE",e.BULK_IN_FROM_SITE="BULK_IN_FROM_SITE",e.PRESSING_CONSUMPTION="PRESSING_CONSUMPTION",e.FARMER_DELIVERY="FARMER_DELIVERY",e.ADJUSTMENT_IN="ADJUSTMENT_IN",e.ADJUSTMENT_OUT="ADJUSTMENT_OUT",e))(mt||{}),lf=(e=>(e.COMMERCIAL_INVOICE="COMMERCIAL_INVOICE",e.PACKING_LIST="PACKING_LIST",e.CERTIFICATE_OF_ORIGIN="CERTIFICATE_OF_ORIGIN",e))(lf||{}),cf=(e=>(e.GP20="20' GP",e.GP40="40' GP",e.HC40="40' HC",e))(cf||{}),Gt=(e=>(e.AWAITING_OUTBOUND="AWAITING_OUTBOUND",e.IN_TRANSIT="IN_TRANSIT",e.PENDING_RECEPTION="PENDING_RECEPTION",e.COMPLETED="COMPLETED",e.CANCELLED="CANCELLED",e))(Gt||{}),vs=(e=>(e.OPEN="OPEN",e.IN_PROGRESS="IN_PROGRESS",e.RESOLVED="RESOLVED",e.CLOSED="CLOSED",e))(vs||{});const _e={DASHBOARD_VIEW:"dashboard:view",OPERATIONS_VIEW:"operations:view",FARM_MAP_VIEW:"farmmap:view",OPERATIONAL_CALENDAR_VIEW:"calendar:view",SITES_VIEW:"sites:view",SITES_MANAGE:"sites:manage",SEAWEED_TYPES_VIEW:"seaweed_types:view",SEAWEED_TYPES_MANAGE:"seaweed_types:manage",MODULES_VIEW:"modules:view",MODULES_MANAGE:"modules:manage",CUTTING_OPERATIONS_VIEW:"cutting_operations:view",CUTTING_OPERATIONS_MANAGE:"cutting_operations:manage",CYCLES_VIEW:"cycles:view",CYCLES_MANAGE:"cycles:manage",HARVESTING_VIEW:"harvesting:view",HARVESTING_MANAGE:"harvesting:manage",DRYING_VIEW:"drying:view",DRYING_MANAGE:"drying:manage",BAGGING_VIEW:"bagging:view",BAGGING_MANAGE:"bagging:manage",INVENTORY_VIEW:"inventory:view",INVENTORY_MANAGE_ON_SITE:"inventory:manage:on_site",INVENTORY_MANAGE_DELIVERIES:"inventory:manage:deliveries",INVENTORY_MANAGE_TRANSFERS:"inventory:manage:transfers",INVENTORY_MANAGE_WAREHOUSE:"inventory:manage:warehouse",EXPORTS_VIEW:"exports:view",EXPORTS_MANAGE:"exports:manage",STAKEHOLDERS_VIEW:"stakeholders:view",FARMERS_VIEW:"farmers:view",FARMERS_MANAGE:"farmers:manage",EMPLOYEES_VIEW:"employees:view",EMPLOYEES_MANAGE:"employees:manage",PROVIDERS_VIEW:"providers:view",PROVIDERS_MANAGE:"providers:manage",CREDITS_VIEW:"credits:view",CREDITS_MANAGE:"credits:manage",PAYMENTS_VIEW:"payments:view",PAYMENTS_MANAGE:"payments:manage",PAYROLL_VIEW:"payroll:view",PAYROLL_MANAGE:"payroll:manage",MONITORING_VIEW:"monitoring:view",TESTS_VIEW:"tests:view",TESTS_MANAGE:"tests:manage",INCIDENTS_VIEW:"incidents:view",INCIDENTS_MANAGE:"incidents:manage",GALLERY_VIEW:"gallery:view",GALLERY_MANAGE:"gallery:manage",REPORTS_VIEW:"reports:view",SETTINGS_VIEW:"settings:view",SETTINGS_GENERAL_MANAGE:"settings:general:manage",USERS_VIEW:"users:view",USERS_INVITE:"users:invite",ROLES_VIEW:"roles:view",ROLES_MANAGE:"roles:manage",INCIDENT_SETTINGS_MANAGE:"settings:incidents:manage"},eb=[{name:"Dashboard",permissions:[{id:_e.DASHBOARD_VIEW,label:"View Dashboard"}]},{name:"Operations",permissions:[{id:_e.OPERATIONS_VIEW,label:"View Operations Menu"},{id:_e.FARM_MAP_VIEW,label:"View Farm Map"},{id:_e.OPERATIONAL_CALENDAR_VIEW,label:"View Calendar"},{id:_e.SITES_VIEW,label:"View Sites"},{id:_e.SITES_MANAGE,label:"Manage Sites"},{id:_e.SEAWEED_TYPES_VIEW,label:"View Seaweed Types"},{id:_e.SEAWEED_TYPES_MANAGE,label:"Manage Seaweed Types"},{id:_e.MODULES_VIEW,label:"View Modules"},{id:_e.MODULES_MANAGE,label:"Manage Modules"},{id:_e.CUTTING_OPERATIONS_VIEW,label:"View Cutting Operations"},{id:_e.CUTTING_OPERATIONS_MANAGE,label:"Manage Cutting Operations"},{id:_e.CYCLES_VIEW,label:"View Cultivation Cycles"},{id:_e.CYCLES_MANAGE,label:"Manage Cultivation Cycles"},{id:_e.HARVESTING_VIEW,label:"View Harvesting"},{id:_e.HARVESTING_MANAGE,label:"Manage Harvesting"},{id:_e.DRYING_VIEW,label:"View Drying"},{id:_e.DRYING_MANAGE,label:"Manage Drying"},{id:_e.BAGGING_VIEW,label:"View Bagging"},{id:_e.BAGGING_MANAGE,label:"Manage Bagging"}]},{name:"Inventory",permissions:[{id:_e.INVENTORY_VIEW,label:"View Inventory Menu"},{id:_e.INVENTORY_MANAGE_ON_SITE,label:"Manage On-Site Storage"},{id:_e.INVENTORY_MANAGE_DELIVERIES,label:"Manage Farmer Deliveries"},{id:_e.INVENTORY_MANAGE_TRANSFERS,label:"Manage Site Transfers"},{id:_e.INVENTORY_MANAGE_WAREHOUSE,label:"Manage Pressing Warehouse"},{id:_e.EXPORTS_VIEW,label:"View Exports"},{id:_e.EXPORTS_MANAGE,label:"Manage Exports"}]},{name:"Stakeholders & Payments",permissions:[{id:_e.STAKEHOLDERS_VIEW,label:"View Stakeholders Menu"},{id:_e.FARMERS_VIEW,label:"View Farmers"},{id:_e.FARMERS_MANAGE,label:"Manage Farmers"},{id:_e.EMPLOYEES_VIEW,label:"View Employees"},{id:_e.EMPLOYEES_MANAGE,label:"Manage Employees"},{id:_e.PROVIDERS_VIEW,label:"View Service Providers"},{id:_e.PROVIDERS_MANAGE,label:"Manage Service Providers"},{id:_e.CREDITS_VIEW,label:"View Farmer Credits"},{id:_e.CREDITS_MANAGE,label:"Manage Farmer Credits"},{id:_e.PAYMENTS_VIEW,label:"View Payments"},{id:_e.PAYMENTS_MANAGE,label:"Manage Payments"},{id:_e.PAYROLL_VIEW,label:"View Payroll"},{id:_e.PAYROLL_MANAGE,label:"Manage Payroll"}]},{name:"Monitoring",permissions:[{id:_e.MONITORING_VIEW,label:"View Monitoring Menu"},{id:_e.TESTS_VIEW,label:"View Periodic Tests"},{id:_e.TESTS_MANAGE,label:"Manage Periodic Tests"},{id:_e.INCIDENTS_VIEW,label:"View Incidents"},{id:_e.INCIDENTS_MANAGE,label:"Manage Incidents"},{id:_e.GALLERY_VIEW,label:"View Photo Gallery"},{id:_e.GALLERY_MANAGE,label:"Manage Photo Gallery"}]},{name:"Reports",permissions:[{id:_e.REPORTS_VIEW,label:"View Reports"}]},{name:"Settings",permissions:[{id:_e.SETTINGS_VIEW,label:"View Settings Menu"},{id:_e.SETTINGS_GENERAL_MANAGE,label:"Manage General Settings"},{id:_e.USERS_VIEW,label:"View Users"},{id:_e.USERS_INVITE,label:"Invite New Users"},{id:_e.ROLES_VIEW,label:"View Roles"},{id:_e.ROLES_MANAGE,label:"Manage Roles & Permissions"},{id:_e.INCIDENT_SETTINGS_MANAGE,label:"Manage Incident Settings"}]}],Xc=[{id:"dark-formal",name:"Dark Formal",className:"dark",font:"font-serif"},{id:"dark-glass",name:"Dark Glass",className:"dark glass-dark",font:"font-sans"},{id:"light-formal",name:"Light Formal",className:"light",font:"font-serif"},{id:"light-glass",name:"Light Glass",className:"light glass-light",font:"font-sans"}],tb=[{value:.01,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}],ox=[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"}],xj={company:{logoUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMjAgNjAiIHdpZHRoPSIyMjAiIGhlaWdodD0iNjAiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMDZiNmQ0O3N0b3Atb3BhY2l0eToxIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzA4OTFiMjtzdG9wLW9wYWNpdHk6MSIgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48c3R5bGU+LmxvZ28tdGV4dCB7IGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCAnUm9ib3RvJywgJ0hlbHZldGljYSBOZXVlJywgc2Fucy1zZXJpZjsgZm9udC1zaXplOiAzMnB4OyBmb250LXdlaWdodDogNjAwOyBmaWxsOiB1cmwoI2dyYWQxKTsgfTwvc3R5bGU+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAsIDEwKSI+PHBhdGggZD0iTTE1LDAgQzUsNSA1LDE1IDE1LDIwIFMyNSwyNSAxNSwzMCBDNSwzNSA1LDQ1IDE1LDUwIiBzdHJva2U9Im5vbmUiIGZpbGw9IiMwODkxYjIiIHRyYW5zZm9ybT0ic2NhbGUoMC44KSB0cmFuc2xhdGUoMCwgLTUpIi8+PHBhdGggZD0iTTIwLDAgQzEwLDUgMTAsMTUgMjAsMjAgUzMwLDI1IDIwLDMwIEMxMCwzNSAxMCw0NSAyMCw1MCIgc3Ryb2tlPSJub25lIiBmaWxsPSIjMDZiNmQ0IiB0cmFuc2Zvcm09InNjYWxlKDAuNykgdHJhbnNsYXRlKDUsIC01KSIvPjwvZz48dGV4dCB4PSI1MCIgeT0iNDAiIGNsYXNzPSJsb2dvLXRleHQiPlNFQUZBUk08L3RleHQ+PC9zdmc+",name:"OceanReef Seaweed Inc.",phone:"+1 (555) 123-4567",email:"contact@oceanreef.com",address:"123 Ocean Drive, Marine City, MC 45678",nif:"123456789",rc:"RC/XYZ/2024/001",stat:"STAT-98765",capital:1e6},localization:{country:"US",currency:"USD",currencySymbol:"$",thousandsSeparator:",",decimalSeparator:".",monetaryDecimals:2,nonMonetaryDecimals:2,denominations:tb.map(e=>({id:`d-${e.value}-${e.type}`,...e})),coordinateFormat:"DMS"},theme:Xc[0],language:Yc.EN},Jt=[{code:"BR",name:"Brazil",currency:"BRL",symbol:"R$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"}]},{code:"CA",name:"Canada",currency:"CAD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"CL",name:"Chile",currency:"CLP",symbol:"$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}]},{code:"CN",name:"China",currency:"CNY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.1,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"FR",name:"France",currency:"EUR",symbol:"",thousandsSeparator:" ",decimalSeparator:",",denominations:ox},{code:"IN",name:"India",currency:"INR",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:2e3,type:"banknote"}]},{code:"ID",name:"Indonesia",currency:"IDR",symbol:"Rp",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"}]},{code:"IE",name:"Ireland",currency:"EUR",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:ox},{code:"JP",name:"Japan",currency:"JPY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"MG",name:"Madagascar",currency:"MGA",symbol:"Ar",thousandsSeparator:" ",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"coin"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}],payroll:{constants:{socialContributions:[{key:"cnaps",rate:.01,cap:2041600},{key:"sanitary",rate:.01,cap:2041600}],incomeTax:{brackets:[{from:0,to:35e4,rate:0},{from:35e4,to:4e5,rate:.05},{from:4e5,to:5e5,rate:.1},{from:5e5,to:6e5,rate:.15},{from:6e5,to:1/0,rate:.2}],minimumPerception:3e3}},labels:{socialContributions:[{key:"cnaps",label:"CNaPS"},{key:"sanitary",label:"OSTIE / SANITAIRE"}],incomeTax:"IRSA"}}},{code:"MY",name:"Malaysia",currency:"MYR",symbol:"RM",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"KP",name:"North Korea",currency:"KPW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"}]},{code:"NO",name:"Norway",currency:"NOK",symbol:"kr",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"PH",name:"Philippines",currency:"PHP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"KR",name:"South Korea",currency:"KRW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:5e4,type:"banknote"}]},{code:"TZ",name:"Tanzania",currency:"TZS",symbol:"TSh",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:50,type:"coin"},{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"GB",name:"United Kingdom",currency:"GBP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"}]},{code:"US",name:"United States",currency:"USD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:tb},{code:"VN",name:"Vietnam",currency:"VND",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:2e3,type:"coin"},{value:5e3,type:"coin"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"},{value:2e5,type:"banknote"},{value:5e5,type:"banknote"}]}],lx=["EXW (Ex Works)","FCA (Free Carrier)","CPT (Carriage Paid To)","CIP (Carriage and Insurance Paid To)","DAP (Delivered at Place)","DPU (Delivered at Place Unloaded)","DDP (Delivered Duty Paid)","FAS (Free Alongside Ship)","FOB (Free on Board)","CFR (Cost and Freight)","CIF (Cost, Insurance and Freight)"],cx=["Cash in Advance (Prepayment)","Letter of Credit (L/C)","Documentary Collection (D/C)","Open Account (O/A)","Consignment"],vj=[{label:{en:"Dashboard",fr:"Tableau de bord"},path:"/dashboard",icon:"Home",permission:_e.DASHBOARD_VIEW},{label:{en:"Operations",fr:"Oprations"},icon:"Layers",permission:_e.OPERATIONS_VIEW,children:[{label:{en:"Farm Map",fr:"Carte de la ferme"},path:"/operations/map",icon:"Map"},{label:{en:"Operational Calendar",fr:"Calendrier Oprationnel"},path:"/operations/calendar",icon:"Calendar"},{label:{en:"Production Sites",fr:"Sites de production"},path:"/sites",icon:"MapPin"},{label:{en:"Seaweed Types",fr:"Types d'algues"},path:"/seaweed-types",icon:"Beaker"},{label:{en:"Module Management",fr:"Gestion des modules"},path:"/modules",icon:"Grid"},{label:{en:"Cutting Operations",fr:"Oprations de coupe"},path:"/operations/cutting",icon:"Scissors"},{label:{en:"Cultivation Cycle",fr:"Cycle de culture"},path:"/cultivation",icon:"GitBranch"},{label:{en:"Harvest & Processing",fr:"Rcolte et traitement"},path:"/harvesting",icon:"Scissors"},{label:{en:"Drying Management",fr:"Gestion du schage"},path:"/drying",icon:"Wind"},{label:{en:"Bagging",fr:"Mise en sac"},path:"/bagging",icon:"Archive"}]},{label:{en:"Inventory",fr:"Inventaire"},icon:"Package",permission:_e.INVENTORY_VIEW,children:[{label:{en:"On-Site Storage",fr:"Stockage sur site"},path:"/inventory/on-site-storage",icon:"Warehouse"},{label:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},path:"/inventory/farmer-deliveries",icon:"Truck"},{label:{en:"Shipping Slips",fr:"Bons d'expdition"},path:"/inventory/site-transfers",icon:"ArrowRightLeft"},{label:{en:"Pressing Warehouse",fr:"Magasin de presse"},path:"/inventory/pressed-warehouse",icon:"Building"},{label:{en:"Exports",fr:"Exportations"},path:"/exports",icon:"Globe"}]},{label:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},icon:"Users",permission:_e.STAKEHOLDERS_VIEW,children:[{label:{en:"Farmer Management",fr:"Gestion des fermiers"},path:"/farmers",icon:"User"},{label:{en:"Employee Management",fr:"Gestion des employs"},path:"/employees",icon:"Briefcase"},{label:{en:"Service Providers",fr:"Prestataires de services"},path:"/providers",icon:"Truck"},{label:{en:"Farmer Credits",fr:"Crdits fermiers"},path:"/farmer-credits",icon:"CreditCard"},{label:{en:"Document Payments",fr:"Paiements sur document"},path:"/document-payments",icon:"FileText"}]},{label:{en:"Monitoring",fr:"Suivi"},icon:"Activity",permission:_e.MONITORING_VIEW,children:[{label:{en:"Periodic Tests",fr:"Tests priodiques"},path:"/monitoring/tests",icon:"Beaker"},{label:{en:"Incident Management",fr:"Gestion des incidents"},path:"/monitoring/incidents",icon:"AlertTriangle"}]},{label:{en:"Reports",fr:"Rapports"},path:"/reports",icon:"FileSpreadsheet",permission:_e.REPORTS_VIEW},{label:{en:"User Manual",fr:"Manuel d'utilisateur"},path:"/manual",icon:"BookOpen"},{label:{en:"Settings",fr:"Paramtres"},icon:"Settings",permission:_e.SETTINGS_VIEW,children:[{label:{en:"General",fr:"Gnraux"},path:"/settings/general",icon:"SlidersHorizontal"},{label:{en:"User Management",fr:"Gestion des utilisateurs"},path:"/settings/users",icon:"Users"},{label:{en:"Roles",fr:"Rles"},path:"/settings/roles",icon:"UserCog"},{label:{en:"Incident Types",fr:"Types d'incident"},path:"/settings/incident-types",icon:"Layers"},{label:{en:"Incident Severities",fr:"Svrits d'incident"},path:"/settings/incident-severities",icon:"TrendingUp"}]}],pa=45,Yf=7,df=30;function bj(e,t){const[s,a]=S.useState(()=>{if(typeof window>"u")return t;try{const l=window.localStorage.getItem(e);return l?JSON.parse(l):t}catch(l){return console.warn(`Error reading localStorage key ${e}:`,l),t}}),i=l=>{try{const c=l instanceof Function?l(s):l;a(c),typeof window<"u"&&window.localStorage.setItem(e,JSON.stringify(c))}catch(c){console.warn(`Error setting localStorage key ${e}:`,c)}};return S.useEffect(()=>{const l=c=>{if(c.key===e&&c.newValue!==null)try{a(JSON.parse(c.newValue))}catch(u){console.warn(`Error parsing storage change for key ${e}:`,u)}};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[e]),[s,i]}const nb=S.createContext(void 0),Nj=({children:e})=>{const[t,s]=bj("appSettings",xj);S.useEffect(()=>{document.body.className="";const i=t.theme.className.split(" ").filter(Boolean);document.body.classList.add(...i,t.theme.font)},[t]);const a=i=>{s(i)};return n.jsx(nb.Provider,{value:{settings:t,updateSettings:a},children:e})},Ke=()=>{const e=S.useContext(nb);if(e===void 0)throw new Error("useSettings must be used within a SettingsProvider");return e},Sj={appName:{en:"SEAFARM MONITOR",fr:"SEAFARM MONITOR"},seaweedType:{en:"Seaweed Type",fr:"Type d'algue"},serviceProvider:{en:"Service Provider",fr:"Prestataire"},farmer:{en:"Farmer",fr:"Fermier"},employee:{en:"Employee",fr:"Employ"},employees:{en:"Employees",fr:"Employs"},farmers:{en:"Farmers",fr:"Fermiers"},modules:{en:"Modules",fr:"Modules"},module:{en:"Module",fr:"Module"},site:{en:"Site",fr:"Site"},zone:{en:"Zone",fr:"Zone"},incident:{en:"Incident",fr:"Incident"},actions:{en:"Actions",fr:"Actions"},edit:{en:"Edit",fr:"Modifier"},delete:{en:"Delete",fr:"Supprimer"},cancel:{en:"Cancel",fr:"Annuler"},save:{en:"Save",fr:"Enregistrer"},confirm:{en:"Confirm",fr:"Confirmer"},close:{en:"Close",fr:"Fermer"},add:{en:"Add",fr:"Ajouter"},loading:{en:"Loading...",fr:"Chargement..."},date:{en:"Date",fr:"Date"},notes:{en:"Notes",fr:"Notes"},status:{en:"Status",fr:"Statut"},print:{en:"Print",fr:"Imprimer"},downloadPdf:{en:"Download PDF",fr:"Tlcharger en PDF"},exportExcel:{en:"Export Excel",fr:"Exporter Excel"},downloading:{en:"Downloading...",fr:"Tlchargement..."},back:{en:"Back",fr:"Retour"},optional:{en:"optional",fr:"optionnel"},apply:{en:"Apply",fr:"Appliquer"},all:{en:"All",fr:"Tous"},scan:{en:"Scan",fr:"Scanner"},unknown:{en:"Unknown",fr:"Inconnu"},yes:{en:"Yes",fr:"Oui"},no:{en:"No",fr:"Non"},none:{en:"None",fr:"Aucun"},batch:{en:"Batch",fr:"Lot"},unknown_batch:{en:"Unknown Batch",fr:"Lot inconnu"},welcomeBack:{en:"Welcome Back",fr:"Bon retour"},invalidCredentials:{en:"Invalid credentials",fr:"Identifiants invalides"},email:{en:"Email Address",fr:"Adresse email"},password:{en:"Password",fr:"Mot de passe"},forgotPassword:{en:"Forgot Password?",fr:"Mot de passe oubli ?"},forgotPasswordTitle:{en:"Forgot Password",fr:"Mot de passe oubli"},forgotPasswordInstructions:{en:"Enter your email address and we will send you a link to reset your password.",fr:"Entrez votre adresse email et nous vous enverrons un lien pour rinitialiser votre mot de passe."},sendResetLink:{en:"Send Reset Link",fr:"Envoyer le lien"},resetLinkSentTitle:{en:"Reset Link Sent",fr:"Lien de rinitialisation envoy"},resetLinkSentInstructions:{en:"Check your email for instructions to reset your password.",fr:"Vrifiez votre email pour les instructions de rinitialisation."},backToLogin:{en:"Back to Login",fr:"Retour  la connexion"},resetPasswordTitle:{en:"Reset Password",fr:"Rinitialiser le mot de passe"},newPassword:{en:"New Password",fr:"Nouveau mot de passe"},confirmNewPassword:{en:"Confirm New Password",fr:"Confirmer le nouveau mot de passe"},passwordMismatch:{en:"Passwords do not match",fr:"Les mots de passe ne correspondent pas"},passwordResetSuccess:{en:"Password reset successfully. Redirecting to login...",fr:"Mot de passe rinitialis avec succs. Redirection vers la connexion..."},invalidOrExpiredToken:{en:"Invalid or expired token.",fr:"Jeton invalide ou expir."},emailExists:{en:"Email already exists",fr:"L'email existe dj"},unassigned:{en:"Unassigned",fr:"Non assign"},traceabilityReport:{en:"Traceability Report",fr:"Rapport de traabilit"},moduleTraceability:{en:"Module Traceability",fr:"Traabilit du module"},batchTraceability:{en:"Batch Traceability",fr:"Traabilit du lot"},originInformation:{en:"Origin Information",fr:"Informations d'origine"},batchHistory:{en:"Batch History",fr:"Historique du lot"},dryingProcess:{en:"Drying Process",fr:"Processus de schage"},noActiveCycleFoundForModule:{en:"No active cycle found for this module.",fr:"Aucun cycle actif trouv pour ce module."},noDataForReport:{en:"No data available for this report period.",fr:"Aucune donne disponible pour cette priode de rapport."},noActions:{en:"No actions available.",fr:"Aucune action disponible."},search:{en:"Search",fr:"Rechercher"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},confirmDeleteTitle:{en:"Confirm Deletion",fr:"Confirmer la suppression"},tip_title:{en:"Tip",fr:"Astuce"},noHistory:{en:"No history events.",fr:"Aucun historique."},days:{en:"days",fr:"jours"},category:{en:"Category",fr:"Catgorie"},viewDetails:{en:"View Details",fr:"Voir dtails"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},termsOfUse:{en:"Terms of Use",fr:"Conditions d'utilisation"},privacyPolicy:{en:"Privacy Policy",fr:"Politique de confidentialit"},agreeToTerms:{en:"By signing up, you agree to our",fr:"En vous inscrivant, vous acceptez nos"},dashboard:{en:"Dashboard",fr:"Tableau de bord"},operations:{en:"Operations",fr:"Oprations"},inventory:{en:"Inventory",fr:"Inventaire"},stakeholders:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},monitoring:{en:"Monitoring",fr:"Suivi"},reports:{en:"Reports",fr:"Rapports"},userManual:{en:"User Manual",fr:"Manuel utilisateur"},settings:{en:"Settings",fr:"Paramtres"},profile:{en:"Profile",fr:"Profil"},logout:{en:"Logout",fr:"Dconnexion"},toggleTheme:{en:"Toggle Theme",fr:"Changer de thme"},notifications:{en:"Notifications",fr:"Notifications"},notifications_count:{en:"{count} notifications",fr:"{count} notifications"},noNotifications:{en:"No new notifications",fr:"Aucune nouvelle notification"},analyticalDashboard:{en:"Analytical Dashboard",fr:"Tableau de bord analytique"},activeCycles:{en:"Active Cycles",fr:"Cycles actifs"},totalCredits:{en:"Total Credits",fr:"Crdits totaux"},openIncidents:{en:"Open Incidents",fr:"Incidents ouverts"},employeeDistributionBySite:{en:"Employee Distribution by Site",fr:"Rpartition des employs par site"},recentIncidents:{en:"Recent Incidents",fr:"Incidents rcents"},noIncidents:{en:"No recent incidents.",fr:"Aucun incident rcent."},productionTrend:{en:"Production Trend",fr:"Tendance de la production"},performanceCorrelation:{en:"Performance Correlation",fr:"Corrlation des performances"},sitePerformance:{en:"Site Performance",fr:"Performance des sites"},farmerSegmentation:{en:"Farmer Segmentation",fr:"Segmentation des fermiers"},yieldBySeaweedType:{en:"Yield by Seaweed Type",fr:"Rendement par type d'algue"},yieldKgAxis:{en:"Yield (Kg)",fr:"Rendement (Kg)"},durationDaysAxis:{en:"Duration (days)",fr:"Dure (jours)"},totalYieldKgAxis:{en:"Total Yield (Kg)",fr:"Rendement total (Kg)"},numberOfCyclesAxis:{en:"Number of Cycles",fr:"Nombre de cycles"},averageYieldKg:{en:"Average Yield (Kg)",fr:"Rendement moyen (Kg)"},cyclePerformance:{en:"Cycle Performance",fr:"Performance du cycle"},totalYield:{en:"Total Yield",fr:"Rendement total"},aiOperationalInsights:{en:"AI Operational Insights",fr:"Aperus oprationnels par IA"},aiOperationalInsightsDescription:{en:"Get AI-powered insights on your farm operations.",fr:"Obtenez des aperus de vos oprations agricoles, optimiss par l'IA."},generateInsights:{en:"Generate Insights",fr:"Gnrer l'analyse"},farmMapTitle:{en:"Farm Map",fr:"Carte de la ferme"},streetView:{en:"Street View",fr:"Vue rue"},satelliteView:{en:"Satellite View",fr:"Vue satellite"},coordinates:{en:"Coordinates",fr:"Coordonnes"},activeLines:{en:"Active Lines",fr:"Lignes actives"},nearingHarvest:{en:"Nearing Harvest",fr:"Rcolte proche"},overdueHarvest:{en:"Overdue Harvest",fr:"Rcolte en retard"},satelliteAnalysisTitle:{en:"Satellite Analysis",fr:"Analyse satellite"},biomassLegendHigh:{en:"High Biomass",fr:"Biomasse leve"},algalBloomRisk:{en:"Algal Bloom Risk",fr:"Risque d'efflorescence algale"},satelliteSource:{en:"Source: Sentinel-2",fr:"Source: Sentinel-2"},analyzingSatellite:{en:"Analyzing...",fr:"Analyse..."},loadSatelliteData:{en:"Load Satellite Data",fr:"Charger donnes satellite"},operationalCalendarTitle:{en:"Operational Calendar",fr:"Calendrier oprationnel"},projectedHarvest:{en:"Projected Harvest",fr:"Rcolte prvue"},paymentRun:{en:"Payment Run",fr:"Paiement"},incidentsLabel:{en:"Incidents",fr:"Incidents"},periodicTest:{en:"Periodic Test",fr:"Test priodique"},growthRate:{en:"Growth Rate",fr:"Taux de croissance"},identity:{en:"Identity",fr:"Identit"},filterEvents:{en:"Filter Events",fr:"Filtrer les vnements"},invalidQRCode:{en:"Invalid QR Code",fr:"QR Code invalide"},scanInstruction:{en:"Position the QR code inside the frame.",fr:"Positionnez le code QR  l'intrieur du cadre."},photoGallery:{en:"Photo Gallery",fr:"Galerie Photos"},addPhoto:{en:"Add Photo",fr:"Ajouter une Photo"},photoCommentPlaceholder:{en:"Add a comment for this photo...",fr:"Ajoutez un commentaire pour cette photo..."},uploadDate:{en:"Uploaded on",fr:"Ajout le"},noPhotos:{en:"No photos in the gallery.",fr:"Aucune photo dans la galerie."},confirmDeletePhoto:{en:"Are you sure you want to delete this photo?",fr:"tes-vous sr de vouloir supprimer cette photo ?"},photoUploadedSuccess:{en:"Photo uploaded successfully.",fr:"Photo tlcharge avec succs."},validationRequired:{en:"This field is required",fr:"Ce champ est requis"},validationPositiveNumber:{en:"Must be a positive number",fr:"Doit tre un nombre positif"},validationNonNegative:{en:"Must be a non-negative number",fr:"Doit tre un nombre non-ngatif"},validationEmail:{en:"Invalid email format",fr:"Format d'email invalide"},validationSelectAtLeastOne:{en:"Select at least one item",fr:"Slectionnez au moins un lment"},validationDDLatitudeRange:{en:"Latitude must be a number between -90 and 90.",fr:"La latitude doit tre un nombre entre -90 et 90."},validationDDLongitudeRange:{en:"Longitude must be a number between -180 and 180.",fr:"La longitude doit tre un nombre entre -180 et 180."},settingsTitle:{en:"General Settings",fr:"Paramtres gnraux"},companySection:{en:"Company Information",fr:"Informations de l'entreprise"},localizationSection:{en:"Localization",fr:"Localisation"},denominationsSection:{en:"Currency Denominations",fr:"Coupures montaires"},interfaceSection:{en:"Interface",fr:"Interface"},saveConfiguration:{en:"Save Configuration",fr:"Enregistrer la configuration"},configurationSaved:{en:"Configuration saved successfully.",fr:"Configuration enregistre avec succs."},companyName:{en:"Company Name",fr:"Raison sociale"},capital:{en:"Share Capital",fr:"Capital social"},nif:{en:"Tax ID (NIF)",fr:"NIF"},rc:{en:"Trade Register (RC)",fr:"Registre du commerce (RCS)"},stat:{en:"Statistical ID (STAT)",fr:"Numro statistique (STAT)"},logo:{en:"Company Logo",fr:"Logo de l'entreprise"},changeLogo:{en:"Upload Logo",fr:"Tlcharger le logo"},removeLogo:{en:"Remove Logo",fr:"Supprimer le logo"},logoPreview:{en:"Logo Preview",fr:"Aperu du logo"},country:{en:"Country",fr:"Pays"},currencyFormat:{en:"Currency Format",fr:"Format de la devise"},separator_comma:{en:"Comma",fr:"Virgule"},separator_dot:{en:"Dot",fr:"Point"},separator_space:{en:"Space",fr:"Espace"},thousandsSeparator:{en:"Thousands Separator",fr:"Sparateur de milliers"},decimalSeparator:{en:"Decimal Separator",fr:"Sparateur dcimal"},monetaryDecimals:{en:"Monetary Decimals",fr:"Dcimales montaires"},nonMonetaryDecimals:{en:"Non-monetary Decimals",fr:"Dcimales non montaires"},coins:{en:"Coins",fr:"Pices"},banknotes:{en:"Bank Notes",fr:"Billets de banque"},denominationsDescriptionNew:{en:"Select the denominations available in your currency.",fr:"Slectionnez les coupures disponibles dans votre devise."},noDenominationsForCountry:{en:"No denominations found for this country.",fr:"Aucune coupure montaire trouve pour ce pays."},language_en:{en:"English",fr:"Anglais"},language_fr:{en:"French",fr:"Franais"},visualAppearance:{en:"Visual Appearance",fr:"Apparence visuelle"},roleManagementTitle:{en:"Role Management",fr:"Gestion des rles"},addRole:{en:"Add New Role",fr:"Ajouter un nouveau rle"},roleName:{en:"Role Name",fr:"Nom du rle"},editRole:{en:"Edit Role",fr:"Modifier le rle"},confirmDeleteRole:{en:"Are you sure you want to delete this role?",fr:"tes-vous sr de vouloir supprimer ce rle ?"},dataManagementSection:{en:"Data Management",fr:"Gestion des donnes"},resetData:{en:"Reset All Data",fr:"Rinitialiser les donnes"},resetDataWarning:{en:"This will permanently delete all data in the application. This action cannot be undone.",fr:"Cette action supprimera dfinitivement toutes les donnes de l'application. Cette action est irrversible."},confirmResetData:{en:"Are you sure you want to reset all data? This is irreversible.",fr:"tes-vous sr de vouloir rinitialiser toutes les donnes ? C'est irrversible."},dataResetSuccess:{en:"All data has been reset successfully.",fr:"Toutes les donnes ont t rinitialises avec succs."},userProfileTitle:{en:"User Profile",fr:"Profil Utilisateur"},editProfile:{en:"Edit Profile",fr:"Modifier le profil"},profileUpdatedSuccess:{en:"Profile updated successfully.",fr:"Profil mis  jour avec succs."},saveChanges:{en:"Save Changes",fr:"Enregistrer les modifications"},phoneNumber:{en:"Phone Number",fr:"Numro de Tlphone"},customRoleFor:{en:"Custom Role for {recipient}",fr:"Rle personnalis pour {recipient}"},sendInvitation:{en:"Send Invitation",fr:"Envoyer l'Invitation"},inviteMode:{en:"Invite Mode",fr:"Mode d'Invitation"},selectRoleMode:{en:"Assign Role",fr:"Assigner un Rle"},customPermissionsMode:{en:"Custom Permissions",fr:"Permissions Personnalises"},validationPhone:{en:"Invalid phone number",fr:"Numro de tlphone invalide"},manual_architecture_title:{en:"System Architecture",fr:"Architecture du systme"},manual_setup_title:{en:"Initial Setup & Configuration",fr:"Configuration initiale"},manual_production_title:{en:"Production & Cultivation",fr:"Production & Culture"},manual_inventory_title:{en:"Logistics Flow",fr:"Flux logistique"},manual_finance_title:{en:"Finance & Payments",fr:"Finance & Paiements"},manual_monitoring_title:{en:"Monitoring & Quality Control",fr:"Suivi & Contrle qualit"},manual_reports_title:{en:"Data Reporting & Export",fr:"Rapports & Exportation"},status_legend_title:{en:"Status Color Codes",fr:"Lgende des codes couleurs"},manual_setup_desc:{en:"Before starting operations, ensure the base data is correctly configured.",fr:"Avant de commencer les oprations, assurez-vous que les donnes de base sont correctement configures."},step_desc_define_locations:{en:"Define Locations",fr:"Dfinir les lieux"},step_desc_create_infra:{en:"Create Infrastructure",fr:"Crer l'infrastructure"},step_desc_add_personnel:{en:"Add Personnel",fr:"Ajouter le personnel"},step_desc_link_farmers:{en:"Link Farmers to Modules",fr:"Lier fermiers aux modules"},step_desc_collection:{en:"Collection",fr:"Collecte"},step_desc_shipping_slip:{en:"Shipping Slip",fr:"Bon d'expdition"},step_desc_reception:{en:"Reception",fr:"Rception"},step_desc_processing:{en:"Processing",fr:"Traitement"},step_desc_shipping:{en:"Shipping",fr:"Expdition"},step_desc_weekly:{en:"Weekly",fr:"Hebdomadaire"},step_desc_ai:{en:"AI Diagnosis",fr:"Diagnostic IA"},step_desc_action:{en:"Action Plan",fr:"Plan d'action"},manual_inventory_note:{en:'Note: Site Transfers create "Shipping Slips". Pressing uses "Pressing Slips" to convert Bulk stock to Pressed Bales.',fr:`Note : Les transferts inter-sites crent des "Bons d'expdition". Le pressage utilise des "Bons de pressage" pour convertir le vrac en balles.`},desc_select_payment_type:{en:"Select Wet/Dry/Service/Payroll",fr:"Slectionner Humide/Sec/Prestation/Paie"},desc_filter_site:{en:"Filter by site (optional)",fr:"Filtrer par site (optionnel)"},manual_finance_formula_title:{en:"Net Payable Formula",fr:"Formule du net  payer"},manual_finance_formula_text:{en:`(Harvest Weight - Cuttings) * Price
- Credits (Rice, Cash)
= Net Payment`,fr:`(Poids Rcolt - Boutures) * Prix
- Crdits (Riz, Espces)
= Net  Payer`},manual_finance_reports_text:{en:"Generate PDF Payment Sheets and Individual Receipts automatically from the Document Payments page.",fr:"Gnrez automatiquement des feuilles de paiement PDF et des reus individuels depuis la page Documents de Paiement."},desc_select_period:{en:"Select growth period (Planting -> P5)",fr:"Slectionner priode de croissance (Plantation -> P5)"},desc_optional_api:{en:"Optional (can fetch from API)",fr:"Optionnel (via API)"},desc_manual_entry:{en:"Manual Entry",fr:"Saisie manuelle"},legend_module_desc:{en:"Green indicates active growth. Blue indicates post-harvest processing.",fr:"Vert indique une croissance active. Bleu indique le traitement post-rcolte."},legend_incident_desc:{en:"Critical incidents trigger immediate alerts on the Dashboard.",fr:"Les incidents critiques dclenchent des alertes immdiates sur le tableau de bord."},manual_finance_desc:{en:"Track farmer credits, record repayments, and generate payment sheets for wet/dry deliveries and services.",fr:"Suivez les crdits fermiers, enregistrez les remboursements et gnrez des feuilles de paiement pour les livraisons humides/sches et les services."},step_sites:{en:"Create Sites",fr:"Crer sites"},step_modules:{en:"Setup Modules",fr:"Config modules"},step_farmers:{en:"Register Farmers",fr:"Enr. fermiers"},step_assign:{en:"Assignation",fr:"Assignation"},step_log_test:{en:"Log Environmental Data",fr:"Saisie donnes environnement"},step_analyze_pest:{en:"Analyze Pests (AI)",fr:"Analyse parasites (IA)"},step_resolve_incident:{en:"Resolve & Close",fr:"Rsoudre & fermer"},field_site_name:{en:'The display name of the site (e.g., "Site A").',fr:`Le nom d'affichage du site (ex: "Site A").`},field_manager:{en:"The employee responsible for this site.",fr:"L'employ responsable de ce site."},field_zones:{en:"Geographical subdivisions drawn on the map.",fr:"Subdivisions gographiques dessines sur la carte."},field_module_code:{en:"Unique identifier (auto-generated or manual).",fr:"Identifiant unique (auto-gnr ou manuel)."},field_module_lines:{en:"Number of cultivation lines in this module.",fr:"Nombre de lignes de culture dans ce module."},field_harvest_weight:{en:"Wet weight of seaweed measured immediately after harvest.",fr:"Poids humide des algues mesur immdiatement aprs la rcolte."},field_cuttings_taken:{en:"Weight of seaweed kept for replanting (deducted from net production).",fr:"Poids des algues conserves pour la replantation (dduit de la production nette)."},field_water_temp:{en:"Water Temperature (C)",fr:"Temprature eau (C)"},field_salinity:{en:"Salinity ()",fr:"Salinit ()"},report_type_global:{en:"Global Farm Report: The master monthly document.",fr:"Rapport Global : Le document mensuel de rfrence."},report_type_farmer:{en:"Individual Farmer Report: For performance reviews.",fr:"Rapport Individuel : Pour les revues de performance."},report_type_payment:{en:"Payment Sheets: For payroll and cash distribution.",fr:"Feuilles de Paie : Pour la distribution."},legend_module_status:{en:"Module Statuses",fr:"Statuts des modules"},legend_incident_severity:{en:"Incident Severity",fr:"Gravit incident"},status_PLANTED:{en:"Planted",fr:"Plant"},status_GROWING:{en:"Growing",fr:"En croissance"},status_HARVESTED:{en:"Harvested",fr:"Rcolt"},status_DRYING:{en:"Drying",fr:"Schage"},status_BAGGING:{en:"Bagging",fr:"Ensachage"},status_BAGGED:{en:"Bagged",fr:"Ensach"},status_IN_STOCK:{en:"In Stock",fr:"En stock"},status_EXPORTED:{en:"Exported",fr:"Export"},status_MAINTENANCE:{en:"Maintenance",fr:"Maintenance"},status_STORED:{en:"Stored",fr:"Stock"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},status_CREATED:{en:"Created",fr:"Cr"},status_CUTTING:{en:"Cutting",fr:"Bouturage"},flow_planting:{en:"Planting",fr:"Plantation"},flow_growing:{en:"Growth",fr:"Croissance"},flow_harvest:{en:"Harvest",fr:"Rcolte"},flow_drying:{en:"Drying",fr:"Schage"},flow_bagging:{en:"Bagging",fr:"Ensachage"},flow_stock:{en:"Stock",fr:"Stock"},flow_transfer:{en:"Transfer",fr:"Transfert"},flow_warehouse:{en:"Warehouse",fr:"Magasin"},flow_pressing:{en:"Pressing",fr:"Pressage"},flow_export:{en:"Export",fr:"Export"},tip_auto_growth:{en:"The system automatically calculates growth rates based on initial and harvest weights.",fr:"Le systme calcule automatiquement les taux de croissance bass sur les poids initiaux et rcolts."},tip_map_interaction:{en:"You can click on modules on the map to see their status and perform actions directly.",fr:"Vous pouvez cliquer sur les modules sur la carte pour voir leur statut et effectuer des actions directement."},tip_offline:{en:"The app works offline. Data syncs when connection is restored.",fr:"L'application fonctionne hors ligne. Les donnes se synchronisent au retour de la connexion."},tip_ai_pest:{en:"Use the camera icon in Incident Reporting to take a picture of diseased seaweed. The AI will identify the pest and suggest treatment.",fr:"Utilisez l'icne camra dans le signalement d'incident pour photographier une algue malade. L'IA identifiera le problme et suggrera un traitement."},guide_how_to_harvest:{en:"How to Record a Harvest",fr:"Comment enregistrer une rcolte"},guide_how_to_pay:{en:"How to Run Payments",fr:"Comment excuter les paiements"},guide_periodic_test:{en:"Recording a Periodic Test",fr:"Enregistrer un test priodique"},manual_desc_planting:{en:'Record a "Cutting Operation" to start a cycle.',fr:'Enregistrez une "Opration de coupe" pour dmarrer un cycle.'},manual_desc_harvest:{en:"Log harvested weight. Cycle moves to Drying.",fr:"Saisissez le poids rcolt. Le cycle passe en schage."},manual_desc_processing:{en:"Track dry weight and bag count. Inventory is updated.",fr:"Suivez le poids sec et le nombre de sacs. L'inventaire est mis  jour."},mon:{en:"Mon",fr:"Lun"},tue:{en:"Tue",fr:"Mar"},wed:{en:"Wed",fr:"Mer"},thu:{en:"Thu",fr:"Jeu"},fri:{en:"Fri",fr:"Ven"},sat:{en:"Sat",fr:"Sam"},sun:{en:"Sun",fr:"Dim"},january:{en:"January",fr:"Janvier"},february:{en:"February",fr:"Fvrier"},march:{en:"March",fr:"Mars"},april:{en:"April",fr:"Avril"},may:{en:"May",fr:"Mai"},june:{en:"June",fr:"Juin"},july:{en:"July",fr:"Juillet"},august:{en:"August",fr:"Aot"},september:{en:"September",fr:"Septembre"},october:{en:"October",fr:"Octobre"},november:{en:"November",fr:"Novembre"},december:{en:"December",fr:"Dcembre"},legend:{en:"Legend",fr:"Lgende"},assignedModule:{en:"Assigned Module",fr:"Module assign"},freeModule:{en:"Free Module",fr:"Module libre"}},wj={siteManagementTitle:{en:"Site Management",fr:"Gestion des sites"},addSite:{en:"Add Site",fr:"Ajouter un site"},sitePerformanceOverview:{en:"Site Performance Overview",fr:"Aperu des performances des sites"},geminiSiteAnalysis:{en:"Gemini Site Analysis",fr:"Analyse de Site par Gemini"},generateAnalysis:{en:"Generate Analysis",fr:"Gnrer l'analyse"},sites:{en:"Sites",fr:"Sites"},totalModules:{en:"Total Modules",fr:"Total des modules"},totalHarvestedWeightBySite:{en:"Total Harvested Weight by Site",fr:"Poids total rcolt par site"},avgHarvestPerModuleCurrentYear:{en:"Avg Yield/Module (Current Year)",fr:"Rendement moyen/module (Anne en cours)"},geoPoints:{en:"Geo Points",fr:"Points Gographiques"},addPoint:{en:"Add Point",fr:"Ajouter un point"},remove:{en:"Remove",fr:"Retirer"},latitude:{en:"Latitude",fr:"Latitude"},longitude:{en:"Longitude",fr:"Longitude"},latitudeDMS:{en:"Latitude (DMS)",fr:"Latitude (DMS)"},longitudeDMS:{en:"Longitude (DMS)",fr:"Longitude (DMS)"},siteLayout:{en:"Site Layout",fr:"Plan du Site"},siteName:{en:"Site Name",fr:"Nom du site"},siteCode:{en:"Site Code",fr:"Code du site"},manager:{en:"Manager",fr:"Responsable"},noManager:{en:"No Manager",fr:"Aucun responsable"},zones:{en:"Zones",fr:"Zones"},zoneName:{en:"Zone Name",fr:"Nom de la zone"},addZone:{en:"Add Zone",fr:"Ajouter une zone"},selectZone:{en:"Select Zone",fr:"Slectionner une zone"},noZonesDefined:{en:"No zones defined for this site.",fr:"Aucune zone dfinie pour ce site."},editSite:{en:"Edit Site",fr:"Modifier le site"},confirmDeleteSite:{en:"Are you sure you want to delete this site?",fr:"tes-vous sr de vouloir supprimer ce site ?"},invalidDMSFormat:{en:"Invalid DMS format",fr:"Format DMS invalide"},coordinateFormat_DMS:{en:"Degrees, Minutes, Seconds",fr:"Degrs, Minutes, Secondes"},coordinateFormat_DD:{en:"Decimal Degrees",fr:"Degrs Dcimaux"},noPoints:{en:"No geo points added yet.",fr:"Aucun point gographique ajout."},moduleManagementTitle:{en:"Module Management",fr:"Gestion des Modules"},addModule:{en:"Add Module",fr:"Ajouter un Module"},moduleCode:{en:"Module Code",fr:"Code Module"},farmer:{en:"Farmer",fr:"Fermier"},filtersTitle:{en:"Filters",fr:"Filtres"},allSites:{en:"All Sites",fr:"Tous les Sites"},allZones:{en:"All Zones",fr:"Toutes les Zones"},allFarmers:{en:"All Farmers",fr:"Tous les Fermiers"},allStatuses:{en:"All Statuses",fr:"Tous les Statuts"},clearFilters:{en:"Clear Filters",fr:"Effacer les Filtres"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},alerts:{en:"Alerts",fr:"Alertes"},confirmDeleteModule:{en:"Are you sure you want to delete this module?",fr:"tes-vous sr de vouloir supprimer ce module ?"},editModule:{en:"Edit Module",fr:"Modifier le Module"},configuration:{en:"Configuration",fr:"Configuration"},lines:{en:"Lines",fr:"Lignes"},galvanizedPoles:{en:"Galvanized Poles",fr:"Piquets Galvaniss"},woodPoles:{en:"Wood Poles",fr:"Piquets en Bois"},plasticPoles:{en:"Plastic Poles",fr:"Piquets en Plastique"},moduleMoveActiveCycleWarning:{en:"Warning: This module has an active cultivation cycle. Moving it might affect data consistency.",fr:"Attention : Ce module a un cycle de culture actif. Le dplacer pourrait affecter la cohrence des donnes."},moduleStatusHistoryTitle:{en:"Module Status History",fr:"Historique du Statut du Module"},notes_moduleReadyForAssignment:{en:"Module is ready for assignment.",fr:"Le module est prt  tre assign."},notes_moduleAssignedToFarmer:{en:"Assigned to farmer {farmerName}",fr:"Assign au fermier {farmerName}"},notes_cycleCompletedModuleAvailable:{en:"Cycle completed. Module is available.",fr:"Cycle termin. Le module est disponible."},moduleDetails:{en:"Module Details",fr:"Dtails du Module"},generalInformation:{en:"General Information",fr:"Informations Gnrales"},cultivationCycleManagementTitle:{en:"Cultivation Cycles",fr:"Cycles de Culture"},cultivationCycle:{en:"Cultivation Cycle",fr:"Cycle de Culture"},addCycle:{en:"Add Cycle",fr:"Ajouter un Cycle"},ageInDays:{en:"Age (Days)",fr:"ge (Jours)"},harvestDate:{en:"Harvest Date",fr:"Date de Rcolte"},harvest:{en:"Harvest",fr:"Rcolter"},history:{en:"History",fr:"Historique"},performance:{en:"Performance",fr:"Performance"},initialWeight:{en:"Initial Weight",fr:"Poids Initial"},linesPlanted:{en:"Lines Planted",fr:"Lignes Plantes"},harvestedWeight:{en:"Harvested Weight",fr:"Poids Rcolt"},linesHarvested:{en:"Lines Harvested",fr:"Lignes Rcoltes"},aiPrediction:{en:"AI Prediction",fr:"Prdiction IA"},retry:{en:"Retry",fr:"Ressayer"},predictedHarvest:{en:"Predicted Harvest",fr:"Rcolte Prvue"},predictedYieldKg:{en:"Predicted Yield (Kg)",fr:"Rendement Prvu (Kg)"},confidence:{en:"Confidence",fr:"Confiance"},predict:{en:"Predict",fr:"Prdire"},predictionError:{en:"Prediction failed",fr:"chec de la prdiction"},editCycle:{en:"Edit Cycle",fr:"Modifier le Cycle"},module:{en:"Module",fr:"Module"},plantingDate:{en:"Planting Date",fr:"Date de Plantation"},confirmHarvestTitle:{en:"Confirm Harvest",fr:"Confirmer la Rcolte"},confirmHarvestMessage:{en:"Please enter the harvest details below.",fr:"Veuillez entrer les dtails de la rcolte ci-dessous."},wetProduction:{en:"Wet Production (Net)",fr:"Production Humide (Net)"},harvestReason:{en:"Harvest Reason",fr:"Motif de Rcolte"},harvestReason_maturity:{en:"Harvest for maturity",fr:"Rcolte pour maturit"},other:{en:"Other",fr:"Autre"},otherReasonPlaceholder:{en:"Specify reason...",fr:"Prcisez le motif..."},validationReasonRequired:{en:"Reason required",fr:"Motif requis"},exactAge:{en:"Exact Age: {days} days",fr:"ge exact : {days} jours"},confirmDeleteCycle:{en:"Are you sure you want to delete this cycle?",fr:"tes-vous sr de vouloir supprimer ce cycle ?"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netHarvestedWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},cultivationCycleHistoryTitle:{en:"Cycle History",fr:"Historique du Cycle"},noCycleHistoryEvents:{en:"No history events found for this cycle.",fr:"Aucun vnement historique trouv pour ce cycle."},cuttingOperationsTitle:{en:"Cutting Operations",fr:"Oprations de Coupe"},newPlanting:{en:"New Planting (Cutting)",fr:"Nouvelle Plantation (Bouturage)"},addOperation:{en:"Add Operation",fr:"Ajouter une Opration"},beneficiaryFarmers:{en:"Beneficiary Farmers",fr:"Fermiers Bnficiaires"},modules_cutting:{en:"Modules",fr:"Modules"},isPaid:{en:"Is Paid",fr:"Est Pay"},paid:{en:"Paid",fr:"Pay"},unpaid:{en:"Unpaid",fr:"Impay"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},noBeneficiary:{en:"No Beneficiary",fr:"Aucun Bnficiaire"},editCuttingOperation:{en:"Edit Cutting Operation",fr:"Modifier l'Opration de Coupe"},confirmDeleteCuttingOperation:{en:"Are you sure you want to delete this operation? This will also remove the associated cultivation cycle and any related farmer credits. This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer cette opration ? Cela supprimera galement le cycle de culture associ et tous les crdits fermiers lis. Cette action est irrversible."},selectProvider:{en:"Select Provider",fr:"Slectionner un Prestataire"},unitPricePerLine:{en:"Unit Price per Line",fr:"Prix Unitaire par Ligne"},totalLinesCut:{en:"Total Lines Cut",fr:"Total Lignes Coupes"},noFarmersAssignedToModules:{en:"No farmers assigned to selected modules.",fr:"Aucun fermier assign aux modules slectionns."},dateOperation:{en:"Operation Date",fr:"Date de l'Opration"},detailsModule:{en:"Module Details",fr:"Dtails du Module"},zonePlantation:{en:"Planting Zone",fr:"Zone de Plantation"},numModule:{en:"Module Number",fr:"Numro de Module"},selectAModule:{en:"Select a Module",fr:"Slectionner un Module"},nombreLignesCoupees:{en:"Number of Lines Cut",fr:"Nombre de Lignes Coupes"},poidsInitialLignes:{en:"Initial Weight (Total)",fr:"Poids Initial (Total)"},fermierBeneficiaire:{en:"Beneficiary Farmer",fr:"Fermier Bnficiaire"},valeurBouturage:{en:"Cutting Value",fr:"Valeur du Bouturage"},notes_plantingOperationForModule:{en:"Planting operation for module {code}",fr:"Opration de plantation pour le module {code}"},validationLinesCutPositive:{en:"Lines cut must be greater than 0",fr:"Le nombre de lignes coupes doit tre suprieur  0"},validationPlantingDateAfterOperation:{en:"Planting date must be on or after the operation date.",fr:"La date de plantation doit tre identique ou postrieure  la date de l'opration."},harvestProcessingTitle:{en:"Harvest & Processing",fr:"Rcolte et Traitement"},dryingManagementTitle:{en:"Drying Management",fr:"Gestion du Schage"},baggingManagementTitle:{en:"Bagging Management",fr:"Gestion de l'Ensachage"},startDrying:{en:"Start Drying",fr:"Dmarrer le Schage"},noHarvestedBatches:{en:"No harvested batches waiting for drying.",fr:"Aucun lot rcolt en attente de schage."},startDryingFor:{en:"Start Drying for",fr:"Dmarrer le schage pour"},growthRateUnit:{en:"% / day",fr:"% / jour"},dryingStartDate:{en:"Drying Start Date",fr:"Date de Dbut de Schage"},geminiSuggestion:{en:"Gemini Suggestion",fr:"Suggestion Gemini"},noSuggestion:{en:"No suggestion available.",fr:"Aucune suggestion disponible."},completeDrying:{en:"Complete Drying",fr:"Terminer le Schage"},noBatchesDrying:{en:"No batches currently drying.",fr:"Aucun lot en cours de schage."},completeDryingFor:{en:"Complete Drying for",fr:"Terminer le schage pour"},dryingCompletionDate:{en:"Drying Completion Date",fr:"Date de Fin de Schage"},baggingStartDate:{en:"Bagging Start Date",fr:"Date de Dbut d'Ensachage"},actualDryWeight:{en:"Actual Dry Weight (Kg)",fr:"Poids Sec Rel (Kg)"},dryWeightToBag:{en:"Dry Weight to Bag (Kg)",fr:"Poids Sec  Ensacher (Kg)"},completeBagging:{en:"Complete Bagging",fr:"Terminer l'Ensachage"},noBatchesBagging:{en:"No batches currently bagging.",fr:"Aucun lot en cours d'ensachage."},completeSelectedBatches:{en:"Complete Selected ({count})",fr:"Terminer la Slection ({count})"},confirmBatchBaggingTitle:{en:"Batch Bagging Completion",fr:"Terminaison d'Ensachage en Lot"},confirmBatchBaggingMessage:{en:"You are about to complete bagging for {count} batches. Default bagging date will be set to {date}. Proceed?",fr:"Vous tes sur le point de terminer l'ensachage pour {count} lots. La date par dfaut sera {date}. Continuer ?"},completeBaggingFor:{en:"Complete Bagging for",fr:"Terminer l'ensachage pour"},confirmAndMoveToStock:{en:"Confirm & Move to Stock",fr:"Confirmer & Mettre en Stock"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},weightToBag:{en:"Weight to Bag",fr:"Poids  Ensacher"},bagWeights:{en:"Bag Weights (Kg)",fr:"Poids des Sacs (Kg)"},bag:{en:"Bag",fr:"Sac"},validationAtLeastOneRequired:{en:"At least one weight is required.",fr:"Au moins un poids est requis."},totalBaggedWeightKg:{en:"Total Bagged Weight",fr:"Poids Total Ensach"},batchBaggingCompleteSuccess:{en:"Batch bagging completed successfully.",fr:"Ensachage par lot termin avec succs."},selectBatch:{en:"Select batch {code}",fr:"Slectionner le lot {code}"},dryingDuration:{en:"Drying Duration (Days)",fr:"Dure de Schage (Jours)"},pricePerLine:{en:"Price per Line",fr:"Prix par Ligne"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"}},Tj={clientDetails:{en:"Client / Debtor Details",fr:"Dtails Client / Dbiteur"},notifyPartyDetails:{en:"Notify Party / Consignee Details",fr:"Dtails Destinataire / Partie  notifier"},documentDetails:{en:"Document Details",fr:"Dtails du Document"},docType:{en:"Document Type",fr:"Type de document"},invoiceNo:{en:"Invoice No.",fr:"N Facture"},natureLabel:{en:"Nature of Goods",fr:"Nature de la Marchandise"},poNo:{en:"P.O. No.",fr:"N Bon de Commande"},domiciliationNo:{en:"Domiciliation No.",fr:"N Domiciliation"},rexReference:{en:"REX Reference",fr:"Rfrence REX"},destinationCountry:{en:"Destination Country",fr:"Pays de Destination"},city:{en:"City",fr:"Ville"},notifyParty:{en:"Notify Party",fr:"Destinataire ( notifier)"},debtor:{en:"Debtor / Client",fr:"Client / Dbiteur"},vessel:{en:"Vessel",fr:"Navire"},seaWaybill:{en:"Sea Waybill",fr:"Lettre de Transport Maritime"},voyageNo:{en:"Voyage No.",fr:"N de Voyage"},currency:{en:"Currency",fr:"Devise"},localExchangeRate:{en:"Local Exchange Rate",fr:"Taux de change local"},customsNomenclature:{en:"Customs Nomenclature (HS Code)",fr:"Nomenclature Douanire (Code SH)"},countryOfOrigin:{en:"Country of Origin",fr:"Pays d'Origine"},incoterms:{en:"Incoterms",fr:"Incoterms"},paymentTerms:{en:"Payment Terms",fr:"Conditions de Paiement"},swiftBank:{en:"SWIFT / Bank",fr:"Banque / SWIFT"},selectPressingSlips:{en:"Select Pressing Slips",fr:"Slectionner les Bons de Pressage"},availableSlips:{en:"Available Slips",fr:"Bons Disponibles"},selectedSlips:{en:"Selected Slips",fr:"Bons Slectionns"},totalSelectedWeight:{en:"Total Weight",fr:"Poids Total"},totalSelectedBales:{en:"Total Bales",fr:"Total Balles"},noSlipsAvailable:{en:"No slips available for the selected seaweed type.",fr:"Aucun bon disponible pour le type d'algue slectionn."},containerManagement:{en:"Container Management",fr:"Gestion des Conteneurs"},container:{en:"Container",fr:"Conteneur"},identification:{en:"Identification",fr:"Identification"},weights:{en:"Weights",fr:"Poids"},contentsAndValue:{en:"Contents & Value",fr:"Contenu & Valeur"},containerNo:{en:"Container No.",fr:"N Conteneur"},sealNo:{en:"Seal No.",fr:"N de Plomb"},containerType:{en:"Container Type",fr:"Type de Conteneur"},volumeM3:{en:"Volume (m)",fr:"Volume (m)"},tareKg:{en:"Tare Weight (Kg)",fr:"Poids  Vide (Tare) (Kg)"},packageWeightKg:{en:"Packaging Weight (Kg)",fr:"Poids de l'Emballage (Kg)"},seaweedWeightKg:{en:"Net Seaweed Weight (Kg)",fr:"Poids Net des Algues (Kg)"},grossWeightKg:{en:"Gross Weight (Kg)",fr:"Poids Brut (Kg)"},packagesCount:{en:"Bale Count",fr:"Nombre de Balles"},unitPrice:{en:"Unit Price",fr:"Prix Unitaire"},addContainer:{en:"Add Container",fr:"Ajouter un Conteneur"},totalContainerWeight:{en:"Total Container Weight",fr:"Poids Total des Conteneurs"},totalContainerBales:{en:"Total Container Bales",fr:"Total des Balles"},validationContainerWeights:{en:"Sum of container seaweed weights must match total selected slip weight.",fr:"La somme des poids d'algues des conteneurs doit correspondre au poids total des bons slectionns."},validationContainerBales:{en:"Sum of container bale counts must match total selected slip bales.",fr:"La somme du nombre de balles des conteneurs doit correspondre au total des balles des bons slectionns."},alert_noValidSlips:{en:"No valid pressing slips selected. Please select at least one.",fr:"Aucun bon de pressage valide slectionn. Veuillez en slectionner au moins un."},alert_cannotDetermineSourceSite:{en:"Could not determine the origin site for the selected slips. Please check the data consistency.",fr:"Impossible de dterminer le site d'origine pour les bons slectionns. Veuillez vrifier la cohrence des donnes."},COMMERCIAL_INVOICE:{en:"Commercial Invoice",fr:"Facture Commerciale"},PACKING_LIST:{en:"Packing List",fr:"Liste de Colisage"},CERTIFICATE_OF_ORIGIN:{en:"Certificate of Origin",fr:"Certificat d'Origine"},onSiteStorageTitle:{en:"On-Site Storage",fr:"Stockage sur site"},recordMovement:{en:"Record Movement",fr:"Enregistrer un mouvement"},stockStatus:{en:"Stock Status",fr:"tat du stock"},normalTransfer:{en:"Normal Transfer",fr:"Transfert normal"},movementHistory:{en:"Movement History",fr:"Historique des mouvements"},farmerDeliveriesTitle:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},recordDelivery:{en:"Record Delivery",fr:"Enregistrer une livraison"},slipNo:{en:"Slip No.",fr:"N Bordereau"},farmerLabel:{en:"Farmer",fr:"Fermier"},totalBags:{en:"Total Bales",fr:"Total Balles"},noDeliveriesRecorded:{en:"No deliveries recorded yet.",fr:"Aucune livraison enregistre pour le moment."},confirmDeleteDelivery:{en:"Are you sure you want to delete this delivery? This will also reverse the stock movement.",fr:"tes-vous sr de vouloir supprimer cette livraison ? Cela annulera galement le mouvement de stock."},newDelivery:{en:"New Dry Seaweed Delivery",fr:"Nouvelle livraison d'algues sches"},receivedAtWarehouse:{en:"Record as Received",fr:"Enregistrer comme reu"},destination:{en:"Destination",fr:"Destination"},siteTransfersTitle:{en:"Shipping Slips (Inter-Site Transfers)",fr:"Bons d'expdition (Transferts inter-sites)"},pressedWarehouseTitle:{en:"Pressing Warehouse",fr:"Magasin de Presse"},summaryView:{en:"Summary",fr:"Rsum"},pressingSlips:{en:"Pressing Slips",fr:"Bons de Pressage"},recordPressingSlip:{en:"Record Pressing Slip",fr:"Saisir Bon de Pressage"},newPressingSlip:{en:"New Pressing Slip",fr:"Nouveau Bon de Pressage"},editPressingSlip:{en:"Edit Pressing Slip",fr:"Modifier Bon de Pressage"},bulkSeaweed:{en:"Bulk Seaweed",fr:"Algues en Vrac"},pressedSeaweed:{en:"Pressed Seaweed",fr:"Algues Presses"},forPressing:{en:"For Pressing",fr:"Pour Pressage"},bales:{en:"Bales",fr:"Balles"},linkedExport:{en:"Linked Export",fr:"Export Li"},cannotDeleteLinkedSlip:{en:"Cannot delete: Linked to Export",fr:"Suppression impossible: Li  un Export"},confirmDeletePressingSlip:{en:"Are you sure you want to delete this pressing slip? This will reverse the stock movements.",fr:"tes-vous sr de vouloir supprimer ce bon de pressage ? Cela annulera les mouvements de stock."},confirmDeletePressingSlipLinked:{en:"This slip cannot be deleted because it is linked to an export document.",fr:"Ce bon ne peut pas tre supprim car il est li  un document d'exportation."},exports:{en:"Exports",fr:"Exportations"},createExportDocument:{en:"Create Export Document",fr:"Crer Document Export"},editExportDocument:{en:"Edit Export Document",fr:"Modifier Document Export"},docNo:{en:"Doc No.",fr:"N Doc."},containers:{en:"Containers",fr:"Conteneurs"},documents:{en:"Documents",fr:"Documents"},confirmDeleteExport:{en:"Are you sure you want to delete this export document? This will reverse stock movements.",fr:"tes-vous sr de vouloir supprimer ce document ? Cela annulera les mouvements de stock."},totalStockKgHeader:{en:"Total Stock (Kg)",fr:"Stock total (Kg)"},totalWeightKgDelivery:{en:"Total Weight (Kg)",fr:"Poids total (Kg)"},balesCountLabel:{en:"Bale Count",fr:"Nombre de balles"},bags:{en:"Bags",fr:"Sacs"},sac:{en:"Bag",fr:"Sac"},baleSingular:{en:"Bale",fr:"Balle"},totalStockValue:{en:"Total Stock Value",fr:"Valeur totale du stock"},distinctStockItems:{en:"Distinct Items",fr:"Articles distincts"},stockSummaryBySiteAndType:{en:"Stock Summary by Site & Type",fr:"Rsum du stock par site et type"},stockKg:{en:"Stock (Kg)",fr:"Stock (Kg)"},stockBales:{en:"Stock (Bales)",fr:"Stock (Balles)"},stockBags:{en:"Stock (Bags)",fr:"Stock (Sacs)"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},warehouse_totalBalesInStock:{en:"Total Bales in Stock",fr:"Total Balles en Stock"},warehouse_weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},noStockData:{en:"No stock data available",fr:"Aucune donne de stock disponible"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},availableBulkStock:{en:"Available Bulk Stock",fr:"Stock Vrac Disponible"},bulkWeightConsumed:{en:"Bulk Weight Consumed",fr:"Poids Vrac Consomm"},pressedBalesProduced:{en:"Pressed Bales Produced",fr:"Balles presses produites"},pressedWeightProduced:{en:"Pressed Weight Produced",fr:"Poids press produit"},pressedWeightObtained:{en:"Pressed Weight Obtained",fr:"Poids Press Obtenu"},bulkInputSection:{en:"Input (Bulk)",fr:"Entre (Vrac)"},pressedOutputSection:{en:"Output (Pressed)",fr:"Sortie (Press)"},recordStockAdjustment:{en:"Record Adjustment",fr:"Enregistrer un ajustement"},direction:{en:"Direction",fr:"Sens"},in:{en:"In",fr:"Entre"},out:{en:"Out",fr:"Sortie"},kg:{en:"Kg",fr:"Kg"},reasonForAdjustment:{en:"Reason for Adjustment",fr:"Motif de l'ajustement"},recordInitialPressedStock:{en:"Record Initial Stock (Bales)",fr:"Enregistrer le stock initial (Balles)"},sourceSite:{en:"Source Site",fr:"Site d'origine"},pendingTransfers:{en:"Pending Transfers",fr:"Transferts en attente"},transferToWarehouse:{en:"Transfer to Warehouse",fr:"Transfrer  l'entrept"},noPendingTransfers:{en:"No pending transfers.",fr:"Aucun transfert en attente."},confirmTransfer:{en:"Confirm Transfer",fr:"Confirmer le transfert"},confirmNormalTransferMessage:{en:"You are about to transfer {count} bagged batches to the warehouse stock. Proceed?",fr:"Vous tes sur le point de transfrer {count} lots ensachs vers le stock de l'entrept. Continuer ?"},createShippingSlip:{en:"Create Shipping Slip",fr:"Crer un bon d'expdition"},destinationSite:{en:"Destination Site",fr:"Site de destination"},transporter:{en:"Transporter",fr:"Transporteur"},currentStock:{en:"Current Stock",fr:"Stock actuel"},shippedWeightKg:{en:"Shipped Weight (Kg)",fr:"Poids expdi (Kg)"},shippedBags:{en:"Shipped Bags",fr:"Sacs expdis"},confirmCompleteTransferTitle:{en:"Complete Transfer",fr:"Terminer le transfert"},confirmCancelTransferTitle:{en:"Cancel Transfer",fr:"Annuler le transfert"},completionDate:{en:"Completion Date",fr:"Date de rception"},cancellationDate:{en:"Cancellation Date",fr:"Date d'annulation"},receivedWeightKg:{en:"Received Weight (Kg)",fr:"Poids reu (Kg)"},receivedBags:{en:"Received Bags",fr:"Sacs reus"},cancellationReason:{en:"Reason for Cancellation",fr:"Motif de l'annulation"},movementType:{en:"Movement Type",fr:"Type de mouvement"},designation:{en:"Designation",fr:"Dsignation"},balance:{en:"Balance",fr:"Solde"},bagWeights:{en:"Bag Weights",fr:"Poids des sacs"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"},moduleCode:{en:"Module Code",fr:"Code Module"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},stockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock initial"},stockMovement_BAGGING_TRANSFER:{en:"From Bagging",fr:"Depuis ensachage"},stockMovement_EXPORT_OUT:{en:"Export",fr:"Export"},stockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison fermier"},stockMovement_PRESSING_OUT:{en:"Sent to Pressing",fr:"Envoy au pressage"},stockMovement_PRESSING_IN:{en:"Received from Pressing",fr:"Reu du pressage"},stockMovement_SITE_TRANSFER_IN:{en:"Transfer In",fr:"Transfert entrant"},stockMovement_SITE_TRANSFER_OUT:{en:"Transfer Out",fr:"Transfert sortant"},stockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},stockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},pressedStockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock Initial"},pressedStockMovement_PRESSING_IN:{en:"Pressing Production",fr:"Production Pressage"},pressedStockMovement_EXPORT_OUT:{en:"Export Shipment",fr:"Expdition Export"},pressedStockMovement_RETURN_TO_SITE:{en:"Return to Site",fr:"Retour au Site"},pressedStockMovement_BULK_IN_FROM_SITE:{en:"Bulk Transfer In",fr:"Transfert Vrac Entrant"},pressedStockMovement_PRESSING_CONSUMPTION:{en:"Pressing Consumption",fr:"Consommation Pressage"},pressedStockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison Fermier"},pressedStockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},pressedStockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},status_AWAITING_OUTBOUND:{en:"Awaiting Shipment",fr:"En attente d'expdition"},status_IN_TRANSIT:{en:"In Transit",fr:"En transit"},status_PENDING_RECEPTION:{en:"Pending Reception",fr:"En attente de rception"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_CANCELLED:{en:"Cancelled",fr:"Annul"},transport:{en:"Means of Transport",fr:"Moyen de transport"},representative:{en:"Carrier Representative",fr:"Reprsentant du transporteur"},transport_Truck:{en:"Truck",fr:"Camion"},transport_Boat:{en:"Boat",fr:"Bateau"},validationSameSite:{en:"Source and Destination cannot be the same.",fr:"Le site d'origine et de destination ne peuvent pas tre les mmes."},validationStockUnavailableWeight:{en:"Insufficient weight in stock. Available: {availableStock} kg.",fr:"Poids insuffisant en stock. Disponible : {availableStock} kg."},validationStockUnavailableBags:{en:"Insufficient bags in stock. Available: {availableStock}.",fr:"Nombre de sacs insuffisant en stock. Disponible : {availableStock}."},validationStockUnavailableBulk:{en:"Insufficient bulk stock. Available: {availableStock} kg.",fr:"Stock vrac insuffisant. Disponible : {availableStock} kg."},transportDetails:{en:"Transport Details",fr:"Dtails du transport"},siteTransferHistoryTitle:{en:"Transfer History",fr:"Historique du transfert"},stockTransferDate:{en:"Stock Transfer Date",fr:"Date de transfert au stock"},aiStockAnalysis:{en:"AI Stock Analysis",fr:"Analyse de Stock par IA"}},jj={farmerManagementTitle:{en:"Farmer Management",fr:"Gestion des fermiers"},employeeManagementTitle:{en:"Employee Management",fr:"Gestion des employs"},addFarmer:{en:"Add Farmer",fr:"Ajouter un fermier"},addEmployee:{en:"Add Employee",fr:"Ajouter un employ"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},code:{en:"Code",fr:"Code"},gender:{en:"Gender",fr:"Genre"},dob:{en:"Date of Birth",fr:"Date de naissance"},birthPlace:{en:"Birth Place",fr:"Lieu de naissance"},idNumber:{en:"ID Number",fr:"Numro CIN"},address:{en:"Address",fr:"Adresse"},maritalStatus:{en:"Marital Status",fr:"tat civil"},nationality:{en:"Nationality",fr:"Nationalit"},parentsInfo:{en:"Parents Info",fr:"Infos parents"},role:{en:"Role",fr:"Fonction"},team:{en:"Team",fr:"quipe"},hireDate:{en:"Hire Date",fr:"Date d'embauche"},grossWage:{en:"Gross Wage",fr:"Salaire brut"},category:{en:"Category",fr:"Catgorie"},noSpecificSite:{en:"No Specific Site",fr:"Aucun site spcifique"},itemsSelected:{en:"{count} items selected",fr:"{count} lments slectionns"},itemsSelected_count:{en:"{count} items selected",fr:"{count} lments slectionns"},deleteSelected:{en:"Delete Selected",fr:"Supprimer la slection"},assignSite:{en:"Assign Site",fr:"Assigner un site"},confirmBulkDeleteTitle:{en:"Delete Multiple Items",fr:"Supprimer plusieurs lments"},confirmBulkDeleteFarmers:{en:"Are you sure you want to delete {count} farmers? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} fermiers ? Cette action est irrversible."},confirmBulkDeleteEmployees:{en:"Are you sure you want to delete {count} employees? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} employs ? Cette action est irrversible."},editFarmer:{en:"Edit Farmer",fr:"Modifier le fermier"},editEmployee:{en:"Edit Employee",fr:"Modifier l'employ"},gender_Male:{en:"Male",fr:"Masculin"},gender_Female:{en:"Female",fr:"Fminin"},gender_Other:{en:"Other",fr:"Autre"},maritalStatus_Single:{en:"Single",fr:"Clibataire"},maritalStatus_Married:{en:"Married",fr:"Mari(e)"},maritalStatus_Divorced:{en:"Divorced",fr:"Divorc(e)"},maritalStatus_Widowed:{en:"Widowed",fr:"Veuf/Veuve"},employeeType:{en:"Employment Type",fr:"Type de contrat"},employeeType_PERMANENT:{en:"Permanent",fr:"Permanent"},employeeType_CASUAL:{en:"Casual/Daily",fr:"Journalier"},selectRole:{en:"Select Role",fr:"Slectionner une fonction"},farmerProfile:{en:"Farmer Profile",fr:"Profil fermier"},employeeProfile:{en:"Employee Profile",fr:"Profil employ"},assignSiteTitle:{en:"Assign Site to Selected Items",fr:"Assigner un site aux lments slectionns"},assign:{en:"Assign",fr:"Assigner"},assignFarmerTitle:{en:"Assign Farmer to Modules",fr:"Assigner un fermier aux modules"},multiSiteSelectionWarning:{en:"Selection contains modules from multiple sites. Please select modules from a single site to assign a farmer.",fr:"La slection contient des modules de plusieurs sites. Veuillez slectionner des modules d'un seul site pour assigner un fermier."},noFarmersForSiteWarning:{en:"No farmers found for the site of the selected modules.",fr:"Aucun fermier trouv pour le site des modules slectionns."},searchByNameOrCode:{en:"Search by Name or Code",fr:"Rechercher par nom ou code"},filterBySite:{en:"Filter by Site",fr:"Filtrer par site"},filterByRole:{en:"Filter by Role",fr:"Filtrer par rle"},noEmployeesMatchFilters:{en:"No employees match the current filters.",fr:"Aucun employ ne correspond aux filtres actuels."},selectEmployeeNamed:{en:"Select {name}",fr:"Slectionner {name}"},selectAllEmployees:{en:"Select All Employees",fr:"Slectionner tous les employs"},confirmDeleteEmployee:{en:"Are you sure you want to delete this employee?",fr:"tes-vous sr de vouloir supprimer cet employ ?"},serviceProvidersTitle:{en:"Service Providers",fr:"Prestataires de services"},addProvider:{en:"Add Provider",fr:"Ajouter un prestataire"},serviceType:{en:"Service Type",fr:"Type de service"},contactPerson:{en:"Contact Person",fr:"Personne de contact"},noProviders:{en:"No service providers recorded.",fr:"Aucun prestataire de services enregistr."},editProvider:{en:"Edit Provider",fr:"Modifier le prestataire"},confirmDeleteProvider:{en:"Are you sure you want to delete this provider?",fr:"tes-vous sr de vouloir supprimer ce prestataire ?"},broadcastMessage:{en:"Broadcast",fr:"Diffuser"},broadcastTitle:{en:"Farmer Communication Hub",fr:"Hub de communication fermiers"},composeMessage:{en:"Compose Message",fr:"Rdiger le message"},messageHistory:{en:"Message History",fr:"Historique des messages"},recipientScope:{en:"Recipient Scope",fr:"Porte des destinataires"},scope_ALL:{en:"All Farmers",fr:"Tous les fermiers"},scope_SITE:{en:"Specific Site",fr:"Site spcifique"},scope_SELECTED:{en:"Selected Farmers",fr:"Fermiers slectionns"},messageContent:{en:"Message Content",fr:"Contenu du message"},charCount:{en:"{count} characters",fr:"{count} caractres"},sendMessage:{en:"Send Message",fr:"Envoyer le message"},messageSentSuccess:{en:"Message broadcast initiated successfully.",fr:"Diffusion du message initie avec succs."},channel_SMS:{en:"SMS",fr:"SMS"},channel_WHATSAPP:{en:"WhatsApp",fr:"WhatsApp"},farmerCreditsTitle:{en:"Farmer Credits",fr:"Crdits fermiers"},creditStatus:{en:"Credit Status",fr:"Statut des crdits"},recordCredit:{en:"Record Credit",fr:"Enregistrer un crdit"},recordRepayment:{en:"Record Repayment",fr:"Enregistrer un remboursement"},creditTypeSettings:{en:"Credit Type Settings",fr:"Paramtres des types de crdit"},contractedCredits:{en:"Contracted Credits",fr:"Crdits contracts"},repayments:{en:"Repayments",fr:"Remboursements"},lastRepaymentDate:{en:"Last Repayment",fr:"Dernier remboursement"},remainingBalance:{en:"Remaining Balance",fr:"Solde restant"},selectAllFarmers:{en:"Select All Farmers",fr:"Slectionner tous les fermiers"},selectFarmerNamed:{en:"Select {name}",fr:"Slectionner {name}"},expand:{en:"Expand",fr:"Dvelopper"},collapse:{en:"Collapse",fr:"Rduire"},recordBulkCredit:{en:"Record Bulk Credit",fr:"Crdit group"},recordBulkRepayment:{en:"Record Bulk Repayment",fr:"Remboursement group"},creditsTaken:{en:"Credits Taken",fr:"Crdits pris"},creditType:{en:"Credit Type",fr:"Type de crdit"},creditTypes:{en:"Credit Types",fr:"Types de crdit"},totalAmount:{en:"Total Amount",fr:"Montant total"},noCredits:{en:"No credits recorded.",fr:"Aucun crdit enregistr."},repaymentsMade:{en:"Repayments Made",fr:"Remboursements effectus"},repaymentMethod:{en:"Repayment Method",fr:"Mthode de remboursement"},repaymentMethod_cash:{en:"Cash",fr:"Espces"},repaymentMethod_harvest_deduction:{en:"Harvest Deduction",fr:"Retenue sur rcolte"},noRepayments:{en:"No repayments recorded.",fr:"Aucun remboursement enregistr."},selectSite:{en:"Select Site",fr:"Slectionner un site"},selectFarmer:{en:"Select Farmer",fr:"Slectionner un fermier"},selectType:{en:"Select Type",fr:"Slectionner un type"},withQuantity:{en:"With Quantity",fr:"Avec quantit"},withUnitPrice:{en:"With Unit Price",fr:"Avec prix unitaire"},directAmount:{en:"Direct Amount",fr:"Montant direct"},unit:{en:"Unit",fr:"Unit"},addNewCreditType:{en:"Add New Credit Type",fr:"Ajouter un nouveau type de crdit"},confirmDeleteCreditType:{en:"Are you sure you want to delete this credit type?",fr:"tes-vous sr de vouloir supprimer ce type de crdit ?"},recordCreditForSelected:{en:"Record Credit for {count} Farmers",fr:"Enregistrer un crdit pour {count} fermiers"},bulkCreditMessage:{en:"This credit will be applied to all {count} selected farmers.",fr:"Ce crdit sera appliqu  tous les {count} fermiers slectionns."},recordRepaymentForSelected:{en:"Record Repayment for {count} Farmers",fr:"Enregistrer un remboursement pour {count} fermiers"},bulkRepaymentMessage:{en:"This repayment will be recorded for all {count} selected farmers.",fr:"Ce remboursement sera enregistr pour tous les {count} fermiers slectionns."},repaymentAmount:{en:"Repayment Amount",fr:"Montant du remboursement"},repaymentRecorded:{en:"Repayment recorded successfully.",fr:"Remboursement enregistr avec succs."},confirmDeleteFarmer:{en:"Are you sure you want to delete this farmer?",fr:"tes-vous sr de vouloir supprimer ce fermier ?"},editCreditType:{en:"Edit Credit Type",fr:"Modifier le type de crdit"},quantity:{en:"Quantity",fr:"Quantit"},farmerStatus:{en:"Status",fr:"Statut"},status_ACTIVE:{en:"Active",fr:"Actif"},status_INACTIVE:{en:"Inactive",fr:"Inactif"},joinDate:{en:"Hire Date",fr:"Date d'embauche"},exitDate:{en:"Exit Date",fr:"Date de dpart"},exitReason:{en:"Exit Reason",fr:"Motif du dpart"},fireFarmer:{en:"Fire/Deactivate",fr:"Dbaucher"},hireFarmer:{en:"Re-hire/Activate",fr:"R-embaucher"},confirmFire:{en:"Confirm Deactivation",fr:"Confirmer la dbauche"},confirmFireMessage:{en:"You are about to deactivate {name}. They will be marked as inactive but their data will be preserved.",fr:"Vous tes sur point de dbaucher {name}. Il sera marqu comme inactif mais ses donnes seront conserves."},fire:{en:"Deactivate",fr:"Dbaucher"},seaweedTypeManagementTitle:{en:"Seaweed Type Management",fr:"Gestion des types d'algues"},addSeaweedType:{en:"Add Seaweed Type",fr:"Ajouter un type d'algue"},name:{en:"Name",fr:"Nom"},scientificName:{en:"Scientific Name",fr:"Nom scientifique"},description:{en:"Description",fr:"Description"},wetPrice:{en:"Wet Price",fr:"Prix humide"},dryPrice:{en:"Dry Price",fr:"Prix sec"},cycles:{en:"Cycles",fr:"Cycles"},priceHistory:{en:"Price History",fr:"Historique des prix"},editSeaweedType:{en:"Edit Seaweed Type",fr:"Modifier le type d'algue"},confirmDeleteSeaweedType:{en:"Are you sure you want to delete this seaweed type?",fr:"tes-vous sr de vouloir supprimer ce type d'algue ?"},addNewPrice:{en:"Add New Price",fr:"Ajouter un nouveau prix"},effectiveDate:{en:"Effective Date",fr:"Date d'effet"},noPriceHistory:{en:"No price history available.",fr:"Aucun historique de prix disponible."},allSeaweedTypes:{en:"All Seaweed Types",fr:"Tous les types d'algues"},payrollCalculator:{en:"Payroll Calculator",fr:"Calculateur de paie"},selectEmployeesAndCalculate:{en:"Select employees and calculate payroll.",fr:"Slectionnez des employs et calculez la paie."},processPayrollFor:{en:"Process Payroll for {count} Employees",fr:"Traiter la paie pour {count} employs"},payrollResults:{en:"Payroll Results",fr:"Rsultats de paie"},payrollSummaryForPeriod:{en:"Payroll Summary for {period}",fr:"Rsum de paie pour {period}"},bulkConfigure:{en:"Bulk Configure",fr:"Configuration groupe"},totalAllDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalNetPay:{en:"Total Net Pay",fr:"Total net  payer"},socialDeductions:{en:"Social Deductions",fr:"Dductions sociales"},otherDeductions:{en:"Other Deductions",fr:"Autres dductions"},payrollTotalDeductions:{en:"Total Deductions",fr:"Total dductions"},deductionDetails:{en:"Deduction Details",fr:"Dtails des dductions"},noStatutoryDeductions:{en:"No statutory deductions.",fr:"Aucune dduction statutaire."},applyTo:{en:"Apply To",fr:"Appliquer "},allSelectedEmployees:{en:"All Selected Employees",fr:"Tous les employs slectionns"},bySite:{en:"By Site",fr:"Par site"},byRole:{en:"By Role",fr:"Par rle"},setValue:{en:"Set Value",fr:"Dfinir la valeur"},addToExisting:{en:"Add to Existing",fr:"Ajouter  l'existant"},bonuses:{en:"Bonuses",fr:"Primes"},overtime:{en:"Overtime",fr:"Heures sup."},configureSocialDeductions:{en:"Configure Social Deductions",fr:"Configurer dductions sociales"},showAffectedEmployeesAfterUpdate:{en:"Show affected employees after update",fr:"Afficher les employs affects aprs mise  jour"},applyChanges:{en:"Apply Changes",fr:"Appliquer les changements"},bulkUpdateSummary:{en:"Bulk Update Summary",fr:"Rsum mise  jour groupe"},affectedEmployees:{en:"Affected Employees ({count})",fr:"Employs affects ({count})"},confirmSavePayroll:{en:"Save Payroll Run",fr:"Sauvegarder le cycle de paie"},confirmSavePayrollMessage:{en:"This will save the current payroll calculation as pending payments for all selected employees.",fr:"Cela enregistrera le calcul de paie actuel comme paiements en attente pour tous les employs slectionns."},payrollSavedSuccess:{en:"Payroll run saved successfully.",fr:"Cycle de paie enregistr avec succs."},paymentHistory:{en:"Payment History",fr:"Historique des paiements"},recipientType:{en:"Recipient Type",fr:"Type de bnficiaire"},payNow:{en:"Pay Now",fr:"Payer Maintenant"},paymentRunSetup:{en:"Payment Run Setup",fr:"Configuration cycle de paiement"},periodName:{en:"Period Name",fr:"Nom de la priode"},startDate:{en:"Start Date",fr:"Date de dbut"},endDate:{en:"End Date",fr:"Date de fin"},paymentType:{en:"Payment Type",fr:"Type de paiement"},wetDeliveryPayment:{en:"Wet Harvest Payment",fr:"Paiement Rcolte Humide"},dryDeliveryPayment:{en:"Dry Delivery Payment",fr:"Paiement Livraison Sche"},serviceProviderPayment:{en:"Service Provider Payment",fr:"Paiement Prestataire"},preparePaymentRun:{en:"Prepare Payment Run",fr:"Prparer le cycle de paiement"},reviewPaymentRun:{en:"Review Payment Run",fr:"Rviser le Cycle de Paiement"},configureDeductions:{en:"Configure Deductions",fr:"Configurer les Dductions"},confirmAndPay:{en:"Confirm & Pay",fr:"Confirmer et Payer"},totalPayees:{en:"Total Payees",fr:"Total des Bnficiaires"},totalBaseAmount:{en:"Total Base Amount",fr:"Total de Base"},errorGeneratingNarrative:{en:"Error generating narrative.",fr:"Erreur lors de la gnration du narratif."},totalDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalAmountInWords:{en:"Total Amount in Words",fr:"Arrt la prsente fiche  la somme de"},totalNetPayable:{en:"Total Net Payable",fr:"Total Net  Payer"},newPayment:{en:"New Payment",fr:"Nouveau Paiement"},editPayment:{en:"Edit Payment",fr:"Modifier Paiement"},selectRecipientType:{en:"Select Recipient Type",fr:"Slectionner le Type de Bnficiaire"},recipient:{en:"Recipient",fr:"Destinataire"},selectRecipient:{en:"Select Recipient",fr:"Slectionner le destinataire"},amount:{en:"Amount",fr:"Montant"},paymentMethod:{en:"Payment Method",fr:"Mthode de paiement"},paymentMethod_cash:{en:"Cash",fr:"Espces"},paymentMethod_bank_transfer:{en:"Bank Transfer",fr:"Virement bancaire"},paymentMethod_mobile_money:{en:"Mobile Money",fr:"Mobile Money"},paymentStatus:{en:"Payment Status",fr:"Statut du paiement"},status_PENDING:{en:"Pending",fr:"En attente"},status_PROCESSING:{en:"Processing",fr:"En cours"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_FAILED:{en:"Failed",fr:"chou"},transactionId:{en:"Transaction ID",fr:"ID transaction"},confirmPayment:{en:"Confirm Payment",fr:"Confirmer le paiement"},confirmPaymentMessage:{en:"You are about to record payments for {count} beneficiaries. Proceed?",fr:"Vous tes sur le point d'enregistrer les paiements pour {count} bnficiaires. Continuer ?"},paymentsRecordedSuccess:{en:"Payments recorded successfully.",fr:"Paiements enregistrs avec succs."},alert_noPayrollConfig:{en:"No payroll configuration found for this country.",fr:"Aucune configuration de paie trouve pour ce pays."},adjustment:{en:"Adjustment",fr:"Ajustement"},totalGrossPay:{en:"Total Gross Pay",fr:"Total salaire brut"},employeeSelection:{en:"Employee Selection",fr:"Slection des employs"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},farmerReceipt:{en:"Farmer Receipt",fr:"Reu fermier"},payslip:{en:"Payslip",fr:"Fiche de paie"},receiptNo:{en:"Receipt No.",fr:"N reu"},paymentDetails:{en:"Payment Details",fr:"Dtails du paiement"},grossAmount:{en:"Gross Amount",fr:"Montant brut"},netPaid:{en:"Net Paid",fr:"Net pay"},mobileMoneyRef:{en:"Mobile Money Ref",fr:"Rf. Mobile Money"},paidBy:{en:"Paid By",fr:"Pay par"},receivedBy:{en:"Received By",fr:"Reu par"},deductions:{en:"Deductions",fr:"Dductions"},recipientType_FARMER:{en:"Farmer",fr:"Fermier"},recipientType_EMPLOYEE:{en:"Employee",fr:"Employ"},recipientType_SERVICE_PROVIDER:{en:"Service Provider",fr:"Prestataire"},allRoles:{en:"All Roles",fr:"Toutes les fonctions"},documentPaymentsTitle:{en:"Payment Documents",fr:"Documents de Paiement"},cuttingPaymentSheetTitle:{en:"CUTTING SERVICE PAYMENT SHEET",fr:"FICHE DE PAIEMENT DE PRESTATION DE BOUTURAGE"},serviceProviderPaymentSheetTitle:{en:"Service Provider Payment",fr:"Paiement Prestataire"},wetDeliveryPaymentSheetTitle:{en:"Wet Seaweed Delivery Payment",fr:"Paiement de livraison d'algues humides"},dryDeliveryPaymentSheetTitle:{en:"Dry Seaweed Delivery Payment",fr:"Paiement de livraison d'algues sches"},employeePayroll:{en:"Employee Payroll",fr:"Paie des Employs"},printDocuments:{en:"Print Documents",fr:"Impression des Documents"},dateLabel:{en:"Date",fr:"Date"},exploitationSite:{en:"Exploitation Site",fr:"Site d'exploitation"},deliveryPeriod:{en:"Delivery Period",fr:"Priode de livraison"},checkNumber:{en:"Check No.",fr:"N du chque"},checkAmount:{en:"Check Amount",fr:"Montant du chque"},pricePerKg:{en:"Price per Kg",fr:"Prix par kg"},page:{en:"Page",fr:"Page"},totalPaymentAmount:{en:"Total Payment Amount",fr:"Montant total du paiement"},dateTrans:{en:"Trans. Date",fr:"Date trans."},poids:{en:"Weight",fr:"Poids"},valeur:{en:"Value",fr:"Valeur"},creditsHeader:{en:"Credits",fr:"Crdits"},creditDeduction:{en:"Credit Deduction",fr:"Dduction Crdit"},resteAPayer:{en:"Net Payable",fr:"Reste  payer"},responsibleSignature:{en:"Responsible Signature",fr:"Signature du responsable"},signature:{en:"Signature",fr:"Signature"},theResponsible:{en:"The Responsible",fr:"Le Responsable"},provider:{en:"Provider",fr:"Prestataire"},numberOfPages:{en:"Number of Pages",fr:"Nombre de pages"},checkAmountInWords:{en:"Check Amount in Words",fr:"Montant du chque en lettres"},totalToPay:{en:"TOTAL TO PAY",fr:"TOTAL  PAYER"},various:{en:"Various",fr:"Divers"},denominationBreakdown:{en:"Denomination Breakdown",fr:"Rpartition des coupures"},breakdownByBeneficiary:{en:"Breakdown by Beneficiary",fr:"Rpartition par bnficiaire"},beneficiary:{en:"Beneficiary",fr:"Bnficiaire"},denomination:{en:"Denomination",fr:"Coupure"},total:{en:"Total",fr:"Total"},period:{en:"Period",fr:"Priode"},unpaidOperations:{en:"Unpaid Ops.",fr:"Oprations Impayes"},serviceDate:{en:"Service Date",fr:"Date de prestation"},perProcurationem:{en:"Per Procurationem",fr:"Par Procuration"},theManager:{en:"The Manager",fr:"Le Grant"},numberOfLines:{en:"Number of Lines",fr:"Nombre de Lignes"},montantAPayer:{en:"Amount to Pay",fr:"Montant  Payer"},summaryTable:{en:"Summary Table",fr:"Tableau de Synthse"},commercialInvoice:{en:"Commercial Invoice",fr:"Facture Commerciale"},packingAndWeightList:{en:"Packing List",fr:"Liste de Colisage"},certificateOfOrigin:{en:"Certificate of Origin",fr:"Certificat d'Origine"},deliveryAddress:{en:"Delivery Address",fr:"Adresse de livraison"},orderRef:{en:"Order Ref.",fr:"Rf. Commande"},packages:{en:"Packages",fr:"Colis"},netWeight:{en:"Net Weight",fr:"Poids Net"},totalExclTax:{en:"TOTAL EXCL. TAX",fr:"TOTAL HT"},amountInWords:{en:"Amount in Words",fr:"Arrt la prsente facture  la somme de"},bankDetails:{en:"Bank Details",fr:"Coordonnes Bancaires"},senderLabel:{en:"Sender",fr:"Expditeur"},recipientLabel:{en:"Recipient",fr:"Destinataire"},signedAtLocation:{en:"Signed at {location}, on {date}",fr:"Fait  {location}, le {date}"},managePermissions:{en:"Manage Permissions",fr:"Grer les permissions"},managePermissionsFor:{en:"Manage Permissions for",fr:"Grer les permissions pour"},default:{en:"Default",fr:"Par dfaut"},cannotDeleteDefault:{en:"Cannot delete a default item.",fr:"Impossible de supprimer un lment par dfaut."},value:{en:"Value",fr:"Valeur"},totalValue:{en:"Total Value",fr:"Valeur Totale"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},netWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},totalWeightKg:{en:"Total Weight (Kg)",fr:"Poids Total (Kg)"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netPayable:{en:"Net Payable",fr:"Net  Payer"},baseAmount:{en:"Base Amount",fr:"Montant de Base"},grossSalary:{en:"Gross Salary",fr:"Salaire Brut"},totalGross:{en:"Total Gross",fr:"Total Brut"},netPay:{en:"Net Pay",fr:"Net  Payer"}},_j={incidentManagementTitle:{en:"Incident Management",fr:"Gestion des Incidents"},reportIncident:{en:"Report Incident",fr:"Signaler un Incident"},inProgressIncidents:{en:"In Progress",fr:"En Cours"},criticalIncidents:{en:"Critical",fr:"Critique"},incidentType:{en:"Incident Type",fr:"Type d'Incident"},severity:{en:"Severity",fr:"Gravit"},reportedBy:{en:"Reported By",fr:"Signal Par"},status_OPEN:{en:"Open",fr:"Ouvert"},status_IN_PROGRESS:{en:"In Progress",fr:"En Cours"},status_RESOLVED:{en:"Resolved",fr:"Rsolu"},status_CLOSED:{en:"Closed",fr:"Ferm"},severity_LOW:{en:"Low",fr:"Faible"},severity_MEDIUM:{en:"Medium",fr:"Moyenne"},severity_HIGH:{en:"High",fr:"Haute"},severity_CRITICAL:{en:"Critical",fr:"Critique"},confirmDeleteIncident:{en:"Are you sure you want to delete this incident?",fr:"tes-vous sr de vouloir supprimer cet incident ?"},editIncident:{en:"Edit Incident",fr:"Modifier l'Incident"},uploadPhoto:{en:"Upload Photo",fr:"Tlcharger une Photo"},uploadPhotoInstruction:{en:"Upload or take a photo to analyze with AI",fr:"Tlchargez ou prenez une photo pour analyser avec l'IA"},analyzeWithAI:{en:"Analyze with AI",fr:"Analyser avec l'IA"},analyzeInstructions:{en:"Describe the issue or upload an image...",fr:"Dcrivez le problme ou tlchargez une image..."},aiSuggestions:{en:"AI Suggestions",fr:"Suggestions IA"},suggestedType:{en:"Suggested Type",fr:"Type Suggr"},suggestedSeverity:{en:"Suggested Severity",fr:"Gravit Suggre"},suggestedModules:{en:"Suggested Modules",fr:"Modules Suggrs"},suggestedTreatment:{en:"Suggested Treatment",fr:"Traitement Suggr"},affectedModules:{en:"Affected Modules",fr:"Modules Affects"},resolvedDate:{en:"Resolved Date",fr:"Date de Rsolution"},resolutionNotes:{en:"Resolution Notes",fr:"Notes de Rsolution"},incidentTypeManagementTitle:{en:"Incident Types",fr:"Types d'Incidents"},addIncidentType:{en:"Add Incident Type",fr:"Ajouter un Type d'Incident"},typeName:{en:"Type Name",fr:"Nom du Type"},editIncidentType:{en:"Edit Incident Type",fr:"Modifier le Type d'Incident"},confirmDeleteIncidentType:{en:"Are you sure you want to delete this type?",fr:"tes-vous sr de vouloir supprimer ce type ?"},incidentSeverityManagementTitle:{en:"Incident Severities",fr:"Gravits d'Incidents"},addIncidentSeverity:{en:"Add Severity",fr:"Ajouter une Gravit"},severityName:{en:"Severity Name",fr:"Nom de la Gravit"},editIncidentSeverity:{en:"Edit Severity",fr:"Modifier la Gravit"},confirmDeleteIncidentSeverity:{en:"Are you sure you want to delete this severity?",fr:"tes-vous sr de vouloir supprimer cette gravit ?"},noMajorIncidents:{en:"No major incidents reported.",fr:"Aucun incident majeur signal."},descriptionPlaceholder:{en:"Describe the incident...",fr:"Dcrivez l'incident..."},periodicTestsTitle:{en:"Periodic Tests",fr:"Tests Priodiques"},addTest:{en:"Add Test",fr:"Ajouter un Test"},identity:{en:"Identity/Code",fr:"Identit/Code"},zoning:{en:"Zoning",fr:"Zonage"},conductor:{en:"Conductor",fr:"Conducteur"},sheetInfo:{en:"Sheet Info",fr:"Infos Fiche"},weatherData:{en:"Weather Data",fr:"Donnes Mto"},manualEntry:{en:"Manual Entry",fr:"Saisie Manuelle"},autoFill:{en:"Auto Fill (API)",fr:"Remplissage Auto (API)"},fetchWeather:{en:"Fetch Weather",fr:"Rcuprer Mto"},fetchingWeather:{en:"Fetching...",fr:"Rcupration..."},weatherFetchSuccess:{en:"Weather data fetched successfully.",fr:"Donnes mto rcupres avec succs."},weatherFetchError:{en:"Failed to fetch weather data.",fr:"chec de la rcupration des donnes mto."},weatherFetchMissingInfo:{en:"Missing site coordinates or date.",fr:"Coordonnes du site ou date manquantes."},temperature:{en:"Temperature",fr:"Temprature"},salinity:{en:"Salinity",fr:"Salinit"},precipitation:{en:"Precipitation",fr:"Prcipitations"},windSpeed:{en:"Wind Speed",fr:"Vitesse du Vent"},windDirection:{en:"Wind Direction",fr:"Direction du Vent"},waveHeight:{en:"Wave Height",fr:"Hauteur des Vagues"},editTest:{en:"Edit Test",fr:"Modifier le Test"},confirmDeleteTest:{en:"Are you sure you want to delete this test?",fr:"tes-vous sr de vouloir supprimer ce test ?"},period_PLANTING:{en:"Planting",fr:"Plantation"},period_PERIOD_1:{en:"Period 1",fr:"Priode 1"},period_PERIOD_2:{en:"Period 2",fr:"Priode 2"},period_PERIOD_3:{en:"Period 3",fr:"Priode 3"},period_PERIOD_4:{en:"Period 4",fr:"Priode 4"},period_PERIOD_5:{en:"Period 5",fr:"Priode 5"},userManagement:{en:"User Management",fr:"Gestion des Utilisateurs"},inviteUser:{en:"Invite User",fr:"Inviter un Utilisateur"},currentUsers:{en:"Current Users",fr:"Utilisateurs Actuels"},pendingInvitations:{en:"Pending Invitations",fr:"Invitations en Attente"},recipient:{en:"Recipient",fr:"Destinataire"},channel:{en:"Channel",fr:"Canal"},expiresAt:{en:"Expires At",fr:"Expire Le"},invitedBy:{en:"Invited By",fr:"Invit Par"},resend:{en:"Resend",fr:"Renvoyer"},revoke:{en:"Revoke",fr:"Rvoquer"},noPendingInvitations:{en:"No pending invitations.",fr:"Aucune invitation en attente."},revokeInvitation:{en:"Revoke Invitation",fr:"Rvoquer l'Invitation"},confirmRevokeInvitation:{en:"Are you sure you want to revoke this invitation?",fr:"tes-vous sr de vouloir rvoquer cette invitation ?"},invitationSent:{en:"Invitation Sent",fr:"Invitation Envoye"},invitationLinkMessage:{en:"Share this link with the user:",fr:"Partagez ce lien avec l'utilisateur :"},invitationWhatsAppMessage:{en:"Send this WhatsApp message:",fr:"Envoyez ce message WhatsApp :"},openWhatsApp:{en:"Open WhatsApp",fr:"Ouvrir WhatsApp"},resendWhatsAppMessage:{en:"You have been invited to AlgaManage. Click here to join: {link}",fr:"Vous avez t invit  AlgaManage. Cliquez ici pour rejoindre : {link}"},reportsTitle:{en:"Reports",fr:"Rapports"},selectReportType:{en:"Select Report Type",fr:"Slectionner le Type de Rapport"},globalFarmReport:{en:"Global Farm Report",fr:"Rapport Global de Ferme"},customReport:{en:"Custom Report",fr:"Rapport Personnalis"},farmerMonthlyReport:{en:"Farmer Monthly Report",fr:"Rapport Mensuel Fermier"},individualFarmerReport:{en:"Individual Farmer Report",fr:"Rapport Individuel Fermier"},month:{en:"Month",fr:"Mois"},year:{en:"Year",fr:"Anne"},generateReport:{en:"Generate Report",fr:"Gnrer le Rapport"},selectSections:{en:"Select Sections",fr:"Slectionner les Sections"},section_production:{en:"Production",fr:"Production"},section_finance:{en:"Finance",fr:"Finance"},section_inventory:{en:"Inventory",fr:"Inventaire"},section_hr:{en:"HR",fr:"RH"},section_incidents:{en:"Incidents",fr:"Incidents"},selectFiltersAndGenerate:{en:'Select report type and filters, then click "Generate Report".',fr:'Slectionnez un type de rapport et des filtres, puis cliquez sur "Gnrer le Rapport".'},pdfGenerationError:{en:"Error generating PDF.",fr:"Erreur lors de la gnration du PDF."},company_sarl:{en:"S.A.R.L Capital:",fr:"S.A.R.L au capital de"},narratif_explicatif_tableau:{en:"Narrative Explanation",fr:"Narratif explicatif du tableau"},apercuGeneralDeLaFerme:{en:"General Farm Overview",fr:"Aperu Gnral de la Ferme"},fermier_effectif:{en:"Farmers (Count)",fr:"Fermiers (Effectif)"},tranche_age_lignes:{en:"Line Age Brackets (Days)",fr:"Tranche d'ge des lignes (Jours)"},bilan_lignes:{en:"Line Summary",fr:"Bilan des Lignes"},total_lignes_eau:{en:"Total Lines in Water",fr:"Total lignes  l'eau"},total_lignes_recoltees:{en:"Total Harvested Lines",fr:"Total lignes rcoltes"},total_lignes_plantees:{en:"Total Planted Lines",fr:"Total lignes plantes"},production_periode_kg:{en:"Production for Period (Kg)",fr:"Production de la priode (Kg)"},taux_croissance_moyen:{en:"Average Growth Rate",fr:"Taux de croissance moyen"},prevision_production:{en:"Production Forecast (Kg)",fr:"Prvision de production (Kg)"},monitoringReport:{en:"Monitoring Report",fr:"Rapport de Suivi"},vent:{en:"Wind",fr:"Vent"},vitesse_kmh:{en:"Speed (km/h)",fr:"Vitesse (km/h)"},direction_deg:{en:"Direction ()",fr:"Direction ()"},autres_parametres:{en:"Other Parameters",fr:"Autres Paramtres"},temperature_c:{en:"Temperature (C)",fr:"Temprature (C)"},salinite_ppt:{en:"Salinity ()",fr:"Salinit ()"},pluviometrie_mm:{en:"Precipitation (mm)",fr:"Pluviomtrie (mm)"},averageShort:{en:"Avg",fr:"Moy"},repartition_salaries_site:{en:"Employee Distribution by Site",fr:"Rpartition des Salaris par Site"},effectif:{en:"Count",fr:"Effectif"},montant_du_mois:{en:"Monthly Amount",fr:"Montant du mois"},journalier:{en:"Daily Workers",fr:"Journaliers"},permanent:{en:"Permanent Staff",fr:"Permanents"},total_journalier:{en:"Total Daily",fr:"Total Journaliers"},total_permanent:{en:"Total Permanent",fr:"Total Permanents"},narratif_repartition_salaries:{en:"Narrative (HR)",fr:"Narratif (RH)"},stocks_sur_sites:{en:"Stocks on Sites",fr:"Stocks sur Sites"},stock_ouverture:{en:"Opening Stock",fr:"Stock Ouverture"},entrees:{en:"Entries",fr:"Entres"},sorties:{en:"Exits",fr:"Sorties"},stock_fermeture:{en:"Closing Stock",fr:"Stock Fermeture"},poids_kg:{en:"Weight (Kg)",fr:"Poids (Kg)"},narratif_stocks_sites:{en:"Narrative (Site Stocks)",fr:"Narratif (Stocks Sites)"},stock_magasin_presse:{en:"Pressing Warehouse Stock",fr:"Stock Magasin de Presse"},colis:{en:"Package",fr:"Colis"},algues_en_vrac:{en:"Bulk Seaweed",fr:"Algues en Vrac"},algues_pressees:{en:"Pressed Seaweed",fr:"Algues Presses"},narratif_stocks_magasin:{en:"Narrative (Warehouse)",fr:"Narratif (Magasin)"},liste_exportations_realisees:{en:"List of Realized Exports",fr:"Liste des Exportations Ralises"},quantite_expedie:{en:"Qty Shipped",fr:"Qte Expdie"},nombre_conteneur:{en:"Container Count",fr:"Nbr Conteneur"},valeur_totale:{en:"Total Value",fr:"Valeur Totale"},facture_n:{en:"Invoice N",fr:"Facture N"},po:{en:"PO",fr:"PO"},destinataire:{en:"Consignee",fr:"Destinataire"},de_la_periode:{en:"Of the Period",fr:"De la Priode"},de_annee:{en:"Of the Year",fr:"De l'Anne"},narratif_exportations_realisees:{en:"Narrative (Exports)",fr:"Narratif (Exportations)"},production_mensuelle_par_site:{en:"Monthly Production by Site",fr:"Production Mensuelle par Site"},narratif_production_mensuelle:{en:"Narrative (Production)",fr:"Narratif (Production)"},situation_credits:{en:"Credit Situation",fr:"Situation des Crdits"},effectif_fermiers_concernes:{en:"Farmers Concerned",fr:"Effectif fermiers concerns"},solde_credits:{en:"Credit Balance",fr:"Solde crdits"},total_remboursements:{en:"Total Repayments",fr:"Total remboursements"},narratif_situation_credits:{en:"Narrative (Credits)",fr:"Narratif (Crdits)"},statistique_individuelle_fermiers:{en:"Individual Farmer Statistics",fr:"Statistique Individuelle des Fermiers"},narratif_statistique_individuelle:{en:"Narrative (Farmers)",fr:"Narratif (Fermiers)"},report_narrative_note:{en:"Note: Narratives are generated by AI based on data.",fr:"Note : Les narratifs sont gnrs par IA sur la base des donnes."},customReportTitle:{en:"Custom Report",fr:"Rapport Personnalis"},totalCreditsIssued:{en:"Total Credits Issued",fr:"Total Crdits mis"},totalCreditAmount:{en:"Total Credit Amount",fr:"Montant Total Crdits"},aiAnalysis:{en:"AI Analysis",fr:"Analyse IA"},productionSummary:{en:"Production Summary",fr:"Rsum de la Production"},totalPlantedLines:{en:"Total Planted Lines",fr:"Total Lignes Plantes"},incidentsReported:{en:"Incidents Reported",fr:"Incidents Signals"},noIncidentsForFarmer:{en:"No incidents reported for this farmer.",fr:"Aucun incident signal pour ce fermier."},narrativeFarmerPerformance:{en:"Farmer Performance Review",fr:"Bilan Performance Fermier"},legendColorBlue:{en:"Blue:",fr:"Bleu :"},legendColorRed:{en:"Red:",fr:"Rouge :"},legendColorBlack:{en:"Black:",fr:"Noir :"},legendPlantedLines:{en:"Planted Lines",fr:"Lignes Plantes"},legendHarvestedLines:{en:"Harvested Lines",fr:"Lignes Rcoltes"},legendProductionKg:{en:"Production (Kg)",fr:"Production (Kg)"},pagination:{showing:{en:"Showing",fr:"Affichage de"},of:{en:"of",fr:"sur"},results:{en:"results",fr:"rsultats"},previous:{en:"Previous",fr:"Prcdent"},next:{en:"Next",fr:"Suivant"},itemsPerPage:{en:"Items per page",fr:"lments par page"}},manual_introduction:{en:"Introduction",fr:"Introduction"},manual_introduction_text:{en:"Welcome to AlgaManage, your comprehensive Seaweed Farm ERP system. This manual will guide you through the key features of the application.",fr:"Bienvenue sur AlgaManage, votre systme ERP complet pour la gestion de fermes d'algues. Ce manuel vous guidera  travers les principales fonctionnalits de l'application."},manual_user_management:{en:"User Management",fr:"Gestion des Utilisateurs"},manual_user_management_text:{en:'<ul><li><strong>Invite Users:</strong> Go to Settings > User Management. Click "Invite User", enter their email or phone number, and select a role.</li><li><strong>Manage Roles:</strong> Define custom roles with specific permissions in Settings > Roles.</li></ul>',fr:'<ul><li><strong>Inviter des Utilisateurs :</strong> Allez dans Paramtres > Gestion des Utilisateurs. Cliquez sur "Inviter un Utilisateur", entrez leur email ou numro de tlphone, et slectionnez un rle.</li><li><strong>Grer les Rles :</strong> Dfinissez des rles personnaliss avec des permissions spcifiques dans Paramtres > Rles.</li></ul>'},manual_dashboard:{en:"Dashboard",fr:"Tableau de Bord"},manual_dashboard_text:{en:"<p>The dashboard provides a real-time overview of your farm's performance, including active cycles, harvest forecasts, and key alerts.</p>",fr:"<p>Le tableau de bord offre un aperu en temps rel des performances de votre ferme, incluant les cycles actifs, les prvisions de rcolte et les alertes cls.</p>"},manual_operations:{en:"Operations",fr:"Oprations"},manual_operations_text:{en:"<ul><li><strong>Map:</strong> Visualize sites, zones, and modules geographically.</li><li><strong>Cycles:</strong> Track cultivation from planting to harvest.</li><li><strong>Harvesting:</strong> Record harvests and manage post-harvest processing (drying, bagging).</li></ul>",fr:"<ul><li><strong>Carte :</strong> Visualisez gographiquement les sites, zones et modules.</li><li><strong>Cycles :</strong> Suivez la culture de la plantation  la rcolte.</li><li><strong>Rcolte :</strong> Enregistrez les rcoltes et grez le traitement post-rcolte (schage, mise en sac).</li></ul>"},manual_inventory:{en:"Inventory",fr:"Inventaire"},manual_inventory_text:{en:"<p>Manage stock levels across sites and the central warehouse. Track movements, farmer deliveries, and prepare shipments for export.</p>",fr:"<p>Grez les niveaux de stock sur les sites et dans l'entrept central. Suivez les mouvements, les livraisons des fermiers et prparez les expditions pour l'export.</p>"},manual_stakeholders:{en:"Stakeholders",fr:"Acteurs"},manual_stakeholders_text:{en:"<p>Maintain records of farmers, employees, and service providers. Manage contracts and assignments.</p>",fr:"<p>Maintenez les registres des fermiers, employs et prestataires. Grez les contrats et les affectations.</p>"},manual_monitoring:{en:"Monitoring",fr:"Suivi"},manual_monitoring_text:{en:"<p>Log environmental data (periodic tests) and report incidents (pests, equipment failure) to ensure optimal farm health.</p>",fr:"<p>Enregistrez les donnes environnementales (tests priodiques) et signalez les incidents (parasites, pannes d'quipement) pour assurer la sant optimale de la ferme.</p>"},manual_reports:{en:"Reports",fr:"Rapports"},manual_reports_text:{en:"<p>Generate comprehensive PDF reports for production, financials, inventory, and more. Use the custom report builder for specific needs.</p>",fr:"<p>Gnrez des rapports PDF complets pour la production, les finances, l'inventaire et plus encore. Utilisez le gnrateur de rapports personnaliss pour des besoins spcifiques.</p>"},manual_settings:{en:"Settings",fr:"Paramtres"},manual_settings_text:{en:"<p>Configure global application settings, including company details, currency, language, and system data management.</p>",fr:"<p>Configurez les paramtres globaux de l'application, y compris les dtails de l'entreprise, la devise, la langue et la gestion des donnes systme.</p>"},manual_step_periodic_test_title:{en:"Tracking Growth Trends",fr:"Suivre les tendances de croissance"},manual_step_periodic_test_text:{en:'To track a specific line over time, use a consistent "Identity/Code" (e.g., "LINE-A1") for every period (Planting through P5). This allows the system to calculate the SGR between consecutive dates.',fr:`Pour suivre une ligne spcifique dans le temps, utilisez un "Identifiant/Code" cohrent (ex: "LINE-A1") pour chaque priode (de la plantation jusqu' P5). Cela permet au systme de calculer le SGR entre des dates conscutives.`},manual_incidents_guide_title:{en:"Incident Reporting",fr:"Signalement d'Incidents"},manual_incidents_guide_text:{en:"Log any issues affecting your farm, from pests to equipment failure. Uploading a photo enables AI-powered diagnosis and treatment suggestions.",fr:"Signalez tout problme affectant votre ferme, des parasites aux pannes d'quipement. Le tlchargement d'une photo permet un diagnostic et des suggestions de traitement par IA."},manual_storage_guide_title:{en:"On-Site Storage & Bagging Transfer",fr:"Stockage sur Site & Transfert aprs Ensachage"},manual_storage_guide_text:{en:"This section tracks seaweed that has been bagged but not yet transferred to a central warehouse. It represents the final stage of on-site production.",fr:"Cette section suit les algues qui ont t mises en sac mais pas encore transfres  un entrept central. Elle reprsente la dernire tape de la production sur site."},manual_step_normal_transfer_title:{en:"Normal Transfer Guide",fr:"Guide du Transfert Normal"},manual_step_normal_transfer_text:{en:`1. Harvest a batch.
2. Complete Drying & Bagging.
3. Navigate to On-Site Storage > Normal Transfer.
4. Select the bagged batches.
5. Click "Transfer to Warehouse" and confirm the date.`,fr:`1. Rcoltez un lot.
2. Terminez le schage et la mise en sac.
3. Allez dans Stockage sur site > Transfert normal.
4. Slectionnez les lots ensachs.
5. Cliquez sur "Transfrer  l'entrept" et confirmez la date.`},manual_deliveries_guide_title:{en:"Farmer Deliveries (Dry)",fr:"Livraisons Fermiers (Sec)"},manual_deliveries_guide_text:{en:"Record dry seaweed delivered directly by farmers to a site or the central warehouse.",fr:"Enregistrez les algues sches livres directement par les fermiers  un site ou  l'entrept central."},manual_transfers_guide_title:{en:"Inter-Site Transfers (Shipping Slips)",fr:"Transferts Inter-Sites (Bons d'expdition)"},manual_transfers_guide_text:{en:"Use this to move stock between different farm sites or from a farm site to the central pressing warehouse.",fr:"Utilisez cette fonction pour dplacer le stock entre diffrents sites de la ferme ou d'un site  l'entrept central de pressage."},manual_step_shipping_slip_title:{en:"Creating a Shipping Slip",fr:"Crer un bon d'expdition"},manual_step_shipping_slip_text:{en:`1. Select Source Site.
2. Select Destination (Warehouse or other Site).
3. Enter individual bag weights.
4. Save to initiate "Awaiting Shipment" status.`,fr:`1. Slectionnez le site d'origine.
2. Slectionnez la destination (Magasin ou autre site).
3. Saisissez les poids individuels des sacs.
4. Enregistrez pour initier le statut "En attente d'expdition".`},manual_pressing_guide_title:{en:"Pressing Warehouse",fr:"Entrept de Pressage"},manual_pressing_guide_text:{en:'This module manages two types of stock: "Bulk Seaweed" (raw material) and "Pressed Seaweed" (finished goods). A "Pressing Slip" consumes bulk stock to create pressed stock.',fr:'Ce module gre deux types de stock : "Algues en Vrac" (matire premire) et "Algues Presses" (produit fini). Un "Bon de Pressage" consomme du stock en vrac pour crer du stock press.'},manual_exports_guide_title:{en:"Exports",fr:"Exportations"},manual_exports_guide_text:{en:"Create export documents (Invoice, Packing List, C.O.) by linking one or more completed Pressing Slips. This deducts the final product from the warehouse stock.",fr:"Crez des documents d'exportation (Facture, Liste de Colisage, C.O.) en liant un ou plusieurs Bons de Pressage termins. Cela dduit le produit fini du stock de l'entrept."},manual_tests_guide_title:{en:"Periodic Tests",fr:"Tests Priodiques"},manual_tests_guide_text:{en:"Record environmental data (growth, salinity, temperature) to monitor site health.",fr:"Enregistrez les donnes environnementales (croissance, salinit, temprature) pour surveiller la sant du site."}},dx={...Sj,...wj,...Tj,...jj,..._j},sb=S.createContext(void 0),Ej=({children:e})=>{const{settings:t}=Ke(),s=t.language,a=S.useCallback(i=>dx[i]?dx[i][s]:i,[s]);return n.jsx(sb.Provider,{value:{language:s,t:a},children:e})},we=()=>{const e=S.useContext(sb);if(e===void 0)throw new Error("useLocalization must be used within a LocalizationProvider");return e},Cj="modulepreload",Ij=function(e){return"/"+e},ux={},Ln=function(t,s,a){let i=Promise.resolve();if(s&&s.length>0){let c=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=c(s.map(h=>{if(h=Ij(h),h in ux)return;ux[h]=!0;const m=h.endsWith(".css"),x=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${x}`))return;const y=document.createElement("link");if(y.rel=m?"stylesheet":Cj,m||(y.as="script"),y.crossOrigin="",y.href=h,f&&y.setAttribute("nonce",f),document.head.appendChild(y),m)return new Promise((b,T)=>{y.addEventListener("load",b),y.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return i.then(c=>{for(const u of c||[])u.status==="rejected"&&l(u.reason);return t().catch(l)})};function ud(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]]);return s}function Aj(e,t,s,a){function i(l){return l instanceof s?l:new s(function(c){c(l)})}return new(s||(s=Promise))(function(l,c){function u(m){try{h(a.next(m))}catch(x){c(x)}}function f(m){try{h(a.throw(m))}catch(x){c(x)}}function h(m){m.done?l(m.value):i(m.value).then(u,f)}h((a=a.apply(e,t||[])).next())})}const kj=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Xf extends Error{constructor(t,s="FunctionsError",a){super(t),this.name=s,this.context=a}}class Dj extends Xf{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class hx extends Xf{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class fx extends Xf{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var uf;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(uf||(uf={}));class Rj{constructor(t,{headers:s={},customFetch:a,region:i=uf.Any}={}){this.url=t,this.headers=s,this.region=i,this.fetch=kj(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Aj(this,arguments,void 0,function*(s,a={}){var i;let l,c;try{const{headers:u,method:f,body:h,signal:m,timeout:x}=a;let y={},{region:b}=a;b||(b=this.region);const T=new URL(`${this.url}/${s}`);b&&b!=="any"&&(y["x-region"]=b,T.searchParams.set("forceFunctionRegion",b));let _;h&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(y["Content-Type"]="application/octet-stream",_=h):typeof h=="string"?(y["Content-Type"]="text/plain",_=h):typeof FormData<"u"&&h instanceof FormData?_=h:(y["Content-Type"]="application/json",_=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?_=JSON.stringify(h):_=h;let j=m;x&&(c=new AbortController,l=setTimeout(()=>c.abort(),x),m?(j=c.signal,m.addEventListener("abort",()=>c.abort())):j=c.signal);const E=yield this.fetch(T.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},y),this.headers),u),body:_,signal:j}).catch(M=>{throw new Dj(M)}),k=E.headers.get("x-relay-error");if(k&&k==="true")throw new hx(E);if(!E.ok)throw new fx(E);let C=((i=E.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),A;return C==="application/json"?A=yield E.json():C==="application/octet-stream"||C==="application/pdf"?A=yield E.blob():C==="text/event-stream"?A=E:C==="multipart/form-data"?A=yield E.formData():A=yield E.text(),{data:A,error:null,response:E}}catch(u){return{data:null,error:u,response:u instanceof fx||u instanceof hx?u.context:void 0}}finally{l&&clearTimeout(l)}})}}var Mj=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},Pj=class{constructor(e){var t,s,a;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,this.urlLengthLimit=(a=e.urlLengthLimit)!==null&&a!==void 0?a:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let i=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{let c=null,u=null,f=null,h=l.status,m=l.statusText;if(l.ok){var x,y;if(s.method!=="HEAD"){var b;const E=await l.text();E===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((b=s.headers.get("Accept"))===null||b===void 0)&&b.includes("application/vnd.pgrst.plan+text"))?u=E:u=JSON.parse(E))}const _=(x=s.headers.get("Prefer"))===null||x===void 0?void 0:x.match(/count=(exact|planned|estimated)/),j=(y=l.headers.get("content-range"))===null||y===void 0?void 0:y.split("/");_&&j&&j.length>1&&(f=parseInt(j[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,f=null,h=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var T;const _=await l.text();try{c=JSON.parse(_),Array.isArray(c)&&l.status===404&&(u=[],c=null,h=200,m="OK")}catch{l.status===404&&_===""?(h=204,m="No Content"):c={message:_}}if(c&&s.isMaybeSingle&&(!(c==null||(T=c.details)===null||T===void 0)&&T.includes("0 rows"))&&(c=null,h=200,m="OK"),c&&s.shouldThrowOnError)throw new Mj(c)}return{error:c,data:u,count:f,status:h,statusText:m}});return this.shouldThrowOnError||(i=i.catch(l=>{var c;let u="",f="",h="";const m=l==null?void 0:l.cause;if(m){var x,y,b,T;const E=(x=m==null?void 0:m.message)!==null&&x!==void 0?x:"",k=(y=m==null?void 0:m.code)!==null&&y!==void 0?y:"";u=`${(b=l==null?void 0:l.name)!==null&&b!==void 0?b:"FetchError"}: ${l==null?void 0:l.message}`,u+=`

Caused by: ${(T=m==null?void 0:m.name)!==null&&T!==void 0?T:"Error"}: ${E}`,k&&(u+=` (${k})`),m!=null&&m.stack&&(u+=`
${m.stack}`)}else{var _;u=(_=l==null?void 0:l.stack)!==null&&_!==void 0?_:""}const j=this.url.toString().length;return(l==null?void 0:l.name)==="AbortError"||(l==null?void 0:l.code)==="ABORT_ERR"?(h="",f="Request was aborted (timeout or manual cancellation)",j>this.urlLengthLimit&&(f+=`. Note: Your request URL is ${j} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((m==null?void 0:m.name)==="HeadersOverflowError"||(m==null?void 0:m.code)==="UND_ERR_HEADERS_OVERFLOW")&&(h="",f="HTTP headers exceeded server limits (typically 16KB)",j>this.urlLengthLimit&&(f+=`. Your request URL is ${j} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(c=l==null?void 0:l.name)!==null&&c!==void 0?c:"FetchError"}: ${l==null?void 0:l.message}`,details:u,hint:f,code:h},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}},Oj=class extends Pj{select(e){let t=!1;const s=(e??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:a,referencedTable:i=a}={}){const l=i?`${i}.order`:"order",c=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${c?`${c},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:a=s}={}){const i=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(l,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:a=!1,wal:i=!1,format:l="text"}={}){var c;const u=[e?"analyze":null,t?"verbose":null,s?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),f=(c=this.headers.get("Accept"))!==null&&c!==void 0?c:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${f}"; options=${u};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const mx=new RegExp("[,()]");var gi=class extends Oj{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&mx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}notIn(e,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&mx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`not.in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const l=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${l}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const a=s?`${s}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}},Lj=class{constructor(e,{headers:t={},schema:s,fetch:a,urlLengthLimit:i=8e3}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=a,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:s=!1,count:a}=t??{},i=s?"HEAD":"GET";let l=!1;const c=(e??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join(""),{url:u,headers:f}=this.cloneRequestState();return u.searchParams.set("select",c),a&&f.append("Prefer",`count=${a}`),new gi({method:i,url:u,headers:f,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:s=!0}={}){var a;const i="POST",{url:l,headers:c}=this.cloneRequestState();if(t&&c.append("Prefer",`count=${t}`),s||c.append("Prefer","missing=default"),Array.isArray(e)){const u=e.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(u.length>0){const f=[...new Set(u)].map(h=>`"${h}"`);l.searchParams.set("columns",f.join(","))}}return new gi({method:i,url:l,headers:c,schema:this.schema,body:e,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:a,defaultToNull:i=!0}={}){var l;const c="POST",{url:u,headers:f}=this.cloneRequestState();if(f.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&u.searchParams.set("on_conflict",t),a&&f.append("Prefer",`count=${a}`),i||f.append("Prefer","missing=default"),Array.isArray(e)){const h=e.reduce((m,x)=>m.concat(Object.keys(x)),[]);if(h.length>0){const m=[...new Set(h)].map(x=>`"${x}"`);u.searchParams.set("columns",m.join(","))}}return new gi({method:c,url:u,headers:f,schema:this.schema,body:e,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var s;const a="PATCH",{url:i,headers:l}=this.cloneRequestState();return t&&l.append("Prefer",`count=${t}`),new gi({method:a,url:i,headers:l,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const s="DELETE",{url:a,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new gi({method:s,url:a,headers:i,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Xo(e){"@babel/helpers - typeof";return Xo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xo(e)}function Uj(e,t){if(Xo(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(Xo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Fj(e){var t=Uj(e,"string");return Xo(t)=="symbol"?t:t+""}function Bj(e,t,s){return(t=Fj(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function px(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,a)}return s}function Ac(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?px(Object(s),!0).forEach(function(a){Bj(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):px(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var Gj=class ab{constructor(t,{headers:s={},schema:a,fetch:i,timeout:l,urlLengthLimit:c=8e3}={}){this.url=t,this.headers=new Headers(s),this.schemaName=a,this.urlLengthLimit=c;const u=i??globalThis.fetch;l!==void 0&&l>0?this.fetch=(f,h)=>{const m=new AbortController,x=setTimeout(()=>m.abort(),l),y=h==null?void 0:h.signal;if(y){if(y.aborted)return clearTimeout(x),u(f,h);const b=()=>{clearTimeout(x),m.abort()};return y.addEventListener("abort",b,{once:!0}),u(f,Ac(Ac({},h),{},{signal:m.signal})).finally(()=>{clearTimeout(x),y.removeEventListener("abort",b)})}return u(f,Ac(Ac({},h),{},{signal:m.signal})).finally(()=>clearTimeout(x))}:this.fetch=u}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Lj(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new ab(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,s={},{head:a=!1,get:i=!1,count:l}={}){var c;let u;const f=new URL(`${this.url}/rpc/${t}`);let h;const m=b=>b!==null&&typeof b=="object"&&(!Array.isArray(b)||b.some(m)),x=a&&Object.values(s).some(m);x?(u="POST",h=s):a||i?(u=a?"HEAD":"GET",Object.entries(s).filter(([b,T])=>T!==void 0).map(([b,T])=>[b,Array.isArray(T)?`{${T.join(",")}}`:`${T}`]).forEach(([b,T])=>{f.searchParams.append(b,T)})):(u="POST",h=s);const y=new Headers(this.headers);return x?y.set("Prefer",l?`count=${l},return=minimal`:"return=minimal"):l&&y.set("Prefer",`count=${l}`),new gi({method:u,url:f,headers:y,schema:this.schemaName,body:h,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch,urlLengthLimit:this.urlLengthLimit})}};class zj{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const s=globalThis.process;if(s){const a=s.versions;if(a&&a.node){const i=a.node,l=parseInt(i.replace(/^v/,"").split(".")[0]);return l>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${l} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${l} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const a=this.getWebSocketConstructor();return new a(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const $j="2.97.0",Hj=`realtime-js/${$j}`,qj="1.0.0",rb="2.0.0",gx=rb,hf=1e4,Vj=1e3,Kj=100;var Xa;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Xa||(Xa={}));var xn;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(xn||(xn={}));var Cs;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Cs||(Cs={}));var ff;(function(e){e.websocket="websocket"})(ff||(ff={}));var _r;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(_r||(_r={}));class Wj{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,a;const i=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(t){var s,a;const i=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:{},c=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,c)}_encodeUserBroadcastPush(t,s,a){var i,l;const c=t.topic,u=(i=t.ref)!==null&&i!==void 0?i:"",f=(l=t.join_ref)!==null&&l!==void 0?l:"",h=t.payload.event,m=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},x=Object.keys(m).length===0?"":JSON.stringify(m);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`topic length ${c.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(x.length>255)throw new Error(`metadata length ${x.length} exceeds maximum of 255`);const y=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+u.length+c.length+h.length+x.length,b=new ArrayBuffer(this.HEADER_LENGTH+y);let T=new DataView(b),_=0;T.setUint8(_++,this.KINDS.userBroadcastPush),T.setUint8(_++,f.length),T.setUint8(_++,u.length),T.setUint8(_++,c.length),T.setUint8(_++,h.length),T.setUint8(_++,x.length),T.setUint8(_++,s),Array.from(f,E=>T.setUint8(_++,E.charCodeAt(0))),Array.from(u,E=>T.setUint8(_++,E.charCodeAt(0))),Array.from(c,E=>T.setUint8(_++,E.charCodeAt(0))),Array.from(h,E=>T.setUint8(_++,E.charCodeAt(0))),Array.from(x,E=>T.setUint8(_++,E.charCodeAt(0)));var j=new Uint8Array(b.byteLength+a.byteLength);return j.set(new Uint8Array(b),0),j.set(new Uint8Array(a),b.byteLength),j.buffer}decode(t,s){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return s(a)}if(typeof t=="string"){const a=JSON.parse(t),[i,l,c,u,f]=a;return s({join_ref:i,ref:l,topic:c,event:u,payload:f})}return s({})}_binaryDecode(t){const s=new DataView(t),a=s.getUint8(0),i=new TextDecoder;switch(a){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,s,i)}}_decodeUserBroadcast(t,s,a){const i=s.getUint8(1),l=s.getUint8(2),c=s.getUint8(3),u=s.getUint8(4);let f=this.HEADER_LENGTH+4;const h=a.decode(t.slice(f,f+i));f=f+i;const m=a.decode(t.slice(f,f+l));f=f+l;const x=a.decode(t.slice(f,f+c));f=f+c;const y=t.slice(f,t.byteLength),b=u===this.JSON_ENCODING?JSON.parse(a.decode(y)):y,T={type:this.BROADCAST_EVENT,event:m,payload:b};return c>0&&(T.meta=JSON.parse(x)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:T}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t==null?void 0:t.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>s.includes(a)))}}class ib{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Bt;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Bt||(Bt={}));const yx=(e,t,s={})=>{var a;const i=(a=s.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((l,c)=>(l[c]=Jj(c,e,t,i),l),{}):{}},Jj=(e,t,s,a)=>{const i=t.find(u=>u.name===e),l=i==null?void 0:i.type,c=s[e];return l&&!a.includes(l)?ob(l,c):mf(c)},ob=(e,t)=>{if(e.charAt(0)==="_"){const s=e.slice(1,e.length);return Zj(t,s)}switch(e){case Bt.bool:return Yj(t);case Bt.float4:case Bt.float8:case Bt.int2:case Bt.int4:case Bt.int8:case Bt.numeric:case Bt.oid:return Xj(t);case Bt.json:case Bt.jsonb:return Qj(t);case Bt.timestamp:return e_(t);case Bt.abstime:case Bt.date:case Bt.daterange:case Bt.int4range:case Bt.int8range:case Bt.money:case Bt.reltime:case Bt.text:case Bt.time:case Bt.timestamptz:case Bt.timetz:case Bt.tsrange:case Bt.tstzrange:return mf(t);default:return mf(t)}},mf=e=>e,Yj=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Xj=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Qj=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},Zj=(e,t)=>{if(typeof e!="string")return e;const s=e.length-1,a=e[s];if(e[0]==="{"&&a==="}"){let l;const c=e.slice(1,s);try{l=JSON.parse("["+c+"]")}catch{l=c?c.split(","):[]}return l.map(u=>ob(t,u))}return e},e_=e=>typeof e=="string"?e.replace(" ","T"):e,lb=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class zh{constructor(t,s,a={},i=hf){this.channel=t,this.event=s,this.payload=a,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var a;return this._hasReceived(t)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var xx;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(xx||(xx={}));class qo{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},i=>{const{onJoin:l,onLeave:c,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qo.syncState(this.state,i,l,c),this.pendingDiffs.forEach(f=>{this.state=qo.syncDiff(this.state,f,l,c)}),this.pendingDiffs=[],u()}),this.channel._on(a.diff,{},i=>{const{onJoin:l,onLeave:c,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=qo.syncDiff(this.state,i,l,c),u())}),this.onJoin((i,l,c)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:l,newPresences:c})}),this.onLeave((i,l,c)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:l,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,a,i){const l=this.cloneDeep(t),c=this.transformState(s),u={},f={};return this.map(l,(h,m)=>{c[h]||(f[h]=m)}),this.map(c,(h,m)=>{const x=l[h];if(x){const y=m.map(j=>j.presence_ref),b=x.map(j=>j.presence_ref),T=m.filter(j=>b.indexOf(j.presence_ref)<0),_=x.filter(j=>y.indexOf(j.presence_ref)<0);T.length>0&&(u[h]=T),_.length>0&&(f[h]=_)}else u[h]=m}),this.syncDiff(l,{joins:u,leaves:f},a,i)}static syncDiff(t,s,a,i){const{joins:l,leaves:c}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),i||(i=()=>{}),this.map(l,(u,f)=>{var h;const m=(h=t[u])!==null&&h!==void 0?h:[];if(t[u]=this.cloneDeep(f),m.length>0){const x=t[u].map(b=>b.presence_ref),y=m.filter(b=>x.indexOf(b.presence_ref)<0);t[u].unshift(...y)}a(u,m,f)}),this.map(c,(u,f)=>{let h=t[u];if(!h)return;const m=f.map(x=>x.presence_ref);h=h.filter(x=>m.indexOf(x.presence_ref)<0),t[u]=h,i(u,h,f),h.length===0&&delete t[u]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(a=>s(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,a)=>{const i=t[a];return"metas"in i?s[a]=i.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):s[a]=i,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var vx;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(vx||(vx={}));var Vo;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Vo||(Vo={}));var fa;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(fa||(fa={}));class Ni{constructor(t,s={config:{}},a){var i,l;if(this.topic=t,this.params=s,this.socket=a,this.bindings={},this.state=xn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new zh(this,Cs.join,this.params,this.timeout),this.rejoinTimer=new ib(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xn.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=xn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=xn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Cs.reply,{},(c,u)=>{this._trigger(this._replyEventName(u),c)}),this.presence=new qo(this),this.broadcastEndpointURL=lb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var a,i,l;if(this.socket.isConnected()||this.socket.connect(),this.state==xn.closed){const{config:{broadcast:c,presence:u,private:f}}=this.params,h=(i=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(b=>b.filter))!==null&&i!==void 0?i:[],m=!!this.bindings[Vo.PRESENCE]&&this.bindings[Vo.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,x={},y={broadcast:c,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:h,private:f};this.socket.accessTokenValue&&(x.access_token=this.socket.accessTokenValue),this._onError(b=>t==null?void 0:t(fa.CHANNEL_ERROR,b)),this._onClose(()=>t==null?void 0:t(fa.CLOSED)),this.updateJoinPayload(Object.assign({config:y},x)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:b})=>{var T;if(this.socket._isManualToken()||this.socket.setAuth(),b===void 0){t==null||t(fa.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,j=(T=_==null?void 0:_.length)!==null&&T!==void 0?T:0,E=[];for(let k=0;k<j;k++){const C=_[k],{filter:{event:A,schema:M,table:I,filter:P}}=C,D=b&&b[k];if(D&&D.event===A&&Ni.isFilterValueEqual(D.schema,M)&&Ni.isFilterValueEqual(D.table,I)&&Ni.isFilterValueEqual(D.filter,P))E.push(Object.assign(Object.assign({},C),{id:D.id}));else{this.unsubscribe(),this.state=xn.errored,t==null||t(fa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,t&&t(fa.SUBSCRIBED);return}}).receive("error",b=>{this.state=xn.errored,t==null||t(fa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(fa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,a){return this.state===xn.joined&&t===Vo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,a)}async httpSend(t,s,a={}){var i;if(s==null)return Promise.reject("Payload is required for httpSend()");const l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(i=a.timeout)!==null&&i!==void 0?i:this.timeout);if(u.status===202)return{success:!0};let f=u.statusText;try{const h=await u.json();f=h.error||h.message||f}catch{}return Promise.reject(new Error(f))}async send(t,s={}){var a,i;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:c}=t,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:c,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((i=h.body)===null||i===void 0?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var c,u,f;const h=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(u=(c=this.params)===null||c===void 0?void 0:c.config)===null||u===void 0?void 0:u.broadcast)===null||f===void 0)&&f.ack)&&l("ok"),h.receive("ok",()=>l("ok")),h.receive("error",()=>l("error")),h.receive("timeout",()=>l("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=xn.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Cs.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(i=>{a=new zh(this,Cs.leave,{},t),a.receive("ok",()=>{s(),i("ok")}).receive("timeout",()=>{s(),i("timed out")}).receive("error",()=>{i("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a==null||a.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=xn.closed,this.bindings={}}async _fetchWithTimeout(t,s,a){const i=new AbortController,l=setTimeout(()=>i.abort(),a),c=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:i.signal}));return clearTimeout(l),c}_push(t,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new zh(this,t,s,a);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Kj){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,a){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,a){var i,l;const c=t.toLocaleLowerCase(),{close:u,error:f,leave:h,join:m}=Cs;if(a&&[u,f,h,m].indexOf(c)>=0&&a!==this._joinRef())return;let y=this._onMessage(c,s,a);if(s&&!y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(b=>{var T,_,j;return((T=b.filter)===null||T===void 0?void 0:T.event)==="*"||((j=(_=b.filter)===null||_===void 0?void 0:_.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===c}).map(b=>b.callback(y,a)):(l=this.bindings[c])===null||l===void 0||l.filter(b=>{var T,_,j,E,k,C;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in b){const A=b.id,M=(T=b.filter)===null||T===void 0?void 0:T.event;return A&&((_=s.ids)===null||_===void 0?void 0:_.includes(A))&&(M==="*"||(M==null?void 0:M.toLocaleLowerCase())===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const A=(k=(E=b==null?void 0:b.filter)===null||E===void 0?void 0:E.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return A==="*"||A===((C=s==null?void 0:s.event)===null||C===void 0?void 0:C.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===c}).map(b=>{if(typeof y=="object"&&"ids"in y){const T=y.data,{schema:_,table:j,commit_timestamp:E,type:k,errors:C}=T;y=Object.assign(Object.assign({},{schema:_,table:j,commit_timestamp:E,eventType:k,new:{},old:{},errors:C}),this._getPayloadRecords(T))}b.callback(y,a)})}_isClosed(){return this.state===xn.closed}_isJoined(){return this.state===xn.joined}_isJoining(){return this.state===xn.joining}_isLeaving(){return this.state===xn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,a){const i=t.toLocaleLowerCase(),l={type:i,filter:s,callback:a};return this.bindings[i]?this.bindings[i].push(l):this.bindings[i]=[l],this}_off(t,s){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(i=>{var l;return!(((l=i.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===a&&Ni.isEqual(i.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(t[a]!==s[a])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Cs.close,{},t)}_onError(t){this._on(Cs.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=yx(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=yx(t.columns,t.old_record)),s}}const $h=()=>{},kc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},t_=[1e3,2e3,5e3,1e4],n_=1e4,s_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class a_{constructor(t,s){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=hf,this.transport=null,this.heartbeatIntervalMs=kc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$h,this.ref=0,this.reconnectTimer=null,this.vsn=gx,this.logger=$h,this.conn=null,this.sendBuffer=[],this.serializer=new Wj,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...l)=>i(...l):(...l)=>fetch(...l),!(!((a=s==null?void 0:s.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${ff.websocket}`,this.httpEndpoint=lb(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=zj.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,a){this.logger(t,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Xa.connecting:return _r.Connecting;case Xa.open:return _r.Open;case Xa.closing:return _r.Closing;default:return _r.Closed}}isConnected(){return this.connectionState()===_r.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const a=`realtime:${t}`,i=this.getChannels().find(l=>l.topic===a);if(i)return i;{const l=new Ni(`realtime:${t}`,s,this);return this.channels.push(l),l}}push(t){const{topic:s,event:a,payload:i,ref:l}=t,c=()=>{this.encode(t,u=>{var f;(f=this.conn)===null||f===void 0||f.send(u)})};this.log("push",`${s} ${a} (${l})`,i),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Vj,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},kc.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply"&&s.ref&&s.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error",h)}catch(m){this.log("error","error in heartbeat callback",m)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:a,event:i,payload:l,ref:c}=s,u=c?`(${c})`:"",f=l.status||"";this.log("receive",`${f} ${a} ${i} ${u}`.trim(),l),this.channels.filter(h=>h._isMember(a)).forEach(h=>h._trigger(i,l,c)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Xa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Xa.open||this.conn.readyState===Xa.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(s){this.log("error","error in heartbeat callback",s)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(Cs.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const a=t.match(/\?/)?"&":"?",i=new URLSearchParams(s);return`${t}${a}${i}`}_workerObjectUrl(t){let s;if(t)s=t;else{const a=new Blob([s_],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,a=!1;if(t)s=t,a=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),s=this.accessTokenValue}else s=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(i=>{const l={access_token:s,version:Hj};s&&i.updateJoinPayload(l),i.joinedOnce&&i._isJoined()&&i._push(Cs.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(s)}catch(i){this.log("error",`error in ${t} callback`,i)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new ib(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},kc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,a,i,l,c,u,f,h,m,x,y,b;switch(this.transport=(s=t==null?void 0:t.transport)!==null&&s!==void 0?s:null,this.timeout=(a=t==null?void 0:t.timeout)!==null&&a!==void 0?a:hf,this.heartbeatIntervalMs=(i=t==null?void 0:t.heartbeatIntervalMs)!==null&&i!==void 0?i:kc.HEARTBEAT_INTERVAL,this.worker=(l=t==null?void 0:t.worker)!==null&&l!==void 0?l:!1,this.accessToken=(c=t==null?void 0:t.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(u=t==null?void 0:t.heartbeatCallback)!==null&&u!==void 0?u:$h,this.vsn=(f=t==null?void 0:t.vsn)!==null&&f!==void 0?f:gx,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=t==null?void 0:t.reconnectAfterMs)!==null&&h!==void 0?h:(T=>t_[T-1]||n_),this.vsn){case qj:this.encode=(m=t==null?void 0:t.encode)!==null&&m!==void 0?m:((T,_)=>_(JSON.stringify(T))),this.decode=(x=t==null?void 0:t.decode)!==null&&x!==void 0?x:((T,_)=>_(JSON.parse(T)));break;case rb:this.encode=(y=t==null?void 0:t.encode)!==null&&y!==void 0?y:this.serializer.encode.bind(this.serializer),this.decode=(b=t==null?void 0:t.decode)!==null&&b!==void 0?b:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Qo=class extends Error{constructor(e,t){var s;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((s=t.icebergType)==null?void 0:s.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function r_(e,t,s){const a=new URL(t,e);if(s)for(const[i,l]of Object.entries(s))l!==void 0&&a.searchParams.set(i,l);return a.toString()}async function i_(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function o_(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:s,path:a,query:i,body:l,headers:c}){const u=r_(e.baseUrl,a,i),f=await i_(e.auth),h=await t(u,{method:s,headers:{...l?{"Content-Type":"application/json"}:{},...f,...c},body:l?JSON.stringify(l):void 0}),m=await h.text(),x=(h.headers.get("content-type")||"").includes("application/json"),y=x&&m?JSON.parse(m):m;if(!h.ok){const b=x?y:void 0,T=b==null?void 0:b.error;throw new Qo((T==null?void 0:T.message)??`Request failed with status ${h.status}`,{status:h.status,icebergType:T==null?void 0:T.type,icebergCode:T==null?void 0:T.code,details:b})}return{status:h.status,headers:h.headers,data:y}}}}function Dc(e){return e.join("")}var l_=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Dc(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(e,t){const s={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Dc(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Dc(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Dc(e.namespace)}`}),!0}catch(t){if(t instanceof Qo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(s){if(s instanceof Qo&&s.status===409)return;throw s}}};function ci(e){return e.join("")}var c_=class{constructor(e,t="",s){this.client=e,this.prefix=t,this.accessDelegation=s}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(e,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ci(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(s){if(s instanceof Qo&&s.status===404)return!1;throw s}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(s){if(s instanceof Qo&&s.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw s}}},d_=class{constructor(e){var a;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const s=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=o_({baseUrl:s,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(a=e.accessDelegation)==null?void 0:a.join(","),this.namespaceOps=new l_(this.client,t),this.tableOps=new c_(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},hd=class extends Error{constructor(e,t="storage",s,a){super(e),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=s,this.statusCode=a}};function fd(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var Rc=class extends hd{constructor(e,t,s,a="storage"){super(e,a,t,s),this.name=a==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},cb=class extends hd{constructor(e,t,s="storage"){super(e,s),this.name=s==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const u_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),h_=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},pf=e=>{if(Array.isArray(e))return e.map(s=>pf(s));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([s,a])=>{const i=s.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));t[i]=pf(a)}),t},f_=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function Zo(e){"@babel/helpers - typeof";return Zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zo(e)}function m_(e,t){if(Zo(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(Zo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function p_(e){var t=m_(e,"string");return Zo(t)=="symbol"?t:t+""}function g_(e,t,s){return(t=p_(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function bx(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,a)}return s}function at(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?bx(Object(s),!0).forEach(function(a){g_(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):bx(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}const Nx=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},y_=async(e,t,s,a)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(s!=null&&s.noResolveJson)){const i=e,l=i.status||500;if(typeof i.json=="function")i.json().then(c=>{const u=(c==null?void 0:c.statusCode)||(c==null?void 0:c.code)||l+"";t(new Rc(Nx(c),l,u,a))}).catch(()=>{if(a==="vectors"){const c=l+"";t(new Rc(i.statusText||`HTTP ${l} error`,l,c,a))}else{const c=l+"";t(new Rc(i.statusText||`HTTP ${l} error`,l,c,a))}});else{const c=l+"";t(new Rc(i.statusText||`HTTP ${l} error`,l,c,a))}}else t(new cb(Nx(e),e,a))},x_=(e,t,s,a)=>{const i={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||e==="HEAD"||!a?at(at({},i),s):(h_(a)?(i.headers=at({"Content-Type":"application/json"},t==null?void 0:t.headers),i.body=JSON.stringify(a)):i.body=a,t!=null&&t.duplex&&(i.duplex=t.duplex),at(at({},i),s))};async function Uo(e,t,s,a,i,l,c){return new Promise((u,f)=>{e(s,x_(t,a,i,l)).then(h=>{if(!h.ok)throw h;if(a!=null&&a.noResolveJson)return h;if(c==="vectors"){const m=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!m||!m.includes("application/json"))return{}}return h.json()}).then(h=>u(h)).catch(h=>y_(h,f,a,c))})}function db(e="storage"){return{get:async(t,s,a,i)=>Uo(t,"GET",s,a,i,void 0,e),post:async(t,s,a,i,l)=>Uo(t,"POST",s,i,l,a,e),put:async(t,s,a,i,l)=>Uo(t,"PUT",s,i,l,a,e),head:async(t,s,a,i)=>Uo(t,"HEAD",s,at(at({},a),{},{noResolveJson:!0}),i,void 0,e),remove:async(t,s,a,i,l)=>Uo(t,"DELETE",s,i,l,a,e)}}const v_=db("storage"),{get:el,post:Es,put:gf,head:b_,remove:Qf}=v_,as=db("vectors");var ki=class{constructor(e,t={},s,a="storage"){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=u_(s),this.namespace=a}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=at(at({},this.headers),{},{[e]:t}),this}async handleOperation(e){var t=this;try{return{data:await e(),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(fd(s))return{data:null,error:s};throw s}}},N_=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fd(t))return{data:null,error:t};throw t}}};let ub;ub=Symbol.toStringTag;var S_=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[ub]="BlobDownloadBuilder",this.promise=null}asStream(){return new N_(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fd(t))return{data:null,error:t};throw t}}};const w_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Sx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var T_=class extends ki{constructor(e,t={},s,a){super(e,t,a,"storage"),this.bucketId=s}async uploadOrUpdate(e,t,s,a){var i=this;return i.handleOperation(async()=>{let l;const c=at(at({},Sx),a);let u=at(at({},i.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const f=c.metadata;typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),f&&l.append("metadata",i.encodeMetadata(f)),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.has("cacheControl")||l.append("cacheControl",c.cacheControl),f&&!l.has("metadata")&&l.append("metadata",i.encodeMetadata(f))):(l=s,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType,f&&(u["x-metadata"]=i.toBase64(i.encodeMetadata(f))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!c.duplex&&(c.duplex="half")),a!=null&&a.headers&&(u=at(at({},u),a.headers));const h=i._removeEmptyFolders(t),m=i._getFinalPath(h),x=await(e=="PUT"?gf:Es)(i.fetch,`${i.url}/object/${m}`,l,at({headers:u},c!=null&&c.duplex?{duplex:c.duplex}:{}));return{path:h,id:x.Id,fullPath:x.Key}})}async upload(e,t,s){return this.uploadOrUpdate("POST",e,t,s)}async uploadToSignedUrl(e,t,s,a){var i=this;const l=i._removeEmptyFolders(e),c=i._getFinalPath(l),u=new URL(i.url+`/object/upload/sign/${c}`);return u.searchParams.set("token",t),i.handleOperation(async()=>{let f;const h=at({upsert:Sx.upsert},a),m=at(at({},i.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",h.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",h.cacheControl)):(f=s,m["cache-control"]=`max-age=${h.cacheControl}`,m["content-type"]=h.contentType),{path:l,fullPath:(await gf(i.fetch,u.toString(),f,{headers:m})).Key}})}async createSignedUploadUrl(e,t){var s=this;return s.handleOperation(async()=>{let a=s._getFinalPath(e);const i=at({},s.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const l=await Es(s.fetch,`${s.url}/object/upload/sign/${a}`,{},{headers:i}),c=new URL(s.url+l.url),u=c.searchParams.get("token");if(!u)throw new hd("No token returned by API");return{signedUrl:c.toString(),path:e,token:u}})}async update(e,t,s){return this.uploadOrUpdate("PUT",e,t,s)}async move(e,t,s){var a=this;return a.handleOperation(async()=>await Es(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:a.headers}))}async copy(e,t,s){var a=this;return a.handleOperation(async()=>({path:(await Es(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:a.headers})).Key}))}async createSignedUrl(e,t,s){var a=this;return a.handleOperation(async()=>{let i=a._getFinalPath(e),l=await Es(a.fetch,`${a.url}/object/sign/${i}`,at({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:a.headers});const c=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{signedUrl:encodeURI(`${a.url}${l.signedURL}${c}`)}})}async createSignedUrls(e,t,s){var a=this;return a.handleOperation(async()=>{const i=await Es(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:e},{headers:a.headers}),l=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i.map(c=>at(at({},c),{},{signedUrl:c.signedURL?encodeURI(`${a.url}${c.signedURL}${l}`):null}))})}download(e,t,s){const a=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),l=i?`?${i}`:"",c=this._getFinalPath(e),u=()=>el(this.fetch,`${this.url}/${a}/${c}${l}`,{headers:this.headers,noResolveJson:!0},s);return new S_(u,this.shouldThrowOnError)}async info(e){var t=this;const s=t._getFinalPath(e);return t.handleOperation(async()=>pf(await el(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})))}async exists(e){var t=this;const s=t._getFinalPath(e);try{return await b_(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(fd(a)&&a instanceof cb){const i=a.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:a}}throw a}}getPublicUrl(e,t){const s=this._getFinalPath(e),a=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&a.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&a.push(c);let u=a.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${u}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await Qf(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,s){var a=this;return a.handleOperation(async()=>{const i=at(at(at({},w_),t),{},{prefix:e||""});return await Es(a.fetch,`${a.url}/object/list/${a.bucketId}`,i,{headers:a.headers},s)})}async listV2(e,t){var s=this;return s.handleOperation(async()=>{const a=at({},e);return await Es(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,a,{headers:s.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const j_="2.97.0",ol={"X-Client-Info":`storage-js/${j_}`};var __=class extends ki{constructor(e,t={},s,a){const i=new URL(e);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const l=i.href.replace(/\/$/,""),c=at(at({},ol),t);super(l,c,s,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const s=t.listBucketOptionsToQueryString(e);return await el(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await el(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var s=this;return s.handleOperation(async()=>await Es(s.fetch,`${s.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}))}async updateBucket(e,t){var s=this;return s.handleOperation(async()=>await gf(s.fetch,`${s.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await Es(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Qf(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},E_=class extends ki{constructor(e,t={},s){const a=e.replace(/\/$/,""),i=at(at({},ol),t);super(a,i,s,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await Es(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const s=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&s.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&s.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&s.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&s.set("sortOrder",e.sortOrder),e!=null&&e.search&&s.set("search",e.search);const a=s.toString(),i=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return await el(t.fetch,i,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Qf(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!f_(e))throw new hd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new d_({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(s,{get(i,l){const c=i[l];return typeof c!="function"?c:async(...u)=>{try{return{data:await c.apply(i,u),error:null}}catch(f){if(a)throw f;return{data:null,error:f}}}}})}},C_=class extends ki{constructor(e,t={},s){const a=e.replace(/\/$/,""),i=at(at({},ol),{},{"Content-Type":"application/json"},t);super(a,i,s,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var s=this;return s.handleOperation(async()=>await as.post(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:s.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var s=this;return s.handleOperation(async()=>await as.post(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:s.headers})||{})}},I_=class extends ki{constructor(e,t={},s){const a=e.replace(/\/$/,""),i=at(at({},ol),{},{"Content-Type":"application/json"},t);super(a,i,s,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},A_=class extends ki{constructor(e,t={},s){const a=e.replace(/\/$/,""),i=at(at({},ol),{},{"Content-Type":"application/json"},t);super(a,i,s,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await as.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},k_=class extends A_{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new D_(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,s=this;return t().call(s,e)}async getBucket(e){var t=()=>super.getBucket,s=this;return t().call(s,e)}async listBuckets(e={}){var t=()=>super.listBuckets,s=this;return t().call(s,e)}async deleteBucket(e){var t=()=>super.deleteBucket,s=this;return t().call(s,e)}},D_=class extends C_{constructor(e,t,s,a){super(e,t,a),this.vectorBucketName=s}async createIndex(e){var t=()=>super.createIndex,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,e)}index(e){return new R_(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},R_=class extends I_{constructor(e,t,s,a,i){super(e,t,i),this.vectorBucketName=s,this.indexName=a}async putVectors(e){var t=()=>super.putVectors,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(e){var t=()=>super.getVectors,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,s=this;return t().call(s,at(at({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},M_=class extends __{constructor(e,t={},s,a){super(e,t,s,a)}from(e){return new T_(this.url,this.headers,e,this.fetch)}get vectors(){return new k_(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new E_(this.url+"/iceberg",this.headers,this.fetch)}};const hb="2.97.0",yi=30*1e3,yf=3,Hh=yf*yi,P_="http://localhost:9999",O_="supabase.auth.token",L_={"X-Client-Info":`gotrue-js/${hb}`},xf="X-Supabase-Api-Version",fb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},U_=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,F_=600*1e3;class tl extends Error{constructor(t,s,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function Ze(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class B_ extends tl{constructor(t,s,a){super(t,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function G_(e){return Ze(e)&&e.name==="AuthApiError"}class Er extends tl{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class xa extends tl{constructor(t,s,a,i){super(t,a,i),this.name=s,this.status=a}}class ns extends xa{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qh(e){return Ze(e)&&e.name==="AuthSessionMissingError"}class di extends xa{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mc extends xa{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Pc extends xa{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function z_(e){return Ze(e)&&e.name==="AuthImplicitGrantRedirectError"}class wx extends xa{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $_ extends xa{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class vf extends xa{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Vh(e){return Ze(e)&&e.name==="AuthRetryableFetchError"}class Tx extends xa{constructor(t,s,a){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class bf extends xa{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Qc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jx=` 	
\r=`.split(""),H_=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<jx.length;t+=1)e[jx[t].charCodeAt(0)]=-2;for(let t=0;t<Qc.length;t+=1)e[Qc[t].charCodeAt(0)]=t;return e})();function _x(e,t,s){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(Qc[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(Qc[a]),t.queuedBits-=6}}function mb(e,t,s){const a=H_[e];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Ex(e){const t=[],s=c=>{t.push(String.fromCodePoint(c))},a={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},l=c=>{K_(c,a,s)};for(let c=0;c<e.length;c+=1)mb(e.charCodeAt(c),i,l);return t.join("")}function q_(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function V_(e,t){for(let s=0;s<e.length;s+=1){let a=e.charCodeAt(s);if(a>55295&&a<=56319){const i=(a-55296)*1024&65535;a=(e.charCodeAt(s+1)-56320&65535|i)+65536,s+=1}q_(a,t)}}function K_(e,t,s){if(t.utf8seq===0){if(e<=127){s(e);return}for(let a=1;a<6;a+=1)if((e>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function ji(e){const t=[],s={queue:0,queuedBits:0},a=i=>{t.push(i)};for(let i=0;i<e.length;i+=1)mb(e.charCodeAt(i),s,a);return new Uint8Array(t)}function W_(e){const t=[];return V_(e,s=>t.push(s)),new Uint8Array(t)}function Cr(e){const t=[],s={queue:0,queuedBits:0},a=i=>{t.push(i)};return e.forEach(i=>_x(i,s,a)),_x(null,s,a),t.join("")}function J_(e){return Math.round(Date.now()/1e3)+e}function Y_(){return Symbol("auth-callback")}const Dn=()=>typeof window<"u"&&typeof document<"u",Sr={tested:!1,writable:!1},pb=()=>{if(!Dn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Sr.tested)return Sr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Sr.tested=!0,Sr.writable=!0}catch{Sr.tested=!0,Sr.writable=!1}return Sr.writable};function X_(e){const t={},s=new URL(e);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((i,l)=>{t[l]=i})}catch{}return s.searchParams.forEach((a,i)=>{t[i]=a}),t}const gb=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Q_=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",xi=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},wr=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},kn=async(e,t)=>{await e.removeItem(t)};class md{constructor(){this.promise=new md.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}md.promiseConstructor=Promise;function Oc(e){const t=e.split(".");if(t.length!==3)throw new bf("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!U_.test(t[a]))throw new bf("JWT not in base64url format");return{header:JSON.parse(Ex(t[0])),payload:JSON.parse(Ex(t[1])),signature:ji(t[2]),raw:{header:t[0],payload:t[1]}}}async function Z_(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function eE(e,t){return new Promise((a,i)=>{(async()=>{for(let l=0;l<1/0;l++)try{const c=await e(l);if(!t(l,null,c)){a(c);return}}catch(c){if(!t(l,c)){i(c);return}}})()})}function tE(e){return("0"+e.toString(16)).substr(-2)}function nE(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let i="";for(let l=0;l<56;l++)i+=s.charAt(Math.floor(Math.random()*a));return i}return crypto.getRandomValues(t),Array.from(t,tE).join("")}async function sE(e){const s=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",s),i=new Uint8Array(a);return Array.from(i).map(l=>String.fromCharCode(l)).join("")}async function aE(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const s=await sE(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ui(e,t,s=!1){const a=nE();let i=a;s&&(i+="/PASSWORD_RECOVERY"),await xi(e,`${t}-code-verifier`,i);const l=await aE(a);return[l,a===l?"plain":"s256"]}const rE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function iE(e){const t=e.headers.get(xf);if(!t||!t.match(rE))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function oE(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function lE(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const cE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function hi(e){if(!cE.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Kh(){const e={};return new Proxy(e,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function dE(e,t){return new Proxy(e,{get:(s,a,i)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const l=a.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,a,i)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,a,i)}})}function Cx(e){return JSON.parse(JSON.stringify(e))}const Tr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),uE=[502,503,504];async function Ix(e){var t;if(!Q_(e))throw new vf(Tr(e),0);if(uE.includes(e.status))throw new vf(Tr(e),e.status);let s;try{s=await e.json()}catch(l){throw new Er(Tr(l),l)}let a;const i=iE(e);if(i&&i.getTime()>=fb["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new Tx(Tr(s),e.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new ns}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((l,c)=>l&&typeof c=="string",!0))throw new Tx(Tr(s),e.status,s.weak_password.reasons);throw new B_(Tr(s),e.status||500,a)}const hE=(e,t,s,a)=>{const i={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),s))};async function rt(e,t,s,a){var i;const l=Object.assign({},a==null?void 0:a.headers);l[xf]||(l[xf]=fb["2024-01-01"].name),a!=null&&a.jwt&&(l.Authorization=`Bearer ${a.jwt}`);const c=(i=a==null?void 0:a.query)!==null&&i!==void 0?i:{};a!=null&&a.redirectTo&&(c.redirect_to=a.redirectTo);const u=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",f=await fE(e,t,s+u,{headers:l,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(f):{data:Object.assign({},f),error:null}}async function fE(e,t,s,a,i,l){const c=hE(t,a,i,l);let u;try{u=await e(s,Object.assign({},c))}catch(f){throw console.error(f),new vf(Tr(f),0)}if(u.ok||await Ix(u),a!=null&&a.noResolveJson)return u;try{return await u.json()}catch(f){await Ix(f)}}function _s(e){var t;let s=null;gE(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=J_(e.expires_in)));const a=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:s,user:a},error:null}}function Ax(e){const t=_s(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Qa(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function mE(e){return{data:e,error:null}}function pE(e){const{action_link:t,email_otp:s,hashed_token:a,redirect_to:i,verification_type:l}=e,c=ud(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:t,email_otp:s,hashed_token:a,redirect_to:i,verification_type:l},f=Object.assign({},c);return{data:{properties:u,user:f},error:null}}function kx(e){return e}function gE(e){return e.access_token&&e.refresh_token&&e.expires_in}const Wh=["global","local","others"];class yE{constructor({url:t="",headers:s={},fetch:a}){this.url=t,this.headers=s,this.fetch=gb(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=Wh[0]){if(Wh.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Wh.join(", ")}`);try{return await rt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Ze(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,s={}){try{return await rt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Qa})}catch(a){if(Ze(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:s}=t,a=ud(t,["options"]),i=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(i.new_email=a==null?void 0:a.newEmail,delete i.newEmail),await rt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:pE,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(Ze(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await rt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Qa})}catch(s){if(Ze(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,a,i,l,c,u,f;try{const h={nextPage:null,lastPage:0,total:0},m=await rt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(l=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:kx});if(m.error)throw m.error;const x=await m.json(),y=(c=m.headers.get("x-total-count"))!==null&&c!==void 0?c:0,b=(f=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&f!==void 0?f:[];return b.length>0&&(b.forEach(T=>{const _=parseInt(T.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(T.split(";")[1].split("=")[1]);h[`${j}Page`]=_}),h.total=parseInt(y)),{data:Object.assign(Object.assign({},x),h),error:null}}catch(h){if(Ze(h))return{data:{users:[]},error:h};throw h}}async getUserById(t){hi(t);try{return await rt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Qa})}catch(s){if(Ze(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){hi(t);try{return await rt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Qa})}catch(a){if(Ze(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,s=!1){hi(t);try{return await rt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Qa})}catch(a){if(Ze(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){hi(t.userId);try{const{data:s,error:a}=await rt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:s,error:a}}catch(s){if(Ze(s))return{data:null,error:s};throw s}}async _deleteFactor(t){hi(t.userId),hi(t.id);try{return{data:await rt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(Ze(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,a,i,l,c,u,f;try{const h={nextPage:null,lastPage:0,total:0},m=await rt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(l=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:""},xform:kx});if(m.error)throw m.error;const x=await m.json(),y=(c=m.headers.get("x-total-count"))!==null&&c!==void 0?c:0,b=(f=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&f!==void 0?f:[];return b.length>0&&(b.forEach(T=>{const _=parseInt(T.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(T.split(";")[1].split("=")[1]);h[`${j}Page`]=_}),h.total=parseInt(y)),{data:Object.assign(Object.assign({},x),h),error:null}}catch(h){if(Ze(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(t){try{return await rt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ze(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await rt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ze(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await rt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Ze(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await rt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ze(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await rt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ze(s))return{data:null,error:s};throw s}}}function Dx(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const fi={debug:!!(globalThis&&pb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class yb extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Rx extends yb{}async function xE(e,t,s){fi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const a=new globalThis.AbortController;t>0&&setTimeout(()=>{a.abort(),fi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async i=>{if(i){fi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,i.name);try{return await s()}finally{fi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,i.name)}}else{if(t===0)throw fi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Rx(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(fi.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}})}catch(i){throw(i==null?void 0:i.name)==="AbortError"?new Rx(`Acquiring an exclusive Navigator LockManager lock "${e}" timed out waiting ${t}ms`):i}}function vE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function xb(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function bE(e){return parseInt(e,16)}function NE(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function SE(e){var t;const{chainId:s,domain:a,expirationTime:i,issuedAt:l=new Date,nonce:c,notBefore:u,requestId:f,resources:h,scheme:m,uri:x,version:y}=e;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!x)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(y!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${y}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const b=xb(e.address),T=m?`${m}://${a}`:a,_=e.statement?`${e.statement}
`:"",j=`${T} wants you to sign in with your Ethereum account:
${b}

${_}`;let E=`URI: ${x}
Version: ${y}
Chain ID: ${s}${c?`
Nonce: ${c}`:""}
Issued At: ${l.toISOString()}`;if(i&&(E+=`
Expiration Time: ${i.toISOString()}`),u&&(E+=`
Not Before: ${u.toISOString()}`),f&&(E+=`
Request ID: ${f}`),h){let k=`
Resources:`;for(const C of h){if(!C||typeof C!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${C}`);k+=`
- ${C}`}E+=k}return`${j}
${E}`}class hn extends Error{constructor({message:t,code:s,cause:a,name:i}){var l;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(l=i??(a instanceof Error?a.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=s}}class Zc extends hn{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function wE({error:e,options:t}){var s,a,i;const{publicKey:l}=t;if(!l)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new hn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((s=l.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new hn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((a=l.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new hn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((i=l.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new hn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new hn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new hn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return l.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new hn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new hn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const c=window.location.hostname;if(vb(c)){if(l.rp.id!==c)return new hn({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new hn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new hn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function TE({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new hn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new hn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(vb(a)){if(s.rpId!==a)return new hn({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new hn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class jE{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const _E=new jE;function EE(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:a}=e,i=ud(e,["challenge","user","excludeCredentials"]),l=ji(t).buffer,c=Object.assign(Object.assign({},s),{id:ji(s.id).buffer}),u=Object.assign(Object.assign({},i),{challenge:l,user:c});if(a&&a.length>0){u.excludeCredentials=new Array(a.length);for(let f=0;f<a.length;f++){const h=a[f];u.excludeCredentials[f]=Object.assign(Object.assign({},h),{id:ji(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function CE(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,a=ud(e,["challenge","allowCredentials"]),i=ji(t).buffer,l=Object.assign(Object.assign({},a),{challenge:i});if(s&&s.length>0){l.allowCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const u=s[c];l.allowCredentials[c]=Object.assign(Object.assign({},u),{id:ji(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function IE(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:Cr(new Uint8Array(e.response.attestationObject)),clientDataJSON:Cr(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function AE(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const s=e,a=e.getClientExtensionResults(),i=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Cr(new Uint8Array(i.authenticatorData)),clientDataJSON:Cr(new Uint8Array(i.clientDataJSON)),signature:Cr(new Uint8Array(i.signature)),userHandle:i.userHandle?Cr(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function vb(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Mx(){var e,t;return!!(Dn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function kE(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Zc("Browser returned unexpected credential type",t)}:{data:null,error:new Zc("Empty credential response",t)}}catch(t){return{data:null,error:wE({error:t,options:e})}}}async function DE(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Zc("Browser returned unexpected credential type",t)}:{data:null,error:new Zc("Empty credential response",t)}}catch(t){return{data:null,error:TE({error:t,options:e})}}}const RE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},ME={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ed(...e){const t=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),s=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),a={};for(const i of e)if(i)for(const l in i){const c=i[l];if(c!==void 0)if(Array.isArray(c))a[l]=c;else if(s(c))a[l]=c;else if(t(c)){const u=a[l];t(u)?a[l]=ed(u,c):a[l]=ed(c)}else a[l]=c}return a}function PE(e,t){return ed(RE,e,t||{})}function OE(e,t){return ed(ME,e,t||{})}class LE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:a,signal:i},l){var c;try{const{data:u,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!u)return{data:null,error:f};const h=i??_E.createNewAbortSignal();if(u.webauthn.type==="create"){const{user:m}=u.webauthn.credential_options.publicKey;if(!m.name){const x=a;if(x)m.name=`${m.id}:${x}`;else{const b=(await this.client.getUser()).data.user,T=((c=b==null?void 0:b.user_metadata)===null||c===void 0?void 0:c.name)||(b==null?void 0:b.email)||(b==null?void 0:b.id)||"User";m.name=`${m.id}:${T}`}}m.displayName||(m.displayName=m.name)}switch(u.webauthn.type){case"create":{const m=PE(u.webauthn.credential_options.publicKey,l==null?void 0:l.create),{data:x,error:y}=await kE({publicKey:m,signal:h});return x?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:x}},error:null}:{data:null,error:y}}case"request":{const m=OE(u.webauthn.credential_options.publicKey,l==null?void 0:l.request),{data:x,error:y}=await DE(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:m,signal:h}));return x?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:x}},error:null}:{data:null,error:y}}}}catch(u){return Ze(u)?{data:null,error:u}:{data:null,error:new Er("Unexpected error in challenge",u)}}}async _verify({challengeId:t,factorId:s,webauthn:a}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},l){if(!s)return{data:null,error:new tl("rpId is required for WebAuthn authentication")};try{if(!Mx())return{data:null,error:new Er("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:a},signal:i},{request:l});if(!c)return{data:null,error:u};const{webauthn:f}=c;return this._verify({factorId:t,challengeId:c.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:a,credential_response:f.credential_response}})}catch(c){return Ze(c)?{data:null,error:c}:{data:null,error:new Er("Unexpected error in authenticate",c)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},l){if(!s)return{data:null,error:new tl("rpId is required for WebAuthn registration")};try{if(!Mx())return{data:null,error:new Er("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this._enroll({friendlyName:t});if(!c)return await this.client.mfa.listFactors().then(m=>{var x;return(x=m.data)===null||x===void 0?void 0:x.all.find(y=>y.factor_type==="webauthn"&&y.friendly_name===t&&y.status!=="unverified")}).then(m=>m?this.client.mfa.unenroll({factorId:m==null?void 0:m.id}):void 0),{data:null,error:u};const{data:f,error:h}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:s,rpOrigins:a},signal:i},{create:l});return f?this._verify({factorId:c.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:a,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:h}}catch(c){return Ze(c)?{data:null,error:c}:{data:null,error:new Er("Unexpected error in register",c)}}}}vE();const UE={url:P_,storageKey:O_,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:L_,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Px(e,t,s){return await s()}const mi={};class nl{get jwks(){var t,s;return(s=(t=mi[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){mi[this.storageKey]=Object.assign(Object.assign({},mi[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=mi[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){mi[this.storageKey]=Object.assign(Object.assign({},mi[this.storageKey]),{cachedAt:t})}constructor(t){var s,a,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},UE),t);if(this.storageKey=l.storageKey,this.instanceID=(s=nl.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,nl.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&Dn()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new yE({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=gb(l.fetch),this.lock=l.lock||Px,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,this.lockAcquireTimeout=l.lockAcquireTimeout,l.lock?this.lock=l.lock:this.persistSession&&Dn()&&(!((a=globalThis==null?void 0:globalThis.navigator)===null||a===void 0)&&a.locks)?this.lock=xE:this.lock=Px,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new LE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:pb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Dx(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=Dx(this.memoryStorage)),Dn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c);try{await this._notifyAllSubscribers(c.data.event,c.data.session,!1)}catch(u){this._debug("#broadcastChannel","error",u)}})}l.skipAutoInitialize||this.initialize().catch(c=>{this._debug("#initialize()","error",c)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${hb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},a="none";if(Dn()&&(s=X_(window.location.href),this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce")),Dn()&&this.detectSessionInUrl&&a!=="none"){const{data:i,error:l}=await this._getSessionFromURL(s,a);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),z_(l)){const f=(t=l.details)===null||t===void 0?void 0:t.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:l}}return{error:l}}const{session:c,redirectType:u}=i;return this._debug("#_initialize()","detected session in URL",c,"redirect type",u),await this._saveSession(c),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Ze(s)?this._returnResult({error:s}):this._returnResult({error:new Er("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,a,i;try{const l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.captchaToken}},xform:_s}),{data:c,error:u}=l;if(u||!c)return this._returnResult({data:{user:null,session:null},error:u});const f=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:h,session:f},error:null})}catch(l){if(Ze(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(t){var s,a,i;try{let l;if("email"in t){const{email:m,password:x,options:y}=t;let b=null,T=null;this.flowType==="pkce"&&([b,T]=await ui(this.storage,this.storageKey)),l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:y==null?void 0:y.emailRedirectTo,body:{email:m,password:x,data:(s=y==null?void 0:y.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken},code_challenge:b,code_challenge_method:T},xform:_s})}else if("phone"in t){const{phone:m,password:x,options:y}=t;l=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:x,data:(a=y==null?void 0:y.data)!==null&&a!==void 0?a:{},channel:(i=y==null?void 0:y.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken}},xform:_s})}else throw new Mc("You must provide either an email or phone number and a password");const{data:c,error:u}=l;if(u||!c)return await kn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const f=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:h,session:f},error:null})}catch(l){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(t){try{let s;if("email"in t){const{email:l,password:c,options:u}=t;s=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:c,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:Ax})}else if("phone"in t){const{phone:l,password:c,options:u}=t;s=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:c,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:Ax})}else throw new Mc("You must provide either an email or phone number and a password");const{data:a,error:i}=s;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!a||!a.session||!a.user){const l=new di;return this._returnResult({data:{user:null,session:null},error:l})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:i})}catch(s){if(Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,a,i,l;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(i=t.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(l=t.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,a,i,l,c,u,f,h,m,x,y;let b,T;if("message"in t)b=t.message,T=t.signature;else{const{chain:_,wallet:j,statement:E,options:k}=t;let C;if(Dn())if(typeof j=="object")C=j;else{const U=window;if("ethereum"in U&&typeof U.ethereum=="object"&&"request"in U.ethereum&&typeof U.ethereum.request=="function")C=U.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=j}const A=new URL((s=k==null?void 0:k.url)!==null&&s!==void 0?s:window.location.href),M=await C.request({method:"eth_requestAccounts"}).then(U=>U).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const I=xb(M[0]);let P=(a=k==null?void 0:k.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!P){const U=await C.request({method:"eth_chainId"});P=bE(U)}const D={domain:A.host,address:I,statement:E,uri:A.href,version:"1",chainId:P,nonce:(i=k==null?void 0:k.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(c=(l=k==null?void 0:k.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(u=k==null?void 0:k.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(f=k==null?void 0:k.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(h=k==null?void 0:k.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(m=k==null?void 0:k.signInWithEthereum)===null||m===void 0?void 0:m.resources};b=SE(D),T=await C.request({method:"personal_sign",params:[NE(b),I]})}try{const{data:_,error:j}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:b,signature:T},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(y=t.options)===null||y===void 0?void 0:y.captchaToken}}:null),xform:_s});if(j)throw j;if(!_||!_.session||!_.user){const E=new di;return this._returnResult({data:{user:null,session:null},error:E})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:j})}catch(_){if(Ze(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithSolana(t){var s,a,i,l,c,u,f,h,m,x,y,b;let T,_;if("message"in t)T=t.message,_=t.signature;else{const{chain:j,wallet:E,statement:k,options:C}=t;let A;if(Dn())if(typeof E=="object")A=E;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))A=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!(C!=null&&C.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");A=E}const M=new URL((s=C==null?void 0:C.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in A&&A.signIn){const I=await A.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},C==null?void 0:C.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),k?{statement:k}:null));let P;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")P=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)P=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)T=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),_=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in A)||typeof A.signMessage!="function"||!("publicKey"in A)||typeof A!="object"||!A.publicKey||!("toBase58"in A.publicKey)||typeof A.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");T=[`${M.host} wants you to sign in with your Solana account:`,A.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(i=(a=C==null?void 0:C.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((l=C==null?void 0:C.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${C.signInWithSolana.notBefore}`]:[],...!((c=C==null?void 0:C.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${C.signInWithSolana.expirationTime}`]:[],...!((u=C==null?void 0:C.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${C.signInWithSolana.chainId}`]:[],...!((f=C==null?void 0:C.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${C.signInWithSolana.nonce}`]:[],...!((h=C==null?void 0:C.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${C.signInWithSolana.requestId}`]:[],...!((x=(m=C==null?void 0:C.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||x===void 0)&&x.length?["Resources",...C.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const I=await A.signMessage(new TextEncoder().encode(T),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=I}}try{const{data:j,error:E}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:T,signature:Cr(_)},!((y=t.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:_s});if(E)throw E;if(!j||!j.session||!j.user){const k=new di;return this._returnResult({data:{user:null,session:null},error:k})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:E})}catch(j){if(Ze(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const s=await wr(this.storage,`${this.storageKey}-code-verifier`),[a,i]=(s??"").split("/");try{if(!a&&this.flowType==="pkce")throw new $_;const{data:l,error:c}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:_s});if(await kn(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!l||!l.session||!l.user){const u=new di;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:i??null}),error:c})}catch(l){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(t){try{const{options:s,provider:a,token:i,access_token:l,nonce:c}=t,u=await rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:i,access_token:l,nonce:c,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:_s}),{data:f,error:h}=u;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!f||!f.session||!f.user){const m=new di;return this._returnResult({data:{user:null,session:null},error:m})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:h})}catch(s){if(Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,a,i,l,c;try{if("email"in t){const{email:u,options:f}=t;let h=null,m=null;this.flowType==="pkce"&&([h,m]=await ui(this.storage,this.storageKey));const{error:x}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},create_user:(a=f==null?void 0:f.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:m},redirectTo:f==null?void 0:f.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:x})}if("phone"in t){const{phone:u,options:f}=t,{data:h,error:m}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(i=f==null?void 0:f.data)!==null&&i!==void 0?i:{},create_user:(l=f==null?void 0:f.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},channel:(c=f==null?void 0:f.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:m})}throw new Mc("You must provide either an email or phone number.")}catch(u){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(t){var s,a;try{let i,l;"options"in t&&(i=(s=t.options)===null||s===void 0?void 0:s.redirectTo,l=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:c,error:u}=await rt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:l}}),redirectTo:i,xform:_s});if(u)throw u;if(!c)throw new Error("An error occurred on token verification.");const f=c.session,h=c.user;return f!=null&&f.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:h,session:f},error:null})}catch(i){if(Ze(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(t){var s,a,i,l,c;try{let u=null,f=null;this.flowType==="pkce"&&([u,f]=await ui(this.storage,this.storageKey));const h=await rt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((i=t==null?void 0:t.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:f}),headers:this.headers,xform:mE});return!((l=h.data)===null||l===void 0)&&l.url&&Dn()&&!(!((c=t.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(u){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;if(a)throw a;if(!s)throw new ns;const{error:i}=await rt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(t){if(Ze(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:a,type:i,options:l}=t,{error:c}=await rt(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in t){const{phone:a,type:i,options:l}=t,{data:c,error:u}=await rt(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u})}throw new Mc("You must provide either an email or phone number and a type")}catch(s){if(Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await wr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<Hh:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const c=await wr(this.userStorage,this.storageKey+"-user");c!=null&&c.user?t.user=c.user:t.user=Kh()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};t.user=dE(t.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:i,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Qa}):await this._useSession(async s=>{var a,i,l;const{data:c,error:u}=s;if(u)throw u;return!(!((a=c.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ns}:await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(i=c.session)===null||i===void 0?void 0:i.access_token)!==null&&l!==void 0?l:void 0,xform:Qa})})}catch(s){if(Ze(s))return qh(s)&&(await this._removeSession(),await kn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async a=>{const{data:i,error:l}=a;if(l)throw l;if(!i.session)throw new ns;const c=i.session;let u=null,f=null;this.flowType==="pkce"&&t.email!=null&&([u,f]=await ui(this.storage,this.storageKey));const{data:h,error:m}=await rt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:u,code_challenge_method:f}),jwt:c.access_token,xform:Qa});if(m)throw m;return c.user=h.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(a){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new ns;const s=Date.now()/1e3;let a=s,i=!0,l=null;const{payload:c}=Oc(t.access_token);if(c.exp&&(a=c.exp,i=a<=s),i){const{data:u,error:f}=await this._callRefreshToken(t.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!u)return{data:{user:null,session:null},error:null};l=u}else{const{data:u,error:f}=await this._getUser(t.access_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});l={access_token:t.access_token,refresh_token:t.refresh_token,user:u.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(s){if(Ze(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var a;if(!t){const{data:c,error:u}=s;if(u)throw u;t=(a=c.session)!==null&&a!==void 0?a:void 0}if(!(t!=null&&t.refresh_token))throw new ns;const{data:i,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!Dn())throw new Pc("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Pc(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new wx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Pc("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new wx("No code detected.");const{data:k,error:C}=await this._exchangeCodeForSession(t.code);if(C)throw C;const A=new URL(window.location.href);return A.searchParams.delete("code"),window.history.replaceState(window.history.state,"",A.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:i,access_token:l,refresh_token:c,expires_in:u,expires_at:f,token_type:h}=t;if(!l||!u||!c||!h)throw new Pc("No session defined in URL");const m=Math.round(Date.now()/1e3),x=parseInt(u);let y=m+x;f&&(y=parseInt(f));const b=y-m;b*1e3<=yi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${x}s`);const T=y-x;m-T>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",T,y,m):m-T<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",T,y,m);const{data:_,error:j}=await this._getUser(l);if(j)throw j;const E={provider_token:a,provider_refresh_token:i,access_token:l,expires_in:x,expires_at:y,refresh_token:c,token_type:h,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:E,redirectType:t.type},error:null})}catch(a){if(Ze(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await wr(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:i,error:l}=s;if(l&&!qh(l))return this._returnResult({error:l});const c=(a=i.session)===null||a===void 0?void 0:a.access_token;if(c){const{error:u}=await this.admin.signOut(c,t);if(u&&!(G_(u)&&(u.status===404||u.status===401||u.status===403)||qh(u)))return this._returnResult({error:u})}return t!=="others"&&(await this._removeSession(),await kn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=Y_(),a={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async s=>{var a,i;try{const{data:{session:l},error:c}=s;if(c)throw c;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",t,"session",l)}catch(l){await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",l),console.error(l)}})}async resetPasswordForEmail(t,s={}){let a=null,i=null;this.flowType==="pkce"&&([a,i]=await ui(this.storage,this.storageKey,!0));try{return await rt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:i,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(l){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var t;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:a,error:i}=await this._useSession(async l=>{var c,u,f,h,m;const{data:x,error:y}=l;if(y)throw y;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(c=t.options)===null||c===void 0?void 0:c.redirectTo,scopes:(u=t.options)===null||u===void 0?void 0:u.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await rt(this.fetch,"GET",b,{headers:this.headers,jwt:(m=(h=x.session)===null||h===void 0?void 0:h.access_token)!==null&&m!==void 0?m:void 0})});if(i)throw i;return Dn()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),this._returnResult({data:{provider:t.provider,url:a==null?void 0:a.url},error:null})}catch(a){if(Ze(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var a;try{const{error:i,data:{session:l}}=s;if(i)throw i;const{options:c,provider:u,token:f,access_token:h,nonce:m}=t,x=await rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=l==null?void 0:l.access_token)!==null&&a!==void 0?a:void 0,body:{provider:u,id_token:f,access_token:h,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:_s}),{data:y,error:b}=x;return b?this._returnResult({data:{user:null,session:null},error:b}):!y||!y.session||!y.user?this._returnResult({data:{user:null,session:null},error:new di}):(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("USER_UPDATED",y.session)),this._returnResult({data:y,error:b}))}catch(i){if(await kn(this.storage,`${this.storageKey}-code-verifier`),Ze(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var a,i;const{data:l,error:c}=s;if(c)throw c;return await rt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(i=(a=l.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0})})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await eE(async i=>(i>0&&await Z_(200*Math.pow(2,i-1)),this._debug(s,"refreshing attempt",i),await rt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:_s})),(i,l)=>{const c=200*Math.pow(2,i);return l&&Vh(l)&&Date.now()+c-a<yi})}catch(a){if(this._debug(s,"error",a),Ze(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",a),Dn()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,s;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const i=await wr(this.storage,this.storageKey);if(i&&this.userStorage){let c=await wr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:i.user},await xi(this.userStorage,this.storageKey+"-user",c)),i.user=(t=c==null?void 0:c.user)!==null&&t!==void 0?t:Kh()}else if(i&&!i.user&&!i.user){const c=await wr(this.storage,this.storageKey+"-user");c&&(c!=null&&c.user)?(i.user=c.user,await kn(this.storage,this.storageKey+"-user"),await xi(this.storage,this.storageKey,i)):i.user=Kh()}if(this._debug(a,"session from storage",i),!this._isValidSession(i)){this._debug(a,"session is not valid"),i!==null&&await this._removeSession();return}const l=((s=i.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Hh;if(this._debug(a,`session has${l?"":" not"} expired with margin of ${Hh}s`),l){if(this.autoRefreshToken&&i.refresh_token){const{error:c}=await this._callRefreshToken(i.refresh_token);c&&(console.error(c),Vh(c)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:u}=await this._getUser(i.access_token);!u&&(c!=null&&c.user)?(i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(a,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(a,"error",i),console.error(i);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var s,a;if(!t)throw new ns;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new md;const{data:l,error:c}=await this._refreshAccessToken(t);if(c)throw c;if(!l.session)throw new ns;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const u={data:l.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(l){if(this._debug(i,"error",l),Ze(l)){const c={data:null,error:l};return Vh(l)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(c),c}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(l),l}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(t,s,a=!0){const i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:s});const l=[],c=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(t,s)}catch(f){l.push(f)}});if(await Promise.all(c),l.length>0){for(let u=0;u<l.length;u+=1)console.error(l[u]);throw l[0]}}finally{this._debug(i,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await kn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),a=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&s.user&&await xi(this.userStorage,this.storageKey+"-user",{user:s.user});const i=Object.assign({},s);delete i.user;const l=Cx(i);await xi(this.storage,this.storageKey,l)}else{const i=Cx(s);await xi(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await kn(this.storage,this.storageKey),await kn(this.storage,this.storageKey+"-code-verifier"),await kn(this.storage,this.storageKey+"-user"),this.userStorage&&await kn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Dn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),yi);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const s=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const s=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,s&&clearTimeout(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((a.expires_at*1e3-t)/yi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${yi}ms, refresh threshold is ${yf} ticks`),i<=yf&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof yb)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Dn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,a){const i=[`provider=${encodeURIComponent(s)}`];if(a!=null&&a.redirectTo&&i.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&i.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[l,c]=await ui(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(c)}`});i.push(u.toString())}if(a!=null&&a.queryParams){const l=new URLSearchParams(a.queryParams);i.push(l.toString())}return a!=null&&a.skipBrowserRedirect&&i.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var a;const{data:i,error:l}=s;return l?this._returnResult({data:null,error:l}):await rt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var a,i;const{data:l,error:c}=s;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:f,error:h}=await rt(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(a=l==null?void 0:l.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(t.factorType==="totp"&&f.type==="totp"&&(!((i=f==null?void 0:f.totp)===null||i===void 0)&&i.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:i,error:l}=s;if(l)return this._returnResult({data:null,error:l});const c=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?IE(t.webauthn.credential_response):AE(t.webauthn.credential_response)})}:{code:t.code}),{data:u,error:f}=await rt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:c,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:f}))})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:i,error:l}=s;if(l)return this._returnResult({data:null,error:l});const c=await rt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});if(c.error)return c;const{data:u}=c;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:EE(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:CE(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:a}=await this.getUser();if(a)return{data:null,error:a};const i={all:[],phone:[],totp:[],webauthn:[]};for(const l of(t=s==null?void 0:s.factors)!==null&&t!==void 0?t:[])i.all.push(l),l.status==="verified"&&i[l.factor_type].push(l);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(t){var s,a,i,l;if(t)try{const{payload:b}=Oc(t);let T=null;b.aal&&(T=b.aal);let _=T;const{data:{user:j},error:E}=await this.getUser(t);if(E)return this._returnResult({data:null,error:E});((a=(s=j==null?void 0:j.factors)===null||s===void 0?void 0:s.filter(A=>A.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(_="aal2");const C=b.amr||[];return{data:{currentLevel:T,nextLevel:_,currentAuthenticationMethods:C},error:null}}catch(b){if(Ze(b))return this._returnResult({data:null,error:b});throw b}const{data:{session:c},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=Oc(c.access_token);let h=null;f.aal&&(h=f.aal);let m=h;((l=(i=c.user.factors)===null||i===void 0?void 0:i.filter(b=>b.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(m="aal2");const y=f.amr||[];return{data:{currentLevel:h,nextLevel:m,currentAuthenticationMethods:y},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:a},error:i}=s;return i?this._returnResult({data:null,error:i}):a?await rt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new ns})})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:i},error:l}=a;if(l)return this._returnResult({data:null,error:l});if(!i)return this._returnResult({data:null,error:new ns});const c=await rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Dn()&&!(s!=null&&s.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(a){if(Ze(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:i},error:l}=a;if(l)return this._returnResult({data:null,error:l});if(!i)return this._returnResult({data:null,error:new ns});const c=await rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Dn()&&!(s!=null&&s.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(a){if(Ze(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;return a?this._returnResult({data:null,error:a}):s?await rt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new ns})})}catch(t){if(Ze(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:a},error:i}=s;return i?this._returnResult({data:null,error:i}):a?(await rt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ns})})}catch(s){if(Ze(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let a=s.keys.find(u=>u.kid===t);if(a)return a;const i=Date.now();if(a=this.jwks.keys.find(u=>u.kid===t),a&&this.jwks_cached_at+F_>i)return a;const{data:l,error:c}=await rt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=i,a=l.keys.find(u=>u.kid===t),!a)?null:a}async getClaims(t,s={}){try{let a=t;if(!a){const{data:b,error:T}=await this.getSession();if(T||!b.session)return this._returnResult({data:null,error:T});a=b.session.access_token}const{header:i,payload:l,signature:c,raw:{header:u,payload:f}}=Oc(a);s!=null&&s.allowExpired||oE(l.exp);const h=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!h){const{error:b}=await this.getUser(a);if(b)throw b;return{data:{claims:l,header:i,signature:c},error:null}}const m=lE(i.alg),x=await crypto.subtle.importKey("jwk",h,m,!0,["verify"]);if(!await crypto.subtle.verify(m,x,c,W_(`${u}.${f}`)))throw new bf("Invalid JWT signature");return{data:{claims:l,header:i,signature:c},error:null}}catch(a){if(Ze(a))return this._returnResult({data:null,error:a});throw a}}}nl.nextInstanceID={};const FE=nl,BE="2.97.0";let zo="";typeof Deno<"u"?zo="deno":typeof document<"u"?zo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?zo="react-native":zo="node";const GE={"X-Client-Info":`supabase-js-${zo}/${BE}`},zE={headers:GE},$E={schema:"public"},HE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},qE={};function sl(e){"@babel/helpers - typeof";return sl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sl(e)}function VE(e,t){if(sl(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(sl(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KE(e){var t=VE(e,"string");return sl(t)=="symbol"?t:t+""}function WE(e,t,s){return(t=KE(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ox(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,a)}return s}function sn(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Ox(Object(s),!0).forEach(function(a){WE(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ox(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}const JE=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),YE=()=>Headers,XE=(e,t,s)=>{const a=JE(s),i=YE();return async(l,c)=>{var u;const f=(u=await t())!==null&&u!==void 0?u:e;let h=new i(c==null?void 0:c.headers);return h.has("apikey")||h.set("apikey",e),h.has("Authorization")||h.set("Authorization",`Bearer ${f}`),a(l,sn(sn({},c),{},{headers:h}))}};function QE(e){return e.endsWith("/")?e:e+"/"}function ZE(e,t){var s,a;const{db:i,auth:l,realtime:c,global:u}=e,{db:f,auth:h,realtime:m,global:x}=t,y={db:sn(sn({},f),i),auth:sn(sn({},h),l),realtime:sn(sn({},m),c),storage:{},global:sn(sn(sn({},x),u),{},{headers:sn(sn({},(s=x==null?void 0:x.headers)!==null&&s!==void 0?s:{}),(a=u==null?void 0:u.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return e.accessToken?y.accessToken=e.accessToken:delete y.accessToken,y}function eC(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(QE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var tC=class extends FE{constructor(e){super(e)}},nC=class{constructor(e,t,s){var a,i;this.supabaseUrl=e,this.supabaseKey=t;const l=eC(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:$E,realtime:qE,auth:sn(sn({},HE),{},{storageKey:c}),global:zE},f=ZE(s??{},u);if(this.storageKey=(a=f.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,x)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(x)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=f.auth)!==null&&h!==void 0?h:{},this.headers,f.global.fetch)}this.fetch=XE(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(sn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new Gj(new URL("rest/v1",l).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch,timeout:f.db.timeout,urlLengthLimit:f.db.urlLengthLimit}),this.storage=new M_(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new Rj(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,s;if(e.accessToken)return await e.accessToken();const{data:a}=await e.auth.getSession();return(t=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:i,storageKey:l,flowType:c,lock:u,debug:f,throwOnError:h},m,x){const y={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tC({url:this.authUrl.href,headers:sn(sn({},y),m),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:i,flowType:c,lock:u,debug:f,throwOnError:h,fetch:x,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new a_(this.realtimeUrl.href,sn(sn({},e),{},{params:sn(sn({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const sC=(e,t,s)=>new nC(e,t,s);function aC(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const s=t.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}aC()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const rC="https://kxujxjcuyfbvmzahyzcv.supabase.co",iC="sb_publishable_ufzODkevI8XjDtRhGkgo7Q_zN6QKORd",pi=sC(rC,iC,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}});function UO(e,t){return console.error(`[Supabase Error - ${t}]`,e),null}function FO(){return crypto.randomUUID()}function Wa({table:e,localData:t,setLocalData:s,enabled:a=!0}){const i=S.useRef(null),l=S.useRef(!1),c=S.useCallback(async()=>{if(!(!a||l.current))try{console.log(`[${e}] Loading initial data from Supabase...`);const{data:f,error:h}=await pi.from(e).select("*");if(h){console.error(`[${e}] Error loading data:`,h);return}if(f&&f.length>0){console.log(`[${e}] Loaded ${f.length} records from Supabase`);const m=e==="sites"?f.map(x=>({...x,zones:x.zones||[]})):f;s(m)}else console.log(`[${e}] No data in Supabase, keeping local data`);l.current=!0}catch(f){console.error(`[${e}] Exception loading data:`,f)}},[e,a,s]);return S.useEffect(()=>{if(!a)return;c(),console.log(`[${e}] Setting up real-time subscription...`);const f=pi.channel(`${e}_changes`).on("postgres_changes",{event:"*",schema:"public",table:e},h=>{console.log(`[${e}] Real-time change:`,h);const m=x=>e==="sites"&&x?{...x,zones:x.zones||[]}:x;switch(h.eventType){case"INSERT":s(x=>x.some(b=>b.id===h.new.id)?x:[...x,m(h.new)]);break;case"UPDATE":s(x=>x.map(y=>y.id===h.new.id?m(h.new):y));break;case"DELETE":s(x=>x.filter(y=>y.id!==h.old.id));break}}).subscribe(h=>{console.log(`[${e}] Subscription status:`,h)});return i.current=f,()=>{console.log(`[${e}] Cleaning up real-time subscription...`),i.current&&(pi.removeChannel(i.current),i.current=null)}},[e,a,c,s]),{syncToSupabase:S.useCallback(async(f,h)=>{if(!a)return{success:!0};try{switch(f){case"insert":const{error:m}=await pi.from(e).insert([h]);if(m)throw m;break;case"update":const x=h,{error:y}=await pi.from(e).update(x).eq("id",x.id);if(y)throw y;break;case"delete":const b=h,{error:T}=await pi.from(e).delete().eq("id",b);if(T)throw T;break}return console.log(`[${e}] Sync ${f} successful`),{success:!0}}catch(m){return console.error(`[${e}] Sync ${f} failed:`,m),{success:!1,error:m}}},[e,a]),initialLoadDone:l.current}}const Lx=[{id:"ENVIRONMENTAL",name:"Environmental",isDefault:!0},{id:"EQUIPMENT_FAILURE",name:"Equipment Failure",isDefault:!0},{id:"PEST_DISEASE",name:"Pest/Disease",isDefault:!0},{id:"SECURITY",name:"Security",isDefault:!0},{id:"OTHER",name:"Other",isDefault:!0}],Ux=[{id:"LOW",name:"Low",isDefault:!0},{id:"MEDIUM",name:"Medium",isDefault:!0},{id:"HIGH",name:"High",isDefault:!0},{id:"CRITICAL",name:"Critical",isDefault:!0}],Fx=[{id:"SITE_MANAGER",name:"Site Manager (Admin)",permissions:[_e.DASHBOARD_VIEW,_e.OPERATIONS_VIEW,_e.INVENTORY_VIEW,_e.STAKEHOLDERS_VIEW,_e.MONITORING_VIEW,_e.REPORTS_VIEW,_e.SETTINGS_VIEW,_e.USERS_VIEW,_e.ROLES_VIEW,_e.SITES_VIEW,_e.MODULES_VIEW,_e.SITES_MANAGE,_e.MODULES_MANAGE,_e.EMPLOYEES_MANAGE,_e.FARMERS_MANAGE,_e.INCIDENTS_MANAGE,_e.SETTINGS_GENERAL_MANAGE,_e.ROLES_MANAGE,_e.USERS_INVITE,_e.PAYMENTS_MANAGE,_e.CREDITS_MANAGE,_e.PAYROLL_MANAGE,_e.INVENTORY_MANAGE_ON_SITE,_e.EXPORTS_MANAGE,_e.GALLERY_VIEW,_e.GALLERY_MANAGE],isDefault:!0},{id:"OPERATIONS_LEAD",name:"Directeur des Oprations (Admin)",permissions:[_e.DASHBOARD_VIEW,_e.OPERATIONS_VIEW,_e.INVENTORY_VIEW,_e.STAKEHOLDERS_VIEW,_e.MONITORING_VIEW,_e.REPORTS_VIEW,_e.SETTINGS_VIEW,_e.USERS_VIEW,_e.ROLES_VIEW,_e.SITES_VIEW,_e.MODULES_VIEW,_e.SITES_MANAGE,_e.MODULES_MANAGE,_e.EMPLOYEES_MANAGE,_e.FARMERS_MANAGE,_e.INCIDENTS_MANAGE,_e.SETTINGS_GENERAL_MANAGE,_e.ROLES_MANAGE,_e.USERS_INVITE,_e.PAYMENTS_MANAGE,_e.CREDITS_MANAGE,_e.PAYROLL_MANAGE,_e.INVENTORY_MANAGE_ON_SITE,_e.EXPORTS_MANAGE,_e.GALLERY_VIEW,_e.GALLERY_MANAGE],isDefault:!0},{id:"ACCOUNTANT",name:"Accountant",permissions:[_e.DASHBOARD_VIEW,_e.STAKEHOLDERS_VIEW,_e.PAYMENTS_VIEW,_e.PAYMENTS_MANAGE,_e.CREDITS_VIEW,_e.CREDITS_MANAGE,_e.PAYROLL_VIEW,_e.PAYROLL_MANAGE,_e.REPORTS_VIEW],isDefault:!0}],Bx=[{id:"user-admin",email:"admin@seafarm.com",password:"password",firstName:"Admin",lastName:"User",roleId:"OPERATIONS_LEAD"}],Gx=[{id:"ct-1",name:"Rice",hasQuantity:!0,unit:"Kg",hasUnitPrice:!0,isDirectAmount:!1},{id:"ct-2",name:"Cash Advance",hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0},{id:"ct-3",name:"Cutting Service Fee",hasQuantity:!1,unit:"",hasUnitPrice:!1,isDirectAmount:!0}];function Lt(e,t){try{const s=localStorage.getItem(e);if(s===null)return t;const a=JSON.parse(s);return a??t}catch(s){return console.error(`Error loading ${e} from localStorage`,s),t}}const bb=S.createContext(void 0),oC=({children:e})=>{const[t,s]=S.useState(()=>Lt("sites",[])),[a,i]=S.useState(()=>Lt("employees",[])),[l,c]=S.useState(()=>Lt("farmers",[])),[u,f]=S.useState(()=>Lt("serviceProviders",[])),[h,m]=S.useState(()=>Lt("creditTypes",Gx)),[x,y]=S.useState(()=>Lt("farmerCredits",[])),[b,T]=S.useState(()=>Lt("repayments",[])),[_,j]=S.useState(()=>Lt("monthlyPayments",[])),[E,k]=S.useState(()=>Lt("seaweedTypes",[])),[C,A]=S.useState(()=>Lt("modules",[])),[M,I]=S.useState(()=>Lt("cultivationCycles",[])),[P,D]=S.useState(()=>Lt("stockMovements",[])),[U,O]=S.useState(()=>Lt("pressingSlips",[])),[F,q]=S.useState(()=>Lt("pressedStockMovements",[])),[z,Y]=S.useState(()=>Lt("exportDocuments",[])),[J,G]=S.useState(()=>Lt("siteTransfers",[])),[B,Q]=S.useState(()=>Lt("cuttingOperations",[])),[W,ae]=S.useState(()=>Lt("farmerDeliveries",[])),[$,ie]=S.useState(()=>Lt("incidents",[])),[ue,Ne]=S.useState(()=>Lt("incidentTypes",Lx)),[le,ne]=S.useState(()=>Lt("incidentSeverities",Ux)),[je,fe]=S.useState(()=>Lt("roles",Fx)),[Z,ee]=S.useState(()=>Lt("periodicTests",[])),[xe,Oe]=S.useState(()=>Lt("pestObservations",[])),[De,Re]=S.useState(()=>Lt("users",Bx)),[Ve,ze]=S.useState(()=>Lt("invitations",[])),[Se,Le]=S.useState(()=>Lt("messageLogs",[])),[be,ye]=S.useState(()=>Lt("galleryPhotos",[])),Ue=S.useRef(!1);Wa({table:"sites",localData:t,setLocalData:s}),Wa({table:"employees",localData:a,setLocalData:i}),Wa({table:"farmers",localData:l,setLocalData:c}),Wa({table:"service_providers",localData:u,setLocalData:f}),Wa({table:"credit_types",localData:h,setLocalData:m}),Wa({table:"seaweed_types",localData:E,setLocalData:k}),Wa({table:"modules",localData:C,setLocalData:A}),Wa({table:"cultivation_cycles",localData:M,setLocalData:I}),S.useEffect(()=>{localStorage.setItem("sites",JSON.stringify(t))},[t]),S.useEffect(()=>{localStorage.setItem("employees",JSON.stringify(a))},[a]),S.useEffect(()=>{localStorage.setItem("farmers",JSON.stringify(l))},[l]),S.useEffect(()=>{localStorage.setItem("serviceProviders",JSON.stringify(u))},[u]),S.useEffect(()=>{localStorage.setItem("creditTypes",JSON.stringify(h))},[h]),S.useEffect(()=>{localStorage.setItem("farmerCredits",JSON.stringify(x))},[x]),S.useEffect(()=>{localStorage.setItem("repayments",JSON.stringify(b))},[b]),S.useEffect(()=>{localStorage.setItem("monthlyPayments",JSON.stringify(_))},[_]),S.useEffect(()=>{localStorage.setItem("seaweedTypes",JSON.stringify(E))},[E]),S.useEffect(()=>{localStorage.setItem("modules",JSON.stringify(C))},[C]),S.useEffect(()=>{localStorage.setItem("cultivationCycles",JSON.stringify(M))},[M]),S.useEffect(()=>{localStorage.setItem("stockMovements",JSON.stringify(P))},[P]),S.useEffect(()=>{localStorage.setItem("pressingSlips",JSON.stringify(U))},[U]),S.useEffect(()=>{localStorage.setItem("pressedStockMovements",JSON.stringify(F))},[F]),S.useEffect(()=>{localStorage.setItem("exportDocuments",JSON.stringify(z))},[z]),S.useEffect(()=>{localStorage.setItem("siteTransfers",JSON.stringify(J))},[J]),S.useEffect(()=>{localStorage.setItem("cuttingOperations",JSON.stringify(B))},[B]),S.useEffect(()=>{localStorage.setItem("farmerDeliveries",JSON.stringify(W))},[W]),S.useEffect(()=>{localStorage.setItem("incidents",JSON.stringify($))},[$]),S.useEffect(()=>{localStorage.setItem("incidentTypes",JSON.stringify(ue))},[ue]),S.useEffect(()=>{localStorage.setItem("incidentSeverities",JSON.stringify(le))},[le]),S.useEffect(()=>{localStorage.setItem("roles",JSON.stringify(je))},[je]),S.useEffect(()=>{localStorage.setItem("periodicTests",JSON.stringify(Z))},[Z]),S.useEffect(()=>{localStorage.setItem("pestObservations",JSON.stringify(xe))},[xe]),S.useEffect(()=>{localStorage.setItem("users",JSON.stringify(De))},[De]),S.useEffect(()=>{localStorage.setItem("invitations",JSON.stringify(Ve))},[Ve]),S.useEffect(()=>{localStorage.setItem("messageLogs",JSON.stringify(Se))},[Se]),S.useEffect(()=>{localStorage.setItem("galleryPhotos",JSON.stringify(be))},[be]),S.useEffect(()=>{if(Ue.current)return;Ue.current=!0;const H="ps-req-002";if(!U.some(X=>X.id===H)){let X="seaweed-type-1";if(!E.find(pt=>pt.id===X)){const pt={id:X,name:"Spinosum (Type 1)",scientificName:"Eucheuma denticulatum",description:"Requested Seaweed Type",wetPrice:400,dryPrice:1800,priceHistory:[]};k(dt=>[...dt,pt])}const me={id:`psm-init-${H}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.BULK_IN_FROM_SITE,designation:"Initial Bulk Stock (Seed)",inKg:1e3,inBales:20},Me={id:H,slipNo:"PRESS-REQ-TODAY",date:new Date().toISOString().split("T")[0],sourceSiteId:"pressing-warehouse",seaweedTypeId:X,consumedWeightKg:500,consumedBags:8,producedWeightKg:150,producedBalesCount:15},Pe={id:`psm-cons-${H}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${Me.slipNo}`,outKg:500,outBales:8,relatedId:H},Qe={id:`psm-prod-${H}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${Me.slipNo}`,inKg:150,inBales:15,relatedId:H};q(pt=>[...pt,me,Pe,Qe]),O(pt=>[...pt,Me])}},[U,E]);const et=H=>{const X={...H,id:crypto.randomUUID()};s(V=>[...V,X]),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.addSite(X)).catch(V=>console.error("[addSite] Supabase sync failed:",V))},At=H=>{s(X=>X.map(V=>V.id===H.id?H:V)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.updateSite(H)).catch(X=>console.error("[updateSite] Supabase sync failed:",X))},ut=H=>{s(X=>X.filter(V=>V.id!==H)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.deleteSite(H)).catch(X=>console.error("[deleteSite] Supabase sync failed:",X))},Ut=H=>l.filter(X=>X.siteId===H),Ct=H=>{const X={...H,id:crypto.randomUUID(),status:Wf.ACTIVE,hireDate:H.hireDate||new Date().toISOString().split("T")[0]};i(V=>[...V,X]),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.addEmployee(X)).catch(V=>console.error("[addEmployee] Supabase sync failed:",V))},vt=H=>{i(X=>X.map(V=>V.id===H.id?H:V)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.updateEmployee(H)).catch(X=>console.error("[updateEmployee] Supabase sync failed:",X))},Yt=H=>{i(X=>X.filter(V=>V.id!==H)),s(X=>X.map(V=>V.managerId===H?{...V,managerId:void 0}:V)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.deleteEmployee(H)).catch(X=>console.error("[deleteEmployee] Supabase sync failed:",X))},Ps=H=>{const X=new Set(H);i(V=>V.filter(me=>!X.has(me.id))),s(V=>V.map(me=>me.managerId&&X.has(me.managerId)?{...me,managerId:void 0}:me)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.deleteMultipleEmployees(H)).catch(V=>console.error("[deleteMultipleEmployees] Supabase sync failed:",V))},Vs=(H,X)=>{const V=new Set(H);i(me=>me.map(Me=>V.has(Me.id)?{...Me,siteId:X}:Me))},kr=H=>{const X={...H,id:crypto.randomUUID(),status:H.status||Hs.ACTIVE,joinDate:H.joinDate||new Date().toISOString().split("T")[0]};c(V=>[...V,X]),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.addFarmer(X)).catch(V=>console.error("[addFarmer] Supabase sync failed:",V))},Be=H=>{c(X=>X.map(V=>V.id===H.id?H:V)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.updateFarmer(H)).catch(X=>console.error("[updateFarmer] Supabase sync failed:",X))},Je=H=>{c(X=>X.filter(V=>V.id!==H)),y(X=>X.filter(V=>V.farmerId!==H)),T(X=>X.filter(V=>V.farmerId!==H)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.deleteFarmer(H)).catch(X=>console.error("[deleteFarmer] Supabase sync failed:",X))},$e=H=>{const X=new Set(H);c(V=>V.filter(me=>!X.has(me.id))),y(V=>V.filter(me=>!X.has(me.farmerId))),T(V=>V.filter(me=>!X.has(me.farmerId))),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.deleteMultipleFarmers(H)).catch(V=>console.error("[deleteMultipleFarmers] Supabase sync failed:",V))},wt=(H,X)=>{const V=new Set(H);c(me=>me.map(Me=>V.has(Me.id)?{...Me,siteId:X}:Me))},it=H=>{const X={...H,id:`sp-${Date.now()}`,status:Jf.ACTIVE,joinDate:H.joinDate||new Date().toISOString().split("T")[0]};f(V=>[...V,X])},kt=H=>f(X=>X.map(V=>V.id===H.id?H:V)),Tn=H=>f(X=>X.filter(V=>V.id!==H)),jn=H=>m(X=>[...X,{...H,id:`ct-${Date.now()}`}]),pn=H=>m(X=>X.map(V=>V.id===H.id?H:V)),Os=H=>{m(X=>X.filter(V=>V.id!==H)),y(X=>X.filter(V=>V.creditTypeId!==H))},Xt=H=>y(X=>[...X,{...H,id:`fc-${Date.now()}`}]),cs=H=>{const X=H.map(V=>({...V,id:`fc-${Date.now()}-${Math.random()}`}));y(V=>[...V,...X])},Na=H=>T(X=>[...X,{...H,id:`rep-${Date.now()}`}]),Ls=H=>{const X=H.map(V=>({...V,id:`rep-${Date.now()}-${Math.random()}`}));T(V=>[...V,...X])},wd=H=>{const X={...H,id:`pay-${Date.now()}`};j(V=>[...V,X])},dl=H=>{const X=H.map(V=>({...V,id:`pay-${Date.now()}-${Math.random()}`}));j(V=>[...V,...X])},Fi=H=>j(X=>X.map(V=>V.id===H.id?H:V)),tr=H=>j(X=>X.filter(V=>V.id!==H)),Td=H=>{const X={...H,id:`st-${Date.now()}`,priceHistory:[{date:new Date().toISOString().split("T")[0],wetPrice:H.wetPrice,dryPrice:H.dryPrice}]};k(V=>[...V,X])},ul=H=>k(X=>X.map(V=>V.id===H.id?H:V)),hl=H=>k(X=>X.filter(V=>V.id!==H)),fl=(H,X)=>{k(V=>V.map(me=>me.id===H?{...me,wetPrice:X.wetPrice,dryPrice:X.dryPrice,priceHistory:[...me.priceHistory,X]}:me))},Bi=H=>{const X={...H,id:crypto.randomUUID(),statusHistory:[{status:Ye.CREATED,date:new Date().toISOString()},{status:Ye.FREE,date:new Date().toISOString(),notes:"Module is ready for assignment."}]};A(V=>[...V,X]),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.addModule(X)).catch(V=>console.error("[addModule] Supabase sync failed:",V))},Gi=H=>{A(X=>X.map(V=>V.id===H.id?H:V)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.updateModule(H)).catch(X=>console.error("[updateModule] Supabase sync failed:",X))},ml=H=>{A(X=>X.filter(V=>V.id!==H)),I(X=>X.filter(V=>V.moduleId!==H)),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(X=>X.deleteModule(H)).catch(X=>console.error("[deleteModule] Supabase sync failed:",X))},pl=H=>{const X=new Set(H);A(V=>V.filter(me=>!X.has(me.id))),I(V=>V.filter(me=>me.moduleId&&!X.has(me.moduleId))),Ln(()=>import("./supabaseService-dh34Qn6-.js"),[]).then(V=>V.deleteMultipleModules(H)).catch(V=>console.error("[deleteMultipleModules] Supabase sync failed:",V))},Us=(H,X)=>{const V=new Set(H),me=l.find(Me=>Me.id===X);me&&A(Me=>Me.map(Pe=>V.has(Pe.id)?{...Pe,farmerId:X,statusHistory:[...Pe.statusHistory,{status:Ye.ASSIGNED,date:new Date().toISOString(),notes:`Assigned to farmer ${me.firstName} ${me.lastName}`}]}:Pe))},on=(H,X)=>{const V=H.cuttingOperationId?B.find(Qe=>Qe.id===H.cuttingOperationId):void 0,me=C.find(Qe=>Qe.id===H.moduleId);if(!me)return;const Me={...H,id:`cyc-${Date.now()}`,linesPlanted:H.linesPlanted||me.lines,cuttingOperationId:H.cuttingOperationId||(V==null?void 0:V.id)};I(Qe=>[...Qe,Me]);const Pe=l.find(Qe=>Qe.id===X);A(Qe=>Qe.map(pt=>{if(pt.id===H.moduleId){const dt=[...pt.statusHistory];return V&&dt.push({status:Ye.CUTTING,date:V.date}),dt.push({status:Ye.ASSIGNED,date:H.plantingDate,notes:`Assigned to farmer ${Pe==null?void 0:Pe.firstName} ${Pe==null?void 0:Pe.lastName}`}),dt.push({status:Ye.PLANTED,date:H.plantingDate}),{...pt,farmerId:X,statusHistory:dt}}return pt}))},_n=H=>{let X;I(V=>(X=V.find(me=>me.id===H.id),V.map(me=>me.id===H.id?H:me))),H.cuttingOperationId&&Q(V=>V.map(me=>{if(me.id===H.cuttingOperationId){const Me=me.moduleCuts.map(Qe=>Qe.moduleId===H.moduleId?{...Qe,linesCut:H.linesPlanted||Qe.linesCut}:Qe),Pe=Me.reduce((Qe,pt)=>Qe+pt.linesCut*me.unitPrice,0);return{...me,seaweedTypeId:H.seaweedTypeId,moduleCuts:Me,totalAmount:Pe}}return me})),X&&X.status!==H.status&&A(V=>V.map(me=>{if(me.id===H.moduleId){const Me=H.exportDate||H.stockDate||H.baggingStartDate||H.dryingStartDate||H.harvestDate||new Date().toISOString(),Pe=[...me.statusHistory,{status:H.status,date:Me}];let Qe={...me,statusHistory:Pe};return H.status===Ye.IN_STOCK&&(Pe.push({status:Ye.FREE,date:H.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}),Qe={...Qe,farmerId:void 0}),Qe}return me}))},Ks=H=>{const X=new Map(H.map(me=>[me.id,me]));I(me=>me.map(Me=>X.get(Me.id)||Me));const V=new Map;H.forEach(me=>{me.status===Ye.IN_STOCK&&V.set(me.moduleId,me)}),V.size>0&&A(me=>me.map(Me=>{if(V.has(Me.id)){const Pe=V.get(Me.id),Qe=[...Me.statusHistory,{status:Ye.IN_STOCK,date:Pe.stockDate||new Date().toISOString()},{status:Ye.FREE,date:Pe.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}];return{...Me,farmerId:void 0,statusHistory:Qe}}return Me}))},zi=H=>I(X=>X.filter(V=>V.id!==H)),jd=(H,X,V)=>{const me=`cut-${Date.now()}`,Me={...H,id:me,beneficiaryFarmerId:V};Q(Qe=>[...Qe,Me]);const Pe=[];H.moduleCuts.forEach(Qe=>{const pt=C.find(dt=>dt.id===Qe.moduleId);if(V){const dt=Qe.linesCut*H.unitPrice;dt>0&&Pe.push({id:`fc-${Date.now()}-${Math.random()}`,date:H.date,siteId:H.siteId,farmerId:V,creditTypeId:"ct-3",totalAmount:dt,relatedOperationId:me,notes:`Cutting/Planting service for module ${(pt==null?void 0:pt.code)||Qe.moduleId}`})}}),Pe.length>0&&y(Qe=>[...Qe,...Pe]),on({...X,cuttingOperationId:me},V)},Ws=H=>D(X=>[...X,{...H,id:`sm-${Date.now()}`}]),$i=H=>D(X=>[...X,...H.map(V=>({...V,id:`sm-${Date.now()}-${Math.random()}`}))]),wa={sites:t,addSite:et,updateSite:At,deleteSite:ut,employees:a,addEmployee:Ct,updateEmployee:vt,deleteEmployee:Yt,deleteMultipleEmployees:Ps,updateEmployeesSite:Vs,farmers:l,addFarmer:kr,updateFarmer:Be,getFarmersBySite:Ut,deleteFarmer:Je,deleteMultipleFarmers:$e,updateFarmersSite:wt,serviceProviders:u,addServiceProvider:it,updateServiceProvider:kt,deleteServiceProvider:Tn,creditTypes:h,addCreditType:jn,updateCreditType:pn,deleteCreditType:Os,farmerCredits:x,addFarmerCredit:Xt,addMultipleFarmerCredits:cs,repayments:b,addRepayment:Na,addMultipleRepayments:Ls,monthlyPayments:_,addMonthlyPayment:wd,addMultipleMonthlyPayments:dl,updateMonthlyPayment:Fi,deleteMonthlyPayment:tr,seaweedTypes:E,addSeaweedType:Td,updateSeaweedType:ul,deleteSeaweedType:hl,updateSeaweedPrices:fl,modules:C,cultivationCycles:M,addModule:Bi,updateModule:Gi,deleteModule:ml,deleteMultipleModules:pl,updateModulesFarmer:Us,addCultivationCycle:on,updateCultivationCycle:_n,updateMultipleCultivationCycles:Ks,deleteCultivationCycle:zi,startCultivationFromCuttings:jd,stockMovements:P,addStockMovement:Ws,addMultipleStockMovements:$i,recordReturnFromPressing:H=>{Ws({date:H.date,siteId:H.siteId,seaweedTypeId:H.seaweedTypeId,type:ss.PRESSING_IN,designation:H.designation,inKg:H.kg,inBags:H.bags,relatedId:H.pressingSlipId}),q(X=>{var V;return[...X,{id:`psm-${Date.now()}`,date:H.date,siteId:"pressing-warehouse",seaweedTypeId:H.seaweedTypeId,type:mt.RETURN_TO_SITE,designation:`Return to site: ${((V=t.find(me=>me.id===H.siteId))==null?void 0:V.name)||H.siteId}`,outBales:H.bags,outKg:H.kg,relatedId:H.pressingSlipId}]})},farmerDeliveries:W,addFarmerDelivery:H=>{const X=`DEL-${new Date().getFullYear()}-${String(W.length+1).padStart(3,"0")}`,V={...H,id:`fd-${Date.now()}`,slipNo:X};ae(Pe=>[...Pe,V]);const me=l.find(Pe=>Pe.id===H.farmerId),Me=`Delivery from ${(me==null?void 0:me.firstName)||""} ${(me==null?void 0:me.lastName)||""} (${X})`;H.destination==="PRESSING_WAREHOUSE_BULK"?q(Pe=>[...Pe,{id:`psm-${Date.now()}`,date:H.date,siteId:"pressing-warehouse",seaweedTypeId:H.seaweedTypeId,type:mt.FARMER_DELIVERY,designation:Me,inKg:H.totalWeightKg,inBales:H.totalBags,relatedId:V.id}]):Ws({date:H.date,siteId:H.siteId,seaweedTypeId:H.seaweedTypeId,type:ss.FARMER_DELIVERY,designation:Me,inKg:H.totalWeightKg,inBags:H.totalBags,relatedId:V.id})},deleteFarmerDelivery:H=>{ae(X=>X.filter(V=>V.id!==H)),D(X=>X.filter(V=>V.relatedId!==H||V.type!==ss.FARMER_DELIVERY)),q(X=>X.filter(V=>V.relatedId!==H||V.type!==mt.FARMER_DELIVERY))},addInitialStock:H=>D(X=>[...X,{...H,id:`sm-${Date.now()}`,type:ss.INITIAL_STOCK}]),transferBaggedToStock:(H,X)=>{const V=X||new Date().toISOString().split("T")[0],me=M.filter(Pe=>H.includes(Pe.id)&&Pe.status===Ye.BAGGED).map(Pe=>({...Pe,status:Ye.IN_STOCK,stockDate:V})),Me=me.map(Pe=>{const Qe=C.find(pt=>pt.id===Pe.moduleId);return!Qe||!Pe.baggedWeightKg||!Pe.baggedBagsCount?null:{date:V,siteId:Qe.siteId,seaweedTypeId:Pe.seaweedTypeId,type:ss.BAGGING_TRANSFER,designation:`From Bagging (Module ${Qe.code})`,inKg:Pe.baggedWeightKg,inBags:Pe.baggedBagsCount,relatedId:Pe.id}}).filter(Pe=>Pe!==null);me.length>0&&Ks(me),Me.length>0&&$i(Me)},exportStockBatch:H=>{const X=M.find(me=>me.id===H);if(!X)return;_n({...X,status:Ye.EXPORTED,exportDate:new Date().toISOString().split("T")[0]});const V=C.find(me=>me.id===X.moduleId);V&&X.harvestedWeight&&Ws({date:new Date().toISOString().split("T")[0],siteId:V.siteId,seaweedTypeId:X.seaweedTypeId,type:ss.EXPORT_OUT,designation:`Export from Batch (Module ${V.code})`,outKg:X.harvestedWeight,outBags:Math.ceil(X.harvestedWeight/50),relatedId:X.id})},pressingSlips:U,pressedStockMovements:F,...{addPressingSlip:H=>{const X=`PRESS-${new Date().getFullYear()}-${String(U.length+1).padStart(3,"0")}`,V={...H,id:`ps-${Date.now()}`,slipNo:X};O(me=>[...me,V]),q(me=>[...me,{id:`psm-cons-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${V.slipNo}`,outKg:V.consumedWeightKg,outBales:V.consumedBags,relatedId:V.id},{id:`psm-prod-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${V.slipNo}`,inBales:V.producedBalesCount,inKg:V.producedWeightKg,relatedId:V.id}])},updatePressingSlip:H=>{O(X=>X.map(V=>V.id===H.id?H:V)),q(X=>[...X.filter(me=>me.relatedId!==H.id),{id:`psm-upd-cons-${Date.now()}`,date:H.date,siteId:"pressing-warehouse",seaweedTypeId:H.seaweedTypeId,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${H.slipNo}`,outKg:H.consumedWeightKg,outBales:H.consumedBags,relatedId:H.id},{id:`psm-upd-prod-${Date.now()}`,date:H.date,siteId:"pressing-warehouse",seaweedTypeId:H.seaweedTypeId,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${H.slipNo}`,inBales:H.producedBalesCount,inKg:H.producedWeightKg,relatedId:H.id}])},deletePressingSlip:H=>{O(X=>X.filter(V=>V.id!==H)),q(X=>X.filter(V=>V.relatedId!==H))},addInitialPressedStock:H=>q(X=>[...X,{...H,id:`psm-${Date.now()}`,type:mt.INITIAL_STOCK}]),addPressedStockAdjustment:H=>q(X=>[...X,{...H,id:`psm-adj-${Date.now()}`,relatedId:`adj-${Date.now()}`}])},exportDocuments:z,...{addExportDocument:(H,X)=>{const V=`EXP-${new Date().getFullYear()}-${String(z.length+1).padStart(3,"0")}`,me={...H,id:`ed-${Date.now()}`,docNo:V,containers:H.containers.map(pt=>({...pt,id:`ec-${Date.now()}-${Math.random()}`}))};Y(pt=>[...pt,me]),O(pt=>pt.map(dt=>me.pressingSlipIds.includes(dt.id)?{...dt,exportDocId:me.id}:dt));const Me=U.filter(pt=>me.pressingSlipIds.includes(pt.id)),Pe=Me.reduce((pt,dt)=>pt+dt.producedBalesCount,0),Qe=Me.reduce((pt,dt)=>pt+dt.producedWeightKg,0);Pe>0&&q(pt=>[...pt,{id:`psm-${Date.now()}`,date:me.date,siteId:"pressing-warehouse",seaweedTypeId:me.seaweedTypeId,type:mt.EXPORT_OUT,designation:`Export Shipment ${me.docNo}`,outBales:Pe,outKg:Qe,relatedId:me.id}])},updateExportDocument:H=>{Y(Pe=>Pe.map(Qe=>Qe.id===H.id?H:Qe)),O(Pe=>Pe.map(Qe=>H.pressingSlipIds.includes(Qe.id)?{...Qe,exportDocId:H.id}:Qe.exportDocId===H.id?{...Qe,exportDocId:void 0}:Qe));const X=F.filter(Pe=>Pe.relatedId!==H.id),V=U.filter(Pe=>H.pressingSlipIds.includes(Pe.id)),me=V.reduce((Pe,Qe)=>Pe+Qe.producedBalesCount,0),Me=V.reduce((Pe,Qe)=>Pe+Qe.producedWeightKg,0);me>0&&X.push({id:`psm-${Date.now()}`,date:H.date,siteId:"pressing-warehouse",seaweedTypeId:H.seaweedTypeId,type:mt.EXPORT_OUT,designation:`Export Shipment ${H.docNo}`,outBales:me,outKg:Me,relatedId:H.id}),q(X)},deleteExportDocument:H=>{O(X=>X.map(V=>V.exportDocId===H?{...V,exportDocId:void 0}:V)),Y(X=>X.filter(V=>V.id!==H)),q(X=>X.filter(V=>V.relatedId!==H))}},siteTransfers:J,...{addSiteTransfer:H=>{var V;const X={...H,id:`st-${Date.now()}`,status:Gt.AWAITING_OUTBOUND,history:[{status:Gt.AWAITING_OUTBOUND,date:new Date().toISOString(),notes:"Transfer initiated."}]};G(me=>[...me,X]),Ws({date:X.date,siteId:X.sourceSiteId,seaweedTypeId:X.seaweedTypeId,type:ss.SITE_TRANSFER_OUT,designation:`Transfer to ${(V=t.find(me=>me.id===X.destinationSiteId))==null?void 0:V.name} (${X.id})`,outKg:X.weightKg,outBags:X.bags,relatedId:X.id})},updateSiteTransfer:H=>{var me;const X=J.find(Me=>Me.id===H.id);if(!X)return;const V={...H};if(X.status!==V.status){let Me="";V.status===Gt.IN_TRANSIT?Me="Marked as in transit.":V.status===Gt.PENDING_RECEPTION?Me="Marked as arrived at destination, pending checks.":V.status===Gt.COMPLETED?Me=`Completed. Received ${V.receivedWeightKg}kg in ${V.receivedBags} bags.`:V.status===Gt.CANCELLED&&(Me=`Cancelled. Reason: ${V.notes}`),V.history=[...X.history||[],{status:V.status,date:new Date().toISOString(),notes:Me}]}G(Me=>Me.map(Pe=>Pe.id===V.id?V:Pe)),X.status!==Gt.COMPLETED&&V.status===Gt.COMPLETED&&(V.destinationSiteId==="pressing-warehouse"?q(Me=>{var Pe;return[...Me,{id:`psm-${Date.now()}`,date:V.completionDate||new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.BULK_IN_FROM_SITE,designation:`Transfer from ${(Pe=t.find(Qe=>Qe.id===V.sourceSiteId))==null?void 0:Pe.name} (${V.id})`,inKg:V.receivedWeightKg,inBales:V.receivedBags,relatedId:V.id}]}):Ws({date:V.completionDate||new Date().toISOString().split("T")[0],siteId:V.destinationSiteId,seaweedTypeId:V.seaweedTypeId,type:ss.SITE_TRANSFER_IN,designation:`Transfer from ${(me=t.find(Me=>Me.id===V.sourceSiteId))==null?void 0:me.name} (${V.id})`,inKg:V.receivedWeightKg,inBags:V.receivedBags,relatedId:V.id})),X.status!==Gt.CANCELLED&&V.status===Gt.CANCELLED&&Ws({date:V.completionDate||new Date().toISOString().split("T")[0],siteId:V.sourceSiteId,seaweedTypeId:V.seaweedTypeId,type:ss.SITE_TRANSFER_IN,designation:`Cancelled Transfer ${V.id}: ${V.notes||""}`.trim(),inKg:V.weightKg,inBags:V.bags,relatedId:V.id})}},cuttingOperations:B,...{addCuttingOperation:H=>{const X={...H,id:`cut-${Date.now()}`},V=[];H.moduleCuts.forEach(me=>{const Me=C.find(Pe=>Pe.id===me.moduleId);if(Me&&Me.farmerId){const Pe=me.linesCut*H.unitPrice;Pe>0&&V.push({id:`fc-${Date.now()}-${Math.random()}`,date:H.date,siteId:H.siteId,farmerId:Me.farmerId,creditTypeId:"ct-3",totalAmount:Pe,relatedOperationId:X.id,notes:`Cutting service for module ${Me.code}`})}}),Q(me=>[...me,X]),V.length>0&&y(me=>[...me,...V])},updateCuttingOperation:(H,X,V)=>{var Qe,pt;const me=B.find(dt=>dt.id===H.id);if(!me){console.error("Original operation not found for update:",H.id);return}const Me=(Qe=me.moduleCuts[0])==null?void 0:Qe.moduleId,Pe=(pt=H.moduleCuts[0])==null?void 0:pt.moduleId;if(Q(dt=>dt.map(Qt=>Qt.id===H.id?H:Qt)),I(dt=>dt.map(Qt=>{var Kt;if(Qt.cuttingOperationId===H.id){const Zt=(X==null?void 0:X[Pe])??Qt.initialWeight;return{...Qt,moduleId:Pe,seaweedTypeId:H.seaweedTypeId,plantingDate:V||H.date,linesPlanted:(Kt=H.moduleCuts[0])==null?void 0:Kt.linesCut,initialWeight:Zt}}return Qt})),y(dt=>{const Qt=dt.filter(Pn=>Pn.relatedOperationId!==H.id),Kt=[],Zt=H.beneficiaryFarmerId;if(Zt){const Pn=H.moduleCuts.reduce((bn,en)=>bn+en.linesCut*H.unitPrice,0);if(Pn>0){const bn=C.find(en=>en.id===Pe);Kt.push({id:`fc-edit-${Date.now()}`,date:H.date,siteId:H.siteId,farmerId:Zt,creditTypeId:"ct-3",totalAmount:Pn,relatedOperationId:H.id,notes:`Cutting service for module ${(bn==null?void 0:bn.code)||Pe}`})}}return[...Qt,...Kt]}),Me&&Pe&&Me!==Pe){const dt=l.find(Kt=>Kt.id===H.beneficiaryFarmerId),Qt=V||H.date;A(Kt=>Kt.map(Zt=>{var Pn;if(Zt.id===Me){const bn=((Pn=C.find(en=>en.id===Pe))==null?void 0:Pn.code)||Pe;return{...Zt,farmerId:void 0,statusHistory:[...Zt.statusHistory,{status:Ye.FREE,date:new Date().toISOString(),notes:`Operation moved to module ${bn}`}]}}return Zt.id===Pe?{...Zt,farmerId:H.beneficiaryFarmerId,statusHistory:[...Zt.statusHistory,{status:Ye.ASSIGNED,date:Qt,notes:`Assigned to farmer ${dt==null?void 0:dt.firstName} ${dt==null?void 0:dt.lastName}`},{status:Ye.PLANTED,date:Qt}]}:Zt}))}else if(Pe){const dt=l.find(Kt=>Kt.id===H.beneficiaryFarmerId),Qt=V||H.date;A(Kt=>Kt.map(Zt=>{if(Zt.id===Pe){let Pn=!1,bn={...Zt};const en=[...Zt.statusHistory];Zt.farmerId!==H.beneficiaryFarmerId&&(bn.farmerId=H.beneficiaryFarmerId,en.push({status:Ye.ASSIGNED,date:Qt,notes:`Re-assigned to farmer ${dt==null?void 0:dt.firstName} ${dt==null?void 0:dt.lastName}`}),Pn=!0);const Ta=en.map(Js=>Js.status).lastIndexOf(Ye.PLANTED);if(Ta>-1&&en[Ta].date!==Qt){en[Ta]={...en[Ta],date:Qt};const Js=en.map(bl=>bl.status).lastIndexOf(Ye.ASSIGNED,Ta);Js>-1&&(en[Js]={...en[Js],date:Qt}),Pn=!0}if(Pn)return bn.statusHistory=en,bn}return Zt}))}},updateMultipleCuttingOperations:(H,X)=>{const V=new Set(H);Q(me=>me.map(Me=>V.has(Me.id)?{...Me,isPaid:!0,paymentDate:X}:Me))},deleteCuttingOperation:H=>{var me;const X=B.find(Me=>Me.id===H);if(!X){console.error("Operation to delete not found:",H);return}const V=(me=X.moduleCuts[0])==null?void 0:me.moduleId;V&&A(Me=>Me.map(Pe=>Pe.id===V?{...Pe,farmerId:void 0,statusHistory:[...Pe.statusHistory,{status:Ye.FREE,date:new Date().toISOString(),notes:"Cutting operation deleted, module freed."}]}:Pe)),I(Me=>Me.filter(Pe=>Pe.cuttingOperationId!==H)),y(Me=>Me.filter(Pe=>Pe.relatedOperationId!==H)),Q(Me=>Me.filter(Pe=>Pe.id!==H))}},incidents:$,...{addIncident:H=>ie(X=>[...X,{...H,id:`inc-${Date.now()}`}]),updateIncident:H=>ie(X=>X.map(V=>V.id===H.id?H:V)),deleteIncident:H=>ie(X=>X.filter(V=>V.id!==H)),addIncidentType:H=>{const X=H.name.toUpperCase().replace(/\s/g,"_");ue.some(V=>V.id===X)||Ne(V=>[...V,{...H,id:X,isDefault:!1}])},updateIncidentType:H=>Ne(X=>X.map(V=>V.id===H.id?{...V,name:H.name}:V)),deleteIncidentType:H=>{Ne(V=>V.filter(me=>me.id!==H&&!me.isDefault));const X=ue.find(V=>V.id==="OTHER");X&&ie(V=>V.map(me=>me.type===H?{...me,type:X.id}:me))},addIncidentSeverity:H=>{const X=H.name.toUpperCase().replace(/\s/g,"_");le.some(V=>V.id===X)||ne(V=>[...V,{...H,id:X,isDefault:!1}])},updateIncidentSeverity:H=>ne(X=>X.map(V=>V.id===H.id?{...V,name:H.name}:V)),deleteIncidentSeverity:H=>{ne(V=>V.filter(me=>me.id!==H&&!me.isDefault));const X=le.find(V=>V.id==="LOW");X&&ie(V=>V.map(me=>me.severity===H?{...me,severity:X.id}:me))}},incidentTypes:ue,incidentSeverities:le,roles:je,...{addRole:H=>{const X=H.name.toUpperCase().replace(/\s/g,"_");if(je.some(me=>me.id===X))return;const V={...H,id:X,isDefault:!1};return fe(me=>[...me,V]),V},updateRole:H=>fe(X=>X.map(V=>V.id===H.id?H:V)),deleteRole:H=>fe(X=>X.filter(V=>V.id!==H&&!V.isDefault))},periodicTests:Z,...{addPeriodicTest:H=>ee(X=>[...X,{...H,id:`pt-${Date.now()}`}]),updatePeriodicTest:H=>ee(X=>X.map(V=>V.id===H.id?H:V)),deletePeriodicTest:H=>ee(X=>X.filter(V=>V.id!==H))},pestObservations:xe,users:De,findUserByEmail:H=>De.find(X=>X.email.toLowerCase()===H.toLowerCase()),addUser:(H,X)=>{if(De.some(me=>me.email.toLowerCase()===H.email.toLowerCase()))return;X&&ze(me=>me.map(Me=>Me.token===X?{...Me,status:Yo.ACCEPTED}:Me));const V={id:`user-${Date.now()}`,...H};return Re(me=>[...me,V]),V},setUserPasswordResetToken:(H,X,V)=>{let me=!1;return Re(Me=>Me.map(Pe=>Pe.email.toLowerCase()===H.toLowerCase()?(me=!0,{...Pe,passwordResetToken:X,passwordResetExpires:V}):Pe)),me},findUserByPasswordResetToken:H=>{const X=De.find(V=>V.passwordResetToken===H);return X&&X.passwordResetExpires&&new Date<new Date(X.passwordResetExpires)?X:void 0},updateUserPassword:(H,X)=>{let V=!1;return Re(me=>me.map(Me=>Me.id===H?(V=!0,{...Me,password:X,passwordResetToken:void 0,passwordResetExpires:void 0}):Me)),V},updateUser:H=>Re(X=>X.map(V=>V.id===H.id?H:V)),markCyclesAsPaid:(H,X)=>{const V=new Set(H);I(me=>me.map(Me=>V.has(Me.id)?{...Me,paymentRunId:X}:Me))},markDeliveriesAsPaid:(H,X)=>{const V=new Set(H);ae(me=>me.map(Me=>V.has(Me.id)?{...Me,paymentRunId:X}:Me))},invitations:Ve,addInvitation:H=>{const X={...H,id:`inv-${Date.now()}`,token:`inv-token-${Date.now()}-${Math.random()}`,createdAt:new Date().toISOString()};return ze(V=>[...V,X]),X},deleteInvitation:H=>ze(X=>X.filter(V=>V.id!==H)),findInvitationByToken:H=>{const X=Ve.find(V=>V.token===H&&V.status===Yo.PENDING);return X&&new Date(X.expiresAt)>new Date?X:void 0},addMessageLog:H=>Le(X=>[{...H,id:`msg-${Date.now()}`},...X]),messageLogs:Se,galleryPhotos:be,addGalleryPhoto:H=>ye(X=>[{...H,id:`photo-${Date.now()}`},...X]),updateGalleryPhotoComment:(H,X)=>ye(V=>V.map(me=>me.id===H?{...me,comment:X}:me)),deleteGalleryPhoto:H=>ye(X=>X.filter(V=>V.id!==H)),clearAllData:()=>{localStorage.clear(),s([]),i([]),c([]),f([]),m(Gx),y([]),T([]),j([]),k([]),A([]),I([]),D([]),O([]),q([]),Y([]),G([]),Q([]),ae([]),ie([]),Ne(Lx),ne(Ux),fe(Fx),ee([]),Oe([]),Re(Bx),ze([]),Le([]),ye([])}};return n.jsx(bb.Provider,{value:wa,children:e})},He=()=>{const e=S.useContext(bb);if(e===void 0)throw new Error("useData must be used within a DataProvider");return e},Nb=S.createContext(void 0),lC=({children:e})=>{const{modules:t,cultivationCycles:s}=He(),[a,i]=S.useState([]);return S.useEffect(()=>{const l=new Date;l.setHours(0,0,0,0);const c=[];t.forEach(u=>{if(!u.farmerId){const f=s.filter(h=>h.moduleId===u.id&&h.harvestDate).sort((h,m)=>new Date(m.harvestDate).getTime()-new Date(h.harvestDate).getTime());if(f.length>0){const h=new Date(f[0].harvestDate);Math.floor((l.getTime()-h.getTime())/(1e3*3600*24))>df&&c.push({id:`unassigned-${u.id}`,type:"MODULE_UNASSIGNED",messageKey:"notification_unassigned",messageParams:{code:u.code,days:df},date:l.toISOString(),relatedId:u.id,path:`/modules?highlight=${u.id}`})}}}),s.forEach(u=>{if(u.status===Ye.PLANTED||u.status===Ye.GROWING){const f=new Date(u.plantingDate);f.setHours(0,0,0,0);const h=Math.floor((l.getTime()-f.getTime())/(1e3*3600*24)),m=t.find(x=>x.id===u.moduleId);h>pa?c.push({id:`overdue-${u.id}`,type:"HARVEST_OVERDUE",messageKey:"notification_overdue",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:u.id,path:`/cultivation?highlight=${u.id}`}):h>pa-Yf&&c.push({id:`nearing-${u.id}`,type:"HARVEST_NEARING",messageKey:"notification_nearing",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:u.id,path:`/cultivation?highlight=${u.id}`})}}),c.sort((u,f)=>new Date(f.date).getTime()-new Date(u.date).getTime()),i(c)},[t,s]),n.jsx(Nb.Provider,{value:{notifications:a},children:e})},cC=()=>{const e=S.useContext(Nb);if(e===void 0)throw new Error("useNotifications must be used within a NotificationProvider");return e},Sb=S.createContext(void 0),dC=({children:e})=>{const[t,s]=S.useState(null),[a,i]=S.useState(new Set),[l,c]=S.useState(!0),{findUserByEmail:u,addUser:f,setUserPasswordResetToken:h,findUserByPasswordResetToken:m,updateUserPassword:x,roles:y,updateUser:b}=He(),T=S.useCallback(I=>a.has(I),[a]);S.useEffect(()=>{try{const I=localStorage.getItem("seafarm_monitor_user");if(I){const P=JSON.parse(I);if(s(P),y.length>0){const D=y.find(O=>O.id===P.roleId),U=D?D.permissions:[];i(new Set(U))}}}catch(I){console.error("Failed to parse user from localStorage",I),localStorage.removeItem("seafarm_monitor_user")}finally{c(!1)}},[y]);const _=S.useCallback(async(I,P)=>{const D=u(I);if(D&&D.password===P){const U=y.find(z=>z.id===D.roleId),O=U?U.permissions:[];i(new Set(O));const{password:F,...q}=D;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(q)),s(q),!0}return!1},[u,y]),j=S.useCallback(async(I,P)=>{const D=f(I,P);if(D){const U=y.find(z=>z.id===D.roleId),O=U?U.permissions:[];i(new Set(O));const{password:F,...q}=D;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(q)),s(q),!0}return!1},[f,y]),E=S.useCallback(()=>{s(null),i(new Set),localStorage.removeItem("seafarm_monitor_user")},[]),k=S.useCallback(async I=>{if(u(I)){const D=`mock-token-${Date.now()}`,U=new Date(Date.now()+36e5);h(I,D,U);const O=`${window.location.origin}${window.location.pathname}#/reset-password?token=${D}`;return console.log("--- PASSWORD RESET (FOR TESTING) ---"),console.log(`Reset link for ${I}: ${O}`),console.log("------------------------------------"),O}return null},[u,h]),C=S.useCallback(async(I,P)=>{const D=m(I);if(!D)return!1;const U=x(D.id,P);return U&&E(),U},[m,x,E]),A=S.useCallback(I=>{if(!t)return;const P={...t,...I};b(P),s(P),localStorage.setItem("seafarm_monitor_user",JSON.stringify(P))},[t,b]),M={currentUser:t,loading:l,login:_,signup:j,logout:E,sendPasswordResetLink:k,resetPassword:C,can:T,updateProfile:A};return n.jsx(Sb.Provider,{value:M,children:!l&&e})},Rs=()=>{const e=S.useContext(Sb);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e};class vi extends S.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error(" ErrorBoundary caught an error:",t),console.error("Error info:",s),this.setState({error:t,errorInfo:s})}render(){var t;return this.state.hasError?this.props.fallback?this.props.fallback:n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:n.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8",children:[n.jsxs("div",{className:"flex items-center mb-4",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("svg",{className:"h-12 w-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Oops! Something went wrong"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Une erreur s'est produite lors du chargement de cette page"})]})]}),n.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Details:"}),n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:n.jsx("p",{className:"text-sm text-red-800 font-mono",children:(t=this.state.error)==null?void 0:t.toString()})})]}),this.state.errorInfo&&n.jsxs("details",{className:"mt-4",children:[n.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 hover:text-gray-900",children:"Component Stack Trace"}),n.jsx("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-md p-4",children:n.jsx("pre",{className:"text-xs text-gray-700 overflow-auto",children:this.state.errorInfo.componentStack})})]}),n.jsxs("div",{className:"mt-6 flex gap-4",children:[n.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Reload Page"}),n.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors",children:"Go Back"})]}),n.jsx("div",{className:"mt-4 text-center",children:n.jsx("a",{href:"/#/",className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"Return to Dashboard"})})]})}):this.props.children}}const uC={Activity:n.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}),AlertTriangle:n.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),Archive:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),n.jsx("rect",{width:"22",height:"5",x:"1",y:"3"}),n.jsx("line",{x1:"10",x2:"14",y1:"12",y2:"12"})]}),ArrowRightLeft:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"m16 3 4 4-4 4"}),n.jsx("path",{d:"M20 7H4"}),n.jsx("path",{d:"m8 21-4-4 4-4"}),n.jsx("path",{d:"M4 17h16"})]}),ArrowUp:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),n.jsx("polyline",{points:"5 12 12 5 19 12"})]}),ArrowDown:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),n.jsx("polyline",{points:"19 12 12 19 5 12"})]}),Beaker:n.jsx("path",{d:"M4.5 3h15M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3M6 14h12"}),Bell:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),n.jsx("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),BookOpen:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),n.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),Bot:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"18",height:"10",x:"3",y:"11",rx:"2"}),n.jsx("circle",{cx:"12",cy:"5",r:"2"}),n.jsx("path",{d:"M12 7v4"}),n.jsx("line",{x1:"8",x2:"8",y1:"16",y2:"16"}),n.jsx("line",{x1:"16",x2:"16",y1:"16",y2:"16"})]}),Briefcase:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),Building:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),n.jsx("path",{d:"M9 22v-4h6v4"}),n.jsx("path",{d:"M8 6h.01"}),n.jsx("path",{d:"M16 6h.01"}),n.jsx("path",{d:"M12 6h.01"}),n.jsx("path",{d:"M12 10h.01"}),n.jsx("path",{d:"M12 14h.01"}),n.jsx("path",{d:"M16 10h.01"}),n.jsx("path",{d:"M16 14h.01"}),n.jsx("path",{d:"M8 10h.01"}),n.jsx("path",{d:"M8 14h.01"})]}),Calculator:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2"}),n.jsx("line",{x1:"8",x2:"16",y1:"6",y2:"6"}),n.jsx("line",{x1:"16",x2:"16",y1:"14",y2:"18"}),n.jsx("path",{d:"M16 10h.01"}),n.jsx("path",{d:"M12 10h.01"}),n.jsx("path",{d:"M8 10h.01"}),n.jsx("path",{d:"M12 14h.01"}),n.jsx("path",{d:"M8 14h.01"}),n.jsx("path",{d:"M12 18h.01"}),n.jsx("path",{d:"M8 18h.01"})]}),Calendar:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),n.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),n.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),n.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),Check:n.jsx("polyline",{points:"20 6 9 17 4 12"}),ChevronDown:n.jsx("polyline",{points:"6 9 12 15 18 9"}),ChevronLeft:n.jsx("polyline",{points:"15 18 9 12 15 6"}),ChevronRight:n.jsx("polyline",{points:"9 18 15 12 9 6"}),CreditCard:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),n.jsx("line",{x1:"2",x2:"22",y1:"10",y2:"10"})]}),DollarSign:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),n.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),Download:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n.jsx("polyline",{points:"7 10 12 15 17 10"}),n.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),Edit:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),Edit2:n.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}),Eye:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),n.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),FileSpreadsheet:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),n.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),n.jsx("path",{d:"M8 13h2"}),n.jsx("path",{d:"M8 17h2"}),n.jsx("path",{d:"M14 13h2"}),n.jsx("path",{d:"M14 17h2"})]}),FileText:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),n.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),n.jsx("path",{d:"M10 9H8"}),n.jsx("path",{d:"M16 13H8"}),n.jsx("path",{d:"M16 17H8"})]}),Filter:n.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}),GitBranch:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"6",x2:"6",y1:"3",y2:"15"}),n.jsx("circle",{cx:"18",cy:"6",r:"3"}),n.jsx("circle",{cx:"6",cy:"18",r:"3"}),n.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]}),Globe:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),n.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),Grid:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),n.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),n.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),n.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),Home:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),n.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),Image:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),n.jsx("circle",{cx:"9",cy:"9",r:"2"}),n.jsx("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),Layers:n.jsxs(n.Fragment,{children:[n.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),n.jsx("polyline",{points:"2 17 12 22 22 17"}),n.jsx("polyline",{points:"2 12 12 17 22 12"})]}),Lock:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),n.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),LogOut:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),n.jsx("polyline",{points:"16 17 21 12 16 7"}),n.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),Map:n.jsxs(n.Fragment,{children:[n.jsx("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"}),n.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"18"}),n.jsx("line",{x1:"16",x2:"16",y1:"6",y2:"22"})]}),MapPin:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),n.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),Menu:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),n.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),n.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),Moon:n.jsx("path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}),Package:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"m16.5 9.4-9-5.19"}),n.jsx("path",{d:"m21 16-9 5.19-9-5.19"}),n.jsx("path",{d:"m3 11.1 9 5.19 9-5.19"}),n.jsx("line",{x1:"12",x2:"12",y1:"5.9",y2:"21.19"}),n.jsx("path",{d:"M12 2 3 7l9 5.19L21 7Z"})]}),PlusCircle:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"10"}),n.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"16"}),n.jsx("line",{x1:"8",x2:"16",y1:"12",y2:"12"})]}),Printer:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),n.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),n.jsx("rect",{width:"12",height:"8",x:"6",y:"14"})]}),QrCode:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"5",height:"5",x:"3",y:"3",rx:"1"}),n.jsx("rect",{width:"5",height:"5",x:"16",y:"3",rx:"1"}),n.jsx("rect",{width:"5",height:"5",x:"3",y:"16",rx:"1"}),n.jsx("path",{d:"M21 16h-3a2 2 0 0 0-2 2v3"}),n.jsx("path",{d:"M21 21v.01"}),n.jsx("path",{d:"M12 7v3a2 2 0 0 1-2 2H7"}),n.jsx("path",{d:"M3 12h.01"}),n.jsx("path",{d:"M12 3h.01"}),n.jsx("path",{d:"M12 16v.01"}),n.jsx("path",{d:"M16 12h1"}),n.jsx("path",{d:"M21 12v.01"}),n.jsx("path",{d:"M12 21v-1"})]}),Save:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),n.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),n.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Scissors:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"6",cy:"6",r:"3"}),n.jsx("circle",{cx:"6",cy:"18",r:"3"}),n.jsx("line",{x1:"20",x2:"8.12",y1:"4",y2:"15.88"}),n.jsx("line",{x1:"14.47",x2:"20",y1:"14.48",y2:"20"}),n.jsx("line",{x1:"8.12",x2:"12",y1:"8.12",y2:"12"})]}),Search:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"11",cy:"11",r:"8"}),n.jsx("line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"})]}),Settings:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),n.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),SlidersHorizontal:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"21",x2:"14",y1:"4",y2:"4"}),n.jsx("line",{x1:"10",x2:"3",y1:"4",y2:"4"}),n.jsx("line",{x1:"21",x2:"12",y1:"12",y2:"12"}),n.jsx("line",{x1:"8",x2:"3",y1:"12",y2:"12"}),n.jsx("line",{x1:"21",x2:"16",y1:"20",y2:"20"}),n.jsx("line",{x1:"12",x2:"3",y1:"20",y2:"20"}),n.jsx("line",{x1:"14",x2:"14",y1:"2",y2:"6"}),n.jsx("line",{x1:"8",x2:"8",y1:"10",y2:"14"}),n.jsx("line",{x1:"16",x2:"16",y1:"18",y2:"22"})]}),Sun:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"12",cy:"12",r:"4"}),n.jsx("path",{d:"M12 2v2"}),n.jsx("path",{d:"M12 20v2"}),n.jsx("path",{d:"m4.93 4.93 1.41 1.41"}),n.jsx("path",{d:"m17.66 17.66 1.41 1.41"}),n.jsx("path",{d:"M2 12h2"}),n.jsx("path",{d:"M20 12h2"}),n.jsx("path",{d:"m6.34 17.66-1.41 1.41"}),n.jsx("path",{d:"m19.07 4.93-1.41 1.41"})]}),Trash2:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M3 6h18"}),n.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),n.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),n.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),n.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),TrendingUp:n.jsxs(n.Fragment,{children:[n.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),n.jsx("polyline",{points:"17 6 23 6 23 12"})]}),Truck:n.jsxs(n.Fragment,{children:[n.jsx("rect",{width:"16",height:"13",x:"1",y:"5",rx:"2"}),n.jsx("polygon",{points:"16 8 20 8 23 11 23 16 16 16 16 8"}),n.jsx("circle",{cx:"5.5",cy:"18.5",r:"2.5"}),n.jsx("circle",{cx:"18.5",cy:"18.5",r:"2.5"})]}),User:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),UserCog:n.jsxs(n.Fragment,{children:[n.jsx("circle",{cx:"18",cy:"15",r:"3"}),n.jsx("circle",{cx:"9",cy:"7",r:"4"}),n.jsx("path",{d:"M10 15H6a4 4 0 0 0-4 4v2"}),n.jsx("path",{d:"m21.7 16.4.9-.9"}),n.jsx("path",{d:"m15.2 13.9-.9-.9"}),n.jsx("path",{d:"m16.6 18.7.3 1.2"}),n.jsx("path",{d:"m19.1 12.2.3-1.2"}),n.jsx("path",{d:"m19.6 18.7-.4-1"}),n.jsx("path",{d:"m16.8 12.3-.4-1"}),n.jsx("path",{d:"m14.3 16.6 1-.4"}),n.jsx("path",{d:"m20.7 13.8 1-.4"})]}),Users:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),n.jsx("circle",{cx:"9",cy:"7",r:"4"}),n.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),n.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Warehouse:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"}),n.jsx("path",{d:"M6 18h12"}),n.jsx("path",{d:"M6 14h12"}),n.jsx("rect",{width:"12",height:"12",x:"6",y:"10"})]}),Wind:n.jsxs(n.Fragment,{children:[n.jsx("path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"}),n.jsx("path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2"}),n.jsx("path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2"})]}),X:n.jsxs(n.Fragment,{children:[n.jsx("line",{x1:"18",x2:"6",y1:"6",y2:"18"}),n.jsx("line",{x1:"6",x2:"18",y1:"6",y2:"18"})]})},te=({name:e,className:t="w-6 h-6",...s})=>{const a=uC[e];return a?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,...s,children:a}):(console.warn(`Icon "${e}" not found`),null)},zx=({text:e})=>n.jsxs("div",{className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-gray-900/90 dark:bg-black/90 backdrop-blur text-white text-sm font-medium rounded-md shadow-lg whitespace-nowrap z-50 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-opacity delay-150 pointer-events-none",children:[e,n.jsx("div",{className:"absolute top-1/2 -left-1 -translate-y-1/2 w-0 h-0 border-y-4 border-y-transparent border-r-4 border-r-gray-900/90 dark:border-r-black/90"})]}),hC=({isOpen:e,setOpen:t})=>{const{language:s,t:a}=we(),{can:i}=Rs(),{pathname:l}=qs(),[c,u]=S.useState({}),f=S.useMemo(()=>vj.map(y=>{if(!y.permission||i(y.permission))if(y.children){const b=y.children.filter(T=>!T.permission||i(T.permission));if(b.length>0)return{...y,children:b};if(y.path)return{...y,children:[]}}else return y;return null}).filter(y=>y!==null),[i]);S.useEffect(()=>{const y={};f.forEach(b=>{b.children&&b.children.some(_=>_.path&&l.startsWith(_.path))&&(y[b.label.en]=!0)}),u(y)},[l,f]);const h=y=>{u(b=>({...b,[y]:!b[y]}))},m=({item:y})=>n.jsxs("div",{className:"relative group",children:[n.jsxs(Qv,{to:y.path,onClick:()=>{window.innerWidth<768&&t(!1)},className:({isActive:b})=>`flex items-center p-2 my-1 rounded-md transition-all duration-200 w-full ${b?"bg-blue-600/90 text-white shadow-lg shadow-blue-500/30 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[n.jsx(te,{name:y.icon,className:"w-5 h-5 flex-shrink-0"}),e&&n.jsx("span",{className:"ml-3 whitespace-nowrap",children:y.label[s]})]}),!e&&n.jsx(zx,{text:y.label[s]})]}),x=({item:y})=>{var _,j;const b=((_=y.children)==null?void 0:_.some(E=>E.path&&l.startsWith(E.path)))||!1,T=c[y.label.en]||!1;return n.jsxs("div",{children:[n.jsxs("div",{className:"relative group",children:[n.jsxs("div",{onClick:()=>h(y.label.en),className:`flex items-center justify-between p-2 my-1 rounded-md cursor-pointer transition-all duration-200 ${b?"bg-blue-100/80 dark:bg-blue-900/40 font-semibold text-blue-800 dark:text-blue-200 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:y.icon,className:"w-5 h-5 flex-shrink-0"}),e&&n.jsx("span",{className:"ml-3 whitespace-nowrap",children:y.label[s]})]}),e&&n.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${T?"rotate-180":""}`})]}),!e&&n.jsx(zx,{text:y.label[s]})]}),T&&e&&n.jsx("div",{className:"pl-6 ml-4 border-l-2 border-blue-200/50 dark:border-blue-800/50",children:(j=y.children)==null?void 0:j.map(E=>n.jsx(m,{item:E},E.path))})]})};return n.jsxs("aside",{className:`fixed top-0 left-0 h-full bg-white/70 dark:bg-black/40 backdrop-blur-xl border-r border-white/20 dark:border-gray-700/50 transition-all duration-300 z-50 ${e?"w-64":"w-16"} ${e?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[n.jsxs("div",{className:"flex items-center justify-between p-3 h-[73px]",children:[e&&n.jsx("span",{className:"text-xl font-bold ml-1 text-gray-800 dark:text-white",children:a("appName")}),n.jsx("button",{onClick:()=>t(!e),className:"p-2 rounded-md hover:bg-white/50 dark:hover:bg-white/10 hidden md:inline-flex text-gray-600 dark:text-gray-300",children:n.jsx(te,{name:"Menu",className:"w-6 h-6"})})]}),n.jsx("nav",{className:"p-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700",style:{height:"calc(100vh - 73px)"},children:f.map(y=>y.children&&y.children.length>0?n.jsx(x,{item:y},y.label.en):n.jsx(m,{item:y},y.path))})]})},se=({children:e,variant:t="primary",className:s="",type:a="button",...i})=>{const l="px-4 py-2 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",c={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 focus:ring-gray-500"};return n.jsx("button",{type:a,className:`${l} ${c[t]} ${s}`,...i,children:e})},fC=()=>{const{notifications:e}=cC(),{t}=we(),[s,a]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{const u=f=>{i.current&&!i.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]);const l=u=>{switch(u){case"MODULE_UNASSIGNED":return n.jsx(te,{name:"Grid",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_NEARING":return n.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_OVERDUE":return n.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-red-500 flex-shrink-0"});default:return n.jsx(te,{name:"Bell",className:"w-5 h-5 text-gray-500 flex-shrink-0"})}},c=(u,f)=>{let h=t(u);for(const m in f)h=h.replace(`{${m}}`,String(f[m]));return h};return n.jsxs("div",{className:"relative",ref:i,children:[n.jsxs("button",{onClick:()=>a(!s),className:"relative p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900","aria-label":t("notifications_count").replace("{count}",String(e.length)),children:[n.jsx(te,{name:"Bell",className:"w-6 h-6"}),e.length>0&&n.jsxs("span",{className:"absolute top-0 right-0 flex h-5 w-5",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-red-500 text-white text-xs items-center justify-center",children:e.length})]})]}),s&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-w-xs sm:max-w-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-2xl z-50",children:[n.jsx("div",{className:"p-3 font-semibold border-b border-gray-200 dark:border-gray-700",children:t("notifications")}),n.jsx("ul",{className:"max-h-96 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-700",children:e.length>0?e.map(u=>n.jsx("li",{children:n.jsxs(bs,{to:u.path,onClick:()=>a(!1),className:"flex items-start gap-3 p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[l(u.type),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm",children:c(u.messageKey,u.messageParams)}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(u.date).toLocaleDateString()})]})]})},u.id)):n.jsx("li",{className:"p-4 text-center text-sm text-gray-500 dark:text-gray-400",children:t("noNotifications")})})]})]})},ot=({isOpen:e,onClose:t,title:s,children:a,footer:i,widthClass:l="max-w-4xl"})=>{const{t:c}=we(),[u,f]=S.useState(!1);return S.useEffect(()=>(f(!0),()=>f(!1)),[]),S.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),S.useEffect(()=>{const h=m=>{m.key==="Escape"&&t()};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[t]),!e||!u?null:yj.createPortal(n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-[1050]",onClick:t,children:n.jsxs("div",{className:`bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-xl shadow-2xl flex flex-col w-full m-4 ${l} max-h-[90vh] animate-in fade-in zoom-in-95 duration-200`,onClick:h=>h.stopPropagation(),children:[n.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:s}),n.jsx("button",{onClick:t,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:n.jsx(te,{name:"X",className:"w-6 h-6"})})]}),n.jsx("main",{className:"p-6 overflow-y-auto flex-grow custom-scrollbar",children:a}),i&&n.jsx("footer",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:i})]})}),document.body)},mC=({isOpen:e,onClose:t,onScan:s})=>{const{t:a}=we(),i=S.useRef(null),[l,c]=S.useState("");return S.useEffect(()=>(e&&!i.current&&setTimeout(()=>{try{const u=new Html5QrcodeScanner("qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);u.render(f=>{u.clear().then(()=>{s(f)})},f=>{}),i.current=u}catch{c("Camera access needed or library missing.")}},100),()=>{i.current&&(i.current.clear().catch(u=>console.error(u)),i.current=null)}),[e,s]),n.jsx(ot,{isOpen:e,onClose:t,title:a("scanQRCode"),widthClass:"max-w-md",children:n.jsxs("div",{className:"flex flex-col items-center justify-center",children:[n.jsx("div",{id:"qr-reader",className:"w-full"}),l&&n.jsx("p",{className:"text-red-500 mt-2",children:l}),n.jsx("p",{className:"text-sm text-gray-500 mt-4 text-center",children:a("scanInstruction")})]})})},vn=({status:e})=>{const{t}=we();if(!e)return null;const s={FREE:{textKey:"status_FREE",color:"gray"},ASSIGNED:{textKey:"status_ASSIGNED",color:"green"},CREATED:{textKey:"status_CREATED",color:"indigo"},CUTTING:{textKey:"status_CUTTING",color:"orange"},PLANTED:{textKey:"status_PLANTED",color:"blue"},GROWING:{textKey:"status_GROWING",color:"cyan"},HARVESTED:{textKey:"status_HARVESTED",color:"yellow"},DRYING:{textKey:"status_DRYING",color:"orange"},BAGGING:{textKey:"status_BAGGING",color:"purple"},IN_STOCK:{textKey:"status_IN_STOCK",color:"pink"},EXPORTED:{textKey:"status_EXPORTED",color:"red"},MAINTENANCE:{textKey:"status_MAINTENANCE",color:"gray"},STORED:{textKey:"status_STORED",color:"gray"},[Gt.AWAITING_OUTBOUND]:{textKey:"status_AWAITING_OUTBOUND",color:"yellow"},[Gt.IN_TRANSIT]:{textKey:"status_IN_TRANSIT",color:"blue"},[Gt.COMPLETED]:{textKey:"status_COMPLETED",color:"green"},[Gt.CANCELLED]:{textKey:"status_CANCELLED",color:"red"},LOW:{textKey:"severity_LOW",color:"cyan"},MEDIUM:{textKey:"severity_MEDIUM",color:"yellow"},HIGH:{textKey:"severity_HIGH",color:"orange"},CRITICAL:{textKey:"severity_CRITICAL",color:"red"},OPEN:{textKey:"status_OPEN",color:"blue"},IN_PROGRESS:{textKey:"status_IN_PROGRESS",color:"purple"},RESOLVED:{textKey:"status_RESOLVED",color:"green"},CLOSED:{textKey:"status_CLOSED",color:"gray"},PERMANENT:{textKey:"employeeType_PERMANENT",color:"blue"},CASUAL:{textKey:"employeeType_CASUAL",color:"green"},ACTIVE:{textKey:"status_ACTIVE",color:"green"},INACTIVE:{textKey:"status_INACTIVE",color:"red"}},{textKey:a,color:i}=s[e]||{textKey:e,color:"gray"},l=t(a)||e,c={green:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700/50 dark:text-gray-300",indigo:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",cyan:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/50 dark:text-cyan-300",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",purple:"bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300",pink:"bg-pink-100 text-pink-800 dark:bg-pink-900/50 dark:text-pink-300",red:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return n.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${c[i]}`,children:l})},Ge=({children:e,className:t="",title:s,onClick:a})=>{const i=`
    bg-white/80 dark:bg-gray-800/60
    backdrop-blur-xl
    border border-white/20 dark:border-gray-700/50
    rounded-xl shadow-xl p-6 
    ${a?"cursor-pointer hover:bg-white/90 dark:hover:bg-gray-800/70 transition-all":""} 
    ${t}
  `;return n.jsxs("div",{className:i.trim(),onClick:a,children:[s&&n.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:s}),e]})},pC=({isOpen:e,onClose:t,scannedData:s})=>{var y,b,T,_;const{t:a,language:i}=we(),{modules:l,cultivationCycles:c,sites:u,farmers:f,seaweedTypes:h}=He(),m=S.useMemo(()=>{if(!s)return null;let j,E;if(s.type==="module"?(j=l.find(I=>I.id===s.id),j&&(E=c.filter(I=>I.moduleId===j.id).sort((I,P)=>new Date(P.plantingDate).getTime()-new Date(I.plantingDate).getTime())[0])):s.type==="batch"&&(E=c.find(I=>I.id===s.id),E&&(j=l.find(I=>I.id===E.moduleId))),!j)return null;const k=u.find(I=>I.id===j.siteId),C=k==null?void 0:k.zones.find(I=>I.id===j.zoneId),A=j.farmerId?f.find(I=>I.id===j.farmerId):void 0,M=E?h.find(I=>I.id===E.seaweedTypeId):void 0;return{module:j,cycle:E,site:k,zone:C,farmer:A,seaweedType:M}},[s,l,c,u,f,h]);if(!m)return null;const x=(s==null?void 0:s.type)==="module"?m.module.code:m.cycle?`${((y=m.seaweedType)==null?void 0:y.name)||a("batch")} - ${new Date(m.cycle.plantingDate).toLocaleDateString()}`:a("unknown_batch");return n.jsx(ot,{isOpen:e,onClose:t,title:a("traceabilityReport"),widthClass:"max-w-3xl",footer:n.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded",children:a("close")}),children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[n.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-800 rounded-full",children:n.jsx("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-blue-900 dark:text-blue-100 uppercase",children:x}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 uppercase tracking-wide",children:(s==null?void 0:s.type)==="module"?a("moduleTraceability"):a("batchTraceability")})]})]}),n.jsx(Ge,{title:a("originInformation"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("site")}),n.jsx("p",{className:"font-semibold",children:(b=m.site)==null?void 0:b.name})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("zone")}),n.jsx("p",{className:"font-semibold",children:(T=m.zone)==null?void 0:T.name})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("module")}),n.jsx("p",{className:"font-semibold font-mono",children:m.module.code})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("farmer")}),n.jsx("p",{className:"font-semibold",children:m.farmer?`${m.farmer.firstName} ${m.farmer.lastName}`:a("unassigned")})]})]})}),m.cycle?n.jsxs(Ge,{title:a("batchHistory"),children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("seaweedType")}),n.jsx("p",{className:"font-semibold",children:(_=m.seaweedType)==null?void 0:_.name})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("status")}),n.jsx("div",{className:"mt-1",children:n.jsx(vn,{status:m.cycle.status})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500 uppercase",children:a("initialWeight")}),n.jsxs("p",{className:"font-semibold",children:[m.cycle.initialWeight," kg"]})]})]}),n.jsxs("div",{className:"mt-4 relative border-l-2 border-gray-200 dark:border-gray-700 ml-3 space-y-6 pl-6 pb-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-blue-500 bg-white dark:bg-gray-900"}),n.jsx("p",{className:"text-sm text-gray-500",children:a("plantingDate")}),n.jsx("p",{className:"font-semibold",children:new Date(m.cycle.plantingDate).toLocaleDateString(i,{dateStyle:"medium"})})]}),m.cycle.harvestDate&&n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-green-500 bg-white dark:bg-gray-900"}),n.jsx("p",{className:"text-sm text-gray-500",children:a("harvestDate")}),n.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.harvestDate).toLocaleDateString(i,{dateStyle:"medium"}),n.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.harvestedWeight," kg"]})]})]}),m.cycle.dryingStartDate&&n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-yellow-500 bg-white dark:bg-gray-900"}),n.jsx("p",{className:"text-sm text-gray-500",children:a("dryingProcess")}),n.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.dryingStartDate).toLocaleDateString(i,{dateStyle:"medium"}),m.cycle.dryingCompletionDate&&` - ${new Date(m.cycle.dryingCompletionDate).toLocaleDateString(i,{dateStyle:"medium"})}`]})]}),m.cycle.baggedDate&&n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-purple-500 bg-white dark:bg-gray-900"}),n.jsx("p",{className:"text-sm text-gray-500",children:a("baggedDate")}),n.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.baggedDate).toLocaleDateString(i,{dateStyle:"medium"}),n.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.baggedWeightKg," kg / ",m.cycle.baggedBagsCount," ",a("bales")]})]})]})]})]}):n.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800",children:a("noActiveCycleFoundForModule")})]})})},gC=({onMenuClick:e})=>{const{settings:t,updateSettings:s}=Ke(),{t:a}=we(),{currentUser:i,logout:l}=Rs(),c=Ds(),[u,f]=S.useState(!1),h=S.useRef(null),[m,x]=S.useState(!1),[y,b]=S.useState(null),[T,_]=S.useState(!1),[j,E]=S.useState(navigator.onLine),k=t.theme.className.includes("dark");S.useEffect(()=>{const I=()=>E(!0),P=()=>E(!1);return window.addEventListener("online",I),window.addEventListener("offline",P),()=>{window.removeEventListener("online",I),window.removeEventListener("offline",P)}},[]);const C=()=>{const I=t.theme.id.includes("glass");let P;k?P=I?"light-glass":"light-formal":P=I?"dark-glass":"dark-formal";const D=Xc.find(U=>U.id===P);D&&s({...t,theme:D})},A=()=>{l(),c("/login")},M=I=>{x(!1);try{const P=JSON.parse(I);if(P.t&&P.id){const D=P.t==="m"?"module":"batch";b({type:D,id:P.id}),_(!0)}else alert(a("invalidQRCode"))}catch{alert(a("invalidQRCode"))}};return S.useEffect(()=>{const I=P=>{h.current&&!h.current.contains(P.target)&&f(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]),n.jsxs(n.Fragment,{children:[n.jsxs("header",{className:"bg-white/70 dark:bg-black/40 backdrop-blur-md shadow-sm p-2 sm:p-4 flex items-center justify-between sticky top-0 z-40 border-b border-white/20 dark:border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center min-w-0",children:[" ",n.jsx("button",{onClick:e,className:"p-2 -ml-2 mr-2 rounded-md text-gray-600 dark:text-gray-300 md:hidden hover:bg-gray-200 dark:hover:bg-gray-700",children:n.jsx(te,{name:"Menu",className:"w-6 h-6"})}),n.jsx("img",{src:t.company.logoUrl,alt:"Company Logo",className:"h-8 sm:h-10 mr-3 sm:mr-4 flex-shrink-0"}),n.jsx("h1",{className:"hidden sm:block text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 truncate",children:t.company.name})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:`flex items-center px-2 py-1 rounded-full text-xs font-medium ${j?"bg-green-100/80 text-green-800":"bg-red-100/80 text-red-800"}`,children:[n.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${j?"bg-green-500":"bg-red-500"}`}),j?"Online":"Offline"]}),n.jsxs(se,{variant:"secondary",onClick:()=>x(!0),className:"hidden sm:flex !py-1.5 !px-3",children:[n.jsx(te,{name:"QrCode",className:"w-5 h-5 mr-1"}),a("scan")]}),n.jsx(se,{variant:"ghost",onClick:()=>x(!0),className:"sm:hidden p-2 !rounded-full",children:n.jsx(te,{name:"QrCode",className:"w-6 h-6"})}),n.jsx(fC,{}),n.jsx(se,{variant:"ghost",onClick:C,className:"p-2 !rounded-full","aria-label":a("toggleTheme"),children:n.jsx(te,{name:k?"Sun":"Moon",className:"w-6 h-6"})}),i&&n.jsxs("div",{className:"relative",ref:h,children:[n.jsxs("button",{onClick:()=>f(!u),className:"flex items-center gap-2 p-1 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors",children:[n.jsxs("span",{className:"font-semibold hidden sm:inline text-gray-700 dark:text-gray-200",children:[i.firstName," ",i.lastName]}),n.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm",children:[i.firstName.charAt(0),i.lastName.charAt(0)]})]}),u&&n.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-xl z-50 p-1",children:[n.jsxs("button",{onClick:()=>{f(!1),c("/profile")},className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"User",className:"w-4 h-4"}),a("profile")]}),n.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),n.jsxs("button",{onClick:A,className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"LogOut",className:"w-4 h-4"}),a("logout")]})]})]})]})]}),n.jsx(mC,{isOpen:m,onClose:()=>x(!1),onScan:M}),n.jsx(pC,{isOpen:T,onClose:()=>_(!1),scannedData:y})]})},yC=()=>{const{settings:e}=Ke(),[t,s]=S.useState(!0);return n.jsxs("div",{className:`${e.theme.className} ${e.theme.font} min-h-screen flex transition-colors duration-500 relative bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center bg-fixed text-gray-800 dark:text-gray-200`,children:[n.jsx("div",{className:"absolute inset-0 bg-gray-100/80 dark:bg-black/70 backdrop-blur-sm z-0 pointer-events-none"}),n.jsxs("div",{className:"flex flex-1 z-10 relative h-full",children:[t&&n.jsx("div",{onClick:()=>s(!1),className:"fixed inset-0 bg-black/50 z-40 md:hidden"}),n.jsx(hC,{isOpen:t,setOpen:s}),n.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${t?"md:ml-64":"md:ml-16"}`,children:[n.jsx(gC,{onMenuClick:()=>s(a=>!a)}),n.jsx("main",{className:"p-4 sm:p-6 overflow-y-auto flex-grow scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent",children:n.jsx(Wv,{})})]})]})]})},ha=({permission:e})=>{const{currentUser:t,can:s}=Rs();return t?e&&!s(e)?n.jsx(Ho,{to:"/dashboard",replace:!0}):n.jsx(Wv,{}):n.jsx(Ho,{to:"/login",replace:!0})},xC=()=>{const{t:e}=we(),{settings:t}=Ke(),s=Ds(),{login:a}=Rs(),[i,l]=S.useState("admin@seafarm.com"),[c,u]=S.useState("password"),[f,h]=S.useState(""),[m,x]=S.useState(!1),y=async b=>{b.preventDefault(),h(""),x(!0),await a(i,c)?s("/dashboard"):(h(e("invalidCredentials")),x(!1))};return n.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),n.jsxs("div",{className:"w-full max-w-4xl z-10 grid grid-cols-1 md:grid-cols-2 rounded-2xl overflow-hidden shadow-2xl border border-gray-700",children:[n.jsxs("div",{className:"hidden md:flex flex-col justify-center items-center p-8 bg-gradient-to-br from-blue-900/80 to-black/80 text-white relative",children:[n.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-20 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.5),transparent_70%)]"}),n.jsx("h1",{className:"text-4xl font-bold mb-4 relative z-10",children:e("welcomeBack")}),n.jsx("p",{className:"text-center text-gray-300 relative z-10",children:"Efficiently manage your seaweed farm operations, inventory, and payments in one place."}),n.jsxs("div",{className:"mt-8 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 text-sm text-gray-300 relative z-10",children:[n.jsx("p",{className:"font-semibold text-blue-400 mb-1",children:"Default Access:"}),n.jsx("p",{children:"Email: admin@seafarm.com"}),n.jsx("p",{children:"Pass: password"})]})]}),n.jsxs("div",{className:"p-8 md:p-12 bg-black/80 backdrop-blur-md flex flex-col justify-center",children:[n.jsx("div",{className:"flex justify-center mb-8",children:t.company.logoUrl?n.jsx("img",{src:t.company.logoUrl,alt:"Logo",className:"h-16 object-contain drop-shadow-lg"}):n.jsx("div",{className:"h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:n.jsx(te,{name:"Activity",className:"w-8 h-8 text-white"})})}),n.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-2",children:"Login"}),n.jsx("p",{className:"text-gray-400 text-center mb-8",children:"Enter your credentials to access your account"}),n.jsxs("form",{onSubmit:y,className:"space-y-6",children:[f&&n.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center",children:f}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-sm font-medium text-gray-300",children:e("email")}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n.jsx(te,{name:"User",className:"h-5 w-5 text-gray-500"})}),n.jsx("input",{type:"email",value:i,onChange:b=>l(b.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:"name@company.com"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-sm font-medium text-gray-300",children:e("password")}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n.jsx(te,{name:"Lock",className:"h-5 w-5 text-gray-500"})}),n.jsx("input",{type:"password",value:c,onChange:b=>u(b.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:""})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-sm",children:[n.jsxs("label",{className:"flex items-center text-gray-400 cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 bg-gray-800 border-gray-600 rounded"}),n.jsx("span",{className:"ml-2",children:"Remember me"})]}),n.jsx(bs,{to:"/forgot-password",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:e("forgotPassword")})]}),n.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 px-4 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold rounded-lg shadow-lg transform transition-all hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center",children:m?n.jsx(te,{name:"Activity",className:"animate-spin h-5 w-5"}):"Login"})]}),n.jsxs("div",{className:"mt-6 flex flex-col gap-2 text-center text-sm text-gray-400",children:[n.jsxs("p",{children:["Don't have an account?"," ",n.jsx(bs,{to:"/signup",className:"text-blue-400 hover:text-blue-300 font-bold transition-colors",children:"Sign Up"})]}),n.jsx(bs,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline mt-2",children:e("termsOfUse")})]})]})]})]})},vC="pk_test_TYooMQauvdEDq54NiTphI7jx",bC=({amount:e,currency:t,onSuccess:s,onProcessing:a,buttonText:i="Pay Now"})=>{const l=S.useRef(null),c=S.useRef(null),u=S.useRef(null),f=S.useRef(null),[h,m]=S.useState(null),[x,y]=S.useState(!1);S.useEffect(()=>{if(window.Stripe&&l.current&&!c.current)try{const T=window.Stripe(vC);c.current=T;const _=T.elements();u.current=_;const j={base:{color:"#ffffff",fontFamily:'"Segoe UI", "Roboto", "Helvetica Neue", sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#9ca3af"},backgroundColor:"transparent"},invalid:{color:"#ef4444",iconColor:"#ef4444"}},E=_.create("card",{style:j,hidePostalCode:!0});E.mount(l.current),f.current=E,E.on("change",k=>{y(k.complete),m(k.error?k.error.message:null)})}catch(T){console.error("Stripe initialization error:",T),m("Failed to load payment system.")}return()=>{f.current}},[]);const b=async T=>{if(T.preventDefault(),!c.current||!f.current)return;a(!0);const _=await c.current.createPaymentMethod({type:"card",card:f.current});_.error?(m(_.error.message),a(!1)):setTimeout(()=>{s(_.paymentMethod.id),a(!1)},1e3)};return n.jsxs("form",{onSubmit:b,className:"w-full",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-2",children:"Card Details (Secure via Stripe)"}),n.jsx("div",{ref:l,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent transition-all min-h-[46px]"}),h&&n.jsxs("div",{className:"mt-2 text-sm text-red-400 flex items-center",children:[n.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),h]})]}),n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-4",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(te,{name:"Lock",className:"w-3 h-3"})," SSL Secure Payment"]}),n.jsx("span",{children:"Powered by Stripe"})]}),n.jsxs("button",{type:"submit",disabled:!c.current||!x,className:"w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 rounded-lg font-bold shadow-lg transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsx(te,{name:"CreditCard",className:"w-4 h-4"})," ",i]})]})},NC=()=>{const{t:e}=we(),t=Ds(),{signup:s}=Rs(),[a,i]=S.useState("account"),[l,c]=S.useState(!1),[u,f]=S.useState(""),[h,m]=S.useState({firstName:"",lastName:"",email:"",password:"",organizationName:""}),[x,y]=S.useState("starter"),[b,T]=S.useState(""),_=[{id:"starter",name:"Starter Plan",price:20,limit:5,description:"Perfect for small farms getting started.",features:["Up to 5 Users","Basic Reporting","Map View","Inventory Management"]},{id:"pro",name:"Pro Plan",price:35,limit:10,description:"Advanced features for growing operations.",features:["Up to 10 Users","Advanced AI Analytics","Priority Support","Multiple Sites"]}],j=A=>{if(A.preventDefault(),h.password.length<6){f("Password must be at least 6 characters");return}f(""),i("plan")},E=A=>{y(A),i("payment")},k=async A=>{c(!0),f("");try{console.log("Payment Method ID received:",A),await s({firstName:h.firstName,lastName:h.lastName,email:h.email,password:h.password,organizationName:h.organizationName,planId:x,roleId:"SITE_MANAGER",paymentMethodId:A})?t("/dashboard"):(f(e("emailExists")),c(!1))}catch{f("Registration failed. Please try again."),c(!1)}},C=_.find(A=>A.id===x);return n.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center text-white",children:[n.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),n.jsxs("div",{className:"w-full max-w-5xl z-10 grid grid-cols-1 md:grid-cols-12 rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-black/40 backdrop-blur-xl min-h-[600px]",children:[n.jsxs("div",{className:"md:col-span-5 bg-gradient-to-b from-blue-900/90 to-black/90 p-8 flex flex-col justify-between relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-cyan-500/20 rounded-full filter blur-3xl -translate-y-1/2 translate-x-1/2"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Get Started"}),n.jsx("p",{className:"text-gray-300 text-sm",children:"Join the future of seaweed farming management."}),n.jsxs("div",{className:"mt-10 space-y-6",children:[n.jsxs("div",{className:`flex items-center gap-4 ${a==="account"?"opacity-100":"opacity-50"}`,children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${a==="account"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:"Account"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Your details & organization"})]})]}),n.jsxs("div",{className:`flex items-center gap-4 ${a==="plan"?"opacity-100":"opacity-50"}`,children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${a==="plan"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"2"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:"Plan"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Choose your capacity"})]})]}),n.jsxs("div",{className:`flex items-center gap-4 ${a==="payment"?"opacity-100":"opacity-50"}`,children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${a==="payment"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"3"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:"Payment"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Secure credit card checkout"})]})]})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 mt-8",children:[n.jsxs("div",{className:"text-xs text-gray-400",children:["Already have an account? ",n.jsx(bs,{to:"/login",className:"text-cyan-400 hover:underline",children:"Log In"})]}),n.jsx(bs,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline",children:e("termsOfUse")})]})]}),n.jsxs("div",{className:"md:col-span-7 p-8 md:p-12 flex flex-col justify-center relative",children:[u&&n.jsx("div",{className:"absolute top-4 left-8 right-8 p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center z-20",children:u}),a==="account"&&n.jsxs("form",{onSubmit:j,className:"space-y-5 animate-fade-in",children:[n.jsx("h2",{className:"text-2xl font-bold",children:"Create Account"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"First Name"}),n.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.firstName,onChange:A=>m({...h,firstName:A.target.value}),placeholder:"John"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Last Name"}),n.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.lastName,onChange:A=>m({...h,lastName:A.target.value}),placeholder:"Doe"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Email Address"}),n.jsx("input",{type:"email",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.email,onChange:A=>m({...h,email:A.target.value}),placeholder:"john@example.com"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Organization Name"}),n.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.organizationName,onChange:A=>m({...h,organizationName:A.target.value}),placeholder:"Ocean Harvest Ltd."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Password"}),n.jsx("input",{type:"password",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.password,onChange:A=>m({...h,password:A.target.value}),placeholder:""})]}),n.jsxs("div",{className:"text-xs text-gray-400",children:[e("agreeToTerms")," ",n.jsx(bs,{to:"/terms",className:"text-cyan-400 hover:underline",children:e("termsOfUse")})]}),n.jsx("button",{type:"submit",className:"w-full py-3 mt-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 rounded-lg font-bold shadow-lg transition-all",children:"Next: Select Plan"})]}),a==="plan"&&n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h2",{className:"text-2xl font-bold",children:"Select Plan"}),n.jsx("button",{onClick:()=>i("account"),className:"text-sm text-gray-400 hover:text-white",children:"Back"})]}),n.jsx("div",{className:"grid gap-4",children:_.map(A=>n.jsxs("div",{onClick:()=>E(A.id),className:`p-4 rounded-xl border-2 cursor-pointer transition-all flex justify-between items-center group
                                         ${x===A.id?"border-blue-500 bg-blue-900/20":"border-gray-700 bg-gray-800/30 hover:border-gray-500"}`,children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-lg text-white group-hover:text-blue-400 transition-colors",children:A.name}),n.jsx("p",{className:"text-sm text-gray-400",children:A.description}),n.jsx("ul",{className:"mt-2 text-xs text-gray-300 space-y-1",children:A.features.slice(0,2).map(M=>n.jsxs("li",{className:"flex items-center gap-1",children:[n.jsx(te,{name:"Check",className:"w-3 h-3 text-green-400"})," ",M]},M))})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",A.price,n.jsx("span",{className:"text-sm font-normal text-gray-400",children:"/mo"})]}),n.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Up to ",A.limit," users"]})]})]},A.id))})]}),a==="payment"&&n.jsxs("div",{className:"space-y-5 animate-fade-in",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("h2",{className:"text-2xl font-bold",children:"Secure Payment"}),n.jsx("button",{type:"button",onClick:()=>i("plan"),className:"text-sm text-gray-400 hover:text-white",children:"Change Plan"})]}),n.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg flex justify-between items-center mb-4",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-white",children:C==null?void 0:C.name}),n.jsx("p",{className:"text-xs text-gray-400",children:"Billed monthly"})]}),n.jsxs("p",{className:"text-xl font-bold text-white",children:["$",C==null?void 0:C.price]})]}),n.jsxs("div",{className:"space-y-1 mb-4",children:[n.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Cardholder Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(te,{name:"User",className:"absolute left-3 top-3.5 w-5 h-5 text-gray-500"}),n.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 pl-10 text-white focus:ring-2 focus:ring-blue-500 outline-none",value:b,onChange:A=>T(A.target.value),placeholder:"JOHN DOE"})]})]}),l?n.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[n.jsx(te,{name:"Activity",className:"w-10 h-10 text-blue-500 animate-spin"}),n.jsx("p",{className:"text-gray-300",children:"Processing Payment..."})]}):n.jsx(bC,{amount:(C==null?void 0:C.price)||20,currency:"USD",onSuccess:k,onProcessing:c,buttonText:`Pay $${C==null?void 0:C.price} & Join`})]})]})]})]})},de=({label:e,id:t,containerClassName:s="",error:a,type:i,className:l="",...c})=>{const{required:u}=c,f=a?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return n.jsxs("div",{className:`w-full ${s}`,children:[e&&n.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e,u&&n.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{id:t,type:i,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            placeholder-gray-400
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0 
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            ${f} 
            ${i==="date"?"pr-10":""}
            ${l}
          `,...c}),i==="date"&&n.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:n.jsx(te,{name:"Calendar",className:"w-5 h-5 text-gray-400"})})]}),a&&n.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:a})]})},SC=()=>{const{t:e}=we(),{settings:t}=Ke(),{sendPasswordResetLink:s}=Rs(),[a,i]=S.useState(""),[l,c]=S.useState(!1),[u,f]=S.useState(!1),[h,m]=S.useState(null),x=async y=>{y.preventDefault(),c(!0);const b=await s(a);m(b),c(!1),f(!0)};return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsx("div",{className:"flex justify-center mb-6",children:n.jsx("img",{src:t.company.logoUrl,alt:"Company Logo",className:"h-12"})}),n.jsx(Ge,{title:e("forgotPasswordTitle"),children:u?n.jsxs("div",{className:"text-center",children:[n.jsx("h3",{className:"text-lg font-semibold",children:e("resetLinkSentTitle")}),n.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:e("resetLinkSentInstructions")}),h&&n.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg text-left",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(te,{name:"Bot",className:"w-4 h-4 text-blue-600"}),n.jsx("p",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase",children:"Demo Email Simulator"})]}),n.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["In a production environment, the following link would be sent to ",n.jsx("strong",{children:a}),". For this demo, click the link below to proceed:"]}),n.jsx(bs,{to:h.substring(h.indexOf("#")+1),className:"text-sm font-medium text-blue-600 hover:text-blue-500 underline break-all",children:h})]}),n.jsx(bs,{to:"/login",children:n.jsx(se,{className:"w-full mt-6",children:e("backToLogin")})})]}):n.jsxs("form",{onSubmit:x,className:"space-y-6",children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e("forgotPasswordInstructions")}),n.jsx(de,{label:e("email"),id:"email",type:"email",value:a,onChange:y=>i(y.target.value),required:!0,autoComplete:"email",autoFocus:!0}),n.jsx(se,{type:"submit",className:"w-full",disabled:l||!a,children:l?n.jsx(te,{name:"Activity",className:"animate-spin"}):e("sendResetLink")}),n.jsx("p",{className:"mt-6 text-center text-sm",children:n.jsx(bs,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:e("backToLogin")})})]})})]})})},wC=()=>{const{t:e}=we(),{settings:t}=Ke(),s=Ds(),[a]=Kf(),{resetPassword:i}=Rs(),[l,c]=S.useState(""),[u,f]=S.useState(""),[h,m]=S.useState(""),[x,y]=S.useState(""),[b,T]=S.useState(!1),[_,j]=S.useState(null);S.useEffect(()=>{const k=a.get("token");k||m(e("invalidOrExpiredToken")),j(k)},[a,e]);const E=async k=>{if(k.preventDefault(),l!==u){m(e("passwordMismatch"));return}if(!_){m(e("invalidOrExpiredToken"));return}m(""),y(""),T(!0),await i(_,l)?(y(e("passwordResetSuccess")),setTimeout(()=>{s("/login")},3e3)):m(e("invalidOrExpiredToken")),T(!1)};return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsx("div",{className:"flex justify-center mb-6",children:n.jsx("img",{src:t.company.logoUrl,alt:"Company Logo",className:"h-12"})}),n.jsx(Ge,{title:e("resetPasswordTitle"),children:x?n.jsx("div",{className:"p-3 text-center bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-md text-sm",children:x}):n.jsxs("form",{onSubmit:E,className:"space-y-6",children:[h&&n.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-md text-sm",children:h}),n.jsx(de,{label:e("newPassword"),id:"password",type:"password",value:l,onChange:k=>c(k.target.value),required:!0,autoComplete:"new-password",autoFocus:!0,disabled:!_||b}),n.jsx(de,{label:e("confirmNewPassword"),id:"confirmPassword",type:"password",value:u,onChange:k=>f(k.target.value),required:!0,autoComplete:"new-password",disabled:!_||b}),n.jsx(se,{type:"submit",className:"w-full",disabled:b||!_||!l||!u,children:b?n.jsx(te,{name:"Activity",className:"animate-spin"}):e("resetPassword")})]})})]})})};function wb(e,t){if(isNaN(e)||e===null)return"";const s=Math.abs(e),a=Math.floor(s),i=(s-a)*60,l=Math.floor(i),c=((i-l)*60).toFixed(2);let u="";return t?u=e>=0?"N":"S":u=e>=0?"E":"W",`${a} ${l}' ${c}" ${u}`}function mn(e){if(!e)throw new Error("Empty input");const t=e.trim();if(/^-?\d+(\.\d+)?$/.test(t)){const h=parseFloat(t);if(!isNaN(h))return h}const s=/(-?\d+(\.\d+)?)\s*(?:\s*(\d+(\.\d+)?)\s*')?(?:\s*(\d+(\.\d+)?)\s*")?\s*([NSEW])/i,a=t.match(s);if(!a){const h=t.match(/(-?\d+(\.\d+)?)\s*([NSEW])/i);if(h){const m=parseFloat(h[1]),x=h[3].toUpperCase();return(x==="S"||x==="W")&&m>0?-m:m}throw new Error(`Invalid coordinate format: "${e}"`)}const i=parseFloat(a[1]),l=parseFloat(a[3]||"0"),c=parseFloat(a[5]||"0"),u=a[7].toUpperCase();if(isNaN(i)||l<0||c<0)throw new Error(`Invalid numbers in DMS string: "${e}"`);let f=Math.abs(i)+l/60+c/3600;if((u==="S"||u==="W")&&(f=f*-1),(u==="N"||u==="S")&&Math.abs(f)>90)throw new Error(`Latitude out of range (-90 to 90): "${e}"`);if((u==="E"||u==="W")&&Math.abs(f)>180)throw new Error(`Longitude out of range (-180 to 180): "${e}"`);return f}function Nf(e){const t=[];for(const s of e)if(!(!s||!s.trim()))try{const a=s.split(",");if(a.length!==2)throw new Error("Invalid geo-point format, expected 'lat, lon'");const i=a[0].trim(),l=a[1].trim();if(!i||!l)continue;const c=mn(i),u=mn(l);t.push({x:u,y:c})}catch{}return t}function $x(e,t,s){if(!e)return"";let a;try{a=mn(e)}catch{return e}return t==="DD"?a.toFixed(6):wb(a,s)}function pd(e,t,s){if(e<=0||t<=0||s<=0)return null;const a=(Math.log(t)-Math.log(e))/s*100;return parseFloat(a.toFixed(2))}const TC=()=>{const e=S.useRef(null),t=S.useRef(null),{cultivationCycles:s}=He(),{settings:a}=Ke(),{t:i,language:l}=we(),c=S.useMemo(()=>{const u=[],f=[],h=new Date;for(let m=5;m>=0;m--){const x=new Date(h.getFullYear(),h.getMonth()-m,1);u.push(x.toLocaleDateString(l,{month:"short",year:"2-digit"})),f.push(0)}return s.forEach(m=>{if(m.harvestDate&&m.harvestedWeight){const x=new Date(m.harvestDate),y=(h.getFullYear()-x.getFullYear())*12+(h.getMonth()-x.getMonth());if(y>=0&&y<6){const b=(m.harvestedWeight||0)-(m.cuttingsTakenAtHarvestKg||0);f[5-y]+=b}}}),{labels:u,data:f}},[s,l]);return S.useEffect(()=>{if(!e.current)return;const u=a.theme.className.includes("dark"),f=u?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=u?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";t.current&&t.current.destroy();const m=e.current.getContext("2d");m&&window.Chart&&(t.current=new window.Chart(m,{type:"line",data:{labels:c.labels,datasets:[{label:i("netHarvestedWeightKg"),data:c.data,fill:!0,backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgba(59, 130, 246, 1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,a.theme,i]),n.jsx("div",{className:"w-full h-64",children:n.jsx("canvas",{ref:e})})},jC=()=>{const e=S.useRef(null),t=S.useRef(null),{cultivationCycles:s,seaweedTypes:a}=He(),{settings:i}=Ke(),{t:l}=we(),c=S.useMemo(()=>{const u={};s.forEach(h=>{if(h.harvestDate&&h.harvestedWeight&&h.initialWeight&&h.plantingDate){const m=(new Date(h.harvestDate).getTime()-new Date(h.plantingDate).getTime())/864e5,x=pd(h.initialWeight,h.harvestedWeight,m);x!==null&&(u[h.seaweedTypeId]||(u[h.seaweedTypeId]={sgrSum:0,count:0}),u[h.seaweedTypeId].sgrSum+=x,u[h.seaweedTypeId].count++)}});const f=new Map(a.map(h=>[h.id,h.name]));return Object.entries(u).map(([h,{sgrSum:m,count:x}])=>({label:f.get(h)||l("unknown"),avgSGR:m/x}))},[s,a,l]);return S.useEffect(()=>{if(!e.current)return;const u=i.theme.className.includes("dark"),f=u?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=u?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";t.current&&t.current.destroy();const m=e.current.getContext("2d");m&&window.Chart&&(t.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("growthRate")+" (%)",data:c.map(x=>x.avgSGR),backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"% / day",color:f},ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),n.jsx("div",{className:"w-full h-64",children:n.jsx("canvas",{ref:e})})},Hx=()=>{const e=S.useRef(null),t=S.useRef(null),{sites:s,modules:a,cultivationCycles:i}=He(),{t:l}=we(),c=S.useMemo(()=>{const u=new Map;return i.forEach(f=>{if(f.harvestedWeight){const h=a.find(m=>m.id===f.moduleId);if(h){const m=(f.harvestedWeight||0)-(f.cuttingsTakenAtHarvestKg||0);u.set(h.siteId,(u.get(h.siteId)||0)+m)}}}),u},[i,a]);return S.useEffect(()=>{e.current&&!t.current&&(t.current=L.map(e.current,{center:[-18.76,46.86],zoom:6,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(t.current));const u=t.current;if(!u)return;setTimeout(()=>{u.invalidateSize()},100),u.eachLayer(h=>{(h instanceof L.Marker||h instanceof L.CircleMarker)&&u.removeLayer(h)});const f=Math.max(...Array.from(c.values()),1);s.forEach(h=>{if(h.location)try{const[m,x]=h.location.split(","),y=mn(m.trim()),b=mn(x.trim()),T=c.get(h.id)||0,_=5+T/f*20;L.circleMarker([y,b],{radius:_,fillColor:"#2563eb",color:"#1d4ed8",weight:1,opacity:1,fillOpacity:.6}).addTo(u).bindPopup(`<b>${h.name}</b><br>${l("netProduction")}: ${T.toFixed(0)} kg`)}catch{console.debug("Site without valid coordinates:",h.name,h.location)}})},[s,c,l]),n.jsx("div",{ref:e,className:"w-full h-full min-h-[600px] rounded-lg z-0"})},_C=()=>{const{farmers:e,cultivationCycles:t,modules:s}=He(),{t:a}=we(),i=S.useMemo(()=>{const j={};return t.forEach(E=>{if(E.harvestedWeight){const k=s.find(C=>C.id===E.moduleId);if(k!=null&&k.farmerId){j[k.farmerId]||(j[k.farmerId]={yield:0,cycles:0});const C=(E.harvestedWeight||0)-(E.cuttingsTakenAtHarvestKg||0);j[k.farmerId].yield+=C,j[k.farmerId].cycles++}}}),Object.entries(j).map(([E,k])=>{const C=e.find(A=>A.id===E);return{name:C?`${C.firstName} ${C.lastName}`:a("unknown"),yield:k.yield,cycles:k.cycles}})},[e,t,s,a]);if(i.length===0)return n.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:a("noDataForReport")});const l=window.Recharts;if(!l)return n.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Loading chart library..."});const{ResponsiveContainer:c,BubbleChart:u,XAxis:f,YAxis:h,ZAxis:m,Tooltip:x,CartesianGrid:y,Legend:b,Bubble:T}=l,_=({active:j,payload:E,label:k})=>{if(j&&E&&E.length){const C=E[0].payload;return n.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded shadow-lg text-xs z-50",children:[n.jsx("p",{className:"font-bold text-gray-900 dark:text-white mb-1",children:C.name}),n.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[a("totalYield"),": ",n.jsxs("span",{className:"font-semibold",children:[C.yield.toFixed(1)," kg"]})]}),n.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[a("numberOfCyclesAxis"),": ",n.jsx("span",{className:"font-semibold",children:C.cycles})]})]})}return null};return n.jsx("div",{className:"w-full h-64",children:n.jsx(c,{width:"100%",height:"100%",children:n.jsxs(u,{data:i,children:[n.jsx(y,{strokeDasharray:"3 3"}),n.jsx(f,{dataKey:"yield",name:a("totalYieldKgAxis"),type:"number"}),n.jsx(h,{dataKey:"cycles",name:a("numberOfCyclesAxis"),type:"number"}),n.jsx(m,{dataKey:"yield",range:[10,100],name:a("totalYield")}),n.jsx(x,{content:n.jsx(_,{}),cursor:{strokeDasharray:"3 3"}}),n.jsx(b,{}),n.jsx(T,{name:`${a("totalYield")} (${a("netWeight")})`,dataKey:"yield",fill:"#8884d8"})]})})})},EC=()=>{const e=S.useRef(null),t=S.useRef(null),{cultivationCycles:s,seaweedTypes:a}=He(),{settings:i}=Ke(),{t:l}=we(),c=S.useMemo(()=>{const u={};s.forEach(h=>{if(h.harvestedWeight){u[h.seaweedTypeId]||(u[h.seaweedTypeId]={yield:0,count:0});const m=(h.harvestedWeight||0)-(h.cuttingsTakenAtHarvestKg||0);u[h.seaweedTypeId].yield+=m,u[h.seaweedTypeId].count++}});const f=new Map(a.map(h=>[h.id,h.name]));return Object.entries(u).map(([h,{yield:m,count:x}])=>({label:f.get(h)||l("unknown"),avgYield:m/x}))},[s,a,l]);return S.useEffect(()=>{if(!e.current)return;const u=i.theme.className.includes("dark"),f=u?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=u?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";t.current&&t.current.destroy();const m=e.current.getContext("2d");m&&window.Chart&&(t.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("averageYieldKg"),data:c.map(x=>x.avgYield),backgroundColor:"rgba(139, 92, 246, 0.6)",borderColor:"rgba(139, 92, 246, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),n.jsx("div",{className:"w-full h-64",children:n.jsx("canvas",{ref:e})})},CC=()=>{const{t:e}=we(),{incidents:t,incidentTypes:s}=He(),a=Ds(),i=S.useMemo(()=>[...t].sort((c,u)=>new Date(u.date).getTime()-new Date(c.date).getTime()).slice(0,5),[t]),l=S.useMemo(()=>new Map(s.map(c=>[c.id,c.name])),[s]);return n.jsxs("div",{className:"space-y-3 h-full overflow-y-auto",children:[i.map(c=>n.jsxs("div",{className:"flex items-start gap-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-900/50 cursor-pointer",onClick:()=>a("/monitoring/incidents"),children:[n.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 mt-1 flex-shrink-0"}),n.jsxs("div",{className:"flex-grow",children:[n.jsx("p",{className:"font-semibold text-sm",children:l.get(c.type)||c.type}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c.date})]}),n.jsx(vn,{status:c.status})]},c.id)),i.length===0&&n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsx("p",{className:"text-gray-500",children:e("noIncidents")})})]})},IC=()=>{const{t:e}=we();return n.jsxs("div",{className:"flex justify-between items-center h-full px-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Sun",className:"w-12 h-12 text-yellow-400 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold",children:"28C"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Sunny"})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Wind: 12 km/h NE"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Humidity: 65%"})]})]})},AC=()=>{const{t:e}=we(),t=Ds(),[s,a]=S.useState("director");return n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl lg:text-4xl font-bold tracking-tight text-gray-900 dark:text-white",children:e("analyticalDashboard")}),n.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 p-1 rounded-lg flex",children:[n.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="director"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>a("director"),children:"Director"}),n.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s==="field"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>a("field"),children:"Field"})]})]}),s==="director"?n.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[n.jsx(Ge,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:e("productionTrend"),children:n.jsx(TC,{})}),n.jsx(Ge,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:e("growthRate"),children:n.jsx(jC,{})}),n.jsx(Ge,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:e("yieldBySeaweedType"),children:n.jsx(EC,{})}),n.jsx(Ge,{className:"col-span-12 md:col-span-6 lg:col-span-6 row-span-2",title:e("sitePerformance"),children:n.jsx(Hx,{})}),n.jsx(Ge,{className:"col-span-12 md:col-span-6 lg:col-span-6",title:e("farmerSegmentation"),children:n.jsx(_C,{})})]}):n.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[n.jsx(Ge,{className:"col-span-12 lg:col-span-8 row-span-2 p-0 overflow-hidden",title:e("farmMapTitle"),children:n.jsx(Hx,{})}),n.jsx(Ge,{className:"col-span-12 lg:col-span-4 h-48",title:"Current Weather",children:n.jsx(IC,{})}),n.jsx(Ge,{className:"col-span-12 lg:col-span-4 flex-grow flex flex-col",title:e("recentIncidents"),children:n.jsx(CC,{})}),n.jsx(Ge,{className:"col-span-12",title:"Quick Actions",children:n.jsxs("div",{className:"flex gap-4",children:[n.jsxs(se,{className:"flex-1 py-8 flex-col gap-2",onClick:()=>t("/monitoring/incidents"),children:[n.jsx(te,{name:"PlusCircle",className:"w-8 h-8"}),e("reportIncident")]}),n.jsxs(se,{className:"flex-1 py-8 flex-col gap-2",variant:"secondary",onClick:()=>t("/harvesting"),children:[n.jsx(te,{name:"Scissors",className:"w-8 h-8"}),e("harvest")]})]})})]})]})},ke=({label:e,id:t,containerClassName:s="",children:a,error:i,className:l="",...c})=>{const u=i?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return n.jsxs("div",{className:`w-full ${s}`,children:[e&&n.jsx("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e}),n.jsxs("div",{className:"relative",children:[n.jsx("select",{id:t,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            appearance-none pr-8
            ${u}
            ${l}
          `,...c,children:a}),n.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-gray-500"})})]}),i&&n.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},_t=S.forwardRef(({className:e="",...t},s)=>n.jsx("input",{ref:s,type:"checkbox",className:`
        h-4 w-4 rounded 
        border-gray-300 dark:border-gray-600 
        text-blue-600 focus:ring-blue-500 
        bg-white dark:bg-gray-700 
        cursor-pointer 
        transition-all duration-200 
        focus:ring-offset-2 dark:focus:ring-offset-gray-900
        ${e}
      `,...t}));_t.displayName="Checkbox";const zt=({isOpen:e,onClose:t,onConfirm:s,title:a,message:i,confirmText:l,cancelText:c,confirmDisabled:u=!1})=>{const{t:f}=we(),h=n.jsx(n.Fragment,{children:u?n.jsx(se,{variant:"secondary",onClick:t,children:f("close")}):n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:c||f("cancel")}),n.jsx(se,{variant:"danger",onClick:s,children:l||f("delete")})]})});return n.jsx(ot,{isOpen:e,onClose:t,title:a,widthClass:"max-w-md",footer:h,children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-red-100 dark:bg-red-900/50 mr-4",children:n.jsx(te,{name:"AlertTriangle",className:"h-6 w-6 text-red-600 dark:text-red-400"})}),n.jsx("div",{children:n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i})})]})})},Tb=(e,t)=>t===""?e:e.replace(/\B(?=(\d{3})+(?!\d))/g,t),Ae=(e,t)=>{const{currencySymbol:s,thousandsSeparator:a,decimalSeparator:i,monetaryDecimals:l}=t;(isNaN(e)||e===null)&&(e=0);const c=e.toFixed(l),[u,f]=c.split("."),h=Tb(u,a),m=f!==void 0?`${h}${i}${f}`:h;return`${s} ${m}`},Fe=(e,t)=>{const{thousandsSeparator:s,decimalSeparator:a,nonMonetaryDecimals:i}=t;(isNaN(e)||e===null)&&(e=0);const l=e.toFixed(i),[c,u]=l.split("."),f=Tb(c,s);return u!==void 0?`${f}${a}${u}`:f},Sf=(e,t)=>{const{decimalSeparator:s,thousandsSeparator:a}=t,c=e.replace(new RegExp(`\\${a}`,"g"),"").replace(new RegExp(`\\${s}`,"g"),".").replace(/[^0-9.-]/g,""),u=parseFloat(c);return isNaN(u)?0:u},kC=()=>{const{settings:e,updateSettings:t}=Ke(),{t:s}=we(),{clearAllData:a}=He(),[i,l]=S.useState(e),[c,u]=S.useState({}),f=S.useRef(null),[h,m]=S.useState(!1),x=S.useCallback(I=>{const P={},{company:D,localization:U}=I;return D.name.trim()||(P.companyName=s("validationRequired")),D.phone.trim()||(P.companyPhone=s("validationRequired")),D.nif.trim()||(P.companyNif=s("validationRequired")),D.rc.trim()||(P.companyRc=s("validationRequired")),D.stat.trim()||(P.companyStat=s("validationRequired")),D.email.trim()?/\S+@\S+\.\S+/.test(D.email)||(P.companyEmail=s("validationEmail")):P.companyEmail=s("validationRequired"),(isNaN(D.capital)||D.capital<=0)&&(P.companyCapital=s("validationPositiveNumber")),(isNaN(U.monetaryDecimals)||U.monetaryDecimals<0)&&(P.monetaryDecimals=s("validationNonNegative")),(isNaN(U.nonMonetaryDecimals)||U.nonMonetaryDecimals<0)&&(P.nonMonetaryDecimals=s("validationNonNegative")),P},[s]);S.useEffect(()=>{const I=x(i);u(I)},[i,x]);const y=(I,P,D)=>{l(U=>{const O={...U,[I]:{...U[I],[P]:D}};return(I==="localization"&&(P==="thousandsSeparator"||P==="decimalSeparator"||P==="monetaryDecimals"||P==="nonMonetaryDecimals"||P==="coordinateFormat")||I==="company"&&P==="capital")&&t(O),O})},b=I=>{const P=Jt.find(D=>D.code===I);P&&l(D=>{const U={...D,localization:{...D.localization,country:P.code,currency:P.currency,currencySymbol:P.symbol,thousandsSeparator:P.thousandsSeparator,decimalSeparator:P.decimalSeparator,denominations:P.denominations.map(O=>({id:`d-${O.value}-${O.type}`,...O}))}};return t(U),U})},T=()=>{Object.keys(c).length===0&&(t(i),alert(s("configurationSaved")))};S.useEffect(()=>{l(e)},[e]);const _=S.useMemo(()=>{const I=Jt.find(P=>P.code===i.localization.country);return(I==null?void 0:I.denominations)||[]},[i.localization.country]),j=(I,P,D)=>{let U=[...i.localization.denominations];D?U.some(O=>O.value===I&&O.type===P)||U.push({id:`d-${I}-${P}`,value:I,type:P}):U=U.filter(O=>!(O.value===I&&O.type===P)),U.sort((O,F)=>O.value-F.value),y("localization","denominations",U)},E=()=>{var I;(I=f.current)==null||I.click()},k=I=>{var D;const P=(D=I.target.files)==null?void 0:D[0];if(P){const U=new FileReader;U.onloadend=()=>{y("company","logoUrl",U.result)},U.readAsDataURL(P)}},C=()=>{y("company","logoUrl","")},A=()=>{a(),alert(s("dataResetSuccess")),m(!1)},M=Object.keys(c).length>0;return n.jsxs("div",{className:"pb-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:s("settingsTitle")}),n.jsx(se,{onClick:T,disabled:M,children:s("saveConfiguration")})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsx(Ge,{title:s("companySection"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx(de,{label:s("companyName"),value:i.company.name,onChange:I=>y("company","name",I.target.value),error:c.companyName}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx(de,{label:s("email"),type:"email",value:i.company.email,onChange:I=>y("company","email",I.target.value),error:c.companyEmail}),n.jsx(de,{label:s("phone"),value:i.company.phone,onChange:I=>y("company","phone",I.target.value),error:c.companyPhone})]}),n.jsx(de,{label:s("address"),value:i.company.address,onChange:I=>y("company","address",I.target.value)}),n.jsx(de,{label:s("capital"),type:"text",value:Ae(i.company.capital,i.localization),onChange:I=>y("company","capital",Sf(I.target.value,i.localization)),error:c.companyCapital})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[n.jsx("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Legal Identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[n.jsx(de,{label:s("nif"),value:i.company.nif,onChange:I=>y("company","nif",I.target.value),error:c.companyNif}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(de,{label:s("rc"),value:i.company.rc,onChange:I=>y("company","rc",I.target.value),error:c.companyRc}),n.jsx(de,{label:s("stat"),value:i.company.stat,onChange:I=>y("company","stat",I.target.value),error:c.companyStat})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("logo")}),n.jsxs("div",{className:"flex items-center gap-4 p-3 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/30",children:[n.jsx("div",{className:"w-24 h-24 bg-white dark:bg-gray-700 rounded-md flex items-center justify-center border shadow-sm overflow-hidden",children:i.company.logoUrl?n.jsx("img",{src:i.company.logoUrl,alt:s("logoPreview"),className:"w-full h-full object-contain p-1"}):n.jsx(te,{name:"Image",className:"w-10 h-10 text-gray-300"})}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs(se,{type:"button",variant:"secondary",onClick:E,className:"text-sm",children:[n.jsx(te,{name:"Image",className:"w-4 h-4 mr-2"}),s("changeLogo")]}),i.company.logoUrl&&n.jsxs(se,{type:"button",variant:"ghost",onClick:C,className:"text-sm text-red-600 hover:text-red-700 hover:bg-red-50",children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),s("removeLogo")]}),n.jsx("input",{type:"file",ref:f,onChange:k,className:"hidden",accept:"image/png, image/jpeg, image/svg+xml"})]})]})]})]})]})}),n.jsx(Ge,{title:s("localizationSection"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsx(ke,{label:s("country"),value:i.localization.country,onChange:I=>b(I.target.value),children:Jt.map(I=>n.jsx("option",{value:I.code,children:I.name},I.code))}),n.jsx(de,{label:s("currencyFormat"),value:`${i.localization.currency} (${i.localization.currencySymbol})`,disabled:!0}),n.jsxs(ke,{label:s("coordinateFormat"),value:i.localization.coordinateFormat,onChange:I=>y("localization","coordinateFormat",I.target.value),children:[n.jsx("option",{value:"DMS",children:s("coordinateFormat_DMS")}),n.jsx("option",{value:"DD",children:s("coordinateFormat_DD")})]}),n.jsxs(ke,{label:s("thousandsSeparator"),value:i.localization.thousandsSeparator,onChange:I=>y("localization","thousandsSeparator",I.target.value),children:[n.jsx("option",{value:",",children:s("separator_comma")}),n.jsx("option",{value:".",children:s("separator_dot")}),n.jsx("option",{value:" ",children:s("separator_space")})]}),n.jsxs(ke,{label:s("decimalSeparator"),value:i.localization.decimalSeparator,onChange:I=>y("localization","decimalSeparator",I.target.value),children:[n.jsx("option",{value:".",children:s("separator_dot")}),n.jsx("option",{value:",",children:s("separator_comma")})]}),n.jsx(de,{label:s("monetaryDecimals"),type:"number",value:i.localization.monetaryDecimals,onChange:I=>y("localization","monetaryDecimals",parseInt(I.target.value)),error:c.monetaryDecimals})]})}),n.jsxs(Ge,{title:s("denominationsSection"),children:[n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:s("denominationsDescriptionNew")}),_.length>0?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:s("coins")}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:_.filter(I=>I.type==="coin").map(I=>n.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[n.jsx(_t,{checked:i.localization.denominations.some(P=>P.value===I.value&&P.type===I.type),onChange:P=>j(I.value,I.type,P.target.checked)}),n.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(I.value,i.localization)})]},`${I.type}-${I.value}`))})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:s("banknotes")}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:_.filter(I=>I.type==="banknote").map(I=>n.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[n.jsx(_t,{checked:i.localization.denominations.some(P=>P.value===I.value&&P.type===I.type),onChange:P=>j(I.value,I.type,P.target.checked)}),n.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(I.value,i.localization)})]},`${I.type}-${I.value}`))})]})]}):n.jsx("p",{className:"text-gray-500 italic",children:s("noDenominationsForCountry")})]}),n.jsx(Ge,{title:s("interfaceSection"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs(ke,{label:s("language"),value:i.language,onChange:I=>{const P=I.target.value;t({...i,language:P})},children:[n.jsx("option",{value:Yc.EN,children:s("language_en")}),n.jsx("option",{value:Yc.FR,children:s("language_fr")})]}),n.jsx(ke,{label:s("visualAppearance"),value:i.theme.id,onChange:I=>{const P=Xc.find(D=>D.id===I.target.value);P&&t({...i,theme:P})},children:Xc.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))})]})}),n.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[n.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800 dark:text-gray-100",children:s("dataManagementSection")}),n.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 rounded-lg p-4 flex items-start justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-1",children:s("resetData")}),n.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s("resetDataWarning")})]}),n.jsxs(se,{variant:"danger",onClick:()=>m(!0),className:"ml-4",children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),s("resetData")]})]})]}),h&&n.jsx(zt,{isOpen:h,onClose:()=>m(!1),onConfirm:A,title:s("confirmDeleteTitle"),message:s("confirmResetData"),confirmText:s("delete")})]})]})},DC=e=>{if(!e||!e.trim())return{deg:"",min:"",sec:"",dir:""};const t=/(-?\d+(?:\.\d+)?)\s*(?:\s*(\d+(?:\.\d+)?)\s*')?(?:\s*(\d+(?:\.\d+)?)\s*")?\s*([NSEW])?/i,s=e.trim().match(t);if(!s){const a=e.trim().match(/(-?\d+(?:\.\d+)?)\s*([NSEW])?/i);return a?{deg:a[1]||"",min:"",sec:"",dir:(a[2]||"").toUpperCase()}:{deg:e,min:"",sec:"",dir:""}}return{deg:s[1]||"",min:s[2]||"",sec:s[3]||"",dir:(s[4]||"").toUpperCase()}},RC=({label:e,value:t,onChange:s,directions:a,error:i})=>{const l=S.useMemo(()=>{const u=DC(t),f=a.includes(u.dir)?u.dir:a[0];return{...u,dir:f}},[t,a]),c=S.useCallback((u,f)=>{const h={deg:l.deg,min:l.min,sec:l.sec,dir:l.dir,[u]:f},{deg:m,min:x,sec:y,dir:b}=h;if(!m.trim()&&!x.trim()&&!y.trim()){s("");return}const T=`${m} ${x}' ${y}" ${b}`;s(T)},[l,s]);return n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e}),n.jsxs("div",{className:"flex items-start gap-1",children:[n.jsx(de,{type:"number",value:l.deg,onChange:u=>c("deg",u.target.value),placeholder:"","aria-label":`${e} degrees`,containerClassName:"min-w-0",min:"-180",max:"180"}),n.jsx(de,{type:"number",value:l.min,onChange:u=>c("min",u.target.value),placeholder:"'","aria-label":`${e} minutes`,containerClassName:"min-w-0",min:"0",max:"59"}),n.jsx(de,{type:"number",step:"any",value:l.sec,onChange:u=>c("sec",u.target.value),placeholder:'"',"aria-label":`${e} seconds`,containerClassName:"min-w-0",min:"0",max:"59.999"}),n.jsxs(ke,{value:l.dir,onChange:u=>c("dir",u.target.value),"aria-label":`${e} direction`,containerClassName:"min-w-fit",children:[n.jsx("option",{value:a[0],children:a[0]}),n.jsx("option",{value:a[1],children:a[1]})]})]}),i&&n.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},Si=({label:e,value:t,onChange:s,axis:a,error:i})=>{const{settings:l}=Ke(),{t:c}=we(),u=l.localization.coordinateFormat,f=a==="lat",[h,m]=S.useState(t);S.useEffect(()=>{if(u==="DD")try{const y=mn(t);m(String(y))}catch{m(t)}else try{/^-?\d+(\.\d+)?$/.test(t)?m(wb(parseFloat(t),f)):m(t)}catch{m(t)}},[t,u,f]);const x=y=>{const b=y.target.value;m(b),s(b)};if(u==="DMS"){const y=f?["N","S"]:["E","W"];return n.jsx(RC,{label:e,value:h,onChange:s,directions:y,error:i})}return n.jsx(de,{label:`${e} (DD)`,type:"number",step:"any",value:h,onChange:x,error:i,placeholder:f?"-18.1234":"46.5678"})},Lc=["#e11d48","#2563eb","#16a34a","#f97316","#9333ea","#ca8a04"],MC=({site:e,modules:t})=>{const{t:s}=we(),{farmers:a}=He(),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),u=S.useRef(null),f=S.useMemo(()=>new Map(a.map(h=>[h.id,`${h.firstName} ${h.lastName}`])),[a]);return S.useEffect(()=>(i.current&&!l.current&&(l.current=L.map(i.current).setView([-18.76,46.86],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(l.current),c.current=L.featureGroup().addTo(l.current),u.current=L.featureGroup().addTo(l.current)),()=>{l.current&&(l.current.remove(),l.current=null,c.current=null,u.current=null)}),[]),S.useEffect(()=>{const h=l.current;if(!h||!c.current||!u.current)return;const m=c.current,x=u.current;m.clearLayers(),x.clearLayers(),e.zones&&e.zones.length>0&&e.zones.forEach((T,_)=>{const j=Nf(T.geoPoints);if(j.length>=3){const E=j.reduce((M,I)=>({x:M.x+I.x,y:M.y+I.y}),{x:0,y:0});E.x/=j.length,E.y/=j.length,j.sort((M,I)=>{const P=Math.atan2(M.y-E.y,M.x-E.x),D=Math.atan2(I.y-E.y,I.x-E.x);return P-D});const k=j.map(M=>[M.y,M.x]),C=Lc[_%Lc.length],A=L.polygon(k,{color:C,weight:2,fillColor:C,fillOpacity:.1});A.bindPopup(`<b>${T.name}</b>`),m.addLayer(A)}}),t.forEach(T=>{if(T.siteId===e.id&&T.latitude&&T.longitude)try{const _=mn(T.latitude),j=mn(T.longitude),E=!!T.farmerId,k=E?"#22c55e":"#9ca3af",C=L.divIcon({className:"",html:`<div style="background-color: ${k}; width: 8px; height: 8px; border: 1px solid white; box-shadow: 0 0 2px rgba(0,0,0,0.3);"></div>`,iconSize:[8,8],iconAnchor:[4,4]}),A=L.marker([_,j],{icon:C});A.bindPopup(`<b>${T.code}</b><br>${s(E?"status_ASSIGNED":"status_FREE")}`),x.addLayer(A)}catch{}});const y=L.featureGroup([m,x]),b=y.getBounds();if(y.getLayers().length>0&&b.isValid())h.fitBounds(b.pad(.1));else try{if(e.location){const[T,_]=e.location.split(",");if(T&&_){const j=mn(T.trim()),E=mn(_.trim());!isNaN(j)&&!isNaN(E)&&h.setView([j,E],13)}}}catch{}},[e.zones,e.location,t,e.id,s]),n.jsxs(Ge,{className:"bg-white/30 dark:bg-gray-800/30",children:[n.jsxs("h3",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200",children:[s("siteLayout"),": ",e.name]}),n.jsx("div",{ref:i,style:{height:"400px"},className:"rounded-lg mb-4 border border-gray-200 dark:border-gray-700 shadow-inner z-0"}),n.jsx("div",{className:"flex flex-wrap gap-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-900/50",children:e.zones.length>0?e.zones.map((h,m)=>{const x=t.filter(b=>b.zoneId===h.id),y=Lc[m%Lc.length];return n.jsxs("div",{className:"flex-1 min-w-[250px] p-3 border-l-4 rounded-lg",style:{borderColor:y},children:[n.jsxs("h4",{className:"font-bold mb-3 text-gray-700 dark:text-gray-300",children:[h.name," (",x.length,")"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(b=>{const T=!!b.farmerId,_=T?f.get(b.farmerId):null,j=[`${s("code")}: ${b.code}`,`${s("status")}: ${s(T?"status_ASSIGNED":"status_FREE")}`,T&&_?`${s("farmer")}: ${_}`:null].filter(Boolean).join(`
`);return n.jsx("div",{title:j,className:`h-8 w-8 flex items-center justify-center text-[10px] font-mono border border-white/20 shadow-sm
                        ${T?"bg-green-500 text-white":"bg-gray-400 text-white"}
                        transition-transform hover:scale-110 cursor-help`,children:b.code.split("-").pop()},b.id)})})]},h.id)}):n.jsx("p",{className:"text-gray-500 dark:text-gray-400 w-full text-center py-4",children:s("noZonesDefined")})}),n.jsxs("div",{className:"mt-4",children:[n.jsx("h4",{className:"font-semibold mb-2",children:s("legend")}),n.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 bg-green-500 border border-white shadow-sm"}),n.jsx("span",{children:s("assignedModule")})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 bg-gray-400 border border-white shadow-sm"}),n.jsx("span",{children:s("freeModule")})]})]})]})]})},PC=()=>{const{t:e}=we(),{sites:t,deleteSite:s,addSite:a,updateSite:i,employees:l,modules:c}=He(),[u,f]=S.useState(!1),[h,m]=S.useState(null),[x,y]=S.useState(!1),[b,T]=S.useState(null),_=(C=null)=>{m(C),f(!0)},j=C=>{T(C),y(!0)},E=()=>{b&&s(b),y(!1),T(null)},k=C=>{"id"in C?i(C):a(C),f(!1)};return n.jsxs("div",{className:"pb-20",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("siteManagementTitle")}),n.jsxs(se,{onClick:()=>_(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("addSite")]})]}),n.jsx("div",{className:"grid grid-cols-1 gap-6",children:t.map(C=>{const A=l.find(M=>M.id===C.managerId);return n.jsxs(Ge,{children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[C.name,n.jsx("span",{className:"text-sm font-normal text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded",children:C.code})]}),n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[e("manager"),": ",A?`${A.firstName} ${A.lastName}`:e("noManager")]}),n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e("coordinates"),": ",C.location||"-"]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(se,{variant:"ghost",onClick:()=>_(C),children:n.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>j(C.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]}),n.jsx(MC,{site:C,modules:c}),n.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[n.jsx("h4",{className:"font-semibold mb-2",children:e("zones")}),n.jsx("div",{className:"flex flex-wrap gap-2",children:C.zones&&C.zones.length>0?C.zones.map(M=>n.jsx("span",{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 px-2 py-1 rounded text-sm border border-blue-200 dark:border-blue-800",children:M.name},M.id)):n.jsx("span",{className:"text-gray-500 text-sm italic",children:e("noZonesDefined")})})]})]},C.id)})}),u&&n.jsx(OC,{isOpen:u,onClose:()=>f(!1),site:h,onSave:k}),x&&n.jsx(zt,{isOpen:x,onClose:()=>y(!1),onConfirm:E,title:e("confirmDeleteTitle"),message:e("confirmDeleteSite")})]})},OC=({isOpen:e,onClose:t,site:s,onSave:a})=>{const{t:i}=we(),{employees:l,sites:c}=He(),{settings:u}=Ke(),[f,h]=S.useState({name:"",code:"",location:"",managerId:"",zones:[]}),[m,x]=S.useState(""),[y,b]=S.useState(""),[T,_]=S.useState({}),[j,E]=S.useState([]),k=S.useCallback(()=>{const z={};f.name.trim()||(z.name=i("validationRequired")),f.code.trim()||(z.code=i("validationRequired"));const Y=u.localization.coordinateFormat;if(m.trim())try{if(Y==="DD"){const J=parseFloat(m);if(isNaN(J)||J<-90||J>90)throw new Error(i("validationDDLatitudeRange"))}else mn(m)}catch(J){z.latitude=J.message}if(y.trim())try{if(Y==="DD"){const J=parseFloat(y);if(isNaN(J)||J<-180||J>180)throw new Error(i("validationDDLongitudeRange"))}else mn(y)}catch(J){z.longitude=J.message}return z},[f.name,f.code,m,y,i,u.localization.coordinateFormat]);S.useEffect(()=>{_(k())},[k]),S.useEffect(()=>{if(s){if(h({name:s.name,code:s.code,location:s.location,managerId:s.managerId||"",zones:s.zones||[]}),E(s.zones||[]),s.location){const z=s.location.split(",");z.length===2&&(x(z[0].trim()),b(z[1].trim()))}}else h({name:"",code:"",location:"",managerId:"",zones:[]}),E([]),x(""),b("")},[s,e]);const C=z=>{const Y=z.replace(/[^a-zA-Z]/g,"").toUpperCase();if(Y.length<3){const G=Y.padEnd(3,"X");return c.some(B=>B.code===G)?"":G}const J=new Set(c.map(G=>G.code));for(let G=0;G<Y.length-2;G++)for(let B=G+1;B<Y.length-1;B++)for(let Q=B+1;Q<Y.length;Q++){const W=Y[G]+Y[B]+Y[Q];if(!J.has(W))return W}return""},A=z=>{const Y=z.target.value;let J=f.code;if(!s)if(Y.trim().length>0){const G=C(Y);G&&(J=G)}else J="";h(G=>({...G,name:Y,code:J}))},M=()=>{const z={id:`zone-${Date.now()}`,name:`Zone ${j.length+1}`,geoPoints:[]};E([...j,z])},I=(z,Y,J)=>{E(G=>{const B=[...G];return B[z]={...B[z],[Y]:J},B})},P=z=>{E(j.filter((Y,J)=>J!==z))},D=z=>{E(Y=>{const J=[...Y],G={...J[z]};return G.geoPoints=[...G.geoPoints,""],J[z]=G,J})},U=(z,Y,J)=>{E(G=>{const B=[...G],Q={...B[z]},W=[...Q.geoPoints];return W[Y]=J,Q.geoPoints=W,B[z]=Q,B})},O=(z,Y)=>{E(J=>{const G=[...J],B={...G[z]};return B.geoPoints=B.geoPoints.filter((Q,W)=>W!==Y),G[z]=B,G})},F=()=>{const z=k();if(Object.keys(z).length>0){_(z);return}const Y=m&&y?`${m}, ${y}`:"",J={...f,location:Y,zones:j};a(s?{...s,...J}:J)},q=Object.keys(T).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editSite":"addSite"),widthClass:"max-w-4xl",children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:i("siteName"),value:f.name,onChange:A,required:!0,error:T.name}),n.jsx(de,{label:i("siteCode"),value:f.code,onChange:z=>h({...f,code:z.target.value.toUpperCase()}),required:!0,error:T.code}),n.jsxs(ke,{label:i("manager"),value:f.managerId,onChange:z=>h({...f,managerId:z.target.value}),children:[n.jsx("option",{value:"",children:i("noManager")}),l.map(z=>n.jsxs("option",{value:z.id,children:[z.firstName," ",z.lastName]},z.id))]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(Si,{label:i("latitude"),value:m,onChange:x,axis:"lat",error:T.latitude}),n.jsx(Si,{label:i("longitude"),value:y,onChange:b,axis:"lon",error:T.longitude})]}),n.jsxs("div",{className:"border-t pt-4 dark:border-gray-700",children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("h3",{className:"font-semibold",children:i("zones")}),n.jsxs(se,{variant:"secondary",onClick:M,className:"text-xs",children:[n.jsx(te,{name:"PlusCircle",className:"w-4 h-4 mr-1"}),i("addZone")]})]}),n.jsx("div",{className:"space-y-4 max-h-[40vh] overflow-y-auto pr-2",children:j.map((z,Y)=>n.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 dark:bg-gray-800/50 dark:border-gray-700 relative",children:[n.jsx(se,{variant:"danger",className:"absolute top-2 right-2 p-1",onClick:()=>P(Y),children:n.jsx(te,{name:"X",className:"w-4 h-4"})}),n.jsx("div",{className:"mb-3 pr-8",children:n.jsx(de,{label:i("zoneName"),value:z.name,onChange:J=>I(Y,"name",J.target.value)})}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("geoPoints")}),n.jsxs(se,{variant:"ghost",className:"text-xs py-0 h-6",onClick:()=>D(Y),children:[n.jsx(te,{name:"PlusCircle",className:"w-3 h-3 mr-1"}),i("addPoint")]})]}),n.jsxs("div",{className:"space-y-2 pl-2 border-l-2 border-gray-200 dark:border-gray-700",children:[z.geoPoints.length>0&&n.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 text-xs text-gray-500 font-semibold mb-1",children:[n.jsx("div",{className:"flex items-center justify-center",children:"#"}),n.jsx("div",{children:i("latitude")}),n.jsx("div",{children:i("longitude")}),n.jsx("div",{})]}),z.geoPoints.map((J,G)=>{const B=J.split(",").map(ae=>ae.trim()),Q=B[0]||"",W=B[1]||"";return n.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 items-center",children:[n.jsx("span",{className:"text-xs text-gray-500 text-center",children:G+1}),n.jsx(Si,{label:"",value:Q,onChange:ae=>{U(Y,G,`${ae}, ${W}`)},axis:"lat"}),n.jsx(Si,{label:"",value:W,onChange:ae=>{U(Y,G,`${Q}, ${ae}`)},axis:"lon"}),n.jsx(se,{variant:"ghost",className:"p-1 text-red-500 hover:text-red-700",onClick:()=>O(Y,G),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]},G)}),z.geoPoints.length===0&&n.jsx("p",{className:"text-xs text-gray-400 italic",children:i("noPoints")||"No points"})]})]})]},z.id))})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:F,disabled:q,children:i("save")})]})]})})},LC=({isOpen:e,onClose:t,creditType:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState(s),[u,f]=S.useState({}),h=S.useCallback(b=>{var _;const T={};return b.name.trim()||(T.name=i("validationRequired")),b.hasQuantity&&!((_=b.unit)!=null&&_.trim())&&(T.unit=i("validationRequired")),T},[i]);S.useEffect(()=>{c(s)},[s,e]),S.useEffect(()=>{f(h(l))},[l,h]);const m=(b,T)=>{c(b==="hasQuantity"&&T===!1?_=>({..._,hasQuantity:!1,unit:""}):_=>({..._,[b]:T}))},x=b=>{b.preventDefault(),Object.keys(u).length===0&&a(l)},y=Object.keys(u).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i("editCreditType"),children:n.jsxs("form",{onSubmit:x,className:"space-y-4",children:[n.jsx(de,{label:i("creditType"),value:l.name,onChange:b=>m("name",b.target.value),error:u.name}),l.hasQuantity&&n.jsx(de,{label:i("unit"),value:l.unit||"",onChange:b=>m("unit",b.target.value),error:u.unit}),n.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasQuantity,onChange:b=>m("hasQuantity",b.target.checked)}),i("withQuantity")]}),n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasUnitPrice,onChange:b=>m("hasUnitPrice",b.target.checked)}),i("withUnitPrice")]}),n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.isDirectAmount,onChange:b=>m("isDirectAmount",b.target.checked)}),i("directAmount")]})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",disabled:y,children:i("save")})]})]})})},UC=()=>{const{t:e}=we(),[t,s]=S.useState("status"),a=[{id:"status",label:e("creditStatus")},{id:"record",label:e("recordCredit")},{id:"repayment",label:e("recordRepayment")},{id:"settings",label:e("creditTypeSettings")}];return n.jsxs("div",{className:"pb-20",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("farmerCreditsTitle")}),n.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:n.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto","aria-label":"Tabs",children:a.map(i=>n.jsx("button",{onClick:()=>s(i.id),className:`${t===i.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:i.label},i.id))})}),n.jsxs("div",{children:[t==="status"&&n.jsx(FC,{}),t==="record"&&n.jsx(BC,{}),t==="repayment"&&n.jsx(GC,{}),t==="settings"&&n.jsx(zC,{})]})]})},FC=()=>{const{t:e,language:t}=we(),{farmers:s,farmerCredits:a,deleteFarmer:i,repayments:l,addMultipleFarmerCredits:c,addMultipleRepayments:u,creditTypes:f}=He(),{settings:h}=Ke(),[m,x]=S.useState(null),[y,b]=S.useState({key:"farmerName",direction:"ascending"}),[T,_]=S.useState(null),[j,E]=S.useState([]),k=S.useRef(null),C=S.useMemo(()=>new Map(f.map(F=>[F.id,F.name])),[f]),A=S.useMemo(()=>{let F=s.map(q=>{const z=a.filter(W=>W.farmerId===q.id),Y=l.filter(W=>W.farmerId===q.id),J=z.reduce((W,ae)=>W+ae.totalAmount,0),G=Y.reduce((W,ae)=>W+ae.amount,0),B=J-G;let Q=null;return Y.length>0&&(Q=[...Y].sort((W,ae)=>new Date(ae.date).getTime()-new Date(W.date).getTime())[0].date),{farmer:q,farmerName:`${q.firstName} ${q.lastName}`,totalContracted:J,totalRepayments:G,balance:B,lastRepaymentDate:Q}});return y.key&&F.sort((q,z)=>{const Y=q[y.key],J=z[y.key];return Y===null?1:J===null?-1:Y<J?y.direction==="ascending"?-1:1:Y>J?y.direction==="ascending"?1:-1:0}),F},[s,a,l,y]);S.useEffect(()=>{if(k.current){const F=j.length,q=A.length;k.current.checked=F===q&&q>0,k.current.indeterminate=F>0&&F<q}},[j,A]);const M=F=>{let q="ascending";y.key===F&&y.direction==="ascending"&&(q="descending"),b({key:F,direction:q})},I=F=>y.key!==F?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):y.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),P=({sortKey:F,label:q,className:z})=>n.jsx("th",{className:`p-3 ${z}`,children:n.jsxs("button",{onClick:()=>M(F),className:`group flex items-center gap-2 w-full ${z!=null&&z.includes("text-right")?"justify-end":""}`,children:[q,I(F)]})}),D=F=>{F.target.checked?E(A.map(q=>q.farmer.id)):E([])},U=(F,q)=>{F.target.checked?E(z=>[...z,q]):E(z=>z.filter(Y=>Y!==q))},O=F=>{_(T===F?null:F)};return n.jsxs(Ge,{children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsx("h2",{className:"text-lg font-semibold",children:e("creditStatus")})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{ref:k,onChange:D,"aria-label":e("selectAllFarmers")})}),n.jsx("th",{className:"p-3 w-8"}),n.jsx(P,{sortKey:"farmerName",label:e("farmer")}),n.jsx(P,{sortKey:"totalContracted",label:e("contractedCredits"),className:"text-right"}),n.jsx(P,{sortKey:"totalRepayments",label:e("repayments"),className:"text-right"}),n.jsx(P,{sortKey:"balance",label:e("remainingBalance"),className:"text-right"}),n.jsx(P,{sortKey:"lastRepaymentDate",label:e("lastRepaymentDate")})]})}),n.jsx("tbody",{children:A.map(F=>n.jsxs(gt.Fragment,{children:[n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:j.includes(F.farmer.id),onChange:q=>U(q,F.farmer.id),"aria-label":e("selectFarmerNamed").replace("{name}",F.farmerName)})}),n.jsx("td",{className:"p-3 text-center",children:n.jsx("button",{onClick:()=>O(F.farmer.id),className:"text-gray-500 hover:text-gray-700",children:n.jsx(te,{name:T===F.farmer.id?"ChevronDown":"ChevronRight",className:"w-4 h-4"})})}),n.jsx("td",{className:"p-3 font-medium",children:F.farmerName}),n.jsx("td",{className:"p-3 text-right",children:Ae(F.totalContracted,h.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(F.totalRepayments,h.localization)}),n.jsx("td",{className:`p-3 text-right font-bold ${F.balance>0?"text-red-600":"text-green-600"}`,children:Ae(F.balance,h.localization)}),n.jsx("td",{className:"p-3",children:F.lastRepaymentDate||"-"})]}),T===F.farmer.id&&n.jsx("tr",{className:"bg-gray-50 dark:bg-gray-900/30",children:n.jsx("td",{colSpan:7,className:"p-4",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-sm mb-2",children:e("creditsTaken")}),n.jsx("ul",{className:"space-y-2 text-sm",children:a.filter(q=>q.farmerId===F.farmer.id).length>0?a.filter(q=>q.farmerId===F.farmer.id).map(q=>n.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[n.jsxs("span",{children:[q.date," - ",C.get(q.creditTypeId)||q.creditTypeId]}),n.jsx("span",{children:Ae(q.totalAmount,h.localization)})]},q.id)):n.jsx("p",{className:"text-gray-500 italic",children:e("noCredits")})})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-sm mb-2",children:e("repaymentsMade")}),n.jsx("ul",{className:"space-y-2 text-sm",children:l.filter(q=>q.farmerId===F.farmer.id).length>0?l.filter(q=>q.farmerId===F.farmer.id).map(q=>n.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[n.jsxs("span",{children:[q.date," - ",e(`repaymentMethod_${q.method}`)]}),n.jsx("span",{children:Ae(q.amount,h.localization)})]},q.id)):n.jsx("p",{className:"text-gray-500 italic",children:e("noRepayments")})})]})]})})})]},F.farmer.id))})]})})]})},BC=()=>{const{t:e}=we(),{sites:t,farmers:s,creditTypes:a,addFarmerCredit:i,getFarmersBySite:l}=He(),{settings:c}=Ke(),[u,f]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",creditTypeId:"",quantity:"",unitPrice:"",totalAmount:"",notes:""}),[h,m]=S.useState({}),x=S.useMemo(()=>u.siteId?l(u.siteId):[],[u.siteId,l]),y=S.useMemo(()=>a.find(T=>T.id===u.creditTypeId),[a,u.creditTypeId]);S.useEffect(()=>{if(y&&!(!y.hasQuantity&&!y.hasUnitPrice)){const T=parseFloat(u.quantity),_=parseFloat(u.unitPrice);!isNaN(T)&&!isNaN(_)&&f(j=>({...j,totalAmount:(T*_).toFixed(2)}))}},[u.quantity,u.unitPrice,y]);const b=T=>{T.preventDefault();const _={};if(u.date||(_.date=e("validationRequired")),u.siteId||(_.siteId=e("validationRequired")),u.farmerId||(_.farmerId=e("validationRequired")),u.creditTypeId||(_.creditTypeId=e("validationRequired")),y!=null&&y.hasQuantity&&(!u.quantity||parseFloat(u.quantity)<=0)&&(_.quantity=e("validationPositiveNumber")),y!=null&&y.hasUnitPrice&&(!u.unitPrice||parseFloat(u.unitPrice)<=0)&&(_.unitPrice=e("validationPositiveNumber")),(!u.totalAmount||parseFloat(u.totalAmount)<=0)&&(_.totalAmount=e("validationPositiveNumber")),Object.keys(_).length>0){m(_);return}i({date:u.date,siteId:u.siteId,farmerId:u.farmerId,creditTypeId:u.creditTypeId,quantity:y!=null&&y.hasQuantity?parseFloat(u.quantity):void 0,unitPrice:y!=null&&y.hasUnitPrice?parseFloat(u.unitPrice):void 0,totalAmount:parseFloat(u.totalAmount),notes:u.notes}),alert("Credit recorded successfully"),f(j=>({...j,quantity:"",unitPrice:"",totalAmount:"",notes:""}))};return n.jsx(Ge,{title:e("recordCredit"),children:n.jsxs("form",{onSubmit:b,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsx(de,{label:e("date"),type:"date",value:u.date,onChange:T=>f({...u,date:T.target.value}),error:h.date,required:!0}),n.jsxs(ke,{label:e("site"),value:u.siteId,onChange:T=>f({...u,siteId:T.target.value,farmerId:""}),error:h.siteId,required:!0,children:[n.jsx("option",{value:"",children:e("selectSite")}),t.map(T=>n.jsx("option",{value:T.id,children:T.name},T.id))]}),n.jsxs(ke,{label:e("farmer"),value:u.farmerId,onChange:T=>f({...u,farmerId:T.target.value}),disabled:!u.siteId,error:h.farmerId,required:!0,children:[n.jsx("option",{value:"",children:e("selectFarmer")}),x.map(T=>n.jsxs("option",{value:T.id,children:[T.firstName," ",T.lastName]},T.id))]}),n.jsxs(ke,{label:e("creditType"),value:u.creditTypeId,onChange:T=>f({...u,creditTypeId:T.target.value}),error:h.creditTypeId,required:!0,children:[n.jsx("option",{value:"",children:e("selectType")}),a.map(T=>n.jsx("option",{value:T.id,children:T.name},T.id))]}),(y==null?void 0:y.hasQuantity)&&n.jsx(de,{label:`${e("quantity")} (${y.unit})`,type:"number",step:"any",value:u.quantity,onChange:T=>f({...u,quantity:T.target.value}),error:h.quantity,required:!0}),(y==null?void 0:y.hasUnitPrice)&&n.jsx(de,{label:e("unitPrice"),type:"number",step:"any",value:u.unitPrice,onChange:T=>f({...u,unitPrice:T.target.value}),error:h.unitPrice,required:!0}),n.jsx(de,{label:e("totalAmount"),type:"number",step:"any",value:u.totalAmount,onChange:T=>f({...u,totalAmount:T.target.value}),error:h.totalAmount,required:!0,disabled:!!(y!=null&&y.hasQuantity&&(y!=null&&y.hasUnitPrice))}),n.jsx(de,{label:e("notes"),value:u.notes,onChange:T=>f({...u,notes:T.target.value}),containerClassName:"md:col-span-2 lg:col-span-3"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(se,{type:"submit",children:e("save")})})]})})},GC=()=>{const{t:e}=we(),{sites:t,farmers:s,addRepayment:a,getFarmersBySite:i}=He(),{settings:l}=Ke(),[c,u]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",amount:"",method:"cash",notes:""}),[f,h]=S.useState({}),m=S.useMemo(()=>c.siteId?i(c.siteId):[],[c.siteId,i]),x=y=>{y.preventDefault();const b={};if(c.date||(b.date=e("validationRequired")),c.siteId||(b.siteId=e("validationRequired")),c.farmerId||(b.farmerId=e("validationRequired")),(!c.amount||parseFloat(c.amount)<=0)&&(b.amount=e("validationPositiveNumber")),Object.keys(b).length>0){h(b);return}a({date:c.date,farmerId:c.farmerId,amount:parseFloat(c.amount),method:c.method,notes:c.notes}),alert(e("repaymentRecorded")),u(T=>({...T,amount:"",notes:""}))};return n.jsx(Ge,{title:e("recordRepayment"),children:n.jsxs("form",{onSubmit:x,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsx(de,{label:e("date"),type:"date",value:c.date,onChange:y=>u({...c,date:y.target.value}),error:f.date,required:!0}),n.jsxs(ke,{label:e("site"),value:c.siteId,onChange:y=>u({...c,siteId:y.target.value,farmerId:""}),error:f.siteId,required:!0,children:[n.jsx("option",{value:"",children:e("selectSite")}),t.map(y=>n.jsx("option",{value:y.id,children:y.name},y.id))]}),n.jsxs(ke,{label:e("farmer"),value:c.farmerId,onChange:y=>u({...c,farmerId:y.target.value}),disabled:!c.siteId,error:f.farmerId,required:!0,children:[n.jsx("option",{value:"",children:e("selectFarmer")}),m.map(y=>n.jsxs("option",{value:y.id,children:[y.firstName," ",y.lastName]},y.id))]}),n.jsx(de,{label:e("repaymentAmount"),type:"number",step:"any",value:c.amount,onChange:y=>u({...c,amount:y.target.value}),error:f.amount,required:!0}),n.jsxs(ke,{label:e("repaymentMethod"),value:c.method,onChange:y=>u({...c,method:y.target.value}),children:[n.jsx("option",{value:"cash",children:e("repaymentMethod_cash")}),n.jsx("option",{value:"harvest_deduction",children:e("repaymentMethod_harvest_deduction")})]}),n.jsx(de,{label:e("notes"),value:c.notes,onChange:y=>u({...c,notes:y.target.value})})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(se,{type:"submit",children:e("save")})})]})})},zC=()=>{const{t:e}=we(),{creditTypes:t,addCreditType:s,updateCreditType:a,deleteCreditType:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(""),[x,y]=S.useState(!1),[b,T]=S.useState(null),_=()=>{h.trim()&&(s({name:h.trim(),hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0}),m(""))},j=C=>{T(C),y(!0)},E=()=>{b&&i(b),y(!1),T(null)},k=C=>{f(C),c(!0)};return n.jsxs(Ge,{title:e("creditTypes"),children:[n.jsxs("div",{className:"flex gap-4 mb-6",children:[n.jsx(de,{placeholder:e("addNewCreditType"),value:h,onChange:C=>m(C.target.value),containerClassName:"flex-grow"}),n.jsxs(se,{onClick:_,disabled:!h.trim(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("add")]})]}),n.jsx("div",{className:"space-y-2",children:t.map(C=>n.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded border dark:border-gray-700",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:C.name}),n.jsx("span",{className:"text-xs text-gray-500 ml-2",children:C.isDirectAmount?e("directAmount"):`${e("withQuantity")} (${C.unit})`})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(se,{variant:"ghost",onClick:()=>k(C),children:n.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>j(C.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},C.id))}),l&&u&&n.jsx(LC,{isOpen:l,onClose:()=>c(!1),creditType:u,onSave:C=>{a(C),c(!1)}}),x&&n.jsx(zt,{isOpen:x,onClose:()=>y(!1),onConfirm:E,title:e("confirmDeleteTitle"),message:e("confirmDeleteCreditType")})]})},$C=({isOpen:e,onClose:t,seaweedType:s})=>{const{t:a,language:i}=we(),{settings:l}=Ke(),{updateSeaweedPrices:c}=He(),[u,f]=S.useState({wetPrice:"",dryPrice:"",date:new Date().toISOString().split("T")[0]}),[h,m]=S.useState({}),x=S.useMemo(()=>[...s.priceHistory].sort((j,E)=>new Date(E.date).getTime()-new Date(j.date).getTime()),[s.priceHistory]),y=S.useCallback(()=>{const j={};return(isNaN(parseFloat(u.wetPrice))||parseFloat(u.wetPrice)<=0)&&(j.wetPrice=a("validationPositiveNumber")),(isNaN(parseFloat(u.dryPrice))||parseFloat(u.dryPrice)<=0)&&(j.dryPrice=a("validationPositiveNumber")),u.date?new Date(u.date)>new Date&&(j.date=a("validationFutureDate")):j.date=a("validationRequired"),j},[u,a]);S.useEffect(()=>{e&&(f({wetPrice:String(s.wetPrice),dryPrice:String(s.dryPrice),date:new Date().toISOString().split("T")[0]}),m({}))},[e,s]),S.useEffect(()=>{m(y())},[u,y]);const b=(j,E)=>{f(k=>({...k,[j]:E}))},T=()=>{const j=y();if(Object.keys(j).length>0){m(j);return}const E={date:u.date,wetPrice:parseFloat(u.wetPrice),dryPrice:parseFloat(u.dryPrice)};c(s.id,E),f({wetPrice:String(E.wetPrice),dryPrice:String(E.dryPrice),date:new Date().toISOString().split("T")[0]})},_=Object.keys(h).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:`${a("priceHistory")}: ${s.name}`,widthClass:"max-w-3xl",children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:a("addNewPrice")}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end p-4 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[n.jsx(de,{label:a("wetPrice"),type:"number",step:"any",value:u.wetPrice,onChange:j=>b("wetPrice",j.target.value),error:h.wetPrice}),n.jsx(de,{label:a("dryPrice"),type:"number",step:"any",value:u.dryPrice,onChange:j=>b("dryPrice",j.target.value),error:h.dryPrice}),n.jsx(de,{label:a("effectiveDate"),type:"date",value:u.date,onChange:j=>b("date",j.target.value),error:h.date}),n.jsxs(se,{onClick:T,disabled:_,className:"h-10",children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),a("add")]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:a("history")}),n.jsx("div",{className:"max-h-60 overflow-y-auto border dark:border-gray-700 rounded-lg",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 sticky top-0",children:[n.jsx("th",{className:"p-2",children:a("effectiveDate")}),n.jsx("th",{className:"p-2 text-right",children:a("wetPrice")}),n.jsx("th",{className:"p-2 text-right",children:a("dryPrice")})]})}),n.jsxs("tbody",{children:[x.map((j,E)=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-2",children:new Date(j.date).toLocaleDateString(i)}),n.jsx("td",{className:"p-2 text-right",children:Ae(j.wetPrice,l.localization)}),n.jsx("td",{className:"p-2 text-right",children:Ae(j.dryPrice,l.localization)})]},E)),x.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"p-4 text-center text-gray-500",children:a("noPriceHistory")})})]})]})})]})]})})},HC=()=>{const{t:e}=we(),{seaweedTypes:t,addSeaweedType:s,updateSeaweedType:a,deleteSeaweedType:i}=He(),{settings:l}=Ke(),c=Ds(),[u,f]=S.useState(!1),[h,m]=S.useState(null),[x,y]=S.useState(!1),[b,T]=S.useState(null),[_,j]=S.useState(!1),[E,k]=S.useState(null),C=(U=null)=>{m(U),f(!0)},A=()=>{m(null),f(!1)},M=U=>{T(U),y(!0)},I=()=>{b&&i(b),y(!1),T(null)},P=U=>{h?a({...h,...U}):s(U),A()},D=U=>{k(U),j(!0)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("seaweedTypeManagementTitle")}),n.jsxs(se,{onClick:()=>C(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("addSeaweedType")]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(U=>n.jsxs(Ge,{children:[n.jsx("h2",{className:"text-xl font-bold",children:U.name}),n.jsx("p",{className:"italic text-gray-500 dark:text-gray-400",children:U.scientificName}),n.jsx("p",{className:"mt-2 text-sm",children:U.description}),n.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700 space-y-2",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[e("wetPrice"),":"]})," ",Ae(U.wetPrice,l.localization)]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("dryPrice"),":"]})," ",Ae(U.dryPrice,l.localization)]})]}),n.jsxs("div",{className:"mt-4 flex gap-2 flex-wrap",children:[n.jsxs(se,{variant:"secondary",onClick:()=>c(`/seaweed-types/${U.id}/cultivation`),children:[n.jsx(te,{name:"GitBranch",className:"w-4 h-4"}),e("cycles")]}),n.jsxs(se,{variant:"ghost",onClick:()=>D(U),children:[n.jsx(te,{name:"FileText",className:"w-4 h-4"}),e("priceHistory")]}),n.jsx(se,{variant:"secondary",onClick:()=>C(U),children:e("edit")}),n.jsx(se,{variant:"danger",onClick:()=>M(U.id),children:e("delete")})]})]},U.id))}),u&&n.jsx(qC,{isOpen:u,onClose:A,seaweedType:h,onSave:P}),x&&n.jsx(zt,{isOpen:x,onClose:()=>y(!1),onConfirm:I,title:e("confirmDeleteTitle"),message:e("confirmDeleteSeaweedType")}),_&&E&&n.jsx($C,{isOpen:_,onClose:()=>j(!1),seaweedType:E})]})},qC=({isOpen:e,onClose:t,seaweedType:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState({name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0}),[u,f]=S.useState({});S.useEffect(()=>{c(s||{name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0})},[s,e]);const h=S.useCallback(()=>{const b={};return l.name.trim()||(b.name=i("validationRequired")),(isNaN(l.wetPrice)||l.wetPrice<=0)&&(b.wetPrice=i("validationPositiveNumber")),(isNaN(l.dryPrice)||l.dryPrice<=0)&&(b.dryPrice=i("validationPositiveNumber")),b},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(b,T)=>{c(_=>({..._,[b]:T}))},x=b=>{b.preventDefault(),!(Object.keys(u).length>0)&&a({...l,wetPrice:Number(l.wetPrice),dryPrice:Number(l.dryPrice)})},y=Object.keys(u).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editSeaweedType":"addSeaweedType"),children:n.jsxs("form",{onSubmit:x,className:"space-y-4",children:[n.jsx(de,{label:i("name"),value:l.name,onChange:b=>m("name",b.target.value),error:u.name,required:!0}),n.jsx(de,{label:i("scientificName"),value:l.scientificName,onChange:b=>m("scientificName",b.target.value)}),n.jsx(de,{label:i("description"),value:l.description,onChange:b=>m("description",b.target.value)}),n.jsx(de,{label:i("wetPrice"),type:"number",value:l.wetPrice,onChange:b=>m("wetPrice",parseFloat(b.target.value)),error:u.wetPrice,required:!0}),n.jsx(de,{label:i("dryPrice"),type:"number",value:l.dryPrice,onChange:b=>m("dryPrice",parseFloat(b.target.value)),error:u.dryPrice,required:!0}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",disabled:y,children:i("save")})]})]})})},VC=({isOpen:e,onClose:t,data:s,onSave:a})=>{var D,U,O;const{t:i}=we(),{sites:l,modules:c,cultivationCycles:u}=He(),[f,h]=S.useState(""),[m,x]=S.useState({siteId:"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),[y,b]=S.useState([]),[T,_]=S.useState({}),[j,E]=S.useState(null);S.useEffect(()=>{var F;s?(x({siteId:s.module.siteId,zoneId:s.module.zoneId,lines:s.module.lines,poles:s.module.poles,latitude:s.module.latitude||"",longitude:s.module.longitude||""}),h(s.module.code)):(x({siteId:((F=l[0])==null?void 0:F.id)||"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),h("")),E(null)},[s,e,l]),S.useEffect(()=>{if(s&&(s.module.siteId!==m.siteId||s.module.zoneId!==m.zoneId)){const F=u.find(q=>q.moduleId===s.module.id&&(q.status===Ye.PLANTED||q.status===Ye.GROWING));E(F?i("moduleMoveActiveCycleWarning"):null)}else E(null)},[s,m.siteId,m.zoneId,u,i]);const k=S.useCallback(()=>{const F={poles:{}};if(m.siteId||(F.siteId=i("validationRequired")),m.zoneId||(F.zoneId=i("validationRequired")),(isNaN(m.lines)||m.lines<=0)&&(F.lines=i("validationPositiveNumber")),m.latitude.trim())try{mn(m.latitude)}catch{F.latitude=i("invalidDMSFormat")}if(m.longitude.trim())try{mn(m.longitude)}catch{F.longitude=i("invalidDMSFormat")}let q=!1;for(const z of["galvanized","wood","plastic"])(isNaN(m.poles[z])||m.poles[z]<0)&&(F.poles[z]=i("validationNonNegative"),q=!0);return q||delete F.poles,F},[m,i]);S.useEffect(()=>{const F=l.find(q=>q.id===m.siteId);b((F==null?void 0:F.zones)||[])},[m.siteId,l]),S.useEffect(()=>{if(m.siteId&&m.zoneId){const F=l.find(z=>z.id===m.siteId),q=F==null?void 0:F.zones.find(z=>z.id===m.zoneId);if(F&&q){const z=F.code||"SITE",Y=q.name.replace(/zone/i,"").trim().replace(/[^A-Z0-9]/ig,"").toUpperCase()||"Z";let J;const G=!!s,B=G&&(s.module.siteId!==m.siteId||s.module.zoneId!==m.zoneId);if(!G||B){const ae=c.filter(ue=>ue.zoneId===m.zoneId).map(ue=>{const Ne=ue.code.split("-"),le=Ne[Ne.length-1];return le&&/^\d+$/.test(le)?parseInt(le,10):NaN}).filter(ue=>!isNaN(ue)),ie=(ae.length>0?Math.max(...ae):0)+1;J=String(ie).padStart(2,"0")}else{const W=s.module.code.split("-");J=W[W.length-1]||"01"}const Q=`${z}-${Y}-${J}`;h(Q)}}else s||h("")},[s,m.siteId,m.zoneId,l,c]),S.useEffect(()=>{_(k())},[m,k]);const C=(F,q)=>{x(z=>({...z,[F]:q}))},A=(F,q)=>{x(z=>({...z,poles:{...z.poles,[F]:q}}))},M=F=>{const q=l.find(Y=>Y.id===F),z=(q==null?void 0:q.zones)||[];x(Y=>{var J;return{...Y,siteId:F,zoneId:((J=z[0])==null?void 0:J.id)||""}})},I=F=>{F.preventDefault();const q=k();if(Object.keys(q).length>0){_(q);return}if(s){const z={...s.module,code:f,siteId:m.siteId,zoneId:m.zoneId,lines:Number(m.lines),poles:{galvanized:Number(m.poles.galvanized),wood:Number(m.poles.wood),plastic:Number(m.poles.plastic)},latitude:m.latitude.trim()||void 0,longitude:m.longitude.trim()||void 0};a(z)}else{const z={code:f,siteId:m.siteId,zoneId:m.zoneId,lines:Number(m.lines),poles:{galvanized:Number(m.poles.galvanized),wood:Number(m.poles.wood),plastic:Number(m.poles.plastic)},latitude:m.latitude.trim()||void 0,longitude:m.longitude.trim()||void 0};a(z)}},P=Object.keys(T).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editModule":"addModule"),widthClass:"max-w-4xl",children:n.jsxs("form",{onSubmit:I,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(de,{label:i("moduleCode"),value:f,disabled:!0}),n.jsx(ke,{label:i("site"),value:m.siteId,onChange:F=>M(F.target.value),error:T.siteId,children:l.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))}),n.jsxs(ke,{label:i("zoneName"),value:m.zoneId,onChange:F=>C("zoneId",F.target.value),error:T.zoneId,disabled:!m.siteId,children:[n.jsx("option",{value:"",children:i("selectZone")}),y.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(Si,{label:`${i("latitudeDMS")} (${i("optional")})`,value:m.latitude,onChange:F=>C("latitude",F),axis:"lat",error:T.latitude}),n.jsx(Si,{label:`${i("longitudeDMS")} (${i("optional")})`,value:m.longitude,onChange:F=>C("longitude",F),axis:"lon",error:T.longitude})]}),j&&n.jsxs("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700 rounded-md text-sm flex items-center gap-2",children:[n.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 flex-shrink-0"}),j]}),n.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:i("configuration")}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx(de,{label:i("lines"),type:"number",value:m.lines,onChange:F=>C("lines",Number(F.target.value)),error:T.lines,required:!0}),n.jsx(de,{label:i("galvanizedPoles"),type:"number",value:m.poles.galvanized,onChange:F=>A("galvanized",Number(F.target.value)),error:(D=T.poles)==null?void 0:D.galvanized,required:!0}),n.jsx(de,{label:i("woodPoles"),type:"number",value:m.poles.wood,onChange:F=>A("wood",Number(F.target.value)),error:(U=T.poles)==null?void 0:U.wood,required:!0}),n.jsx(de,{label:i("plasticPoles"),type:"number",value:m.poles.plastic,onChange:F=>A("plastic",Number(F.target.value)),error:(O=T.poles)==null?void 0:O.plastic,required:!0})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",disabled:P,children:i("save")})]})]})})},jb=({isOpen:e,onClose:t,history:s,moduleCode:a})=>{const{t:i,language:l}=we(),c=[...s].sort((u,f)=>new Date(f.date).getTime()-new Date(u.date).getTime());return n.jsx(ot,{isOpen:e,onClose:t,title:`${i("moduleStatusHistoryTitle")}: ${a}`,widthClass:"max-w-2xl",children:n.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:n.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:c.map((u,f)=>n.jsxs("li",{className:"mb-8 ml-8",children:[n.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:n.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[n.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),n.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(vn,{status:u.status}),n.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(u.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),u.notes&&n.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",u.notes]})]},f))})})})},_b=({qrData:e,title:t,subtitle:s,detail:a,onClose:i})=>{const{settings:l}=Ke(),c=S.useRef(null);S.useEffect(()=>{c.current&&(c.current.innerHTML="",new QRCode(c.current,{text:JSON.stringify(e),width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))},[e]);const u=()=>{window.print()};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[1100] flex items-center justify-center backdrop-blur-sm",children:n.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4",children:[n.jsxs("div",{id:"printable-qr-label",className:"border-2 border-black p-4 flex flex-col items-center text-center bg-white w-[300px] h-[200px] mx-auto mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2 w-full border-b border-gray-300 pb-2 mb-2",children:[n.jsx("img",{src:l.company.logoUrl,className:"h-8 object-contain"}),n.jsx("span",{className:"text-xs font-bold uppercase truncate",children:l.company.name})]}),n.jsxs("div",{className:"flex-grow flex flex-row items-center gap-4 w-full",children:[n.jsx("div",{ref:c,className:"w-[96px] h-[96px]"}),n.jsxs("div",{className:"text-left flex-1 overflow-hidden",children:[n.jsx("h2",{className:"text-lg font-bold leading-tight uppercase break-words",children:t}),s&&n.jsx("p",{className:"text-xs text-gray-600 mt-1",children:s}),a&&n.jsx("p",{className:"text-[10px] font-mono mt-2",children:a})]})]}),n.jsx("div",{className:"text-[8px] text-gray-400 w-full text-right mt-1",children:new Date().toLocaleDateString()})]}),n.jsxs("div",{className:"flex justify-end gap-2 no-print",children:[n.jsx("button",{onClick:i,className:"px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",children:"Close"}),n.jsxs("button",{onClick:u,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2",children:[n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Label"]})]})]})})},KC=()=>{const{t:e}=we(),{settings:t}=Ke(),{modules:s,cultivationCycles:a,sites:i,seaweedTypes:l,deleteModule:c,addModule:u,updateModule:f,farmers:h,deleteMultipleModules:m,updateModulesFarmer:x}=He(),[y,b]=S.useState(!1),[T,_]=S.useState(null),[j,E]=S.useState(!1),[k,C]=S.useState(null),[A,M]=S.useState(!1),[I,P]=S.useState(null),[D,U]=S.useState(""),[O,F]=S.useState([]),[q,z]=S.useState(!1),[Y,J]=S.useState(null),[G,B]=S.useState(!1),[Q,W]=Kf(),ae=Q.get("highlight"),[$,ie]=S.useState("table"),[ue,Ne]=S.useState(null),[le,ne]=S.useState({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),[je,fe]=S.useState([]);S.useEffect(()=>{if(le.siteId==="all")fe([]);else{const ye=i.find(Ue=>Ue.id===le.siteId);fe((ye==null?void 0:ye.zones)||[])}},[le.siteId,i]);const Z=(ye,Ue)=>{ne(ye==="siteId"?et=>({...et,siteId:Ue,zoneId:"all"}):et=>({...et,[ye]:Ue}))},ee=S.useCallback(()=>{ne({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),F([])},[]),xe=S.useMemo(()=>s.map(ye=>{const Ue=[...a].filter(vt=>vt.moduleId===ye.id).sort((vt,Yt)=>new Date(Yt.plantingDate).getTime()-new Date(vt.plantingDate).getTime())[0],et=i.find(vt=>vt.id===ye.siteId),At=et==null?void 0:et.zones.find(vt=>vt.id===ye.zoneId),ut=Ue?l.find(vt=>vt.id===Ue.seaweedTypeId):void 0,Ut=ye.farmerId?h.find(vt=>vt.id===ye.farmerId):void 0;let Ct;if(!ye.farmerId){const vt=a.filter(Yt=>Yt.moduleId===ye.id&&Yt.harvestDate).sort((Yt,Ps)=>new Date(Ps.harvestDate).getTime()-new Date(Yt.harvestDate).getTime());if(vt.length>0){const Yt=new Date(vt[0].harvestDate),Vs=Math.floor((new Date().getTime()-Yt.getTime())/(1e3*60*60*24));Vs>df&&(Ct={type:"unassigned_long",message:e("notification_unassigned").replace("{code}",ye.code).replace("{days}",String(Vs))})}}return{module:ye,cycle:Ue,site:et,zone:At,seaweedType:ut,farmer:Ut,alert:Ct}}).filter(ye=>{const{module:Ue}=ye;if(!Ue)return!1;const et=le.code?Ue.code.toLowerCase().includes(le.code.toLowerCase()):!0,At=le.siteId!=="all"?Ue.siteId===le.siteId:!0,ut=le.zoneId!=="all"?Ue.zoneId===le.zoneId:!0,Ut=le.farmerId!=="all"?Ue.farmerId===le.farmerId:!0,Ct=(()=>{switch(le.status){case"free":return!Ue.farmerId;case"assigned":return!!Ue.farmerId;case"with_alerts":return!!ye.alert;case"all":default:return!0}})();return et&&At&&ut&&Ut&&Ct}),[s,a,i,l,h,e,le]);S.useMemo(()=>{if(O.length===0)return{farmers:[],isMultiSite:!1};const ye=s.filter(et=>O.includes(et.id)),Ue=new Set(ye.map(et=>et.siteId));if(Ue.size===1){const[et]=Ue;return{farmers:h.filter(At=>At.siteId===et),isMultiSite:!1}}return{farmers:[],isMultiSite:Ue.size>1}},[O,s,h]),S.useEffect(()=>{if(ae){const ye=xe.find(Ue=>Ue.module.id===ae);ye&&(J(ye),W({},{replace:!0}))}},[ae,xe,W]),S.useEffect(()=>{const ye=new Set(xe.map(Ue=>Ue.module.id));F(Ue=>Ue.filter(et=>ye.has(et)))},[xe]),S.useMemo(()=>s.length,[s]),S.useMemo(()=>a.filter(ye=>ye.status===Ye.PLANTED||ye.status===Ye.GROWING).length,[a]),S.useMemo(()=>{const ye=new Date;ye.setHours(0,0,0,0);const Ue=45;return a.filter(et=>{if(et.status===Ye.PLANTED||et.status===Ye.GROWING){const At=new Date(et.plantingDate);return At.setHours(0,0,0,0),(ye.getTime()-At.getTime())/(1e3*60*60*24)>Ue}return!1}).length},[a]),S.useMemo(()=>s.reduce((ye,Ue)=>ye+Ue.lines,0),[s]);const Oe=S.useMemo(()=>[...h].sort((ye,Ue)=>`${ye.firstName} ${ye.lastName}`.localeCompare(`${Ue.firstName} ${Ue.lastName}`)),[h]),De=(ye=null)=>{_(ye),b(!0)},Re=()=>{_(null),b(!1)},Ve=ye=>{C(ye),E(!0)},ze=()=>{k&&c(k),E(!1),C(null)},Se=ye=>{"id"in ye?f(ye):u(ye),Re()},Le=(ye,Ue)=>{P(ye),U(Ue),M(!0)},be=ye=>{var Ue;Ne({data:{t:"m",id:ye.id},title:ye.code,subtitle:((Ue=i.find(et=>et.id===ye.siteId))==null?void 0:Ue.name)||""})};return n.jsxs("div",{className:"pb-20",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:e("moduleManagementTitle")}),n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs(se,{onClick:()=>De(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("addModule")]})})]}),n.jsxs(Ge,{className:"mb-6",children:[n.jsx("h2",{className:"text-lg font-semibold mb-2",children:e("filtersTitle")}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end",children:[n.jsx(de,{label:e("moduleCode"),value:le.code,onChange:ye=>Z("code",ye.target.value)}),n.jsxs(ke,{label:e("site"),value:le.siteId,onChange:ye=>Z("siteId",ye.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),i.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),n.jsxs(ke,{label:e("zoneName"),value:le.zoneId,onChange:ye=>Z("zoneId",ye.target.value),disabled:le.siteId==="all",children:[n.jsx("option",{value:"all",children:e("allZones")}),je.map(ye=>n.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),n.jsxs(ke,{label:e("farmer"),value:le.farmerId,onChange:ye=>Z("farmerId",ye.target.value),children:[n.jsx("option",{value:"all",children:e("allFarmers")}),Oe.map(ye=>n.jsxs("option",{value:ye.id,children:[ye.firstName," ",ye.lastName]},ye.id))]}),n.jsxs(ke,{label:e("status"),value:le.status,onChange:ye=>Z("status",ye.target.value),children:[n.jsx("option",{value:"all",children:e("allStatuses")}),n.jsx("option",{value:"free",children:e("status_FREE")}),n.jsx("option",{value:"assigned",children:e("status_ASSIGNED")}),n.jsx("option",{value:"with_alerts",children:e("alerts")})]}),n.jsx(se,{variant:"secondary",onClick:ee,className:"h-[42px] w-full",children:e("clearFilters")})]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-16",children:e("status")}),n.jsx("th",{className:"p-3",children:e("moduleCode")}),n.jsx("th",{className:"p-3",children:e("site")}),n.jsx("th",{className:"p-3",children:e("zoneName")}),n.jsx("th",{className:"p-3",children:e("farmer")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsx("tbody",{children:xe.map(ye=>{var Ue,et;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:ye.module.farmerId?"ASSIGNED":"FREE"})}),n.jsx("td",{className:"p-3 font-mono font-bold",children:ye.module.code}),n.jsx("td",{className:"p-3",children:(Ue=ye.site)==null?void 0:Ue.name}),n.jsx("td",{className:"p-3",children:(et=ye.zone)==null?void 0:et.name}),n.jsx("td",{className:"p-3",children:ye.farmer?`${ye.farmer.firstName} ${ye.farmer.lastName}`:"-"}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-1",children:[n.jsx(se,{variant:"ghost",onClick:()=>be(ye.module),title:e("print"),children:n.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),n.jsx(se,{variant:"ghost",onClick:()=>De(ye),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(se,{variant:"ghost",onClick:()=>Le(ye.module.statusHistory,ye.module.code),children:n.jsx(te,{name:"FileText",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>Ve(ye.module.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},ye.module.id)})})]})})}),y&&n.jsx(VC,{isOpen:y,onClose:Re,data:T,onSave:Se}),j&&n.jsx(zt,{isOpen:j,onClose:()=>E(!1),onConfirm:ze,title:e("confirmDeleteTitle"),message:e("confirmDeleteModule")}),A&&I&&n.jsx(jb,{isOpen:A,onClose:()=>M(!1),history:I,moduleCode:D}),ue&&n.jsx(_b,{qrData:ue.data,title:ue.title,subtitle:ue.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>Ne(null)})]})},WC=({isOpen:e,onClose:t,cycle:s,module:a})=>{const{t:i,language:l}=we(),{cuttingOperations:c,serviceProviders:u}=He(),f=S.useMemo(()=>new Map(u.map(m=>[m.id,m.name])),[u]),h=S.useMemo(()=>{const m=[];if(!s)return[];if(s.cuttingOperationId){const x=c.find(y=>y.id===s.cuttingOperationId);if(x){const y=f.get(x.serviceProviderId),b=y?`Provider: ${y}`:`Operation ID: ${x.id}`;m.push({status:"CUTTING",date:x.date,notes:b})}}if(s.plantingDate&&(m.push({status:"PLANTED",date:s.plantingDate}),!s.harvestDate)){const x=new Date(s.plantingDate);x.setDate(x.getDate()+1),m.push({status:"GROWING",date:x.toISOString().split("T")[0]})}return s.harvestDate&&m.push({status:"HARVESTED",date:s.harvestDate}),s.dryingStartDate&&m.push({status:"DRYING",date:s.dryingStartDate}),s.baggingStartDate&&m.push({status:"BAGGING",date:s.baggingStartDate}),s.stockDate&&m.push({status:"IN_STOCK",date:s.stockDate}),s.exportDate&&m.push({status:"EXPORTED",date:s.exportDate}),m.filter(x=>x.date).sort((x,y)=>new Date(y.date).getTime()-new Date(x.date).getTime())},[s,c,f]);return n.jsx(ot,{isOpen:e,onClose:t,title:`${i("cultivationCycleHistoryTitle")}: ${a.code}`,widthClass:"max-w-2xl",children:n.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:n.jsxs("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:[h.map((m,x)=>n.jsxs("li",{className:"mb-8 ml-8",children:[n.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:n.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[n.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),n.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(vn,{status:m.status}),n.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(m.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),m.notes&&n.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",m.notes]})]},x)),h.length===0&&n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:i("noCycleHistoryEvents")})]})})})};var Fo={exports:{}},Jh={},Yh,qx;function JC(){if(qx)return Yh;qx=1;function e(t,s){typeof s=="boolean"&&(s={forever:s}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=s||{},this._maxRetryTime=s&&s.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Yh=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var s=new Date().getTime();if(t&&s-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var a=this._timeouts.shift();if(a===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),a=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},a),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(t,s){this._fn=t,s&&(s.timeout&&(this._operationTimeout=s.timeout),s.cb&&(this._operationTimeoutCb=s.cb));var a=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){a._operationTimeoutCb()},a._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},e.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},e.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},s=null,a=0,i=0;i<this._errors.length;i++){var l=this._errors[i],c=l.message,u=(t[c]||0)+1;t[c]=u,u>=a&&(s=l,a=u)}return s},Yh}var Vx;function YC(){return Vx||(Vx=1,(function(e){var t=JC();e.operation=function(s){var a=e.timeouts(s);return new t(a,{forever:s&&(s.forever||s.retries===1/0),unref:s&&s.unref,maxRetryTime:s&&s.maxRetryTime})},e.timeouts=function(s){if(s instanceof Array)return[].concat(s);var a={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in s)a[i]=s[i];if(a.minTimeout>a.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var l=[],c=0;c<a.retries;c++)l.push(this.createTimeout(c,a));return s&&s.forever&&!l.length&&l.push(this.createTimeout(c,a)),l.sort(function(u,f){return u-f}),l},e.createTimeout=function(s,a){var i=a.randomize?Math.random()+1:1,l=Math.round(i*Math.max(a.minTimeout,1)*Math.pow(a.factor,s));return l=Math.min(l,a.maxTimeout),l},e.wrap=function(s,a,i){if(a instanceof Array&&(i=a,a=null),!i){i=[];for(var l in s)typeof s[l]=="function"&&i.push(l)}for(var c=0;c<i.length;c++){var u=i[c],f=s[u];s[u]=(function(m){var x=e.operation(a),y=Array.prototype.slice.call(arguments,1),b=y.pop();y.push(function(T){x.retry(T)||(T&&(arguments[0]=x.mainError()),b.apply(this,arguments))}),x.attempt(function(){m.apply(s,y)})}).bind(s,f),s[u].options=a}}})(Jh)),Jh}var Xh,Kx;function XC(){return Kx||(Kx=1,Xh=YC()),Xh}var Wx;function QC(){if(Wx)return Fo.exports;Wx=1;const e=XC(),t=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(u){super(),u instanceof Error?(this.originalError=u,{message:u}=u):(this.originalError=new Error(u),this.originalError.stack=this.stack),this.name="AbortError",this.message=u}}const a=(c,u,f)=>{const h=f.retries-(u-1);return c.attemptNumber=u,c.retriesLeft=h,c},i=c=>t.includes(c),l=(c,u)=>new Promise((f,h)=>{u={onFailedAttempt:()=>{},retries:10,...u};const m=e.operation(u);m.attempt(async x=>{try{f(await c(x))}catch(y){if(!(y instanceof Error)){h(new TypeError(`Non-error was thrown: "${y}". You should only throw errors.`));return}if(y instanceof s)m.stop(),h(y.originalError);else if(y instanceof TypeError&&!i(y.message))m.stop(),h(y);else{a(y,x,u);try{await u.onFailedAttempt(y)}catch(b){h(b);return}m.retry(y)||h(m.mainError())}}})});return Fo.exports=l,Fo.exports.default=l,Fo.exports.AbortError=s,Fo.exports}var Eb=QC();const ZC=Uf(Eb);var eI={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let tI,nI;function sI(){return{geminiUrl:tI,vertexUrl:nI}}function aI(e,t,s,a){var i,l;if(!(e!=null&&e.baseUrl)){const c=sI();return t?(i=c.vertexUrl)!==null&&i!==void 0?i:s:(l=c.geminiUrl)!==null&&l!==void 0?l:a}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class va{}function qe(e,t){const s=/\{([^}]+)\}/g;return e.replace(s,(a,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const l=t[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function v(e,t,s){for(let l=0;l<t.length-1;l++){const c=t[l];if(c.endsWith("[]")){const u=c.slice(0,-2);if(!(u in e))if(Array.isArray(s))e[u]=Array.from({length:s.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(e[u])){const f=e[u];if(Array.isArray(s))for(let h=0;h<f.length;h++){const m=f[h];v(m,t.slice(l+1),s[h])}else for(const h of f)v(h,t.slice(l+1),s)}return}else if(c.endsWith("[0]")){const u=c.slice(0,-3);u in e||(e[u]=[{}]);const f=e[u];v(f[0],t.slice(l+1),s);return}(!e[c]||typeof e[c]!="object")&&(e[c]={}),e=e[c]}const a=t[t.length-1],i=e[a];if(i!==void 0){if(!s||typeof s=="object"&&Object.keys(s).length===0||s===i)return;if(typeof i=="object"&&typeof s=="object"&&i!==null&&s!==null)Object.assign(i,s);else throw new Error(`Cannot set value for an existing key. Key: ${a}`)}else a==="_self"&&typeof s=="object"&&s!==null&&!Array.isArray(s)?Object.assign(e,s):e[a]=s}function g(e,t,s=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let a=0;a<t.length;a++){if(typeof e!="object"||e===null)return s;const i=t[a];if(i.endsWith("[]")){const l=i.slice(0,-2);if(l in e){const c=e[l];return Array.isArray(c)?c.map(u=>g(u,t.slice(a+1),s)):s}else return s}else e=e[i]}return e}catch(a){if(a instanceof TypeError)return s;throw a}}function rI(e,t){for(const[s,a]of Object.entries(t)){const i=s.split("."),l=a.split("."),c=new Set;let u=-1;for(let f=0;f<i.length;f++)if(i[f]==="*"){u=f;break}if(u!==-1&&l.length>u)for(let f=u;f<l.length;f++){const h=l[f];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}wf(e,i,l,0,c)}}function wf(e,t,s,a,i){if(a>=t.length||typeof e!="object"||e===null)return;const l=t[a];if(l.endsWith("[]")){const c=l.slice(0,-2),u=e;if(c in u&&Array.isArray(u[c]))for(const f of u[c])wf(f,t,s,a+1,i)}else if(l==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const c=e,u=Object.keys(c).filter(h=>!h.startsWith("_")&&!i.has(h)),f={};for(const h of u)f[h]=c[h];for(const[h,m]of Object.entries(f)){const x=[];for(const y of s.slice(a))y==="*"?x.push(h):x.push(y);v(c,x,m)}for(const h of u)delete c[h]}}else{const c=e;l in c&&wf(c[l],t,s,a+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zf(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iI(e){const t={},s=g(e,["operationName"]);s!=null&&v(t,["operationName"],s);const a=g(e,["resourceName"]);return a!=null&&v(t,["_url","resourceName"],a),t}function oI(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["response","generateVideoResponse"]);return c!=null&&v(t,["response"],cI(c)),t}function lI(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["response"]);return c!=null&&v(t,["response"],dI(c)),t}function cI(e){const t={},s=g(e,["generatedSamples"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>uI(c))),v(t,["generatedVideos"],l)}const a=g(e,["raiMediaFilteredCount"]);a!=null&&v(t,["raiMediaFilteredCount"],a);const i=g(e,["raiMediaFilteredReasons"]);return i!=null&&v(t,["raiMediaFilteredReasons"],i),t}function dI(e){const t={},s=g(e,["videos"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>hI(c))),v(t,["generatedVideos"],l)}const a=g(e,["raiMediaFilteredCount"]);a!=null&&v(t,["raiMediaFilteredCount"],a);const i=g(e,["raiMediaFilteredReasons"]);return i!=null&&v(t,["raiMediaFilteredReasons"],i),t}function uI(e){const t={},s=g(e,["video"]);return s!=null&&v(t,["video"],xI(s)),t}function hI(e){const t={},s=g(e,["_self"]);return s!=null&&v(t,["video"],vI(s)),t}function fI(e){const t={},s=g(e,["operationName"]);return s!=null&&v(t,["_url","operationName"],s),t}function mI(e){const t={},s=g(e,["operationName"]);return s!=null&&v(t,["_url","operationName"],s),t}function pI(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["response"]);return c!=null&&v(t,["response"],gI(c)),t}function gI(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["parent"]);a!=null&&v(t,["parent"],a);const i=g(e,["documentName"]);return i!=null&&v(t,["documentName"],i),t}function Cb(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["response"]);return c!=null&&v(t,["response"],yI(c)),t}function yI(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["parent"]);a!=null&&v(t,["parent"],a);const i=g(e,["documentName"]);return i!=null&&v(t,["documentName"],i),t}function xI(e){const t={},s=g(e,["uri"]);s!=null&&v(t,["uri"],s);const a=g(e,["encodedVideo"]);a!=null&&v(t,["videoBytes"],Zf(a));const i=g(e,["encoding"]);return i!=null&&v(t,["mimeType"],i),t}function vI(e){const t={},s=g(e,["gcsUri"]);s!=null&&v(t,["uri"],s);const a=g(e,["bytesBase64Encoded"]);a!=null&&v(t,["videoBytes"],Zf(a));const i=g(e,["mimeType"]);return i!=null&&v(t,["mimeType"],i),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Jx;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Jx||(Jx={}));var Yx;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(Yx||(Yx={}));var Xx;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(Xx||(Xx={}));var fn;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(fn||(fn={}));var Qx;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Qx||(Qx={}));var Zx;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(Zx||(Zx={}));var e0;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(e0||(e0={}));var t0;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(t0||(t0={}));var n0;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(n0||(n0={}));var s0;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(s0||(s0={}));var a0;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(a0||(a0={}));var r0;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(r0||(r0={}));var i0;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(i0||(i0={}));var o0;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(o0||(o0={}));var l0;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(l0||(l0={}));var c0;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(c0||(c0={}));var d0;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(d0||(d0={}));var u0;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(u0||(u0={}));var h0;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(h0||(h0={}));var f0;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(f0||(f0={}));var m0;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(m0||(m0={}));var td;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(td||(td={}));var p0;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(p0||(p0={}));var g0;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(g0||(g0={}));var y0;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(y0||(y0={}));var Tf;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Tf||(Tf={}));var x0;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(x0||(x0={}));var v0;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(v0||(v0={}));var jf;(function(e){e.COLLECTION="COLLECTION"})(jf||(jf={}));var b0;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(b0||(b0={}));var N0;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(N0||(N0={}));var nd;(function(e){e.PREDICT="PREDICT",e.EMBED_CONTENT="EMBED_CONTENT"})(nd||(nd={}));var S0;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(S0||(S0={}));var w0;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(w0||(w0={}));var T0;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(T0||(T0={}));var j0;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(j0||(j0={}));var _0;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(_0||(_0={}));var E0;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(E0||(E0={}));var C0;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(C0||(C0={}));var I0;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(I0||(I0={}));var A0;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(A0||(A0={}));var k0;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(k0||(k0={}));var D0;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(D0||(D0={}));var R0;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING",e.DISTILLATION="DISTILLATION"})(R0||(R0={}));var M0;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(M0||(M0={}));var P0;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(P0||(P0={}));var O0;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"})(O0||(O0={}));var L0;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(L0||(L0={}));var U0;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(U0||(U0={}));var F0;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(F0||(F0={}));var B0;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.ACTIVITY_START="ACTIVITY_START",e.ACTIVITY_END="ACTIVITY_END"})(B0||(B0={}));var G0;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(G0||(G0={}));var z0;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(z0||(z0={}));var $0;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})($0||($0={}));var H0;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(H0||(H0={}));var q0;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(q0||(q0={}));var V0;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(V0||(V0={}));var wi;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(wi||(wi={}));class _f{constructor(t){const s={};for(const a of t.headers.entries())s[a[0]]=a[1];this.headers=s,this.responseInternal=t}json(){return this.responseInternal.json()}}class Bo{get text(){var t,s,a,i,l,c,u,f;if(((i=(a=(s=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",m=!1;const x=[];for(const y of(f=(u=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[b,T]of Object.entries(y))b!=="text"&&b!=="thought"&&b!=="thoughtSignature"&&(T!==null||T!==void 0)&&x.push(b);if(typeof y.text=="string"){if(typeof y.thought=="boolean"&&y.thought)continue;m=!0,h+=y.text}}return x.length>0&&console.warn(`there are non-text parts ${x} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?h:void 0}get data(){var t,s,a,i,l,c,u,f;if(((i=(a=(s=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const m=[];for(const x of(f=(u=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[y,b]of Object.entries(x))y!=="inlineData"&&(b!==null||b!==void 0)&&m.push(y);x.inlineData&&typeof x.inlineData.data=="string"&&(h+=atob(x.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var t,s,a,i,l,c,u,f;if(((i=(a=(s=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(f=(u=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var t,s,a,i,l,c,u,f,h;if(((i=(a=(s=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(f=(u=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(x=>x.executableCode).map(x=>x.executableCode).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var t,s,a,i,l,c,u,f,h;if(((i=(a=(s=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(f=(u=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(x=>x.codeExecutionResult).map(x=>x.codeExecutionResult).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.output}}class K0{}class W0{}class bI{}class NI{}class SI{}class wI{}class J0{}class Y0{}class X0{}class TI{}class sd{_fromAPIResponse({apiResponse:t,_isVertexAI:s}){const a=new sd;let i;const l=t;return s?i=lI(l):i=oI(l),Object.assign(a,i),a}}class Q0{}class Z0{}class ev{}class tv{}class jI{}class _I{}class EI{}class em{_fromAPIResponse({apiResponse:t,_isVertexAI:s}){const a=new em,l=pI(t);return Object.assign(a,l),a}}class CI{}class II{}class AI{}class kI{}class nv{}class DI{get text(){var t,s,a;let i="",l=!1;const c=[];for(const u of(a=(s=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&a!==void 0?a:[]){for(const[f,h]of Object.entries(u))f!=="text"&&f!=="thought"&&h!==null&&c.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;l=!0,i+=u.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var t,s,a;let i="";const l=[];for(const c of(a=(s=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&a!==void 0?a:[]){for(const[u,f]of Object.entries(c))u!=="inlineData"&&f!==null&&l.push(u);c.inlineData&&typeof c.inlineData.data=="string"&&(i+=atob(c.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class RI{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class tm{_fromAPIResponse({apiResponse:t,_isVertexAI:s}){const a=new tm,l=Cb(t);return Object.assign(a,l),a}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Et(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const s=t.split("/",2);return`publishers/${s[0]}/models/${s[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Ib(e,t){const s=Et(e,t);return s?s.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${s}`:s.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${s}`:s:""}function Ab(e){return Array.isArray(e)?e.map(t=>ad(t)):[ad(e)]}function ad(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function kb(e){const t=ad(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Db(e){const t=ad(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function sv(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Rb(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>sv(t)):[sv(e)]}function Ef(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function av(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function rv(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Sn(e){if(e==null)throw new Error("ContentUnion is required");return Ef(e)?e:{role:"user",parts:Rb(e)}}function nm(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(s=>{const a=Sn(s);return a.parts&&a.parts.length>0&&a.parts[0].text!==void 0?[a.parts[0].text]:[]});if(e.isVertexAI()){const s=Sn(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]}return Array.isArray(t)?t.map(s=>Sn(s)):[Sn(t)]}function rs(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(av(e)||rv(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Sn(e)]}const t=[],s=[],a=Ef(e[0]);for(const i of e){const l=Ef(i);if(l!=a)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)t.push(i);else{if(av(i)||rv(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");s.push(i)}}return a||t.push({role:"user",parts:Rb(s)}),t}function MI(e,t){e.includes("null")&&(t.nullable=!0);const s=e.filter(a=>a!=="null");if(s.length===1)t.type=Object.values(fn).includes(s[0].toUpperCase())?s[0].toUpperCase():fn.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const a of s)t.anyOf.push({type:Object.values(fn).includes(a.toUpperCase())?a.toUpperCase():fn.TYPE_UNSPECIFIED})}}function _i(e){const t={},s=["items"],a=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=e.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(t.nullable=!0,e=l[1]):l[1].type==="null"&&(t.nullable=!0,e=l[0])),e.type instanceof Array&&MI(e.type,t);for(const[c,u]of Object.entries(e))if(u!=null)if(c=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;t.type=Object.values(fn).includes(u.toUpperCase())?u.toUpperCase():fn.TYPE_UNSPECIFIED}else if(s.includes(c))t[c]=_i(u);else if(a.includes(c)){const f=[];for(const h of u){if(h.type=="null"){t.nullable=!0;continue}f.push(_i(h))}t[c]=f}else if(i.includes(c)){const f={};for(const[h,m]of Object.entries(u))f[h]=_i(m);t[c]=f}else{if(c==="additionalProperties")continue;t[c]=u}return t}function sm(e){return _i(e)}function am(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function rm(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Di(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=_i(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=_i(t.response));return e}function Ri(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const s of e)t.push(s);return t}function PI(e,t,s,a=1){const i=!t.startsWith(`${s}/`)&&t.split("/").length===a;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${s}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${s}/${t}`:t:i?`${s}/${t}`:t}function ba(e,t){if(typeof t!="string")throw new Error("name must be a string");return PI(e,t,"cachedContents")}function Mb(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function er(e){return Zf(e)}function OI(e){return e!=null&&typeof e=="object"&&"name"in e}function LI(e){return e!=null&&typeof e=="object"&&"video"in e}function UI(e){return e!=null&&typeof e=="object"&&"uri"in e}function Pb(e){var t;let s;if(OI(e)&&(s=e.name),!(UI(e)&&(s=e.uri,s===void 0))&&!(LI(e)&&(s=(t=e.video)===null||t===void 0?void 0:t.uri,s===void 0))){if(typeof e=="string"&&(s=e),s===void 0)throw new Error("Could not extract file name from the provided input.");if(s.startsWith("https://")){const i=s.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${s}`);s=i[0]}else s.startsWith("files/")&&(s=s.split("files/")[1]);return s}}function Ob(e,t){let s;return e.isVertexAI()?s=t?"publishers/google/models":"models":s=t?"models":"tunedModels",s}function Lb(e){for(const t of["models","tunedModels","publisherModels"])if(FI(e,t))return e[t];return[]}function FI(e,t){return e!==null&&typeof e=="object"&&t in e}function BI(e,t={}){const s=e,a={name:s.name,description:s.description,parametersJsonSchema:s.inputSchema};return s.outputSchema&&(a.responseJsonSchema=s.outputSchema),t.behavior&&(a.behavior=t.behavior),{functionDeclarations:[a]}}function GI(e,t={}){const s=[],a=new Set;for(const i of e){const l=i.name;if(a.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);a.add(l);const c=BI(i,t);c.functionDeclarations&&s.push(...c.functionDeclarations)}return{functionDeclarations:s}}function Ub(e,t){let s;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))s={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))s={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))s={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");s={inlinedRequests:t}}else s=t;const a=[s.gcsUri,s.bigqueryUri].filter(Boolean).length,i=[s.inlinedRequests,s.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||a!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(a>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return s}function zI(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function Fb(e){if(typeof e!="object"||e===null)return{};const t=e,s=t.inlinedResponses;if(typeof s!="object"||s===null)return e;const i=s.inlinedResponses;if(!Array.isArray(i)||i.length===0)return e;let l=!1;for(const c of i){if(typeof c!="object"||c===null)continue;const f=c.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){l=!0;break}}return l&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Mi(e,t){const s=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(s))return s.split("/").pop();throw new Error(`Invalid batch job name: ${s}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(s))return s.split("/").pop();if(/^\d+$/.test(s))return s;throw new Error(`Invalid batch job name: ${s}.`)}function Bb(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}function $I(e){return e.includes("gemini")&&e!=="gemini-embedding-001"||e.includes("maas")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HI(e){const t={},s=g(e,["responsesFile"]);s!=null&&v(t,["fileName"],s);const a=g(e,["inlinedResponses","inlinedResponses"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>TA(c))),v(t,["inlinedResponses"],l)}const i=g(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["inlinedEmbedContentResponses"],l)}return t}function qI(e){const t={},s=g(e,["predictionsFormat"]);s!=null&&v(t,["format"],s);const a=g(e,["gcsDestination","outputUriPrefix"]);a!=null&&v(t,["gcsUri"],a);const i=g(e,["bigqueryDestination","outputUri"]);return i!=null&&v(t,["bigqueryUri"],i),t}function VI(e){const t={},s=g(e,["format"]);s!=null&&v(t,["predictionsFormat"],s);const a=g(e,["gcsUri"]);a!=null&&v(t,["gcsDestination","outputUriPrefix"],a);const i=g(e,["bigqueryUri"]);if(i!=null&&v(t,["bigqueryDestination","outputUri"],i),g(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(g(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Kc(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata","displayName"]);a!=null&&v(t,["displayName"],a);const i=g(e,["metadata","state"]);i!=null&&v(t,["state"],Bb(i));const l=g(e,["metadata","createTime"]);l!=null&&v(t,["createTime"],l);const c=g(e,["metadata","endTime"]);c!=null&&v(t,["endTime"],c);const u=g(e,["metadata","updateTime"]);u!=null&&v(t,["updateTime"],u);const f=g(e,["metadata","model"]);f!=null&&v(t,["model"],f);const h=g(e,["metadata","output"]);return h!=null&&v(t,["dest"],HI(Fb(h))),t}function Cf(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["displayName"]);a!=null&&v(t,["displayName"],a);const i=g(e,["state"]);i!=null&&v(t,["state"],Bb(i));const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["createTime"]);c!=null&&v(t,["createTime"],c);const u=g(e,["startTime"]);u!=null&&v(t,["startTime"],u);const f=g(e,["endTime"]);f!=null&&v(t,["endTime"],f);const h=g(e,["updateTime"]);h!=null&&v(t,["updateTime"],h);const m=g(e,["model"]);m!=null&&v(t,["model"],m);const x=g(e,["inputConfig"]);x!=null&&v(t,["src"],KI(x));const y=g(e,["outputConfig"]);y!=null&&v(t,["dest"],qI(Fb(y)));const b=g(e,["completionStats"]);return b!=null&&v(t,["completionStats"],b),t}function KI(e){const t={},s=g(e,["instancesFormat"]);s!=null&&v(t,["format"],s);const a=g(e,["gcsSource","uris"]);a!=null&&v(t,["gcsUri"],a);const i=g(e,["bigquerySource","inputUri"]);return i!=null&&v(t,["bigqueryUri"],i),t}function WI(e,t){const s={};if(g(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(g(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const a=g(t,["fileName"]);a!=null&&v(s,["fileName"],a);const i=g(t,["inlinedRequests"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>wA(e,c))),v(s,["requests","requests"],l)}return s}function JI(e){const t={},s=g(e,["format"]);s!=null&&v(t,["instancesFormat"],s);const a=g(e,["gcsUri"]);a!=null&&v(t,["gcsSource","uris"],a);const i=g(e,["bigqueryUri"]);if(i!=null&&v(t,["bigquerySource","inputUri"],i),g(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function YI(e){const t={},s=g(e,["data"]);if(s!=null&&v(t,["data"],s),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function XI(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function QI(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function ZI(e){const t={},s=g(e,["content"]);s!=null&&v(t,["content"],s);const a=g(e,["citationMetadata"]);a!=null&&v(t,["citationMetadata"],eA(a));const i=g(e,["tokenCount"]);i!=null&&v(t,["tokenCount"],i);const l=g(e,["finishReason"]);l!=null&&v(t,["finishReason"],l);const c=g(e,["avgLogprobs"]);c!=null&&v(t,["avgLogprobs"],c);const u=g(e,["groundingMetadata"]);u!=null&&v(t,["groundingMetadata"],u);const f=g(e,["index"]);f!=null&&v(t,["index"],f);const h=g(e,["logprobsResult"]);h!=null&&v(t,["logprobsResult"],h);const m=g(e,["safetyRatings"]);if(m!=null){let y=m;Array.isArray(y)&&(y=y.map(b=>b)),v(t,["safetyRatings"],y)}const x=g(e,["urlContextMetadata"]);return x!=null&&v(t,["urlContextMetadata"],x),t}function eA(e){const t={},s=g(e,["citationSources"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(i=>i)),v(t,["citations"],a)}return t}function Gb(e){const t={},s=g(e,["parts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(l=>kA(l))),v(t,["parts"],i)}const a=g(e,["role"]);return a!=null&&v(t,["role"],a),t}function tA(e,t){const s={},a=g(e,["displayName"]);if(t!==void 0&&a!=null&&v(t,["batch","displayName"],a),g(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return s}function nA(e,t){const s={},a=g(e,["displayName"]);t!==void 0&&a!=null&&v(t,["displayName"],a);const i=g(e,["dest"]);return t!==void 0&&i!=null&&v(t,["outputConfig"],VI(zI(i))),s}function iv(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["_url","model"],Et(e,a));const i=g(t,["src"]);i!=null&&v(s,["batch","inputConfig"],WI(e,Ub(e,i)));const l=g(t,["config"]);return l!=null&&tA(l,s),s}function sA(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["model"],Et(e,a));const i=g(t,["src"]);i!=null&&v(s,["inputConfig"],JI(Ub(e,i)));const l=g(t,["config"]);return l!=null&&nA(l,s),s}function aA(e,t){const s={},a=g(e,["displayName"]);return t!==void 0&&a!=null&&v(t,["batch","displayName"],a),s}function rA(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["_url","model"],Et(e,a));const i=g(t,["src"]);i!=null&&v(s,["batch","inputConfig"],hA(e,i));const l=g(t,["config"]);return l!=null&&aA(l,s),s}function iA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function oA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function lA(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["name"]);a!=null&&v(t,["name"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);return l!=null&&v(t,["error"],l),t}function cA(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["name"]);a!=null&&v(t,["name"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);return l!=null&&v(t,["error"],l),t}function dA(e,t){const s={},a=g(t,["contents"]);if(a!=null){let l=nm(e,a);Array.isArray(l)&&(l=l.map(c=>c)),v(s,["requests[]","request","content"],l)}const i=g(t,["config"]);return i!=null&&(v(s,["_self"],uA(i,s)),rI(s,{"requests[].*":"requests[].request.*"})),s}function uA(e,t){const s={},a=g(e,["taskType"]);t!==void 0&&a!=null&&v(t,["requests[]","taskType"],a);const i=g(e,["title"]);t!==void 0&&i!=null&&v(t,["requests[]","title"],i);const l=g(e,["outputDimensionality"]);if(t!==void 0&&l!=null&&v(t,["requests[]","outputDimensionality"],l),g(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function hA(e,t){const s={},a=g(t,["fileName"]);a!=null&&v(s,["file_name"],a);const i=g(t,["inlinedRequests"]);return i!=null&&v(s,["requests"],dA(e,i)),s}function fA(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=g(e,["fileUri"]);s!=null&&v(t,["fileUri"],s);const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function mA(e){const t={},s=g(e,["id"]);s!=null&&v(t,["id"],s);const a=g(e,["args"]);a!=null&&v(t,["args"],a);const i=g(e,["name"]);if(i!=null&&v(t,["name"],i),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function pA(e){const t={},s=g(e,["allowedFunctionNames"]);s!=null&&v(t,["allowedFunctionNames"],s);const a=g(e,["mode"]);if(a!=null&&v(t,["mode"],a),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function gA(e,t,s){const a={},i=g(t,["systemInstruction"]);s!==void 0&&i!=null&&v(s,["systemInstruction"],Gb(Sn(i)));const l=g(t,["temperature"]);l!=null&&v(a,["temperature"],l);const c=g(t,["topP"]);c!=null&&v(a,["topP"],c);const u=g(t,["topK"]);u!=null&&v(a,["topK"],u);const f=g(t,["candidateCount"]);f!=null&&v(a,["candidateCount"],f);const h=g(t,["maxOutputTokens"]);h!=null&&v(a,["maxOutputTokens"],h);const m=g(t,["stopSequences"]);m!=null&&v(a,["stopSequences"],m);const x=g(t,["responseLogprobs"]);x!=null&&v(a,["responseLogprobs"],x);const y=g(t,["logprobs"]);y!=null&&v(a,["logprobs"],y);const b=g(t,["presencePenalty"]);b!=null&&v(a,["presencePenalty"],b);const T=g(t,["frequencyPenalty"]);T!=null&&v(a,["frequencyPenalty"],T);const _=g(t,["seed"]);_!=null&&v(a,["seed"],_);const j=g(t,["responseMimeType"]);j!=null&&v(a,["responseMimeType"],j);const E=g(t,["responseSchema"]);E!=null&&v(a,["responseSchema"],sm(E));const k=g(t,["responseJsonSchema"]);if(k!=null&&v(a,["responseJsonSchema"],k),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=g(t,["safetySettings"]);if(s!==void 0&&C!=null){let z=C;Array.isArray(z)&&(z=z.map(Y=>DA(Y))),v(s,["safetySettings"],z)}const A=g(t,["tools"]);if(s!==void 0&&A!=null){let z=Ri(A);Array.isArray(z)&&(z=z.map(Y=>MA(Di(Y)))),v(s,["tools"],z)}const M=g(t,["toolConfig"]);if(s!==void 0&&M!=null&&v(s,["toolConfig"],RA(M)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const I=g(t,["cachedContent"]);s!==void 0&&I!=null&&v(s,["cachedContent"],ba(e,I));const P=g(t,["responseModalities"]);P!=null&&v(a,["responseModalities"],P);const D=g(t,["mediaResolution"]);D!=null&&v(a,["mediaResolution"],D);const U=g(t,["speechConfig"]);if(U!=null&&v(a,["speechConfig"],am(U)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=g(t,["thinkingConfig"]);O!=null&&v(a,["thinkingConfig"],O);const F=g(t,["imageConfig"]);F!=null&&v(a,["imageConfig"],SA(F));const q=g(t,["enableEnhancedCivicAnswers"]);if(q!=null&&v(a,["enableEnhancedCivicAnswers"],q),g(t,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return a}function yA(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["candidates"]);if(a!=null){let f=a;Array.isArray(f)&&(f=f.map(h=>ZI(h))),v(t,["candidates"],f)}const i=g(e,["modelVersion"]);i!=null&&v(t,["modelVersion"],i);const l=g(e,["promptFeedback"]);l!=null&&v(t,["promptFeedback"],l);const c=g(e,["responseId"]);c!=null&&v(t,["responseId"],c);const u=g(e,["usageMetadata"]);return u!=null&&v(t,["usageMetadata"],u),t}function xA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function vA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],Mi(e,a)),s}function bA(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=g(e,["enableWidget"]);return s!=null&&v(t,["enableWidget"],s),t}function NA(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=g(e,["timeRangeFilter"]);return s!=null&&v(t,["timeRangeFilter"],s),t}function SA(e){const t={},s=g(e,["aspectRatio"]);s!=null&&v(t,["aspectRatio"],s);const a=g(e,["imageSize"]);if(a!=null&&v(t,["imageSize"],a),g(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(g(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function wA(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["request","model"],Et(e,a));const i=g(t,["contents"]);if(i!=null){let u=rs(i);Array.isArray(u)&&(u=u.map(f=>Gb(f))),v(s,["request","contents"],u)}const l=g(t,["metadata"]);l!=null&&v(s,["metadata"],l);const c=g(t,["config"]);return c!=null&&v(s,["request","generationConfig"],gA(e,c,g(s,["request"],{}))),s}function TA(e){const t={},s=g(e,["response"]);s!=null&&v(t,["response"],yA(s));const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["error"]);return i!=null&&v(t,["error"],i),t}function jA(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);if(t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),g(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return s}function _A(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);t!==void 0&&i!=null&&v(t,["_query","pageToken"],i);const l=g(e,["filter"]);return t!==void 0&&l!=null&&v(t,["_query","filter"],l),s}function EA(e){const t={},s=g(e,["config"]);return s!=null&&jA(s,t),t}function CA(e){const t={},s=g(e,["config"]);return s!=null&&_A(s,t),t}function IA(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["operations"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Kc(c))),v(t,["batchJobs"],l)}return t}function AA(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["batchPredictionJobs"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Cf(c))),v(t,["batchJobs"],l)}return t}function kA(e){const t={},s=g(e,["mediaResolution"]);s!=null&&v(t,["mediaResolution"],s);const a=g(e,["codeExecutionResult"]);a!=null&&v(t,["codeExecutionResult"],a);const i=g(e,["executableCode"]);i!=null&&v(t,["executableCode"],i);const l=g(e,["fileData"]);l!=null&&v(t,["fileData"],fA(l));const c=g(e,["functionCall"]);c!=null&&v(t,["functionCall"],mA(c));const u=g(e,["functionResponse"]);u!=null&&v(t,["functionResponse"],u);const f=g(e,["inlineData"]);f!=null&&v(t,["inlineData"],YI(f));const h=g(e,["text"]);h!=null&&v(t,["text"],h);const m=g(e,["thought"]);m!=null&&v(t,["thought"],m);const x=g(e,["thoughtSignature"]);x!=null&&v(t,["thoughtSignature"],x);const y=g(e,["videoMetadata"]);return y!=null&&v(t,["videoMetadata"],y),t}function DA(e){const t={},s=g(e,["category"]);if(s!=null&&v(t,["category"],s),g(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const a=g(e,["threshold"]);return a!=null&&v(t,["threshold"],a),t}function RA(e){const t={},s=g(e,["retrievalConfig"]);s!=null&&v(t,["retrievalConfig"],s);const a=g(e,["functionCallingConfig"]);return a!=null&&v(t,["functionCallingConfig"],pA(a)),t}function MA(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(e,["computerUse"]);s!=null&&v(t,["computerUse"],s);const a=g(e,["fileSearch"]);a!=null&&v(t,["fileSearch"],a);const i=g(e,["codeExecution"]);if(i!=null&&v(t,["codeExecution"],i),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=g(e,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(t,["functionDeclarations"],m)}const c=g(e,["googleMaps"]);c!=null&&v(t,["googleMaps"],bA(c));const u=g(e,["googleSearch"]);u!=null&&v(t,["googleSearch"],NA(u));const f=g(e,["googleSearchRetrieval"]);f!=null&&v(t,["googleSearchRetrieval"],f);const h=g(e,["urlContext"]);return h!=null&&v(t,["urlContext"],h),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ya;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})(ya||(ya={}));class Ar{constructor(t,s,a,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=s,this.init(t,a,i)}init(t,s,a){var i,l;this.nameInternal=t,this.pageInternal=s[this.nameInternal]||[],this.sdkHttpResponseInternal=s==null?void 0:s.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!a||Object.keys(a).length===0?c={config:{}}:typeof a=="object"?c=Object.assign({},a):c=a,c.config&&(c.config.pageToken=s.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(l=(i=c.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PA extends va{constructor(t){super(),this.apiClient=t,this.list=async(s={})=>new Ar(ya.PAGED_ITEM_BATCH_JOBS,a=>this.listInternal(a),await this.listInternal(s),s),this.create=async s=>(this.apiClient.isVertexAI()&&(s.config=this.formatDestination(s.src,s.config)),this.createInternal(s)),this.createEmbeddings=async s=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(s)}}createInlinedGenerateContentRequest(t){const s=iv(this.apiClient,t),a=s._url,i=qe("{model}:batchGenerateContent",a),u=s.batch.inputConfig.requests,f=u.requests,h=[];for(const m of f){const x=Object.assign({},m);if(x.systemInstruction){const y=x.systemInstruction;delete x.systemInstruction;const b=x.request;b.systemInstruction=y,x.request=b}h.push(x)}return u.requests=h,delete s.config,delete s._url,delete s._query,{path:i,body:s}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,s){const a=s?Object.assign({},s):{},i=Date.now().toString();if(a.displayName||(a.displayName=`genaiBatchJob_${i}`),a.dest===void 0){const l=this.getGcsUri(t),c=this.getBigqueryUri(t);if(l)l.endsWith(".jsonl")?a.dest=`${l.slice(0,-6)}/dest`:a.dest=`${l}_dest_${i}`;else if(c)a.dest=`${c}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return a}async createInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=sA(this.apiClient,t);return u=qe("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>Cf(m))}else{const h=iv(this.apiClient,t);return u=qe("{model}:batchGenerateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Kc(m))}}async createEmbeddingsInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rA(this.apiClient,t);return l=qe("{model}:asyncBatchEmbedContent",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>Kc(f))}}async get(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=vA(this.apiClient,t);return u=qe("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>Cf(m))}else{const h=xA(this.apiClient,t);return u=qe("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Kc(m))}}async cancel(t){var s,a,i,l;let c="",u={};if(this.apiClient.isVertexAI()){const f=QI(this.apiClient,t);c=qe("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}else{const f=XI(this.apiClient,t);c=qe("batches/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=CA(t);return u=qe("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=AA(m),y=new nv;return Object.assign(y,x),y})}else{const h=EA(t);return u=qe("batches",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=IA(m),y=new nv;return Object.assign(y,x),y})}}async delete(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=oA(this.apiClient,t);return u=qe("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>cA(m))}else{const h=iA(this.apiClient,t);return u=qe("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>lA(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OA(e){const t={},s=g(e,["data"]);if(s!=null&&v(t,["data"],s),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function ov(e){const t={},s=g(e,["parts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(l=>rk(l))),v(t,["parts"],i)}const a=g(e,["role"]);return a!=null&&v(t,["role"],a),t}function LA(e,t){const s={},a=g(e,["ttl"]);t!==void 0&&a!=null&&v(t,["ttl"],a);const i=g(e,["expireTime"]);t!==void 0&&i!=null&&v(t,["expireTime"],i);const l=g(e,["displayName"]);t!==void 0&&l!=null&&v(t,["displayName"],l);const c=g(e,["contents"]);if(t!==void 0&&c!=null){let m=rs(c);Array.isArray(m)&&(m=m.map(x=>ov(x))),v(t,["contents"],m)}const u=g(e,["systemInstruction"]);t!==void 0&&u!=null&&v(t,["systemInstruction"],ov(Sn(u)));const f=g(e,["tools"]);if(t!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(x=>ok(x))),v(t,["tools"],m)}const h=g(e,["toolConfig"]);if(t!==void 0&&h!=null&&v(t,["toolConfig"],ik(h)),g(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return s}function UA(e,t){const s={},a=g(e,["ttl"]);t!==void 0&&a!=null&&v(t,["ttl"],a);const i=g(e,["expireTime"]);t!==void 0&&i!=null&&v(t,["expireTime"],i);const l=g(e,["displayName"]);t!==void 0&&l!=null&&v(t,["displayName"],l);const c=g(e,["contents"]);if(t!==void 0&&c!=null){let x=rs(c);Array.isArray(x)&&(x=x.map(y=>y)),v(t,["contents"],x)}const u=g(e,["systemInstruction"]);t!==void 0&&u!=null&&v(t,["systemInstruction"],Sn(u));const f=g(e,["tools"]);if(t!==void 0&&f!=null){let x=f;Array.isArray(x)&&(x=x.map(y=>lk(y))),v(t,["tools"],x)}const h=g(e,["toolConfig"]);t!==void 0&&h!=null&&v(t,["toolConfig"],h);const m=g(e,["kmsKeyName"]);return t!==void 0&&m!=null&&v(t,["encryption_spec","kmsKeyName"],m),s}function FA(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["model"],Ib(e,a));const i=g(t,["config"]);return i!=null&&LA(i,s),s}function BA(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["model"],Ib(e,a));const i=g(t,["config"]);return i!=null&&UA(i,s),s}function GA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],ba(e,a)),s}function zA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],ba(e,a)),s}function $A(e){const t={},s=g(e,["sdkHttpResponse"]);return s!=null&&v(t,["sdkHttpResponse"],s),t}function HA(e){const t={},s=g(e,["sdkHttpResponse"]);return s!=null&&v(t,["sdkHttpResponse"],s),t}function qA(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=g(e,["fileUri"]);s!=null&&v(t,["fileUri"],s);const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function VA(e){const t={},s=g(e,["id"]);s!=null&&v(t,["id"],s);const a=g(e,["args"]);a!=null&&v(t,["args"],a);const i=g(e,["name"]);if(i!=null&&v(t,["name"],i),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function KA(e){const t={},s=g(e,["allowedFunctionNames"]);s!=null&&v(t,["allowedFunctionNames"],s);const a=g(e,["mode"]);if(a!=null&&v(t,["mode"],a),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function WA(e){const t={},s=g(e,["description"]);s!=null&&v(t,["description"],s);const a=g(e,["name"]);a!=null&&v(t,["name"],a);const i=g(e,["parameters"]);i!=null&&v(t,["parameters"],i);const l=g(e,["parametersJsonSchema"]);l!=null&&v(t,["parametersJsonSchema"],l);const c=g(e,["response"]);c!=null&&v(t,["response"],c);const u=g(e,["responseJsonSchema"]);if(u!=null&&v(t,["responseJsonSchema"],u),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function JA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],ba(e,a)),s}function YA(e,t){const s={},a=g(t,["name"]);return a!=null&&v(s,["_url","name"],ba(e,a)),s}function XA(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=g(e,["enableWidget"]);return s!=null&&v(t,["enableWidget"],s),t}function QA(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=g(e,["timeRangeFilter"]);return s!=null&&v(t,["timeRangeFilter"],s),t}function ZA(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);return t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),s}function ek(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);return t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),s}function tk(e){const t={},s=g(e,["config"]);return s!=null&&ZA(s,t),t}function nk(e){const t={},s=g(e,["config"]);return s!=null&&ek(s,t),t}function sk(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["cachedContents"],l)}return t}function ak(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["cachedContents"],l)}return t}function rk(e){const t={},s=g(e,["mediaResolution"]);s!=null&&v(t,["mediaResolution"],s);const a=g(e,["codeExecutionResult"]);a!=null&&v(t,["codeExecutionResult"],a);const i=g(e,["executableCode"]);i!=null&&v(t,["executableCode"],i);const l=g(e,["fileData"]);l!=null&&v(t,["fileData"],qA(l));const c=g(e,["functionCall"]);c!=null&&v(t,["functionCall"],VA(c));const u=g(e,["functionResponse"]);u!=null&&v(t,["functionResponse"],u);const f=g(e,["inlineData"]);f!=null&&v(t,["inlineData"],OA(f));const h=g(e,["text"]);h!=null&&v(t,["text"],h);const m=g(e,["thought"]);m!=null&&v(t,["thought"],m);const x=g(e,["thoughtSignature"]);x!=null&&v(t,["thoughtSignature"],x);const y=g(e,["videoMetadata"]);return y!=null&&v(t,["videoMetadata"],y),t}function ik(e){const t={},s=g(e,["retrievalConfig"]);s!=null&&v(t,["retrievalConfig"],s);const a=g(e,["functionCallingConfig"]);return a!=null&&v(t,["functionCallingConfig"],KA(a)),t}function ok(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(e,["computerUse"]);s!=null&&v(t,["computerUse"],s);const a=g(e,["fileSearch"]);a!=null&&v(t,["fileSearch"],a);const i=g(e,["codeExecution"]);if(i!=null&&v(t,["codeExecution"],i),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=g(e,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(t,["functionDeclarations"],m)}const c=g(e,["googleMaps"]);c!=null&&v(t,["googleMaps"],XA(c));const u=g(e,["googleSearch"]);u!=null&&v(t,["googleSearch"],QA(u));const f=g(e,["googleSearchRetrieval"]);f!=null&&v(t,["googleSearchRetrieval"],f);const h=g(e,["urlContext"]);return h!=null&&v(t,["urlContext"],h),t}function lk(e){const t={},s=g(e,["retrieval"]);s!=null&&v(t,["retrieval"],s);const a=g(e,["computerUse"]);if(a!=null&&v(t,["computerUse"],a),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=g(e,["codeExecution"]);i!=null&&v(t,["codeExecution"],i);const l=g(e,["enterpriseWebSearch"]);l!=null&&v(t,["enterpriseWebSearch"],l);const c=g(e,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(y=>WA(y))),v(t,["functionDeclarations"],x)}const u=g(e,["googleMaps"]);u!=null&&v(t,["googleMaps"],u);const f=g(e,["googleSearch"]);f!=null&&v(t,["googleSearch"],f);const h=g(e,["googleSearchRetrieval"]);h!=null&&v(t,["googleSearchRetrieval"],h);const m=g(e,["urlContext"]);return m!=null&&v(t,["urlContext"],m),t}function ck(e,t){const s={},a=g(e,["ttl"]);t!==void 0&&a!=null&&v(t,["ttl"],a);const i=g(e,["expireTime"]);return t!==void 0&&i!=null&&v(t,["expireTime"],i),s}function dk(e,t){const s={},a=g(e,["ttl"]);t!==void 0&&a!=null&&v(t,["ttl"],a);const i=g(e,["expireTime"]);return t!==void 0&&i!=null&&v(t,["expireTime"],i),s}function uk(e,t){const s={},a=g(t,["name"]);a!=null&&v(s,["_url","name"],ba(e,a));const i=g(t,["config"]);return i!=null&&ck(i,s),s}function hk(e,t){const s={},a=g(t,["name"]);a!=null&&v(s,["_url","name"],ba(e,a));const i=g(t,["config"]);return i!=null&&dk(i,s),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fk extends va{constructor(t){super(),this.apiClient=t,this.list=async(s={})=>new Ar(ya.PAGED_ITEM_CACHED_CONTENTS,a=>this.listInternal(a),await this.listInternal(s),s)}async create(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=BA(this.apiClient,t);return u=qe("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=FA(this.apiClient,t);return u=qe("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async get(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=YA(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=JA(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async delete(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=zA(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=HA(m),y=new ev;return Object.assign(y,x),y})}else{const h=GA(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=$A(m),y=new ev;return Object.assign(y,x),y})}}async update(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=hk(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=uk(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async listInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=nk(t);return u=qe("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=ak(m),y=new tv;return Object.assign(y,x),y})}else{const h=tk(t);return u=qe("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=sk(m),y=new tv;return Object.assign(y,x),y})}}}function rd(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]]);return s}function lv(e){var t=typeof Symbol=="function"&&Symbol.iterator,s=t&&e[t],a=0;if(s)return s.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function lt(e){return this instanceof lt?(this.v=e,this):new lt(e)}function Is(e,t,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s.apply(e,t||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(b){return function(T){return Promise.resolve(T).then(b,x)}}function u(b,T){a[b]&&(i[b]=function(_){return new Promise(function(j,E){l.push([b,_,j,E])>1||f(b,_)})},T&&(i[b]=T(i[b])))}function f(b,T){try{h(a[b](T))}catch(_){y(l[0][3],_)}}function h(b){b.value instanceof lt?Promise.resolve(b.value.v).then(m,x):y(l[0][2],b)}function m(b){f("next",b)}function x(b){f("throw",b)}function y(b,T){b(T),l.shift(),l.length&&f(l[0][0],l[0][1])}}function As(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],s;return t?t.call(e):(e=typeof lv=="function"?lv(e):e[Symbol.iterator](),s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s);function a(l){s[l]=e[l]&&function(c){return new Promise(function(u,f){c=e[l](c),i(u,f,c.done,c.value)})}}function i(l,c,u,f){Promise.resolve(f).then(function(h){l({value:h,done:u})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mk(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const s=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return s===void 0?!1:zb(s)}function zb(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function pk(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function cv(e){if(e===void 0||e.length===0)return[];const t=[],s=e.length;let a=0;for(;a<s;)if(e[a].role==="user")t.push(e[a]),a++;else{const i=[];let l=!0;for(;a<s&&e[a].role==="model";)i.push(e[a]),l&&!zb(e[a])&&(l=!1),a++;l?t.push(...i):t.pop()}return t}class gk{constructor(t,s){this.modelsModule=t,this.apiClient=s}create(t){return new yk(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class yk{constructor(t,s,a,i={},l=[]){this.apiClient=t,this.modelsModule=s,this.model=a,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),pk(l)}async sendMessage(t){var s;await this.sendPromise;const a=Sn(t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(a),config:(s=t.config)!==null&&s!==void 0?s:this.config});return this.sendPromise=(async()=>{var l,c,u;const f=await i,h=(c=(l=f.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content,m=f.automaticFunctionCallingHistory,x=this.getHistory(!0).length;let y=[];m!=null&&(y=(u=m.slice(x))!==null&&u!==void 0?u:[]);const b=h?[h]:[];this.recordHistory(a,b,y)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(t){var s;await this.sendPromise;const a=Sn(t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(a),config:(s=t.config)!==null&&s!==void 0?s:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const l=await i;return this.processStreamResponse(l,a)}getHistory(t=!1){const s=t?cv(this.history):this.history;return structuredClone(s)}processStreamResponse(t,s){return Is(this,arguments,function*(){var i,l,c,u,f,h;const m=[];try{for(var x=!0,y=As(t),b;b=yield lt(y.next()),i=b.done,!i;x=!0){u=b.value,x=!1;const T=u;if(mk(T)){const _=(h=(f=T.candidates)===null||f===void 0?void 0:f[0])===null||h===void 0?void 0:h.content;_!==void 0&&m.push(_)}yield yield lt(T)}}catch(T){l={error:T}}finally{try{!x&&!i&&(c=y.return)&&(yield lt(c.call(y)))}finally{if(l)throw l.error}}this.recordHistory(s,m)})}recordHistory(t,s,a){let i=[];s.length>0&&s.every(l=>l.role!==void 0)?i=s:i.push({role:"model",parts:[]}),a&&a.length>0?this.history.push(...cv(a)):this.history.push(t),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class al extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,al.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xk(e){const t={},s=g(e,["file"]);return s!=null&&v(t,["file"],s),t}function vk(e){const t={},s=g(e,["sdkHttpResponse"]);return s!=null&&v(t,["sdkHttpResponse"],s),t}function bk(e){const t={},s=g(e,["name"]);return s!=null&&v(t,["_url","file"],Pb(s)),t}function Nk(e){const t={},s=g(e,["sdkHttpResponse"]);return s!=null&&v(t,["sdkHttpResponse"],s),t}function Sk(e){const t={},s=g(e,["name"]);return s!=null&&v(t,["_url","file"],Pb(s)),t}function wk(e){const t={},s=g(e,["uris"]);return s!=null&&v(t,["uris"],s),t}function Tk(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);return t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),s}function jk(e){const t={},s=g(e,["config"]);return s!=null&&Tk(s,t),t}function _k(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["files"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["files"],l)}return t}function Ek(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(l=>l)),v(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ck extends va{constructor(t){super(),this.apiClient=t,this.list=async(s={})=>new Ar(ya.PAGED_ITEM_FILES,a=>this.listInternal(a),await this.listInternal(s),s)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(s=>s)}async download(t){await this.apiClient.downloadFile(t)}async registerFiles(t){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(t){return this.registerFilesInternal(t)}async listInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=jk(t);return l=qe("files",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=_k(f),m=new CI;return Object.assign(m,h),m})}}async createInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=xk(t);return l=qe("upload/v1beta/files",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=vk(f),m=new II;return Object.assign(m,h),m})}}async get(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Sk(t);return l=qe("files/{file}",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=bk(t);return l=qe("files/{file}",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=Nk(f),m=new AI;return Object.assign(m,h),m})}}async registerFilesInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=wk(t);return l=qe("files:register",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=Ek(f),m=new kI;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wc(e){const t={},s=g(e,["data"]);if(s!=null&&v(t,["data"],s),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function Ik(e){const t={},s=g(e,["parts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(l=>qk(l))),v(t,["parts"],i)}const a=g(e,["role"]);return a!=null&&v(t,["role"],a),t}function Ak(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=g(e,["fileUri"]);s!=null&&v(t,["fileUri"],s);const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function kk(e){const t={},s=g(e,["id"]);s!=null&&v(t,["id"],s);const a=g(e,["args"]);a!=null&&v(t,["args"],a);const i=g(e,["name"]);if(i!=null&&v(t,["name"],i),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function Dk(e){const t={},s=g(e,["description"]);s!=null&&v(t,["description"],s);const a=g(e,["name"]);a!=null&&v(t,["name"],a);const i=g(e,["parameters"]);i!=null&&v(t,["parameters"],i);const l=g(e,["parametersJsonSchema"]);l!=null&&v(t,["parametersJsonSchema"],l);const c=g(e,["response"]);c!=null&&v(t,["response"],c);const u=g(e,["responseJsonSchema"]);if(u!=null&&v(t,["responseJsonSchema"],u),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function Rk(e){const t={},s=g(e,["modelSelectionConfig"]);s!=null&&v(t,["modelConfig"],s);const a=g(e,["responseJsonSchema"]);a!=null&&v(t,["responseJsonSchema"],a);const i=g(e,["audioTimestamp"]);i!=null&&v(t,["audioTimestamp"],i);const l=g(e,["candidateCount"]);l!=null&&v(t,["candidateCount"],l);const c=g(e,["enableAffectiveDialog"]);c!=null&&v(t,["enableAffectiveDialog"],c);const u=g(e,["frequencyPenalty"]);u!=null&&v(t,["frequencyPenalty"],u);const f=g(e,["logprobs"]);f!=null&&v(t,["logprobs"],f);const h=g(e,["maxOutputTokens"]);h!=null&&v(t,["maxOutputTokens"],h);const m=g(e,["mediaResolution"]);m!=null&&v(t,["mediaResolution"],m);const x=g(e,["presencePenalty"]);x!=null&&v(t,["presencePenalty"],x);const y=g(e,["responseLogprobs"]);y!=null&&v(t,["responseLogprobs"],y);const b=g(e,["responseMimeType"]);b!=null&&v(t,["responseMimeType"],b);const T=g(e,["responseModalities"]);T!=null&&v(t,["responseModalities"],T);const _=g(e,["responseSchema"]);_!=null&&v(t,["responseSchema"],_);const j=g(e,["routingConfig"]);j!=null&&v(t,["routingConfig"],j);const E=g(e,["seed"]);E!=null&&v(t,["seed"],E);const k=g(e,["speechConfig"]);k!=null&&v(t,["speechConfig"],k);const C=g(e,["stopSequences"]);C!=null&&v(t,["stopSequences"],C);const A=g(e,["temperature"]);A!=null&&v(t,["temperature"],A);const M=g(e,["thinkingConfig"]);M!=null&&v(t,["thinkingConfig"],M);const I=g(e,["topK"]);I!=null&&v(t,["topK"],I);const P=g(e,["topP"]);if(P!=null&&v(t,["topP"],P),g(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function Mk(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=g(e,["enableWidget"]);return s!=null&&v(t,["enableWidget"],s),t}function Pk(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=g(e,["timeRangeFilter"]);return s!=null&&v(t,["timeRangeFilter"],s),t}function Ok(e,t){const s={},a=g(e,["generationConfig"]);t!==void 0&&a!=null&&v(t,["setup","generationConfig"],a);const i=g(e,["responseModalities"]);t!==void 0&&i!=null&&v(t,["setup","generationConfig","responseModalities"],i);const l=g(e,["temperature"]);t!==void 0&&l!=null&&v(t,["setup","generationConfig","temperature"],l);const c=g(e,["topP"]);t!==void 0&&c!=null&&v(t,["setup","generationConfig","topP"],c);const u=g(e,["topK"]);t!==void 0&&u!=null&&v(t,["setup","generationConfig","topK"],u);const f=g(e,["maxOutputTokens"]);t!==void 0&&f!=null&&v(t,["setup","generationConfig","maxOutputTokens"],f);const h=g(e,["mediaResolution"]);t!==void 0&&h!=null&&v(t,["setup","generationConfig","mediaResolution"],h);const m=g(e,["seed"]);t!==void 0&&m!=null&&v(t,["setup","generationConfig","seed"],m);const x=g(e,["speechConfig"]);t!==void 0&&x!=null&&v(t,["setup","generationConfig","speechConfig"],rm(x));const y=g(e,["thinkingConfig"]);t!==void 0&&y!=null&&v(t,["setup","generationConfig","thinkingConfig"],y);const b=g(e,["enableAffectiveDialog"]);t!==void 0&&b!=null&&v(t,["setup","generationConfig","enableAffectiveDialog"],b);const T=g(e,["systemInstruction"]);t!==void 0&&T!=null&&v(t,["setup","systemInstruction"],Ik(Sn(T)));const _=g(e,["tools"]);if(t!==void 0&&_!=null){let I=Ri(_);Array.isArray(I)&&(I=I.map(P=>Kk(Di(P)))),v(t,["setup","tools"],I)}const j=g(e,["sessionResumption"]);t!==void 0&&j!=null&&v(t,["setup","sessionResumption"],Vk(j));const E=g(e,["inputAudioTranscription"]);t!==void 0&&E!=null&&v(t,["setup","inputAudioTranscription"],E);const k=g(e,["outputAudioTranscription"]);t!==void 0&&k!=null&&v(t,["setup","outputAudioTranscription"],k);const C=g(e,["realtimeInputConfig"]);t!==void 0&&C!=null&&v(t,["setup","realtimeInputConfig"],C);const A=g(e,["contextWindowCompression"]);t!==void 0&&A!=null&&v(t,["setup","contextWindowCompression"],A);const M=g(e,["proactivity"]);if(t!==void 0&&M!=null&&v(t,["setup","proactivity"],M),g(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return s}function Lk(e,t){const s={},a=g(e,["generationConfig"]);t!==void 0&&a!=null&&v(t,["setup","generationConfig"],Rk(a));const i=g(e,["responseModalities"]);t!==void 0&&i!=null&&v(t,["setup","generationConfig","responseModalities"],i);const l=g(e,["temperature"]);t!==void 0&&l!=null&&v(t,["setup","generationConfig","temperature"],l);const c=g(e,["topP"]);t!==void 0&&c!=null&&v(t,["setup","generationConfig","topP"],c);const u=g(e,["topK"]);t!==void 0&&u!=null&&v(t,["setup","generationConfig","topK"],u);const f=g(e,["maxOutputTokens"]);t!==void 0&&f!=null&&v(t,["setup","generationConfig","maxOutputTokens"],f);const h=g(e,["mediaResolution"]);t!==void 0&&h!=null&&v(t,["setup","generationConfig","mediaResolution"],h);const m=g(e,["seed"]);t!==void 0&&m!=null&&v(t,["setup","generationConfig","seed"],m);const x=g(e,["speechConfig"]);t!==void 0&&x!=null&&v(t,["setup","generationConfig","speechConfig"],rm(x));const y=g(e,["thinkingConfig"]);t!==void 0&&y!=null&&v(t,["setup","generationConfig","thinkingConfig"],y);const b=g(e,["enableAffectiveDialog"]);t!==void 0&&b!=null&&v(t,["setup","generationConfig","enableAffectiveDialog"],b);const T=g(e,["systemInstruction"]);t!==void 0&&T!=null&&v(t,["setup","systemInstruction"],Sn(T));const _=g(e,["tools"]);if(t!==void 0&&_!=null){let P=Ri(_);Array.isArray(P)&&(P=P.map(D=>Wk(Di(D)))),v(t,["setup","tools"],P)}const j=g(e,["sessionResumption"]);t!==void 0&&j!=null&&v(t,["setup","sessionResumption"],j);const E=g(e,["inputAudioTranscription"]);t!==void 0&&E!=null&&v(t,["setup","inputAudioTranscription"],E);const k=g(e,["outputAudioTranscription"]);t!==void 0&&k!=null&&v(t,["setup","outputAudioTranscription"],k);const C=g(e,["realtimeInputConfig"]);t!==void 0&&C!=null&&v(t,["setup","realtimeInputConfig"],C);const A=g(e,["contextWindowCompression"]);t!==void 0&&A!=null&&v(t,["setup","contextWindowCompression"],A);const M=g(e,["proactivity"]);t!==void 0&&M!=null&&v(t,["setup","proactivity"],M);const I=g(e,["explicitVadSignal"]);return t!==void 0&&I!=null&&v(t,["setup","explicitVadSignal"],I),s}function Uk(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["setup","model"],Et(e,a));const i=g(t,["config"]);return i!=null&&v(s,["config"],Ok(i,s)),s}function Fk(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["setup","model"],Et(e,a));const i=g(t,["config"]);return i!=null&&v(s,["config"],Lk(i,s)),s}function Bk(e){const t={},s=g(e,["musicGenerationConfig"]);return s!=null&&v(t,["musicGenerationConfig"],s),t}function Gk(e){const t={},s=g(e,["weightedPrompts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(i=>i)),v(t,["weightedPrompts"],a)}return t}function zk(e){const t={},s=g(e,["media"]);if(s!=null){let h=Ab(s);Array.isArray(h)&&(h=h.map(m=>Wc(m))),v(t,["mediaChunks"],h)}const a=g(e,["audio"]);a!=null&&v(t,["audio"],Wc(Db(a)));const i=g(e,["audioStreamEnd"]);i!=null&&v(t,["audioStreamEnd"],i);const l=g(e,["video"]);l!=null&&v(t,["video"],Wc(kb(l)));const c=g(e,["text"]);c!=null&&v(t,["text"],c);const u=g(e,["activityStart"]);u!=null&&v(t,["activityStart"],u);const f=g(e,["activityEnd"]);return f!=null&&v(t,["activityEnd"],f),t}function $k(e){const t={},s=g(e,["media"]);if(s!=null){let h=Ab(s);Array.isArray(h)&&(h=h.map(m=>m)),v(t,["mediaChunks"],h)}const a=g(e,["audio"]);a!=null&&v(t,["audio"],Db(a));const i=g(e,["audioStreamEnd"]);i!=null&&v(t,["audioStreamEnd"],i);const l=g(e,["video"]);l!=null&&v(t,["video"],kb(l));const c=g(e,["text"]);c!=null&&v(t,["text"],c);const u=g(e,["activityStart"]);u!=null&&v(t,["activityStart"],u);const f=g(e,["activityEnd"]);return f!=null&&v(t,["activityEnd"],f),t}function Hk(e){const t={},s=g(e,["setupComplete"]);s!=null&&v(t,["setupComplete"],s);const a=g(e,["serverContent"]);a!=null&&v(t,["serverContent"],a);const i=g(e,["toolCall"]);i!=null&&v(t,["toolCall"],i);const l=g(e,["toolCallCancellation"]);l!=null&&v(t,["toolCallCancellation"],l);const c=g(e,["usageMetadata"]);c!=null&&v(t,["usageMetadata"],Jk(c));const u=g(e,["goAway"]);u!=null&&v(t,["goAway"],u);const f=g(e,["sessionResumptionUpdate"]);f!=null&&v(t,["sessionResumptionUpdate"],f);const h=g(e,["voiceActivityDetectionSignal"]);h!=null&&v(t,["voiceActivityDetectionSignal"],h);const m=g(e,["voiceActivity"]);return m!=null&&v(t,["voiceActivity"],Yk(m)),t}function qk(e){const t={},s=g(e,["mediaResolution"]);s!=null&&v(t,["mediaResolution"],s);const a=g(e,["codeExecutionResult"]);a!=null&&v(t,["codeExecutionResult"],a);const i=g(e,["executableCode"]);i!=null&&v(t,["executableCode"],i);const l=g(e,["fileData"]);l!=null&&v(t,["fileData"],Ak(l));const c=g(e,["functionCall"]);c!=null&&v(t,["functionCall"],kk(c));const u=g(e,["functionResponse"]);u!=null&&v(t,["functionResponse"],u);const f=g(e,["inlineData"]);f!=null&&v(t,["inlineData"],Wc(f));const h=g(e,["text"]);h!=null&&v(t,["text"],h);const m=g(e,["thought"]);m!=null&&v(t,["thought"],m);const x=g(e,["thoughtSignature"]);x!=null&&v(t,["thoughtSignature"],x);const y=g(e,["videoMetadata"]);return y!=null&&v(t,["videoMetadata"],y),t}function Vk(e){const t={},s=g(e,["handle"]);if(s!=null&&v(t,["handle"],s),g(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function Kk(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(e,["computerUse"]);s!=null&&v(t,["computerUse"],s);const a=g(e,["fileSearch"]);a!=null&&v(t,["fileSearch"],a);const i=g(e,["codeExecution"]);if(i!=null&&v(t,["codeExecution"],i),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=g(e,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(t,["functionDeclarations"],m)}const c=g(e,["googleMaps"]);c!=null&&v(t,["googleMaps"],Mk(c));const u=g(e,["googleSearch"]);u!=null&&v(t,["googleSearch"],Pk(u));const f=g(e,["googleSearchRetrieval"]);f!=null&&v(t,["googleSearchRetrieval"],f);const h=g(e,["urlContext"]);return h!=null&&v(t,["urlContext"],h),t}function Wk(e){const t={},s=g(e,["retrieval"]);s!=null&&v(t,["retrieval"],s);const a=g(e,["computerUse"]);if(a!=null&&v(t,["computerUse"],a),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=g(e,["codeExecution"]);i!=null&&v(t,["codeExecution"],i);const l=g(e,["enterpriseWebSearch"]);l!=null&&v(t,["enterpriseWebSearch"],l);const c=g(e,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(y=>Dk(y))),v(t,["functionDeclarations"],x)}const u=g(e,["googleMaps"]);u!=null&&v(t,["googleMaps"],u);const f=g(e,["googleSearch"]);f!=null&&v(t,["googleSearch"],f);const h=g(e,["googleSearchRetrieval"]);h!=null&&v(t,["googleSearchRetrieval"],h);const m=g(e,["urlContext"]);return m!=null&&v(t,["urlContext"],m),t}function Jk(e){const t={},s=g(e,["promptTokenCount"]);s!=null&&v(t,["promptTokenCount"],s);const a=g(e,["cachedContentTokenCount"]);a!=null&&v(t,["cachedContentTokenCount"],a);const i=g(e,["candidatesTokenCount"]);i!=null&&v(t,["responseTokenCount"],i);const l=g(e,["toolUsePromptTokenCount"]);l!=null&&v(t,["toolUsePromptTokenCount"],l);const c=g(e,["thoughtsTokenCount"]);c!=null&&v(t,["thoughtsTokenCount"],c);const u=g(e,["totalTokenCount"]);u!=null&&v(t,["totalTokenCount"],u);const f=g(e,["promptTokensDetails"]);if(f!=null){let b=f;Array.isArray(b)&&(b=b.map(T=>T)),v(t,["promptTokensDetails"],b)}const h=g(e,["cacheTokensDetails"]);if(h!=null){let b=h;Array.isArray(b)&&(b=b.map(T=>T)),v(t,["cacheTokensDetails"],b)}const m=g(e,["candidatesTokensDetails"]);if(m!=null){let b=m;Array.isArray(b)&&(b=b.map(T=>T)),v(t,["responseTokensDetails"],b)}const x=g(e,["toolUsePromptTokensDetails"]);if(x!=null){let b=x;Array.isArray(b)&&(b=b.map(T=>T)),v(t,["toolUsePromptTokensDetails"],b)}const y=g(e,["trafficType"]);return y!=null&&v(t,["trafficType"],y),t}function Yk(e){const t={},s=g(e,["type"]);return s!=null&&v(t,["voiceActivityType"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xk(e,t){const s={},a=g(e,["data"]);if(a!=null&&v(s,["data"],a),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(e,["mimeType"]);return i!=null&&v(s,["mimeType"],i),s}function Qk(e,t){const s={},a=g(e,["content"]);a!=null&&v(s,["content"],a);const i=g(e,["citationMetadata"]);i!=null&&v(s,["citationMetadata"],Zk(i));const l=g(e,["tokenCount"]);l!=null&&v(s,["tokenCount"],l);const c=g(e,["finishReason"]);c!=null&&v(s,["finishReason"],c);const u=g(e,["avgLogprobs"]);u!=null&&v(s,["avgLogprobs"],u);const f=g(e,["groundingMetadata"]);f!=null&&v(s,["groundingMetadata"],f);const h=g(e,["index"]);h!=null&&v(s,["index"],h);const m=g(e,["logprobsResult"]);m!=null&&v(s,["logprobsResult"],m);const x=g(e,["safetyRatings"]);if(x!=null){let b=x;Array.isArray(b)&&(b=b.map(T=>T)),v(s,["safetyRatings"],b)}const y=g(e,["urlContextMetadata"]);return y!=null&&v(s,["urlContextMetadata"],y),s}function Zk(e,t){const s={},a=g(e,["citationSources"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(l=>l)),v(s,["citations"],i)}return s}function eD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let c=rs(l);Array.isArray(c)&&(c=c.map(u=>u)),v(a,["contents"],c)}return a}function tD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["tokensInfo"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(s,["tokensInfo"],l)}return s}function nD(e,t){const s={},a=g(e,["values"]);a!=null&&v(s,["values"],a);const i=g(e,["statistics"]);return i!=null&&v(s,["statistics"],sD(i)),s}function sD(e,t){const s={},a=g(e,["truncated"]);a!=null&&v(s,["truncated"],a);const i=g(e,["token_count"]);return i!=null&&v(s,["tokenCount"],i),s}function ll(e,t){const s={},a=g(e,["parts"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>hR(c))),v(s,["parts"],l)}const i=g(e,["role"]);return i!=null&&v(s,["role"],i),s}function aD(e,t){const s={},a=g(e,["controlType"]);a!=null&&v(s,["controlType"],a);const i=g(e,["enableControlImageComputation"]);return i!=null&&v(s,["computeControl"],i),s}function rD(e,t){const s={};if(g(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(g(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(g(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return s}function iD(e,t,s){const a={},i=g(e,["systemInstruction"]);t!==void 0&&i!=null&&v(t,["systemInstruction"],Sn(i));const l=g(e,["tools"]);if(t!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(f=>Vb(f))),v(t,["tools"],u)}const c=g(e,["generationConfig"]);return t!==void 0&&c!=null&&v(t,["generationConfig"],XD(c)),a}function oD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let u=rs(l);Array.isArray(u)&&(u=u.map(f=>ll(f))),v(a,["contents"],u)}const c=g(t,["config"]);return c!=null&&rD(c),a}function lD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let u=rs(l);Array.isArray(u)&&(u=u.map(f=>f)),v(a,["contents"],u)}const c=g(t,["config"]);return c!=null&&iD(c,a),a}function cD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["totalTokens"]);i!=null&&v(s,["totalTokens"],i);const l=g(e,["cachedContentTokenCount"]);return l!=null&&v(s,["cachedContentTokenCount"],l),s}function dD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["totalTokens"]);return i!=null&&v(s,["totalTokens"],i),s}function uD(e,t,s){const a={},i=g(t,["model"]);return i!=null&&v(a,["_url","name"],Et(e,i)),a}function hD(e,t,s){const a={},i=g(t,["model"]);return i!=null&&v(a,["_url","name"],Et(e,i)),a}function fD(e,t){const s={},a=g(e,["sdkHttpResponse"]);return a!=null&&v(s,["sdkHttpResponse"],a),s}function mD(e,t){const s={},a=g(e,["sdkHttpResponse"]);return a!=null&&v(s,["sdkHttpResponse"],a),s}function pD(e,t,s){const a={},i=g(e,["outputGcsUri"]);t!==void 0&&i!=null&&v(t,["parameters","storageUri"],i);const l=g(e,["negativePrompt"]);t!==void 0&&l!=null&&v(t,["parameters","negativePrompt"],l);const c=g(e,["numberOfImages"]);t!==void 0&&c!=null&&v(t,["parameters","sampleCount"],c);const u=g(e,["aspectRatio"]);t!==void 0&&u!=null&&v(t,["parameters","aspectRatio"],u);const f=g(e,["guidanceScale"]);t!==void 0&&f!=null&&v(t,["parameters","guidanceScale"],f);const h=g(e,["seed"]);t!==void 0&&h!=null&&v(t,["parameters","seed"],h);const m=g(e,["safetyFilterLevel"]);t!==void 0&&m!=null&&v(t,["parameters","safetySetting"],m);const x=g(e,["personGeneration"]);t!==void 0&&x!=null&&v(t,["parameters","personGeneration"],x);const y=g(e,["includeSafetyAttributes"]);t!==void 0&&y!=null&&v(t,["parameters","includeSafetyAttributes"],y);const b=g(e,["includeRaiReason"]);t!==void 0&&b!=null&&v(t,["parameters","includeRaiReason"],b);const T=g(e,["language"]);t!==void 0&&T!=null&&v(t,["parameters","language"],T);const _=g(e,["outputMimeType"]);t!==void 0&&_!=null&&v(t,["parameters","outputOptions","mimeType"],_);const j=g(e,["outputCompressionQuality"]);t!==void 0&&j!=null&&v(t,["parameters","outputOptions","compressionQuality"],j);const E=g(e,["addWatermark"]);t!==void 0&&E!=null&&v(t,["parameters","addWatermark"],E);const k=g(e,["labels"]);t!==void 0&&k!=null&&v(t,["labels"],k);const C=g(e,["editMode"]);t!==void 0&&C!=null&&v(t,["parameters","editMode"],C);const A=g(e,["baseSteps"]);return t!==void 0&&A!=null&&v(t,["parameters","editConfig","baseSteps"],A),a}function gD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["prompt"]);l!=null&&v(a,["instances[0]","prompt"],l);const c=g(t,["referenceImages"]);if(c!=null){let f=c;Array.isArray(f)&&(f=f.map(h=>xR(h))),v(a,["instances[0]","referenceImages"],f)}const u=g(t,["config"]);return u!=null&&pD(u,a),a}function yD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>gd(c))),v(s,["generatedImages"],l)}return s}function xD(e,t,s){const a={},i=g(e,["taskType"]);t!==void 0&&i!=null&&v(t,["requests[]","taskType"],i);const l=g(e,["title"]);t!==void 0&&l!=null&&v(t,["requests[]","title"],l);const c=g(e,["outputDimensionality"]);if(t!==void 0&&c!=null&&v(t,["requests[]","outputDimensionality"],c),g(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return a}function vD(e,t,s){const a={};let i=g(s,["embeddingApiType"]);if(i===void 0&&(i="PREDICT"),i==="PREDICT"){const h=g(e,["taskType"]);t!==void 0&&h!=null&&v(t,["instances[]","task_type"],h)}else if(i==="EMBED_CONTENT"){const h=g(e,["taskType"]);t!==void 0&&h!=null&&v(t,["taskType"],h)}let l=g(s,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const h=g(e,["title"]);t!==void 0&&h!=null&&v(t,["instances[]","title"],h)}else if(l==="EMBED_CONTENT"){const h=g(e,["title"]);t!==void 0&&h!=null&&v(t,["title"],h)}let c=g(s,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="PREDICT"){const h=g(e,["outputDimensionality"]);t!==void 0&&h!=null&&v(t,["parameters","outputDimensionality"],h)}else if(c==="EMBED_CONTENT"){const h=g(e,["outputDimensionality"]);t!==void 0&&h!=null&&v(t,["outputDimensionality"],h)}let u=g(s,["embeddingApiType"]);if(u===void 0&&(u="PREDICT"),u==="PREDICT"){const h=g(e,["mimeType"]);t!==void 0&&h!=null&&v(t,["instances[]","mimeType"],h)}let f=g(s,["embeddingApiType"]);if(f===void 0&&(f="PREDICT"),f==="PREDICT"){const h=g(e,["autoTruncate"]);t!==void 0&&h!=null&&v(t,["parameters","autoTruncate"],h)}else if(f==="EMBED_CONTENT"){const h=g(e,["autoTruncate"]);t!==void 0&&h!=null&&v(t,["autoTruncate"],h)}return a}function bD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let h=nm(e,l);Array.isArray(h)&&(h=h.map(m=>m)),v(a,["requests[]","content"],h)}const c=g(t,["content"]);c!=null&&ll(Sn(c));const u=g(t,["config"]);u!=null&&xD(u,a);const f=g(t,["model"]);return f!==void 0&&v(a,["requests[]","model"],Et(e,f)),a}function ND(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));let l=g(s,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const f=g(t,["contents"]);if(f!=null){let h=nm(e,f);Array.isArray(h)&&(h=h.map(m=>m)),v(a,["instances[]","content"],h)}}let c=g(s,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="EMBED_CONTENT"){const f=g(t,["content"]);f!=null&&v(a,["content"],Sn(f))}const u=g(t,["config"]);return u!=null&&vD(u,a,s),a}function SD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(u=>u)),v(s,["embeddings"],c)}const l=g(e,["metadata"]);return l!=null&&v(s,["metadata"],l),s}function wD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["predictions[]","embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(u=>nD(u))),v(s,["embeddings"],c)}const l=g(e,["metadata"]);if(l!=null&&v(s,["metadata"],l),t&&g(t,["embeddingApiType"])==="EMBED_CONTENT"){const c=g(e,["embedding"]),u=g(e,["usageMetadata"]),f=g(e,["truncated"]);if(c){const h={};u&&u.promptTokenCount&&(h.tokenCount=u.promptTokenCount),f&&(h.truncated=f),c.statistics=h,v(s,["embeddings"],[c])}}return s}function TD(e,t){const s={},a=g(e,["endpoint"]);a!=null&&v(s,["name"],a);const i=g(e,["deployedModelId"]);return i!=null&&v(s,["deployedModelId"],i),s}function jD(e,t){const s={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=g(e,["fileUri"]);a!=null&&v(s,["fileUri"],a);const i=g(e,["mimeType"]);return i!=null&&v(s,["mimeType"],i),s}function _D(e,t){const s={},a=g(e,["id"]);a!=null&&v(s,["id"],a);const i=g(e,["args"]);i!=null&&v(s,["args"],i);const l=g(e,["name"]);if(l!=null&&v(s,["name"],l),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return s}function ED(e,t){const s={},a=g(e,["allowedFunctionNames"]);a!=null&&v(s,["allowedFunctionNames"],a);const i=g(e,["mode"]);if(i!=null&&v(s,["mode"],i),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return s}function CD(e,t){const s={},a=g(e,["description"]);a!=null&&v(s,["description"],a);const i=g(e,["name"]);i!=null&&v(s,["name"],i);const l=g(e,["parameters"]);l!=null&&v(s,["parameters"],l);const c=g(e,["parametersJsonSchema"]);c!=null&&v(s,["parametersJsonSchema"],c);const u=g(e,["response"]);u!=null&&v(s,["response"],u);const f=g(e,["responseJsonSchema"]);if(f!=null&&v(s,["responseJsonSchema"],f),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return s}function ID(e,t,s,a){const i={},l=g(t,["systemInstruction"]);s!==void 0&&l!=null&&v(s,["systemInstruction"],ll(Sn(l)));const c=g(t,["temperature"]);c!=null&&v(i,["temperature"],c);const u=g(t,["topP"]);u!=null&&v(i,["topP"],u);const f=g(t,["topK"]);f!=null&&v(i,["topK"],f);const h=g(t,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=g(t,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=g(t,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const y=g(t,["responseLogprobs"]);y!=null&&v(i,["responseLogprobs"],y);const b=g(t,["logprobs"]);b!=null&&v(i,["logprobs"],b);const T=g(t,["presencePenalty"]);T!=null&&v(i,["presencePenalty"],T);const _=g(t,["frequencyPenalty"]);_!=null&&v(i,["frequencyPenalty"],_);const j=g(t,["seed"]);j!=null&&v(i,["seed"],j);const E=g(t,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const k=g(t,["responseSchema"]);k!=null&&v(i,["responseSchema"],sm(k));const C=g(t,["responseJsonSchema"]);if(C!=null&&v(i,["responseJsonSchema"],C),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=g(t,["safetySettings"]);if(s!==void 0&&A!=null){let Y=A;Array.isArray(Y)&&(Y=Y.map(J=>vR(J))),v(s,["safetySettings"],Y)}const M=g(t,["tools"]);if(s!==void 0&&M!=null){let Y=Ri(M);Array.isArray(Y)&&(Y=Y.map(J=>_R(Di(J)))),v(s,["tools"],Y)}const I=g(t,["toolConfig"]);if(s!==void 0&&I!=null&&v(s,["toolConfig"],jR(I)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=g(t,["cachedContent"]);s!==void 0&&P!=null&&v(s,["cachedContent"],ba(e,P));const D=g(t,["responseModalities"]);D!=null&&v(i,["responseModalities"],D);const U=g(t,["mediaResolution"]);U!=null&&v(i,["mediaResolution"],U);const O=g(t,["speechConfig"]);if(O!=null&&v(i,["speechConfig"],am(O)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const F=g(t,["thinkingConfig"]);F!=null&&v(i,["thinkingConfig"],F);const q=g(t,["imageConfig"]);q!=null&&v(i,["imageConfig"],nR(q));const z=g(t,["enableEnhancedCivicAnswers"]);if(z!=null&&v(i,["enableEnhancedCivicAnswers"],z),g(t,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function AD(e,t,s,a){const i={},l=g(t,["systemInstruction"]);s!==void 0&&l!=null&&v(s,["systemInstruction"],Sn(l));const c=g(t,["temperature"]);c!=null&&v(i,["temperature"],c);const u=g(t,["topP"]);u!=null&&v(i,["topP"],u);const f=g(t,["topK"]);f!=null&&v(i,["topK"],f);const h=g(t,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=g(t,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=g(t,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const y=g(t,["responseLogprobs"]);y!=null&&v(i,["responseLogprobs"],y);const b=g(t,["logprobs"]);b!=null&&v(i,["logprobs"],b);const T=g(t,["presencePenalty"]);T!=null&&v(i,["presencePenalty"],T);const _=g(t,["frequencyPenalty"]);_!=null&&v(i,["frequencyPenalty"],_);const j=g(t,["seed"]);j!=null&&v(i,["seed"],j);const E=g(t,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const k=g(t,["responseSchema"]);k!=null&&v(i,["responseSchema"],sm(k));const C=g(t,["responseJsonSchema"]);C!=null&&v(i,["responseJsonSchema"],C);const A=g(t,["routingConfig"]);A!=null&&v(i,["routingConfig"],A);const M=g(t,["modelSelectionConfig"]);M!=null&&v(i,["modelConfig"],M);const I=g(t,["safetySettings"]);if(s!==void 0&&I!=null){let Q=I;Array.isArray(Q)&&(Q=Q.map(W=>W)),v(s,["safetySettings"],Q)}const P=g(t,["tools"]);if(s!==void 0&&P!=null){let Q=Ri(P);Array.isArray(Q)&&(Q=Q.map(W=>Vb(Di(W)))),v(s,["tools"],Q)}const D=g(t,["toolConfig"]);s!==void 0&&D!=null&&v(s,["toolConfig"],D);const U=g(t,["labels"]);s!==void 0&&U!=null&&v(s,["labels"],U);const O=g(t,["cachedContent"]);s!==void 0&&O!=null&&v(s,["cachedContent"],ba(e,O));const F=g(t,["responseModalities"]);F!=null&&v(i,["responseModalities"],F);const q=g(t,["mediaResolution"]);q!=null&&v(i,["mediaResolution"],q);const z=g(t,["speechConfig"]);z!=null&&v(i,["speechConfig"],am(z));const Y=g(t,["audioTimestamp"]);Y!=null&&v(i,["audioTimestamp"],Y);const J=g(t,["thinkingConfig"]);J!=null&&v(i,["thinkingConfig"],J);const G=g(t,["imageConfig"]);if(G!=null&&v(i,["imageConfig"],sR(G)),g(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const B=g(t,["modelArmorConfig"]);return s!==void 0&&B!=null&&v(s,["modelArmorConfig"],B),i}function dv(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let u=rs(l);Array.isArray(u)&&(u=u.map(f=>ll(f))),v(a,["contents"],u)}const c=g(t,["config"]);return c!=null&&v(a,["generationConfig"],ID(e,c,a)),a}function uv(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["contents"]);if(l!=null){let u=rs(l);Array.isArray(u)&&(u=u.map(f=>f)),v(a,["contents"],u)}const c=g(t,["config"]);return c!=null&&v(a,["generationConfig"],AD(e,c,a)),a}function hv(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["candidates"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(m=>Qk(m))),v(s,["candidates"],h)}const l=g(e,["modelVersion"]);l!=null&&v(s,["modelVersion"],l);const c=g(e,["promptFeedback"]);c!=null&&v(s,["promptFeedback"],c);const u=g(e,["responseId"]);u!=null&&v(s,["responseId"],u);const f=g(e,["usageMetadata"]);return f!=null&&v(s,["usageMetadata"],f),s}function fv(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["candidates"]);if(i!=null){let m=i;Array.isArray(m)&&(m=m.map(x=>x)),v(s,["candidates"],m)}const l=g(e,["createTime"]);l!=null&&v(s,["createTime"],l);const c=g(e,["modelVersion"]);c!=null&&v(s,["modelVersion"],c);const u=g(e,["promptFeedback"]);u!=null&&v(s,["promptFeedback"],u);const f=g(e,["responseId"]);f!=null&&v(s,["responseId"],f);const h=g(e,["usageMetadata"]);return h!=null&&v(s,["usageMetadata"],h),s}function kD(e,t,s){const a={};if(g(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=g(e,["numberOfImages"]);t!==void 0&&i!=null&&v(t,["parameters","sampleCount"],i);const l=g(e,["aspectRatio"]);t!==void 0&&l!=null&&v(t,["parameters","aspectRatio"],l);const c=g(e,["guidanceScale"]);if(t!==void 0&&c!=null&&v(t,["parameters","guidanceScale"],c),g(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=g(e,["safetyFilterLevel"]);t!==void 0&&u!=null&&v(t,["parameters","safetySetting"],u);const f=g(e,["personGeneration"]);t!==void 0&&f!=null&&v(t,["parameters","personGeneration"],f);const h=g(e,["includeSafetyAttributes"]);t!==void 0&&h!=null&&v(t,["parameters","includeSafetyAttributes"],h);const m=g(e,["includeRaiReason"]);t!==void 0&&m!=null&&v(t,["parameters","includeRaiReason"],m);const x=g(e,["language"]);t!==void 0&&x!=null&&v(t,["parameters","language"],x);const y=g(e,["outputMimeType"]);t!==void 0&&y!=null&&v(t,["parameters","outputOptions","mimeType"],y);const b=g(e,["outputCompressionQuality"]);if(t!==void 0&&b!=null&&v(t,["parameters","outputOptions","compressionQuality"],b),g(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=g(e,["imageSize"]);if(t!==void 0&&T!=null&&v(t,["parameters","sampleImageSize"],T),g(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return a}function DD(e,t,s){const a={},i=g(e,["outputGcsUri"]);t!==void 0&&i!=null&&v(t,["parameters","storageUri"],i);const l=g(e,["negativePrompt"]);t!==void 0&&l!=null&&v(t,["parameters","negativePrompt"],l);const c=g(e,["numberOfImages"]);t!==void 0&&c!=null&&v(t,["parameters","sampleCount"],c);const u=g(e,["aspectRatio"]);t!==void 0&&u!=null&&v(t,["parameters","aspectRatio"],u);const f=g(e,["guidanceScale"]);t!==void 0&&f!=null&&v(t,["parameters","guidanceScale"],f);const h=g(e,["seed"]);t!==void 0&&h!=null&&v(t,["parameters","seed"],h);const m=g(e,["safetyFilterLevel"]);t!==void 0&&m!=null&&v(t,["parameters","safetySetting"],m);const x=g(e,["personGeneration"]);t!==void 0&&x!=null&&v(t,["parameters","personGeneration"],x);const y=g(e,["includeSafetyAttributes"]);t!==void 0&&y!=null&&v(t,["parameters","includeSafetyAttributes"],y);const b=g(e,["includeRaiReason"]);t!==void 0&&b!=null&&v(t,["parameters","includeRaiReason"],b);const T=g(e,["language"]);t!==void 0&&T!=null&&v(t,["parameters","language"],T);const _=g(e,["outputMimeType"]);t!==void 0&&_!=null&&v(t,["parameters","outputOptions","mimeType"],_);const j=g(e,["outputCompressionQuality"]);t!==void 0&&j!=null&&v(t,["parameters","outputOptions","compressionQuality"],j);const E=g(e,["addWatermark"]);t!==void 0&&E!=null&&v(t,["parameters","addWatermark"],E);const k=g(e,["labels"]);t!==void 0&&k!=null&&v(t,["labels"],k);const C=g(e,["imageSize"]);t!==void 0&&C!=null&&v(t,["parameters","sampleImageSize"],C);const A=g(e,["enhancePrompt"]);return t!==void 0&&A!=null&&v(t,["parameters","enhancePrompt"],A),a}function RD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["prompt"]);l!=null&&v(a,["instances[0]","prompt"],l);const c=g(t,["config"]);return c!=null&&kD(c,a),a}function MD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["prompt"]);l!=null&&v(a,["instances[0]","prompt"],l);const c=g(t,["config"]);return c!=null&&DD(c,a),a}function PD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(u=>KD(u))),v(s,["generatedImages"],c)}const l=g(e,["positivePromptSafetyAttributes"]);return l!=null&&v(s,["positivePromptSafetyAttributes"],Hb(l)),s}function OD(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(u=>gd(u))),v(s,["generatedImages"],c)}const l=g(e,["positivePromptSafetyAttributes"]);return l!=null&&v(s,["positivePromptSafetyAttributes"],qb(l)),s}function LD(e,t,s){const a={},i=g(e,["numberOfVideos"]);if(t!==void 0&&i!=null&&v(t,["parameters","sampleCount"],i),g(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=g(e,["durationSeconds"]);if(t!==void 0&&l!=null&&v(t,["parameters","durationSeconds"],l),g(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=g(e,["aspectRatio"]);t!==void 0&&c!=null&&v(t,["parameters","aspectRatio"],c);const u=g(e,["resolution"]);t!==void 0&&u!=null&&v(t,["parameters","resolution"],u);const f=g(e,["personGeneration"]);if(t!==void 0&&f!=null&&v(t,["parameters","personGeneration"],f),g(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=g(e,["negativePrompt"]);t!==void 0&&h!=null&&v(t,["parameters","negativePrompt"],h);const m=g(e,["enhancePrompt"]);if(t!==void 0&&m!=null&&v(t,["parameters","enhancePrompt"],m),g(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=g(e,["lastFrame"]);t!==void 0&&x!=null&&v(t,["instances[0]","lastFrame"],yd(x));const y=g(e,["referenceImages"]);if(t!==void 0&&y!=null){let b=y;Array.isArray(b)&&(b=b.map(T=>FR(T))),v(t,["instances[0]","referenceImages"],b)}if(g(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(g(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return a}function UD(e,t,s){const a={},i=g(e,["numberOfVideos"]);t!==void 0&&i!=null&&v(t,["parameters","sampleCount"],i);const l=g(e,["outputGcsUri"]);t!==void 0&&l!=null&&v(t,["parameters","storageUri"],l);const c=g(e,["fps"]);t!==void 0&&c!=null&&v(t,["parameters","fps"],c);const u=g(e,["durationSeconds"]);t!==void 0&&u!=null&&v(t,["parameters","durationSeconds"],u);const f=g(e,["seed"]);t!==void 0&&f!=null&&v(t,["parameters","seed"],f);const h=g(e,["aspectRatio"]);t!==void 0&&h!=null&&v(t,["parameters","aspectRatio"],h);const m=g(e,["resolution"]);t!==void 0&&m!=null&&v(t,["parameters","resolution"],m);const x=g(e,["personGeneration"]);t!==void 0&&x!=null&&v(t,["parameters","personGeneration"],x);const y=g(e,["pubsubTopic"]);t!==void 0&&y!=null&&v(t,["parameters","pubsubTopic"],y);const b=g(e,["negativePrompt"]);t!==void 0&&b!=null&&v(t,["parameters","negativePrompt"],b);const T=g(e,["enhancePrompt"]);t!==void 0&&T!=null&&v(t,["parameters","enhancePrompt"],T);const _=g(e,["generateAudio"]);t!==void 0&&_!=null&&v(t,["parameters","generateAudio"],_);const j=g(e,["lastFrame"]);t!==void 0&&j!=null&&v(t,["instances[0]","lastFrame"],Ms(j));const E=g(e,["referenceImages"]);if(t!==void 0&&E!=null){let A=E;Array.isArray(A)&&(A=A.map(M=>BR(M))),v(t,["instances[0]","referenceImages"],A)}const k=g(e,["mask"]);t!==void 0&&k!=null&&v(t,["instances[0]","mask"],UR(k));const C=g(e,["compressionQuality"]);return t!==void 0&&C!=null&&v(t,["parameters","compressionQuality"],C),a}function FD(e,t){const s={},a=g(e,["name"]);a!=null&&v(s,["name"],a);const i=g(e,["metadata"]);i!=null&&v(s,["metadata"],i);const l=g(e,["done"]);l!=null&&v(s,["done"],l);const c=g(e,["error"]);c!=null&&v(s,["error"],c);const u=g(e,["response","generateVideoResponse"]);return u!=null&&v(s,["response"],$D(u)),s}function BD(e,t){const s={},a=g(e,["name"]);a!=null&&v(s,["name"],a);const i=g(e,["metadata"]);i!=null&&v(s,["metadata"],i);const l=g(e,["done"]);l!=null&&v(s,["done"],l);const c=g(e,["error"]);c!=null&&v(s,["error"],c);const u=g(e,["response"]);return u!=null&&v(s,["response"],HD(u)),s}function GD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["prompt"]);l!=null&&v(a,["instances[0]","prompt"],l);const c=g(t,["image"]);c!=null&&v(a,["instances[0]","image"],yd(c));const u=g(t,["video"]);u!=null&&v(a,["instances[0]","video"],Kb(u));const f=g(t,["source"]);f!=null&&qD(f,a);const h=g(t,["config"]);return h!=null&&LD(h,a),a}function zD(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["prompt"]);l!=null&&v(a,["instances[0]","prompt"],l);const c=g(t,["image"]);c!=null&&v(a,["instances[0]","image"],Ms(c));const u=g(t,["video"]);u!=null&&v(a,["instances[0]","video"],Wb(u));const f=g(t,["source"]);f!=null&&VD(f,a);const h=g(t,["config"]);return h!=null&&UD(h,a),a}function $D(e,t){const s={},a=g(e,["generatedSamples"]);if(a!=null){let c=a;Array.isArray(c)&&(c=c.map(u=>JD(u))),v(s,["generatedVideos"],c)}const i=g(e,["raiMediaFilteredCount"]);i!=null&&v(s,["raiMediaFilteredCount"],i);const l=g(e,["raiMediaFilteredReasons"]);return l!=null&&v(s,["raiMediaFilteredReasons"],l),s}function HD(e,t){const s={},a=g(e,["videos"]);if(a!=null){let c=a;Array.isArray(c)&&(c=c.map(u=>YD(u))),v(s,["generatedVideos"],c)}const i=g(e,["raiMediaFilteredCount"]);i!=null&&v(s,["raiMediaFilteredCount"],i);const l=g(e,["raiMediaFilteredReasons"]);return l!=null&&v(s,["raiMediaFilteredReasons"],l),s}function qD(e,t,s){const a={},i=g(e,["prompt"]);t!==void 0&&i!=null&&v(t,["instances[0]","prompt"],i);const l=g(e,["image"]);t!==void 0&&l!=null&&v(t,["instances[0]","image"],yd(l));const c=g(e,["video"]);return t!==void 0&&c!=null&&v(t,["instances[0]","video"],Kb(c)),a}function VD(e,t,s){const a={},i=g(e,["prompt"]);t!==void 0&&i!=null&&v(t,["instances[0]","prompt"],i);const l=g(e,["image"]);t!==void 0&&l!=null&&v(t,["instances[0]","image"],Ms(l));const c=g(e,["video"]);return t!==void 0&&c!=null&&v(t,["instances[0]","video"],Wb(c)),a}function KD(e,t){const s={},a=g(e,["_self"]);a!=null&&v(s,["image"],aR(a));const i=g(e,["raiFilteredReason"]);i!=null&&v(s,["raiFilteredReason"],i);const l=g(e,["_self"]);return l!=null&&v(s,["safetyAttributes"],Hb(l)),s}function gd(e,t){const s={},a=g(e,["_self"]);a!=null&&v(s,["image"],$b(a));const i=g(e,["raiFilteredReason"]);i!=null&&v(s,["raiFilteredReason"],i);const l=g(e,["_self"]);l!=null&&v(s,["safetyAttributes"],qb(l));const c=g(e,["prompt"]);return c!=null&&v(s,["enhancedPrompt"],c),s}function WD(e,t){const s={},a=g(e,["_self"]);a!=null&&v(s,["mask"],$b(a));const i=g(e,["labels"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(s,["labels"],l)}return s}function JD(e,t){const s={},a=g(e,["video"]);return a!=null&&v(s,["video"],OR(a)),s}function YD(e,t){const s={},a=g(e,["_self"]);return a!=null&&v(s,["video"],LR(a)),s}function XD(e,t){const s={},a=g(e,["modelSelectionConfig"]);a!=null&&v(s,["modelConfig"],a);const i=g(e,["responseJsonSchema"]);i!=null&&v(s,["responseJsonSchema"],i);const l=g(e,["audioTimestamp"]);l!=null&&v(s,["audioTimestamp"],l);const c=g(e,["candidateCount"]);c!=null&&v(s,["candidateCount"],c);const u=g(e,["enableAffectiveDialog"]);u!=null&&v(s,["enableAffectiveDialog"],u);const f=g(e,["frequencyPenalty"]);f!=null&&v(s,["frequencyPenalty"],f);const h=g(e,["logprobs"]);h!=null&&v(s,["logprobs"],h);const m=g(e,["maxOutputTokens"]);m!=null&&v(s,["maxOutputTokens"],m);const x=g(e,["mediaResolution"]);x!=null&&v(s,["mediaResolution"],x);const y=g(e,["presencePenalty"]);y!=null&&v(s,["presencePenalty"],y);const b=g(e,["responseLogprobs"]);b!=null&&v(s,["responseLogprobs"],b);const T=g(e,["responseMimeType"]);T!=null&&v(s,["responseMimeType"],T);const _=g(e,["responseModalities"]);_!=null&&v(s,["responseModalities"],_);const j=g(e,["responseSchema"]);j!=null&&v(s,["responseSchema"],j);const E=g(e,["routingConfig"]);E!=null&&v(s,["routingConfig"],E);const k=g(e,["seed"]);k!=null&&v(s,["seed"],k);const C=g(e,["speechConfig"]);C!=null&&v(s,["speechConfig"],C);const A=g(e,["stopSequences"]);A!=null&&v(s,["stopSequences"],A);const M=g(e,["temperature"]);M!=null&&v(s,["temperature"],M);const I=g(e,["thinkingConfig"]);I!=null&&v(s,["thinkingConfig"],I);const P=g(e,["topK"]);P!=null&&v(s,["topK"],P);const D=g(e,["topP"]);if(D!=null&&v(s,["topP"],D),g(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function QD(e,t,s){const a={},i=g(t,["model"]);return i!=null&&v(a,["_url","name"],Et(e,i)),a}function ZD(e,t,s){const a={},i=g(t,["model"]);return i!=null&&v(a,["_url","name"],Et(e,i)),a}function eR(e,t){const s={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const a=g(e,["enableWidget"]);return a!=null&&v(s,["enableWidget"],a),s}function tR(e,t){const s={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const a=g(e,["timeRangeFilter"]);return a!=null&&v(s,["timeRangeFilter"],a),s}function nR(e,t){const s={},a=g(e,["aspectRatio"]);a!=null&&v(s,["aspectRatio"],a);const i=g(e,["imageSize"]);if(i!=null&&v(s,["imageSize"],i),g(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(g(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return s}function sR(e,t){const s={},a=g(e,["aspectRatio"]);a!=null&&v(s,["aspectRatio"],a);const i=g(e,["imageSize"]);i!=null&&v(s,["imageSize"],i);const l=g(e,["personGeneration"]);l!=null&&v(s,["personGeneration"],l);const c=g(e,["outputMimeType"]);c!=null&&v(s,["imageOutputOptions","mimeType"],c);const u=g(e,["outputCompressionQuality"]);return u!=null&&v(s,["imageOutputOptions","compressionQuality"],u),s}function aR(e,t){const s={},a=g(e,["bytesBase64Encoded"]);a!=null&&v(s,["imageBytes"],er(a));const i=g(e,["mimeType"]);return i!=null&&v(s,["mimeType"],i),s}function $b(e,t){const s={},a=g(e,["gcsUri"]);a!=null&&v(s,["gcsUri"],a);const i=g(e,["bytesBase64Encoded"]);i!=null&&v(s,["imageBytes"],er(i));const l=g(e,["mimeType"]);return l!=null&&v(s,["mimeType"],l),s}function yd(e,t){const s={};if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const a=g(e,["imageBytes"]);a!=null&&v(s,["bytesBase64Encoded"],er(a));const i=g(e,["mimeType"]);return i!=null&&v(s,["mimeType"],i),s}function Ms(e,t){const s={},a=g(e,["gcsUri"]);a!=null&&v(s,["gcsUri"],a);const i=g(e,["imageBytes"]);i!=null&&v(s,["bytesBase64Encoded"],er(i));const l=g(e,["mimeType"]);return l!=null&&v(s,["mimeType"],l),s}function rR(e,t,s,a){const i={},l=g(t,["pageSize"]);s!==void 0&&l!=null&&v(s,["_query","pageSize"],l);const c=g(t,["pageToken"]);s!==void 0&&c!=null&&v(s,["_query","pageToken"],c);const u=g(t,["filter"]);s!==void 0&&u!=null&&v(s,["_query","filter"],u);const f=g(t,["queryBase"]);return s!==void 0&&f!=null&&v(s,["_url","models_url"],Ob(e,f)),i}function iR(e,t,s,a){const i={},l=g(t,["pageSize"]);s!==void 0&&l!=null&&v(s,["_query","pageSize"],l);const c=g(t,["pageToken"]);s!==void 0&&c!=null&&v(s,["_query","pageToken"],c);const u=g(t,["filter"]);s!==void 0&&u!=null&&v(s,["_query","filter"],u);const f=g(t,["queryBase"]);return s!==void 0&&f!=null&&v(s,["_url","models_url"],Ob(e,f)),i}function oR(e,t,s){const a={},i=g(t,["config"]);return i!=null&&rR(e,i,a),a}function lR(e,t,s){const a={},i=g(t,["config"]);return i!=null&&iR(e,i,a),a}function cR(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["nextPageToken"]);i!=null&&v(s,["nextPageToken"],i);const l=g(e,["_self"]);if(l!=null){let c=Lb(l);Array.isArray(c)&&(c=c.map(u=>If(u))),v(s,["models"],c)}return s}function dR(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["nextPageToken"]);i!=null&&v(s,["nextPageToken"],i);const l=g(e,["_self"]);if(l!=null){let c=Lb(l);Array.isArray(c)&&(c=c.map(u=>Af(u))),v(s,["models"],c)}return s}function uR(e,t){const s={},a=g(e,["maskMode"]);a!=null&&v(s,["maskMode"],a);const i=g(e,["segmentationClasses"]);i!=null&&v(s,["maskClasses"],i);const l=g(e,["maskDilation"]);return l!=null&&v(s,["dilation"],l),s}function If(e,t){const s={},a=g(e,["name"]);a!=null&&v(s,["name"],a);const i=g(e,["displayName"]);i!=null&&v(s,["displayName"],i);const l=g(e,["description"]);l!=null&&v(s,["description"],l);const c=g(e,["version"]);c!=null&&v(s,["version"],c);const u=g(e,["_self"]);u!=null&&v(s,["tunedModelInfo"],ER(u));const f=g(e,["inputTokenLimit"]);f!=null&&v(s,["inputTokenLimit"],f);const h=g(e,["outputTokenLimit"]);h!=null&&v(s,["outputTokenLimit"],h);const m=g(e,["supportedGenerationMethods"]);m!=null&&v(s,["supportedActions"],m);const x=g(e,["temperature"]);x!=null&&v(s,["temperature"],x);const y=g(e,["maxTemperature"]);y!=null&&v(s,["maxTemperature"],y);const b=g(e,["topP"]);b!=null&&v(s,["topP"],b);const T=g(e,["topK"]);T!=null&&v(s,["topK"],T);const _=g(e,["thinking"]);return _!=null&&v(s,["thinking"],_),s}function Af(e,t){const s={},a=g(e,["name"]);a!=null&&v(s,["name"],a);const i=g(e,["displayName"]);i!=null&&v(s,["displayName"],i);const l=g(e,["description"]);l!=null&&v(s,["description"],l);const c=g(e,["versionId"]);c!=null&&v(s,["version"],c);const u=g(e,["deployedModels"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(b=>TD(b))),v(s,["endpoints"],y)}const f=g(e,["labels"]);f!=null&&v(s,["labels"],f);const h=g(e,["_self"]);h!=null&&v(s,["tunedModelInfo"],CR(h));const m=g(e,["defaultCheckpointId"]);m!=null&&v(s,["defaultCheckpointId"],m);const x=g(e,["checkpoints"]);if(x!=null){let y=x;Array.isArray(y)&&(y=y.map(b=>b)),v(s,["checkpoints"],y)}return s}function hR(e,t){const s={},a=g(e,["mediaResolution"]);a!=null&&v(s,["mediaResolution"],a);const i=g(e,["codeExecutionResult"]);i!=null&&v(s,["codeExecutionResult"],i);const l=g(e,["executableCode"]);l!=null&&v(s,["executableCode"],l);const c=g(e,["fileData"]);c!=null&&v(s,["fileData"],jD(c));const u=g(e,["functionCall"]);u!=null&&v(s,["functionCall"],_D(u));const f=g(e,["functionResponse"]);f!=null&&v(s,["functionResponse"],f);const h=g(e,["inlineData"]);h!=null&&v(s,["inlineData"],Xk(h));const m=g(e,["text"]);m!=null&&v(s,["text"],m);const x=g(e,["thought"]);x!=null&&v(s,["thought"],x);const y=g(e,["thoughtSignature"]);y!=null&&v(s,["thoughtSignature"],y);const b=g(e,["videoMetadata"]);return b!=null&&v(s,["videoMetadata"],b),s}function fR(e,t){const s={},a=g(e,["productImage"]);return a!=null&&v(s,["image"],Ms(a)),s}function mR(e,t,s){const a={},i=g(e,["numberOfImages"]);t!==void 0&&i!=null&&v(t,["parameters","sampleCount"],i);const l=g(e,["baseSteps"]);t!==void 0&&l!=null&&v(t,["parameters","baseSteps"],l);const c=g(e,["outputGcsUri"]);t!==void 0&&c!=null&&v(t,["parameters","storageUri"],c);const u=g(e,["seed"]);t!==void 0&&u!=null&&v(t,["parameters","seed"],u);const f=g(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&v(t,["parameters","safetySetting"],f);const h=g(e,["personGeneration"]);t!==void 0&&h!=null&&v(t,["parameters","personGeneration"],h);const m=g(e,["addWatermark"]);t!==void 0&&m!=null&&v(t,["parameters","addWatermark"],m);const x=g(e,["outputMimeType"]);t!==void 0&&x!=null&&v(t,["parameters","outputOptions","mimeType"],x);const y=g(e,["outputCompressionQuality"]);t!==void 0&&y!=null&&v(t,["parameters","outputOptions","compressionQuality"],y);const b=g(e,["enhancePrompt"]);t!==void 0&&b!=null&&v(t,["parameters","enhancePrompt"],b);const T=g(e,["labels"]);return t!==void 0&&T!=null&&v(t,["labels"],T),a}function pR(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["source"]);l!=null&&yR(l,a);const c=g(t,["config"]);return c!=null&&mR(c,a),a}function gR(e,t){const s={},a=g(e,["predictions"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(l=>gd(l))),v(s,["generatedImages"],i)}return s}function yR(e,t,s){const a={},i=g(e,["prompt"]);t!==void 0&&i!=null&&v(t,["instances[0]","prompt"],i);const l=g(e,["personImage"]);t!==void 0&&l!=null&&v(t,["instances[0]","personImage","image"],Ms(l));const c=g(e,["productImages"]);if(t!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(f=>fR(f))),v(t,["instances[0]","productImages"],u)}return a}function xR(e,t){const s={},a=g(e,["referenceImage"]);a!=null&&v(s,["referenceImage"],Ms(a));const i=g(e,["referenceId"]);i!=null&&v(s,["referenceId"],i);const l=g(e,["referenceType"]);l!=null&&v(s,["referenceType"],l);const c=g(e,["maskImageConfig"]);c!=null&&v(s,["maskImageConfig"],uR(c));const u=g(e,["controlImageConfig"]);u!=null&&v(s,["controlImageConfig"],aD(u));const f=g(e,["styleImageConfig"]);f!=null&&v(s,["styleImageConfig"],f);const h=g(e,["subjectImageConfig"]);return h!=null&&v(s,["subjectImageConfig"],h),s}function Hb(e,t){const s={},a=g(e,["safetyAttributes","categories"]);a!=null&&v(s,["categories"],a);const i=g(e,["safetyAttributes","scores"]);i!=null&&v(s,["scores"],i);const l=g(e,["contentType"]);return l!=null&&v(s,["contentType"],l),s}function qb(e,t){const s={},a=g(e,["safetyAttributes","categories"]);a!=null&&v(s,["categories"],a);const i=g(e,["safetyAttributes","scores"]);i!=null&&v(s,["scores"],i);const l=g(e,["contentType"]);return l!=null&&v(s,["contentType"],l),s}function vR(e,t){const s={},a=g(e,["category"]);if(a!=null&&v(s,["category"],a),g(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=g(e,["threshold"]);return i!=null&&v(s,["threshold"],i),s}function bR(e,t){const s={},a=g(e,["image"]);return a!=null&&v(s,["image"],Ms(a)),s}function NR(e,t,s){const a={},i=g(e,["mode"]);t!==void 0&&i!=null&&v(t,["parameters","mode"],i);const l=g(e,["maxPredictions"]);t!==void 0&&l!=null&&v(t,["parameters","maxPredictions"],l);const c=g(e,["confidenceThreshold"]);t!==void 0&&c!=null&&v(t,["parameters","confidenceThreshold"],c);const u=g(e,["maskDilation"]);t!==void 0&&u!=null&&v(t,["parameters","maskDilation"],u);const f=g(e,["binaryColorThreshold"]);t!==void 0&&f!=null&&v(t,["parameters","binaryColorThreshold"],f);const h=g(e,["labels"]);return t!==void 0&&h!=null&&v(t,["labels"],h),a}function SR(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["source"]);l!=null&&TR(l,a);const c=g(t,["config"]);return c!=null&&NR(c,a),a}function wR(e,t){const s={},a=g(e,["predictions"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(l=>WD(l))),v(s,["generatedMasks"],i)}return s}function TR(e,t,s){const a={},i=g(e,["prompt"]);t!==void 0&&i!=null&&v(t,["instances[0]","prompt"],i);const l=g(e,["image"]);t!==void 0&&l!=null&&v(t,["instances[0]","image"],Ms(l));const c=g(e,["scribbleImage"]);return t!==void 0&&c!=null&&v(t,["instances[0]","scribble"],bR(c)),a}function jR(e,t){const s={},a=g(e,["retrievalConfig"]);a!=null&&v(s,["retrievalConfig"],a);const i=g(e,["functionCallingConfig"]);return i!=null&&v(s,["functionCallingConfig"],ED(i)),s}function _R(e,t){const s={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=g(e,["computerUse"]);a!=null&&v(s,["computerUse"],a);const i=g(e,["fileSearch"]);i!=null&&v(s,["fileSearch"],i);const l=g(e,["codeExecution"]);if(l!=null&&v(s,["codeExecution"],l),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=g(e,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(y=>y)),v(s,["functionDeclarations"],x)}const u=g(e,["googleMaps"]);u!=null&&v(s,["googleMaps"],eR(u));const f=g(e,["googleSearch"]);f!=null&&v(s,["googleSearch"],tR(f));const h=g(e,["googleSearchRetrieval"]);h!=null&&v(s,["googleSearchRetrieval"],h);const m=g(e,["urlContext"]);return m!=null&&v(s,["urlContext"],m),s}function Vb(e,t){const s={},a=g(e,["retrieval"]);a!=null&&v(s,["retrieval"],a);const i=g(e,["computerUse"]);if(i!=null&&v(s,["computerUse"],i),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=g(e,["codeExecution"]);l!=null&&v(s,["codeExecution"],l);const c=g(e,["enterpriseWebSearch"]);c!=null&&v(s,["enterpriseWebSearch"],c);const u=g(e,["functionDeclarations"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(b=>CD(b))),v(s,["functionDeclarations"],y)}const f=g(e,["googleMaps"]);f!=null&&v(s,["googleMaps"],f);const h=g(e,["googleSearch"]);h!=null&&v(s,["googleSearch"],h);const m=g(e,["googleSearchRetrieval"]);m!=null&&v(s,["googleSearchRetrieval"],m);const x=g(e,["urlContext"]);return x!=null&&v(s,["urlContext"],x),s}function ER(e,t){const s={},a=g(e,["baseModel"]);a!=null&&v(s,["baseModel"],a);const i=g(e,["createTime"]);i!=null&&v(s,["createTime"],i);const l=g(e,["updateTime"]);return l!=null&&v(s,["updateTime"],l),s}function CR(e,t){const s={},a=g(e,["labels","google-vertex-llm-tuning-base-model-id"]);a!=null&&v(s,["baseModel"],a);const i=g(e,["createTime"]);i!=null&&v(s,["createTime"],i);const l=g(e,["updateTime"]);return l!=null&&v(s,["updateTime"],l),s}function IR(e,t,s){const a={},i=g(e,["displayName"]);t!==void 0&&i!=null&&v(t,["displayName"],i);const l=g(e,["description"]);t!==void 0&&l!=null&&v(t,["description"],l);const c=g(e,["defaultCheckpointId"]);return t!==void 0&&c!=null&&v(t,["defaultCheckpointId"],c),a}function AR(e,t,s){const a={},i=g(e,["displayName"]);t!==void 0&&i!=null&&v(t,["displayName"],i);const l=g(e,["description"]);t!==void 0&&l!=null&&v(t,["description"],l);const c=g(e,["defaultCheckpointId"]);return t!==void 0&&c!=null&&v(t,["defaultCheckpointId"],c),a}function kR(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","name"],Et(e,i));const l=g(t,["config"]);return l!=null&&IR(l,a),a}function DR(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["config"]);return l!=null&&AR(l,a),a}function RR(e,t,s){const a={},i=g(e,["outputGcsUri"]);t!==void 0&&i!=null&&v(t,["parameters","storageUri"],i);const l=g(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&v(t,["parameters","safetySetting"],l);const c=g(e,["personGeneration"]);t!==void 0&&c!=null&&v(t,["parameters","personGeneration"],c);const u=g(e,["includeRaiReason"]);t!==void 0&&u!=null&&v(t,["parameters","includeRaiReason"],u);const f=g(e,["outputMimeType"]);t!==void 0&&f!=null&&v(t,["parameters","outputOptions","mimeType"],f);const h=g(e,["outputCompressionQuality"]);t!==void 0&&h!=null&&v(t,["parameters","outputOptions","compressionQuality"],h);const m=g(e,["enhanceInputImage"]);t!==void 0&&m!=null&&v(t,["parameters","upscaleConfig","enhanceInputImage"],m);const x=g(e,["imagePreservationFactor"]);t!==void 0&&x!=null&&v(t,["parameters","upscaleConfig","imagePreservationFactor"],x);const y=g(e,["labels"]);t!==void 0&&y!=null&&v(t,["labels"],y);const b=g(e,["numberOfImages"]);t!==void 0&&b!=null&&v(t,["parameters","sampleCount"],b);const T=g(e,["mode"]);return t!==void 0&&T!=null&&v(t,["parameters","mode"],T),a}function MR(e,t,s){const a={},i=g(t,["model"]);i!=null&&v(a,["_url","model"],Et(e,i));const l=g(t,["image"]);l!=null&&v(a,["instances[0]","image"],Ms(l));const c=g(t,["upscaleFactor"]);c!=null&&v(a,["parameters","upscaleConfig","upscaleFactor"],c);const u=g(t,["config"]);return u!=null&&RR(u,a),a}function PR(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>gd(c))),v(s,["generatedImages"],l)}return s}function OR(e,t){const s={},a=g(e,["uri"]);a!=null&&v(s,["uri"],a);const i=g(e,["encodedVideo"]);i!=null&&v(s,["videoBytes"],er(i));const l=g(e,["encoding"]);return l!=null&&v(s,["mimeType"],l),s}function LR(e,t){const s={},a=g(e,["gcsUri"]);a!=null&&v(s,["uri"],a);const i=g(e,["bytesBase64Encoded"]);i!=null&&v(s,["videoBytes"],er(i));const l=g(e,["mimeType"]);return l!=null&&v(s,["mimeType"],l),s}function UR(e,t){const s={},a=g(e,["image"]);a!=null&&v(s,["_self"],Ms(a));const i=g(e,["maskMode"]);return i!=null&&v(s,["maskMode"],i),s}function FR(e,t){const s={},a=g(e,["image"]);a!=null&&v(s,["image"],yd(a));const i=g(e,["referenceType"]);return i!=null&&v(s,["referenceType"],i),s}function BR(e,t){const s={},a=g(e,["image"]);a!=null&&v(s,["image"],Ms(a));const i=g(e,["referenceType"]);return i!=null&&v(s,["referenceType"],i),s}function Kb(e,t){const s={},a=g(e,["uri"]);a!=null&&v(s,["uri"],a);const i=g(e,["videoBytes"]);i!=null&&v(s,["encodedVideo"],er(i));const l=g(e,["mimeType"]);return l!=null&&v(s,["encoding"],l),s}function Wb(e,t){const s={},a=g(e,["uri"]);a!=null&&v(s,["gcsUri"],a);const i=g(e,["videoBytes"]);i!=null&&v(s,["bytesBase64Encoded"],er(i));const l=g(e,["mimeType"]);return l!=null&&v(s,["mimeType"],l),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function GR(e,t){const s={},a=g(e,["displayName"]);return t!==void 0&&a!=null&&v(t,["displayName"],a),s}function zR(e){const t={},s=g(e,["config"]);return s!=null&&GR(s,t),t}function $R(e,t){const s={},a=g(e,["force"]);return t!==void 0&&a!=null&&v(t,["_query","force"],a),s}function HR(e){const t={},s=g(e,["name"]);s!=null&&v(t,["_url","name"],s);const a=g(e,["config"]);return a!=null&&$R(a,t),t}function qR(e){const t={},s=g(e,["name"]);return s!=null&&v(t,["_url","name"],s),t}function VR(e,t){const s={},a=g(e,["customMetadata"]);if(t!==void 0&&a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["customMetadata"],l)}const i=g(e,["chunkingConfig"]);return t!==void 0&&i!=null&&v(t,["chunkingConfig"],i),s}function KR(e){const t={},s=g(e,["name"]);s!=null&&v(t,["name"],s);const a=g(e,["metadata"]);a!=null&&v(t,["metadata"],a);const i=g(e,["done"]);i!=null&&v(t,["done"],i);const l=g(e,["error"]);l!=null&&v(t,["error"],l);const c=g(e,["response"]);return c!=null&&v(t,["response"],JR(c)),t}function WR(e){const t={},s=g(e,["fileSearchStoreName"]);s!=null&&v(t,["_url","file_search_store_name"],s);const a=g(e,["fileName"]);a!=null&&v(t,["fileName"],a);const i=g(e,["config"]);return i!=null&&VR(i,t),t}function JR(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["parent"]);a!=null&&v(t,["parent"],a);const i=g(e,["documentName"]);return i!=null&&v(t,["documentName"],i),t}function YR(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);return t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),s}function XR(e){const t={},s=g(e,["config"]);return s!=null&&YR(s,t),t}function QR(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["fileSearchStores"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["fileSearchStores"],l)}return t}function Jb(e,t){const s={},a=g(e,["mimeType"]);t!==void 0&&a!=null&&v(t,["mimeType"],a);const i=g(e,["displayName"]);t!==void 0&&i!=null&&v(t,["displayName"],i);const l=g(e,["customMetadata"]);if(t!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(f=>f)),v(t,["customMetadata"],u)}const c=g(e,["chunkingConfig"]);return t!==void 0&&c!=null&&v(t,["chunkingConfig"],c),s}function ZR(e){const t={},s=g(e,["fileSearchStoreName"]);s!=null&&v(t,["_url","file_search_store_name"],s);const a=g(e,["config"]);return a!=null&&Jb(a,t),t}function e1(e){const t={},s=g(e,["sdkHttpResponse"]);return s!=null&&v(t,["sdkHttpResponse"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const t1="Content-Type",n1="X-Server-Timeout",s1="User-Agent",kf="x-goog-api-client",a1="1.42.0",r1=`google-genai-sdk/${a1}`,i1="v1beta1",o1="v1beta",l1=5,c1=[408,429,500,502,503,504];class d1{constructor(t){var s,a,i;this.clientOptions=Object.assign({},t),this.customBaseUrl=(s=t.httpOptions)===null||s===void 0?void 0:s.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const l={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const u=t.project&&t.location||!!t.apiKey;this.customBaseUrl&&!u?(l.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?l.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(l.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),l.apiVersion=(a=this.clientOptions.apiVersion)!==null&&a!==void 0?a:i1}else{if(!this.clientOptions.apiKey)throw new al({message:"API key must be set when using the Gemini API.",status:403});l.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:o1,l.baseUrl="https://generativelanguage.googleapis.com/"}l.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=l,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(l,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const a=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&a.push(t.apiVersion),a.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),s=new URL(t);return s.protocol=s.protocol=="http:"?"ws":"wss",s.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,s,a){const i=[this.getRequestUrlInternal(s)];return a&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t,s){return!(s.baseUrl&&s.baseUrlResourceScope===jf.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let s=this.clientOptions.httpOptions;t.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.shouldPrependVertexProjectPath(t,s),i=this.constructUrl(t.path,s,a);if(t.queryParams)for(const[c,u]of Object.entries(t.queryParams))i.searchParams.append(c,String(u));let l={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=t.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,s,i.toString(),t.abortSignal),this.unaryApiCall(i,l,t.httpMethod)}patchHttpOptions(t,s){const a=JSON.parse(JSON.stringify(t));for(const[i,l]of Object.entries(s))typeof l=="object"?a[i]=Object.assign(Object.assign({},a[i]),l):l!==void 0&&(a[i]=l);return a}async requestStream(t){let s=this.clientOptions.httpOptions;t.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.shouldPrependVertexProjectPath(t,s),i=this.constructUrl(t.path,s,a);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let l={};return l.body=t.body,l=await this.includeExtraHttpOptionsToRequestInit(l,s,i.toString(),t.abortSignal),this.streamApiCall(i,l,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,s,a,i){if(s&&s.timeout||i){const l=new AbortController,c=l.signal;if(s.timeout&&(s==null?void 0:s.timeout)>0){const u=setTimeout(()=>l.abort(),s.timeout);u&&typeof u.unref=="function"&&u.unref()}i&&i.addEventListener("abort",()=>{l.abort()}),t.signal=c}return s&&s.extraBody!==null&&u1(t,s.extraBody),t.headers=await this.getHeadersInternal(s,a),t}async unaryApiCall(t,s,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},s),{method:a})).then(async i=>(await mv(i),new _f(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,s,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},s),{method:a})).then(async i=>(await mv(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){return Is(this,arguments,function*(){var a;const i=(a=t==null?void 0:t.body)===null||a===void 0?void 0:a.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let c="";const u="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:m}=yield lt(i.read());if(h){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const x=l.decode(m,{stream:!0});try{const T=JSON.parse(x);if("error"in T){const _=JSON.parse(JSON.stringify(T.error)),j=_.status,E=_.code,k=`got status: ${j}. ${JSON.stringify(T)}`;if(E>=400&&E<600)throw new al({message:k,status:E})}}catch(T){if(T.name==="ApiError")throw T}c+=x;let y=-1,b=0;for(;;){y=-1,b=0;for(const j of f){const E=c.indexOf(j);E!==-1&&(y===-1||E<y)&&(y=E,b=j.length)}if(y===-1)break;const T=c.substring(0,y);c=c.substring(y+b);const _=T.trim();if(_.startsWith(u)){const j=_.substring(u.length).trim();try{const E=new Response(j,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield lt(new _f(E))}catch(E){throw new Error(`exception parsing stream chunk ${j}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(t,s){var a;if(!this.clientOptions.httpOptions||!this.clientOptions.httpOptions.retryOptions)return fetch(t,s);const i=this.clientOptions.httpOptions.retryOptions;return ZC(async()=>{const c=await fetch(t,s);if(c.ok)return c;throw c1.includes(c.status)?new Error(`Retryable HTTP Error: ${c.statusText}`):new Eb.AbortError(`Non-retryable exception ${c.statusText} sending request`)},{retries:((a=i.attempts)!==null&&a!==void 0?a:l1)-1})}getDefaultHeaders(){const t={},s=r1+" "+this.clientOptions.userAgentExtra;return t[s1]=s,t[kf]=s,t[t1]="application/json",t}async getHeadersInternal(t,s){const a=new Headers;if(t&&t.headers){for(const[i,l]of Object.entries(t.headers))a.append(i,l);t.timeout&&t.timeout>0&&a.append(n1,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(a,s),a}getFileName(t){var s;let a="";return typeof t=="string"&&(a=t.replace(/[/\\]+$/,""),a=(s=a.split(/[/\\]/).pop())!==null&&s!==void 0?s:""),a}async uploadFile(t,s){var a;const i={};s!=null&&(i.mimeType=s.mimeType,i.name=s.name,i.displayName=s.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,c=await l.stat(t);i.sizeBytes=String(c.size);const u=(a=s==null?void 0:s.mimeType)!==null&&a!==void 0?a:c.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const f={file:i},h=this.getFileName(t),m=qe("upload/v1beta/files",f._url),x=await this.fetchUploadUrl(m,i.sizeBytes,i.mimeType,h,f,s==null?void 0:s.httpOptions);return l.upload(t,x,this)}async uploadFileToFileSearchStore(t,s,a){var i;const l=this.clientOptions.uploader,c=await l.stat(s),u=String(c.size),f=(i=a==null?void 0:a.mimeType)!==null&&i!==void 0?i:c.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${t}:uploadToFileSearchStore`,m=this.getFileName(s),x={};a!=null&&Jb(a,x);const y=await this.fetchUploadUrl(h,u,f,m,x,a==null?void 0:a.httpOptions);return l.uploadToFileSearchStore(s,y,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,s,a,i,l,c){var u;let f={};c?f=c:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s}`,"X-Goog-Upload-Header-Content-Type":`${a}`},i?{"X-Goog-Upload-File-Name":i}:{})};const h=await this.request({path:t,body:JSON.stringify(l),httpMethod:"POST",httpOptions:f});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(u=h==null?void 0:h.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function mv(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const s=e.status;let a;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?a=await e.json():a={error:{message:await e.text(),code:e.status,status:e.statusText}};const i=JSON.stringify(a);throw s>=400&&s<600?new al({message:i,status:s}):new Error(i)}}function u1(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let s={};if(typeof e.body=="string"&&e.body.length>0)try{const l=JSON.parse(e.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))s=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function a(l,c){const u=Object.assign({},l);for(const f in c)if(Object.prototype.hasOwnProperty.call(c,f)){const h=c[f],m=u[f];h&&typeof h=="object"&&!Array.isArray(h)&&m&&typeof m=="object"&&!Array.isArray(m)?u[f]=a(m,h):(m&&h&&typeof m!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof m}, New type: ${typeof h}. Overwriting.`),u[f]=h)}return u}const i=a(s,t);e.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const h1="mcp_used/unknown";let f1=!1;function Yb(e){for(const t of e)if(m1(t)||typeof t=="object"&&"inputSchema"in t)return!0;return f1}function Xb(e){var t;const s=(t=e[kf])!==null&&t!==void 0?t:"";e[kf]=(s+` ${h1}`).trimStart()}function m1(e){return e!==null&&typeof e=="object"&&e instanceof im}function p1(e){return Is(this,arguments,function*(s,a=100){let i,l=0;for(;l<a;){const c=yield lt(s.listTools({cursor:i}));for(const u of c.tools)yield yield lt(u),l++;if(!c.nextCursor)break;i=c.nextCursor}})}class im{constructor(t=[],s){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=s}static create(t,s){return new im(t,s)}async initialize(){var t,s,a,i;if(this.mcpTools.length>0)return;const l={},c=[];for(const m of this.mcpClients)try{for(var u=!0,f=(s=void 0,As(p1(m))),h;h=await f.next(),t=h.done,!t;u=!0){i=h.value,u=!1;const x=i;c.push(x);const y=x.name;if(l[y])throw new Error(`Duplicate function name ${y} found in MCP tools. Please ensure function names are unique.`);l[y]=m}}catch(x){s={error:x}}finally{try{!u&&!t&&(a=f.return)&&await a.call(f)}finally{if(s)throw s.error}}this.mcpTools=c,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),GI(this.mcpTools,this.config)}async callTool(t){await this.initialize();const s=[];for(const a of t)if(a.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[a.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const c=await i.callTool({name:a.name,arguments:a.args},void 0,l);s.push({functionResponse:{name:a.name,response:c.isError?{error:c}:c}})}return s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function g1(e,t,s){const a=new RI;let i;s.data instanceof Blob?i=JSON.parse(await s.data.text()):i=JSON.parse(s.data),Object.assign(a,i),t(a)}class y1{constructor(t,s,a){this.apiClient=t,this.auth=s,this.webSocketFactory=a}async connect(t){var s,a;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),c=b1(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${i}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${u}`;let h=()=>{};const m=new Promise(C=>{h=C}),x=t.callbacks,y=function(){h({})},b=this.apiClient,T={onopen:y,onmessage:C=>{g1(b,x.onmessage,C)},onerror:(s=x==null?void 0:x.onerror)!==null&&s!==void 0?s:function(C){},onclose:(a=x==null?void 0:x.onclose)!==null&&a!==void 0?a:function(C){}},_=this.webSocketFactory.create(f,v1(c),T);_.connect(),await m;const k={setup:{model:Et(this.apiClient,t.model)}};return _.send(JSON.stringify(k)),new x1(_,this.apiClient)}}class x1{constructor(t,s){this.conn=t,this.apiClient=s}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const s=Gk(t);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const s=Bk(t);this.conn.send(JSON.stringify(s))}sendPlaybackControl(t){const s={playbackControl:t};this.conn.send(JSON.stringify(s))}play(){this.sendPlaybackControl(wi.PLAY)}pause(){this.sendPlaybackControl(wi.PAUSE)}stop(){this.sendPlaybackControl(wi.STOP)}resetContext(){this.sendPlaybackControl(wi.RESET_CONTEXT)}close(){this.conn.close()}}function v1(e){const t={};return e.forEach((s,a)=>{t[a]=s}),t}function b1(e){const t=new Headers;for(const[s,a]of Object.entries(e))t.append(s,a);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N1="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function S1(e,t,s){const a=new DI;let i;s.data instanceof Blob?i=await s.data.text():s.data instanceof ArrayBuffer?i=new TextDecoder().decode(s.data):i=s.data;const l=JSON.parse(i);if(e.isVertexAI()){const c=Hk(l);Object.assign(a,c)}else Object.assign(a,l);t(a)}class w1{constructor(t,s,a){this.apiClient=t,this.auth=s,this.webSocketFactory=a,this.music=new y1(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var s,a,i,l,c,u;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let m;const x=this.apiClient.getHeaders();t.config&&t.config.tools&&Yb(t.config.tools)&&Xb(x);const y=E1(x);if(this.apiClient.isVertexAI()){const U=this.apiClient.getProject(),O=this.apiClient.getLocation(),F=this.apiClient.getApiKey(),q=!!U&&!!O||!!F;this.apiClient.getCustomBaseUrl()&&!q?m=f:(m=`${f}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(y,m))}else{const U=this.apiClient.getApiKey();let O="BidiGenerateContent",F="key";U!=null&&U.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",F="access_token"),m=`${f}/ws/google.ai.generativelanguage.${h}.GenerativeService.${O}?${F}=${U}`}let b=()=>{};const T=new Promise(U=>{b=U}),_=t.callbacks,j=function(){var U;(U=_==null?void 0:_.onopen)===null||U===void 0||U.call(_),b({})},E=this.apiClient,k={onopen:j,onmessage:U=>{S1(E,_.onmessage,U)},onerror:(s=_==null?void 0:_.onerror)!==null&&s!==void 0?s:function(U){},onclose:(a=_==null?void 0:_.onclose)!==null&&a!==void 0?a:function(U){}},C=this.webSocketFactory.create(m,_1(y),k);C.connect(),await T;let A=Et(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&A.startsWith("publishers/")){const U=this.apiClient.getProject(),O=this.apiClient.getLocation();U&&O&&(A=`projects/${U}/locations/${O}/`+A)}let M={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[td.AUDIO]}:t.config.responseModalities=[td.AUDIO]),!((l=t.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const I=(u=(c=t.config)===null||c===void 0?void 0:c.tools)!==null&&u!==void 0?u:[],P=[];for(const U of I)if(this.isCallableTool(U)){const O=U;P.push(await O.tool())}else P.push(U);P.length>0&&(t.config.tools=P);const D={model:A,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?M=Fk(this.apiClient,D):M=Uk(this.apiClient,D),delete M.config,C.send(JSON.stringify(M)),new j1(C,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const T1={turnComplete:!0};class j1{constructor(t,s){this.conn=t,this.apiClient=s}tLiveClientContent(t,s){if(s.turns!==null&&s.turns!==void 0){let a=[];try{a=rs(s.turns),t.isVertexAI()||(a=a.map(i=>ll(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof s.turns}'`)}return{clientContent:{turns:a,turnComplete:s.turnComplete}}}return{clientContent:{turnComplete:s.turnComplete}}}tLiveClienttToolResponse(t,s){let a=[];if(s.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(s.functionResponses)?a=s.functionResponses:a=[s.functionResponses],a.length===0)throw new Error("functionResponses is required.");for(const l of a){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!t.isVertexAI()&&!("id"in l))throw new Error(N1)}return{toolResponse:{functionResponses:a}}}sendClientContent(t){t=Object.assign(Object.assign({},T1),t);const s=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(s))}sendRealtimeInput(t){let s={};this.apiClient.isVertexAI()?s={realtimeInput:$k(t)}:s={realtimeInput:zk(t)},this.conn.send(JSON.stringify(s))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const s=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(s))}close(){this.conn.close()}}function _1(e){const t={};return e.forEach((s,a)=>{t[a]=s}),t}function E1(e){const t=new Headers;for(const[s,a]of Object.entries(e))t.append(s,a);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pv=10;function gv(e){var t,s,a;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let i=!1;for(const c of(s=e==null?void 0:e.tools)!==null&&s!==void 0?s:[])if(Ei(c)){i=!0;break}if(!i)return!0;const l=(a=e==null?void 0:e.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function Ei(e){return"callTool"in e&&typeof e.callTool=="function"}function C1(e){var t,s,a;return(a=(s=(t=e.config)===null||t===void 0?void 0:t.tools)===null||s===void 0?void 0:s.some(i=>Ei(i)))!==null&&a!==void 0?a:!1}function yv(e){var t;const s=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((a,i)=>{if(Ei(a))return;const l=a;l.functionDeclarations&&l.functionDeclarations.length>0&&s.push(i)}),s}function xv(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class I1 extends va{constructor(t){super(),this.apiClient=t,this.embedContent=async s=>{if(!this.apiClient.isVertexAI())return await this.embedContentInternal(s);if(s.model.includes("gemini")&&s.model!=="gemini-embedding-001"||s.model.includes("maas")){const i=rs(s.contents);if(i.length>1)throw new Error("The embedContent API for this model only supports one content at a time.");const l=Object.assign(Object.assign({},s),{content:i[0],embeddingApiType:nd.EMBED_CONTENT});return await this.embedContentInternal(l)}else{const i=Object.assign(Object.assign({},s),{embeddingApiType:nd.PREDICT});return await this.embedContentInternal(i)}},this.generateContent=async s=>{var a,i,l,c,u;const f=await this.processParamsMaybeAddMcpUsage(s);if(this.maybeMoveToResponseJsonSchem(s),!C1(s)||gv(s.config))return await this.generateContentInternal(f);const h=yv(s);if(h.length>0){const _=h.map(j=>`tools[${j}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${_}.`)}let m,x;const y=rs(f.contents),b=(l=(i=(a=f.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&l!==void 0?l:pv;let T=0;for(;T<b&&(m=await this.generateContentInternal(f),!(!m.functionCalls||m.functionCalls.length===0));){const _=m.candidates[0].content,j=[];for(const E of(u=(c=s.config)===null||c===void 0?void 0:c.tools)!==null&&u!==void 0?u:[])if(Ei(E)){const C=await E.callTool(m.functionCalls);j.push(...C)}T++,x={role:"user",parts:j},f.contents=rs(f.contents),f.contents.push(_),f.contents.push(x),xv(f.config)&&(y.push(_),y.push(x))}return xv(f.config)&&(m.automaticFunctionCallingHistory=y),m},this.generateContentStream=async s=>{var a,i,l,c,u;if(this.maybeMoveToResponseJsonSchem(s),gv(s.config)){const x=await this.processParamsMaybeAddMcpUsage(s);return await this.generateContentStreamInternal(x)}const f=yv(s);if(f.length>0){const x=f.map(y=>`tools[${y}]`).join(", ");throw new Error(`Incompatible tools found at ${x}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(l=(i=(a=s==null?void 0:s.config)===null||a===void 0?void 0:a.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||l===void 0?void 0:l.streamFunctionCallArguments,m=(u=(c=s==null?void 0:s.config)===null||c===void 0?void 0:c.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(h&&!m)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(s)},this.generateImages=async s=>await this.generateImagesInternal(s).then(a=>{var i;let l;const c=[];if(a!=null&&a.generatedImages)for(const f of a.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((i=f==null?void 0:f.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=f==null?void 0:f.safetyAttributes:c.push(f);let u;return l?u={generatedImages:c,positivePromptSafetyAttributes:l,sdkHttpResponse:a.sdkHttpResponse}:u={generatedImages:c,sdkHttpResponse:a.sdkHttpResponse},u}),this.list=async s=>{var a;const c={config:Object.assign(Object.assign({},{queryBase:!0}),s==null?void 0:s.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((a=c.config)===null||a===void 0)&&a.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new Ar(ya.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(c),c)},this.editImage=async s=>{const a={model:s.model,prompt:s.prompt,referenceImages:[],config:s.config};return s.referenceImages&&s.referenceImages&&(a.referenceImages=s.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(a)},this.upscaleImage=async s=>{let a={numberOfImages:1,mode:"upscale"};s.config&&(a=Object.assign(Object.assign({},a),s.config));const i={model:s.model,image:s.image,upscaleFactor:s.upscaleFactor,config:a};return await this.upscaleImageInternal(i)},this.generateVideos=async s=>{var a,i,l,c,u,f;if((s.prompt||s.image||s.video)&&s.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((a=s.video)===null||a===void 0)&&a.uri&&(!((i=s.video)===null||i===void 0)&&i.videoBytes)?s.video={uri:s.video.uri,mimeType:s.video.mimeType}:!((c=(l=s.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.uri&&(!((f=(u=s.source)===null||u===void 0?void 0:u.video)===null||f===void 0)&&f.videoBytes)&&(s.source.video={uri:s.source.video.uri,mimeType:s.source.video.mimeType})),await this.generateVideosInternal(s)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var s,a,i;const l=(s=t.config)===null||s===void 0?void 0:s.tools;if(!l)return t;const c=await Promise.all(l.map(async f=>Ei(f)?await f.tool():f)),u={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:c})};if(u.config.tools=c,t.config&&t.config.tools&&Yb(t.config.tools)){const f=(i=(a=t.config.httpOptions)===null||a===void 0?void 0:a.headers)!==null&&i!==void 0?i:{};let h=Object.assign({},f);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),Xb(h),u.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:h})}return u}async initAfcToolsMap(t){var s,a,i;const l=new Map;for(const c of(a=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(Ei(c)){const u=c,f=await u.tool();for(const h of(i=f.functionDeclarations)!==null&&i!==void 0?i:[]){if(!h.name)throw new Error("Function declaration name is required.");if(l.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);l.set(h.name,u)}}return l}async processAfcStream(t){var s,a,i;const l=(i=(a=(s=t.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:pv;let c=!1,u=0;const f=await this.initAfcToolsMap(t);return(function(h,m,x){return Is(this,arguments,function*(){for(var y,b,T,_,j,E;u<l;){c&&(u++,c=!1);const M=yield lt(h.processParamsMaybeAddMcpUsage(x)),I=yield lt(h.generateContentStreamInternal(M)),P=[],D=[];try{for(var k=!0,C=(b=void 0,As(I)),A;A=yield lt(C.next()),y=A.done,!y;k=!0){_=A.value,k=!1;const U=_;if(yield yield lt(U),U.candidates&&(!((j=U.candidates[0])===null||j===void 0)&&j.content)){D.push(U.candidates[0].content);for(const O of(E=U.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(u<l&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(O.functionCall.name)){const F=yield lt(m.get(O.functionCall.name).callTool([O.functionCall]));P.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch(U){b={error:U}}finally{try{!k&&!y&&(T=C.return)&&(yield lt(T.call(C)))}finally{if(b)throw b.error}}if(P.length>0){c=!0;const U=new Bo;U.candidates=[{content:{role:"user",parts:P}}],yield yield lt(U);const O=[];O.push(...D),O.push({role:"user",parts:P});const F=rs(x.contents).concat(O);x.contents=F}else break}})})(this,f,t)}async generateContentInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=uv(this.apiClient,t);return u=qe("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=fv(m),y=new Bo;return Object.assign(y,x),y})}else{const h=dv(this.apiClient,t);return u=qe("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=hv(m),y=new Bo;return Object.assign(y,x),y})}}async generateContentStreamInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=uv(this.apiClient,t);return u=qe("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}),c.then(function(x){return Is(this,arguments,function*(){var y,b,T,_;try{for(var j=!0,E=As(x),k;k=yield lt(E.next()),y=k.done,!y;j=!0){_=k.value,j=!1;const C=_,A=fv(yield lt(C.json()),t);A.sdkHttpResponse={headers:C.headers};const M=new Bo;Object.assign(M,A),yield yield lt(M)}}catch(C){b={error:C}}finally{try{!j&&!y&&(T=E.return)&&(yield lt(T.call(E)))}finally{if(b)throw b.error}}})})}else{const h=dv(this.apiClient,t);return u=qe("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}),c.then(function(x){return Is(this,arguments,function*(){var y,b,T,_;try{for(var j=!0,E=As(x),k;k=yield lt(E.next()),y=k.done,!y;j=!0){_=k.value,j=!1;const C=_,A=hv(yield lt(C.json()),t);A.sdkHttpResponse={headers:C.headers};const M=new Bo;Object.assign(M,A),yield yield lt(M)}}catch(C){b={error:C}}finally{try{!j&&!y&&(T=E.return)&&(yield lt(T.call(E)))}finally{if(b)throw b.error}}})})}}async embedContentInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=ND(this.apiClient,t,t),m=$I(t.model)?"{model}:embedContent":"{model}:predict";return u=qe(m,h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(x=>x.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:x.headers},b})),c.then(x=>{const y=wD(x,t),b=new K0;return Object.assign(b,y),b})}else{const h=bD(this.apiClient,t);return u=qe("{model}:batchEmbedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=SD(m),y=new K0;return Object.assign(y,x),y})}}async generateImagesInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=MD(this.apiClient,t);return u=qe("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=OD(m),y=new W0;return Object.assign(y,x),y})}else{const h=RD(this.apiClient,t);return u=qe("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=PD(m),y=new W0;return Object.assign(y,x),y})}}async editImageInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=gD(this.apiClient,t);return l=qe("{model}:predict",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=yD(f),m=new bI;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=MR(this.apiClient,t);return l=qe("{model}:predict",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=PR(f),m=new NI;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=pR(this.apiClient,t);return l=qe("{model}:predict",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=gR(f),m=new SI;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=SR(this.apiClient,t);return l=qe("{model}:predict",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=wR(f),m=new wI;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=ZD(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>Af(m))}else{const h=QD(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>If(m))}}async listInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=lR(this.apiClient,t);return u=qe("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=dR(m),y=new J0;return Object.assign(y,x),y})}else{const h=oR(this.apiClient,t);return u=qe("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=cR(m),y=new J0;return Object.assign(y,x),y})}}async update(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=DR(this.apiClient,t);return u=qe("{model}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>Af(m))}else{const h=kR(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>If(m))}}async delete(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=hD(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=mD(m),y=new Y0;return Object.assign(y,x),y})}else{const h=uD(this.apiClient,t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=fD(m),y=new Y0;return Object.assign(y,x),y})}}async countTokens(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=lD(this.apiClient,t);return u=qe("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=dD(m),y=new X0;return Object.assign(y,x),y})}else{const h=oD(this.apiClient,t);return u=qe("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=cD(m),y=new X0;return Object.assign(y,x),y})}}async computeTokens(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=eD(this.apiClient,t);return l=qe("{model}:computeTokens",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=tD(f),m=new TI;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=zD(this.apiClient,t);return u=qe("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>{const x=BD(m),y=new sd;return Object.assign(y,x),y})}else{const h=GD(this.apiClient,t);return u=qe("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>{const x=FD(m),y=new sd;return Object.assign(y,x),y})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class A1 extends va{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const s=t.operation,a=t.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=s.name.split("/operations/")[0];let l;a&&"httpOptions"in a&&(l=a.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:i,config:{httpOptions:l}});return s._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:s.name,config:a});return s._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(t){const s=t.operation,a=t.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=s.name.split("/operations/")[0];let l;a&&"httpOptions"in a&&(l=a.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:i,config:{httpOptions:l}});return s._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:s.name,config:a});return s._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=mI(t);return u=qe("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c}else{const h=fI(t);return u=qe("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c}}async fetchPredictVideosOperationInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=iI(t);return l=qe("{resourceName}:fetchPredictOperation",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function k1(e){const t={},s=g(e,["data"]);if(s!=null&&v(t,["data"],s),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function D1(e){const t={},s=g(e,["parts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(l=>G1(l))),v(t,["parts"],i)}const a=g(e,["role"]);return a!=null&&v(t,["role"],a),t}function R1(e,t,s){const a={},i=g(t,["expireTime"]);s!==void 0&&i!=null&&v(s,["expireTime"],i);const l=g(t,["newSessionExpireTime"]);s!==void 0&&l!=null&&v(s,["newSessionExpireTime"],l);const c=g(t,["uses"]);s!==void 0&&c!=null&&v(s,["uses"],c);const u=g(t,["liveConnectConstraints"]);s!==void 0&&u!=null&&v(s,["bidiGenerateContentSetup"],B1(e,u));const f=g(t,["lockAdditionalFields"]);return s!==void 0&&f!=null&&v(s,["fieldMask"],f),a}function M1(e,t){const s={},a=g(t,["config"]);return a!=null&&v(s,["config"],R1(e,a,s)),s}function P1(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=g(e,["fileUri"]);s!=null&&v(t,["fileUri"],s);const a=g(e,["mimeType"]);return a!=null&&v(t,["mimeType"],a),t}function O1(e){const t={},s=g(e,["id"]);s!=null&&v(t,["id"],s);const a=g(e,["args"]);a!=null&&v(t,["args"],a);const i=g(e,["name"]);if(i!=null&&v(t,["name"],i),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function L1(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=g(e,["enableWidget"]);return s!=null&&v(t,["enableWidget"],s),t}function U1(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=g(e,["timeRangeFilter"]);return s!=null&&v(t,["timeRangeFilter"],s),t}function F1(e,t){const s={},a=g(e,["generationConfig"]);t!==void 0&&a!=null&&v(t,["setup","generationConfig"],a);const i=g(e,["responseModalities"]);t!==void 0&&i!=null&&v(t,["setup","generationConfig","responseModalities"],i);const l=g(e,["temperature"]);t!==void 0&&l!=null&&v(t,["setup","generationConfig","temperature"],l);const c=g(e,["topP"]);t!==void 0&&c!=null&&v(t,["setup","generationConfig","topP"],c);const u=g(e,["topK"]);t!==void 0&&u!=null&&v(t,["setup","generationConfig","topK"],u);const f=g(e,["maxOutputTokens"]);t!==void 0&&f!=null&&v(t,["setup","generationConfig","maxOutputTokens"],f);const h=g(e,["mediaResolution"]);t!==void 0&&h!=null&&v(t,["setup","generationConfig","mediaResolution"],h);const m=g(e,["seed"]);t!==void 0&&m!=null&&v(t,["setup","generationConfig","seed"],m);const x=g(e,["speechConfig"]);t!==void 0&&x!=null&&v(t,["setup","generationConfig","speechConfig"],rm(x));const y=g(e,["thinkingConfig"]);t!==void 0&&y!=null&&v(t,["setup","generationConfig","thinkingConfig"],y);const b=g(e,["enableAffectiveDialog"]);t!==void 0&&b!=null&&v(t,["setup","generationConfig","enableAffectiveDialog"],b);const T=g(e,["systemInstruction"]);t!==void 0&&T!=null&&v(t,["setup","systemInstruction"],D1(Sn(T)));const _=g(e,["tools"]);if(t!==void 0&&_!=null){let I=Ri(_);Array.isArray(I)&&(I=I.map(P=>$1(Di(P)))),v(t,["setup","tools"],I)}const j=g(e,["sessionResumption"]);t!==void 0&&j!=null&&v(t,["setup","sessionResumption"],z1(j));const E=g(e,["inputAudioTranscription"]);t!==void 0&&E!=null&&v(t,["setup","inputAudioTranscription"],E);const k=g(e,["outputAudioTranscription"]);t!==void 0&&k!=null&&v(t,["setup","outputAudioTranscription"],k);const C=g(e,["realtimeInputConfig"]);t!==void 0&&C!=null&&v(t,["setup","realtimeInputConfig"],C);const A=g(e,["contextWindowCompression"]);t!==void 0&&A!=null&&v(t,["setup","contextWindowCompression"],A);const M=g(e,["proactivity"]);if(t!==void 0&&M!=null&&v(t,["setup","proactivity"],M),g(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return s}function B1(e,t){const s={},a=g(t,["model"]);a!=null&&v(s,["setup","model"],Et(e,a));const i=g(t,["config"]);return i!=null&&v(s,["config"],F1(i,s)),s}function G1(e){const t={},s=g(e,["mediaResolution"]);s!=null&&v(t,["mediaResolution"],s);const a=g(e,["codeExecutionResult"]);a!=null&&v(t,["codeExecutionResult"],a);const i=g(e,["executableCode"]);i!=null&&v(t,["executableCode"],i);const l=g(e,["fileData"]);l!=null&&v(t,["fileData"],P1(l));const c=g(e,["functionCall"]);c!=null&&v(t,["functionCall"],O1(c));const u=g(e,["functionResponse"]);u!=null&&v(t,["functionResponse"],u);const f=g(e,["inlineData"]);f!=null&&v(t,["inlineData"],k1(f));const h=g(e,["text"]);h!=null&&v(t,["text"],h);const m=g(e,["thought"]);m!=null&&v(t,["thought"],m);const x=g(e,["thoughtSignature"]);x!=null&&v(t,["thoughtSignature"],x);const y=g(e,["videoMetadata"]);return y!=null&&v(t,["videoMetadata"],y),t}function z1(e){const t={},s=g(e,["handle"]);if(s!=null&&v(t,["handle"],s),g(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function $1(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(e,["computerUse"]);s!=null&&v(t,["computerUse"],s);const a=g(e,["fileSearch"]);a!=null&&v(t,["fileSearch"],a);const i=g(e,["codeExecution"]);if(i!=null&&v(t,["codeExecution"],i),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=g(e,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(t,["functionDeclarations"],m)}const c=g(e,["googleMaps"]);c!=null&&v(t,["googleMaps"],L1(c));const u=g(e,["googleSearch"]);u!=null&&v(t,["googleSearch"],U1(u));const f=g(e,["googleSearchRetrieval"]);f!=null&&v(t,["googleSearchRetrieval"],f);const h=g(e,["urlContext"]);return h!=null&&v(t,["urlContext"],h),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function H1(e){const t=[];for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const a=e[s];if(typeof a=="object"&&a!=null&&Object.keys(a).length>0){const i=Object.keys(a).map(l=>`${s}.${l}`);t.push(...i)}else t.push(s)}return t.join(",")}function q1(e,t){let s=null;const a=e.bidiGenerateContentSetup;if(typeof a=="object"&&a!==null&&"setup"in a){const l=a.setup;typeof l=="object"&&l!==null?(e.bidiGenerateContentSetup=l,s=l):delete e.bidiGenerateContentSetup}else a!==void 0&&delete e.bidiGenerateContentSetup;const i=e.fieldMask;if(s){const l=H1(s);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)l?e.fieldMask=l:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];i.length>0&&(u=i.map(h=>c.includes(h)?`generationConfig.${h}`:h));const f=[];l&&f.push(l),u.length>0&&f.push(...u),f.length>0?e.fieldMask=f.join(","):delete e.fieldMask}else delete e.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}class V1 extends va{constructor(t){super(),this.apiClient=t}async create(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=M1(this.apiClient,t);l=qe("auth_tokens",u._url),c=u._query,delete u.config,delete u._url,delete u._query;const f=q1(u,t.config);return i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),i.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function K1(e,t){const s={},a=g(e,["force"]);return t!==void 0&&a!=null&&v(t,["_query","force"],a),s}function W1(e){const t={},s=g(e,["name"]);s!=null&&v(t,["_url","name"],s);const a=g(e,["config"]);return a!=null&&K1(a,t),t}function J1(e){const t={},s=g(e,["name"]);return s!=null&&v(t,["_url","name"],s),t}function Y1(e,t){const s={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&v(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);return t!==void 0&&i!=null&&v(t,["_query","pageToken"],i),s}function X1(e){const t={},s=g(e,["parent"]);s!=null&&v(t,["_url","parent"],s);const a=g(e,["config"]);return a!=null&&Y1(a,t),t}function Q1(e){const t={},s=g(e,["sdkHttpResponse"]);s!=null&&v(t,["sdkHttpResponse"],s);const a=g(e,["nextPageToken"]);a!=null&&v(t,["nextPageToken"],a);const i=g(e,["documents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["documents"],l)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Z1 extends va{constructor(t){super(),this.apiClient=t,this.list=async s=>new Ar(ya.PAGED_ITEM_DOCUMENTS,a=>this.listInternal({parent:s.parent,config:a.config}),await this.listInternal(s),s)}async get(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=J1(t);return l=qe("{name}",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(t){var s,a;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=W1(t);i=qe("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=X1(t);return l=qe("{parent}/documents",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=Q1(f),m=new jI;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eM extends va{constructor(t,s=new Z1(t)){super(),this.apiClient=t,this.documents=s,this.list=async(a={})=>new Ar(ya.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(a),a)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=zR(t);return l=qe("fileSearchStores",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async get(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=qR(t);return l=qe("{name}",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(t){var s,a;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=HR(t);i=qe("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=XR(t);return l=qe("fileSearchStores",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=QR(f),m=new _I;return Object.assign(m,h),m})}}async uploadToFileSearchStoreInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ZR(t);return l=qe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=e1(f),m=new EI;return Object.assign(m,h),m})}}async importFile(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=WR(t);return l=qe("{file_search_store_name}:importFile",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),i.then(f=>{const h=KR(f),m=new em;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Qb=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return Qb=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(+a^s()&15>>+a/4).toString(16))};const tM=()=>Qb();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Df(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const Rf=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ns extends Error{}class Bn extends Ns{constructor(t,s,a,i){super(`${Bn.makeMessage(t,s,a)}`),this.status=t,this.headers=i,this.error=s}static makeMessage(t,s,a){const i=s!=null&&s.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):a;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,s,a,i){if(!t||!i)return new xd({message:a,cause:Rf(s)});const l=s;return t===400?new eN(t,l,a,i):t===401?new tN(t,l,a,i):t===403?new nN(t,l,a,i):t===404?new sN(t,l,a,i):t===409?new aN(t,l,a,i):t===422?new rN(t,l,a,i):t===429?new iN(t,l,a,i):t>=500?new oN(t,l,a,i):new Bn(t,l,a,i)}}class Mf extends Bn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class xd extends Bn{constructor({message:t,cause:s}){super(void 0,void 0,t||"Connection error.",void 0),s&&(this.cause=s)}}class Zb extends xd{constructor({message:t}={}){super({message:t??"Request timed out."})}}class eN extends Bn{}class tN extends Bn{}class nN extends Bn{}class sN extends Bn{}class aN extends Bn{}class rN extends Bn{}class iN extends Bn{}class oN extends Bn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nM=/^[a-z][a-z0-9+.-]*:/i,sM=e=>nM.test(e);let Pf=e=>(Pf=Array.isArray,Pf(e));const aM=Pf;let rM=aM;const vv=rM;function iM(e){if(!e)return!0;for(const t in e)return!1;return!0}function oM(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const lM=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Ns(`${e} must be an integer`);if(t<0)throw new Ns(`${e} must be a positive integer`);return t},cM=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dM=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bi="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uM(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const hM=()=>{var e,t,s,a,i;const l=uM();if(l==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":Nv(Deno.build.os),"X-Stainless-Arch":bv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(l==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":Nv((s=globalThis.process.platform)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Arch":bv((a=globalThis.process.arch)!==null&&a!==void 0?a:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const c=fM();return c?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${c.browser}`,"X-Stainless-Runtime-Version":c.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function fM(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const a=s.exec(navigator.userAgent);if(a){const i=a[1]||0,l=a[2]||0,c=a[3]||0;return{browser:t,version:`${i}.${l}.${c}`}}}return null}const bv=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",Nv=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let Uc;const mM=()=>Uc??(Uc=hM());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pM(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function lN(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function gM(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return lN({start(){},async pull(s){const{done:a,value:i}=await t.next();a?s.close():s.enqueue(i)},async cancel(){var s;await((s=t.return)===null||s===void 0?void 0:s.call(t))}})}function cN(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const s=await t.read();return s!=null&&s.done&&t.releaseLock(),s}catch(s){throw t.releaseLock(),s}},async return(){const s=t.cancel();return t.releaseLock(),await s,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function yM(e){var t,s;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((s=(t=e[Symbol.asyncIterator]()).return)===null||s===void 0?void 0:s.call(t));return}const a=e.getReader(),i=a.cancel();a.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xM=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dN=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,s=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(s?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Qh(e,t,s){return dN(),new File(e,t??"unknown_file",s)}function vM(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const bM=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uN=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",NM=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&uN(e),SM=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function wM(e,t,s){if(dN(),e=await e,NM(e))return e instanceof File?e:Qh([await e.arrayBuffer()],e.name);if(SM(e)){const i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Qh(await Of(i),t,s)}const a=await Of(e);if(t||(t=vM(e)),!(s!=null&&s.type)){const i=a.find(l=>typeof l=="object"&&"type"in l&&l.type);typeof i=="string"&&(s=Object.assign(Object.assign({},s),{type:i}))}return Qh(a,t,s)}async function Of(e){var t,s,a,i,l;let c=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)c.push(e);else if(uN(e))c.push(e instanceof Blob?e:await e.arrayBuffer());else if(bM(e))try{for(var u=!0,f=As(e),h;h=await f.next(),t=h.done,!t;u=!0){i=h.value,u=!1;const m=i;c.push(...await Of(m))}}catch(m){s={error:m}}finally{try{!u&&!t&&(a=f.return)&&await a.call(f)}finally{if(s)throw s.error}}else{const m=(l=e==null?void 0:e.constructor)===null||l===void 0?void 0:l.name;throw new Error(`Unexpected data type: ${typeof e}${m?`; constructor: ${m}`:""}${TM(e)}`)}return c}function TM(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(s=>`"${s}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hN{constructor(t){this._client=t}}hN._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fN(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Sv=Object.freeze(Object.create(null)),jM=(e=fN)=>(function(s,...a){if(s.length===1)return s[0];let i=!1;const l=[],c=s.reduce((m,x,y)=>{var b,T,_;/[?#]/.test(x)&&(i=!0);const j=a[y];let E=(i?encodeURIComponent:e)(""+j);return y!==a.length&&(j==null||typeof j=="object"&&j.toString===((_=Object.getPrototypeOf((T=Object.getPrototypeOf((b=j.hasOwnProperty)!==null&&b!==void 0?b:Sv))!==null&&T!==void 0?T:Sv))===null||_===void 0?void 0:_.toString))&&(E=j+"",l.push({start:m.length+x.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(j).slice(8,-1)} is not a valid path parameter`})),m+x+(y===a.length?"":E)},""),u=c.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=f.exec(u))!==null;)l.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(l.sort((m,x)=>m.start-x.start),l.length>0){let m=0;const x=l.reduce((y,b)=>{const T=" ".repeat(b.start-m),_="^".repeat(b.length);return m=b.start+b.length,y+T+_},"");throw new Ns(`Path parameters result in path with invalid segments:
${l.map(y=>y.error).join(`
`)}
${c}
${x}`)}return c}),Fc=jM(fN);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mN extends hN{create(t,s){var a;const{api_version:i=this._client.apiVersion}=t,l=rd(t,["api_version"]);if("model"in l&&"agent_config"in l)throw new Ns("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in l&&"generation_config"in l)throw new Ns("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Fc`/${i}/interactions`,Object.assign(Object.assign({body:l},s),{stream:(a=t.stream)!==null&&a!==void 0?a:!1}))}delete(t,s={},a){const{api_version:i=this._client.apiVersion}=s??{};return this._client.delete(Fc`/${i}/interactions/${t}`,a)}cancel(t,s={},a){const{api_version:i=this._client.apiVersion}=s??{};return this._client.post(Fc`/${i}/interactions/${t}/cancel`,a)}get(t,s={},a){var i;const l=s??{},{api_version:c=this._client.apiVersion}=l,u=rd(l,["api_version"]);return this._client.get(Fc`/${c}/interactions/${t}`,Object.assign(Object.assign({query:u},a),{stream:(i=s==null?void 0:s.stream)!==null&&i!==void 0?i:!1}))}}mN._key=Object.freeze(["interactions"]);class pN extends mN{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _M(e){let t=0;for(const i of e)t+=i.length;const s=new Uint8Array(t);let a=0;for(const i of e)s.set(i,a),a+=i.length;return s}let Bc;function om(e){let t;return(Bc??(t=new globalThis.TextEncoder,Bc=t.encode.bind(t)))(e)}let Gc;function wv(e){let t;return(Gc??(t=new globalThis.TextDecoder,Gc=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vd{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?om(t):t;this.buffer=_M([this.buffer,s]);const a=[];let i;for(;(i=EM(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){a.push(wv(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const l=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,c=wv(this.buffer.subarray(0,l));a.push(c),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return a}flush(){return this.buffer.length?this.decode(`
`):[]}}vd.NEWLINE_CHARS=new Set([`
`,"\r"]);vd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function EM(e,t){for(let i=t??0;i<e.length;i++){if(e[i]===10)return{preceding:i,index:i+1,carriage:!1};if(e[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function CM(e){for(let a=0;a<e.length-1;a++){if(e[a]===10&&e[a+1]===10||e[a]===13&&e[a+1]===13)return a+2;if(e[a]===13&&e[a+1]===10&&a+3<e.length&&e[a+2]===13&&e[a+3]===10)return a+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const id={off:0,error:200,warn:300,info:400,debug:500},Tv=(e,t,s)=>{if(e){if(oM(id,e))return e;Fn(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(id))}`)}};function $o(){}function zc(e,t,s){return!t||id[e]>id[s]?$o:t[e].bind(t)}const IM={error:$o,warn:$o,info:$o,debug:$o};let jv=new WeakMap;function Fn(e){var t;const s=e.logger,a=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!s)return IM;const i=jv.get(s);if(i&&i[0]===a)return i[1];const l={error:zc("error",s,a),warn:zc("warn",s,a),info:zc("info",s,a),debug:zc("debug",s,a)};return jv.set(s,[a,l]),l}const jr=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,s])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":s]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ti{constructor(t,s,a){this.iterator=t,this.controller=s,this.client=a}static fromSSEResponse(t,s,a){let i=!1;const l=a?Fn(a):console;function c(){return Is(this,arguments,function*(){var f,h,m,x;if(i)throw new Ns("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let y=!1;try{try{for(var b=!0,T=As(AM(t,s)),_;_=yield lt(T.next()),f=_.done,!f;b=!0){x=_.value,b=!1;const j=x;if(!y)if(j.data.startsWith("[DONE]")){y=!0;continue}else try{yield yield lt(JSON.parse(j.data))}catch(E){throw l.error("Could not parse message into JSON:",j.data),l.error("From chunk:",j.raw),E}}}catch(j){h={error:j}}finally{try{!b&&!f&&(m=T.return)&&(yield lt(m.call(T)))}finally{if(h)throw h.error}}y=!0}catch(j){if(Df(j))return yield lt(void 0);throw j}finally{y||s.abort()}})}return new Ti(c,s,a)}static fromReadableStream(t,s,a){let i=!1;function l(){return Is(this,arguments,function*(){var f,h,m,x;const y=new vd,b=cN(t);try{for(var T=!0,_=As(b),j;j=yield lt(_.next()),f=j.done,!f;T=!0){x=j.value,T=!1;const E=x;for(const k of y.decode(E))yield yield lt(k)}}catch(E){h={error:E}}finally{try{!T&&!f&&(m=_.return)&&(yield lt(m.call(_)))}finally{if(h)throw h.error}}for(const E of y.flush())yield yield lt(E)})}function c(){return Is(this,arguments,function*(){var f,h,m,x;if(i)throw new Ns("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let y=!1;try{try{for(var b=!0,T=As(l()),_;_=yield lt(T.next()),f=_.done,!f;b=!0){x=_.value,b=!1;const j=x;y||j&&(yield yield lt(JSON.parse(j)))}}catch(j){h={error:j}}finally{try{!b&&!f&&(m=T.return)&&(yield lt(m.call(T)))}finally{if(h)throw h.error}}y=!0}catch(j){if(Df(j))return yield lt(void 0);throw j}finally{y||s.abort()}})}return new Ti(c,s,a)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],s=[],a=this.iterator(),i=l=>({next:()=>{if(l.length===0){const c=a.next();t.push(c),s.push(c)}return l.shift()}});return[new Ti(()=>i(t),this.controller,this.client),new Ti(()=>i(s),this.controller,this.client)]}toReadableStream(){const t=this;let s;return lN({async start(){s=t[Symbol.asyncIterator]()},async pull(a){try{const{value:i,done:l}=await s.next();if(l)return a.close();const c=om(JSON.stringify(i)+`
`);a.enqueue(c)}catch(i){a.error(i)}},async cancel(){var a;await((a=s.return)===null||a===void 0?void 0:a.call(s))}})}}function AM(e,t){return Is(this,arguments,function*(){var a,i,l,c;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Ns("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ns("Attempted to iterate over a response with no body");const u=new DM,f=new vd,h=cN(e.body);try{for(var m=!0,x=As(kM(h)),y;y=yield lt(x.next()),a=y.done,!a;m=!0){c=y.value,m=!1;const b=c;for(const T of f.decode(b)){const _=u.decode(T);_&&(yield yield lt(_))}}}catch(b){i={error:b}}finally{try{!m&&!a&&(l=x.return)&&(yield lt(l.call(x)))}finally{if(i)throw i.error}}for(const b of f.flush()){const T=u.decode(b);T&&(yield yield lt(T))}})}function kM(e){return Is(this,arguments,function*(){var s,a,i,l;let c=new Uint8Array;try{for(var u=!0,f=As(e),h;h=yield lt(f.next()),s=h.done,!s;u=!0){l=h.value,u=!1;const m=l;if(m==null)continue;const x=m instanceof ArrayBuffer?new Uint8Array(m):typeof m=="string"?om(m):m;let y=new Uint8Array(c.length+x.length);y.set(c),y.set(x,c.length),c=y;let b;for(;(b=CM(c))!==-1;)yield yield lt(c.slice(0,b)),c=c.slice(b)}}catch(m){a={error:m}}finally{try{!u&&!s&&(i=f.return)&&(yield lt(i.call(f)))}finally{if(a)throw a.error}}c.length>0&&(yield yield lt(c))})}class DM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(t),t.startsWith(":"))return null;let[s,a,i]=RM(t,":");return i.startsWith(" ")&&(i=i.substring(1)),s==="event"?this.event=i:s==="data"&&this.data.push(i),null}}function RM(e,t){const s=e.indexOf(t);return s!==-1?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function MM(e,t){const{response:s,requestLogID:a,retryOfRequestLogID:i,startTime:l}=t,c=await(async()=>{var u;if(t.options.stream)return Fn(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller,e):Ti.fromSSEResponse(s,t.controller,e);if(s.status===204)return null;if(t.options.__binaryResponse)return s;const f=s.headers.get("content-type"),h=(u=f==null?void 0:f.split(";")[0])===null||u===void 0?void 0:u.trim();return(h==null?void 0:h.includes("application/json"))||(h==null?void 0:h.endsWith("+json"))?s.headers.get("content-length")==="0"?void 0:await s.json():await s.text()})();return Fn(e).debug(`[${a}] response parsed`,jr({retryOfRequestLogID:i,url:s.url,status:s.status,body:c,durationMs:Date.now()-l})),c}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lm extends Promise{constructor(t,s,a=MM){super(i=>{i(null)}),this.responsePromise=s,this.parseResponse=a,this.client=t}_thenUnwrap(t){return new lm(this.client,this.responsePromise,async(s,a)=>t(await this.parseResponse(s,a),a))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:s}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,s){return this.parse().then(t,s)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gN=Symbol("brand.privateNullableHeaders");function*PM(e){if(!e)return;if(gN in e){const{values:a,nulls:i}=e;yield*a.entries();for(const l of i)yield[l,null];return}let t=!1,s;e instanceof Headers?s=e.entries():vv(e)?s=e:(t=!0,s=Object.entries(e??{}));for(let a of s){const i=a[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const l=vv(a[1])?a[1]:[a[1]];let c=!1;for(const u of l)u!==void 0&&(t&&!c&&(c=!0,yield[i,null]),yield[i,u])}}const Go=e=>{const t=new Headers,s=new Set;for(const a of e){const i=new Set;for(const[l,c]of PM(a)){const u=l.toLowerCase();i.has(u)||(t.delete(l),i.add(u)),c===null?(t.delete(l),s.add(u)):(t.append(l,c),s.delete(u))}}return{[gN]:!0,values:t,nulls:s}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zh=e=>{var t,s,a,i,l,c;if(typeof globalThis.process<"u")return(a=(s=(t=eI)===null||t===void 0?void 0:t[e])===null||s===void 0?void 0:s.trim())!==null&&a!==void 0?a:void 0;if(typeof globalThis.Deno<"u")return(c=(l=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||l===void 0?void 0:l.call(i,e))===null||c===void 0?void 0:c.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var yN;class bd{constructor(t){var s,a,i,l,c,u,f,{baseURL:h=Zh("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:m=(s=Zh("GEMINI_API_KEY"))!==null&&s!==void 0?s:null,apiVersion:x="v1beta"}=t,y=rd(t,["baseURL","apiKey","apiVersion"]);const b=Object.assign(Object.assign({apiKey:m,apiVersion:x},y),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=b.baseURL,this.timeout=(a=b.timeout)!==null&&a!==void 0?a:bd.DEFAULT_TIMEOUT,this.logger=(i=b.logger)!==null&&i!==void 0?i:console;const T="warn";this.logLevel=T,this.logLevel=(c=(l=Tv(b.logLevel,"ClientOptions.logLevel",this))!==null&&l!==void 0?l:Tv(Zh("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&c!==void 0?c:T,this.fetchOptions=b.fetchOptions,this.maxRetries=(u=b.maxRetries)!==null&&u!==void 0?u:2,this.fetch=(f=b.fetch)!==null&&f!==void 0?f:pM(),this.encoder=xM,this._options=b,this.apiKey=m,this.apiVersion=x,this.clientAdapter=b.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:s}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!s.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const s=Go([t.headers]);if(!(s.values.has("authorization")||s.values.has("x-goog-api-key"))){if(this.apiKey)return Go([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Go([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([s,a])=>typeof a<"u").map(([s,a])=>{if(typeof a=="string"||typeof a=="number"||typeof a=="boolean")return`${encodeURIComponent(s)}=${encodeURIComponent(a)}`;if(a===null)return`${encodeURIComponent(s)}=`;throw new Ns(`Cannot stringify type ${typeof a}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${bi}`}defaultIdempotencyKey(){return`stainless-node-retry-${tM()}`}makeStatusError(t,s,a,i){return Bn.generate(t,s,a,i)}buildURL(t,s,a){const i=!this.baseURLOverridden()&&a||this.baseURL,l=sM(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),c=this.defaultQuery();return iM(c)||(s=Object.assign(Object.assign({},c),s)),typeof s=="object"&&s&&!Array.isArray(s)&&(l.search=this.stringifyQuery(s)),l.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const s=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${s}`}}async prepareRequest(t,{url:s,options:a}){}get(t,s){return this.methodRequest("get",t,s)}post(t,s){return this.methodRequest("post",t,s)}patch(t,s){return this.methodRequest("patch",t,s)}put(t,s){return this.methodRequest("put",t,s)}delete(t,s){return this.methodRequest("delete",t,s)}methodRequest(t,s,a){return this.request(Promise.resolve(a).then(i=>Object.assign({method:t,path:s},i)))}request(t,s=null){return new lm(this,this.makeRequest(t,s,void 0))}async makeRequest(t,s,a){var i,l,c;const u=await t,f=(i=u.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s==null&&(s=f),await this.prepareOptions(u);const{req:h,url:m,timeout:x}=await this.buildRequest(u,{retryCount:f-s});await this.prepareRequest(h,{url:m,options:u});const y="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),b=a===void 0?"":`, retryOf: ${a}`,T=Date.now();if(Fn(this).debug(`[${y}] sending request`,jr({retryOfRequestLogID:a,method:u.method,url:m,options:u,headers:h.headers})),!((l=u.signal)===null||l===void 0)&&l.aborted)throw new Mf;const _=new AbortController,j=await this.fetchWithTimeout(m,h,x,_).catch(Rf),E=Date.now();if(j instanceof globalThis.Error){const C=`retrying, ${s} attempts remaining`;if(!((c=u.signal)===null||c===void 0)&&c.aborted)throw new Mf;const A=Df(j)||/timed? ?out/i.test(String(j)+("cause"in j?String(j.cause):""));if(s)return Fn(this).info(`[${y}] connection ${A?"timed out":"failed"} - ${C}`),Fn(this).debug(`[${y}] connection ${A?"timed out":"failed"} (${C})`,jr({retryOfRequestLogID:a,url:m,durationMs:E-T,message:j.message})),this.retryRequest(u,s,a??y);throw Fn(this).info(`[${y}] connection ${A?"timed out":"failed"} - error; no more retries left`),Fn(this).debug(`[${y}] connection ${A?"timed out":"failed"} (error; no more retries left)`,jr({retryOfRequestLogID:a,url:m,durationMs:E-T,message:j.message})),A?new Zb:new xd({cause:j})}const k=`[${y}${b}] ${h.method} ${m} ${j.ok?"succeeded":"failed"} with status ${j.status} in ${E-T}ms`;if(!j.ok){const C=await this.shouldRetry(j);if(s&&C){const U=`retrying, ${s} attempts remaining`;return await yM(j.body),Fn(this).info(`${k} - ${U}`),Fn(this).debug(`[${y}] response error (${U})`,jr({retryOfRequestLogID:a,url:j.url,status:j.status,headers:j.headers,durationMs:E-T})),this.retryRequest(u,s,a??y,j.headers)}const A=C?"error; no more retries left":"error; not retryable";Fn(this).info(`${k} - ${A}`);const M=await j.text().catch(U=>Rf(U).message),I=cM(M),P=I?void 0:M;throw Fn(this).debug(`[${y}] response error (${A})`,jr({retryOfRequestLogID:a,url:j.url,status:j.status,headers:j.headers,message:P,durationMs:Date.now()-T})),this.makeStatusError(j.status,I,P,j.headers)}return Fn(this).info(k),Fn(this).debug(`[${y}] response start`,jr({retryOfRequestLogID:a,url:j.url,status:j.status,headers:j.headers,durationMs:E-T})),{response:j,options:u,controller:_,requestLogID:y,retryOfRequestLogID:a,startTime:T}}async fetchWithTimeout(t,s,a,i){const l=s||{},{signal:c,method:u}=l,f=rd(l,["signal","method"]),h=this._makeAbort(i);c&&c.addEventListener("abort",h,{once:!0});const m=setTimeout(h,a),x=globalThis.ReadableStream&&f.body instanceof globalThis.ReadableStream||typeof f.body=="object"&&f.body!==null&&Symbol.asyncIterator in f.body,y=Object.assign(Object.assign(Object.assign({signal:i.signal},x?{duplex:"half"}:{}),{method:"GET"}),f);u&&(y.method=u.toUpperCase());try{return await this.fetch.call(void 0,t,y)}finally{clearTimeout(m)}}async shouldRetry(t){const s=t.headers.get("x-should-retry");return s==="true"?!0:s==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,s,a,i){var l;let c;const u=i==null?void 0:i.get("retry-after-ms");if(u){const h=parseFloat(u);Number.isNaN(h)||(c=h)}const f=i==null?void 0:i.get("retry-after");if(f&&!c){const h=parseFloat(f);Number.isNaN(h)?c=Date.parse(f)-Date.now():c=h*1e3}if(!(c&&0<=c&&c<60*1e3)){const h=(l=t.maxRetries)!==null&&l!==void 0?l:this.maxRetries;c=this.calculateDefaultRetryTimeoutMillis(s,h)}return await dM(c),this.makeRequest(t,s-1,a)}calculateDefaultRetryTimeoutMillis(t,s){const l=s-t,c=Math.min(.5*Math.pow(2,l),8),u=1-Math.random()*.25;return c*u*1e3}async buildRequest(t,{retryCount:s=0}={}){var a,i,l;const c=Object.assign({},t),{method:u,path:f,query:h,defaultBaseURL:m}=c,x=this.buildURL(f,h,m);"timeout"in c&&lM("timeout",c.timeout),c.timeout=(a=c.timeout)!==null&&a!==void 0?a:this.timeout;const{bodyHeaders:y,body:b}=this.buildBody({options:c}),T=await this.buildHeaders({options:t,method:u,bodyHeaders:y,retryCount:s});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:u,headers:T},c.signal&&{signal:c.signal}),globalThis.ReadableStream&&b instanceof globalThis.ReadableStream&&{duplex:"half"}),b&&{body:b}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(l=c.fetchOptions)!==null&&l!==void 0?l:{}),url:x,timeout:c.timeout}}async buildHeaders({options:t,method:s,bodyHeaders:a,retryCount:i}){let l={};this.idempotencyHeader&&s!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),l[this.idempotencyHeader]=t.idempotencyKey);const c=await this.authHeaders(t);let u=Go([l,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),mM()),this._options.defaultHeaders,a,t.headers,c]);return this.validateHeaders(u),u.values}_makeAbort(t){return()=>t.abort()}buildBody({options:{body:t,headers:s}}){if(!t)return{bodyHeaders:void 0,body:void 0};const a=Go([s]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&a.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:gM(t)}:typeof t=="object"&&a.values.get("content-type")==="application/x-www-form-urlencoded"?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(t)}:this.encoder({body:t,headers:a})}}bd.DEFAULT_TIMEOUT=6e4;class wn extends bd{constructor(){super(...arguments),this.interactions=new pN(this)}}yN=wn;wn.GeminiNextGenAPIClient=yN;wn.GeminiNextGenAPIClientError=Ns;wn.APIError=Bn;wn.APIConnectionError=xd;wn.APIConnectionTimeoutError=Zb;wn.APIUserAbortError=Mf;wn.NotFoundError=sN;wn.ConflictError=aN;wn.RateLimitError=iN;wn.BadRequestError=eN;wn.AuthenticationError=tN;wn.InternalServerError=oN;wn.PermissionDeniedError=nN;wn.UnprocessableEntityError=rN;wn.toFile=wM;wn.Interactions=pN;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OM(e,t){const s={},a=g(e,["name"]);return a!=null&&v(s,["_url","name"],a),s}function LM(e,t){const s={},a=g(e,["name"]);return a!=null&&v(s,["_url","name"],a),s}function UM(e,t){const s={},a=g(e,["sdkHttpResponse"]);return a!=null&&v(s,["sdkHttpResponse"],a),s}function FM(e,t){const s={},a=g(e,["sdkHttpResponse"]);return a!=null&&v(s,["sdkHttpResponse"],a),s}function BM(e,t,s){const a={};if(g(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=g(e,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&v(t,["displayName"],i),g(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=g(e,["epochCount"]);t!==void 0&&l!=null&&v(t,["tuningTask","hyperparameters","epochCount"],l);const c=g(e,["learningRateMultiplier"]);if(c!=null&&v(a,["tuningTask","hyperparameters","learningRateMultiplier"],c),g(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(g(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(g(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(g(e,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(g(e,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const u=g(e,["batchSize"]);t!==void 0&&u!=null&&v(t,["tuningTask","hyperparameters","batchSize"],u);const f=g(e,["learningRate"]);if(t!==void 0&&f!=null&&v(t,["tuningTask","hyperparameters","learningRate"],f),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(g(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(g(e,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(g(e,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(g(e,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(g(e,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");if(g(e,["encryptionSpec"])!==void 0)throw new Error("encryptionSpec parameter is not supported in Gemini API.");return a}function GM(e,t,s){const a={};let i=g(s,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const I=g(e,["validationDataset"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec"],ef(I))}else if(i==="PREFERENCE_TUNING"){const I=g(e,["validationDataset"]);t!==void 0&&I!=null&&v(t,["preferenceOptimizationSpec"],ef(I))}else if(i==="DISTILLATION"){const I=g(e,["validationDataset"]);t!==void 0&&I!=null&&v(t,["distillationSpec"],ef(I))}const l=g(e,["tunedModelDisplayName"]);t!==void 0&&l!=null&&v(t,["tunedModelDisplayName"],l);const c=g(e,["description"]);t!==void 0&&c!=null&&v(t,["description"],c);let u=g(s,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const I=g(e,["epochCount"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","hyperParameters","epochCount"],I)}else if(u==="PREFERENCE_TUNING"){const I=g(e,["epochCount"]);t!==void 0&&I!=null&&v(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],I)}else if(u==="DISTILLATION"){const I=g(e,["epochCount"]);t!==void 0&&I!=null&&v(t,["distillationSpec","hyperParameters","epochCount"],I)}let f=g(s,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const I=g(e,["learningRateMultiplier"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],I)}else if(f==="PREFERENCE_TUNING"){const I=g(e,["learningRateMultiplier"]);t!==void 0&&I!=null&&v(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],I)}else if(f==="DISTILLATION"){const I=g(e,["learningRateMultiplier"]);t!==void 0&&I!=null&&v(t,["distillationSpec","hyperParameters","learningRateMultiplier"],I)}let h=g(s,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const I=g(e,["exportLastCheckpointOnly"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","exportLastCheckpointOnly"],I)}else if(h==="PREFERENCE_TUNING"){const I=g(e,["exportLastCheckpointOnly"]);t!==void 0&&I!=null&&v(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],I)}else if(h==="DISTILLATION"){const I=g(e,["exportLastCheckpointOnly"]);t!==void 0&&I!=null&&v(t,["distillationSpec","exportLastCheckpointOnly"],I)}let m=g(s,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const I=g(e,["adapterSize"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","hyperParameters","adapterSize"],I)}else if(m==="PREFERENCE_TUNING"){const I=g(e,["adapterSize"]);t!==void 0&&I!=null&&v(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],I)}else if(m==="DISTILLATION"){const I=g(e,["adapterSize"]);t!==void 0&&I!=null&&v(t,["distillationSpec","hyperParameters","adapterSize"],I)}let x=g(s,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const I=g(e,["tuningMode"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","tuningMode"],I)}const y=g(e,["customBaseModel"]);t!==void 0&&y!=null&&v(t,["customBaseModel"],y);let b=g(s,["config","method"]);if(b===void 0&&(b="SUPERVISED_FINE_TUNING"),b==="SUPERVISED_FINE_TUNING"){const I=g(e,["batchSize"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","hyperParameters","batchSize"],I)}let T=g(s,["config","method"]);if(T===void 0&&(T="SUPERVISED_FINE_TUNING"),T==="SUPERVISED_FINE_TUNING"){const I=g(e,["learningRate"]);t!==void 0&&I!=null&&v(t,["supervisedTuningSpec","hyperParameters","learningRate"],I)}const _=g(e,["labels"]);t!==void 0&&_!=null&&v(t,["labels"],_);const j=g(e,["beta"]);t!==void 0&&j!=null&&v(t,["preferenceOptimizationSpec","hyperParameters","beta"],j);const E=g(e,["baseTeacherModel"]);t!==void 0&&E!=null&&v(t,["distillationSpec","baseTeacherModel"],E);const k=g(e,["tunedTeacherModelSource"]);t!==void 0&&k!=null&&v(t,["distillationSpec","tunedTeacherModelSource"],k);const C=g(e,["sftLossWeightMultiplier"]);t!==void 0&&C!=null&&v(t,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],C);const A=g(e,["outputUri"]);t!==void 0&&A!=null&&v(t,["outputUri"],A);const M=g(e,["encryptionSpec"]);return t!==void 0&&M!=null&&v(t,["encryptionSpec"],M),a}function zM(e,t){const s={},a=g(e,["baseModel"]);a!=null&&v(s,["baseModel"],a);const i=g(e,["preTunedModel"]);i!=null&&v(s,["preTunedModel"],i);const l=g(e,["trainingDataset"]);l!=null&&ZM(l);const c=g(e,["config"]);return c!=null&&BM(c,s),s}function $M(e,t){const s={},a=g(e,["baseModel"]);a!=null&&v(s,["baseModel"],a);const i=g(e,["preTunedModel"]);i!=null&&v(s,["preTunedModel"],i);const l=g(e,["trainingDataset"]);l!=null&&e2(l,s,t);const c=g(e,["config"]);return c!=null&&GM(c,s,t),s}function HM(e,t){const s={},a=g(e,["name"]);return a!=null&&v(s,["_url","name"],a),s}function qM(e,t){const s={},a=g(e,["name"]);return a!=null&&v(s,["_url","name"],a),s}function VM(e,t,s){const a={},i=g(e,["pageSize"]);t!==void 0&&i!=null&&v(t,["_query","pageSize"],i);const l=g(e,["pageToken"]);t!==void 0&&l!=null&&v(t,["_query","pageToken"],l);const c=g(e,["filter"]);return t!==void 0&&c!=null&&v(t,["_query","filter"],c),a}function KM(e,t,s){const a={},i=g(e,["pageSize"]);t!==void 0&&i!=null&&v(t,["_query","pageSize"],i);const l=g(e,["pageToken"]);t!==void 0&&l!=null&&v(t,["_query","pageToken"],l);const c=g(e,["filter"]);return t!==void 0&&c!=null&&v(t,["_query","filter"],c),a}function WM(e,t){const s={},a=g(e,["config"]);return a!=null&&VM(a,s),s}function JM(e,t){const s={},a=g(e,["config"]);return a!=null&&KM(a,s),s}function YM(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["nextPageToken"]);i!=null&&v(s,["nextPageToken"],i);const l=g(e,["tunedModels"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(u=>xN(u))),v(s,["tuningJobs"],c)}return s}function XM(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["nextPageToken"]);i!=null&&v(s,["nextPageToken"],i);const l=g(e,["tuningJobs"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(u=>Lf(u))),v(s,["tuningJobs"],c)}return s}function QM(e,t){const s={},a=g(e,["name"]);a!=null&&v(s,["model"],a);const i=g(e,["name"]);return i!=null&&v(s,["endpoint"],i),s}function ZM(e,t){const s={};if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const a=g(e,["examples"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(l=>l)),v(s,["examples","examples"],i)}return s}function e2(e,t,s){const a={};let i=g(s,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const c=g(e,["gcsUri"]);t!==void 0&&c!=null&&v(t,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(i==="PREFERENCE_TUNING"){const c=g(e,["gcsUri"]);t!==void 0&&c!=null&&v(t,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(i==="DISTILLATION"){const c=g(e,["gcsUri"]);t!==void 0&&c!=null&&v(t,["distillationSpec","promptDatasetUri"],c)}let l=g(s,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const c=g(e,["vertexDatasetResource"]);t!==void 0&&c!=null&&v(t,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(l==="PREFERENCE_TUNING"){const c=g(e,["vertexDatasetResource"]);t!==void 0&&c!=null&&v(t,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(l==="DISTILLATION"){const c=g(e,["vertexDatasetResource"]);t!==void 0&&c!=null&&v(t,["distillationSpec","promptDatasetUri"],c)}if(g(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return a}function xN(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["name"]);i!=null&&v(s,["name"],i);const l=g(e,["state"]);l!=null&&v(s,["state"],Mb(l));const c=g(e,["createTime"]);c!=null&&v(s,["createTime"],c);const u=g(e,["tuningTask","startTime"]);u!=null&&v(s,["startTime"],u);const f=g(e,["tuningTask","completeTime"]);f!=null&&v(s,["endTime"],f);const h=g(e,["updateTime"]);h!=null&&v(s,["updateTime"],h);const m=g(e,["description"]);m!=null&&v(s,["description"],m);const x=g(e,["baseModel"]);x!=null&&v(s,["baseModel"],x);const y=g(e,["_self"]);return y!=null&&v(s,["tunedModel"],QM(y)),s}function Lf(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["name"]);i!=null&&v(s,["name"],i);const l=g(e,["state"]);l!=null&&v(s,["state"],Mb(l));const c=g(e,["createTime"]);c!=null&&v(s,["createTime"],c);const u=g(e,["startTime"]);u!=null&&v(s,["startTime"],u);const f=g(e,["endTime"]);f!=null&&v(s,["endTime"],f);const h=g(e,["updateTime"]);h!=null&&v(s,["updateTime"],h);const m=g(e,["error"]);m!=null&&v(s,["error"],m);const x=g(e,["description"]);x!=null&&v(s,["description"],x);const y=g(e,["baseModel"]);y!=null&&v(s,["baseModel"],y);const b=g(e,["tunedModel"]);b!=null&&v(s,["tunedModel"],b);const T=g(e,["preTunedModel"]);T!=null&&v(s,["preTunedModel"],T);const _=g(e,["supervisedTuningSpec"]);_!=null&&v(s,["supervisedTuningSpec"],_);const j=g(e,["preferenceOptimizationSpec"]);j!=null&&v(s,["preferenceOptimizationSpec"],j);const E=g(e,["distillationSpec"]);E!=null&&v(s,["distillationSpec"],E);const k=g(e,["tuningDataStats"]);k!=null&&v(s,["tuningDataStats"],k);const C=g(e,["encryptionSpec"]);C!=null&&v(s,["encryptionSpec"],C);const A=g(e,["partnerModelTuningSpec"]);A!=null&&v(s,["partnerModelTuningSpec"],A);const M=g(e,["customBaseModel"]);M!=null&&v(s,["customBaseModel"],M);const I=g(e,["experiment"]);I!=null&&v(s,["experiment"],I);const P=g(e,["labels"]);P!=null&&v(s,["labels"],P);const D=g(e,["outputUri"]);D!=null&&v(s,["outputUri"],D);const U=g(e,["pipelineJob"]);U!=null&&v(s,["pipelineJob"],U);const O=g(e,["serviceAccount"]);O!=null&&v(s,["serviceAccount"],O);const F=g(e,["tunedModelDisplayName"]);F!=null&&v(s,["tunedModelDisplayName"],F);const q=g(e,["veoTuningSpec"]);return q!=null&&v(s,["veoTuningSpec"],q),s}function t2(e,t){const s={},a=g(e,["sdkHttpResponse"]);a!=null&&v(s,["sdkHttpResponse"],a);const i=g(e,["name"]);i!=null&&v(s,["name"],i);const l=g(e,["metadata"]);l!=null&&v(s,["metadata"],l);const c=g(e,["done"]);c!=null&&v(s,["done"],c);const u=g(e,["error"]);return u!=null&&v(s,["error"],u),s}function ef(e,t){const s={},a=g(e,["gcsUri"]);a!=null&&v(s,["validationDatasetUri"],a);const i=g(e,["vertexDatasetResource"]);return i!=null&&v(s,["validationDatasetUri"],i),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class n2 extends va{constructor(t){super(),this.apiClient=t,this.list=async(s={})=>new Ar(ya.PAGED_ITEM_TUNING_JOBS,a=>this.listInternal(a),await this.listInternal(s),s),this.get=async s=>await this.getInternal(s),this.tune=async s=>{var a;if(this.apiClient.isVertexAI())if(s.baseModel.startsWith("projects/")){const i={tunedModelName:s.baseModel};!((a=s.config)===null||a===void 0)&&a.preTunedModelCheckpointId&&(i.checkpointId=s.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},s),{preTunedModel:i});return l.baseModel=void 0,await this.tuneInternal(l)}else{const i=Object.assign({},s);return await this.tuneInternal(i)}else{const i=Object.assign({},s),l=await this.tuneMldevInternal(i);let c="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?c=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(c=l.name.split("/operations/")[0]),{name:c,state:Tf.JOB_STATE_QUEUED}}}}async getInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=qM(t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>Lf(m))}else{const h=HM(t);return u=qe("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>xN(m))}}async listInternal(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=JM(t);return u=qe("tuningJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=XM(m),y=new Q0;return Object.assign(y,x),y})}else{const h=WM(t);return u=qe("tunedModels",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=YM(m),y=new Q0;return Object.assign(y,x),y})}}async cancel(t){var s,a,i,l;let c,u="",f={};if(this.apiClient.isVertexAI()){const h=LM(t);return u=qe("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=FM(m),y=new Z0;return Object.assign(y,x),y})}else{const h=OM(t);return u=qe("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const y=x;return y.sdkHttpResponse={headers:m.headers},y})),c.then(m=>{const x=UM(m),y=new Z0;return Object.assign(y,x),y})}}async tuneInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI()){const u=$M(t,t);return l=qe("tuningJobs",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>Lf(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var s,a;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=zM(t);return l=qe("tunedModels",u._url),c=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>t2(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class s2{async download(t,s){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const a2=1024*1024*8,r2=3,i2=1e3,o2=2,od="x-goog-upload-status";async function l2(e,t,s){var a;const i=await vN(e,t,s),l=await(i==null?void 0:i.json());if(((a=i==null?void 0:i.headers)===null||a===void 0?void 0:a[od])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return l.file}async function c2(e,t,s){var a;const i=await vN(e,t,s),l=await(i==null?void 0:i.json());if(((a=i==null?void 0:i.headers)===null||a===void 0?void 0:a[od])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=Cb(l),u=new tm;return Object.assign(u,c),u}async function vN(e,t,s){var a,i;let l=0,c=0,u=new _f(new Response),f="upload";for(l=e.size;c<l;){const h=Math.min(a2,l-c),m=e.slice(c,c+h);c+h>=l&&(f+=", finalize");let x=0,y=i2;for(;x<r2&&(u=await s.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((a=u==null?void 0:u.headers)===null||a===void 0)&&a[od]));)x++,await u2(y),y=y*o2;if(c+=h,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[od])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function d2(e){return{size:e.size,type:e.type}}function u2(e){return new Promise(t=>setTimeout(t,e))}class h2{async upload(t,s,a){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await l2(t,s,a)}async uploadToFileSearchStore(t,s,a){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await c2(t,s,a)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await d2(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class f2{create(t,s,a){return new m2(t,s,a)}}class m2{constructor(t,s,a){this.url=t,this.headers=s,this.callbacks=a}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _v="x-goog-api-key";class p2{constructor(t){this.apiKey=t}async addAuthHeaders(t,s){if(t.get(_v)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(_v,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const g2="gl-node/";class y2{get interactions(){var t;if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const s=this.httpOptions;s!=null&&s.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const a=new wn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:s==null?void 0:s.timeout,maxRetries:(t=s==null?void 0:s.retryOptions)===null||t===void 0?void 0:t.attempts});return this._interactions=a.interactions,this._interactions}constructor(t){var s;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(s=t.vertexai)!==null&&s!==void 0?s:!1,this.apiKey=t.apiKey;const a=aI(t.httpOptions,t.vertexai,void 0,void 0);a&&(t.httpOptions?t.httpOptions.baseUrl=a:t.httpOptions={baseUrl:a}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const i=new p2(this.apiKey);this.apiClient=new d1({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:g2+"web",uploader:new h2,downloader:new s2}),this.models=new I1(this.apiClient),this.live=new w1(this.apiClient,i,new f2),this.batches=new PA(this.apiClient),this.chats=new gk(this.models,this.apiClient),this.caches=new fk(this.apiClient),this.files=new Ck(this.apiClient),this.operations=new A1(this.apiClient),this.authTokens=new V1(this.apiClient),this.tunings=new n2(this.apiClient),this.fileSearchStores=new eM(this.apiClient)}}var x2={};const cl=typeof process<"u"&&x2?"your-gemini-api-key-here":"",Nd=new y2({apiKey:cl});async function ls(e){if(!cl)return console.warn("Gemini API Key is missing. Narrative generation skipped."),"API Key missing. Cannot generate narrative.";try{return(await Nd.models.generateContent({model:"gemini-3-flash-preview",contents:e})).text||""}catch(t){return console.error("Gemini API Error:",t),"Error generating content."}}const v2=async(e,t)=>{const s=`
        You are a supportive agricultural advisor for a seaweed farm. Write a monthly performance review for a specific farmer.
        Write in English. Tone: Professional, encouraging, and constructive.

        Farmer: ${e.farmerName} (Site: ${e.siteName})
        Period: ${e.period}

        Data:
        - Planted: ${e.production.plantedLines} lines
        - Harvested: ${e.production.harvestedLines} lines
        - Total Weight: ${e.production.harvestedWeight.toFixed(2)} kg
        - Average Growth Rate: ${e.efficiency.avgGrowthRate.toFixed(2)} %/day
        - Currently Active Cycles: ${e.efficiency.activeCycles}
        - Incidents Reported: ${e.incidentsCount}

        Instructions:
        1. Start with a summary of their production.
        2. Evaluate their efficiency based on growth rate (Standard is ~3-4%).
        3. Mention their engagement based on planted lines.
        4. Address any incidents.
        5. Conclude with advice.
        Format with "###" headings.
    `,a=`
        Vous tes un conseiller agricole bienveillant pour une ferme d'algues. Rdigez un bilan de performance mensuel pour un fermier spcifique.
        Rdigez en franais. Ton : Professionnel, encourageant et constructif.

        Fermier : ${e.farmerName} (Site : ${e.siteName})
        Priode : ${e.period}

        Donnes :
        - Plant : ${e.production.plantedLines} lignes
        - Rcolt : ${e.production.harvestedLines} lignes
        - Poids Total : ${e.production.harvestedWeight.toFixed(2)} kg
        - Taux de Croissance Moyen : ${e.efficiency.avgGrowthRate.toFixed(2)} %/jour
        - Cycles Actuellement Actifs : ${e.efficiency.activeCycles}
        - Incidents Signals : ${e.incidentsCount}

        Instructions :
        1. Commencez par un rsum de leur production.
        2. valuez leur efficacit (Standard ~3-4%).
        3. Mentionnez leur engagement.
        4. Abordez les incidents s'il y en a.
        5. Concluez par un conseil.
        Utilisez "###" pour les titres de section.
    `;return ls(t==="fr"?a:s)},b2=async(e,t)=>{const s=`
        As an aquaculture expert, suggest a drying strategy.
        Language: ${t==="fr"?"French":"English"}
        
        Seaweed Type: ${e.seaweedType}
        Wet Weight: ${e.totalWeight} kg
        Harvest Notes: ${e.notes}
        
        Suggest estimated drying time, target moisture content, and specific precautions.
    `;return ls(s)},N2=async(e,t,s,a,i)=>{if(!cl)return console.warn("Gemini API Key is missing. Incident description analysis skipped."),{};const l=`
        Analyze this incident description from a seaweed farm: "${e}"
        
        Available Incident Types: ${s.map(c=>c.id).join(", ")}
        Available Severities: ${a.map(c=>c.id).join(", ")}
        Available Module Codes: ${t.join(", ")}
        
        Return a JSON object with:
        - suggestedType (string, one of available types)
        - suggestedSeverity (string, one of available severities)
        - suggestedModuleCodes (array of strings, matches found in description)
    `;try{const c=await Nd.models.generateContent({model:"gemini-3-flash-preview",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:fn.OBJECT,properties:{suggestedType:{type:fn.STRING},suggestedSeverity:{type:fn.STRING},suggestedModuleCodes:{type:fn.ARRAY,items:{type:fn.STRING}}}}}});return JSON.parse(c.text||"{}")}catch(c){return console.error("Gemini JSON analysis failed",c),{}}},S2=async(e,t)=>{var a;if(!cl)return console.warn("Gemini API Key is missing. Image analysis skipped."),{description:"API Key missing. Cannot analyze image.",severity:"LOW",type:"OTHER",treatments:""};const s=`
        Analyze this image of seaweed. It might show signs of disease (like Ice-Ice, EFA), pests (grazing), or be healthy.
        
        Identify the most likely issue.
        Output ONLY a JSON object with:
        - type: (one of: "PEST_DISEASE", "ENVIRONMENTAL", "OTHER")
        - severity: (one of: "LOW", "MEDIUM", "HIGH", "CRITICAL")
        - description: A short description of the visual symptoms observed in ${t==="fr"?"French":"English"}.
        - treatments: A concise list of immediate actions or treatments recommended for this specific issue in ${t==="fr"?"French":"English"}.
    `;try{const i=e.split(",")[1]||e;let c=((a=(await Nd.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:i}},{text:s}]}})).text)==null?void 0:a.trim())||"{}";return c.startsWith("```json")?c=c.substring(7,c.length-3).trim():c.startsWith("```")&&(c=c.substring(3,c.length-3).trim()),JSON.parse(c)}catch(i){return console.error("Gemini Image analysis failed",i),{description:"Analysis failed",severity:"LOW",type:"OTHER",treatments:""}}},w2=async(e,t,s,a,i,l)=>{if(!cl)return console.warn("Gemini API Key is missing. Prediction skipped."),null;const c=a.map(h=>({planted:h.plantingDate,harvested:h.harvestDate,yield:h.harvestedWeight})),u=i.map(h=>({temp:h.temperature,salinity:h.salinity,date:h.date})),f=`
        Predict harvest date and yield for a seaweed cycle.
        Language: ${l==="fr"?"French":"English"}
        
        Current Cycle: Planted ${e.plantingDate}, Type ${s.name}, Initial Weight ${e.initialWeight}kg.
        Historical Data: ${JSON.stringify(c.slice(0,10))}
        Recent Weather: ${JSON.stringify(u.slice(0,5))}
        
        Return JSON with:
        - predictedHarvestDateStart (YYYY-MM-DD)
        - predictedHarvestDateEnd (YYYY-MM-DD)
        - predictedYieldKgMin (number)
        - predictedYieldKgMax (number)
        - confidenceScore (0.0 to 1.0)
        - reasoning (string)
    `;try{const h=await Nd.models.generateContent({model:"gemini-3-pro-preview",contents:f,config:{responseMimeType:"application/json",responseSchema:{type:fn.OBJECT,properties:{predictedHarvestDateStart:{type:fn.STRING},predictedHarvestDateEnd:{type:fn.STRING},predictedYieldKgMin:{type:fn.NUMBER},predictedYieldKgMax:{type:fn.NUMBER},confidenceScore:{type:fn.NUMBER},reasoning:{type:fn.STRING}}}}});return JSON.parse(h.text||"{}")}catch(h){return console.error("Gemini harvest prediction failed",h),null}},T2=async(e,t)=>{const s=`
        Analyze monthly production report data.
        Language: ${t==="fr"?"French":"English"}
        Data: ${JSON.stringify(e).substring(0,2e3)}
        
        Highlight top performers, underperforming batches, and duration trends. Use "###" for headings.
    `;return ls(s)},j2=async(e,t,s)=>{const a=`
        Analyze credit report.
        Language: ${s==="fr"?"French":"English"}
        Summary: ${JSON.stringify(t)}
        
        Discuss credit usage trends and top borrowers. Use "###" for headings.
    `;return ls(a)},_2=async(e,t,s)=>{const a=`
        Analyze inventory report.
        Language: ${s==="fr"?"French":"English"}
        Summary: ${JSON.stringify(t)}
        
        Discuss stock composition and value distribution. Use "###" for headings.
    `;return ls(a)},E2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste de donnes agricoles. Analysez les donnes JSON fournies qui correspondent au tableau "Aperu Gnral de la Ferme".
        
        INSTRUCTIONS STRICTES :
        1. Ne donnez PAS de conseils gnraux sur l'agriculture.
        2. Ne parlez QUE des chiffres prsents dans les donnes. Assumez que tout champ manquant ou vide a une valeur de zro.
        3. Interprtez les colonnes suivantes : 
           - Comparez le "Total Lignes  l'eau" par rapport aux "Total Lignes Rcoltes".
           - Comparez la "Production (Kg)" entre les sites s'il y en a plusieurs.
           - Analysez le "Taux de croissance moyen" : est-il cohrent avec la production ?
           - Commentez la "Prvision de production" (m1, m2, m3) : la tendance est-elle  la hausse ou  la baisse ?
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais de manire concise et factuelle.
    `;return`${JSON.stringify(e)}`,ls(s)},C2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste RH. Analysez les donnes JSON fournies correspondant au tableau "Rpartition des Salaris par Site".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les effectifs "Permanents" vs "Journaliers".
        2. Identifiez quel site a la masse salariale ("Montant du mois") la plus leve.
        3. Calculez et mentionnez le cot moyen par employ si pertinent bas sur les totaux.
        4. Ne faites aucune supposition extrieure aux chiffres fournis. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},I2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste de stock. Analysez les donnes JSON fournies correspondant au tableau "Stocks sur Sites".
        
        INSTRUCTIONS STRICTES :
        1. Pour chaque site/type d'algue, comparez le "Stock Ouverture" au "Stock Fermeture". Le stock a-t-il augment ou diminu ?
        2. Analysez les volumes d'"Entres" (rcoltes) par rapport aux "Sorties" (transferts/ventes).
        3. Signalez tout site o le stock de fermeture semble anormalement lev par rapport aux sorties (accumulation).
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},A2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste logistique. Analysez les donnes JSON fournies correspondant au tableau "Stock Magasin de Presse".
        
        INSTRUCTIONS STRICTES :
        1. Distinguez clairement les "Algues en Vrac" (matire premire) des "Algues Presses" (produit fini).
        2. Commentez le taux de transformation : les sorties de Vrac correspondent-elles aux entres de Press (approximativement) ?
        3. Analysez le stock final de balles prtes  l'export.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},k2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste export. Analysez les donnes JSON fournies correspondant au tableau "Liste des Exportations Ralises".
        
        INSTRUCTIONS STRICTES :
        1. Rsumez le volume total (Kg) et la valeur totale exporte sur la priode.
        2. Comparez ces chiffres aux totaux de l'anne (si fournis).
        3. Mentionnez les principales destinations ou clients bass sur les colonnes "Destinataire" et "Facture N".
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},D2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste de production. Analysez les donnes JSON fournies correspondant  la matrice "Production Mensuelle par Site".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez le mois ayant la plus forte production (Kg) et celui avec la plus faible.
        2. Observez la tendance des "Taux de croissance (%)" au fil des mois : y a-t-il une saisonnalit visible ?
        3. Comparez la performance relative des diffrents sites sur les 3 derniers mois affichs.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},R2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste financier. Analysez les donnes JSON fournies correspondant au tableau "Situation des Crdits".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les colonnes du "Mois Prcdent" avec celles du "Mois En Cours" (Priode actuelle).
        2. Le "Solde Crdits" a-t-il augment ou diminu ?
        3. Analysez le ratio entre "Total Remboursements" et l'encours de crdit. Le recouvrement est-il efficace sur cette priode ?
        4. Ne citez que les chiffres du tableau. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},M2=async(e,t)=>{const s=`
        Agissez strictement en tant qu'analyste de performance. Analysez les donnes JSON fournies correspondant au tableau "Statistique Individuelle des Fermiers".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez les 3 fermiers ayant la plus grosse production (Kg) sur la priode la plus rcente (colonne la plus  droite).
        2. Reprez les fermiers ayant des lignes plantes ("P") mais aucune rcolte ("R") ou une production trs faible ("Kg"), signalant un problme potentiel.
        3. Commentez la tendance gnrale : la majorit des fermiers sont-ils en phase de plantation ou de rcolte ?
        4. Ne faites aucune supposition ou conseil. Basez-vous uniquement sur les chiffres. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(e)}
        Rpondez en franais.
    `;return`${JSON.stringify(e)}`,ls(s)},cm=({children:e,content:t,className:s})=>n.jsxs("div",{className:`relative group flex items-center ${s}`,children:[e,n.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs p-3 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-20",children:[t,n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-900 dark:border-t-black"})]})]}),bN=({isOpen:e,onClose:t,operationToEdit:s})=>{const{t:a}=we(),{sites:i,getFarmersBySite:l,modules:c,seaweedTypes:u,employees:f,serviceProviders:h,startCultivationFromCuttings:m,updateCuttingOperation:x,cultivationCycles:y}=He(),{settings:b}=Ke(),T=S.useCallback(()=>{var q,z,Y,J,G,B;if(s){const Q=y.find(ae=>ae.cuttingOperationId===s.id),W=c.find(ae=>{var $;return ae.id===(($=s.moduleCuts[0])==null?void 0:$.moduleId)});return{serviceProviderId:s.serviceProviderId,siteId:s.siteId,date:s.date,plantingDate:(Q==null?void 0:Q.plantingDate)||s.date,lines:String(((q=s.moduleCuts[0])==null?void 0:q.linesCut)||""),initialWeight:String((Q==null?void 0:Q.initialWeight)||""),seaweedTypeId:s.seaweedTypeId,pricePerLine:String(s.unitPrice),beneficiaryFarmerId:s.beneficiaryFarmerId||(W==null?void 0:W.farmerId)||"",zoneId:(W==null?void 0:W.zoneId)||"",moduleId:(W==null?void 0:W.id)||""}}const F=new Date().toISOString().split("T")[0];return{serviceProviderId:((z=h[0])==null?void 0:z.id)||"",siteId:((Y=i[0])==null?void 0:Y.id)||"",date:F,plantingDate:F,lines:"",initialWeight:"",seaweedTypeId:((J=u[0])==null?void 0:J.id)||"",pricePerLine:"",beneficiaryFarmerId:"",zoneId:((B=(G=i.find(Q=>{var W;return Q.id===(((W=i[0])==null?void 0:W.id)||"")}))==null?void 0:G.zones[0])==null?void 0:B.id)||"",moduleId:""}},[s,i,h,u,y,c]),[_,j]=S.useState(T()),[E,k]=S.useState({});S.useEffect(()=>{e&&j(T())},[e,T]);const C=S.useMemo(()=>{var F;return((F=i.find(q=>q.id===_.siteId))==null?void 0:F.zones)||[]},[i,_.siteId]),A=S.useMemo(()=>l(_.siteId),[l,_.siteId]),M=S.useMemo(()=>c.filter(F=>{var Y;if(F.siteId!==_.siteId||_.zoneId&&F.zoneId!==_.zoneId)return!1;const q=F.statusHistory||[],z=q.length>0?q[q.length-1].status:"FREE";return s&&F.id===((Y=s.moduleCuts[0])==null?void 0:Y.moduleId)?!0:z==="FREE"}),[c,_.siteId,_.zoneId,s]),I=S.useMemo(()=>{const F=parseFloat(_.lines),q=parseFloat(_.pricePerLine);return!isNaN(F)&&!isNaN(q)?F*q:0},[_.lines,_.pricePerLine]),P=F=>{const q=i.find(z=>z.id===F);j(z=>{var Y;return{...z,siteId:F,zoneId:((Y=q==null?void 0:q.zones[0])==null?void 0:Y.id)||"",beneficiaryFarmerId:"",moduleId:""}})},D=S.useCallback(()=>{const F={};return _.serviceProviderId||(F.serviceProviderId=a("validationRequired")),_.siteId||(F.siteId=a("validationRequired")),_.date||(F.date=a("validationRequired")),_.plantingDate||(F.plantingDate=a("validationRequired")),new Date(_.plantingDate)<new Date(_.date)&&(F.plantingDate=a("validationPlantingDateAfterOperation")),(!_.lines||parseFloat(_.lines)<=0)&&(F.lines=a("validationPositiveNumber")),(!_.initialWeight||parseFloat(_.initialWeight)<=0)&&(F.initialWeight=a("validationPositiveNumber")),_.seaweedTypeId||(F.seaweedTypeId=a("validationRequired")),(!_.pricePerLine||parseFloat(_.pricePerLine)<0)&&(F.pricePerLine=a("validationNonNegative")),_.beneficiaryFarmerId||(F.beneficiaryFarmerId=a("validationRequired")),_.zoneId||(F.zoneId=a("validationRequired")),_.moduleId||(F.moduleId=a("validationRequired")),F},[_,a]);S.useEffect(()=>{k(D())},[_,D]);const U=F=>{F.preventDefault();const q=D();if(Object.keys(q).length>0){k(q);return}const z=c.find(Y=>Y.id===_.moduleId);if(s){const Y={date:_.date,siteId:_.siteId,serviceProviderId:_.serviceProviderId,moduleCuts:[{moduleId:_.moduleId,linesCut:parseFloat(_.lines)}],unitPrice:parseFloat(_.pricePerLine),totalAmount:I,notes:a("notes_plantingOperationForModule").replace("{code}",(z==null?void 0:z.code)||""),seaweedTypeId:_.seaweedTypeId,beneficiaryFarmerId:_.beneficiaryFarmerId},J={...s,...Y},G={[_.moduleId]:parseFloat(_.initialWeight)};x(J,G,_.plantingDate)}else{const Y={date:_.date,siteId:_.siteId,serviceProviderId:_.serviceProviderId,moduleCuts:[{moduleId:_.moduleId,linesCut:parseFloat(_.lines)}],unitPrice:parseFloat(_.pricePerLine),totalAmount:I,isPaid:!1,notes:a("notes_plantingOperationForModule").replace("{code}",(z==null?void 0:z.code)||""),seaweedTypeId:_.seaweedTypeId},J={moduleId:_.moduleId,seaweedTypeId:_.seaweedTypeId,plantingDate:_.plantingDate,status:Ye.PLANTED,initialWeight:parseFloat(_.initialWeight),linesPlanted:parseFloat(_.lines)};m(Y,J,_.beneficiaryFarmerId)}t()},O=Object.keys(E).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:a(s?"editCuttingOperation":"newPlanting"),widthClass:"max-w-4xl",children:n.jsxs("form",{onSubmit:U,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs(ke,{label:a("serviceProvider"),value:_.serviceProviderId,onChange:F=>j(q=>({...q,serviceProviderId:F.target.value})),error:E.serviceProviderId,required:!0,children:[n.jsx("option",{value:"",children:a("selectProvider")}),h.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))]}),n.jsx(de,{label:a("dateOperation"),type:"date",value:_.date,onChange:F=>j(q=>({...q,date:F.target.value})),error:E.date,required:!0}),n.jsx(de,{label:a("pricePerLine"),type:"number",step:"any",value:_.pricePerLine,onChange:F=>j(q=>({...q,pricePerLine:F.target.value})),error:E.pricePerLine,required:!0})]}),n.jsxs("div",{className:"border-t pt-4 mt-4",children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:a("detailsModule")}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs(ke,{label:a("site"),value:_.siteId,onChange:F=>P(F.target.value),error:E.siteId,required:!0,children:[n.jsx("option",{value:"",children:a("selectSite")}),i.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))]}),n.jsxs(ke,{label:a("zonePlantation"),value:_.zoneId,onChange:F=>j(q=>({...q,zoneId:F.target.value})),disabled:!_.siteId,error:E.zoneId,required:!0,children:[n.jsx("option",{value:"",children:a("selectZone")}),C.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))]}),n.jsxs(ke,{label:a("numModule"),value:_.moduleId,onChange:F=>j(q=>({...q,moduleId:F.target.value})),disabled:!_.zoneId,error:E.moduleId,required:!0,children:[n.jsx("option",{value:"",children:a("selectAModule")}),M.map(F=>n.jsx("option",{value:F.id,children:F.code},F.id))]}),n.jsxs(ke,{label:a("seaweedType"),value:_.seaweedTypeId,onChange:F=>j(q=>({...q,seaweedTypeId:F.target.value})),error:E.seaweedTypeId,required:!0,children:[n.jsx("option",{value:"",children:a("selectType")}),u.map(F=>n.jsx("option",{value:F.id,children:F.name},F.id))]}),n.jsx(de,{label:a("nombreLignesCoupees"),type:"number",value:_.lines,onChange:F=>j(q=>({...q,lines:F.target.value})),error:E.lines,required:!0}),n.jsx(de,{label:a("poidsInitialLignes"),type:"number",step:"any",value:_.initialWeight,onChange:F=>j(q=>({...q,initialWeight:F.target.value})),error:E.initialWeight,required:!0}),n.jsxs(ke,{label:a("fermierBeneficiaire"),value:_.beneficiaryFarmerId,onChange:F=>j(q=>({...q,beneficiaryFarmerId:F.target.value})),disabled:!_.siteId,error:E.beneficiaryFarmerId,required:!0,children:[n.jsx("option",{value:"",children:a("selectFarmer")}),A.map(F=>n.jsx("option",{value:F.id,children:`${F.firstName} ${F.lastName}`},F.id))]}),n.jsx(de,{label:a("plantingDate"),type:"date",value:_.plantingDate,onChange:F=>j(q=>({...q,plantingDate:F.target.value})),error:E.plantingDate,required:!0})]})]}),n.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg text-right",children:[a("valeurBouturage"),": ",Ae(I,b.localization)]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{type:"submit",disabled:O,children:a("save")})]})]})})},Ev=e=>{if(!e||e==="rgba(0, 0, 0, 0)"||e==="transparent"||e==="inherit")return;const t=e.match(/\d+/g);if(!t||t.length<3)return;const[s,a,i]=t.map(Number),l=c=>c.toString(16).padStart(2,"0");return`FF${l(s)}${l(a)}${l(i)}`.toUpperCase()};function NN(e){if(!e)return"";const t=e.trim();if(!t)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;if(/^-?\d+(\.\d+)?%$/.test(t))return parseFloat(t)/100;const s=t.replace(/^[^\d\-\.,]+/,"").replace(/[^\d]+$/,"").replace(/\s/g,"");if(!s)return t;let a;if(/^-?\d+(\.\d+)?$/.test(s))a=parseFloat(s);else if(/^-?\d+(,\d+)?$/.test(s))a=parseFloat(s.replace(",","."));else{const i=s.replace(/,/g,"");if(!isNaN(Number(i))&&i.includes("."))a=parseFloat(i);else{const l=s.replace(/\./g,"").replace(",",".");isNaN(Number(l))||(a=parseFloat(l))}}return a!==void 0&&!isNaN(a)?a:t}const Ci=e=>{var t;return((t=e.innerText)==null?void 0:t.trim())||""};function SN(e){var a;const t=[];if(e.classList.contains("no-print")||e.style.display==="none")return[];if(e.tagName==="HEADER")return[];if(e.tagName==="SCRIPT"||e.tagName==="STYLE"||e.tagName==="BUTTON")return[];if(e.tagName==="TABLE"||e.classList.contains("grid")||e.classList.contains("prose")||/^H[1-6]$/.test(e.tagName))return[e];const s=Array.from(e.children);if(s.length>0)for(const i of s)t.push(...SN(i));else{const i=(a=e.innerText)==null?void 0:a.trim();i&&(e.tagName==="P"||e.tagName==="DIV"||e.tagName==="SPAN")&&i.length>1&&t.push(e)}return t}function P2(e,t,s){const a=e.getCell(t,s);return a.isMerged&&a.master.address!==a.address}function O2(e,t,s){let a=s;return[t.querySelector("thead"),t.querySelector("tbody"),t.querySelector("tfoot")].forEach(l=>{if(!l)return;Array.from(l.querySelectorAll("tr")).forEach(u=>{let f=1;Array.from(u.querySelectorAll("th, td")).forEach(m=>{const x=m,y=Ci(x),b=parseInt(x.getAttribute("colspan")||"1"),T=parseInt(x.getAttribute("rowspan")||"1");for(;P2(e,a,f);)f++;const _=e.getCell(a,f);let j=y;const E=x.tagName==="TH"||l.tagName==="THEAD";E||(j=NN(y)),_.value=j;const k=window.getComputedStyle(x),C=Ev(k.backgroundColor),A=Ev(k.color),M=E||k.fontWeight==="700"||k.fontWeight==="bold",I=k.textAlign;if(E)_.font={bold:!0,color:{argb:"FFFFFFFF"}},_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},_.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},_.alignment={horizontal:"center",vertical:"middle",wrapText:!0};else{_.font={color:{argb:A||"FF000000"},bold:M},C&&C!=="FFFFFFFF"&&(_.fill={type:"pattern",pattern:"solid",fgColor:{argb:C}}),_.border={top:{style:"thin",color:{argb:"FFD9D9D9"}},left:{style:"thin",color:{argb:"FFD9D9D9"}},bottom:{style:"thin",color:{argb:"FFD9D9D9"}},right:{style:"thin",color:{argb:"FFD9D9D9"}}};let P=I==="center"?"center":I==="right"?"right":"left";typeof j=="number"&&I!=="center"&&(P="right"),_.alignment={horizontal:P,vertical:"middle",wrapText:!0}}if(b>1||T>1)try{e.mergeCells(a,f,a+T-1,f+b-1)}catch(P){console.warn("Merge conflict in Excel export",P)}f+=b}),a++})}),a}function L2(e,t,s){const a=Array.from(t.children);let i=s;if(a.length>0&&a.length<=4){let l=1;return a.forEach(c=>{const u=Ci(c).split(`
`).filter(m=>m.trim()),f=e.getCell(i,l);f.value=u[0],f.font={color:{argb:"FF7F7F7F"},italic:!0};const h=e.getCell(i+1,l);h.value=NN(u[1]||""),h.font={bold:!0,size:12},h.alignment={horizontal:"left"},l+=3}),i+3}return a.forEach(l=>{const c=Ci(l),u=e.getCell(i,1);u.value=c,u.alignment={wrapText:!0},i++}),i}function U2(e,t,s){const a=Ci(t);if(!a)return s;const i=e.getCell(s,1);return i.value=a,t.tagName==="H3"||t.tagName==="H4"||t.classList.contains("font-bold")?i.font={bold:!0,size:11,color:{argb:"FF4472C4"}}:i.alignment={wrapText:!0},e.mergeCells(s,1,s,12),s+1}const F2=async(e,t)=>{const s=document.getElementById("printable-area");if(!s){console.error("No printable area found");return}const a=new ExcelJS.Workbook;a.creator="AlgaManage",a.created=new Date;const i=s.querySelectorAll(".report-page-landscape, .print-page");if(i.length===0){alert("No report content found to export.");return}for(let h=0;h<i.length;h++){const m=i[h];let x=`Page ${h+1}`;const y=m.querySelector("h2")||m.querySelector("h3");if(y){const M=Ci(y).replace(/[\\/?*:[\]]/g," ").substring(0,30);M&&(x=M)}let b=x,T=1;for(;a.getWorksheet(b);)b=`${x} (${T++})`;const _=a.addWorksheet(b,{views:[{showGridLines:!1,zoomScale:85}],pageSetup:{orientation:"landscape",paperSize:9,fitToPage:!0}});_.columns=Array.from({length:50},()=>({width:14})),_.getColumn(1).width=20;let j=1;const E=m.querySelector("header");E&&(Ci(E).split(`
`).filter(I=>I.trim()).forEach(I=>{const D=_.getRow(j).getCell(1);D.value=I,D.font={bold:!0,size:12,color:{argb:"FF2F5597"}},_.mergeCells(j,1,j,12),j++}),j++);const C=m.firstElementChild||m,A=SN(C);for(const M of A)M.tagName==="TABLE"?(j=O2(_,M,j),j+=2):M.classList.contains("grid")?(j=L2(_,M,j),j+=2):j=U2(_,M,j)}const l=await a.xlsx.writeBuffer(),c=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=window.URL.createObjectURL(c),f=document.createElement("a");f.href=u,f.download=`${t}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(u)},Pi=async(e,t,s,a="Sheet1")=>{const i=new ExcelJS.Workbook;i.creator="AlgaManage",i.created=new Date;const l=i.addWorksheet(a);l.columns=t.map(x=>({header:x.header,key:x.key,width:x.width||15}));const c=l.getRow(1);c.font={bold:!0,color:{argb:"FFFFFFFF"}},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},e.forEach(x=>{l.addRow(x)});const u=await i.xlsx.writeBuffer(),f=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(f),m=document.createElement("a");m.href=h,m.download=`${s}.xlsx`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(h)},wN=async(e,t)=>{const s=new ExcelJS.Workbook;s.creator="AlgaManage",s.created=new Date,e.forEach(u=>{const f=s.addWorksheet(u.sheetName);f.columns=u.columns.map(m=>({header:m.header,key:m.key,width:m.width||15}));const h=f.getRow(1);h.font={bold:!0,color:{argb:"FFFFFFFF"}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},u.data.forEach(m=>{f.addRow(m)})});const a=await s.xlsx.writeBuffer(),i=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`${t}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)},B2=({status:e})=>{const{t}=we();if(e==="normal")return null;const s=e==="nearing"?"text-yellow-500":"text-red-600",a=t(e==="nearing"?"nearingHarvest":"overdueHarvest");return n.jsxs("div",{className:"relative group flex justify-center",children:[n.jsx(te,{name:"AlertTriangle",className:`w-5 h-5 ${s}`}),n.jsx("span",{className:"absolute bottom-full mb-2 w-max px-2 py-1 text-xs text-white bg-gray-900 rounded-md opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:a})]})},dm=({initialFilters:e,pageTitle:t})=>{var kr;const{t:s,language:a}=we(),{cultivationCycles:i,modules:l,seaweedTypes:c,farmers:u,sites:f,periodicTests:h,updateCultivationCycle:m,deleteCultivationCycle:x,incidentTypes:y}=He(),[b,T]=S.useState(!1),[_,j]=S.useState(!1),[E,k]=S.useState(null),[C,A]=S.useState(!1),[M,I]=S.useState(null),[P,D]=S.useState({key:"module.code",direction:"ascending"}),[U,O]=S.useState(!1),[F,q]=S.useState(null),[z,Y]=S.useState(!1),[J,G]=S.useState(null),[B,Q]=S.useState({date:"",notes:"",linesHarvested:"",harvestedWeight:"",cuttingsWeight:""}),[W,ae]=S.useState(""),[$,ie]=S.useState({siteId:(e==null?void 0:e.siteId)||"all",seaweedTypeId:(e==null?void 0:e.seaweedTypeId)||"all"}),[ue,Ne]=Kf(),le=ue.get("highlight"),ne=S.useRef(new Map),[je,fe]=S.useState({}),[Z,ee]=S.useState(null),{settings:xe}=Ke();S.useEffect(()=>{if(le){ee(le);const Be=ne.current.get(le);Be&&(Be.scrollIntoView({behavior:"smooth",block:"center"}),Be.classList.add("highlight-row"),setTimeout(()=>{Be.classList.remove("highlight-row")},2e3)),Ne({},{replace:!0})}},[le,Ne]);const Oe=(Be,Je)=>{ie($e=>({...$e,[Be]:Je}))},De=S.useCallback(()=>{ie({siteId:(e==null?void 0:e.siteId)||"all",seaweedTypeId:(e==null?void 0:e.seaweedTypeId)||"all"})},[e]),Re=S.useMemo(()=>{const Be=new Date;Be.setHours(0,0,0,0);let Je=i.map($e=>{let wt="normal";const it=new Date($e.plantingDate);it.setHours(0,0,0,0);const kt=$e.harvestDate?new Date($e.harvestDate):Be;kt.setHours(0,0,0,0);const Tn=Math.ceil((kt.getTime()-it.getTime())/(1e3*60*60*24));if($e.status===Ye.PLANTED||$e.status===Ye.GROWING){const Xt=(Be.getTime()-it.getTime())/864e5;Xt>pa?wt="overdue":Xt>pa-Yf&&(wt="nearing")}let jn;if($e.harvestDate&&$e.plantingDate&&$e.harvestedWeight&&$e.initialWeight&&$e.harvestedWeight>0&&$e.initialWeight>0){const Na=(new Date($e.harvestDate).getTime()-new Date($e.plantingDate).getTime())/(1e3*60*60*24),Ls=pd($e.initialWeight,$e.harvestedWeight,Na);Ls!==null&&(jn=Ls)}const pn=l.find(Xt=>Xt.id===$e.moduleId),Os=pn?u.find(Xt=>Xt.id===pn.farmerId):void 0;return{cycle:$e,module:pn,seaweedType:c.find(Xt=>Xt.id===$e.seaweedTypeId),farmer:Os,alertStatus:wt,growthRate:jn,age:Tn}});return $.siteId!=="all"&&(Je=Je.filter($e=>{var wt;return((wt=$e.module)==null?void 0:wt.siteId)===$.siteId})),$.seaweedTypeId!=="all"&&(Je=Je.filter($e=>$e.cycle.seaweedTypeId===$.seaweedTypeId)),Je.sort(($e,wt)=>{const it=(jn,pn)=>{if(Object.prototype.hasOwnProperty.call(jn,pn))return jn[pn];if(Object.prototype.hasOwnProperty.call(jn.cycle,pn))return jn.cycle[pn];const Os=pn.split(".");let Xt=jn;for(const cs of Os){if(Xt==null)return;Xt=Xt[cs]}return Xt},kt=it($e,P.key),Tn=it(wt,P.key);return kt==null?1:Tn==null?-1:typeof kt=="string"&&typeof Tn=="string"?P.direction==="ascending"?kt.localeCompare(Tn):Tn.localeCompare(kt):kt<Tn?P.direction==="ascending"?-1:1:kt>Tn?P.direction==="ascending"?1:-1:0}),Je},[i,l,c,u,P,$]),Ve=S.useCallback(async Be=>{const Je=Be.cycle.id;fe(it=>({...it,[Je]:{isLoading:!0,error:null,result:null}}));const $e=i.filter(it=>it.seaweedTypeId===Be.cycle.seaweedTypeId&&it.id!==Je&&it.harvestDate),wt=h.filter(it=>{var kt;return it.siteId===((kt=Be.module)==null?void 0:kt.siteId)}).sort((it,kt)=>new Date(kt.date).getTime()-new Date(it.date).getTime());if(!Be.module||!Be.seaweedType){fe(it=>({...it,[Je]:{result:null,isLoading:!1,error:s("predictionError")}}));return}try{const it=await w2(Be.cycle,Be.module,Be.seaweedType,$e,wt,a);fe(it?kt=>({...kt,[Je]:{result:it,isLoading:!1,error:null}}):kt=>({...kt,[Je]:{result:null,isLoading:!1,error:s("predictionError")}}))}catch(it){console.error("Prediction failed unexpectedly:",it),fe(kt=>({...kt,[Je]:{result:null,isLoading:!1,error:s("predictionError")}}))}},[i,h,a,s]),ze=Be=>{let Je="ascending";P.key===Be&&P.direction==="ascending"&&(Je="descending"),D({key:Be,direction:Je})},Se=Be=>P.key!==Be?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):P.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Le=(Be=null)=>{k(Be),T(!0)},be=()=>{k(null),T(!1),j(!1)},ye=Be=>{I(Be),A(!0)},Ue=()=>{M&&x(M),A(!1),I(null)},et=Be=>{q(Be),O(!0)},At=Be=>{m(Be),be()},ut=async()=>{const Be=Re.map($e=>{var wt,it,kt;return{moduleCode:((wt=$e.module)==null?void 0:wt.code)||s("unknown"),farmerName:$e.farmer?`${$e.farmer.firstName} ${$e.farmer.lastName}`:s("unknown"),seaweedType:((it=$e.seaweedType)==null?void 0:it.name)||s("unknown"),plantingDate:$e.cycle.plantingDate,initialWeight:$e.cycle.initialWeight||0,linesPlanted:$e.cycle.linesPlanted||((kt=$e.module)==null?void 0:kt.lines)||0,age:$e.age,status:s(`status_${$e.cycle.status}`),harvestDate:$e.cycle.harvestDate||"-",harvestedWeight:$e.cycle.harvestedWeight||0,cuttingsWeight:$e.cycle.cuttingsTakenAtHarvestKg||0,netWeight:($e.cycle.harvestedWeight||0)-($e.cycle.cuttingsTakenAtHarvestKg||0),linesHarvested:$e.cycle.linesHarvested||0,growthRate:$e.growthRate?`${$e.growthRate.toFixed(2)}%`:"-",notes:$e.cycle.processingNotes||""}}),Je=[{header:s("moduleCode"),key:"moduleCode",width:15},{header:s("farmer"),key:"farmerName",width:20},{header:s("seaweedType"),key:"seaweedType",width:15},{header:s("plantingDate"),key:"plantingDate",width:15},{header:`${s("initialWeight")} (Kg)`,key:"initialWeight",width:15},{header:s("linesPlanted"),key:"linesPlanted",width:15},{header:s("ageInDays"),key:"age",width:10},{header:s("status"),key:"status",width:15},{header:s("harvestDate"),key:"harvestDate",width:15},{header:`${s("harvestedWeight")} (Kg)`,key:"harvestedWeight",width:15},{header:`${s("cuttingsWeightKg")} (Kg)`,key:"cuttingsWeight",width:15},{header:`${s("wetProduction")} (Kg)`,key:"netWeight",width:15},{header:s("linesHarvested"),key:"linesHarvested",width:15},{header:s("growthRate"),key:"growthRate",width:15},{header:s("notes"),key:"notes",width:30}];await Pi(Be,Je,`CultivationCycles_${new Date().toISOString().split("T")[0]}`,"Cultivation Cycles")},Ut=Be=>{var $e;G(Be);let Je=new Date().toISOString().split("T")[0];if(Be.cycle.plantingDate){const wt=new Date(Be.cycle.plantingDate),it=new Date(wt);it.setDate(wt.getDate()+pa),Je=it.toISOString().split("T")[0]}Q({date:Je,notes:"Harvest for maturity",linesHarvested:String(Be.cycle.linesPlanted||(($e=Be.module)==null?void 0:$e.lines)||""),harvestedWeight:"",cuttingsWeight:""}),ae(""),Y(!0)},Ct=()=>{const Be=B.notes==="Other",Je=parseFloat(B.harvestedWeight),$e=parseFloat(B.cuttingsWeight);if(J&&B.date&&(!Be||W.trim())&&B.linesHarvested&&!isNaN(Je)&&Je>0&&B.cuttingsWeight!==""&&!isNaN($e)&&$e>=0){const wt=Be?W:B.notes;m({...J.cycle,status:Ye.HARVESTED,harvestDate:B.date,processingNotes:wt,linesHarvested:Number(B.linesHarvested),harvestedWeight:Je,cuttingsTakenAtHarvestKg:$e}),Y(!1),G(null)}},vt=({sortKey:Be,label:Je,className:$e=""})=>n.jsx("th",{className:`p-3 ${$e}`,children:n.jsxs("button",{onClick:()=>ze(Be),className:`group flex items-center gap-2 w-full whitespace-nowrap ${$e.includes("text-right")?"justify-end":""}`,children:[Je," ",Se(Be)]})}),Yt=parseFloat(B.harvestedWeight)||0,Ps=parseFloat(B.cuttingsWeight)||0,Vs=Yt-Ps;return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:t||s("cultivationCycleManagementTitle")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:ut,children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),s("exportExcel")]}),n.jsxs(se,{onClick:()=>j(!0),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),s("addCycle")]})]})]}),n.jsx(Ge,{className:"mb-6",title:s("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[n.jsxs(ke,{label:s("site"),value:$.siteId,onChange:Be=>Oe("siteId",Be.target.value),disabled:!!(e!=null&&e.siteId),children:[n.jsx("option",{value:"all",children:s("allSites")}),f.map(Be=>n.jsx("option",{value:Be.id,children:Be.name},Be.id))]}),n.jsxs(ke,{label:s("seaweedType"),value:$.seaweedTypeId,onChange:Be=>Oe("seaweedTypeId",Be.target.value),disabled:!!(e!=null&&e.seaweedTypeId),children:[n.jsx("option",{value:"all",children:s("allSeaweedTypes")}),c.map(Be=>n.jsx("option",{value:Be.id,children:Be.name},Be.id))]}),n.jsx(se,{variant:"secondary",onClick:De,className:"h-[42px] w-full",children:s("clearFilters")})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-12"}),n.jsx("th",{className:"p-3 w-16 text-center",children:s("alerts")}),n.jsx(vt,{sortKey:"module.code",label:s("module")}),n.jsx(vt,{sortKey:"farmer.firstName",label:s("farmer")}),n.jsx(vt,{sortKey:"seaweedType.name",label:s("seaweedType")}),n.jsx(vt,{sortKey:"plantingDate",label:s("plantingDate")}),n.jsx(vt,{sortKey:"age",label:s("ageInDays"),className:"text-right"}),n.jsx(vt,{sortKey:"harvestDate",label:s("harvestDate")}),n.jsx(vt,{sortKey:"status",label:s("status")}),n.jsx("th",{className:"p-3 text-right",children:s("actions")})]})}),n.jsx("tbody",{children:Re.map(Be=>{const{cycle:Je,module:$e,seaweedType:wt,farmer:it,alertStatus:kt,age:Tn}=Be,jn=Z===Je.id;return n.jsxs(gt.Fragment,{children:[n.jsxs("tr",{ref:pn=>{pn?ne.current.set(Je.id,pn):ne.current.delete(Je.id)},className:`border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 ${Je.id===le?"highlight-row":""}`,children:[n.jsx("td",{className:"p-3 text-center",children:n.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ee(jn?null:Je.id),"aria-expanded":jn,"aria-controls":`details-${Je.id}`,children:n.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${jn?"rotate-90":""}`})})}),n.jsx("td",{className:"p-3 text-center",children:n.jsx(B2,{status:kt})}),n.jsx("td",{className:"p-3 font-mono font-semibold whitespace-nowrap",children:($e==null?void 0:$e.code)||s("unknown")}),n.jsx("td",{className:"p-3 whitespace-nowrap",children:it?`${it.firstName} ${it.lastName}`:s("unknown")}),n.jsx("td",{className:"p-3 whitespace-nowrap",children:(wt==null?void 0:wt.name)||s("unknown")}),n.jsx("td",{className:"p-3 whitespace-nowrap",children:Je.plantingDate}),n.jsx("td",{className:"p-3 text-right font-semibold",children:Tn>=50?n.jsx(cm,{content:s("exactAge").replace("{days}",String(Tn)),children:n.jsx("span",{className:"cursor-help border-b border-dotted",children:"+50"})}):Tn}),n.jsx("td",{className:"p-3 whitespace-nowrap",children:Je.harvestDate||"-"}),n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:Je.status})}),n.jsx("td",{className:"p-3",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[(Je.status===Ye.PLANTED||Je.status===Ye.GROWING)&&n.jsxs(se,{variant:"primary",onClick:()=>Ut(Be),children:[n.jsx(te,{name:"Scissors",className:"w-4 h-4"}),s("harvest")]}),n.jsxs(se,{variant:"ghost",onClick:()=>et(Be),children:[n.jsx(te,{name:"FileText",className:"w-4 h-4"}),s("history")]}),n.jsx(se,{variant:"ghost",onClick:()=>Le(Je),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>ye(Je.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]}),jn&&n.jsx("tr",{id:`details-${Je.id}`,children:n.jsx("td",{colSpan:10,className:"p-0",children:n.jsx(G2,{info:Be,prediction:je[Je.id]||{isLoading:!1,error:null,result:null},onPredict:()=>Ve(Be)})})})]},Je.id)})})]})})}),_&&n.jsx(bN,{isOpen:_,onClose:be}),b&&n.jsx(z2,{isOpen:b,onClose:be,onSave:At,cycle:E}),C&&n.jsx(zt,{isOpen:C,onClose:()=>A(!1),onConfirm:Ue,title:s("confirmDeleteTitle"),message:s("confirmDeleteCycle")}),U&&F&&F.module&&n.jsx(WC,{isOpen:U,onClose:()=>O(!1),cycle:F.cycle,module:F.module}),z&&J&&n.jsx(zt,{isOpen:z,onClose:()=>Y(!1),onConfirm:Ct,title:`${s("confirmHarvestTitle")}: ${(kr=J.module)==null?void 0:kr.code}`,message:n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("p",{children:s("confirmHarvestMessage")}),n.jsx(de,{label:s("harvestDate"),type:"date",value:B.date,onChange:Be=>Q(Je=>({...Je,date:Be.target.value}))}),n.jsx(de,{label:s("harvestedWeightKg"),type:"number",value:B.harvestedWeight,onChange:Be=>Q(Je=>({...Je,harvestedWeight:Be.target.value}))}),n.jsx(de,{label:s("cuttingsWeightKg"),type:"number",value:B.cuttingsWeight,onChange:Be=>Q(Je=>({...Je,cuttingsWeight:Be.target.value}))}),n.jsx(de,{label:s("wetProduction"),type:"text",value:`${Vs.toFixed(2)} kg`,disabled:!0}),n.jsx(de,{label:s("linesHarvested"),type:"number",value:B.linesHarvested,onChange:Be=>Q(Je=>({...Je,linesHarvested:Be.target.value}))}),n.jsxs(ke,{label:s("harvestReason"),value:B.notes,onChange:Be=>Q(Je=>({...Je,notes:Be.target.value})),children:[n.jsx("option",{value:"Harvest for maturity",children:s("harvestReason_maturity")}),y.map(Be=>n.jsx("option",{value:Be.name,children:Be.name},Be.id)),n.jsx("option",{value:"Other",children:s("other")})]}),B.notes==="Other"&&n.jsx(de,{label:s("other"),value:W,onChange:Be=>ae(Be.target.value),error:W.trim()?"":s("validationReasonRequired"),placeholder:s("otherReasonPlaceholder")})]}),confirmText:s("harvest"),confirmDisabled:!B.date||!B.harvestedWeight||!B.linesHarvested||!B.cuttingsWeight||B.notes==="Other"&&!W.trim()})]})},G2=({info:e,prediction:t,onPredict:s})=>{const{t:a}=we(),{settings:i}=Ke(),{cycle:l,growthRate:c}=e,u=l.status===Ye.PLANTED||l.status===Ye.GROWING,f=({label:h,value:m})=>n.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded",children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h}),n.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:m})]});return n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"md:col-span-2 space-y-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:a("performance")}),n.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[n.jsx(f,{label:a("initialWeight"),value:`${l.initialWeight} kg`}),n.jsx(f,{label:a("linesPlanted"),value:l.linesPlanted||"-"}),n.jsx(f,{label:a("harvestedWeight"),value:l.harvestedWeight?`${l.harvestedWeight} kg`:"-"}),n.jsx(f,{label:a("linesHarvested"),value:l.linesHarvested||"-"}),c!==void 0&&n.jsx(f,{label:`${a("growthRate")} (SGR)`,value:`${Fe(c,{...i.localization,nonMonetaryDecimals:2})}% / day`})]})]}),l.processingNotes&&n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:a("notes")}),n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 p-2 bg-gray-100 dark:bg-gray-800 rounded",children:l.processingNotes})]})]}),n.jsx("div",{className:"md:col-span-1",children:u&&n.jsxs(Ge,{children:[n.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:a("aiPrediction")}),t.isLoading?n.jsx("div",{className:"flex justify-center items-center h-24",children:n.jsx(te,{name:"Activity",className:"animate-spin w-6 h-6 text-gray-500"})}):t.error?n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-red-500 mb-2",children:t.error}),n.jsxs(se,{onClick:s,className:"!px-2 !py-1 text-sm",children:[n.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),a("retry")]})]}):t.result?n.jsxs("div",{className:"space-y-2",children:[n.jsx(f,{label:a("predictedHarvest"),value:`${t.result.predictedHarvestDateStart}  ${t.result.predictedHarvestDateEnd}`}),n.jsx(f,{label:a("predictedYieldKg"),value:`${Fe(t.result.predictedYieldKgMin,{...i.localization,nonMonetaryDecimals:0})} - ${Fe(t.result.predictedYieldKgMax,{...i.localization,nonMonetaryDecimals:0})} kg`}),n.jsx(f,{label:a("confidence"),value:n.jsx(cm,{content:n.jsx("div",{className:"max-w-xs",children:t.result.reasoning}),children:n.jsxs("span",{className:"font-semibold cursor-help border-b border-dotted",children:[(t.result.confidenceScore*100).toFixed(0),"%"]})})})]}):n.jsxs(se,{onClick:s,className:"w-full",children:[n.jsx(te,{name:"Bot",className:"w-5 h-5"}),a("predict")]})]})})]})},z2=({isOpen:e,onClose:t,onSave:s,cycle:a})=>{const{t:i}=we(),{modules:l,seaweedTypes:c}=He(),[u,f]=S.useState({moduleId:"",seaweedTypeId:"",plantingDate:"",initialWeight:"",status:Ye.PLANTED});S.useEffect(()=>{a&&f({moduleId:a.moduleId,seaweedTypeId:a.seaweedTypeId,plantingDate:a.plantingDate,initialWeight:String(a.initialWeight),status:a.status})},[a]);const h=(x,y)=>{f(b=>({...b,[x]:y}))},m=x=>{x.preventDefault(),a&&s({...a,...u,initialWeight:parseFloat(u.initialWeight)})};return n.jsx(ot,{isOpen:e,onClose:t,title:i("editCycle"),children:n.jsxs("form",{onSubmit:m,className:"space-y-4",children:[n.jsx(ke,{label:i("module"),value:u.moduleId,onChange:x=>h("moduleId",x.target.value),required:!0,disabled:!0,children:l.map(x=>n.jsx("option",{value:x.id,children:x.code},x.id))}),n.jsx(ke,{label:i("seaweedType"),value:u.seaweedTypeId,onChange:x=>h("seaweedTypeId",x.target.value),required:!0,children:c.map(x=>n.jsx("option",{value:x.id,children:x.name},x.id))}),n.jsx(de,{label:i("plantingDate"),type:"date",value:u.plantingDate,onChange:x=>h("plantingDate",x.target.value),required:!0}),n.jsx(de,{label:i("initialWeight"),type:"number",value:u.initialWeight,onChange:x=>h("initialWeight",x.target.value),required:!0}),n.jsx(ke,{label:i("status"),value:u.status,onChange:x=>h("status",x.target.value),required:!0,children:Object.values(Ye).map(x=>n.jsx("option",{value:x,children:i(`status_${x}`)},x))}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",children:i("save")})]})]})})},$2=()=>n.jsx(dm,{}),H2=()=>{var Q;const{t:e,language:t}=we(),{settings:s}=Ke(),{cultivationCycles:a,modules:i,seaweedTypes:l,farmers:c,sites:u,updateCultivationCycle:f}=He(),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all"}),[x,y]=S.useState({key:"module.code",direction:"ascending"}),[b,T]=S.useState(!1),[_,j]=S.useState(null),[E,k]=S.useState(""),[C,A]=S.useState(""),[M,I]=S.useState(!1),[P,D]=S.useState(""),U=(W,ae)=>{m($=>({...$,[W]:ae}))},O=S.useCallback(()=>{m({siteId:"all",seaweedTypeId:"all"})},[]),F=S.useMemo(()=>{if(!_||!_.cycle)return null;const{cycle:W}=_;if(W.harvestDate&&W.plantingDate&&W.harvestedWeight&&W.initialWeight&&W.harvestedWeight>0&&W.initialWeight>0){const $=(new Date(W.harvestDate).getTime()-new Date(W.plantingDate).getTime())/(1e3*60*60*24);return pd(W.initialWeight,W.harvestedWeight,$)}return null},[_]),q=S.useMemo(()=>{let W=a.filter(ae=>ae.status===Ye.HARVESTED).map(ae=>{const $=i.find(Ne=>Ne.id===ae.moduleId),ie=$?c.find(Ne=>Ne.id===$.farmerId):void 0,ue=(ae.harvestedWeight||0)-(ae.cuttingsTakenAtHarvestKg||0);return{cycle:ae,module:$,seaweedType:l.find(Ne=>Ne.id===ae.seaweedTypeId),farmer:ie,netHarvestedWeight:ue}});return h.siteId!=="all"&&(W=W.filter(ae=>{var $;return(($=ae.module)==null?void 0:$.siteId)===h.siteId})),h.seaweedTypeId!=="all"&&(W=W.filter(ae=>ae.cycle.seaweedTypeId===h.seaweedTypeId)),W.sort((ae,$)=>{const ie=(le,ne)=>{if(ne==="netHarvestedWeight")return le.netHarvestedWeight;const je=ne.split(".");let fe=le;for(const Z of je){if(fe==null)return;fe=fe[Z]}return fe},ue=ie(ae,x.key),Ne=ie($,x.key);return ue==null?1:Ne==null?-1:typeof ue=="string"&&typeof Ne=="string"?x.direction==="ascending"?ue.localeCompare(Ne):Ne.localeCompare(ue):ue<Ne?x.direction==="ascending"?-1:1:ue>Ne?x.direction==="ascending"?1:-1:0}),W},[a,i,l,c,h,x]),z=W=>{let ae="ascending";x.key===W&&x.direction==="ascending"&&(ae="descending"),y({key:W,direction:ae})},Y=W=>x.key!==W?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):x.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),J=({sortKey:W,label:ae,className:$=""})=>n.jsx("th",{className:`p-3 ${$}`,children:n.jsxs("button",{onClick:()=>z(W),className:`group flex items-center gap-2 w-full ${$.includes("text-right")?"justify-end":""}`,children:[ae," ",Y(W)]})}),G=S.useCallback(async W=>{var $;j(W),k(W.cycle.harvestDate||new Date().toISOString().split("T")[0]),T(!0),I(!0),A("");const ae=await b2({seaweedType:(($=W.seaweedType)==null?void 0:$.name)||e("unknown"),totalWeight:W.netHarvestedWeight||0,notes:W.cycle.processingNotes||""},t);A(ae),I(!1)},[t,e]);S.useEffect(()=>{b&&(_!=null&&_.cycle.harvestDate)&&E&&new Date(E)<new Date(_.cycle.harvestDate)?D(e("validationDryingStartDate")):D("")},[b,E,_,e]);const B=()=>{_&&E&&!P&&(f({..._.cycle,status:Ye.DRYING,dryingStartDate:E}),T(!1),j(null))};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("harvestProcessingTitle")}),n.jsx(Ge,{className:"mb-6",title:e("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[n.jsxs(ke,{label:e("site"),value:h.siteId,onChange:W=>U("siteId",W.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),u.map(W=>n.jsx("option",{value:W.id,children:W.name},W.id))]}),n.jsxs(ke,{label:e("seaweedType"),value:h.seaweedTypeId,onChange:W=>U("seaweedTypeId",W.target.value),children:[n.jsx("option",{value:"all",children:e("allSeaweedTypes")}),l.map(W=>n.jsx("option",{value:W.id,children:W.name},W.id))]}),n.jsx(se,{variant:"secondary",onClick:O,className:"h-[42px] w-full",children:e("clearFilters")})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(J,{sortKey:"module.code",label:e("module")}),n.jsx(J,{sortKey:"farmer.firstName",label:e("farmer")}),n.jsx(J,{sortKey:"seaweedType.name",label:e("seaweedType")}),n.jsx(J,{sortKey:"cycle.harvestDate",label:e("harvestDate")}),n.jsx(J,{sortKey:"netHarvestedWeight",label:e("netHarvestedWeightKg"),className:"text-right"}),n.jsx(J,{sortKey:"cycle.linesHarvested",label:e("linesHarvested"),className:"text-right"}),n.jsx("th",{className:"p-3",children:e("harvestReason")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[q.map(W=>{var ae,$;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-mono font-semibold",children:((ae=W.module)==null?void 0:ae.code)||e("unknown")}),n.jsx("td",{className:"p-3",children:W.farmer?`${W.farmer.firstName} ${W.farmer.lastName}`:e("unknown")}),n.jsx("td",{className:"p-3",children:(($=W.seaweedType)==null?void 0:$.name)||e("unknown")}),n.jsx("td",{className:"p-3",children:W.cycle.harvestDate}),n.jsx("td",{className:"p-3 text-right",children:Fe(W.netHarvestedWeight,s.localization)}),n.jsx("td",{className:"p-3 text-right",children:W.cycle.linesHarvested}),n.jsx("td",{className:"p-3",children:W.cycle.processingNotes}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs(se,{variant:"primary",onClick:()=>G(W),children:[n.jsx(te,{name:"Wind",className:"w-4 h-4"}),e("startDrying")]})})]},W.cycle.id)}),q.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:e("noHarvestedBatches")})})]})]})})}),b&&_&&n.jsx(ot,{isOpen:b,onClose:()=>T(!1),title:`${e("startDryingFor")} ${(Q=_.module)==null?void 0:Q.code}`,footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:()=>T(!1),children:e("cancel")}),n.jsx(se,{variant:"primary",onClick:B,disabled:!E||!!P,children:e("confirm")})]}),children:n.jsxs("div",{className:"space-y-4",children:[F!==null&&n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[n.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:e("growthRate")}),n.jsxs("p",{className:"text-xl font-bold",children:[Fe(F,s.localization),e("growthRateUnit")]})]}),n.jsx(de,{label:e("dryingStartDate"),type:"date",value:E,onChange:W=>k(W.target.value),required:!0,error:P}),n.jsx(Ge,{title:e("geminiSuggestion"),children:M?n.jsx("p",{children:e("loading")}):n.jsx("p",{className:"whitespace-pre-wrap font-serif",children:C||e("noSuggestion")})})]})})]})},q2=()=>{var q;const{t:e}=we(),{settings:t}=Ke(),{cultivationCycles:s,modules:a,seaweedTypes:i,sites:l,updateCultivationCycle:c}=He(),[u,f]=S.useState({siteId:"all",seaweedTypeId:"all"}),[h,m]=S.useState({key:"module.code",direction:"ascending"}),[x,y]=S.useState(!1),[b,T]=S.useState(null),[_,j]=S.useState({dryingCompletionDate:"",baggingStartDate:"",actualDryWeight:""}),[E,k]=S.useState({}),C=(z,Y)=>{f(J=>({...J,[z]:Y}))},A=S.useCallback(()=>{f({siteId:"all",seaweedTypeId:"all"})},[]),M=S.useMemo(()=>{let z=s.filter(Y=>Y.status===Ye.DRYING).map(Y=>{const J=a.find(Q=>Q.id===Y.moduleId);let G=0;if(Y.dryingStartDate){const Q=new Date(Y.dryingStartDate);G=Math.ceil((new Date().getTime()-Q.getTime())/864e5)}const B=(Y.harvestedWeight||0)-(Y.cuttingsTakenAtHarvestKg||0);return{cycle:Y,module:J,seaweedType:i.find(Q=>Q.id===Y.seaweedTypeId),dryingDuration:G,netHarvestedWeight:B}});return u.siteId!=="all"&&(z=z.filter(Y=>{var J;return((J=Y.module)==null?void 0:J.siteId)===u.siteId})),u.seaweedTypeId!=="all"&&(z=z.filter(Y=>Y.cycle.seaweedTypeId===u.seaweedTypeId)),z.sort((Y,J)=>{const G=(W,ae)=>{const $=ae.split(".");let ie=W;for(const ue of $){if(ie==null)return;ie=ie[ue]}return ie},B=G(Y,h.key),Q=G(J,h.key);return B==null?1:Q==null?-1:B<Q?h.direction==="ascending"?-1:1:B>Q?h.direction==="ascending"?1:-1:0}),z},[s,a,i,u,h]),I=z=>{let Y="ascending";h.key===z&&h.direction==="ascending"&&(Y="descending"),m({key:z,direction:Y})},P=z=>h.key!==z?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):h.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),D=({sortKey:z,label:Y,className:J=""})=>n.jsx("th",{className:`p-3 ${J}`,children:n.jsxs("button",{onClick:()=>I(z),className:`group flex items-center gap-2 w-full ${J.includes("text-right")?"justify-end":""}`,children:[Y," ",P(z)]})}),U=S.useCallback(z=>{T(z);let Y=new Date;if(z.cycle.dryingStartDate){const G=new Date(z.cycle.dryingStartDate);G.setDate(G.getDate()+5),Y=G}const J=Y.toISOString().split("T")[0];j({dryingCompletionDate:J,baggingStartDate:J,actualDryWeight:""}),y(!0)},[]),O=S.useCallback(()=>{if(!b)return{};const z={},Y=new Date;return Y.setHours(23,59,59,999),_.dryingCompletionDate?(new Date(_.dryingCompletionDate)>Y&&(z.dryingCompletionDate=e("validationFutureDate")),b.cycle.dryingStartDate&&_.dryingCompletionDate<b.cycle.dryingStartDate&&(z.dryingCompletionDate=e("validationDryingCompletionDate"))):z.dryingCompletionDate=e("validationRequired"),_.baggingStartDate?(new Date(_.baggingStartDate)>Y&&(z.baggingStartDate=e("validationFutureDate")),_.dryingCompletionDate&&_.baggingStartDate<_.dryingCompletionDate&&(z.baggingStartDate=e("validationBaggingStartDate"))):z.baggingStartDate=e("validationRequired"),(!_.actualDryWeight||isNaN(parseFloat(_.actualDryWeight))||parseFloat(_.actualDryWeight)<=0)&&(z.actualDryWeight=e("validationPositiveNumber")),z},[_,b,e]);S.useEffect(()=>{x&&k(O())},[_,x,O]);const F=()=>{const z=O();if(Object.keys(z).length>0){k(z);return}b&&_.dryingCompletionDate&&_.baggingStartDate&&(c({...b.cycle,status:Ye.BAGGING,dryingCompletionDate:_.dryingCompletionDate,baggingStartDate:_.baggingStartDate,actualDryWeightKg:parseFloat(_.actualDryWeight)}),y(!1),T(null))};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("dryingManagementTitle")}),n.jsx(Ge,{className:"mb-6",title:e("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[n.jsxs(ke,{label:e("site"),value:u.siteId,onChange:z=>C("siteId",z.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),l.map(z=>n.jsx("option",{value:z.id,children:z.name},z.id))]}),n.jsxs(ke,{label:e("seaweedType"),value:u.seaweedTypeId,onChange:z=>C("seaweedTypeId",z.target.value),children:[n.jsx("option",{value:"all",children:e("allSeaweedTypes")}),i.map(z=>n.jsx("option",{value:z.id,children:z.name},z.id))]}),n.jsx(se,{variant:"secondary",onClick:A,className:"h-[42px] w-full",children:e("clearFilters")})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(D,{sortKey:"module.code",label:e("module")}),n.jsx(D,{sortKey:"seaweedType.name",label:e("seaweedType")}),n.jsx(D,{sortKey:"cycle.harvestDate",label:e("harvestDate")}),n.jsx(D,{sortKey:"cycle.dryingStartDate",label:e("dryingStartDate")}),n.jsx(D,{sortKey:"dryingDuration",label:e("dryingDuration"),className:"text-right"}),n.jsx(D,{sortKey:"netHarvestedWeight",label:e("netHarvestedWeightKg"),className:"text-right"}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[M.map(z=>{var Y,J;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-mono font-semibold",children:((Y=z.module)==null?void 0:Y.code)||e("unknown")}),n.jsx("td",{className:"p-3",children:((J=z.seaweedType)==null?void 0:J.name)||e("unknown")}),n.jsx("td",{className:"p-3",children:z.cycle.harvestDate}),n.jsx("td",{className:"p-3",children:z.cycle.dryingStartDate}),n.jsx("td",{className:"p-3 text-right",children:z.dryingDuration}),n.jsx("td",{className:"p-3 text-right",children:Fe(z.netHarvestedWeight,t.localization)}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs(se,{variant:"primary",onClick:()=>U(z),children:[n.jsx(te,{name:"Archive",className:"w-4 h-4"}),e("completeDrying")]})})]},z.cycle.id)}),M.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:e("noBatchesDrying")})})]})]})})}),x&&b&&n.jsx(ot,{isOpen:x,onClose:()=>y(!1),title:`${e("completeDryingFor")} ${(q=b.module)==null?void 0:q.code}`,footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:()=>y(!1),children:e("cancel")}),n.jsx(se,{variant:"primary",onClick:F,disabled:Object.keys(E).length>0,children:e("confirm")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx(de,{label:e("dryingStartDate"),type:"date",value:b.cycle.dryingStartDate||"",disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),n.jsx(de,{label:e("dryingCompletionDate"),type:"date",value:_.dryingCompletionDate,onChange:z=>j(Y=>({...Y,dryingCompletionDate:z.target.value,baggingStartDate:z.target.value})),error:E.dryingCompletionDate,required:!0}),n.jsx(de,{label:e("baggingStartDate"),type:"date",value:_.baggingStartDate,onChange:z=>j(Y=>({...Y,baggingStartDate:z.target.value})),error:E.baggingStartDate,required:!0}),n.jsx(de,{label:e("actualDryWeight"),type:"number",step:"any",value:_.actualDryWeight,onChange:z=>j(Y=>({...Y,actualDryWeight:z.target.value})),error:E.actualDryWeight,required:!0,autoFocus:!0})]})})]})},V2=({weights:e,onChange:t})=>{const{t:s}=we(),[a,i]=S.useState([]);S.useEffect(()=>{const c=[...e.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[e]);const l=(c,u)=>{const f=[...a];if(f[c]=u,c===f.length-1&&u.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);t(h)};return n.jsxs("div",{className:"space-y-2 md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("bagWeights")}),n.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600",children:a.map((c,u)=>n.jsx(de,{type:"number",step:"any",placeholder:`${s("bag")} ${u+1}`,value:c,onChange:f=>l(u,f.target.value)},u))})]})},K2=()=>{const{t:e,language:t}=we(),{settings:s}=Ke(),{cultivationCycles:a,modules:i,seaweedTypes:l,sites:c,updateCultivationCycle:u,updateMultipleCultivationCycles:f,addMultipleStockMovements:h}=He(),[m,x]=S.useState({siteId:"all",seaweedTypeId:"all"}),[y,b]=S.useState({key:"module.code",direction:"ascending"}),[T,_]=S.useState(!1),[j,E]=S.useState(null),[k,C]=S.useState({baggedDate:""}),[A,M]=S.useState([]),[I,P]=S.useState([]),[D,U]=S.useState(!1),O=S.useRef(null),[F,q]=S.useState({}),[z,Y]=S.useState(null),J=S.useMemo(()=>({totalWeightKg:A.reduce((ee,xe)=>ee+xe,0),totalBags:A.length}),[A]),G=(ee,xe)=>{x(Oe=>({...Oe,[ee]:xe}))},B=S.useCallback(()=>{x({siteId:"all",seaweedTypeId:"all"})},[]),Q=S.useCallback(()=>{const ee={},xe=new Date;return xe.setHours(23,59,59,999),k.baggedDate?new Date(k.baggedDate)>xe&&(ee.baggedDate=e("validationFutureDate")):ee.baggedDate=e("validationRequired"),J.totalBags===0&&(ee.bagWeights=e("validationAtLeastOneRequired")),ee},[k,J,e]);S.useEffect(()=>{T&&q(Q())},[T,Q,k,J]);const W=S.useMemo(()=>{let ee=a.filter(xe=>xe.status===Ye.BAGGING).map(xe=>{const Oe=i.find(Re=>Re.id===xe.moduleId);let De=0;if(xe.dryingStartDate&&xe.dryingCompletionDate){const Re=new Date(xe.dryingStartDate),Ve=new Date(xe.dryingCompletionDate);De=Math.ceil((Ve.getTime()-Re.getTime())/864e5)}return{cycle:xe,module:Oe,seaweedType:l.find(Re=>Re.id===xe.seaweedTypeId),dryingDuration:De}});return m.siteId!=="all"&&(ee=ee.filter(xe=>{var Oe;return((Oe=xe.module)==null?void 0:Oe.siteId)===m.siteId})),m.seaweedTypeId!=="all"&&(ee=ee.filter(xe=>xe.cycle.seaweedTypeId===m.seaweedTypeId)),ee.sort((xe,Oe)=>{const De=(ze,Se)=>{const Le=Se.split(".");let be=ze;for(const ye of Le){if(be==null)return;be=be[ye]}return be},Re=De(xe,y.key),Ve=De(Oe,y.key);return Re==null?1:Ve==null?-1:Re<Ve?y.direction==="ascending"?-1:1:Re>Ve?y.direction==="ascending"?1:-1:0}),ee},[a,i,l,m,y]),ae=ee=>{let xe="ascending";y.key===ee&&y.direction==="ascending"&&(xe="descending"),b({key:ee,direction:xe})},$=ee=>y.key!==ee?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):y.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ie=({sortKey:ee,label:xe,className:Oe=""})=>n.jsx("th",{className:`p-3 ${Oe}`,children:n.jsxs("button",{onClick:()=>ae(ee),className:`group flex items-center gap-2 w-full ${Oe.includes("text-right")?"justify-end":""}`,children:[xe," ",$(ee)]})}),ue=S.useCallback(ee=>{E(ee),C({baggedDate:ee.cycle.baggingStartDate||new Date().toISOString().split("T")[0]}),M([]),_(!0)},[]),Ne=()=>{const ee=Q();if(Object.keys(ee).length>0){q(ee);return}if(j){const xe={...j.cycle,status:Ye.BAGGED,baggedDate:k.baggedDate,baggedBagsCount:J.totalBags,baggedWeightKg:J.totalWeightKg,bagWeights:A};u(xe),_(!1),E(null)}},le=()=>{const ee=new Date().toISOString().split("T")[0],xe=a.filter(De=>I.includes(De.id)).map(De=>({...De,status:Ye.BAGGED,baggedDate:ee,baggedBagsCount:Math.ceil((De.actualDryWeightKg||0)/25),baggedWeightKg:De.actualDryWeightKg})),Oe=xe.map(De=>{const Re=i.find(Ve=>Ve.id===De.moduleId);return{date:ee,siteId:(Re==null?void 0:Re.siteId)||"",seaweedTypeId:De.seaweedTypeId,type:ss.BAGGING_TRANSFER,designation:`From Batch Bagging (Module ${Re==null?void 0:Re.code})`,inKg:De.baggedWeightKg,inBags:De.baggedBagsCount,relatedId:De.id}});f(xe),h(Oe),alert(e("batchBaggingCompleteSuccess")),P([]),U(!1)},ne=ee=>{var xe,Oe;Y({data:{t:"b",id:ee.cycle.id},title:`BATCH: ${(xe=ee.module)==null?void 0:xe.code}`,subtitle:`${(Oe=ee.seaweedType)==null?void 0:Oe.name} - ${new Date(ee.cycle.plantingDate).toLocaleDateString()}`})};S.useEffect(()=>{if(O.current){const ee=I.length,xe=W.length;O.current.checked=ee===xe&&xe>0,O.current.indeterminate=ee>0&&ee<xe}},[I,W]);const je=S.useCallback(ee=>{ee.target.checked?P(W.map(xe=>xe.cycle.id)):P([])},[W]),fe=(ee,xe)=>{ee.target.checked?P(Oe=>[...Oe,xe]):P(Oe=>Oe.filter(De=>De!==xe))},Z=Object.keys(F).length>0;return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("baggingManagementTitle")}),n.jsx(Ge,{className:"mb-6",title:e("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[n.jsxs(ke,{label:e("site"),value:m.siteId,onChange:ee=>G("siteId",ee.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),c.map(ee=>n.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),n.jsxs(ke,{label:e("seaweedType"),value:m.seaweedTypeId,onChange:ee=>G("seaweedTypeId",ee.target.value),children:[n.jsx("option",{value:"all",children:e("allSeaweedTypes")}),l.map(ee=>n.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),n.jsx(se,{variant:"secondary",onClick:B,className:"h-[42px] w-full",children:e("clearFilters")})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{ref:O,onChange:je})}),n.jsx(ie,{sortKey:"module.code",label:e("module")}),n.jsx(ie,{sortKey:"seaweedType.name",label:e("seaweedType")}),n.jsx(ie,{sortKey:"cycle.dryingCompletionDate",label:e("dryingCompletionDate")}),n.jsx(ie,{sortKey:"cycle.baggingStartDate",label:e("baggingStartDate")}),n.jsx(ie,{sortKey:"cycle.actualDryWeightKg",label:e("dryWeightToBag"),className:"text-right"}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[W.map(ee=>{var xe,Oe,De;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:I.includes(ee.cycle.id),onChange:Re=>fe(Re,ee.cycle.id),"aria-label":e("selectBatch").replace("{code}",((xe=ee.module)==null?void 0:xe.code)||"")})}),n.jsx("td",{className:"p-3 font-mono font-semibold",children:((Oe=ee.module)==null?void 0:Oe.code)||e("unknown")}),n.jsx("td",{className:"p-3",children:((De=ee.seaweedType)==null?void 0:De.name)||e("unknown")}),n.jsx("td",{className:"p-3",children:ee.cycle.dryingCompletionDate}),n.jsx("td",{className:"p-3",children:ee.cycle.baggingStartDate}),n.jsx("td",{className:"p-3 text-right",children:Fe(ee.cycle.actualDryWeightKg||0,s.localization)}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(se,{variant:"ghost",onClick:()=>ne(ee),title:e("print"),children:n.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),n.jsxs(se,{variant:"primary",onClick:()=>ue(ee),children:[n.jsx(te,{name:"Archive",className:"w-4 h-4"}),e("completeBagging")]})]})})]},ee.cycle.id)}),W.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:e("noBatchesBagging")})})]})]})})}),I.length>0&&n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[n.jsx("span",{className:"font-semibold",children:e("itemsSelected").replace("{count}",String(I.length))}),n.jsxs(se,{onClick:()=>U(!0),children:[n.jsx(te,{name:"Archive",className:"w-4 h-4"}),e("completeSelectedBatches").replace("{count}",String(I.length))]})]}),T&&j&&(()=>{var Oe;const ee=j.cycle.actualDryWeightKg||0,xe=ee-J.totalWeightKg;return n.jsx(ot,{isOpen:T,onClose:()=>_(!1),title:`${e("completeBaggingFor")} ${(Oe=j.module)==null?void 0:Oe.code}`,footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:()=>_(!1),children:e("cancel")}),n.jsx(se,{variant:"primary",onClick:Ne,disabled:Z,children:e("confirmAndMoveToStock")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx(de,{label:e("baggedDate"),type:"date",value:k.baggedDate,onChange:De=>C(Re=>({...Re,baggedDate:De.target.value})),error:F.baggedDate,required:!0}),n.jsx(de,{label:e("weightToBag"),type:"text",value:`${Fe(xe,s.localization)} / ${Fe(ee,s.localization)} kg`,disabled:!0,containerClassName:`transition-colors rounded-md ${xe<0?"bg-red-100 dark:bg-red-900/50":""}`}),n.jsx(V2,{weights:A,onChange:M}),F.bagWeights&&n.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:F.bagWeights}),n.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg",children:[e("totalBaggedWeightKg"),": ",J.totalWeightKg.toFixed(2)," kg (",J.totalBags," ",e("bags"),")"]})]})})})(),D&&n.jsx(zt,{isOpen:D,onClose:()=>U(!1),onConfirm:le,title:e("confirmBatchBaggingTitle"),message:e("confirmBatchBaggingMessage").replace("{count}",String(I.length)).replace("{date}",new Date().toLocaleDateString(t)),confirmText:e("confirm")}),z&&n.jsx(_b,{qrData:z.data,title:z.title,subtitle:z.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>Y(null)})]})},W2=({isOpen:e,onClose:t,onConfirm:s,selectedCount:a,defaultDate:i})=>{const{t:l}=we(),[c,u]=S.useState(i);return S.useEffect(()=>{e&&u(i)},[e,i]),n.jsx(ot,{isOpen:e,onClose:t,title:l("confirmTransfer"),widthClass:"max-w-md",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:l("cancel")}),n.jsx(se,{onClick:()=>s(c),disabled:!c,children:l("confirm")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l("confirmNormalTransferMessage").replace("{count}",String(a))}),n.jsx(de,{label:l("stockTransferDate"),type:"date",value:c,onChange:f=>u(f.target.value),required:!0})]})})},J2=()=>{const{t:e}=we(),{cultivationCycles:t,modules:s,transferBaggedToStock:a}=He(),[i,l]=S.useState([]),[c,u]=S.useState(!1),f=S.useMemo(()=>t.filter(T=>T.status===Ye.BAGGED).map(T=>{const _=s.find(j=>j.id===T.moduleId);return{cycle:T,module:_}}),[t,s]),h=S.useMemo(()=>{const T=t.filter(j=>i.includes(j.id));if(T.length===0)return new Date().toISOString().split("T")[0];const _=T.reduce((j,E)=>E.baggedDate&&E.baggedDate>j?E.baggedDate:j,"0000-00-00");return _==="0000-00-00"?new Date().toISOString().split("T")[0]:_},[i,t]),m=T=>{T.target.checked?l(f.map(_=>_.cycle.id)):l([])},x=(T,_)=>{T.target.checked?l(j=>[...j,_]):l(j=>j.filter(E=>E!==_))},y=()=>{i.length>0&&u(!0)},b=T=>{a(i,T),l([]),u(!1)};return n.jsxs("div",{children:[n.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[n.jsx("h3",{className:"text-lg font-semibold",children:e("pendingTransfers")}),n.jsxs(se,{onClick:y,disabled:i.length===0,children:[n.jsx(te,{name:"ArrowRightLeft",className:"w-4 h-4"}),e("transferToWarehouse")]})]}),n.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:n.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[n.jsx("th",{className:"p-2 w-4",children:n.jsx(_t,{onChange:m,checked:i.length===f.length&&f.length>0})}),n.jsx("th",{className:"p-2 font-semibold",children:e("moduleCode")}),n.jsx("th",{className:"p-2 font-semibold",children:e("baggedDate")}),n.jsx("th",{className:"p-2 font-semibold text-right",children:e("baggedWeightKg")}),n.jsx("th",{className:"p-2 font-semibold text-right",children:e("bags")})]})}),n.jsx("tbody",{children:f.map(({cycle:T,module:_})=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-2",children:n.jsx(_t,{checked:i.includes(T.id),onChange:j=>x(j,T.id)})}),n.jsx("td",{className:"p-2 font-mono",children:_==null?void 0:_.code}),n.jsx("td",{className:"p-2",children:T.baggedDate}),n.jsx("td",{className:"p-2 text-right",children:T.baggedWeightKg}),n.jsx("td",{className:"p-2 text-right",children:T.baggedBagsCount})]},T.id))})]}),f.length===0&&n.jsx("p",{className:"text-center p-8 text-gray-500",children:e("noPendingTransfers")})]}),n.jsx(W2,{isOpen:c,onClose:()=>u(!1),onConfirm:b,selectedCount:i.length,defaultDate:h})]})},Y2=({isOpen:e,onClose:t,siteId:s,siteName:a,seaweedTypeId:i,seaweedTypeName:l})=>{const{t:c,language:u}=we(),{settings:f}=Ke(),{stockMovements:h}=He(),m=S.useRef(null),x=S.useRef(null),y=S.useMemo(()=>{const T=h.filter(E=>E.siteId===s&&E.seaweedTypeId===i).sort((E,k)=>new Date(E.date).getTime()-new Date(k.date).getTime());let _=0,j=0;return T.map(E=>{const k=(E.inKg||0)-(E.outKg||0),C=(E.inBags||0)-(E.outBags||0);return _+=k,j+=C,{...E,balanceKg:_,balanceBags:j}})},[h,s,i]);S.useEffect(()=>{if(!e||!m.current||y.length===0)return;const T=m.current.getContext("2d");if(!T)return;x.current&&x.current.destroy();const _=f.theme.className.includes("dark"),j=_?"#9ca3af":"#4b5563",E=_?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";return window.Chart&&(x.current=new window.Chart(T,{type:"line",data:{labels:y.map(k=>new Date(k.date).toLocaleDateString(u)),datasets:[{label:`${c("stockKg")} - ${l}`,data:y.map(k=>k.balanceKg),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,tension:.1,fill:!0,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{color:j}},tooltip:{mode:"index",intersect:!1}},scales:{x:{ticks:{color:j,maxRotation:45,minRotation:0},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:j},grid:{color:E},title:{display:!0,text:"Kg",color:j}}}}})),()=>{x.current&&x.current.destroy()}},[e,y,l,c,u,f.theme]);const b=[...y].reverse();return n.jsx(ot,{isOpen:e,onClose:t,title:`${c("stockHistory")}: ${l} @ ${a}`,widthClass:"max-w-4xl",footer:n.jsx(se,{onClick:t,children:c("close")}),children:n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"h-64 w-full bg-gray-50 dark:bg-gray-800/50 rounded-lg p-2 border border-gray-200 dark:border-gray-700",children:y.length>0?n.jsx("canvas",{ref:m}):n.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:c("noDataForReport")})}),n.jsx("div",{className:"overflow-x-auto max-h-[40vh] border rounded-lg border-gray-200 dark:border-gray-700",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800 shadow-sm z-10",children:n.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[n.jsx("th",{className:"p-3 whitespace-nowrap",children:c("date")}),n.jsx("th",{className:"p-3",children:c("movementType")}),n.jsx("th",{className:"p-3",children:c("designation")}),n.jsxs("th",{className:"p-3 text-right text-green-600",children:[c("in")," (Kg)"]}),n.jsxs("th",{className:"p-3 text-right text-red-600",children:[c("out")," (Kg)"]}),n.jsxs("th",{className:"p-3 text-right font-bold text-blue-600",children:[c("balance")," (Kg)"]}),n.jsx("th",{className:"p-3 text-right text-gray-500",children:c("bags")})]})}),n.jsxs("tbody",{children:[b.map(T=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30",children:[n.jsx("td",{className:"p-3 whitespace-nowrap font-mono text-xs",children:T.date}),n.jsx("td",{className:"p-3 text-xs font-medium uppercase text-gray-600 dark:text-gray-400",children:c(`stockMovement_${T.type}`)}),n.jsx("td",{className:"p-3 text-xs truncate max-w-[200px]",title:T.designation,children:T.designation}),n.jsx("td",{className:"p-3 text-right text-green-600 font-medium",children:T.inKg?`+${Fe(T.inKg,f.localization)}`:"-"}),n.jsx("td",{className:"p-3 text-right text-red-600 font-medium",children:T.outKg?`-${Fe(T.outKg,f.localization)}`:"-"}),n.jsx("td",{className:"p-3 text-right font-bold text-blue-600",children:Fe(T.balanceKg,f.localization)}),n.jsx("td",{className:"p-3 text-right text-gray-500 text-xs",children:T.balanceBags})]},T.id)),b.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:c("noDataForReport")})})]})]})})]})})},X2=()=>{const{t:e}=we(),{stockMovements:t,sites:s,seaweedTypes:a}=He(),{settings:i}=Ke(),[l,c]=S.useState({key:"siteName",direction:"ascending"}),[u,f]=S.useState(null),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all",date:""}),x=S.useMemo(()=>{const A=new Map;t.forEach(D=>{if(h.date&&D.date>h.date||h.siteId!=="all"&&D.siteId!==h.siteId||h.seaweedTypeId!=="all"&&D.seaweedTypeId!==h.seaweedTypeId)return;const U=`${D.siteId}|${D.seaweedTypeId}`,O=A.get(U)||{kg:0,bags:0};O.kg+=(D.inKg||0)-(D.outKg||0),O.bags+=(D.inBags||0)-(D.outBags||0),A.set(U,O)});const M=new Map(s.map(D=>[D.id,D.name])),I=new Map(a.map(D=>[D.id,D])),P=[];return A.forEach((D,U)=>{if(D.kg>.01||D.bags>0){const[O,F]=U.split("|"),q=M.get(O)||e("unknown"),z=I.get(F),Y=(z==null?void 0:z.name)||e("unknown"),J=D.kg*((z==null?void 0:z.dryPrice)||0);P.push({siteId:O,siteName:q,seaweedTypeId:F,seaweedTypeName:Y,kg:D.kg,bags:D.bags,value:J})}}),P},[t,s,a,e,h]),y=S.useMemo(()=>[...x].sort((A,M)=>{const I=A[l.key],P=M[l.key];return typeof I=="string"&&typeof P=="string"?l.direction==="ascending"?I.localeCompare(P):P.localeCompare(I):I<P?l.direction==="ascending"?-1:1:I>P?l.direction==="ascending"?1:-1:0}),[x,l]),b=S.useMemo(()=>({totalKg:x.reduce((A,M)=>A+M.kg,0),totalValue:x.reduce((A,M)=>A+M.value,0),distinctItems:x.length}),[x]),T=A=>{let M="ascending";l.key===A&&l.direction==="ascending"&&(M="descending"),c({key:A,direction:M})},_=A=>l.key!==A?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):l.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),j=({sortKey:A,label:M,className:I})=>n.jsx("th",{className:`p-3 ${I}`,children:n.jsxs("button",{onClick:()=>T(A),className:`group flex items-center gap-2 w-full ${I!=null&&I.includes("text-right")?"justify-end":""}`,children:[M,_(A)]})}),E=(A,M)=>{m(I=>({...I,[A]:M}))},k=()=>{m({siteId:"all",seaweedTypeId:"all",date:""})},C=()=>{const A=y.map(P=>({site:P.siteName,seaweedType:P.seaweedTypeName,kg:P.kg,bags:P.bags,value:P.value})),M=[{header:e("site"),key:"site",width:25},{header:e("seaweedType"),key:"seaweedType",width:20},{header:`${e("stockKg")}`,key:"kg",width:15},{header:e("stockBags"),key:"bags",width:15},{header:e("value"),key:"value",width:20}],I=h.date||new Date().toISOString().split("T")[0];Pi(A,M,`OnSite_Stock_${I}`,"Stock Status")};return n.jsxs("div",{children:[n.jsx(Ge,{className:"mb-6",title:e("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[n.jsxs(ke,{label:e("site"),value:h.siteId,onChange:A=>E("siteId",A.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),s.filter(A=>A.id!=="pressing-warehouse").map(A=>n.jsx("option",{value:A.id,children:A.name},A.id))]}),n.jsxs(ke,{label:e("seaweedType"),value:h.seaweedTypeId,onChange:A=>E("seaweedTypeId",A.target.value),children:[n.jsx("option",{value:"all",children:e("allSeaweedTypes")}),a.map(A=>n.jsx("option",{value:A.id,children:A.name},A.id))]}),n.jsx(de,{label:e("stockHistory")+" ("+e("date")+")",type:"date",value:h.date,onChange:A=>E("date",A.target.value),placeholder:"Current"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(se,{variant:"secondary",onClick:k,className:"h-[42px] flex-1",children:e("clearFilters")}),n.jsxs(se,{onClick:C,variant:"secondary",className:"h-[42px] flex-1",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Package",className:"w-10 h-10 text-blue-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("totalStockKgHeader")}),n.jsx("p",{className:"text-3xl font-bold",children:Fe(b.totalKg,i.localization)})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-green-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("totalStockValue")}),n.jsx("p",{className:"text-3xl font-bold",children:Ae(b.totalValue,i.localization)})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Archive",className:"w-10 h-10 text-purple-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("distinctStockItems")}),n.jsx("p",{className:"text-3xl font-bold",children:b.distinctItems})]})]})})]}),n.jsx("h3",{className:"text-lg font-semibold mb-2",children:e("stockSummaryBySiteAndType")}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 italic",children:e("clickForHistory")}),n.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:n.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[n.jsx(j,{sortKey:"siteName",label:e("site")}),n.jsx(j,{sortKey:"seaweedTypeName",label:e("seaweedType")}),n.jsx(j,{sortKey:"kg",label:e("stockKg"),className:"text-right"}),n.jsx(j,{sortKey:"bags",label:e("stockBags"),className:"text-right"}),n.jsx(j,{sortKey:"value",label:e("value"),className:"text-right"})]})}),n.jsx("tbody",{children:y.map(A=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors cursor-pointer",onClick:()=>f(A),children:[n.jsx("td",{className:"p-3 font-semibold",children:A.siteName}),n.jsx("td",{className:"p-3",children:A.seaweedTypeName}),n.jsx("td",{className:"p-3 text-right",children:Fe(A.kg,i.localization)}),n.jsx("td",{className:"p-3 text-right",children:Fe(A.bags,{...i.localization,nonMonetaryDecimals:0})}),n.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(A.value,i.localization)})]},`${A.siteId}-${A.seaweedTypeId}`))})]}),y.length===0&&n.jsx("p",{className:"text-center p-8 text-gray-500",children:e("noStockData")})]}),u&&n.jsx(Y2,{isOpen:!!u,onClose:()=>f(null),siteId:u.siteId,siteName:u.siteName,seaweedTypeId:u.seaweedTypeId,seaweedTypeName:u.seaweedTypeName})]})},Q2=({isOpen:e,onClose:t})=>{const{t:s}=we(),{sites:a,seaweedTypes:i,addStockMovement:l}=He(),[c,u]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",direction:"in",kg:"",bags:"",designation:""}),[f,h]=S.useState({});S.useEffect(()=>{var b,T;e&&(u({date:new Date().toISOString().split("T")[0],siteId:((b=a.find(_=>_.id!=="pressing-warehouse"))==null?void 0:b.id)||"",seaweedTypeId:((T=i[0])==null?void 0:T.id)||"",direction:"in",kg:"",bags:"",designation:""}),h({}))},[e,a,i]);const m=S.useCallback(()=>{const b={};c.designation.trim()||(b.designation=s("validationRequired"));const T=parseFloat(c.kg),_=parseInt(c.bags,10);if(!c.kg&&!c.bags||isNaN(T)&&isNaN(_)){const j=s("validationAtLeastOneRequired");b.kg=j,b.bags=j}return c.kg&&(isNaN(T)||T<=0)&&(b.kg=s("validationPositiveNumber")),c.bags&&(isNaN(_)||_<=0)&&(b.bags=s("validationPositiveNumber")),b},[c,s]);S.useEffect(()=>{h(m())},[c,m]);const x=()=>{const b=m();if(Object.keys(b).length>0){h(b);return}l({date:c.date,siteId:c.siteId,seaweedTypeId:c.seaweedTypeId,type:c.direction==="in"?ss.ADJUSTMENT_IN:ss.ADJUSTMENT_OUT,designation:c.designation,inKg:c.direction==="in"&&parseFloat(c.kg)||void 0,outKg:c.direction==="out"&&parseFloat(c.kg)||void 0,inBags:c.direction==="in"&&parseInt(c.bags)||void 0,outBags:c.direction==="out"&&parseInt(c.bags)||void 0}),t()},y=Object.keys(f).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:s("recordStockAdjustment"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:s("cancel")}),n.jsx(se,{onClick:x,disabled:y,children:s("save")})]}),children:n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx(de,{label:s("date"),type:"date",value:c.date,onChange:b=>u(T=>({...T,date:b.target.value}))}),n.jsx(ke,{label:s("site"),value:c.siteId,onChange:b=>u(T=>({...T,siteId:b.target.value})),children:a.filter(b=>b.id!=="pressing-warehouse").map(b=>n.jsx("option",{value:b.id,children:b.name},b.id))}),n.jsx(ke,{label:s("seaweedType"),value:c.seaweedTypeId,onChange:b=>u(T=>({...T,seaweedTypeId:b.target.value})),children:i.map(b=>n.jsx("option",{value:b.id,children:b.name},b.id))}),n.jsxs(ke,{label:s("direction"),value:c.direction,onChange:b=>u(T=>({...T,direction:b.target.value})),children:[n.jsx("option",{value:"in",children:s("in")}),n.jsx("option",{value:"out",children:s("out")})]}),n.jsx(de,{label:s("kg"),type:"number",step:"any",value:c.kg,onChange:b=>u(T=>({...T,kg:b.target.value})),error:f.kg}),n.jsx(de,{label:s("bags"),type:"number",value:c.bags,onChange:b=>u(T=>({...T,bags:b.target.value})),error:f.bags}),n.jsx(de,{containerClassName:"col-span-2",label:s("reasonForAdjustment"),value:c.designation,onChange:b=>u(T=>({...T,designation:b.target.value})),required:!0,error:f.designation})]})})},Z2=()=>{var T,_;const{t:e}=we(),{stockMovements:t,sites:s,seaweedTypes:a}=He(),{settings:i}=Ke(),[l,c]=S.useState({siteId:((T=s.find(j=>j.id!=="pressing-warehouse"))==null?void 0:T.id)||"",seaweedTypeId:((_=a[0])==null?void 0:_.id)||"",startDate:"",endDate:""}),[u,f]=S.useState({key:"date",direction:"descending"}),h=j=>{let E="ascending";u.key===j&&u.direction==="ascending"&&(E="descending"),f({key:j,direction:E})},m=j=>u.key!==j?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):u.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),x=(j,E)=>{c(k=>({...k,[j]:E}))},y=S.useMemo(()=>{if(!l.siteId||!l.seaweedTypeId)return[];const j=t.filter(M=>M.siteId===l.siteId&&M.seaweedTypeId===l.seaweedTypeId).sort((M,I)=>new Date(M.date).getTime()-new Date(I.date).getTime()||M.id.localeCompare(I.id));let E=0,k=0;const A=j.map(M=>(E+=(M.inKg||0)-(M.outKg||0),k+=(M.inBags||0)-(M.outBags||0),{...M,balanceKg:E,balanceBags:k})).filter(M=>!(l.startDate&&M.date<l.startDate||l.endDate&&M.date>l.endDate));return A.sort((M,I)=>{const P=M[u.key]??"",D=I[u.key]??"";let U=0;return typeof P=="string"&&typeof D=="string"?U=P.localeCompare(D):typeof P=="number"&&typeof D=="number"&&(U=P-D),U!==0?u.direction==="ascending"?U:-U:u.key!=="date"?new Date(I.date).getTime()-new Date(M.date).getTime():0}),A},[t,l.siteId,l.seaweedTypeId,l.startDate,l.endDate,u]),b=async()=>{var A,M;const j=y.map(I=>({date:I.date,type:e(`stockMovement_${I.type}`),designation:I.designation,inKg:I.inKg||0,inBags:I.inBags||0,outKg:I.outKg||0,outBags:I.outBags||0,balanceKg:I.balanceKg,balanceBags:I.balanceBags})).reverse(),E=[{header:e("date"),key:"date",width:15},{header:e("movementType"),key:"type",width:25},{header:e("designation"),key:"designation",width:40},{header:`${e("in")} (${e("kg")})`,key:"inKg",width:15},{header:`${e("in")} (${e("bags")})`,key:"inBags",width:15},{header:`${e("out")} (${e("kg")})`,key:"outKg",width:15},{header:`${e("out")} (${e("bags")})`,key:"outBags",width:15},{header:`${e("balance")} (${e("kg")})`,key:"balanceKg",width:15},{header:`${e("balance")} (${e("bags")})`,key:"balanceBags",width:15}],k=((A=s.find(I=>I.id===l.siteId))==null?void 0:A.name)||l.siteId,C=((M=a.find(I=>I.id===l.seaweedTypeId))==null?void 0:M.name)||l.seaweedTypeId;await Pi(j,E,`Stock_Movement_${k}_${C}_${new Date().toISOString().split("T")[0]}`,"Stock Movements")};return n.jsxs("div",{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4 items-end",children:[n.jsx(ke,{label:e("site"),value:l.siteId,onChange:j=>x("siteId",j.target.value),children:s.filter(j=>j.id!=="pressing-warehouse").map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))}),n.jsx(ke,{label:e("seaweedType"),value:l.seaweedTypeId,onChange:j=>x("seaweedTypeId",j.target.value),children:a.map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))}),n.jsx(de,{label:e("startDate"),type:"date",value:l.startDate,onChange:j=>x("startDate",j.target.value)}),n.jsx(de,{label:e("endDate"),type:"date",value:l.endDate,onChange:j=>x("endDate",j.target.value)}),n.jsxs(se,{onClick:b,variant:"secondary",className:"h-[42px]",disabled:y.length===0,children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]})]}),n.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsxs("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:[n.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[n.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:n.jsxs("button",{onClick:()=>h("date"),className:"group flex items-center gap-2 w-full",children:[e("date")," ",m("date")]})}),n.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:n.jsxs("button",{onClick:()=>h("type"),className:"group flex items-center gap-2 w-full",children:[e("movementType")," ",m("type")]})}),n.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:n.jsxs("button",{onClick:()=>h("designation"),className:"group flex items-center gap-2 w-full",children:[e("designation")," ",m("designation")]})}),n.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:e("in")}),n.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:e("out")}),n.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:e("balance")})]}),n.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("inKg"),className:"group flex items-center justify-center gap-2 w-full",children:[e("kg")," ",m("inKg")]})}),n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("inBags"),className:"group flex items-center justify-center gap-2 w-full",children:[e("bags")," ",m("inBags")]})}),n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("outKg"),className:"group flex items-center justify-center gap-2 w-full",children:[e("kg")," ",m("outKg")]})}),n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("outBags"),className:"group flex items-center justify-center gap-2 w-full",children:[e("bags")," ",m("outBags")]})}),n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("balanceKg"),className:"group flex items-center justify-center gap-2 w-full",children:[e("kg")," ",m("balanceKg")]})}),n.jsx("th",{className:"p-3 text-center",children:n.jsxs("button",{onClick:()=>h("balanceBags"),className:"group flex items-center justify-center gap-2 w-full",children:[e("bags")," ",m("balanceBags")]})})]})]}),n.jsx("tbody",{children:y.map(j=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[n.jsx("td",{className:"p-3 whitespace-nowrap",children:j.date}),n.jsx("td",{className:"p-3 whitespace-nowrap",children:e(`stockMovement_${j.type}`)}),n.jsx("td",{className:"p-3",children:j.designation}),n.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:j.inKg?`+${Fe(j.inKg,i.localization)}`:""}),n.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:j.inBags?`+${j.inBags}`:""}),n.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:j.outKg?`-${Fe(j.outKg,i.localization)}`:""}),n.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:j.outBags?`-${j.outBags}`:""}),n.jsx("td",{className:"p-3 text-right font-bold",children:Fe(j.balanceKg,i.localization)}),n.jsx("td",{className:"p-3 text-right font-bold",children:j.balanceBags})]},j.id))})]}),y.length===0&&n.jsx("p",{className:"text-center p-8 text-gray-500",children:e("noDataForReport")})]})]})},eP=()=>{const{t:e}=we(),[t,s]=S.useState("status"),[a,i]=S.useState(!1);return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("onSiteStorageTitle")}),n.jsxs(se,{onClick:()=>i(!0),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("recordMovement")]})]}),n.jsxs(Ge,{children:[n.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[n.jsx("button",{onClick:()=>s("status"),className:`py-2 px-4 text-sm font-medium ${t==="status"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("stockStatus")}),n.jsx("button",{onClick:()=>s("transfer"),className:`py-2 px-4 text-sm font-medium ${t==="transfer"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("normalTransfer")}),n.jsx("button",{onClick:()=>s("history"),className:`py-2 px-4 text-sm font-medium ${t==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("movementHistory")})]}),t==="status"&&n.jsx(X2,{}),t==="transfer"&&n.jsx(J2,{}),t==="history"&&n.jsx(Z2,{})]}),n.jsx(Q2,{isOpen:a,onClose:()=>i(!1)})]})},tP=({isOpen:e,onClose:t,farmer:s})=>{const{t:a}=we(),{sites:i}=He(),l=i.find(u=>u.id===s.siteId),c=({label:u,value:f})=>n.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[n.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:u}),n.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:f||"N/A"})]});return n.jsx(ot,{isOpen:e,onClose:t,title:`${a("farmer")}: ${s.firstName} ${s.lastName} (${s.code})`,widthClass:"max-w-3xl",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(c,{label:a("firstName"),value:s.firstName}),n.jsx(c,{label:a("lastName"),value:s.lastName}),n.jsx(c,{label:a("code"),value:s.code}),n.jsx(c,{label:a("gender"),value:a(`gender_${s.gender}`)}),n.jsx(c,{label:a("dob"),value:s.dob}),n.jsx(c,{label:a("birthPlace"),value:s.birthPlace}),n.jsx(c,{label:a("idNumber"),value:s.idNumber}),n.jsx(c,{label:a("address"),value:s.address}),n.jsx(c,{label:a("site"),value:l==null?void 0:l.name}),n.jsx(c,{label:a("maritalStatus"),value:a(`maritalStatus_${s.maritalStatus}`)}),n.jsx(c,{label:a("nationality"),value:s.nationality}),n.jsx(c,{label:a("parentsInfo"),value:s.parentsInfo})]})})},TN=({isOpen:e,onClose:t,onAssign:s,sites:a,selectedCount:i})=>{var h;const{t:l}=we(),[c,u]=S.useState(((h=a[0])==null?void 0:h.id)||""),f=()=>{c&&s(c)};return n.jsx(ot,{isOpen:e,onClose:t,title:l("assignSiteTitle"),widthClass:"max-w-md",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:l("cancel")}),n.jsx(se,{onClick:f,disabled:!c,children:l("assign")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{children:l("itemsSelected").replace("{count}",String(i))}),n.jsx(ke,{label:l("site"),value:c,onChange:m=>u(m.target.value),children:a.map(m=>n.jsx("option",{value:m.id,children:m.name},m.id))})]})})},nP=({isOpen:e,onClose:t,preselectedFarmerIds:s=[]})=>{const{t:a,language:i}=we(),{sites:l,farmers:c,addMessageLog:u,messageLogs:f}=He(),{currentUser:h}=Rs(),[m,x]=S.useState("compose"),[y,b]=S.useState(s.length>0?"SELECTED":"ALL"),[T,_]=S.useState(""),[j,E]=S.useState("SMS"),[k,C]=S.useState(""),[A,M]=S.useState(!1);S.useEffect(()=>{e&&(s.length>0?b("SELECTED"):b("ALL"),C(""),M(!1),x("compose"))},[e,s]);const I=S.useMemo(()=>{switch(y){case"ALL":return c;case"SITE":return c.filter(D=>D.siteId===T);case"SELECTED":return c.filter(D=>s.includes(D.id));default:return[]}},[y,T,c,s]),P=async()=>{if(!k.trim())return;M(!0),await new Promise(U=>setTimeout(U,1500));const D={date:new Date().toISOString(),senderId:(h==null?void 0:h.id)||"unknown",recipientCount:I.length,filterType:y,filterValue:y==="SITE"?T:void 0,channel:j,content:k,status:"SENT"};u(D),M(!1),alert(a("messageSentSuccess")),t()};return n.jsxs(ot,{isOpen:e,onClose:t,title:a("broadcastTitle"),widthClass:"max-w-4xl",footer:m==="compose"?n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:a("cancel")}),n.jsxs(se,{onClick:P,disabled:A||I.length===0||!k.trim(),children:[n.jsx(te,{name:"Send",className:`w-4 h-4 mr-2 ${A?"animate-spin":""}`}),a(A?"sending":"sendMessage")]})]}):n.jsx(se,{variant:"secondary",onClick:t,children:a("close")}),children:[n.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:n.jsxs("nav",{className:"-mb-px flex space-x-8",children:[n.jsx("button",{onClick:()=>x("compose"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="compose"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a("composeMessage")}),n.jsx("button",{onClick:()=>x("history"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a("messageHistory")})]})}),m==="compose"&&n.jsx("div",{className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs(ke,{label:a("recipientScope"),value:y,onChange:D=>b(D.target.value),children:[n.jsx("option",{value:"ALL",children:a("scope_ALL")}),n.jsx("option",{value:"SITE",children:a("scope_SITE")}),n.jsxs("option",{value:"SELECTED",disabled:s.length===0,children:[a("scope_SELECTED")," (",s.length,")"]})]}),y==="SITE"&&n.jsxs(ke,{label:a("site"),value:T,onChange:D=>_(D.target.value),children:[n.jsx("option",{value:"",children:a("selectSite")}),l.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))]}),n.jsxs(ke,{label:a("channel"),value:j,onChange:D=>E(D.target.value),children:[n.jsx("option",{value:"SMS",children:a("channel_SMS")}),n.jsx("option",{value:"WHATSAPP",children:a("channel_WHATSAPP")})]}),n.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[n.jsxs("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:[a("recipient")," Count: ",n.jsx("span",{className:"font-bold text-lg",children:I.length})]}),n.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"Farmers with valid phone numbers will receive this message."})]})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("messageContent")}),n.jsx("textarea",{className:"w-full flex-grow p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none resize-none",placeholder:"Type your message here...",value:k,onChange:D=>C(D.target.value),maxLength:j==="SMS"?160:1e3,rows:6}),n.jsxs("div",{className:"text-right text-xs text-gray-500 mt-1",children:[a("charCount").replace("{count}",String(k.length))," / ",j==="SMS"?160:1e3]})]})]})}),m==="history"&&n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:a("date")}),n.jsx("th",{className:"p-3",children:a("channel")}),n.jsx("th",{className:"p-3",children:a("recipient")}),n.jsx("th",{className:"p-3",children:a("messageContent")}),n.jsx("th",{className:"p-3",children:a("status")})]})}),n.jsx("tbody",{children:f.length>0?f.slice().reverse().map(D=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3 whitespace-nowrap",children:new Date(D.date).toLocaleString()}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${D.channel==="WHATSAPP"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:D.channel})}),n.jsxs("td",{className:"p-3",children:[D.recipientCount," Farmers (",D.filterType,")"]}),n.jsx("td",{className:"p-3 truncate max-w-xs",title:D.content,children:D.content}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:"text-green-600 font-semibold",children:D.status})})]},D.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"p-6 text-center text-gray-500",children:a("noHistory")})})})]})})]})},sP=({isOpen:e,onClose:t,farmer:s,onConfirm:a})=>{const{t:i}=we(),[l,c]=S.useState(new Date().toISOString().split("T")[0]),[u,f]=S.useState(""),[h,m]=S.useState(""),x=()=>{if(!l||!u.trim()){m(i("validationRequired"));return}a(s.id,l,u),t()};return n.jsx(ot,{isOpen:e,onClose:t,title:i("confirmFire"),widthClass:"max-w-md",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{variant:"danger",onClick:x,children:i("fire")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i("confirmFireMessage").replace("{name}",`${s.firstName} ${s.lastName}`)}),n.jsx(de,{label:i("exitDate"),type:"date",value:l,onChange:y=>c(y.target.value),required:!0}),n.jsx(de,{label:i("exitReason"),value:u,onChange:y=>f(y.target.value),placeholder:"e.g. Resignation, Performance, Relocation...",required:!0,error:h})]})})},aP=()=>{const{farmers:e,sites:t,addFarmer:s,updateFarmer:a,deleteFarmer:i,deleteMultipleFarmers:l,updateFarmersSite:c}=He(),{t:u}=we(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[y,b]=S.useState(!1),[T,_]=S.useState(null),[j,E]=S.useState(null),[k,C]=S.useState({key:"code",direction:"ascending"}),[A,M]=S.useState([]),[I,P]=S.useState(!1),[D,U]=S.useState(!1),[O,F]=S.useState(!1),[q,z]=S.useState(Hs.ACTIVE),[Y,J]=S.useState(!1),[G,B]=S.useState(null),Q=S.useMemo(()=>new Map(t.map(Se=>[Se.id,Se.name])),[t]),W=S.useMemo(()=>q==="ALL"?e:e.filter(Se=>Se.status===q),[e,q]),ae=S.useMemo(()=>{let Se=[...W];return Se.sort((Le,be)=>{let ye,Ue;return k.key==="siteName"?(ye=Q.get(Le.siteId)||"",Ue=Q.get(be.siteId)||""):(ye=Le[k.key],Ue=be[k.key]),ye<Ue?k.direction==="ascending"?-1:1:ye>Ue?k.direction==="ascending"?1:-1:0}),Se},[W,k,Q]),$=Se=>{let Le="ascending";k.key===Se&&k.direction==="ascending"&&(Le="descending"),C({key:Se,direction:Le})},ie=Se=>k.key!==Se?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):k.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ue=({sortKey:Se,label:Le})=>n.jsx("th",{className:"p-3",children:n.jsxs("button",{onClick:()=>$(Se),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[Le,ie(Se)]})}),Ne=(Se=null)=>{x(Se),h(!0)},le=()=>{x(null),h(!1)},ne=()=>{T&&i(T),b(!1),_(null)},je=Se=>{B(Se),J(!0)},fe=(Se,Le,be)=>{G&&(a({...G,status:Hs.INACTIVE,exitDate:Le,exitReason:be}),B(null))},Z=Se=>{a({...Se,status:Hs.ACTIVE,joinDate:new Date().toISOString().split("T")[0],exitDate:void 0,exitReason:void 0})},ee=Se=>{E(Se)},xe=()=>{E(null)},Oe=Se=>{Se.target.checked?M(ae.map(Le=>Le.id)):M([])},De=(Se,Le)=>{Se.target.checked?M(be=>[...be,Le]):M(be=>be.filter(ye=>ye!==Le))},Re=()=>{P(!0)},Ve=()=>{l(A),M([]),P(!1)},ze=Se=>{c(A,Se),M([]),U(!1)};return n.jsxs("div",{className:"pb-20",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:u("farmerManagementTitle")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:()=>{M([]),F(!0)},children:[n.jsx(te,{name:"Bell",className:"w-5 h-5 mr-2"}),u("broadcastMessage")]}),n.jsxs(se,{onClick:()=>Ne(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),u("addFarmer")]})]})]}),n.jsx(Ge,{className:"mb-6",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("span",{className:"text-sm font-medium",children:[u("status"),":"]}),n.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[n.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="ACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-green-700 dark:text-green-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z(Hs.ACTIVE),children:u("status_ACTIVE")}),n.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="INACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-red-700 dark:text-red-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z(Hs.INACTIVE),children:u("status_INACTIVE")}),n.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="ALL"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z("ALL"),children:u("all")})]})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{checked:ae.length>0&&A.length===ae.length,onChange:Oe,"aria-label":u("selectAllFarmers")})}),n.jsx("th",{className:"p-3 w-20",children:u("status")}),n.jsx(ue,{sortKey:"code",label:u("code")}),n.jsx(ue,{sortKey:"firstName",label:u("firstName")}),n.jsx(ue,{sortKey:"lastName",label:u("lastName")}),n.jsx(ue,{sortKey:"siteName",label:u("site")}),n.jsx(ue,{sortKey:"joinDate",label:u("joinDate")}),n.jsx("th",{className:"p-3 text-right",children:u("actions")})]})}),n.jsx("tbody",{children:ae.map(Se=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:A.includes(Se.id),onChange:Le=>De(Le,Se.id),"aria-label":u("selectFarmerNamed").replace("{name}",`${Se.firstName} ${Se.lastName}`)})}),n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:Se.status})}),n.jsx("td",{className:"p-3 font-mono",children:Se.code}),n.jsx("td",{className:"p-3 font-semibold",children:n.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.firstName})}),n.jsx("td",{className:"p-3 font-semibold",children:n.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.lastName})}),n.jsx("td",{className:"p-3",children:Q.get(Se.siteId)||u("unknown")}),n.jsx("td",{className:"p-3 text-xs",children:Se.joinDate}),n.jsx("td",{className:"p-3",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(se,{variant:"ghost",onClick:()=>Ne(Se),children:n.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),Se.status===Hs.ACTIVE?n.jsx(se,{variant:"danger",onClick:()=>je(Se),title:u("fireFarmer"),children:n.jsx(te,{name:"LogOut",className:"w-4 h-4"})}):n.jsx(se,{variant:"secondary",onClick:()=>Z(Se),title:u("hireFarmer"),children:n.jsx(te,{name:"UserPlus",className:"w-4 h-4"})})]})})]},Se.id))})]})})}),A.length>0&&n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 ml-16",children:[n.jsx("span",{className:"font-semibold",children:u("itemsSelected").replace("{count}",String(A.length))}),n.jsxs(se,{onClick:()=>U(!0),children:[n.jsx(te,{name:"MapPin",className:"w-4 h-4 mr-2"}),u("assignSite")]}),n.jsxs(se,{onClick:()=>F(!0),variant:"secondary",children:[n.jsx(te,{name:"Bell",className:"w-4 h-4 mr-2"}),u("broadcastMessage")]}),n.jsxs(se,{variant:"danger",onClick:Re,children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),u("deleteSelected")]})]}),f&&n.jsx(rP,{isOpen:f,onClose:le,farmer:m,onSave:Se=>{m?a({...m,...Se}):s(Se),le()}}),Y&&G&&n.jsx(sP,{isOpen:Y,onClose:()=>J(!1),farmer:G,onConfirm:fe}),O&&n.jsx(nP,{isOpen:O,onClose:()=>F(!1),preselectedFarmerIds:A}),y&&n.jsx(zt,{isOpen:y,onClose:()=>b(!1),onConfirm:ne,title:u("confirmDeleteTitle"),message:u("confirmDeleteFarmer")}),I&&n.jsx(zt,{isOpen:I,onClose:()=>P(!1),onConfirm:Ve,title:u("confirmBulkDeleteTitle"),message:u("confirmBulkDeleteFarmers").replace("{count}",String(A.length))}),D&&n.jsx(TN,{isOpen:D,onClose:()=>U(!1),onAssign:ze,sites:t,selectedCount:A.length}),j&&n.jsx(tP,{isOpen:!!j,onClose:xe,farmer:j})]})},rP=({isOpen:e,onClose:t,farmer:s,onSave:a})=>{const{t:i}=we(),{sites:l}=He(),[c,u]=S.useState({firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:Hs.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}),[f,h]=S.useState(""),[m,x]=S.useState({}),y=S.useMemo(()=>{var E;return{firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:((E=l[0])==null?void 0:E.id)||"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:Hs.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}},[l]),b=S.useCallback(E=>{const k={};return E.firstName.trim()||(k.firstName=i("validationRequired")),E.lastName.trim()||(k.lastName=i("validationRequired")),E.siteId||(k.siteId=i("validationRequired")),E.joinDate||(k.joinDate=i("validationRequired")),k},[i]);S.useEffect(()=>{if(s){const{code:E,id:k,...C}=s;u(C),h(E)}else u(y),h("")},[s,y,e]),S.useEffect(()=>{if(!s&&c.firstName&&c.lastName){const E=(c.firstName.substring(0,1)+c.lastName.substring(0,2)).toUpperCase();h(E)}},[c.firstName,c.lastName,s]),S.useEffect(()=>{x(b(c))},[c,b]);const T=(E,k)=>{u(C=>({...C,[E]:k}))},_=E=>{E.preventDefault();const k=b(c);Object.keys(k).length===0?a({...c,code:f}):x(k)},j=Object.keys(m).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editFarmer":"addFarmer"),widthClass:"max-w-4xl",children:n.jsxs("form",{onSubmit:_,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(de,{label:i("firstName"),value:c.firstName,onChange:E=>T("firstName",E.target.value),error:m.firstName,required:!0}),n.jsx(de,{label:i("lastName"),value:c.lastName,onChange:E=>T("lastName",E.target.value),error:m.lastName,required:!0}),n.jsx(de,{label:i("code"),value:f,disabled:!0}),n.jsxs(ke,{label:i("gender"),value:c.gender,onChange:E=>T("gender",E.target.value),children:[n.jsx("option",{value:"Male",children:i("gender_Male")}),n.jsx("option",{value:"Female",children:i("gender_Female")}),n.jsx("option",{value:"Other",children:i("gender_Other")})]}),n.jsxs(ke,{label:i("maritalStatus"),value:c.maritalStatus,onChange:E=>T("maritalStatus",E.target.value),children:[n.jsx("option",{value:"Single",children:i("maritalStatus_Single")}),n.jsx("option",{value:"Married",children:i("maritalStatus_Married")}),n.jsx("option",{value:"Divorced",children:i("maritalStatus_Divorced")}),n.jsx("option",{value:"Widowed",children:i("maritalStatus_Widowed")})]}),n.jsxs(ke,{label:i("site"),value:c.siteId,onChange:E=>T("siteId",E.target.value),error:m.siteId,required:!0,children:[n.jsx("option",{value:"",children:i("selectSite")}),l.map(E=>n.jsx("option",{value:E.id,children:E.name},E.id))]}),n.jsx(de,{label:i("joinDate"),type:"date",value:c.joinDate,onChange:E=>T("joinDate",E.target.value),required:!0,error:m.joinDate}),n.jsx(de,{label:i("phoneNumber"),type:"tel",value:c.phone||"",onChange:E=>T("phone",E.target.value),placeholder:"+261..."}),n.jsx(de,{label:i("dob"),value:c.dob,onChange:E=>T("dob",E.target.value),placeholder:"e.g. 1990-05-15 or Circa 1981"}),n.jsx(de,{label:i("birthPlace"),value:c.birthPlace,onChange:E=>T("birthPlace",E.target.value)}),n.jsx(de,{label:i("nationality"),value:c.nationality,onChange:E=>T("nationality",E.target.value)}),n.jsx(de,{containerClassName:"md:col-span-3",label:i("idNumber"),value:c.idNumber,onChange:E=>T("idNumber",E.target.value)}),n.jsx(de,{containerClassName:"md:col-span-3",label:i("address"),value:c.address,onChange:E=>T("address",E.target.value)}),n.jsx(de,{containerClassName:"md:col-span-3",label:i("parentsInfo"),value:c.parentsInfo,onChange:E=>T("parentsInfo",E.target.value)})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",disabled:j,children:i("save")})]})]})})},iP=({isOpen:e,onClose:t,employee:s})=>{const{t:a}=we(),{sites:i}=He(),{settings:l}=Ke(),c=i.find(f=>f.id===s.siteId),u=({label:f,value:h})=>n.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[n.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:f}),n.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:h||"N/A"})]});return n.jsx(ot,{isOpen:e,onClose:t,title:`${a("employeeProfile")}: ${s.firstName} ${s.lastName}`,widthClass:"max-w-3xl",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(u,{label:a("firstName"),value:s.firstName}),n.jsx(u,{label:a("lastName"),value:s.lastName}),n.jsx(u,{label:a("code"),value:s.code}),n.jsx(u,{label:a("employeeType"),value:n.jsx(vn,{status:s.employeeType})}),n.jsx(u,{label:a("role"),value:s.role}),n.jsx(u,{label:a("category"),value:s.category}),n.jsx(u,{label:a("team"),value:s.team}),n.jsx(u,{label:a("grossWage"),value:Ae(s.grossWage,l.localization)}),n.jsx(u,{label:a("site"),value:c==null?void 0:c.name}),n.jsx(u,{label:a("email"),value:s.email}),n.jsx(u,{label:a("phone"),value:s.phone}),n.jsx(u,{label:a("hireDate"),value:s.hireDate})]})})},oP=({currentPage:e,totalPages:t,onPageChange:s,itemsPerPage:a,totalItems:i,onItemsPerPageChange:l})=>{const{t:c}=we(),u=i===0?0:(e-1)*a+1,f=Math.min(e*a,i),h=()=>{const m=[];if(t<=7)for(let x=1;x<=t;x++)m.push(x);else m.push(1),e>3&&m.push("..."),e>2&&m.push(e-1),e!==1&&e!==t&&m.push(e),e<t-1&&m.push(e+1),e<t-2&&m.push("..."),m.push(t);return[...new Set(m)]};return t<=1&&i<=a?null:n.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between mt-4 text-sm text-gray-600 dark:text-gray-400",children:[n.jsxs("div",{className:"mb-2 md:mb-0",children:[c("pagination.showing")," ",u,"-",f," ",c("pagination.of")," ",i," ",c("pagination.results")]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{children:[c("pagination.itemsPerPage"),":"]}),n.jsxs(ke,{value:a,onChange:m=>l(Number(m.target.value)),className:"!w-20",children:[n.jsx("option",{value:10,children:"10"}),n.jsx("option",{value:25,children:"25"}),n.jsx("option",{value:50,children:"50"}),n.jsx("option",{value:100,children:"100"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>s(e-1),disabled:e===1,className:"!px-2","aria-label":c("pagination.previous"),children:[n.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"}),n.jsx("span",{className:"hidden sm:inline",children:c("pagination.previous")})]}),n.jsx("div",{className:"flex items-center gap-1",children:h().map((m,x)=>typeof m=="number"?n.jsx(se,{variant:e===m?"primary":"ghost",onClick:()=>s(m),className:"!px-3 !py-1","aria-label":`Go to page ${m}`,"aria-current":e===m?"page":void 0,children:m},x):n.jsx("span",{className:"px-2 py-1",children:"..."},x))}),n.jsxs(se,{variant:"ghost",onClick:()=>s(e+1),disabled:e===t||t===0,className:"!px-2","aria-label":c("pagination.next"),children:[n.jsx("span",{className:"hidden sm:inline",children:c("pagination.next")}),n.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})]})]})]})]})},lP=({isOpen:e,onClose:t,employee:s,onSave:a})=>{const{t:i}=we(),{sites:l,roles:c}=He(),{settings:u}=Ke(),[f,h]=S.useState(!1),m=S.useMemo(()=>({firstName:"",lastName:"",employeeType:"PERMANENT",role:"",team:"",phone:"",email:"",hireDate:new Date().toISOString().split("T")[0],siteId:"",grossWage:"",category:""}),[]),[x,y]=S.useState(m),[b,T]=S.useState(""),[_,j]=S.useState({}),E=S.useCallback(M=>{const I={};M.firstName.trim()||(I.firstName=i("validationRequired")),M.lastName.trim()||(I.lastName=i("validationRequired")),M.role.trim()||(I.role=i("validationRequired")),M.category.trim()||(I.category=i("validationRequired")),M.hireDate||(I.hireDate=i("validationRequired")),M.phone.trim()||(I.phone=i("validationRequired"));const P=typeof M.grossWage=="string"?Sf(M.grossWage,u.localization):M.grossWage;return(isNaN(P)||P<=0)&&(I.grossWage=i("validationPositiveNumber")),M.email&&!/\S+@\S+\.\S+/.test(M.email)&&(I.email=i("validationEmail")),I},[i,u.localization]);S.useEffect(()=>{if(s){const{code:M,id:I,...P}=s;y({...P,team:P.team||"",siteId:P.siteId||"",grossWage:String(P.grossWage)}),T(M)}else y(m),T("")},[s,m,e]),S.useEffect(()=>{if(!s&&x.firstName&&x.lastName){const M=(x.firstName.substring(0,1)+x.lastName.substring(0,2)).toUpperCase();T(M)}},[x.firstName,x.lastName,s]),S.useEffect(()=>{j(E(x))},[x,E]);const k=(M,I)=>{y(P=>({...P,[M]:I}))},C=M=>{M.preventDefault();const I=E(x);if(Object.keys(I).length>0){j(I);return}const P={...x,code:b,siteId:x.siteId||void 0,team:x.team||void 0,grossWage:typeof x.grossWage=="string"?Sf(x.grossWage,u.localization):parseFloat(x.grossWage)||0,status:(s==null?void 0:s.status)||Wf.ACTIVE,exitDate:s==null?void 0:s.exitDate,exitReason:s==null?void 0:s.exitReason,email:x.email,phone:x.phone};a(P)},A=Object.keys(_).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editEmployee":"addEmployee"),widthClass:"max-w-3xl",children:n.jsxs("form",{onSubmit:C,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(de,{label:i("firstName"),value:x.firstName,onChange:M=>k("firstName",M.target.value),error:_.firstName,required:!0,autoFocus:!0}),n.jsx(de,{label:i("lastName"),value:x.lastName,onChange:M=>k("lastName",M.target.value),error:_.lastName,required:!0}),n.jsx(de,{label:i("code"),value:b,disabled:!0})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs(ke,{label:i("employeeType"),value:x.employeeType,onChange:M=>k("employeeType",M.target.value),children:[n.jsx("option",{value:"PERMANENT",children:i("employeeType_PERMANENT")}),n.jsx("option",{value:"CASUAL",children:i("employeeType_CASUAL")})]}),n.jsxs(ke,{label:i("role"),value:x.role,onChange:M=>k("role",M.target.value),error:_.role,required:!0,children:[n.jsx("option",{value:"",children:i("selectRole")}),c.map(M=>n.jsx("option",{value:M.name,children:M.name},M.id))]}),n.jsx(de,{label:`${i("team")} (${i("optional")})`,value:x.team,onChange:M=>k("team",M.target.value)}),n.jsx(de,{label:i("grossWage"),type:f?"number":"text",value:f?x.grossWage:Ae(parseFloat(x.grossWage)||0,u.localization),onFocus:()=>h(!0),onChange:M=>k("grossWage",M.target.value),onBlur:()=>h(!1),error:_.grossWage,required:!0}),n.jsxs(ke,{label:i("site"),value:x.siteId,onChange:M=>k("siteId",M.target.value),children:[n.jsx("option",{value:"",children:i("noSpecificSite")}),l.map(M=>n.jsx("option",{value:M.id,children:M.name},M.id))]}),n.jsx(de,{label:i("category"),value:x.category,onChange:M=>k("category",M.target.value),error:_.category,required:!0}),n.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:x.email,onChange:M=>k("email",M.target.value),error:_.email}),n.jsx(de,{label:i("phone"),type:"tel",value:x.phone,onChange:M=>k("phone",M.target.value),required:!0,error:_.phone}),n.jsx(de,{label:i("hireDate"),type:"date",value:x.hireDate,onChange:M=>k("hireDate",M.target.value),error:_.hireDate,required:!0})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{type:"submit",disabled:A,children:i("save")})]})]})})},cP=()=>{const{employees:e,sites:t,addEmployee:s,updateEmployee:a,deleteEmployee:i,deleteMultipleEmployees:l,updateEmployeesSite:c,roles:u}=He(),{t:f}=we(),[h,m]=S.useState(!1),[x,y]=S.useState(null),[b,T]=S.useState(!1),[_,j]=S.useState(null),[E,k]=S.useState(null),[C,A]=S.useState({key:"code",direction:"ascending"}),[M,I]=S.useState({name:"",siteId:"all",role:"all"}),[P,D]=S.useState([]),[U,O]=S.useState(!1),[F,q]=S.useState(!1),z=S.useRef(null),[Y,J]=S.useState(1),[G,B]=S.useState(10),Q=S.useMemo(()=>new Map(t.map(be=>[be.id,be.name])),[t]),W=S.useMemo(()=>[...new Set(e.map(be=>be.role).filter(Boolean))].sort(),[e]),ae=S.useMemo(()=>{let be=[...e];if(M.name){const ye=M.name.toLowerCase();be=be.filter(Ue=>`${Ue.firstName} ${Ue.lastName}`.toLowerCase().includes(ye)||Ue.code.toLowerCase().includes(ye))}return M.siteId!=="all"&&(be=be.filter(ye=>ye.siteId===M.siteId)),M.role!=="all"&&(be=be.filter(ye=>ye.role===M.role)),be.sort((ye,Ue)=>{let et,At;return C.key==="siteName"?(et=ye.siteId&&Q.get(ye.siteId)||"",At=Ue.siteId&&Q.get(Ue.siteId)||""):(et=ye[C.key]||"",At=Ue[C.key]||""),et<At?C.direction==="ascending"?-1:1:et>At?C.direction==="ascending"?1:-1:0}),be},[e,M,C,Q]);S.useEffect(()=>{J(1)},[M.name,M.siteId,M.role,G]);const $=S.useMemo(()=>{const be=(Y-1)*G;return ae.slice(be,be+G)},[ae,Y,G]);S.useEffect(()=>{if(z.current){const be=new Set($.map(et=>et.id)),ye=P.filter(et=>be.has(et)).length,Ue=ye===$.length&&$.length>0;z.current.checked=Ue,z.current.indeterminate=ye>0&&!Ue}},[P,$]);const ie=(be,ye)=>{I(Ue=>({...Ue,[be]:ye}))},ue=()=>{I({name:"",siteId:"all",role:"all"})},Ne=be=>{let ye="ascending";C.key===be&&C.direction==="ascending"&&(ye="descending"),A({key:be,direction:ye})},le=be=>C.key!==be?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):C.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ne=({sortKey:be,label:ye})=>n.jsx("th",{className:"p-3",children:n.jsxs("button",{onClick:()=>Ne(be),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[ye,le(be)]})}),je=(be=null)=>{y(be),m(!0)},fe=()=>{y(null),m(!1)},Z=be=>{j(be),T(!0)},ee=()=>{_&&i(_),T(!1),j(null)},xe=be=>{x?a({...x,...be}):s(be),fe()},Oe=be=>{k(be)},De=()=>{k(null)},Re=S.useCallback(be=>{const ye=$.map(Ue=>Ue.id);if(be.target.checked)D(Ue=>[...new Set([...Ue,...ye])]);else{const Ue=new Set(ye);D(et=>et.filter(At=>!Ue.has(At)))}},[$]),Ve=(be,ye)=>{be.target.checked?D(Ue=>[...Ue,ye]):D(Ue=>Ue.filter(et=>et!==ye))},ze=()=>{O(!0)},Se=()=>{l(P),D([]),O(!1)},Le=be=>{c(P,be),D([]),q(!1)};return n.jsxs("div",{className:"pb-20",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:f("employeeManagementTitle")}),n.jsxs(se,{onClick:()=>je(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),f("addEmployee")]})]}),n.jsx(Ge,{className:"mb-6",title:f("filtersTitle"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[n.jsx(de,{label:f("searchByNameOrCode"),value:M.name,onChange:be=>ie("name",be.target.value),placeholder:f("searchByNameOrCode")}),n.jsxs(ke,{label:f("site"),value:M.siteId,onChange:be=>ie("siteId",be.target.value),children:[n.jsx("option",{value:"all",children:f("allSites")}),t.map(be=>n.jsx("option",{value:be.id,children:be.name},be.id))]}),n.jsxs(ke,{label:f("role"),value:M.role,onChange:be=>ie("role",be.target.value),children:[n.jsx("option",{value:"all",children:f("allRoles")}),W.map(be=>n.jsx("option",{value:be,children:be},be))]}),n.jsx(se,{variant:"secondary",onClick:ue,className:"h-[42px]",children:f("clearFilters")})]})}),n.jsxs(Ge,{children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{ref:z,onChange:Re,"aria-label":f("selectAllEmployees")})}),n.jsx(ne,{sortKey:"code",label:f("code")}),n.jsx(ne,{sortKey:"firstName",label:f("firstName")}),n.jsx(ne,{sortKey:"lastName",label:f("lastName")}),n.jsx(ne,{sortKey:"role",label:f("role")}),n.jsx(ne,{sortKey:"team",label:f("team")}),n.jsx(ne,{sortKey:"siteName",label:f("site")}),n.jsx(ne,{sortKey:"phone",label:f("phone")}),n.jsx(ne,{sortKey:"hireDate",label:f("hireDate")}),n.jsx("th",{className:"p-3 text-right",children:f("actions")})]})}),n.jsx("tbody",{children:$.map(be=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:P.includes(be.id),onChange:ye=>Ve(ye,be.id),"aria-label":f("selectEmployeeNamed").replace("{name}",`${be.firstName} ${be.lastName}`)})}),n.jsx("td",{className:"p-3 font-mono",children:be.code}),n.jsx("td",{className:"p-3 font-semibold",children:n.jsx("button",{onClick:()=>Oe(be),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:be.firstName})}),n.jsx("td",{className:"p-3 font-semibold",children:be.lastName}),n.jsx("td",{className:"p-3",children:be.role}),n.jsx("td",{className:"p-3",children:be.team||f("none")}),n.jsx("td",{className:"p-3",children:be.siteId?Q.get(be.siteId)||f("unknown"):f("noSpecificSite")}),n.jsx("td",{className:"p-3",children:be.phone}),n.jsx("td",{className:"p-3",children:be.hireDate}),n.jsx("td",{className:"p-3",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>je(be),children:[n.jsx(te,{name:"Settings",className:"w-4 h-4"}),f("edit")]}),n.jsxs(se,{variant:"danger",onClick:()=>Z(be.id),children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("delete")]})]})})]},be.id))})]})}),ae.length===0&&n.jsx("p",{className:"text-center p-8 text-gray-500",children:f("noEmployeesMatchFilters")}),n.jsx(oP,{currentPage:Y,totalPages:Math.ceil(ae.length/G),onPageChange:J,itemsPerPage:G,totalItems:ae.length,onItemsPerPageChange:be=>{B(be),J(1)}})]}),P.length>0&&n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[n.jsx("span",{className:"font-semibold",children:f("itemsSelected").replace("{count}",String(P.length))}),n.jsxs(se,{onClick:()=>q(!0),children:[n.jsx(te,{name:"MapPin",className:"w-4 h-4"}),f("assignSite")]}),n.jsxs(se,{variant:"danger",onClick:ze,children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("deleteSelected")]})]}),h&&n.jsx(lP,{isOpen:h,onClose:fe,employee:x,onSave:xe}),b&&n.jsx(zt,{isOpen:b,onClose:()=>T(!1),onConfirm:ee,title:f("confirmDeleteTitle"),message:f("confirmDeleteEmployee")}),U&&n.jsx(zt,{isOpen:U,onClose:()=>O(!1),onConfirm:Se,title:f("confirmBulkDeleteTitle"),message:f("confirmBulkDeleteEmployees").replace("{count}",String(P.length))}),F&&n.jsx(TN,{isOpen:F,onClose:()=>q(!1),onAssign:Le,sites:t,selectedCount:P.length}),E&&n.jsx(iP,{isOpen:!!E,onClose:De,employee:E})]})},dP=({isOpen:e,onClose:t,slip:s})=>{const{t:a}=we(),{settings:i}=Ke(),{seaweedTypes:l,addPressingSlip:c,updatePressingSlip:u,pressedStockMovements:f}=He(),h=S.useCallback(()=>{var C;return{date:new Date().toISOString().split("T")[0],seaweedTypeId:((C=l[0])==null?void 0:C.id)||"",sourceSiteId:"pressing-warehouse",consumedWeightKg:"",consumedBags:"",producedWeightKg:"",producedBalesCount:""}},[l]),[m,x]=S.useState(h()),[y,b]=S.useState({});S.useEffect(()=>{e&&(x(s?{date:s.date,seaweedTypeId:s.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:String(s.consumedWeightKg),consumedBags:String(s.consumedBags),producedWeightKg:String(s.producedWeightKg),producedBalesCount:String(s.producedBalesCount)}:h()),b({}))},[e,s,h]);const T=S.useMemo(()=>{if(!m.seaweedTypeId)return{kg:0,bags:0};const C=f.filter(I=>I.seaweedTypeId===m.seaweedTypeId&&I.siteId==="pressing-warehouse");let A=0,M=0;return C.forEach(I=>{[mt.BULK_IN_FROM_SITE,mt.FARMER_DELIVERY].includes(I.type)?(A+=I.inKg||0,M+=I.inBales||0):[mt.PRESSING_CONSUMPTION].includes(I.type)&&(A-=I.outKg||0,M-=I.outBales||0)}),s&&s.seaweedTypeId===m.seaweedTypeId&&(A+=s.consumedWeightKg,M+=s.consumedBags),{kg:Math.max(0,A),bags:Math.max(0,M)}},[f,m.seaweedTypeId,s]),_=S.useCallback(()=>{const C={};m.date||(C.date=a("validationRequired")),m.seaweedTypeId||(C.seaweedTypeId=a("validationRequired"));const A=parseFloat(m.consumedWeightKg);!m.consumedWeightKg||isNaN(A)||A<=0?C.consumedWeightKg=a("validationPositiveNumber"):A>T.kg&&(C.consumedWeightKg=a("validationStockUnavailableBulk").replace("{availableStock}",Fe(T.kg,i.localization)));const M=parseInt(m.consumedBags,10);return!m.consumedBags||isNaN(M)||M<0?C.consumedBags=a("validationNonNegative"):M>T.bags&&(C.consumedBags=a("validationStockUnavailableBags").replace("{availableStock}",String(T.bags))),(!m.producedWeightKg||isNaN(parseFloat(m.producedWeightKg))||parseFloat(m.producedWeightKg)<=0)&&(C.producedWeightKg=a("validationPositiveNumber")),(!m.producedBalesCount||isNaN(parseInt(m.producedBalesCount,10))||parseInt(m.producedBalesCount,10)<=0)&&(C.producedBalesCount=a("validationPositiveNumber")),C},[m,a,T,i.localization]);S.useEffect(()=>{b(_())},[m,_]);const j=(C,A)=>{x(M=>({...M,[C]:A}))},E=C=>{C.preventDefault();const A=_();if(Object.keys(A).length>0){b(A);return}const M={date:m.date,seaweedTypeId:m.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:parseFloat(m.consumedWeightKg),consumedBags:parseInt(m.consumedBags,10)||0,producedWeightKg:parseFloat(m.producedWeightKg),producedBalesCount:parseInt(m.producedBalesCount,10)};s?u({...s,...M}):c(M),t()},k=Object.keys(y).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:a(s?"editPressingSlip":"newPressingSlip"),widthClass:"max-w-4xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{onClick:E,disabled:k,children:a("save")})]}),children:n.jsx("form",{onSubmit:E,className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsx(de,{label:a("date"),type:"date",value:m.date,onChange:C=>j("date",C.target.value),error:y.date,required:!0}),n.jsx(ke,{label:a("seaweedType"),value:m.seaweedTypeId,onChange:C=>j("seaweedTypeId",C.target.value),error:y.seaweedTypeId,required:!0,children:l.map(C=>n.jsx("option",{value:C.id,children:C.name},C.id))}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a("originInformation")}),n.jsx("div",{className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-bold",children:a("pressedWarehouseTitle")})]}),n.jsx("div",{className:"md:col-span-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:[a("availableBulkStock"),":"]}),n.jsxs("span",{className:"font-bold text-lg text-blue-900 dark:text-blue-100",children:[Fe(T.kg,i.localization)," kg (",T.bags," ",a("bags"),")"]})]})}),n.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-700 space-y-4",children:[n.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-red-700 dark:text-red-200 border-b border-red-300 pb-1 mb-2",children:a("bulkWeightConsumed")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(de,{label:`${a("warehouse_weightKg")}`,type:"number",step:"any",value:m.consumedWeightKg,onChange:C=>j("consumedWeightKg",C.target.value),error:y.consumedWeightKg,required:!0}),n.jsx(de,{label:a("sac"),type:"number",value:m.consumedBags,onChange:C=>j("consumedBags",C.target.value),error:y.consumedBags,required:!0})]})]}),n.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-700 space-y-4",children:[n.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-green-700 dark:text-green-200 border-b border-green-300 pb-1 mb-2",children:a("pressedWeightObtained")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(de,{label:`${a("warehouse_weightKg")}`,type:"number",step:"any",value:m.producedWeightKg,onChange:C=>j("producedWeightKg",C.target.value),error:y.producedWeightKg,required:!0}),n.jsx(de,{label:a("baleSingular"),type:"number",value:m.producedBalesCount,onChange:C=>j("producedBalesCount",C.target.value),error:y.producedBalesCount,required:!0})]})]})]})})})},uP=({isOpen:e,onClose:t})=>{const{t:s}=we(),{seaweedTypes:a,addPressedStockAdjustment:i}=He(),[l,c]=S.useState({date:new Date().toISOString().split("T")[0],seaweedTypeId:"",direction:"in",kg:"",bales:"",designation:""}),[u,f]=S.useState({});S.useEffect(()=>{var y;e&&(c({date:new Date().toISOString().split("T")[0],seaweedTypeId:((y=a[0])==null?void 0:y.id)||"",direction:"in",kg:"",bales:"",designation:""}),f({}))},[e,a]);const h=S.useCallback(()=>{const y={};l.seaweedTypeId||(y.seaweedTypeId=s("validationRequired")),l.designation.trim()||(y.designation=s("validationRequired"));const b=parseFloat(l.kg),T=parseInt(l.bales,10);if(!l.kg&&!l.bales||isNaN(b)&&isNaN(T)){const _=s("validationAtLeastOneRequired");y.kg=_,y.bales=_}return l.kg&&(isNaN(b)||b<=0)&&(y.kg=s("validationPositiveNumber")),l.bales&&(isNaN(T)||T<=0)&&(y.bales=s("validationPositiveNumber")),y},[l,s]);S.useEffect(()=>{f(h())},[l,h]);const m=()=>{const y=h();if(Object.keys(y).length>0){f(y);return}i({date:l.date,siteId:"pressing-warehouse",seaweedTypeId:l.seaweedTypeId,type:l.direction==="in"?mt.ADJUSTMENT_IN:mt.ADJUSTMENT_OUT,designation:l.designation,inKg:l.direction==="in"&&parseFloat(l.kg)||void 0,outKg:l.direction==="out"&&parseFloat(l.kg)||void 0,inBales:l.direction==="in"&&parseInt(l.bales)||void 0,outBales:l.direction==="out"&&parseInt(l.bales)||void 0}),t()},x=Object.keys(u).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:`${s("recordStockAdjustment")} (${s("pressedSeaweed")})`,footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:s("cancel")}),n.jsx(se,{onClick:m,disabled:x,children:s("save")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:s("date"),type:"date",value:l.date,onChange:y=>c(b=>({...b,date:y.target.value}))}),n.jsx(ke,{label:s("seaweedType"),value:l.seaweedTypeId,onChange:y=>c(b=>({...b,seaweedTypeId:y.target.value})),children:a.map(y=>n.jsx("option",{value:y.id,children:y.name},y.id))})]}),n.jsxs(ke,{label:s("direction"),value:l.direction,onChange:y=>c(b=>({...b,direction:y.target.value})),children:[n.jsx("option",{value:"in",children:s("in")}),n.jsx("option",{value:"out",children:s("out")})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:s("kg"),type:"number",step:"any",value:l.kg,onChange:y=>c(b=>({...b,kg:y.target.value})),error:u.kg}),n.jsx(de,{label:s("baleSingular"),type:"number",value:l.bales,onChange:y=>c(b=>({...b,bales:y.target.value})),error:u.bales})]}),n.jsx(de,{label:s("reasonForAdjustment"),value:l.designation,onChange:y=>c(b=>({...b,designation:y.target.value})),required:!0,error:u.designation,placeholder:"e.g. Initial Stock, Correction, Found Stock..."})]})})},hP=()=>{const{t:e}=we(),{settings:t}=Ke(),{pressedStockMovements:s,seaweedTypes:a}=He(),{bulkStock:i,pressedStock:l,totals:c}=S.useMemo(()=>{const f=new Map,h=new Map;s.forEach(j=>{const E=j.seaweedTypeId;let k=f.get(E)||{kg:0,bags:0},C=h.get(E)||{bales:0,kg:0};switch(j.type){case mt.BULK_IN_FROM_SITE:case mt.FARMER_DELIVERY:k.kg+=j.inKg||0,k.bags+=j.inBales||0;break;case mt.PRESSING_CONSUMPTION:k.kg-=j.outKg||0,k.bags-=j.outBales||0;break;case mt.PRESSING_IN:case mt.INITIAL_STOCK:case mt.ADJUSTMENT_IN:C.bales+=j.inBales||0,C.kg+=j.inKg||0;break;case mt.EXPORT_OUT:case mt.RETURN_TO_SITE:case mt.ADJUSTMENT_OUT:C.bales-=j.outBales||0,C.kg-=j.outKg||0;break}f.set(E,k),h.set(E,C)});const m=(j,E)=>Array.from(j.entries()).map(([k,C])=>{const A=a.find(I=>I.id===k),M=C.kg*((A==null?void 0:A.dryPrice)||0);return{seaweedTypeId:k,name:(A==null?void 0:A.name)||e("unknown"),siteName:e("pressedWarehouseTitle"),...C,value:M}}).filter(k=>k.kg>.01||(E?k.bales>0:k.bags>0)),x=m(f,!1),y=m(h,!0),b=x.reduce((j,E)=>j+E.value,0),T=y.reduce((j,E)=>j+E.value,0),_={pressedBales:y.reduce((j,E)=>j+E.bales,0),pressedKg:y.reduce((j,E)=>j+E.kg,0),pressedValue:T,totalValue:b+T};return{bulkStock:x,pressedStock:y,totals:_}},[s,a,e]),u=()=>{const f=i.map(x=>({name:x.name,kg:x.kg,bags:x.bags,value:x.value})),h=l.map(x=>({name:x.name,kg:x.kg,bales:x.bales,value:x.value})),m=[{sheetName:e("bulkSeaweed"),columns:[{header:e("seaweedType"),key:"name",width:25},{header:e("warehouse_weightKg"),key:"kg",width:15},{header:e("bags"),key:"bags",width:15},{header:e("value"),key:"value",width:20}],data:f},{sheetName:e("pressedSeaweed"),columns:[{header:e("seaweedType"),key:"name",width:25},{header:e("warehouse_weightKg"),key:"kg",width:15},{header:e("bales"),key:"bales",width:15},{header:e("value"),key:"value",width:20}],data:h}];wN(m,"Pressed_Warehouse_Summary")};return n.jsxs("div",{children:[n.jsx("div",{className:"flex justify-end mb-4",children:n.jsxs(se,{onClick:u,variant:"secondary",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Archive",className:"w-10 h-10 text-blue-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("warehouse_totalBalesInStock")}),n.jsx("p",{className:"text-3xl font-bold",children:c.pressedBales})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Package",className:"w-10 h-10 text-green-500 mr-4"}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-gray-500",children:[e("totalStockKg")," (",e("pressedSeaweed"),")"]}),n.jsx("p",{className:"text-3xl font-bold",children:Fe(c.pressedKg,t.localization)})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-yellow-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("totalStockValue")}),n.jsx("p",{className:"text-3xl font-bold",children:Ae(c.totalValue,t.localization)})]})]})})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6",children:[n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex items-center mb-3",children:[n.jsx("div",{className:"w-2 h-6 bg-red-500 rounded-sm mr-2"}),n.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:e("bulkSeaweed")})]}),n.jsx(Ge,{className:"flex-grow border-t-4 border-t-red-500",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[n.jsx("th",{className:"p-2 pl-0",children:e("seaweedType")}),n.jsx("th",{className:"p-2 text-right",children:e("kg")}),n.jsx("th",{className:"p-2 text-right",children:e("bags")})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[i.map(f=>n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[n.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:Fe(f.kg,t.localization)}),n.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bags})]},f.seaweedTypeId)),i.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"p-6 text-center text-sm text-gray-400 italic",children:e("noStockData")})})]})]})})})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex items-center mb-3",children:[n.jsx("div",{className:"w-2 h-6 bg-green-500 rounded-sm mr-2"}),n.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:e("pressedSeaweed")})]}),n.jsx(Ge,{className:"flex-grow border-t-4 border-t-green-500",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[n.jsx("th",{className:"p-2 pl-0",children:e("seaweedType")}),n.jsx("th",{className:"p-2 text-right",children:e("kg")}),n.jsx("th",{className:"p-2 text-right",children:e("bales")}),n.jsx("th",{className:"p-2 text-right",children:e("value")})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[l.map(f=>n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[n.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:Fe(f.kg,t.localization)}),n.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bales}),n.jsx("td",{className:"p-3 text-right font-medium text-green-600 dark:text-green-400",children:Ae(f.value,t.localization)})]},f.seaweedTypeId)),l.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-6 text-center text-sm text-gray-400 italic",children:e("noStockData")})})]})]})})})]})]})]})},fP=({onEdit:e,onDelete:t})=>{const{t:s}=we(),{pressingSlips:a,seaweedTypes:i,exportDocuments:l}=He(),[c,u]=S.useState({key:"date",direction:"descending"}),f=S.useMemo(()=>new Map(l.map(T=>[T.id,T])),[l]),h=S.useMemo(()=>new Map(i.map(T=>[T.id,T.name])),[i]),m=S.useMemo(()=>[...a].sort((T,_)=>{const j=T[c.key],E=_[c.key];return j<E?c.direction==="ascending"?-1:1:j>E?c.direction==="ascending"?1:-1:0}),[a,c]),x=T=>{let _="ascending";c.key===T&&c.direction==="ascending"&&(_="descending"),u({key:T,direction:_})},y=T=>c.key!==T?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):c.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),b=()=>{const T=m.map(j=>{var E;return{slipNo:j.slipNo,date:j.date,seaweedType:h.get(j.seaweedTypeId)||s("unknown"),consumedWeightKg:j.consumedWeightKg,producedWeightKg:j.producedWeightKg,producedBalesCount:j.producedBalesCount,linkedExport:j.exportDocId?((E=f.get(j.exportDocId))==null?void 0:E.docNo)||"Linked":"No"}}),_=[{header:s("slipNo"),key:"slipNo",width:20},{header:s("date"),key:"date",width:15},{header:s("seaweedType"),key:"seaweedType",width:20},{header:s("bulkWeightConsumed"),key:"consumedWeightKg",width:20},{header:s("pressedWeightObtained"),key:"producedWeightKg",width:20},{header:s("bales"),key:"producedBalesCount",width:15},{header:s("linkedExport"),key:"linkedExport",width:20}];Pi(T,_,`PressingSlips_${new Date().toISOString().split("T")[0]}`,"Pressing Slips")};return n.jsxs("div",{className:"overflow-x-auto",children:[n.jsx("div",{className:"flex justify-end mb-2",children:n.jsxs(se,{onClick:b,variant:"secondary",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"})," ",s("exportExcel")]})}),n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700 font-bold bg-gray-50 dark:bg-gray-800",children:[n.jsx("th",{className:"p-3",children:n.jsxs("button",{onClick:()=>x("slipNo"),className:"group flex items-center gap-2",children:[s("slipNo")," ",y("slipNo")]})}),n.jsx("th",{className:"p-3",children:n.jsxs("button",{onClick:()=>x("date"),className:"group flex items-center gap-2",children:[s("date")," ",y("date")]})}),n.jsx("th",{className:"p-3",children:s("seaweedType")}),n.jsx("th",{className:"p-3 text-right text-red-600",children:s("bulkWeightConsumed")}),n.jsx("th",{className:"p-3 text-right text-green-600",children:s("pressedWeightObtained")}),n.jsx("th",{className:"p-3 text-right",children:s("bales")}),n.jsx("th",{className:"p-3",children:s("linkedExport")}),n.jsx("th",{className:"p-3 text-right",children:s("actions")})]})}),n.jsx("tbody",{children:m.map(T=>{const _=T.exportDocId?f.get(T.exportDocId):null,j=!!_;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-mono",children:T.slipNo}),n.jsx("td",{className:"p-3",children:T.date}),n.jsx("td",{className:"p-3 font-semibold",children:h.get(T.seaweedTypeId)||s("unknown")}),n.jsxs("td",{className:"p-3 text-right text-red-600 font-medium",children:["-",T.consumedWeightKg," kg"]}),n.jsxs("td",{className:"p-3 text-right text-green-600 font-bold",children:["+",T.producedWeightKg," kg"]}),n.jsx("td",{className:"p-3 text-right font-semibold",children:T.producedBalesCount}),n.jsx("td",{className:"p-3",children:_?n.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:_.docNo}):"-"}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-1",children:[n.jsx(se,{variant:"ghost",onClick:()=>e(T),disabled:j,children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(cm,{content:s(j?"cannotDeleteLinkedSlip":"delete"),children:n.jsx(se,{variant:"danger",onClick:()=>t(T),disabled:j,children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})]})})]},T.id)})})]})]})},mP=()=>{const{t:e}=we(),{pressedStockMovements:t,seaweedTypes:s}=He(),{settings:a}=Ke(),[i,l]=S.useState({seaweedTypeId:"all",startDate:"",endDate:""}),{filteredBulkHistory:c,filteredPressedHistory:u}=S.useMemo(()=>{const h=i.seaweedTypeId==="all"?[...t]:t.filter(j=>j.seaweedTypeId===i.seaweedTypeId);h.sort((j,E)=>new Date(j.date).getTime()-new Date(E.date).getTime()||j.id.localeCompare(E.id));let m=0,x=0,y=0,b=0;const _=h.map(j=>{const E=[mt.BULK_IN_FROM_SITE,mt.FARMER_DELIVERY,mt.PRESSING_CONSUMPTION].includes(j.type);return E?(m+=(j.inKg||0)-(j.outKg||0),x+=(j.inBales||0)-(j.outBales||0),{...j,isBulk:E,balanceKg:m,balanceUnits:x}):(y+=(j.inKg||0)-(j.outKg||0),b+=(j.inBales||0)-(j.outBales||0),{...j,isBulk:E,balanceKg:y,balanceUnits:b})}).filter(j=>!(i.startDate&&j.date<i.startDate||i.endDate&&j.date>i.endDate));return{filteredBulkHistory:_.filter(j=>j.isBulk).reverse(),filteredPressedHistory:_.filter(j=>!j.isBulk).reverse()}},[t,i.seaweedTypeId,i.startDate,i.endDate]),f=()=>{const h=c.map(y=>({date:y.date,designation:`${e(`pressedStockMovement_${y.type}`)}: ${y.designation}`,inKg:y.inKg,inBags:y.inBales,outKg:y.outKg,outBags:y.outBales,balanceKg:y.balanceKg,balanceBags:y.balanceUnits})).reverse(),m=u.map(y=>({date:y.date,designation:`${e(`pressedStockMovement_${y.type}`)}: ${y.designation}`,inKg:y.inKg,inBales:y.inBales,outKg:y.outKg,outBales:y.outBales,balanceKg:y.balanceKg,balanceBales:y.balanceUnits})).reverse(),x=[{sheetName:e("bulkSeaweed"),columns:[{header:e("date"),key:"date",width:15},{header:e("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bags)",key:"inBags",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bags)",key:"outBags",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bags)",key:"balanceBags",width:15}],data:h},{sheetName:e("pressedSeaweed"),columns:[{header:e("date"),key:"date",width:15},{header:e("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bales)",key:"inBales",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bales)",key:"outBales",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bales)",key:"balanceBales",width:15}],data:m}];wN(x,`Warehouse_Movement_History_${new Date().toISOString().split("T")[0]}`)};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 items-end",children:[n.jsxs(ke,{label:e("seaweedType"),value:i.seaweedTypeId,onChange:h=>l(m=>({...m,seaweedTypeId:h.target.value})),children:[n.jsx("option",{value:"all",children:e("allSeaweedTypes")}),s.map(h=>n.jsx("option",{value:h.id,children:h.name},h.id))]}),n.jsx(de,{label:e("startDate"),type:"date",value:i.startDate,onChange:h=>l(m=>({...m,startDate:h.target.value}))}),n.jsx(de,{label:e("endDate"),type:"date",value:i.endDate,onChange:h=>l(m=>({...m,endDate:h.target.value}))}),n.jsxs(se,{onClick:f,variant:"secondary",className:"h-[42px]",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]})]}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[n.jsx(Ge,{title:`${e("bulkSeaweed")} (${e("forPressing")})`,children:n.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:n.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[n.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[n.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[n.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:e("date")}),n.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:e("designation")}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:e("balance")})]}),n.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("bags")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("bags")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center",children:e("bags")})]})]}),n.jsx("tbody",{children:c.map(h=>n.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[n.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),n.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[e(`pressedStockMovement_${h.type}`),": ",h.designation]}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${Fe(h.inKg,a.localization)}`:""}),n.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales?`+${h.inBales}`:""}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${Fe(h.outKg,a.localization)}`:""}),n.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:Fe(h.balanceKg,a.localization)}),n.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})}),n.jsx(Ge,{title:`${e("pressedSeaweed")} (${e("bales")})`,children:n.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:n.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[n.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[n.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[n.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:e("date")}),n.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:e("designation")}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),n.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:e("balance")})]}),n.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("baleSingular")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("baleSingular")}),n.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:e("kg")}),n.jsx("th",{className:"p-2 text-center",children:e("baleSingular")})]})]}),n.jsx("tbody",{children:u.map(h=>n.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[n.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),n.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[e(`pressedStockMovement_${h.type}`),": ",h.designation]}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${Fe(h.inKg,a.localization)}`:""}),n.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales||""}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${Fe(h.outKg,a.localization)}`:""}),n.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),n.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:Fe(h.balanceKg,a.localization)}),n.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})})]})]})},pP=()=>{const{t:e}=we(),{deletePressingSlip:t}=He(),[s,a]=S.useState("summary"),[i,l]=S.useState(!1),[c,u]=S.useState(null),[f,h]=S.useState(!1),[m,x]=S.useState(!1),[y,b]=S.useState(null),T=E=>{u(E),l(!0)},_=E=>{b(E),x(!0)},j=()=>{y&&!y.exportDocId&&t(y.id),x(!1),b(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("pressedWarehouseTitle")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:()=>h(!0),children:[n.jsx(te,{name:"SlidersHorizontal",className:"w-5 h-5"}),e("recordStockAdjustment")]}),n.jsxs(se,{onClick:()=>T(null),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("recordPressingSlip")]})]})]}),n.jsxs(Ge,{children:[n.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:n.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[n.jsx("button",{onClick:()=>a("summary"),className:`py-2 px-4 text-sm font-medium ${s==="summary"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("summaryView")}),n.jsx("button",{onClick:()=>a("slips"),className:`py-2 px-4 text-sm font-medium ${s==="slips"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("pressingSlips")}),n.jsx("button",{onClick:()=>a("history"),className:`py-2 px-4 text-sm font-medium ${s==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:e("movementHistory")})]})}),s==="summary"&&n.jsx(hP,{}),s==="slips"&&n.jsx(fP,{onEdit:E=>T(E),onDelete:_}),s==="history"&&n.jsx(mP,{})]}),n.jsx(dP,{isOpen:i,onClose:()=>l(!1),slip:c}),n.jsx(uP,{isOpen:f,onClose:()=>h(!1)}),m&&n.jsx(zt,{isOpen:m,onClose:()=>x(!1),onConfirm:j,title:e("confirmDeleteTitle"),message:y!=null&&y.exportDocId?e("confirmDeletePressingSlipLinked"):e("confirmDeletePressingSlip"),confirmDisabled:!!(y!=null&&y.exportDocId)})]})},gP=({isOpen:e,onClose:t,doc:s})=>{const{t:a}=we(),{seaweedTypes:i,pressingSlips:l,addExportDocument:c,updateExportDocument:u,pressedStockMovements:f}=He(),h=S.useCallback(()=>{var O,F,q;return{docType:lf.COMMERCIAL_INVOICE,invoiceNo:"",date:new Date().toISOString().split("T")[0],seaweedTypeId:((O=i[0])==null?void 0:O.id)||"",nature:"",poNo:"",domiciliationNo:"",destinationCountry:"",city:"",notifyParty:"",debtor:"",vessel:"",seaWaybill:"",voyageNo:"",currency:"EUR",localExchangeRate:"",pressingSlipIds:[],containers:[],customsNomenclature:"12, 122, 100, 000",countryOfOrigin:((F=Jt.find(z=>z.code==="MG"))==null?void 0:F.code)||((q=Jt[0])==null?void 0:q.code)||"",incoterms:lx[0]||"",paymentTerms:cx[0]||"",swiftBank:"",rexReference:""}},[i]),[m,x]=S.useState(h()),[y,b]=S.useState({});S.useEffect(()=>{x(s?{...h(),...s,localExchangeRate:String(s.localExchangeRate),containers:s.containers,rexReference:s.rexReference||""}:h())},[s,e,h]);const T=S.useMemo(()=>l.filter(O=>O.seaweedTypeId===m.seaweedTypeId&&(!O.exportDocId||O.exportDocId===(s==null?void 0:s.id))),[l,m.seaweedTypeId,s]),_=S.useMemo(()=>l.filter(O=>m.pressingSlipIds.includes(O.id)),[l,m.pressingSlipIds]),j=S.useMemo(()=>{const O=_.reduce((q,z)=>q+z.producedWeightKg,0),F=_.reduce((q,z)=>q+z.producedBalesCount,0);return{totalWeightKg:O,totalBales:F}},[_]),E=S.useMemo(()=>{const O=m.containers.reduce((q,z)=>q+Number(z.seaweedWeightKg||0),0),F=m.containers.reduce((q,z)=>q+Number(z.packagesCount||0),0);return{totalWeightKg:O,totalBales:F}},[m.containers]),k=S.useCallback(()=>{const O={};m.invoiceNo||(O.invoiceNo=a("validationRequired")),m.date||(O.date=a("validationRequired")),m.seaweedTypeId||(O.seaweedTypeId=a("validationRequired")),m.nature||(O.nature=a("validationRequired")),m.destinationCountry||(O.destinationCountry=a("validationRequired")),(!m.localExchangeRate||isNaN(parseFloat(m.localExchangeRate))||parseFloat(m.localExchangeRate)<=0)&&(O.localExchangeRate=a("validationPositiveNumber")),m.pressingSlipIds.length===0&&(O.pressingSlipIds=a("validationRequired")),m.containers.length===0&&(O.containers=a("validationRequired")),m.customsNomenclature||(O.customsNomenclature=a("validationRequired")),m.countryOfOrigin||(O.countryOfOrigin=a("validationRequired")),m.incoterms||(O.incoterms=a("validationRequired")),m.paymentTerms||(O.paymentTerms=a("validationRequired")),m.swiftBank||(O.swiftBank=a("validationRequired")),Math.abs(E.totalWeightKg-j.totalWeightKg)>.01&&(O.containers=a("validationContainerWeights")),E.totalBales!==j.totalBales&&(O.containers||(O.containers=a("validationContainerBales")));const F=m.containers.map(q=>{const z={};return q.containerNo||(z.containerNo=a("validationRequired")),q.sealNo||(z.sealNo=a("validationRequired")),z});return F.some(q=>Object.keys(q).length>0)&&(O.containerErrors=F),O},[m,a,E,j]);S.useEffect(()=>{b(k())},[m,k]);const C=(O,F)=>{const q={...m,[O]:F};O==="seaweedTypeId"&&(q.pressingSlipIds=[]),x(q)},A=O=>{const F=m.pressingSlipIds.includes(O)?m.pressingSlipIds.filter(q=>q!==O):[...m.pressingSlipIds,O];x(q=>({...q,pressingSlipIds:F}))},M=(O,F,q)=>{const z=[...m.containers],Y={...z[O],[F]:q},J=Number(Y.tareKg)||0,G=Number(Y.seaweedWeightKg)||0,B=Number(Y.packageWeightKg)||0;Y.grossWeightKg=J+G+B;const Q=Number(Y.unitPrice)||0;Y.value=G*Q,z[O]=Y,x(W=>({...W,containers:z}))},I=()=>{const O={id:`new-container-${Date.now()}`,containerNo:"",sealNo:"",containerType:cf.GP40,volumeM3:0,tareKg:0,packageWeightKg:0,seaweedWeightKg:0,packagesCount:0,grossWeightKg:0,unitPrice:0,value:0};x(F=>({...F,containers:[...F.containers,O]}))},P=O=>{x(F=>({...F,containers:F.containers.filter((q,z)=>z!==O)}))},D=O=>{O.preventDefault();const F=k();if(Object.keys(F).length>0){b(F);return}const q={...m,localExchangeRate:parseFloat(m.localExchangeRate),containers:m.containers.map(J=>({...J,volumeM3:Number(J.volumeM3)||0,tareKg:Number(J.tareKg)||0,packageWeightKg:Number(J.packageWeightKg)||0,seaweedWeightKg:Number(J.seaweedWeightKg)||0,packagesCount:Number(J.packagesCount)||0,grossWeightKg:Number(J.grossWeightKg)||0,unitPrice:Number(J.unitPrice)||0,value:Number(J.value)||0}))},z=l.find(J=>J.id===q.pressingSlipIds[0]);if(!z){alert(a("alert_noValidSlips"));return}let Y=z.sourceSiteId;if(!Y){const J=f.filter(G=>G.type===mt.BULK_IN_FROM_SITE&&G.seaweedTypeId===z.seaweedTypeId).sort((G,B)=>new Date(B.date).getTime()-new Date(G.date).getTime())[0];Y=J==null?void 0:J.siteId}if(!Y){console.error("Critical Error: Could not determine the origin site for the selected pressing slips.",z),alert(a("alert_cannotDetermineSourceSite"));return}s?u({...s,...q}):c(q,Y),t()},U=Object.keys(y).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:a(s?"editExportDocument":"createExportDocument"),widthClass:"max-w-7xl",children:n.jsxs("form",{onSubmit:D,className:"flex flex-col max-h-[calc(90vh-130px)]",children:[n.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-6",children:[n.jsx(Ge,{title:a("documentDetails"),children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsx(ke,{label:a("docType"),value:m.docType,onChange:O=>C("docType",O.target.value),children:Object.values(lf).map(O=>n.jsx("option",{value:O,children:a(O)},O))}),n.jsx(de,{label:a("invoiceNo"),value:m.invoiceNo,onChange:O=>C("invoiceNo",O.target.value),error:y.invoiceNo}),n.jsx(de,{label:a("date"),type:"date",value:m.date,onChange:O=>C("date",O.target.value),error:y.date}),n.jsx(ke,{label:a("seaweedType"),value:m.seaweedTypeId,onChange:O=>C("seaweedTypeId",O.target.value),error:y.seaweedTypeId,children:i.map(O=>n.jsx("option",{value:O.id,children:O.name},O.id))}),n.jsx(de,{containerClassName:"lg:col-span-2",label:a("natureLabel"),value:m.nature,onChange:O=>C("nature",O.target.value),error:y.nature}),n.jsx(de,{label:a("poNo"),value:m.poNo,onChange:O=>C("poNo",O.target.value)}),n.jsx(de,{label:a("domiciliationNo"),value:m.domiciliationNo,onChange:O=>C("domiciliationNo",O.target.value)}),n.jsx(de,{label:a("rexReference"),value:m.rexReference,onChange:O=>C("rexReference",O.target.value)}),n.jsx(de,{label:a("destinationCountry"),value:m.destinationCountry,onChange:O=>C("destinationCountry",O.target.value),error:y.destinationCountry}),n.jsx(de,{label:a("city"),value:m.city,onChange:O=>C("city",O.target.value)}),n.jsx(de,{label:a("notifyParty"),value:m.notifyParty,onChange:O=>C("notifyParty",O.target.value)}),n.jsx(de,{label:a("debtor"),value:m.debtor,onChange:O=>C("debtor",O.target.value)}),n.jsx(de,{label:a("vessel"),value:m.vessel,onChange:O=>C("vessel",O.target.value)}),n.jsx(de,{label:a("seaWaybill"),value:m.seaWaybill,onChange:O=>C("seaWaybill",O.target.value)}),n.jsx(de,{label:a("voyageNo"),value:m.voyageNo,onChange:O=>C("voyageNo",O.target.value)}),n.jsxs(ke,{label:a("currency"),value:m.currency,onChange:O=>C("currency",O.target.value),children:[n.jsx("option",{value:"EUR",children:"EUR"}),n.jsx("option",{value:"USD",children:"USD"})]}),n.jsx(de,{label:a("localExchangeRate"),type:"number",step:"any",value:m.localExchangeRate,onChange:O=>C("localExchangeRate",O.target.value),error:y.localExchangeRate}),n.jsx(de,{label:a("customsNomenclature"),value:m.customsNomenclature,onChange:O=>C("customsNomenclature",O.target.value),error:y.customsNomenclature,containerClassName:"lg:col-span-2"}),n.jsx(ke,{label:a("countryOfOrigin"),value:m.countryOfOrigin,onChange:O=>C("countryOfOrigin",O.target.value),error:y.countryOfOrigin,containerClassName:"lg:col-span-2",children:Jt.map(O=>n.jsx("option",{value:O.code,children:O.name},O.code))}),n.jsx(ke,{label:a("incoterms"),value:m.incoterms,onChange:O=>C("incoterms",O.target.value),error:y.incoterms,containerClassName:"lg:col-span-2",children:lx.map(O=>n.jsx("option",{value:O,children:a(O)},O))}),n.jsx(ke,{label:a("paymentTerms"),value:m.paymentTerms,onChange:O=>C("paymentTerms",O.target.value),error:y.paymentTerms,containerClassName:"lg:col-span-2",children:cx.map(O=>n.jsx("option",{value:O,children:a(O)},O))}),n.jsx(de,{label:a("swiftBank"),value:m.swiftBank,onChange:O=>C("swiftBank",O.target.value),error:y.swiftBank,containerClassName:"lg:col-span-4"})]})}),n.jsxs(Ge,{title:a("selectPressingSlips"),children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-2",children:a("availableSlips")}),n.jsxs("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:[T.filter(O=>!m.pressingSlipIds.includes(O.id)).map(O=>n.jsxs("div",{onClick:()=>A(O.id),className:"p-2 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/50 cursor-pointer flex justify-between",children:[n.jsxs("span",{children:[O.slipNo," (",O.producedBalesCount," ",a("bales"),")"]}),n.jsx(te,{name:"PlusCircle",className:"w-5 h-5 text-green-500"})]},O.id)),T.length===0&&n.jsx("p",{className:"text-sm text-gray-500 p-2",children:a("noSlipsAvailable")})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-2",children:a("selectedSlips")}),n.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:_.map(O=>n.jsxs("div",{onClick:()=>A(O.id),className:"p-2 rounded-md bg-blue-50 dark:bg-blue-900/30 hover:bg-red-50 dark:hover:bg-red-900/30 cursor-pointer flex justify-between",children:[n.jsxs("span",{children:[O.slipNo," (",O.producedBalesCount," ",a("bales"),")"]}),n.jsx(te,{name:"X",className:"w-5 h-5 text-red-500"})]},O.id))})]})]}),y.pressingSlipIds&&n.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:y.pressingSlipIds}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[n.jsxs("div",{children:[a("totalSelectedWeight"),": ",j.totalWeightKg.toFixed(2)," kg"]}),n.jsxs("div",{children:[a("totalSelectedBales"),": ",j.totalBales]})]})]}),n.jsxs(Ge,{title:a("containerManagement"),children:[n.jsx("div",{className:"space-y-4",children:m.containers.map((O,F)=>{var q,z,Y,J;return n.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg relative",children:[n.jsx(se,{type:"button",variant:"danger",onClick:()=>P(F),className:"absolute top-2 right-2 p-1 !rounded-full h-8 w-8",children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})}),n.jsxs("h5",{className:"font-semibold mb-3 text-lg",children:[a("container")," #",F+1]}),n.jsx("div",{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-3 gap-x-6 gap-y-4",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:a("identification")}),n.jsx(de,{label:a("containerNo"),value:O.containerNo,onChange:G=>M(F,"containerNo",G.target.value),error:(z=(q=y.containerErrors)==null?void 0:q[F])==null?void 0:z.containerNo}),n.jsx(de,{label:a("sealNo"),value:O.sealNo,onChange:G=>M(F,"sealNo",G.target.value),error:(J=(Y=y.containerErrors)==null?void 0:Y[F])==null?void 0:J.sealNo}),n.jsx(ke,{label:a("containerType"),value:O.containerType,onChange:G=>M(F,"containerType",G.target.value),children:Object.values(cf).map(G=>n.jsx("option",{value:G,children:G},G))}),n.jsx(de,{label:a("volumeM3"),type:"number",value:O.volumeM3,onChange:G=>M(F,"volumeM3",G.target.value)})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:a("weights")}),n.jsx(de,{label:a("tareKg"),type:"number",value:O.tareKg,onChange:G=>M(F,"tareKg",G.target.value)}),n.jsx(de,{label:a("packageWeightKg"),type:"number",value:O.packageWeightKg||"",onChange:G=>M(F,"packageWeightKg",G.target.value)}),n.jsx(de,{label:a("seaweedWeightKg"),type:"number",value:O.seaweedWeightKg,onChange:G=>M(F,"seaweedWeightKg",G.target.value)}),n.jsx(de,{label:a("grossWeightKg"),type:"number",value:O.grossWeightKg,disabled:!0})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:a("contentsAndValue")}),n.jsx(de,{label:a("packagesCount"),type:"number",value:O.packagesCount,onChange:G=>M(F,"packagesCount",G.target.value)}),n.jsx(de,{label:a("unitPrice"),type:"number",step:"any",value:O.unitPrice,onChange:G=>M(F,"unitPrice",G.target.value)}),n.jsx(de,{label:a("value"),type:"number",value:O.value,disabled:!0})]})]})})]},O.id||F)})}),y.containers&&n.jsx("p",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:y.containers}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[n.jsxs("div",{children:[a("totalContainerWeight"),": ",E.totalWeightKg.toFixed(2)," kg"]}),n.jsxs("div",{children:[a("totalContainerBales"),": ",E.totalBales]})]}),n.jsxs(se,{type:"button",variant:"secondary",onClick:I,className:"mt-4",children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),a("addContainer")]})]})]}),n.jsxs("footer",{className:"flex-shrink-0 flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700 mt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{type:"submit",disabled:U,children:a("save")})]})]})})},ks=({children:e,landscape:t=!1})=>t?n.jsx("div",{className:"print-page report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col",children:e}):n.jsx("div",{className:"print-page bg-white shadow-lg mx-auto my-8",children:n.jsx("div",{className:"p-12 text-black font-serif",children:e})}),Ja={units:["","one","two","three","four","five","six","seven","eight","nine"],teens:["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],tens:["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],scales:["","thousand","million","billion","trillion"],and:"and",zero:"zero"},Un={units:["zro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],teens:["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],tens:["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"],scales:["","mille","million","milliard","billion"]},Cv=e=>{if(e===0)return Un.units[0];const t=c=>{if(c===0)return"";if(c<10)return Un.units[c];if(c<20)return Un.teens[c-10];const u=Math.floor(c/10),f=c%10;if(u===7||u===9)return`${Un.tens[u-1]}-${Un.teens[f]}`;let h=Un.tens[u];return f>0?f===1&&u<8&&u>1?h+=" et un":h+=`-${Un.units[f]}`:u===8&&(h+="s"),h},s=c=>{const u=Math.floor(c/100),f=c%100;let h="";return u>0&&(h=u>1?`${Un.units[u]} cent`:"cent",f===0&&u>1&&(h+="s")),f>0&&(h+=(h?" ":"")+t(f)),h};let a=[],i=0;for(;e>0;){const c=e%1e3;if(c>0){let u=s(c);if(i>0){c===1&&i===1&&(u="");let f=Un.scales[i];c>1&&i>1&&(f+="s"),a.unshift(f)}u&&a.unshift(u)}e=Math.floor(e/1e3),i++}let l=a.join(" ").trim();l=l.replace(/quatre-vingt(?!\S)/g,"quatre-vingts"),l=l.replace(/quatre-vingts-un/g,"quatre-vingt-un"),l=l.replace(/quatre-vingts-onze/g,"quatre-vingt-onze"),l=l.replace(/cent(?!\S)/g,"cents");for(let c=1;c<10;c++)l=l.replace(new RegExp(`cents ${Un.units[c]}`,"g"),`cent ${Un.units[c]}`),l=l.replace(new RegExp(`cents ${Un.teens[c-1]}`,"g"),`cent ${Un.teens[c-1]}`);for(let c=2;c<10;c++)l=l.replace(new RegExp(`cents ${Un.tens[c]}`,"g"),`cent ${Un.tens[c]}`);return l=l.replace(/cents et un/g,"cent et un"),l=l.replace(/cents mille/g,"cent mille"),l.replace("un mille","mille")},Iv=e=>{if(e===0)return Ja.zero;const t=l=>{if(l===0)return"";if(l<10)return Ja.units[l];if(l<20)return Ja.teens[l-10];const c=Math.floor(l/10),u=l%10;return Ja.tens[c]+(u>0?`-${Ja.units[u]}`:"")},s=l=>{const c=Math.floor(l/100),u=l%100;let f="";return c>0&&(f=`${Ja.units[c]} hundred`),u>0&&(f+=(f?` ${Ja.and} `:"")+t(u)),f};let a=[],i=0;for(;e>0;){const l=e%1e3;l>0&&(a.unshift(Ja.scales[i]),a.unshift(s(l))),e=Math.floor(e/1e3),i++}return a.filter(Boolean).join(" ").trim()},jN=(e,t="en",s)=>{const a=Math.floor(e),i=Math.round((e-a)*10**((s==null?void 0:s.monetaryDecimals)||2));let l;t==="fr"?l=Cv(a):l=Iv(a);let c=l;if(s!=null&&s.currency&&(c+=` ${s.currency}`),i>0){let u;t==="fr"?u=Cv(i):u=Iv(i),c+=` ${t==="fr"?"et":"and"} ${u} ${t==="fr"?"centimes":"cents"}`}return c&&(c=c.charAt(0).toUpperCase()+c.slice(1)),c},yP=({doc:e})=>{var x;const{settings:t}=Ke(),{t:s,language:a}=we(),{seaweedTypes:i}=He();i.find(y=>y.id===e.seaweedTypeId);const l=e.containers.reduce((y,b)=>y+b.packagesCount,0),c=e.containers.reduce((y,b)=>y+b.seaweedWeightKg,0),u=e.containers.reduce((y,b)=>y+b.value,0),f=e.currency==="EUR"?"":e.currency==="USD"?"$":e.currency,h=jN(u,a,{currency:e.currency,monetaryDecimals:2}),m=new Date(e.date).toLocaleDateString(a==="fr"?"fr-FR":"en-GB");return n.jsxs(ks,{children:[n.jsxs("header",{className:"flex justify-between items-start mb-8",children:[n.jsxs("div",{children:[n.jsx("img",{src:t.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),n.jsx("h1",{className:"font-bold text-lg",children:t.company.name}),n.jsx("p",{className:"text-xs",children:t.company.address}),n.jsxs("p",{className:"text-xs",children:["NIF: ",t.company.nif," / STAT: ",t.company.stat," / RC: ",t.company.rc]}),n.jsxs("p",{className:"text-xs",children:["Tel: ",t.company.phone]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("h2",{className:"text-3xl font-bold uppercase",children:[s("COMMERCIAL_INVOICE")," N ",e.invoiceNo]}),n.jsxs("div",{className:"mt-4 space-y-1",children:[e.rexReference&&n.jsxs("p",{children:[s("rexReference"),": ",e.rexReference]}),n.jsxs("p",{children:[s("domiciliationNo")," N ",e.domiciliationNo]}),n.jsxs("p",{children:[s("dateLabel")," ",m]})]})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("table",{className:"w-full text-sm",children:n.jsx("tbody",{children:n.jsxs("tr",{children:[n.jsxs("td",{className:"w-1/2 align-top pr-4",children:[n.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:s("debtor")}),n.jsxs("div",{className:"border p-2 min-h-[100px]",children:[n.jsx("p",{className:"font-bold text-base",children:e.debtor}),e.debtorAddress&&n.jsx("p",{className:"whitespace-pre-wrap",children:e.debtorAddress}),(e.debtorPhone||e.debtorEmail)&&n.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[e.debtorPhone&&n.jsxs("span",{children:["Tel: ",e.debtorPhone," "]}),e.debtorEmail&&n.jsxs("span",{children:["Email: ",e.debtorEmail]})]})]})]}),n.jsxs("td",{className:"w-1/2 align-top pl-4",children:[n.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:s("notifyParty")}),n.jsxs("div",{className:"border p-2 min-h-[100px]",children:[n.jsx("p",{className:"font-bold text-base",children:e.notifyParty}),e.notifyPartyAddress?n.jsx("p",{className:"whitespace-pre-wrap",children:e.notifyPartyAddress}):n.jsxs("p",{children:[e.city,", ",e.destinationCountry]}),(e.notifyPartyPhone||e.notifyPartyEmail)&&n.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[e.notifyPartyPhone&&n.jsxs("span",{children:["Tel: ",e.notifyPartyPhone," "]}),e.notifyPartyEmail&&n.jsxs("span",{children:["Email: ",e.notifyPartyEmail]})]})]})]})]})})}),n.jsxs("p",{className:"text-sm mt-4",children:[n.jsxs("span",{className:"font-bold",children:[s("orderRef"),":"]})," ",e.poNo]})]}),n.jsx("section",{children:n.jsxs("table",{className:"w-full border-collapse border border-black text-sm text-black",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-100",children:[n.jsx("th",{className:"border border-black p-1",children:s("description")}),n.jsx("th",{className:"border border-black p-1",children:s("packages")}),n.jsxs("th",{className:"border border-black p-1",children:[s("netWeight")," (Kg)"]}),n.jsxs("th",{className:"border border-black p-1",children:[s("unitPrice")," (",e.currency,")"]}),n.jsxs("th",{className:"border border-black p-1",children:[s("amount")," (",e.currency,")"]})]})}),n.jsx("tbody",{children:n.jsxs("tr",{children:[n.jsxs("td",{className:"border border-black p-1 h-32 align-top",children:[n.jsx("p",{children:e.nature}),n.jsxs("p",{children:["Incoterm: ",e.incoterms]}),n.jsxs("p",{children:["HS Code: ",e.customsNomenclature]}),n.jsxs("p",{children:["Country of Origin: ",e.countryOfOrigin]})]}),n.jsx("td",{className:"border border-black p-1 align-top text-center",children:l}),n.jsx("td",{className:"border border-black p-1 align-top text-right",children:Fe(c,t.localization)}),n.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(((x=e.containers[0])==null?void 0:x.unitPrice)||0,{...t.localization,currencySymbol:""})}),n.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(u,{...t.localization,currencySymbol:""})})]})}),n.jsx("tfoot",{children:n.jsxs("tr",{className:"font-bold",children:[n.jsx("td",{colSpan:3,className:"border border-black p-1",children:s("totalExclTax")}),n.jsx("td",{colSpan:2,className:"border border-black p-1 text-right",children:Ae(u,{...t.localization,currencySymbol:f})})]})})]})}),n.jsx("section",{className:"mt-4 text-sm",children:n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("amountInWords"),":"]})," ",h]})}),n.jsxs("section",{className:"mt-8 text-xs space-y-1",children:[n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("paymentTerms"),":"]})," ",e.paymentTerms]}),n.jsx("p",{children:n.jsxs("span",{className:"font-bold",children:[s("bankDetails"),":"]})}),n.jsx("p",{className:"pl-4",children:t.company.name}),n.jsxs("p",{className:"pl-4",children:["SWIFT: ",e.swiftBank]})]}),n.jsx("footer",{className:"mt-16 text-right",children:n.jsxs("div",{className:"inline-block text-center",children:[n.jsx("p",{className:"mb-12",children:s("theManager")}),n.jsx("hr",{className:"border-black"})]})})]})},xP=({doc:e})=>{var x;const{settings:t}=Ke(),{t:s,language:a}=we(),{seaweedTypes:i}=He(),l=i.find(y=>y.id===e.seaweedTypeId),c=e.containers.reduce((y,b)=>y+b.packagesCount,0),u=e.containers.reduce((y,b)=>y+b.seaweedWeightKg,0),f=e.containers.reduce((y,b)=>y+b.grossWeightKg,0),h=new Date(e.date).toLocaleDateString(a==="fr"?"fr-FR":"en-GB"),m=((x=Jt.find(y=>y.name.toLowerCase()===e.destinationCountry.toLowerCase()))==null?void 0:x.name)||e.destinationCountry;return n.jsxs(ks,{children:[n.jsxs("header",{className:"flex justify-between items-start mb-8",children:[n.jsxs("div",{children:[n.jsx("img",{src:t.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),n.jsx("h1",{className:"font-bold text-lg",children:t.company.name}),n.jsx("p",{className:"text-xs",children:t.company.address}),n.jsxs("p",{className:"text-xs",children:["NIF: ",t.company.nif," / STAT: ",t.company.stat," / RC: ",t.company.rc]}),n.jsxs("p",{className:"text-xs",children:["Tel: ",t.company.phone]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("h2",{className:"text-2xl font-bold uppercase",children:s("packingAndWeightList")}),n.jsxs("p",{className:"mt-2",children:[s("invoiceNoLabel"),": ",e.invoiceNo]}),n.jsxs("p",{className:"mt-1",children:[s("dateLabel"),": ",h]})]})]}),n.jsxs("section",{className:"text-sm mb-8 space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("senderLabel"),":"]}),n.jsxs("span",{className:"col-span-4",children:[t.company.name," / PC ",e.debtor]})]}),n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("recipientLabel"),":"]}),n.jsxs("div",{className:"col-span-4",children:[n.jsx("p",{children:e.notifyParty}),n.jsxs("p",{children:[e.city,", ",m]})]})]}),n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("natureLabel"),":"]}),n.jsx("span",{className:"col-span-4",children:e.nature})]}),n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("packageCountLabel"),":"]}),n.jsxs("span",{className:"col-span-4",children:[c," ",s("bales")]})]}),n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("grossWeightLabel"),":"]}),n.jsxs("span",{className:"col-span-4",children:[Fe(f,t.localization)," Kg"]})]}),n.jsxs("div",{className:"grid grid-cols-5",children:[n.jsxs("strong",{className:"col-span-1",children:[s("netWeightLabel"),":"]}),n.jsxs("span",{className:"col-span-4",children:[Fe(u,t.localization)," Kg"]})]})]}),n.jsxs("table",{className:"w-full border-collapse border border-black text-sm mb-8 text-black",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-100",children:[n.jsx("th",{className:"border border-black p-1",children:s("containerNo")}),n.jsx("th",{className:"border border-black p-1",children:s("sealNo")}),n.jsx("th",{className:"border border-black p-1",children:s("tareKg")}),n.jsx("th",{className:"border border-black p-1",children:s("packageWeightKg")}),n.jsx("th",{className:"border border-black p-1",children:s("seaweedType")}),n.jsx("th",{className:"border border-black p-1",children:s("netWeightLabel")}),n.jsx("th",{className:"border border-black p-1",children:s("packages")}),n.jsx("th",{className:"border border-black p-1",children:s("grossWeightLabel")})]})}),n.jsxs("tbody",{children:[e.containers.map(y=>n.jsxs("tr",{children:[n.jsx("td",{className:"border border-black p-1",children:y.containerNo}),n.jsx("td",{className:"border border-black p-1",children:y.sealNo}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(y.tareKg,t.localization)," Kg"]}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(y.packageWeightKg||0,t.localization)," Kg"]}),n.jsx("td",{className:"border border-black p-1",children:l==null?void 0:l.name}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(y.seaweedWeightKg,t.localization)," Kg"]}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[y.packagesCount," ",s("bales")]}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(y.grossWeightKg,t.localization)," Kg"]})]},y.id)),n.jsxs("tr",{className:"font-bold bg-gray-100",children:[n.jsx("td",{colSpan:5,className:"border border-black p-1"}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(u,t.localization)," Kg"]}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[c," ",s("bales")]}),n.jsxs("td",{className:"border border-black p-1 text-right",children:[Fe(f,t.localization)," Kg"]})]})]})]}),n.jsx("p",{className:"text-sm mb-16",children:s("customsWeighingStatement")}),n.jsx("p",{className:"text-sm mb-8 text-center",children:s("signedAtLocation").replace("{location}","Antsiranana").replace("{date}",h)}),n.jsx("footer",{className:"mt-16 text-right",children:n.jsxs("div",{className:"inline-block text-center",children:[n.jsx("p",{className:"mb-16",children:s("theManager")}),n.jsx("hr",{className:"border-black"}),n.jsxs("p",{className:"text-sm",children:[s("perProcurationem")," ",t.company.name]})]})})]})},vP=({doc:e})=>{var f,h;const{settings:t}=Ke(),{t:s}=we(),a=e.containers.reduce((m,x)=>m+x.packagesCount,0),i=e.containers.reduce((m,x)=>m+x.seaweedWeightKg,0),l=e.containers.reduce((m,x)=>m+x.grossWeightKg,0),c=((f=Jt.find(m=>m.code===e.countryOfOrigin))==null?void 0:f.name)||e.countryOfOrigin,u=((h=Jt.find(m=>m.name.toLowerCase()===e.destinationCountry.toLowerCase()))==null?void 0:h.name)||e.destinationCountry;return n.jsx(ks,{children:n.jsxs("div",{className:"border-2 border-black p-4",children:[n.jsx("header",{className:"text-center mb-6",children:n.jsx("h1",{className:"text-2xl font-bold uppercase",children:s("CERTIFICATE_OF_ORIGIN")})}),n.jsx("table",{className:"w-full border-collapse text-xs text-black",children:n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black w-1/2",children:[n.jsxs("p",{className:"font-bold",children:["1. ",s("exporter")]}),n.jsx("p",{className:"pl-4",children:t.company.name}),n.jsx("p",{className:"pl-4",children:t.company.address})]}),n.jsxs("td",{className:"p-2 border border-black w-1/2",rowSpan:2,children:[n.jsx("p",{className:"font-bold text-center",children:s("CERTIFICATE_OF_ORIGIN").toUpperCase()}),n.jsxs("p",{className:"text-center",children:[s("refNo")," ",e.docNo]})]})]}),n.jsx("tr",{children:n.jsxs("td",{className:"p-2 border border-black w-1/2",children:[n.jsxs("p",{className:"font-bold",children:["2. ",s("consignee")]}),n.jsx("p",{className:"pl-4 font-semibold",children:e.notifyParty}),e.notifyPartyAddress?n.jsx("p",{className:"pl-4 whitespace-pre-wrap",children:e.notifyPartyAddress}):n.jsxs("p",{className:"pl-4",children:[e.city,", ",u]}),(e.notifyPartyPhone||e.notifyPartyEmail)&&n.jsxs("p",{className:"pl-4 mt-1 text-xs",children:[e.notifyPartyPhone&&n.jsxs("span",{children:["Tel: ",e.notifyPartyPhone," "]}),e.notifyPartyEmail&&n.jsxs("span",{children:["Email: ",e.notifyPartyEmail]})]})]})}),n.jsx("tr",{children:n.jsxs("td",{colSpan:2,className:"p-2 border border-black",children:[n.jsxs("p",{className:"font-bold",children:["3. ",s("transportDetails")]}),n.jsxs("p",{className:"pl-4",children:[s("vessel"),": ",e.vessel," / ",s("voyageNo"),": ",e.voyageNo]}),n.jsxs("p",{className:"pl-4",children:[s("seaWaybill"),": ",e.seaWaybill]})]})}),n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["4. ",s("marksAndNumbers")]}),n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["5. ",s("packagesAndDescription")]})]}),n.jsxs("tr",{children:[n.jsx("td",{className:"p-2 border border-black align-top h-24",children:e.containers.map(m=>n.jsx("p",{children:m.containerNo},m.id))}),n.jsxs("td",{className:"p-2 border border-black align-top h-24",children:[n.jsxs("p",{children:[a," ",s("bales")]}),n.jsx("p",{children:e.nature}),n.jsxs("p",{children:["HS Code: ",e.customsNomenclature]})]})]}),n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["6. ",s("originCriterion")]}),n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["7. ",s("quantity")]})]}),n.jsxs("tr",{children:[n.jsx("td",{className:"p-2 border border-black align-top h-16",children:s("originCriterionA")}),n.jsxs("td",{className:"p-2 border border-black align-top h-16",children:[n.jsxs("p",{children:[s("netWeightLabel"),": ",Fe(i,t.localization)," KGS"]}),n.jsxs("p",{children:[s("grossWeightLabel"),": ",Fe(l,t.localization)," KGS"]})]})]}),n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["8. ",s("invoiceNumberAndDate")]}),n.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["9. ",s("remarks")]})]}),n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black align-top h-12",children:[e.invoiceNo," / ",e.date]}),n.jsx("td",{className:"p-2 border border-black align-top h-12"})]}),n.jsxs("tr",{children:[n.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[n.jsxs("p",{className:"font-bold",children:["10. ",s("declarationByExporter")]}),n.jsx("p",{className:"mt-1",children:s("exporterDeclarationText")}),n.jsx("p",{className:"font-bold text-center mt-2",children:c}),n.jsx("div",{className:"mt-8 text-right",children:n.jsx("p",{className:"border-t border-black pt-1 inline-block",children:s("placeDateSignature")})})]}),n.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[n.jsxs("p",{className:"font-bold",children:["11. ",s("certification")]}),n.jsx("p",{className:"mt-1",children:s("certificationText")}),n.jsx("div",{className:"mt-16 text-right",children:n.jsx("p",{className:"border-t border-black pt-1 inline-block",children:s("placeDateSignature")})})]})]})]})})]})})},bP=({isOpen:e,onClose:t,doc:s,docTypeToShow:a})=>{const{t:i}=we(),{settings:l}=Ke(),[c,u]=S.useState(!1),f=()=>{switch(a){case"invoice":return`${i("printInvoice")} - ${s.docNo}`;case"packing-list":return`${i("printPackingList")} - ${s.docNo}`;case"cert-of-origin":return`${i("printCertOfOrigin")} - ${s.docNo}`;case"all":default:return`${i("printDocumentsFor")} ${s.docNo}`}},h=()=>{window.print()},m=async()=>{u(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:x}=window.jspdf,y=window.html2canvas,b=document.getElementById("printable-area");if(!b)throw new Error("Printable area not found");const T=new x({orientation:"p",unit:"mm",format:"a4",compress:!0});T.setProperties({title:`Export Documents - ${s.docNo}`,subject:"Export Documentation",author:l.company.name,creator:"AlgaManage"});const _=b.getElementsByClassName("print-page");for(let j=0;j<_.length;j++){const k=(await y(_[j],{scale:4,useCORS:!0,windowWidth:1200,backgroundColor:"#ffffff"})).toDataURL("image/png");j>0&&T.addPage();const C=T.getImageProperties(k),A=T.internal.pageSize.getWidth(),M=C.height*A/C.width;T.addImage(k,"PNG",0,0,A,M,void 0,"FAST")}T.save(`Export-Documents-${s.docNo}.pdf`)}catch(x){console.error("Error generating PDF:",x),alert(i("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),u(!1)}};return n.jsxs(ot,{isOpen:e,onClose:t,title:f(),widthClass:"max-w-screen-lg",children:[n.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[n.jsxs(se,{onClick:m,disabled:c,className:"rounded-full !px-4 shadow-sm",children:[n.jsx(te,{name:c?"Activity":"Download",className:`w-5 h-5 ${c?"animate-spin":""}`}),n.jsx("span",{className:"ml-2",children:i(c?"downloading":"downloadPdf")})]}),n.jsxs(se,{onClick:h,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[n.jsx(te,{name:"Printer",className:"w-5 h-5"}),n.jsx("span",{className:"ml-2",children:i("print")})]})]})}),n.jsxs("div",{id:"printable-area",className:"bg-gray-200 dark:bg-gray-700 p-4 sm:p-8",children:[(a==="invoice"||a==="all")&&n.jsx(yP,{doc:s}),(a==="packing-list"||a==="all")&&n.jsx(xP,{doc:s}),(a==="cert-of-origin"||a==="all")&&n.jsx(vP,{doc:s})]})]})},NP=()=>{const{t:e}=we(),{settings:t}=Ke(),{exportDocuments:s,seaweedTypes:a,deleteExportDocument:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(!1),[x,y]=S.useState(null),[b,T]=S.useState({key:"date",direction:"descending"}),[_,j]=S.useState(!1),[E,k]=S.useState(null),[C,A]=S.useState("all"),[M,I]=S.useState(null),P=S.useRef(null),D=S.useMemo(()=>new Map(a.map(Q=>[Q.id,Q.name])),[a]),U=S.useMemo(()=>{let Q=s.map(W=>({...W,totalValue:W.containers.reduce((ae,$)=>ae+$.value,0)}));return Q.sort((W,ae)=>{let $,ie;switch(b.key){case"seaweedTypeName":$=D.get(W.seaweedTypeId)||"",ie=D.get(ae.seaweedTypeId)||"";break;case"totalValue":$=W.totalValue,ie=ae.totalValue;break;default:$=W[b.key],ie=ae[b.key]}return $==null?1:ie==null?-1:$<ie?b.direction==="ascending"?-1:1:$>ie?b.direction==="ascending"?1:-1:0}),Q},[s,b,D]);S.useEffect(()=>{const Q=W=>{P.current&&!P.current.contains(W.target)&&I(null)};return document.addEventListener("mousedown",Q),()=>{document.removeEventListener("mousedown",Q)}},[]);const O=Q=>{let W="ascending";b.key===Q&&b.direction==="ascending"&&(W="descending"),T({key:Q,direction:W})},F=Q=>b.key!==Q?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):b.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),q=({sortKey:Q,label:W,className:ae})=>n.jsx("th",{className:`p-3 ${ae}`,children:n.jsxs("button",{onClick:()=>O(Q),className:`group flex items-center gap-2 w-full ${ae!=null&&ae.includes("text-right")?"justify-end":""}`,children:[W,F(Q)]})}),z=(Q=null)=>{f(Q),c(!0)},Y=()=>{f(null),c(!1)},J=Q=>{y(Q),m(!0)},G=()=>{x&&i(x),m(!1),y(null)},B=(Q,W)=>{k(Q),A(W),j(!0),I(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:e("exports")}),n.jsxs(se,{onClick:()=>z(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("createExportDocument")]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(q,{sortKey:"docNo",label:e("docNo")}),n.jsx(q,{sortKey:"date",label:e("date")}),n.jsx(q,{sortKey:"invoiceNo",label:e("invoiceNo")}),n.jsx(q,{sortKey:"seaweedTypeName",label:e("seaweedType")}),n.jsx(q,{sortKey:"destinationCountry",label:e("destination")}),n.jsx("th",{className:"p-3 text-center",children:e("containers")}),n.jsx(q,{sortKey:"totalValue",label:e("totalValue"),className:"text-right"}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[U.map(Q=>{const W=Q.currency==="EUR"?"":Q.currency==="USD"?"$":Q.currency;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-mono",children:Q.docNo}),n.jsx("td",{className:"p-3",children:Q.date}),n.jsx("td",{className:"p-3",children:Q.invoiceNo}),n.jsx("td",{className:"p-3",children:D.get(Q.seaweedTypeId)||Q.seaweedTypeId}),n.jsx("td",{className:"p-3",children:Q.destinationCountry}),n.jsx("td",{className:"p-3 text-center",children:Q.containers.length}),n.jsx("td",{className:"p-3 text-right",children:Ae(Q.totalValue,{...t.localization,currencySymbol:W})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"relative flex justify-end gap-1",ref:M===Q.id?P:null,children:[n.jsxs(se,{variant:"ghost",onClick:()=>I(M===Q.id?null:Q.id),children:[e("documents"),n.jsx(te,{name:"ChevronDown",className:"w-4 h-4"})]}),M===Q.id&&n.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-md shadow-lg z-10 p-1",children:[n.jsxs("button",{onClick:()=>B(Q,"invoice"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"FileText",className:"w-4 h-4"})," ",e("printInvoice")]}),n.jsxs("button",{onClick:()=>B(Q,"packing-list"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"Package",className:"w-4 h-4"})," ",e("printPackingList")]}),n.jsxs("button",{onClick:()=>B(Q,"cert-of-origin"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"Globe",className:"w-4 h-4"})," ",e("printCertOfOrigin")]}),n.jsx("div",{className:"my-1 border-t dark:border-gray-600"}),n.jsxs("button",{onClick:()=>B(Q,"all"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[n.jsx(te,{name:"Printer",className:"w-4 h-4"})," ",e("printAllDocuments")]})]}),n.jsx(se,{variant:"ghost",onClick:()=>z(Q),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>J(Q.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},Q.id)}),U.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:e("noDataForReport")})})]})]})})}),l&&n.jsx(gP,{isOpen:l,onClose:Y,doc:u}),_&&E&&n.jsx(bP,{isOpen:_,onClose:()=>j(!1),doc:E,docTypeToShow:C}),h&&n.jsx(zt,{isOpen:h,onClose:()=>m(!1),onConfirm:G,title:e("confirmDeleteTitle"),message:e("confirmDeleteExport")})]})},SP=()=>{const{t:e}=we(),{serviceProviders:t,addServiceProvider:s,updateServiceProvider:a,deleteServiceProvider:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(!1),[x,y]=S.useState(null),[b,T]=S.useState({key:"name",direction:"ascending"}),_=S.useMemo(()=>{let P=[...t];return P.sort((D,U)=>{const O=D[b.key]||"",F=U[b.key]||"";return O<F?b.direction==="ascending"?-1:1:O>F?b.direction==="ascending"?1:-1:0}),P},[t,b]),j=P=>{let D="ascending";b.key===P&&b.direction==="ascending"&&(D="descending"),T({key:P,direction:D})},E=P=>b.key!==P?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):b.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),k=({sortKey:P,label:D,className:U})=>n.jsx("th",{className:`p-3 ${U}`,children:n.jsxs("button",{onClick:()=>j(P),className:`group flex items-center gap-2 w-full ${U!=null&&U.includes("text-right")?"justify-end":""}`,children:[D,E(P)]})}),C=(P=null)=>{f(P),c(!0)},A=()=>{f(null),c(!1)},M=P=>{y(P),m(!0)},I=()=>{x&&i(x),m(!1),y(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("serviceProvidersTitle")}),n.jsxs(se,{onClick:()=>C(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("addProvider")]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(k,{sortKey:"name",label:e("name")}),n.jsx(k,{sortKey:"serviceType",label:e("serviceType")}),n.jsx(k,{sortKey:"contactPerson",label:e("contactPerson")}),n.jsx(k,{sortKey:"phone",label:e("phone")}),n.jsx(k,{sortKey:"email",label:e("email")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[_.map(P=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-semibold",children:P.name}),n.jsx("td",{className:"p-3",children:P.serviceType}),n.jsx("td",{className:"p-3",children:P.contactPerson||"-"}),n.jsx("td",{className:"p-3",children:P.phone}),n.jsx("td",{className:"p-3",children:P.email||"-"}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>C(P),children:[n.jsx(te,{name:"Settings",className:"w-4 h-4"}),e("edit")]}),n.jsx(se,{variant:"danger",onClick:()=>M(P.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},P.id)),_.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"p-6 text-center text-gray-500",children:e("noProviders")})})]})]})})}),l&&n.jsx(wP,{isOpen:l,onClose:A,provider:u,onSave:P=>{u?a({...u,...P}):s(P),A()}}),h&&n.jsx(zt,{isOpen:h,onClose:()=>m(!1),onConfirm:I,title:e("confirmDeleteTitle"),message:e("confirmDeleteProvider")})]})},wP=({isOpen:e,onClose:t,provider:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState({name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]}),[u,f]=S.useState({});S.useEffect(()=>{c(s?{name:s.name,serviceType:s.serviceType,contactPerson:s.contactPerson||"",phone:s.phone,email:s.email||"",address:s.address||"",joinDate:s.joinDate||new Date().toISOString().split("T")[0]}:{name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]})},[s,e]);const h=S.useCallback(()=>{const b={};return l.name.trim()||(b.name=i("validationRequired")),l.serviceType.trim()||(b.serviceType=i("validationRequired")),l.phone.trim()||(b.phone=i("validationRequired")),l.email&&!/\S+@\S+\.\S+/.test(l.email)&&(b.email=i("validationEmail")),b},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(b,T)=>{c(_=>({..._,[b]:T}))},x=b=>{b.preventDefault();const T=h();if(Object.keys(T).length>0){f(T);return}a({...l,status:(s==null?void 0:s.status)||Jf.ACTIVE,contactPerson:l.contactPerson||void 0,email:l.email||void 0,address:l.address||void 0})},y=Object.keys(u).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i(s?"editProvider":"addProvider"),widthClass:"max-w-3xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:x,disabled:y,children:i("save")})]}),children:n.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:i("name"),value:l.name,onChange:b=>m("name",b.target.value),error:u.name,required:!0,autoFocus:!0}),n.jsx(de,{label:i("serviceType"),value:l.serviceType,onChange:b=>m("serviceType",b.target.value),error:u.serviceType,required:!0}),n.jsx(de,{label:`${i("contactPerson")} (${i("optional")})`,value:l.contactPerson,onChange:b=>m("contactPerson",b.target.value)}),n.jsx(de,{label:i("phone"),value:l.phone,onChange:b=>m("phone",b.target.value),error:u.phone,required:!0}),n.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:l.email,onChange:b=>m("email",b.target.value),error:u.email}),n.jsx(de,{label:i("hireDate"),type:"date",value:l.joinDate,onChange:b=>m("joinDate",b.target.value),required:!0}),n.jsx(de,{containerClassName:"md:col-span-2",label:`${i("address")} (${i("optional")})`,value:l.address,onChange:b=>m("address",b.target.value)})]})})},TP=({weights:e,onChange:t})=>{const{t:s}=we(),[a,i]=S.useState([]);S.useEffect(()=>{const c=[...e.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[e.length]);const l=(c,u)=>{const f=[...a];if(f[c]=u,c===f.length-1&&u.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);t(h)};return n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s("bagWeights")}),n.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:a.map((c,u)=>n.jsx(de,{type:"number",step:"any",placeholder:`${s("sac")} ${u+1}`,value:c,onChange:f=>l(u,f.target.value),className:"text-center"},u))})]})},jP=({isOpen:e,onClose:t})=>{const{t:s}=we(),{settings:a}=Ke(),{sites:i,farmers:l,seaweedTypes:c,addFarmerDelivery:u,getFarmersBySite:f,stockMovements:h}=He(),[m,x]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",seaweedTypeId:"",destination:"PRESSING_WAREHOUSE_BULK"}),[y,b]=S.useState([]),[T,_]=S.useState([]),[j,E]=S.useState({});S.useEffect(()=>{var U,O;if(e){const F=((U=i.find(q=>q.id!=="pressing-warehouse"))==null?void 0:U.id)||"";x({date:new Date().toISOString().split("T")[0],siteId:F,farmerId:"",seaweedTypeId:((O=c[0])==null?void 0:O.id)||"",destination:"PRESSING_WAREHOUSE_BULK"}),b([]),_(f(F)),E({})}},[e,i,c,f]);const k=S.useMemo(()=>({totalWeightKg:y.reduce((U,O)=>U+O,0),totalBags:y.length}),[y]),C=S.useMemo(()=>{if(!m.siteId||!m.seaweedTypeId)return{kg:0,bags:0};const U=h.filter(Y=>Y.siteId===m.siteId&&Y.seaweedTypeId===m.seaweedTypeId),O=U.reduce((Y,J)=>Y+(J.inKg||0),0),F=U.reduce((Y,J)=>Y+(J.outKg||0),0),q=U.reduce((Y,J)=>Y+(J.inBags||0),0),z=U.reduce((Y,J)=>Y+(J.outBags||0),0);return{kg:O-F,bags:q-z}},[m.siteId,m.seaweedTypeId,h]),A=S.useCallback(()=>{const U={};return m.date||(U.date=s("validationRequired")),m.siteId||(U.siteId=s("validationRequired")),m.farmerId||(U.farmerId=s("validationRequired")),m.seaweedTypeId||(U.seaweedTypeId=s("validationRequired")),k.totalWeightKg<=0&&(U.bagWeights=s("validationAtLeastOneRequired")),U},[m,k,s]);S.useEffect(()=>{E(A())},[m,k,A]);const M=(U,O)=>{x(F=>({...F,[U]:O}))},I=U=>{x(O=>({...O,siteId:U,farmerId:""})),_(f(U))},P=U=>{U.preventDefault();const O=A();if(Object.keys(O).length>0){E(O);return}u({...m,totalWeightKg:k.totalWeightKg,totalBags:k.totalBags,bagWeights:y}),t()},D=Object.keys(j).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:s("newDelivery"),widthClass:"max-w-4xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:s("cancel")}),n.jsx(se,{onClick:P,disabled:D,children:s("receivedAtWarehouse")})]}),children:n.jsxs("form",{onSubmit:P,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:s("date"),type:"date",value:m.date,onChange:U=>M("date",U.target.value),error:j.date,required:!0}),n.jsxs(ke,{label:s("site"),value:m.siteId,onChange:U=>I(U.target.value),error:j.siteId,required:!0,children:[n.jsx("option",{value:"",children:s("selectSite")}),i.filter(U=>U.id!=="pressing-warehouse").map(U=>n.jsx("option",{value:U.id,children:U.name},U.id))]}),n.jsxs(ke,{label:s("farmerLabel"),value:m.farmerId,onChange:U=>M("farmerId",U.target.value),error:j.farmerId,disabled:!m.siteId,required:!0,children:[n.jsx("option",{value:"",children:s("selectFarmer")}),T.map(U=>n.jsxs("option",{value:U.id,children:[U.firstName," ",U.lastName]},U.id))]}),n.jsxs(ke,{label:s("seaweedType"),value:m.seaweedTypeId,onChange:U=>M("seaweedTypeId",U.target.value),error:j.seaweedTypeId,required:!0,children:[n.jsx("option",{value:"",children:s("selectType")}),c.map(U=>n.jsx("option",{value:U.id,children:U.name},U.id))]}),n.jsxs(ke,{containerClassName:"md:col-span-2",label:s("destination"),value:m.destination,onChange:U=>M("destination",U.target.value),children:[n.jsx("option",{value:"PRESSING_WAREHOUSE_BULK",children:s("pressedWarehouseTitle")}),n.jsx("option",{value:"SITE_STORAGE",children:s("onSiteStorageTitle")})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[n.jsxs("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:[s("currentStock")," (",s("kg"),")"]}),n.jsx("p",{className:"text-xl font-bold",children:Fe(C.kg,a.localization)})]}),n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[n.jsx("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:s("stockBags")}),n.jsx("p",{className:"text-xl font-bold",children:Fe(C.bags,{...a.localization,nonMonetaryDecimals:0})})]})]}),n.jsx(TP,{weights:y,onChange:b}),j.bagWeights&&n.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:j.bagWeights}),n.jsx("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[n.jsxs("span",{children:[s("totalWeightKgDelivery"),":"]}),n.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[k.totalWeightKg.toFixed(2)," kg ",n.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",k.totalBags," ",s("bags"),")"]})]})]})})]})})},_P=()=>{const{t:e}=we(),{settings:t}=Ke(),{farmerDeliveries:s,sites:a,farmers:i,seaweedTypes:l,deleteFarmerDelivery:c}=He(),[u,f]=S.useState(!1),[h,m]=S.useState(!1),[x,y]=S.useState(null),[b,T]=S.useState({key:"date",direction:"descending"}),_=S.useMemo(()=>new Map(a.map(D=>[D.id,D.name])),[a]),j=S.useMemo(()=>new Map(i.map(D=>[D.id,`${D.firstName} ${D.lastName}`])),[i]),E=S.useMemo(()=>new Map(l.map(D=>[D.id,D.name])),[l]),k=S.useMemo(()=>{let D=[...s];return D.sort((U,O)=>{let F,q;return b.key==="siteName"?F=_.get(U.siteId)||"":b.key==="farmerName"?F=j.get(U.farmerId)||"":b.key==="seaweedTypeName"?F=E.get(U.seaweedTypeId)||"":F=U[b.key],b.key==="siteName"?q=_.get(O.siteId)||"":b.key==="farmerName"?q=j.get(O.farmerId)||"":b.key==="seaweedTypeName"?q=E.get(O.seaweedTypeId)||"":q=O[b.key],F==null?1:q==null?-1:F<q?b.direction==="ascending"?-1:1:F>q?b.direction==="ascending"?1:-1:0}),D},[s,b,_,j,E]),C=D=>{let U="ascending";b.key===D&&b.direction==="ascending"&&(U="descending"),T({key:D,direction:U})},A=D=>b.key!==D?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):b.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),M=({sortKey:D,label:U,className:O})=>n.jsx("th",{className:`p-3 ${O}`,children:n.jsxs("button",{onClick:()=>C(D),className:`group flex items-center gap-2 w-full ${O!=null&&O.includes("text-right")?"justify-end":""}`,children:[U,A(D)]})}),I=D=>{y(D),m(!0)},P=()=>{x&&c(x),m(!1),y(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("farmerDeliveriesTitle")}),n.jsxs(se,{onClick:()=>f(!0),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("recordDelivery")]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(M,{sortKey:"slipNo",label:e("slipNo")}),n.jsx(M,{sortKey:"date",label:e("date")}),n.jsx(M,{sortKey:"siteName",label:e("site")}),n.jsx(M,{sortKey:"farmerName",label:e("farmerLabel")}),n.jsx(M,{sortKey:"seaweedTypeName",label:e("seaweedType")}),n.jsx(M,{sortKey:"totalWeightKg",label:e("totalWeightKgDelivery"),className:"text-right"}),n.jsx(M,{sortKey:"totalBags",label:e("totalBags"),className:"text-right"}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[k.map(D=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 font-mono",children:D.slipNo}),n.jsx("td",{className:"p-3",children:D.date}),n.jsx("td",{className:"p-3",children:_.get(D.siteId)||e("unknown")}),n.jsx("td",{className:"p-3",children:j.get(D.farmerId)||e("unknown")}),n.jsx("td",{className:"p-3",children:E.get(D.seaweedTypeId)||e("unknown")}),n.jsx("td",{className:"p-3 text-right",children:Fe(D.totalWeightKg,t.localization)}),n.jsx("td",{className:"p-3 text-right",children:D.totalBags}),n.jsx("td",{className:"p-3 text-right",children:n.jsx("div",{className:"flex justify-end gap-2",children:n.jsx(se,{variant:"danger",onClick:()=>I(D.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})})]},D.id)),k.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:e("noDeliveriesRecorded")})})]})]})})}),u&&n.jsx(jP,{isOpen:u,onClose:()=>f(!1)}),h&&n.jsx(zt,{isOpen:h,onClose:()=>m(!1),onConfirm:P,title:e("confirmDeleteTitle"),message:e("confirmDeleteDelivery")})]})},EP=()=>{const{t:e}=we(),{settings:t}=Ke(),{cuttingOperations:s,sites:a,serviceProviders:i,modules:l,farmers:c,deleteCuttingOperation:u}=He(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[y,b]=S.useState(!1),[T,_]=S.useState(null),[j,E]=S.useState({key:"date",direction:"descending"}),k=S.useMemo(()=>new Map(a.map(J=>[J.id,J.name])),[a]),C=S.useMemo(()=>new Map(i.map(J=>[J.id,J.name])),[i]),A=S.useMemo(()=>new Map(c.map(J=>[J.id,`${J.firstName} ${J.lastName}`])),[c]),M=S.useMemo(()=>{const J=new Map;return l.forEach(G=>{const B=G.farmerId?A.get(G.farmerId):void 0;J.set(G.id,{code:G.code,farmerName:B})}),J},[l,A]),I=S.useMemo(()=>{let J=[...s];return J.sort((G,B)=>{let Q,W;return j.key==="siteName"?(Q=k.get(G.siteId)||"",W=k.get(B.siteId)||""):j.key==="providerName"?(Q=C.get(G.serviceProviderId)||"",W=C.get(B.serviceProviderId)||""):(Q=G[j.key],W=B[j.key]),Q<W?j.direction==="ascending"?-1:1:Q>W?j.direction==="ascending"?1:-1:0}),J},[s,j,k,C]),P=J=>{let G="ascending";j.key===J&&j.direction==="ascending"&&(G="descending"),E({key:J,direction:G})},D=J=>j.key!==J?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):j.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),U=({sortKey:J,label:G,className:B})=>n.jsx("th",{className:`p-3 ${B}`,children:n.jsxs("button",{onClick:()=>P(J),className:`group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors w-full ${B!=null&&B.includes("text-right")?"justify-end":""} ${B!=null&&B.includes("text-center")?"justify-center":""}`,children:[G,D(J)]})}),O=J=>{x(J),h(!0)},F=()=>{x(null),h(!0)},q=()=>{x(null),h(!1)},z=J=>{_(J),b(!0)},Y=()=>{T&&u(T),b(!1),_(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:e("cuttingOperationsTitle")}),n.jsxs(se,{onClick:F,children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("newPlanting")]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(U,{sortKey:"date",label:e("date")}),n.jsx(U,{sortKey:"siteName",label:e("site")}),n.jsx(U,{sortKey:"providerName",label:e("serviceProvider")}),n.jsx("th",{className:"p-3",children:e("beneficiaryFarmers")}),n.jsx("th",{className:"p-3",children:e("modules")}),n.jsx(U,{sortKey:"totalAmount",label:e("totalAmount"),className:"text-right"}),n.jsx(U,{sortKey:"isPaid",label:e("status"),className:"text-center"}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsx("tbody",{children:I.map(J=>{const G=(()=>{if(J.beneficiaryFarmerId){const ae=A.get(J.beneficiaryFarmerId);return ae?[ae]:[]}const W=J.moduleCuts.map(ae=>ae.moduleId).map(ae=>{var $;return($=l.find(ie=>ie.id===ae))==null?void 0:$.farmerId}).filter(ae=>!!ae);return[...new Set(W)].map(ae=>A.get(ae)).filter(ae=>!!ae)})(),B=J.moduleCuts.map(Q=>{const W=M.get(Q.moduleId);return W?`${W.code} (${Q.linesCut} l.)`:n.jsxs("span",{className:"font-mono text-[10px] text-gray-500",children:[e("unknown")," (ID: ",Q.moduleId.substring(0,6),")"]})});return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700",children:[n.jsx("td",{className:"p-3",children:J.date}),n.jsx("td",{className:"p-3",title:J.siteId,children:k.get(J.siteId)||e("unknown")}),n.jsx("td",{className:"p-3",title:J.serviceProviderId,children:C.get(J.serviceProviderId)||e("unknown")}),n.jsx("td",{className:"p-3",children:G.length>0?n.jsxs("div",{className:"relative group",children:[n.jsx("span",{className:"truncate",children:G[0]}),G.length>1&&n.jsxs("span",{className:"ml-1 text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full",children:["+",G.length-1]}),n.jsx("div",{className:"absolute bottom-full mb-2 w-max max-w-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10 p-2 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg",children:G.join(", ")})]}):n.jsx("span",{className:"text-gray-500 italic",children:e("noBeneficiary")})}),n.jsx("td",{className:"p-3",children:n.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[B.slice(0,3).map((Q,W)=>n.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full whitespace-nowrap flex items-center",children:Q},W)),B.length>3&&n.jsx("div",{className:"relative group",children:n.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full cursor-pointer",children:"..."})})]})}),n.jsx("td",{className:"p-3 text-right",children:Ae(J.totalAmount,t.localization)}),n.jsx("td",{className:"p-3 text-center",children:J.isPaid?n.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:e("paid")}):n.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",children:e("unpaid")})}),n.jsx("td",{className:"p-3",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>O(J),children:[n.jsx(te,{name:"Settings",className:"w-4 h-4"}),e("edit")]}),n.jsxs(se,{variant:"danger",onClick:()=>z(J.id),children:[n.jsx(te,{name:"Trash2",className:"w-4 h-4"}),e("delete")]})]})})]},J.id)})})]})})}),f&&n.jsx(bN,{isOpen:f,onClose:q,operationToEdit:m}),y&&n.jsx(zt,{isOpen:y,onClose:()=>b(!1),onConfirm:Y,title:e("confirmDeleteTitle"),message:e("confirmDeleteCuttingOperation")})]})},CP=({weights:e,onChange:t})=>{const{t:s}=we(),a=S.useMemo(()=>{const l=[...e.map(String)],c=Math.max(1,Math.ceil((l.length+1)/10));for(;l.length<c*10;)l.push("");return l},[e]),i=(l,c)=>{const u=[...a];u[l]=c;const f=u.map(h=>parseFloat(h)).filter(h=>!isNaN(h)&&h>0);t(f)};return n.jsxs("div",{className:"space-y-2 col-span-1 md:col-span-2",children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s("bagWeights")," (Kg)"]}),n.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-48 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:a.map((l,c)=>n.jsx(de,{type:"number",step:"0.01",placeholder:`${s("sac")} ${c+1}`,value:l,onChange:u=>i(c,u.target.value),className:"text-center text-xs"},c))}),n.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[s("totalBags"),": ",e.length]})]})},IP=({isOpen:e,onClose:t})=>{const{t:s}=we(),{settings:a}=Ke(),{sites:i,seaweedTypes:l,employees:c,addSiteTransfer:u,stockMovements:f}=He(),h=S.useMemo(()=>({date:new Date().toISOString().split("T")[0],sourceSiteId:"",destinationSiteId:"",seaweedTypeId:"",managerId:"",transporter:"",transport:"Truck",representative:""}),[]),[m,x]=S.useState(h),[y,b]=S.useState([]),[T,_]=S.useState({});S.useEffect(()=>{var D,U;e&&(x({...h,sourceSiteId:((D=i.find(O=>O.id!=="pressing-warehouse"))==null?void 0:D.id)||"",seaweedTypeId:((U=l[0])==null?void 0:U.id)||""}),b([]),_({}))},[e,i,l,h]);const j=S.useMemo(()=>({totalWeightKg:y.reduce((D,U)=>D+U,0),totalBags:y.length}),[y]),E=S.useMemo(()=>{if(!m.sourceSiteId||!m.seaweedTypeId)return{kg:0,bags:0};const D=f.filter(z=>z.siteId===m.sourceSiteId&&z.seaweedTypeId===m.seaweedTypeId),U=D.reduce((z,Y)=>z+(Y.inKg||0),0),O=D.reduce((z,Y)=>z+(Y.outKg||0),0),F=D.reduce((z,Y)=>z+(Y.inBags||0),0),q=D.reduce((z,Y)=>z+(Y.outBags||0),0);return{kg:U-O,bags:F-q}},[m.sourceSiteId,m.seaweedTypeId,f]),k=S.useMemo(()=>({kg:E.kg-j.totalWeightKg,bags:E.bags-j.totalBags}),[E,j]),C=S.useMemo(()=>{const D={id:"pressing-warehouse",name:s("pressedWarehouseTitle")};return[...i.filter(O=>O.id!==m.sourceSiteId&&O.id!=="pressing-warehouse"),D]},[i,m.sourceSiteId,s]),A=S.useCallback(()=>{const D={};return m.date||(D.date=s("validationRequired")),m.sourceSiteId||(D.sourceSiteId=s("validationRequired")),m.destinationSiteId||(D.destinationSiteId=s("validationRequired")),m.sourceSiteId===m.destinationSiteId&&(D.destinationSiteId=s("validationSameSite")),m.seaweedTypeId||(D.seaweedTypeId=s("validationRequired")),m.transporter||(D.transporter=s("validationRequired")),j.totalBags===0&&(D.bagWeights=s("validationAtLeastOneRequired")),k.kg<0?D.bagWeights=s("validationStockUnavailableWeight").replace("{availableStock}",Fe(E.kg,a.localization)):k.bags<0&&(D.bagWeights=s("validationStockUnavailableBags").replace("{availableStock}",String(E.bags))),D},[m,j,k,E,s,a.localization]);S.useEffect(()=>{_(A())},[m,j,A]);const M=(D,U)=>{const O={...m,[D]:U};D==="sourceSiteId"&&U===O.destinationSiteId&&(O.destinationSiteId=""),x(O)},I=D=>{D.preventDefault();const U=A();if(Object.keys(U).length>0){_(U);return}const O={...m,managerId:m.managerId||void 0,representative:m.representative||void 0,weightKg:j.totalWeightKg,bags:j.totalBags,bagWeights:y};u(O),t()},P=Object.keys(T).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:s("createShippingSlip"),widthClass:"max-w-4xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:s("cancel")}),n.jsx(se,{onClick:I,disabled:P,children:s("save")})]}),children:n.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:s("originInformation")}),n.jsx(de,{label:s("date"),type:"date",value:m.date,onChange:D=>M("date",D.target.value),error:T.date,required:!0}),n.jsx(ke,{label:s("sourceSite"),value:m.sourceSiteId,onChange:D=>M("sourceSiteId",D.target.value),error:T.sourceSiteId,required:!0,children:i.filter(D=>D.id!=="pressing-warehouse").map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))}),n.jsx(ke,{label:s("seaweedType"),value:m.seaweedTypeId,onChange:D=>M("seaweedTypeId",D.target.value),error:T.seaweedTypeId,required:!0,children:l.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))}),n.jsxs("div",{className:`p-4 rounded-lg border ${k.kg<0?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-700/50":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[s("currentStock"),":"]}),n.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:[Fe(E.kg,a.localization)," Kg"]})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[s("stockBags"),":"]}),n.jsx("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:E.bags})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:s("destination")+" & Transport"}),n.jsxs(ke,{label:s("destinationSite"),value:m.destinationSiteId,onChange:D=>M("destinationSiteId",D.target.value),error:T.destinationSiteId,required:!0,children:[n.jsx("option",{value:"",children:s("selectSite")}),C.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs(ke,{label:s("transport"),value:m.transport,onChange:D=>M("transport",D.target.value),children:[n.jsx("option",{value:"Truck",children:s("transport_Truck")}),n.jsx("option",{value:"Boat",children:s("transport_Boat")})]}),n.jsx(de,{label:s("transporter"),value:m.transporter,onChange:D=>M("transporter",D.target.value),error:T.transporter,required:!0})]}),n.jsx(de,{label:s("representative"),value:m.representative,onChange:D=>M("representative",D.target.value),placeholder:"Nom du capitaine / chauffeur"}),n.jsxs(ke,{label:s("manager"),value:m.managerId,onChange:D=>M("managerId",D.target.value),children:[n.jsx("option",{value:"",children:s("noManager")}),c.map(D=>n.jsxs("option",{value:D.id,children:[D.firstName," ",D.lastName]},D.id))]})]}),n.jsxs("div",{className:"md:col-span-2 border-t pt-4",children:[n.jsx(CP,{weights:y,onChange:b}),T.bagWeights&&n.jsx("p",{className:"mt-2 text-sm text-red-600 font-medium",children:T.bagWeights})]}),n.jsxs("div",{className:"md:col-span-2 flex justify-end gap-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s("shippedBags")}),n.jsx("p",{className:"text-xl font-bold",children:j.totalBags})]}),n.jsxs("div",{className:"text-right border-l pl-6 border-gray-300 dark:border-gray-600",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s("shippedWeightKg")}),n.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[Fe(j.totalWeightKg,a.localization)," Kg"]})]})]})]})})},AP=({isOpen:e,onClose:t,transfer:s,action:a,onConfirm:i})=>{const{t:l}=we(),c=a===Gt.COMPLETED,[u,f]=S.useState({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:"",receivedBags:"",notes:""}),[h,m]=S.useState({});S.useEffect(()=>{e&&(f({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:String(s.weightKg),receivedBags:String(s.bags),notes:""}),m({}))},[e,s]);const x=S.useCallback(()=>{const j={};return u.completionDate||(j.completionDate=l("validationRequired")),c?((!u.receivedWeightKg||isNaN(parseFloat(u.receivedWeightKg))||parseFloat(u.receivedWeightKg)<0)&&(j.receivedWeightKg=l("validationNonNegative")),(!u.receivedBags||isNaN(parseInt(u.receivedBags,10))||parseInt(u.receivedBags,10)<0)&&(j.receivedBags=l("validationNonNegative"))):u.notes.trim()||(j.notes=l("validationRequired")),j},[u,c,l]);S.useEffect(()=>{m(x())},[u,x]);const y=(j,E)=>{f(k=>({...k,[j]:E}))},b=()=>{const j=x();if(Object.keys(j).length>0){m(j);return}const E={...s,status:a,completionDate:u.completionDate,notes:u.notes,receivedWeightKg:c?parseFloat(u.receivedWeightKg):void 0,receivedBags:c?parseInt(u.receivedBags,10):void 0};i(E)},T=l(c?"confirmCompleteTransferTitle":"confirmCancelTransferTitle"),_=c?parseFloat(u.receivedWeightKg||"0")-s.weightKg:0;return n.jsx(ot,{isOpen:e,onClose:t,title:T,footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:l("cancel")}),n.jsx(se,{onClick:b,disabled:Object.keys(h).length>0,children:l("confirm")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsx(de,{label:l(c?"completionDate":"cancellationDate"),type:"date",value:u.completionDate,onChange:j=>y("completionDate",j.target.value),error:h.completionDate,required:!0}),c?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800 text-sm mb-4",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[l("shippedWeightKg"),":"]})," ",s.weightKg," Kg"]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[l("shippedBags"),":"]})," ",s.bags]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx(de,{label:l("receivedWeightKg"),type:"number",step:"0.01",value:u.receivedWeightKg,onChange:j=>y("receivedWeightKg",j.target.value),error:h.receivedWeightKg,required:!0}),n.jsx(de,{label:l("receivedBags"),type:"number",value:u.receivedBags,onChange:j=>y("receivedBags",j.target.value),error:h.receivedBags,required:!0})]}),_!==0&&n.jsxs("p",{className:`text-xs font-bold text-right ${_<0?"text-red-500":"text-green-500"}`,children:["Difference: ",_>0?"+":"",_.toFixed(2)," Kg"]}),n.jsx(de,{label:`${l("notes")} (${l("optional")})`,value:u.notes,onChange:j=>y("notes",j.target.value),placeholder:"e.g. Broken bags, moisture loss..."})]}):n.jsx(de,{label:l("cancellationReason"),value:u.notes,onChange:j=>y("notes",j.target.value),error:h.notes,required:!0,autoFocus:!0})]})})},kP=({history:e})=>{const{t,language:s}=we();if(!e||e.length===0)return n.jsx("p",{className:"p-4 text-gray-500",children:t("noHistory")});const a=[...e].sort((i,l)=>new Date(l.date).getTime()-new Date(i.date).getTime());return n.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[n.jsx("h4",{className:"text-sm font-bold uppercase text-gray-500 mb-3",children:t("siteTransferHistoryTitle")}),n.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-2",children:a.map((i,l)=>n.jsxs("li",{className:"mb-6 ml-6",children:[n.jsx("span",{className:"absolute flex items-center justify-center w-3 h-3 bg-blue-100 rounded-full -left-1.5 ring-4 ring-white dark:ring-gray-800 dark:bg-blue-900"}),n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(vn,{status:i.status}),n.jsx("time",{className:"block ml-4 text-xs font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(i.date).toLocaleString(s,{dateStyle:"long",timeStyle:"short"})})]}),i.notes&&n.jsx("p",{className:"text-sm font-normal text-gray-600 dark:text-gray-300 mt-1",children:i.notes})]},l))})]})},DP=()=>{const{t:e}=we(),{siteTransfers:t,sites:s,seaweedTypes:a,updateSiteTransfer:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(!1),[h,m]=S.useState(null),[x,y]=S.useState(null),[b,T]=S.useState({key:"date",direction:"descending"}),[_,j]=S.useState(null),E=S.useMemo(()=>{const O=new Map(s.map(F=>[F.id,F.name]));return O.set("pressing-warehouse",e("pressedWarehouseTitle")),O},[s,e]),k=S.useMemo(()=>new Map(a.map(O=>[O.id,O.name])),[a]),C=S.useMemo(()=>{let O=[...t];return O.sort((F,q)=>{let z,Y;return b.key==="sourceSiteName"?z=E.get(F.sourceSiteId)||"":b.key==="destinationSiteName"?z=E.get(F.destinationSiteId)||"":b.key==="seaweedTypeName"?z=k.get(F.seaweedTypeId)||"":z=F[b.key],b.key==="sourceSiteName"?Y=E.get(q.sourceSiteId)||"":b.key==="destinationSiteName"?Y=E.get(q.destinationSiteId)||"":b.key==="seaweedTypeName"?Y=k.get(q.seaweedTypeId)||"":Y=q[b.key],z==null?1:Y==null?-1:z<Y?b.direction==="ascending"?-1:1:z>Y?b.direction==="ascending"?1:-1:0}),O},[t,b,E,k]),A=O=>{let F="ascending";b.key===O&&b.direction==="ascending"&&(F="descending"),T({key:O,direction:F})},M=({sortKey:O,label:F,className:q})=>n.jsx("th",{className:`p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${q}`,onClick:()=>A(O),children:n.jsxs("div",{className:`flex items-center gap-2 ${q!=null&&q.includes("text-right")?"justify-end":""}`,children:[F,b.key===O&&n.jsx(te,{name:b.direction==="ascending"?"ArrowUp":"ArrowDown",className:"w-3 h-3"})]})}),I=(O,F)=>{m(O),F===Gt.IN_TRANSIT||F===Gt.PENDING_RECEPTION?i({...O,status:F}):(y(F),f(!0))},P=O=>{i(O),f(!1),m(null),y(null)},D=O=>{const F="w-4 h-4 mr-1";switch(O.status){case Gt.AWAITING_OUTBOUND:return n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsxs(se,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Gt.IN_TRANSIT),children:[n.jsx(te,{name:"Truck",className:F})," ",e("status_IN_TRANSIT")]}),n.jsxs(se,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Gt.CANCELLED),children:[n.jsx(te,{name:"X",className:F})," ",e("cancel")]})]});case Gt.IN_TRANSIT:return n.jsxs(se,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Gt.PENDING_RECEPTION),children:[n.jsx(te,{name:"MapPin",className:F})," ",e("status_PENDING_RECEPTION")]});case Gt.PENDING_RECEPTION:return n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsxs(se,{variant:"primary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Gt.COMPLETED),children:[n.jsx(te,{name:"Check",className:F})," ",e("confirm")]}),n.jsxs(se,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Gt.CANCELLED),children:[n.jsx(te,{name:"X",className:F})," ",e("cancel")]})]});default:return n.jsx("span",{className:"text-xs text-gray-500 italic",children:e("noActions")})}},U=O=>O.startsWith("st-")?`SLIP-${O.split("-")[1].slice(-6)}`:O;return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("siteTransfersTitle")}),n.jsxs(se,{onClick:()=>c(!0),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),e("createShippingSlip")]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto min-h-[400px]",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 w-10"}),n.jsx(M,{sortKey:"id",label:e("slipNo")}),n.jsx(M,{sortKey:"date",label:e("date")}),n.jsx(M,{sortKey:"sourceSiteName",label:e("sourceSite")}),n.jsx(M,{sortKey:"destinationSiteName",label:e("destinationSite")}),n.jsx(M,{sortKey:"seaweedTypeName",label:e("seaweedType")}),n.jsx(M,{sortKey:"weightKg",label:e("shippedWeightKg"),className:"text-right"}),n.jsx(M,{sortKey:"status",label:e("status")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[C.map(O=>{const F=_===O.id;return n.jsxs(gt.Fragment,{children:[n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3 text-center",children:n.jsx("button",{onClick:()=>j(F?null:O.id),className:"text-gray-500 hover:text-blue-600 focus:outline-none",children:n.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${F?"rotate-90":""}`})})}),n.jsx("td",{className:"p-3 font-mono font-medium text-blue-600 dark:text-blue-400",children:U(O.id)}),n.jsx("td",{className:"p-3",children:O.date}),n.jsx("td",{className:"p-3",children:E.get(O.sourceSiteId)||e("unknown")}),n.jsx("td",{className:"p-3",children:E.get(O.destinationSiteId)||e("unknown")}),n.jsx("td",{className:"p-3",children:k.get(O.seaweedTypeId)||e("unknown")}),n.jsx("td",{className:"p-3 text-right font-medium",children:O.weightKg.toFixed(2)}),n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:O.status})}),n.jsx("td",{className:"p-3 text-right",children:D(O)})]}),F&&n.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/30",children:n.jsx("td",{colSpan:9,className:"p-0 border-b dark:border-gray-700/50",children:n.jsxs("div",{className:"p-4 pl-12 grid grid-cols-2 gap-8",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:e("transportDetails")}),n.jsxs("div",{className:"text-sm space-y-1",children:[n.jsxs("p",{children:[n.jsxs("span",{className:"text-gray-500",children:[e("transporter"),":"]})," ",O.transporter]}),n.jsxs("p",{children:[n.jsxs("span",{className:"text-gray-500",children:[e("transport"),":"]})," ",O.transport||"-"]}),n.jsxs("p",{children:[n.jsxs("span",{className:"text-gray-500",children:[e("representative"),":"]})," ",O.representative||"-"]})]})]}),n.jsx("div",{children:n.jsx(kP,{history:O.history})})]})})})]},O.id)}),C.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500",children:e("noDataForReport")})})]})]})})}),l&&n.jsx(IP,{isOpen:l,onClose:()=>c(!1)}),u&&h&&x&&n.jsx(AP,{isOpen:u,onClose:()=>f(!1),transfer:h,action:x,onConfirm:P})]})},RP=()=>n.jsx(DP,{}),MP=()=>{const{t:e,language:t}=we(),{incidents:s,sites:a,employees:i,deleteIncident:l,incidentTypes:c,incidentSeverities:u}=He(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[y,b]=S.useState(!1),[T,_]=S.useState(null),[j,E]=S.useState({key:"date",direction:"descending"}),[k,C]=S.useState({siteId:"all",type:"all",severity:"all",status:"all"}),A=S.useMemo(()=>new Map(a.map(B=>[B.id,B.name])),[a]),M=S.useMemo(()=>new Map(i.map(B=>[B.id,`${B.firstName} ${B.lastName}`])),[i]),I=S.useMemo(()=>new Map(c.map(B=>[B.id,B.name])),[c]);S.useMemo(()=>new Map(u.map(B=>[B.id,B.name])),[u]);const P=S.useMemo(()=>{const B=s.filter(ae=>ae.status===vs.OPEN).length,Q=s.filter(ae=>ae.status===vs.IN_PROGRESS).length,W=s.filter(ae=>ae.severity==="CRITICAL"&&(ae.status===vs.OPEN||ae.status===vs.IN_PROGRESS)).length;return{open:B,inProgress:Q,critical:W}},[s]),D=(B,Q)=>{C(W=>({...W,[B]:Q}))},U=()=>{C({siteId:"all",type:"all",severity:"all",status:"all"})},O=S.useMemo(()=>{let B=[...s].filter(Q=>{const W=k.siteId==="all"||Q.siteId===k.siteId,ae=k.type==="all"||Q.type===k.type,$=k.severity==="all"||Q.severity===k.severity,ie=k.status==="all"||Q.status===k.status;return W&&ae&&$&&ie});return B.sort((Q,W)=>{let ae,$;return j.key==="siteName"?ae=A.get(Q.siteId)||"":j.key==="reportedByName"?ae=M.get(Q.reportedById)||"":ae=Q[j.key],j.key==="siteName"?$=A.get(W.siteId)||"":j.key==="reportedByName"?$=M.get(W.reportedById)||"":$=W[j.key],ae==null?1:$==null?-1:ae<$?j.direction==="ascending"?-1:1:ae>$?j.direction==="ascending"?1:-1:0}),B},[s,k,j,A,M]),F=B=>{let Q="ascending";j.key===B&&j.direction==="ascending"&&(Q="descending"),E({key:B,direction:Q})},q=B=>j.key!==B?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):j.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),z=({sortKey:B,label:Q,className:W})=>n.jsx("th",{className:`p-3 ${W}`,children:n.jsxs("button",{onClick:()=>F(B),className:`group flex items-center gap-2 w-full ${W!=null&&W.includes("text-right")?"justify-end":""}`,children:[Q,q(B)]})}),Y=(B=null)=>{x(B),h(!0)},J=B=>{_(B),b(!0)},G=()=>{T&&l(T),b(!1),_(null)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:e("incidentManagementTitle")}),n.jsxs(se,{onClick:()=>Y(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("reportIncident")]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Bell",className:"w-8 h-8 text-blue-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("openIncidents")}),n.jsx("p",{className:"text-2xl font-bold",children:P.open})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"Activity",className:"w-8 h-8 text-purple-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("inProgressIncidents")}),n.jsx("p",{className:"text-2xl font-bold",children:P.inProgress})]})]})}),n.jsx(Ge,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(te,{name:"AlertTriangle",className:"w-8 h-8 text-red-500 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-500",children:e("criticalIncidents")}),n.jsx("p",{className:"text-2xl font-bold",children:P.critical})]})]})})]}),n.jsx(Ge,{children:n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end mb-4",children:[n.jsxs(ke,{label:e("site"),value:k.siteId,onChange:B=>D("siteId",B.target.value),children:[n.jsx("option",{value:"all",children:e("all")}),a.map(B=>n.jsx("option",{value:B.id,children:B.name},B.id))]}),n.jsxs(ke,{label:e("incidentType"),value:k.type,onChange:B=>D("type",B.target.value),children:[n.jsx("option",{value:"all",children:e("all")}),c.map(B=>n.jsx("option",{value:B.id,children:B.name},B.id))]}),n.jsxs(ke,{label:e("severity"),value:k.severity,onChange:B=>D("severity",B.target.value),children:[n.jsx("option",{value:"all",children:e("all")}),u.map(B=>n.jsx("option",{value:B.id,children:B.name},B.id))]}),n.jsxs(ke,{label:e("status"),value:k.status,onChange:B=>D("status",B.target.value),children:[n.jsx("option",{value:"all",children:e("all")}),Object.values(vs).map(B=>n.jsx("option",{value:B,children:e(`status_${B}`)},B))]}),n.jsx(se,{variant:"secondary",onClick:U,className:"h-[42px] w-full",children:e("clearFilters")})]})}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(z,{sortKey:"date",label:e("date")}),n.jsx(z,{sortKey:"siteName",label:e("site")}),n.jsx(z,{sortKey:"type",label:e("incidentType")}),n.jsx(z,{sortKey:"severity",label:e("severity")}),n.jsx(z,{sortKey:"reportedByName",label:e("reportedBy")}),n.jsx(z,{sortKey:"status",label:e("status")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[O.map(B=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:B.date}),n.jsx("td",{className:"p-3",children:A.get(B.siteId)||e("unknown")}),n.jsx("td",{className:"p-3",children:I.get(B.type)||B.type}),n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:B.severity})}),n.jsx("td",{className:"p-3",children:M.get(B.reportedById)||e("unknown")}),n.jsx("td",{className:"p-3",children:n.jsx(vn,{status:B.status})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(se,{variant:"ghost",onClick:()=>Y(B),children:n.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>J(B.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},B.id)),O.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:e("noIncidents")})})]})]})})}),f&&n.jsx(PP,{isOpen:f,onClose:()=>h(!1),incident:m}),y&&n.jsx(zt,{isOpen:y,onClose:()=>b(!1),onConfirm:G,title:e("confirmDeleteTitle"),message:e("confirmDeleteIncident")})]})},PP=({isOpen:e,onClose:t,incident:s})=>{var G,B,Q;const{t:a,language:i}=we(),{sites:l,employees:c,incidentTypes:u,incidentSeverities:f,modules:h,addIncident:m,updateIncident:x}=He(),y=S.useRef(null),[b,T]=S.useState({date:new Date().toISOString().split("T")[0],siteId:((G=l[0])==null?void 0:G.id)||"",type:((B=u.find(W=>!W.isDefault&&W.id!=="OTHER"))==null?void 0:B.id)||"PEST_DISEASE",severity:"LOW",affectedModuleIds:[],reportedById:((Q=c[0])==null?void 0:Q.id)||"",description:"",status:vs.OPEN,resolutionNotes:"",resolvedDate:""}),[_,j]=S.useState(null),[E,k]=S.useState(!1),[C,A]=S.useState(null),[M,I]=S.useState({});S.useEffect(()=>{T(s?{date:s.date,siteId:s.siteId,type:s.type,severity:s.severity,affectedModuleIds:s.affectedModuleIds,reportedById:s.reportedById,description:s.description,status:s.status,resolutionNotes:s.resolutionNotes||"",resolvedDate:s.resolvedDate||""}:W=>{var ae,$,ie;return{...W,siteId:((ae=l[0])==null?void 0:ae.id)||"",reportedById:(($=c[0])==null?void 0:$.id)||"",type:((ie=u[0])==null?void 0:ie.id)||"PEST_DISEASE"}}),j(null),A(null),I({})},[s,e,l,c,u]);const P=S.useMemo(()=>h.filter(W=>W.siteId===b.siteId),[h,b.siteId]),D=S.useCallback(()=>{const W={};return b.date||(W.date=a("validationRequired")),b.siteId||(W.siteId=a("validationRequired")),b.type||(W.type=a("validationRequired")),b.reportedById||(W.reportedById=a("validationRequired")),b.description.trim()||(W.description=a("validationRequired")),(b.status===vs.RESOLVED||b.status===vs.CLOSED)&&(b.resolvedDate||(W.resolvedDate=a("validationRequired")),b.resolutionNotes.trim()||(W.resolutionNotes=a("validationRequired"))),W},[b,a]);S.useEffect(()=>{I(D())},[b,D]);const U=(W,ae)=>{T($=>({...$,[W]:ae}))},O=W=>{T(ae=>{const $=ae.affectedModuleIds.includes(W)?ae.affectedModuleIds.filter(ie=>ie!==W):[...ae.affectedModuleIds,W];return{...ae,affectedModuleIds:$}})},F=W=>{var $;const ae=($=W.target.files)==null?void 0:$[0];if(ae){const ie=new FileReader;ie.onloadend=()=>{j(ie.result),z(ie.result)},ie.readAsDataURL(ae)}},q=async()=>{if(b.description){k(!0);try{const W=await N2(b.description,P.map(ae=>ae.code),u,f,i);if(A(W),W.suggestedType&&T(ae=>({...ae,type:W.suggestedType})),W.suggestedSeverity&&T(ae=>({...ae,severity:W.suggestedSeverity})),W.suggestedModuleCodes&&W.suggestedModuleCodes.length>0){const ae=P.filter($=>W.suggestedModuleCodes.includes($.code)).map($=>$.id);T($=>({...$,affectedModuleIds:[...new Set([...$.affectedModuleIds,...ae])]}))}}catch(W){console.error("AI Analysis failed",W)}finally{k(!1)}}},z=async W=>{k(!0);try{const ae=await S2(W,i);if(ae){if(A({...C,imageAnalysis:ae}),ae.type==="PEST_DISEASE"){const $=u.find(ie=>ie.id==="PEST_DISEASE");$&&T(ie=>({...ie,type:$.id}))}if(ae.severity){const $=f.find(ie=>ie.id===ae.severity.toUpperCase());$&&T(ie=>({...ie,severity:$.id}))}ae.description&&T($=>({...$,description:($.description?$.description+`

`:"")+`[AI Analysis]: ${ae.description}`}))}}catch(ae){console.error("Image Analysis failed",ae)}finally{k(!1)}},Y=W=>{W.preventDefault();const ae=D();if(Object.keys(ae).length>0){I(ae);return}const $={...b,resolutionNotes:b.resolutionNotes||void 0,resolvedDate:b.resolvedDate||void 0};s?x({...s,...$}):m($),t()},J=Object.keys(M).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:a(s?"editIncident":"reportIncident"),widthClass:"max-w-4xl",children:n.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:a("date"),type:"date",value:b.date,onChange:W=>U("date",W.target.value),error:M.date,required:!0}),n.jsx(ke,{label:a("site"),value:b.siteId,onChange:W=>U("siteId",W.target.value),error:M.siteId,required:!0,children:l.map(W=>n.jsx("option",{value:W.id,children:W.name},W.id))}),n.jsx(ke,{label:a("incidentType"),value:b.type,onChange:W=>U("type",W.target.value),error:M.type,required:!0,children:u.map(W=>n.jsx("option",{value:W.id,children:W.name},W.id))}),n.jsx(ke,{label:a("severity"),value:b.severity,onChange:W=>U("severity",W.target.value),required:!0,children:f.map(W=>n.jsx("option",{value:W.id,children:W.name},W.id))}),n.jsx(ke,{label:a("reportedBy"),value:b.reportedById,onChange:W=>U("reportedById",W.target.value),error:M.reportedById,required:!0,children:c.map(W=>n.jsxs("option",{value:W.id,children:[W.firstName," ",W.lastName]},W.id))}),n.jsx(ke,{label:a("status"),value:b.status,onChange:W=>U("status",W.target.value),required:!0,children:Object.values(vs).map(W=>n.jsx("option",{value:W,children:a(`status_${W}`)},W))})]}),n.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:a("description")}),n.jsxs("div",{className:"flex gap-2 mb-2",children:[n.jsxs(se,{type:"button",variant:"secondary",onClick:()=>{var W;return(W=y.current)==null?void 0:W.click()},className:"text-xs",children:[n.jsx(te,{name:"Image",className:"w-4 h-4 mr-1"})," ",a("uploadPhoto")]}),n.jsx("input",{type:"file",ref:y,onChange:F,accept:"image/*",className:"hidden"}),n.jsxs(se,{type:"button",variant:"ghost",onClick:q,disabled:E||!b.description,className:"text-xs",children:[n.jsx(te,{name:"Bot",className:"w-4 h-4 mr-1"})," ",a("analyzeWithAI")]})]}),_&&n.jsx("div",{className:"mb-2",children:n.jsx("img",{src:_,alt:"Preview",className:"h-32 w-auto object-cover rounded border"})}),n.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-blue-500",rows:4,value:b.description,onChange:W=>U("description",W.target.value),placeholder:a("descriptionPlaceholder")}),M.description&&n.jsx("p",{className:"text-xs text-red-600",children:M.description}),E&&n.jsxs("p",{className:"text-xs text-blue-600 mt-1 animate-pulse",children:[a("analyzingSatellite"),"..."]}),C&&n.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded text-sm",children:[n.jsxs("h4",{className:"font-bold flex items-center gap-1 text-blue-800 dark:text-blue-200",children:[n.jsx(te,{name:"Bot",className:"w-4 h-4"})," ",a("aiSuggestions")]}),C.imageAnalysis&&n.jsxs("div",{className:"mt-1",children:[n.jsxs("p",{className:"font-semibold",children:[a("suggestedType"),": ",C.imageAnalysis.type]}),n.jsx("p",{children:C.imageAnalysis.description}),n.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[n.jsxs("strong",{children:[a("suggestedTreatment"),":"]})," ",C.imageAnalysis.treatments]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2",children:a("affectedModules")}),n.jsxs("div",{className:"max-h-32 overflow-y-auto border rounded p-2 grid grid-cols-3 gap-2",children:[P.map(W=>n.jsxs("label",{className:"flex items-center space-x-2 text-sm cursor-pointer",children:[n.jsx(_t,{checked:b.affectedModuleIds.includes(W.id),onChange:()=>O(W.id)}),n.jsx("span",{children:W.code})]},W.id)),P.length===0&&n.jsx("p",{className:"text-gray-500 text-sm col-span-3 text-center",children:"Select a site to view modules"})]})]}),(b.status===vs.RESOLVED||b.status===vs.CLOSED)&&n.jsxs("div",{className:"border-t pt-4 mt-4",children:[n.jsx("h4",{className:"font-semibold mb-3",children:a("status_RESOLVED")}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(de,{label:a("resolvedDate"),type:"date",value:b.resolvedDate,onChange:W=>U("resolvedDate",W.target.value),error:M.resolvedDate,required:!0}),n.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600",rows:3,value:b.resolutionNotes,onChange:W=>U("resolutionNotes",W.target.value),placeholder:a("resolutionNotes")}),M.resolutionNotes&&n.jsx("p",{className:"text-xs text-red-600",children:M.resolutionNotes})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700 mt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{type:"submit",disabled:J,children:a("save")})]})]})})},OP=()=>{const{t:e}=we(),{incidentTypes:t,addIncidentType:s,updateIncidentType:a,deleteIncidentType:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(""),[x,y]=S.useState(!1),[b,T]=S.useState(null),_=A=>{A.isDefault||(f(A),c(!0))},j=()=>{u&&i(u.id),c(!1),f(null)},E=()=>{h.trim()&&(s({name:h.trim()}),m(""))},k=A=>{T(A),y(!0)},C=A=>{a(A),y(!1)};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("incidentTypeManagementTitle")}),n.jsxs(Ge,{children:[n.jsx("div",{className:"space-y-4 mb-6",children:t.map(A=>n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:A.name}),A.isDefault&&n.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",e("default"),")"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>k(A),children:[n.jsx(te,{name:"Edit2",className:"w-4 h-4"}),e("edit")]}),A.isDefault?n.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:e("cannotDeleteDefault")}):n.jsx(se,{variant:"danger",className:"p-2",onClick:()=>_(A),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},A.id))}),n.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[n.jsx("h4",{className:"font-semibold mb-4",children:e("addIncidentType")}),n.jsxs("div",{className:"flex items-end gap-4",children:[n.jsx(de,{containerClassName:"flex-grow",label:e("typeName"),value:h,onChange:A=>m(A.target.value)}),n.jsxs(se,{onClick:E,disabled:!h.trim(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("add")]})]})]})]}),x&&b&&n.jsx(LP,{isOpen:x,onClose:()=>y(!1),type:b,onSave:C}),l&&u&&n.jsx(zt,{isOpen:l,onClose:()=>c(!1),onConfirm:j,title:e("confirmDeleteTitle"),message:e("confirmDeleteIncidentType")})]})},LP=({isOpen:e,onClose:t,type:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState(s.name);S.useEffect(()=>{e&&c(s.name)},[e,s]);const u=()=>{l.trim()&&a({...s,name:l.trim()})};return n.jsx(ot,{isOpen:e,onClose:t,title:i("editIncidentType"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:u,disabled:!l.trim(),children:i("save")})]}),children:n.jsx(de,{label:i("typeName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},UP=()=>{const{t:e}=we(),{incidentSeverities:t,addIncidentSeverity:s,updateIncidentSeverity:a,deleteIncidentSeverity:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(""),[x,y]=S.useState(!1),[b,T]=S.useState(null),_=A=>{A.isDefault||(f(A),c(!0))},j=()=>{u&&i(u.id),c(!1),f(null)},E=()=>{h.trim()&&(s({name:h.trim()}),m(""))},k=A=>{T(A),y(!0)},C=A=>{a(A),y(!1)};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("incidentSeverityManagementTitle")}),n.jsxs(Ge,{children:[n.jsx("div",{className:"space-y-4 mb-6",children:t.map(A=>n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:A.name}),A.isDefault&&n.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",e("default"),")"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>k(A),children:[n.jsx(te,{name:"Edit2",className:"w-4 h-4"}),e("edit")]}),A.isDefault?n.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:e("cannotDeleteDefault")}):n.jsx(se,{variant:"danger",className:"p-2",onClick:()=>_(A),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},A.id))}),n.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[n.jsx("h4",{className:"font-semibold mb-4",children:e("addIncidentSeverity")}),n.jsxs("div",{className:"flex items-end gap-4",children:[n.jsx(de,{containerClassName:"flex-grow",label:e("severityName"),value:h,onChange:A=>m(A.target.value)}),n.jsxs(se,{onClick:E,disabled:!h.trim(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("add")]})]})]})]}),x&&b&&n.jsx(FP,{isOpen:x,onClose:()=>y(!1),severity:b,onSave:C}),l&&u&&n.jsx(zt,{isOpen:l,onClose:()=>c(!1),onConfirm:j,title:e("confirmDeleteTitle"),message:e("confirmDeleteIncidentSeverity")})]})},FP=({isOpen:e,onClose:t,severity:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState(s.name);S.useEffect(()=>{e&&c(s.name)},[e,s]);const u=()=>{l.trim()&&a({...s,name:l.trim()})};return n.jsx(ot,{isOpen:e,onClose:t,title:i("editIncidentSeverity"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:u,disabled:!l.trim(),children:i("save")})]}),children:n.jsx(de,{label:i("severityName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},BP=({isOpen:e,onClose:t,payment:s})=>{const{t:a}=we(),{farmers:i,employees:l,serviceProviders:c,addMonthlyPayment:u,updateMonthlyPayment:f}=He(),h=S.useCallback(()=>{const C=new Date,A=C.getFullYear(),M=String(C.getMonth()+1).padStart(2,"0");return{date:C.toISOString().split("T")[0],period:`${A}-${M}`,recipientType:Wt.FARMER,recipientId:"",amount:"",method:"cash",notes:"",paymentStatus:"PENDING",mobileProvider:"",phoneNumber:""}},[]),[m,x]=S.useState(h()),[y,b]=S.useState({});S.useEffect(()=>{e&&(x(s?{...s,amount:String(s.amount),notes:s.notes||"",mobileProvider:s.mobileProvider||"",phoneNumber:s.phoneNumber||"",paymentStatus:s.paymentStatus||"PENDING"}:h()),b({}))},[e,s,h]);const T=S.useMemo(()=>{switch(m.recipientType){case Wt.FARMER:return i.map(C=>({value:C.id,label:`${C.firstName} ${C.lastName}`}));case Wt.EMPLOYEE:return l.map(C=>({value:C.id,label:`${C.firstName} ${C.lastName}`}));case Wt.SERVICE_PROVIDER:return c.map(C=>({value:C.id,label:C.name}));default:return[]}},[m.recipientType,i,l,c]),_=S.useCallback(()=>{const C={};return m.date||(C.date=a("validationRequired")),m.period||(C.period=a("validationRequired")),m.recipientType||(C.recipientType=a("validationRequired")),m.recipientId||(C.recipientId=a("validationRequired")),(!m.amount||isNaN(parseFloat(m.amount))||parseFloat(m.amount)<=0)&&(C.amount=a("validationPositiveNumber")),m.method==="mobile_money"&&(m.mobileProvider||(C.mobileProvider=a("validationRequired")),m.phoneNumber||(C.phoneNumber=a("validationRequired"))),C},[m,a]);S.useEffect(()=>{b(_())},[m,_]);const j=(C,A)=>{const M={...m,[C]:A};C==="recipientType"&&(M.recipientId=""),x(M)},E=C=>{var I;C.preventDefault();const A=_();if(Object.keys(A).length>0){b(A);return}const M={...m,amount:parseFloat(m.amount),notes:((I=m.notes)==null?void 0:I.trim())||void 0,mobileProvider:m.method==="mobile_money"?m.mobileProvider:void 0,phoneNumber:m.method==="mobile_money"?m.phoneNumber:void 0};s?f({...s,...M}):u(M),t()},k=Object.keys(y).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:a(s?"editPayment":"newPayment"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{onClick:E,disabled:k,children:a("save")})]}),children:n.jsxs("form",{onSubmit:E,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:a("paymentDate"),type:"date",value:m.date,onChange:C=>j("date",C.target.value),error:y.date,required:!0}),n.jsx(de,{label:a("period"),type:"month",value:m.period,onChange:C=>j("period",C.target.value),error:y.period,required:!0}),n.jsxs(ke,{label:a("recipientType"),value:m.recipientType,onChange:C=>j("recipientType",C.target.value),error:y.recipientType,required:!0,children:[n.jsx("option",{value:"",children:a("selectRecipientType")}),Object.values(Wt).map(C=>n.jsx("option",{value:C,children:a(`recipientType_${C}`)},C))]}),n.jsxs(ke,{label:a("recipient"),value:m.recipientId,onChange:C=>j("recipientId",C.target.value),error:y.recipientId,disabled:!m.recipientType,required:!0,children:[n.jsx("option",{value:"",children:a("selectRecipient")}),T.map(C=>n.jsx("option",{value:C.value,children:C.label},C.value))]}),n.jsx(de,{label:a("amount"),type:"number",step:"any",value:m.amount,onChange:C=>j("amount",C.target.value),error:y.amount,required:!0}),n.jsxs(ke,{label:a("paymentMethod"),value:m.method,onChange:C=>j("method",C.target.value),children:[n.jsx("option",{value:"cash",children:a("paymentMethod_cash")}),n.jsx("option",{value:"bank_transfer",children:a("paymentMethod_bank_transfer")}),n.jsx("option",{value:"mobile_money",children:a("paymentMethod_mobile_money")})]})]}),m.method==="mobile_money"&&n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[n.jsxs(ke,{label:"Mobile Money Provider",value:m.mobileProvider,onChange:C=>j("mobileProvider",C.target.value),error:y.mobileProvider,required:!0,children:[n.jsx("option",{value:"",children:"Select Provider"}),n.jsx("option",{value:"Orange Money",children:"Orange Money"}),n.jsx("option",{value:"M-Pesa",children:"M-Pesa"}),n.jsx("option",{value:"Airtel Money",children:"Airtel Money"}),n.jsx("option",{value:"Telma MVola",children:"Telma MVola"})]}),n.jsx(de,{label:"Phone Number",type:"tel",value:m.phoneNumber,onChange:C=>j("phoneNumber",C.target.value),error:y.phoneNumber,required:!0,placeholder:"+261..."})]}),s&&s.paymentStatus&&n.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:[n.jsxs("strong",{children:[a("paymentStatus"),": "]})," ",a(`status_${s.paymentStatus}`),s.transactionId&&n.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:[a("transactionId"),": ",s.transactionId]})]}),n.jsx(de,{label:`${a("notes")} (${a("optional")})`,value:m.notes,onChange:C=>j("notes",C.target.value)})]})})},Ko=(e,t,s,a,i,l={})=>{var C,A;let c=(C=Jt.find(M=>M.code===i.country))==null?void 0:C.payroll;if(c||(c=(A=Jt.find(M=>M.code==="MG"))==null?void 0:A.payroll),!c){const M=e+t+s,I=a,P=M-I;return{baseSalary:e,bonuses:t,overtime:s,totalGross:M,deductions:[],otherDeductions:a,totalDeductions:I,netPay:P}}const{constants:u,labels:f}=c,h=u.socialContributions.map(M=>M.key),m=l.appliedDeductions===void 0?h:l.appliedDeductions,x=e+t+s,y=[];let b=0;m.length>0&&u.socialContributions.forEach(M=>{var I;if(m.includes(M.key)){const D=(M.cap?Math.min(x,M.cap):x)*M.rate;b+=D;const U=((I=f.socialContributions.find(O=>O.key===M.key))==null?void 0:I.label)||M.key;y.push({label:U,amount:D})}});const T=x-b;let _=0;if(T>0){for(const M of u.incomeTax.brackets)if(T>M.from){const I=Math.min(T,M.to===1/0?T:M.to)-M.from;I>0&&(_+=I*M.rate)}}u.incomeTax.minimumPerception&&_>0&&(_=Math.max(_,u.incomeTax.minimumPerception)),_>0&&y.push({label:f.incomeTax,amount:_});const E=y.reduce((M,I)=>M+I.amount,0)+a,k=x-E;return{baseSalary:e,bonuses:t,overtime:s,totalGross:x,deductions:y,otherDeductions:a,totalDeductions:E,netPay:k}},Rn=({label:e,children:t})=>n.jsxs("div",{className:"text-[10px] text-black",children:[n.jsxs("div",{className:"flex items-baseline",children:[n.jsx("span",{className:"w-auto mr-2 whitespace-nowrap",children:e}),n.jsx("div",{className:"flex-grow font-semibold truncate pl-1",children:t||n.jsx(n.Fragment,{children:""})})]}),n.jsx("div",{className:"border-b border-black mt-0.5"})]}),Av=({rows:e,periodName:t,pageIndex:s,totalPages:a,data:i})=>{var b,T,_,j,E;const{settings:l}=Ke(),{t:c}=we(),u=S.useMemo(()=>{var k;return((k=Jt.find(C=>C.code===l.localization.country))==null?void 0:k.name)||l.localization.country},[l.localization.country]),f=i.columns.some(k=>k.key==="dryPrice"),h=(b=i.headerInfo.find(k=>k.label===c("site")))==null?void 0:b.value,m=(T=i.headerInfo.find(k=>k.label===c("seaweedType")))==null?void 0:T.value,x=(_=i.headerInfo.find(k=>k.label===c("date")))==null?void 0:_.value,y=s===a-1;return n.jsx(ks,{landscape:!0,children:n.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[n.jsxs("header",{className:"mb-2",children:[n.jsxs("div",{className:"grid grid-cols-4 items-start",children:[n.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&n.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),n.jsxs("div",{className:"col-span-2 text-center",children:[n.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),n.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[n.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),n.jsxs("span",{children:[c("address"),": ",l.company.address]}),n.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),n.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),n.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),n.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),n.jsxs("span",{children:[c("email"),": ",l.company.email]}),n.jsxs("span",{children:[c("country"),": ",u]})]})]}),n.jsx("div",{className:"col-span-1"})]}),n.jsx("div",{className:"text-center mt-1 mb-2",children:n.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(Rn,{label:`${c("exploitationSite")}:`,children:h}),n.jsx(Rn,{label:`${c("dateLabel")} du paiement:`,children:x}),n.jsx(Rn,{label:`${c("totalPaymentAmount")}:`,children:Ae(i.totalValue,l.localization)}),n.jsx(Rn,{label:`(${c("totalAmountInWords")})`})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(Rn,{label:`${c("seaweedType")}:`,children:m}),n.jsx(Rn,{label:`${c("checkNumber")}:`}),n.jsx(Rn,{label:`${c("pricePerKg")}:`,children:Ae(f?((j=e[0])==null?void 0:j.dryPrice)||0:((E=e[0])==null?void 0:E.wetPrice)||0,l.localization)})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(Rn,{label:`${c("deliveryPeriod")}:`,children:t}),n.jsx(Rn,{label:`${c("checkAmount")}:`})]})]}),n.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[n.jsx("thead",{className:"font-bold bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 border border-black",children:"Trans. Date"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Farmer"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Weight"}),f&&n.jsx("th",{className:"px-1 py-1 border border-black",children:"Bags"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Value"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Credits"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),n.jsx("tbody",{children:e.map((k,C)=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:x}),n.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:k.beneficiaryName}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Fe(k.netWeightKg??k.totalWeightKg,l.localization)}),f&&n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:k.totalBags}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(k.baseAmount,l.localization)}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(k.deduction,l.localization)}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(k.netAmount,l.localization)}),n.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),n.jsx("td",{className:"px-1 py-0.5 border border-black"})]},C))}),y&&n.jsx("tfoot",{className:"font-bold bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("td",{colSpan:f?5:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),n.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),n.jsx("td",{colSpan:3,className:"px-1 py-1 border border-black"})]})})]}),n.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:n.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),n.jsx("div",{className:"flex-grow"}),n.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[n.jsx("div",{className:"mb-8",children:n.jsx("p",{className:"font-bold text-xs mb-8",children:n.jsx("u",{children:c("theResponsible")})})}),n.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[n.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),n.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",s+1,"/",a]})]})]})]})})},GP=({rows:e,periodName:t,pageIndex:s,totalPages:a,data:i})=>{var y,b,T;const{settings:l}=Ke(),{t:c}=we(),u=S.useMemo(()=>{var _;return((_=Jt.find(j=>j.code===l.localization.country))==null?void 0:_.name)||l.localization.country},[l.localization.country]),f=(y=i.headerInfo.find(_=>_.label===c("site")))==null?void 0:y.value,h=(b=i.headerInfo.find(_=>_.label===c("seaweedType")))==null?void 0:b.value,m=(T=i.headerInfo.find(_=>_.label===c("paymentDate")))==null?void 0:T.value,x=s===a-1;return n.jsx(ks,{landscape:!0,children:n.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[n.jsxs("header",{className:"mb-2",children:[n.jsxs("div",{className:"grid grid-cols-4 items-start",children:[n.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&n.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),n.jsxs("div",{className:"col-span-2 text-center",children:[n.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),n.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[n.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),n.jsxs("span",{children:[c("address"),": ",l.company.address]}),n.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),n.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),n.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),n.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),n.jsxs("span",{children:[c("email"),": ",l.company.email]}),n.jsxs("span",{children:[c("country"),": ",u]})]})]})]}),n.jsx("div",{className:"text-center mt-1 mb-2",children:n.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-x-4 mb-2",children:[n.jsx(Rn,{label:`${c("exploitationSite")}:`,children:f}),n.jsx(Rn,{label:`${c("seaweedType")}:`,children:h}),n.jsx(Rn,{label:`${c("deliveryPeriod")}:`,children:t}),n.jsx(Rn,{label:`${c("paymentDate")}:`,children:m})]}),n.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[n.jsx("thead",{className:"font-bold bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 border border-black",children:c("serviceDate")}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Provider"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Number of Lines"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Unit Price"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount to Pay"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),n.jsx("tbody",{children:e.map((_,j)=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:_.date}),n.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:_.beneficiaryName}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:_.totalLines}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:_.averageUnitPrice!==null?Ae(_.averageUnitPrice,l.localization):c("various")}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(_.netAmount,l.localization)}),n.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),n.jsx("td",{className:"px-1 py-0.5 border border-black"})]},j))}),x&&n.jsx("tfoot",{className:"font-bold bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("td",{colSpan:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),n.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),n.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black"})]})})]}),n.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:n.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),n.jsx("div",{className:"flex-grow"}),n.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[n.jsx("div",{className:"mb-8",children:n.jsx("p",{className:"font-bold text-xs mb-8",children:n.jsx("u",{children:c("theResponsible")})})}),n.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[n.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),n.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",s+1,"/",a]})]})]})]})})},zP=({beneficiaryRows:e,pageIndex:t,totalPages:s,isLastPage:a,summaryData:i,denominations:l,data:c,periodName:u})=>{var T,_,j;const{settings:f}=Ke(),{t:h}=we(),m=S.useMemo(()=>{var E;return((E=Jt.find(k=>k.code===f.localization.country))==null?void 0:E.name)||f.localization.country},[f.localization.country]),x=(T=c.headerInfo.find(E=>E.label===h("site")))==null?void 0:T.value,y=(_=c.headerInfo.find(E=>E.label===h("seaweedType")))==null?void 0:_.value,b=(j=c.headerInfo.find(E=>E.label===h("date")))==null?void 0:j.value;return n.jsx(ks,{landscape:!0,children:n.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[n.jsxs("header",{className:"mb-2",children:[n.jsxs("div",{className:"grid grid-cols-4 items-start",children:[n.jsx("div",{className:"col-span-1",children:f.company.logoUrl&&n.jsx("img",{src:f.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),n.jsxs("div",{className:"col-span-2 text-center",children:[n.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:f.company.name}),n.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[n.jsxs("span",{children:[h("capital"),": ",Ae(f.company.capital,f.localization)]}),n.jsxs("span",{children:[h("address"),": ",f.company.address]}),n.jsxs("span",{children:[h("nif"),": ",f.company.nif]}),n.jsxs("span",{children:[h("stat"),": ",f.company.stat]}),n.jsxs("span",{children:[h("rc"),": ",f.company.rc]}),n.jsxs("span",{children:[h("phone"),": ",f.company.phone]}),n.jsxs("span",{children:[h("email"),": ",f.company.email]}),n.jsxs("span",{children:[h("country"),": ",m]})]})]}),n.jsx("div",{className:"col-span-1"})]}),n.jsx("div",{className:"text-center mt-1 mb-2",children:n.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:h("denominationBreakdown")})})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[n.jsx(Rn,{label:`${h("exploitationSite")}:`,children:x}),n.jsx(Rn,{label:`${h("seaweedType")}:`,children:y}),n.jsx(Rn,{label:`${h("deliveryPeriod")}:`,children:u}),n.jsx(Rn,{label:`${h("dateLabel")} du paiement:`,children:b})]}),n.jsx("h3",{className:"font-bold text-[10px] my-1",children:h("breakdownByBeneficiary")}),n.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[n.jsx("thead",{className:"font-bold bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 border border-black",children:"Beneficiary"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),l.map(E=>n.jsx("th",{className:"p-1 border border-black font-normal whitespace-nowrap",style:{fontSize:"8px"},children:Ae(E.value,f.localization)},E.id))]})}),n.jsx("tbody",{children:e.map((E,k)=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[120px]",children:E.beneficiaryName}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(E.netAmount,f.localization)}),l.map(C=>n.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.breakdown[C.value]||""},C.id))]},k))})]}),a&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{className:"font-bold text-[10px] my-1 mt-4",children:h("summaryTable")}),n.jsxs("table",{className:"w-1/3 border-collapse border border-black text-[9px] text-black",children:[n.jsx("thead",{className:"font-bold bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 border border-black",children:"Denomination"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Quantity"}),n.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount"})]})}),n.jsx("tbody",{children:i.map(E=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.value,f.localization)}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.count}),n.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.total,f.localization)})]},E.value))}),n.jsx("tfoot",{className:"font-bold bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black text-right",children:h("total")}),n.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(c.totalValue,f.localization)})]})})]})]}),n.jsx("div",{className:"flex-grow"}),n.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[n.jsx("div",{className:"mb-8",children:n.jsx("p",{className:"font-bold text-xs mb-8",children:n.jsx("u",{children:h("theResponsible")})})}),n.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[n.jsxs("p",{className:"text-[8px] text-gray-600",children:[f.company.name," - ",f.company.address]}),n.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",t+1,"/",s]})]})]})]})})},$P=({data:e,autoDownload:t})=>{const{t:s}=we(),{settings:a}=Ke(),[i,l]=S.useState(!1),c=S.useRef(!1),u=30,f=25,h=S.useMemo(()=>{switch(e.beneficiaryTypeLabel){case s("farmer"):return Av;case s("provider"):return GP;default:return Av}},[e.beneficiaryTypeLabel,s]),m=S.useMemo(()=>{if(e.rows.length===0)return[[]];const A=[];for(let M=0;M<e.rows.length;M+=u)A.push(e.rows.slice(M,M+u));return A},[e.rows]),x=m.length,y=S.useMemo(()=>[...a.localization.denominations].sort((A,M)=>M.value-A.value),[a.localization.denominations]),b=S.useMemo(()=>e.rows.map(A=>{let M=A.netAmount;const I={};return y.forEach(P=>{const D=Math.floor(M/P.value);D>0&&(I[P.value]=D,M-=D*P.value,M=parseFloat(M.toFixed(a.localization.monetaryDecimals)))}),{beneficiaryName:A.beneficiaryName,netAmount:A.netAmount,breakdown:I}}),[e.rows,y,a.localization.monetaryDecimals]),T=S.useMemo(()=>{const A=new Map;return y.forEach(M=>A.set(M.value,{count:0,total:0})),b.forEach(M=>{for(const[I,P]of Object.entries(M.breakdown)){const D=parseFloat(I),U=A.get(D);U&&(U.count+=P,U.total+=P*D)}}),Array.from(A.entries()).map(([M,I])=>({value:M,...I})).filter(M=>M.count>0).sort((M,I)=>I.value-M.value)},[b,y]),_=S.useMemo(()=>{if(b.length===0)return[[]];const A=[];for(let M=0;M<b.length;M+=f)A.push(b.slice(M,M+f));return A},[b]),j=_.length,E=()=>{window.print()},k=S.useCallback(async()=>{if(!i){l(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:A}=window.jspdf,M=window.html2canvas,I=document.getElementById("printable-area");if(!I)throw new Error("Printable area not found");const P=new A({orientation:"l",unit:"mm",format:"a4",compress:!0});P.setProperties({title:e.title,subject:"Payment Sheet",author:a.company.name,creator:"AlgaManage"});const D=I.getElementsByClassName("print-page");for(let U=0;U<D.length;U++){const F=(await M(D[U],{scale:4,useCORS:!0,windowWidth:1920,backgroundColor:"#ffffff"})).toDataURL("image/png");U>0&&P.addPage();const q=P.getImageProperties(F),z=P.internal.pageSize.getWidth(),Y=q.height*z/q.width;P.addImage(F,"PNG",0,0,z,Y,void 0,"FAST")}P.save(`PaymentSheet-${e.title.replace(/ /g,"_")}-${e.periodName.replace(/ /g,"_")}.pdf`)}catch(A){console.error("Error generating PDF:",A),alert(s("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),l(!1)}}},[i,e.title,e.periodName,s,a.company.name]);S.useEffect(()=>{t&&!c.current&&(c.current=!0,setTimeout(()=>{k()},500))},[t,k]);const C=h;return n.jsxs("div",{children:[n.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[n.jsxs(se,{onClick:k,disabled:i,className:"rounded-full !px-4 shadow-sm",children:[n.jsx(te,{name:i?"Activity":"Download",className:`w-5 h-5 ${i?"animate-spin":""}`}),n.jsx("span",{className:"ml-2",children:s(i?"downloading":"downloadPdf")})]}),n.jsxs(se,{onClick:E,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[n.jsx(te,{name:"Printer",className:"w-5 h-5"}),n.jsx("span",{className:"ml-2",children:s("print")})]})]})}),n.jsxs("div",{id:"printable-area",className:"text-black font-sans text-sm bg-gray-200 p-4 sm:p-8",children:[m.map((A,M)=>n.jsx(C,{rows:A,periodName:e.periodName,pageIndex:M,totalPages:x+j,data:e},`main-page-${M}`)),_.map((A,M)=>n.jsx(zP,{beneficiaryRows:A,pageIndex:x+M,totalPages:x+j,isLastPage:M===j-1,summaryData:T,denominations:y,data:e,periodName:e.periodName},`breakdown-page-${M}`))]})]})},HP=async e=>new Promise(t=>{setTimeout(()=>{if(Math.random()>.1){const a=`TXN-${Date.now().toString(36).toUpperCase()}-${Math.floor(Math.random()*1e4)}`;t({success:!0,transactionId:a})}else t({success:!1,message:"Transaction failed: Insufficient funds or network timeout."})},2e3)}),qP=({data:e})=>{var c;const{settings:t}=Ke(),{t:s,language:a}=we();S.useMemo(()=>{var u;return((u=Jt.find(f=>f.code===t.localization.country))==null?void 0:u.name)||t.localization.country},[t.localization.country]);const i=new Date(e.payment.date).toLocaleDateString(a==="fr"?"fr-FR":"en-GB"),l=e.payment.id.includes("pay-")?`PAY-${(c=e.payment.id.split("-").pop())==null?void 0:c.substring(0,6).toUpperCase()}`:`PAY-${e.payment.id.substring(0,8).toUpperCase()}`;return n.jsx(ks,{children:n.jsxs("div",{className:"max-w-xl mx-auto border border-gray-400 p-6 bg-white",children:[n.jsxs("header",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[n.jsxs("div",{children:[n.jsx("img",{src:t.company.logoUrl,alt:"Logo",className:"h-12 mb-2 object-contain"}),n.jsx("h1",{className:"font-bold text-sm uppercase",children:t.company.name}),n.jsx("p",{className:"text-[10px] text-gray-600",children:t.company.address}),n.jsxs("p",{className:"text-[10px] text-gray-600",children:[s("phone"),": ",t.company.phone]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("h2",{className:"text-xl font-bold uppercase",children:s("payslip")}),n.jsxs("p",{className:"text-xs text-gray-500",children:[s("receiptNo"),": ",l]}),n.jsxs("p",{className:"text-xs text-gray-500",children:[s("dateLabel"),": ",i]})]})]}),n.jsx("section",{className:"mb-6 bg-gray-50 p-3 rounded border border-gray-200",children:n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:s("farmer")}),n.jsxs("span",{className:"font-bold",children:[e.farmer.firstName," ",e.farmer.lastName]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:s("code")}),n.jsx("span",{className:"font-mono",children:e.farmer.code})]}),n.jsxs("div",{children:[n.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:s("site")}),n.jsx("span",{children:e.siteName})]}),n.jsxs("div",{children:[n.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:s("period")}),n.jsx("span",{children:e.payment.period})]})]})}),n.jsxs("section",{className:"mb-6",children:[n.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1",children:s("paymentDetails")}),n.jsxs("table",{className:"w-full text-xs mb-4",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-gray-200",children:[n.jsx("th",{className:"text-left py-1",children:s("description")}),n.jsx("th",{className:"text-right py-1",children:s("weightKg")}),n.jsx("th",{className:"text-right py-1",children:s("unitPrice")}),n.jsx("th",{className:"text-right py-1",children:s("amount")})]})}),n.jsxs("tbody",{children:[e.grossDetails.map((u,f)=>n.jsxs("tr",{className:"border-b border-gray-100",children:[n.jsx("td",{className:"py-1",children:u.description}),n.jsx("td",{className:"text-right py-1",children:u.weight?Fe(u.weight,t.localization):"-"}),n.jsx("td",{className:"text-right py-1",children:u.unitPrice?Ae(u.unitPrice,t.localization):"-"}),n.jsx("td",{className:"text-right py-1",children:Ae(u.amount,t.localization)})]},f)),n.jsxs("tr",{className:"font-bold bg-gray-50",children:[n.jsx("td",{colSpan:3,className:"py-2 text-right",children:s("grossAmount")}),n.jsx("td",{className:"py-2 text-right",children:Ae(e.totalGross,t.localization)})]})]})]}),e.deductions.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1 text-red-600",children:s("deductions")}),n.jsx("table",{className:"w-full text-xs mb-4",children:n.jsxs("tbody",{children:[e.deductions.map((u,f)=>n.jsxs("tr",{className:"border-b border-gray-100 text-red-600",children:[n.jsx("td",{className:"py-1",children:u.description}),n.jsxs("td",{className:"text-right py-1",children:["-",Ae(u.amount,t.localization)]})]},f)),n.jsxs("tr",{className:"font-bold bg-red-50 text-red-700",children:[n.jsx("td",{className:"py-2 text-right",children:s("totalDeductions")}),n.jsxs("td",{className:"py-2 text-right",children:["-",Ae(e.totalDeductions,t.localization)]})]})]})})]})]}),n.jsxs("section",{className:"mb-8 bg-blue-50 p-4 rounded border border-blue-200 flex justify-between items-center",children:[n.jsx("span",{className:"text-lg font-bold text-blue-900 uppercase",children:s("netPaid")}),n.jsx("span",{className:"text-2xl font-bold text-blue-900",children:Ae(e.netPaid,t.localization)})]}),n.jsxs("section",{className:"mb-8 text-xs text-gray-600",children:[n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("paymentMethod"),":"]})," ",s(`paymentMethod_${e.payment.method}`)]}),e.payment.method==="mobile_money"&&n.jsxs(n.Fragment,{children:[n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("mobileMoneyRef"),":"]})," ",e.payment.transactionId||"N/A"]}),n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("phone"),":"]})," ",e.payment.phoneNumber]})]}),e.payment.notes&&n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[s("notes"),":"]})," ",e.payment.notes]})]}),n.jsxs("footer",{className:"flex justify-between text-xs mt-12 pt-4 border-t border-gray-300",children:[n.jsxs("div",{className:"text-center w-1/3",children:[n.jsx("p",{className:"font-bold mb-8",children:s("paidBy")}),n.jsx("p",{children:t.company.name})]}),n.jsxs("div",{className:"text-center w-1/3",children:[n.jsx("p",{className:"font-bold mb-8",children:s("receivedBy")}),n.jsxs("p",{children:[e.farmer.firstName," ",e.farmer.lastName]})]})]})]})})},VP=(e,t,s)=>{try{const[a,i]=e.split("-").map(Number);return new Date(a,i-1).toLocaleDateString(t,{month:"long",year:"numeric"})}catch{return e}},KP=()=>null,Sd=({onSelectAll:e,allSelected:t,header:s,children:a,footer:i})=>n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{checked:t,onChange:l=>e(l.target.checked)})}),s]})}),n.jsx("tbody",{children:a}),i&&n.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-bold border-t-2 border-gray-200 dark:border-gray-600",children:i})]}),WP=({payees:e,onSelectOne:t,onSelectAll:s,allSelected:a,onUpdate:i})=>{const{t:l}=we(),{settings:c}=Ke(),u=S.useMemo(()=>e.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.netWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[e]);return n.jsx(Sd,{onSelectAll:s,allSelected:a,header:n.jsxs(n.Fragment,{children:[n.jsx("th",{className:"p-3",children:l("farmer")}),n.jsx("th",{className:"p-3 text-right",children:l("netWeightKg")}),n.jsx("th",{className:"p-3 text-right",children:l("wetPrice")}),n.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),n.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),n.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),n.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:n.jsxs("tr",{children:[n.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),n.jsx("td",{className:"p-3 text-right",children:Fe(u.weight,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.base,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(u.deduction,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.net,c.localization)})]}),children:e.map(f=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:f.selected,onChange:h=>t(f.id,h.target.checked)})}),n.jsx("td",{className:"p-3",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:Fe(f.netWeightKg,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.wetPrice,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:n.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),n.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),n.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},JP=({payees:e,onSelectOne:t,onSelectAll:s,allSelected:a,onUpdate:i})=>{const{t:l}=we(),{settings:c}=Ke(),u=S.useMemo(()=>e.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.totalWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[e]);return n.jsx(Sd,{onSelectAll:s,allSelected:a,header:n.jsxs(n.Fragment,{children:[n.jsx("th",{className:"p-3",children:l("farmer")}),n.jsx("th",{className:"p-3 text-right",children:l("totalWeightKg")}),n.jsx("th",{className:"p-3 text-right",children:l("dryPrice")}),n.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),n.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),n.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),n.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:n.jsxs("tr",{children:[n.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),n.jsx("td",{className:"p-3 text-right",children:Fe(u.weight,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.base,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(u.deduction,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.net,c.localization)})]}),children:e.map(f=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:f.selected,onChange:h=>t(f.id,h.target.checked)})}),n.jsx("td",{className:"p-3",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:Fe(f.totalWeightKg,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.dryPrice,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:n.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),n.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),n.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},YP=({payees:e,onSelectOne:t,onSelectAll:s,allSelected:a,onUpdate:i})=>{const{t:l}=we(),{settings:c}=Ke(),u=S.useMemo(()=>e.filter(f=>f.selected).reduce((f,h)=>({lines:f.lines+h.totalLines,base:f.base+h.baseAmount,net:f.net+h.netAmount}),{lines:0,base:0,net:0}),[e]);return n.jsx(Sd,{onSelectAll:s,allSelected:a,header:n.jsxs(n.Fragment,{children:[n.jsx("th",{className:"p-3",children:l("serviceDate")}),n.jsx("th",{className:"p-3",children:l("serviceProvider")}),n.jsx("th",{className:"p-3 text-right",children:l("numberOfLines")}),n.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),n.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),n.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:n.jsxs("tr",{children:[n.jsx("td",{colSpan:3,className:"p-3 text-right uppercase",children:l("total")}),n.jsx("td",{className:"p-3 text-right",children:u.lines}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.base,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.net,c.localization)})]}),children:e.map(f=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:f.selected,onChange:h=>t(f.id,h.target.checked)})}),n.jsx("td",{className:"p-3",children:f.date}),n.jsx("td",{className:"p-3",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:f.totalLines}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:n.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),n.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},XP=({payees:e,onSelectOne:t,onSelectAll:s,allSelected:a,onUpdate:i})=>{const{t:l}=we(),{settings:c}=Ke(),u=S.useMemo(()=>e.filter(f=>f.selected).reduce((f,h)=>({base:f.base+h.baseSalary,gross:f.gross+h.totalGross,deduction:f.deduction+h.totalDeductions,net:f.net+h.netPay}),{base:0,gross:0,deduction:0,net:0}),[e]);return n.jsx(Sd,{onSelectAll:s,allSelected:a,header:n.jsxs(n.Fragment,{children:[n.jsx("th",{className:"p-3",children:l("employee")}),n.jsx("th",{className:"p-3 text-right",children:l("grossSalary")}),n.jsx("th",{className:"p-3 w-32 text-right",children:l("bonuses")}),n.jsx("th",{className:"p-3 w-32 text-right",children:l("overtime")}),n.jsx("th",{className:"p-3 text-right",children:l("totalGross")}),n.jsx("th",{className:"p-3 text-right",children:l("totalDeductions")}),n.jsx("th",{className:"p-3 text-right font-bold",children:l("netPay")})]}),footer:n.jsxs("tr",{children:[n.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.base,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:"-"}),n.jsx("td",{className:"p-2 text-right",children:"-"}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.gross,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.deduction,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(u.net,c.localization)})]}),children:e.map(f=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:f.selected,onChange:h=>t(f.id,h.target.checked)})}),n.jsx("td",{className:"p-3",children:f.name}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.baseSalary,c.localization)}),n.jsx("td",{className:"p-2 text-right",children:n.jsx(de,{type:"number",value:f.bonuses,onChange:h=>i(f.id,"bonuses",h.target.value),className:"text-right !py-1"})}),n.jsx("td",{className:"p-2 text-right",children:n.jsx(de,{type:"number",value:f.overtime,onChange:h=>i(f.id,"overtime",h.target.value),className:"text-right !py-1"})}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.totalGross,c.localization)}),n.jsx("td",{className:"p-3 text-right",children:Ae(f.totalDeductions,c.localization)}),n.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netPay,c.localization)})]},f.id))})},QP=({onCancel:e,onConfirmSuccess:t,config:s})=>{const{t:a,language:i}=we(),{settings:l}=Ke(),{farmers:c,sites:u,seaweedTypes:f,cultivationCycles:h,modules:m,farmerCredits:x,repayments:y,farmerDeliveries:b,cuttingOperations:T,serviceProviders:_,employees:j,addMultipleMonthlyPayments:E,addMultipleRepayments:k,updateMultipleCuttingOperations:C,markCyclesAsPaid:A,markDeliveriesAsPaid:M}=He(),[I,P]=S.useState([]),[D,U]=S.useState({enabled:!0,type:"percentage",value:100}),[O,F]=S.useState(!1),[q,z]=S.useState(!1),[Y,J]=S.useState(!1),[G,B]=S.useState(null),Q=S.useCallback(()=>{var Ve;let fe=[];const{paymentType:Z,startDate:ee,endDate:xe,siteId:Oe,seaweedTypeId:De}=s,Re=ze=>{const Se=x.filter(be=>be.farmerId===ze).reduce((be,ye)=>be+ye.totalAmount,0),Le=y.filter(be=>be.farmerId===ze).reduce((be,ye)=>be+ye.amount,0);return Se-Le};if(Z==="farmer_wet")fe=c.filter(Se=>Oe==="all"||Se.siteId===Oe).map(Se=>{var At;const Le=h.filter(ut=>{const Ut=m.find(Ct=>Ct.id===ut.moduleId);return(Ut==null?void 0:Ut.farmerId)===Se.id&&ut.harvestDate&&ut.harvestDate>=ee&&ut.harvestDate<=xe&&!ut.paymentRunId&&(De==="all"||ut.seaweedTypeId===De)});if(Le.length===0)return null;const be=Le.reduce((ut,Ut)=>{var Yt;const Ct=(Ut.harvestedWeight||0)-(Ut.cuttingsTakenAtHarvestKg||0),vt=((Yt=f.find(Ps=>Ps.id===Ut.seaweedTypeId))==null?void 0:Yt.wetPrice)||0;return ut+Ct*vt},0),ye=Le.reduce((ut,Ut)=>ut+((Ut.harvestedWeight||0)-(Ut.cuttingsTakenAtHarvestKg||0)),0),Ue=ye>0?be/ye:0;return{id:Se.id,type:Wt.FARMER,name:`${Se.firstName} ${Se.lastName}`,siteName:((At=u.find(ut=>ut.id===Se.siteId))==null?void 0:At.name)||"",baseAmount:be,adjustment:0,deduction:0,netAmount:be,creditBalance:Re(Se.id),selected:!0,cycleIds:Le.map(ut=>ut.id),harvestedWeightKg:Le.reduce((ut,Ut)=>ut+(Ut.harvestedWeight||0),0),cuttingsWeightKg:Le.reduce((ut,Ut)=>ut+(Ut.cuttingsTakenAtHarvestKg||0),0),netWeightKg:ye,wetPrice:Ue}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Z==="farmer_dry"){const ze=c.filter(Le=>Oe==="all"||Le.siteId===Oe),Se=new Map(f.map(Le=>[Le.id,Le.dryPrice]));fe=ze.map(Le=>{var Ut;const be=b.filter(Ct=>Ct.farmerId===Le.id&&Ct.date>=ee&&Ct.date<=xe&&!Ct.paymentRunId&&(De==="all"||Ct.seaweedTypeId===De));if(be.length===0)return null;const ye=be.reduce((Ct,vt)=>{const Yt=Se.get(vt.seaweedTypeId)||0;return Ct+vt.totalWeightKg*Yt},0),Ue=be.reduce((Ct,vt)=>Ct+vt.totalWeightKg,0),et=be.reduce((Ct,vt)=>Ct+vt.totalBags,0),At=be.length>0&&Ue>0?ye/Ue:0;return{id:Le.id,type:Wt.FARMER,name:`${Le.firstName} ${Le.lastName}`,siteName:((Ut=u.find(Ct=>Ct.id===Le.siteId))==null?void 0:Ut.name)||"",totalWeightKg:Ue,dryPrice:At,baseAmount:ye,totalBags:et,adjustment:0,deduction:0,netAmount:ye,creditBalance:Re(Le.id),selected:!0,deliveryIds:be.map(Ct=>Ct.id)}}).filter(Le=>Le!==null&&Le.baseAmount>0)}else if(Z==="service_provider")fe=T.filter(Se=>!Se.isPaid&&Se.date>=ee&&Se.date<=xe&&(Oe==="all"||Se.siteId===Oe)&&(De==="all"||Se.seaweedTypeId===De)).map(Se=>{const Le=_.find(Ue=>Ue.id===Se.serviceProviderId),be=Se.moduleCuts.reduce((Ue,et)=>Ue+et.linesCut,0);return{id:Se.id,serviceProviderId:Se.serviceProviderId,type:Wt.SERVICE_PROVIDER,name:(Le==null?void 0:Le.name)||"Unknown",date:Se.date,unpaidOperations:1,baseAmount:Se.totalAmount,adjustment:0,deduction:0,netAmount:Se.totalAmount,selected:!0,operationIds:[Se.id],totalLines:be,averageUnitPrice:Se.unitPrice}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Z==="employee_payroll"){if(!((Ve=Jt.find(Le=>Le.code===l.localization.country))==null?void 0:Ve.payroll)){alert(a("alert_noPayrollConfig"));return}fe=j.filter(Le=>Oe==="all"||Le.siteId===Oe).map(Le=>{var Ue;const be=Ko(Le.grossWage,0,0,0,l.localization);return{id:Le.id,type:Wt.EMPLOYEE,name:`${Le.firstName} ${Le.lastName}`,siteName:((Ue=u.find(et=>et.id===Le.siteId))==null?void 0:Ue.name)||"",selected:!0,baseAmount:be.totalGross,deduction:be.totalDeductions,netAmount:be.netPay,...be}})}P(fe)},[s,c,u,f,h,m,x,y,b,T,_,j,l.localization,a]);S.useEffect(()=>{Q()},[Q]);const W=(fe,Z,ee)=>{const xe=parseFloat(ee)||0;P(Oe=>Oe.map(De=>{if(De.id===fe){if(De.type===Wt.EMPLOYEE){const Re={...De,[Z]:xe},Ve=Ko(Re.baseSalary,Re.bonuses,Re.overtime,Re.otherDeductions,l.localization);return{...Re,...Ve,baseAmount:Ve.totalGross,deduction:Ve.totalDeductions,netAmount:Ve.netPay}}else if("adjustment"in De){const Re=De.baseAmount-De.adjustment+xe;return{...De,adjustment:xe,netAmount:Re-De.deduction}}}return De}))};S.useEffect(()=>{P(fe=>fe.map(Z=>{if(Z.type===Wt.FARMER&&Z.selected){let ee=0;const xe=Z.baseAmount+Z.adjustment;return D.enabled&&Z.creditBalance&&Z.creditBalance>0&&(D.type==="percentage"?ee=xe*D.value/100:ee=D.value,ee=Math.min(ee,xe,Z.creditBalance)),{...Z,deduction:ee,netAmount:xe-ee}}return Z}))},[D,I.map(fe=>fe.baseAmount+(fe.type!==Wt.EMPLOYEE?fe.adjustment:0)).join(",")]);const ae=fe=>{U(fe)},$=(fe,Z)=>{P(ee=>ee.map(xe=>xe.id===fe?{...xe,selected:Z}:xe))},ie=fe=>{P(Z=>Z.map(ee=>({...ee,selected:fe})))},ue=I.filter(fe=>fe.selected),Ne=I.length>0&&ue.length===I.length,le=S.useMemo(()=>ue.reduce((fe,Z)=>(fe.base+=Z.baseAmount+(Z.type!==Wt.EMPLOYEE?Z.adjustment:0),fe.deduction+=Z.deduction,fe.net+=Z.netAmount,fe),{base:0,deduction:0,net:0}),[ue]),ne=()=>{const fe=`pr-${Date.now()}`,Z=new Date().toISOString().split("T")[0],ee=[],xe=[],Oe=[],De=[],Re=[];ue.forEach(Ve=>{Ve.netAmount<=0&&Ve.deduction<=0||(Ve.netAmount>0&&ee.push({date:Z,period:s.periodName,recipientType:Ve.type,recipientId:Ve.serviceProviderId||Ve.id,amount:Ve.netAmount,method:"cash",notes:`Payment for period: ${s.startDate} to ${s.endDate}`,paymentRunId:fe,paymentStatus:"PENDING"}),"deduction"in Ve&&Ve.deduction>0&&Ve.type===Wt.FARMER&&xe.push({date:Z,farmerId:Ve.id,amount:Ve.deduction,method:"harvest_deduction",notes:`Deduction from payment run: ${s.periodName}`,paymentRunId:fe}),Ve.type===Wt.SERVICE_PROVIDER&&"operationIds"in Ve?Oe.push(...Ve.operationIds):s.paymentType==="farmer_wet"&&"cycleIds"in Ve?De.push(...Ve.cycleIds):s.paymentType==="farmer_dry"&&"deliveryIds"in Ve&&Re.push(...Ve.deliveryIds))}),ee.length>0&&E(ee),xe.length>0&&k(xe),Oe.length>0&&C(Oe,Z),De.length>0&&A(De,fe),Re.length>0&&M(Re,fe),t()},je=()=>{var Re,Ve;let fe="",Z="",ee=[];switch(s.paymentType){case"farmer_wet":fe=a("wetDeliveryPaymentSheetTitle"),Z=a("farmer"),ee=[{key:"name",label:a("farmer"),width:"25%"},{key:"harvestedWeightKg",label:a("harvestedWeightKg"),align:"right",format:"number",width:"12%"},{key:"cuttingsWeightKg",label:a("cuttingsWeightKg"),align:"right",format:"number",width:"12%"},{key:"netWeightKg",label:a("netWeightKg"),align:"right",format:"number",width:"12%"},{key:"wetPrice",label:a("wetPrice"),align:"right",format:"currency",width:"10%"},{key:"baseAmount",label:a("baseAmount"),align:"right",format:"currency",width:"12%"},{key:"deduction",label:a("creditDeduction"),align:"right",format:"currency",width:"12%"},{key:"netAmount",label:a("netPayable"),align:"right",format:"currency",width:"15%"}];break;case"farmer_dry":fe=a("dryDeliveryPaymentSheetTitle"),Z=a("farmer"),ee=[{key:"name",label:a("farmer"),width:"30%"},{key:"totalWeightKg",label:a("totalWeightKg"),align:"right",format:"number",width:"15%"},{key:"dryPrice",label:a("pricePerKg"),align:"right",format:"currency",width:"15%"},{key:"baseAmount",label:a("baseAmount"),align:"right",format:"currency",width:"15%"},{key:"deduction",label:a("creditDeduction"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:a("netPayable"),align:"right",format:"currency",width:"20%"}];break;case"service_provider":fe=a("cuttingPaymentSheetTitle"),Z=a("provider"),ee=[{key:"date",label:a("dateTrans"),width:"10%"},{key:"name",label:a("provider"),width:"30%"},{key:"totalLines",label:a("numberOfLines"),align:"right",format:"number",width:"15%"},{key:"averageUnitPrice",label:a("unitPrice"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:a("montantAPayer"),align:"right",format:"currency",width:"15%"}];break;case"employee_payroll":fe=a("employeePayroll"),Z=a("employee"),ee=[{key:"name",label:a("employee"),width:"25%"},{key:"baseSalary",label:a("grossSalary"),align:"right",format:"currency",width:"15%"},{key:"totalGross",label:a("totalGross"),align:"right",format:"currency",width:"15%"},{key:"totalDeductions",label:a("totalDeductions"),align:"right",format:"currency",width:"15%"},{key:"netPay",label:a("netPay"),align:"right",format:"currency",width:"15%"}];break}const xe=ue.reduce((ze,Se)=>ze+Se.netAmount,0),Oe=s.seaweedTypeId!=="all"?(Re=f.find(ze=>ze.id===s.seaweedTypeId))==null?void 0:Re.name:a("various"),De={title:fe,periodName:s.periodName,headerInfo:[{label:a("date"),value:new Date().toLocaleDateString(i)},{label:a("period"),value:`${s.startDate} - ${s.endDate}`},{label:a("site"),value:s.siteId==="all"?a("allSites"):(Ve=u.find(ze=>ze.id===s.siteId))==null?void 0:Ve.name},{label:a("seaweedType"),value:Oe}],columns:ee,rows:ue.map(ze=>({beneficiaryName:ze.name,...ze})),totalLabel:a("totalToPay"),totalValue:xe,totalValueInWords:jN(xe,i,l.localization),denominations:l.localization.denominations,beneficiaryTypeLabel:Z,status:"Unpaid"};B(De),J(!0)};return n.jsxs(Ge,{title:a("reviewPaymentRun"),children:[n.jsxs("p",{className:"mb-4",children:[s.periodName," (",s.startDate," to ",s.endDate,")"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[n.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[n.jsx("p",{className:"text-sm text-gray-500",children:a("totalPayees")}),n.jsx("p",{className:"text-2xl font-bold",children:ue.length})]}),n.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[n.jsx("p",{className:"text-sm text-gray-500",children:a("totalBaseAmount")}),n.jsx("p",{className:"text-2xl font-bold",children:Ae(le.base,l.localization)})]}),n.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[n.jsx("p",{className:"text-sm text-gray-500",children:a("totalDeductions")}),n.jsx("p",{className:"text-2xl font-bold",children:Ae(le.deduction,l.localization)})]}),n.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[n.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:a("totalNetPayable")}),n.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(le.net,l.localization)})]})]}),n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsxs("div",{className:"flex gap-4",children:[s.paymentType.startsWith("farmer")&&n.jsxs(se,{variant:"secondary",onClick:()=>F(!0),children:[n.jsx(te,{name:"Settings",className:"w-4 h-4"}),a("configureDeductions")]}),n.jsxs(se,{onClick:je,children:[n.jsx(te,{name:"Download",className:"w-4 h-4"}),a("downloadPdf")]}),n.jsxs(se,{onClick:()=>z(!0),disabled:ue.length===0,children:[n.jsx(te,{name:"Check",className:"w-4 h-4"}),a("confirmAndPay")]})]}),n.jsxs(se,{variant:"secondary",onClick:e,children:[n.jsx(te,{name:"ChevronLeft",className:"w-4 h-4"}),a("back")]})]}),n.jsxs("div",{className:"overflow-x-auto",children:[s.paymentType==="farmer_wet"&&n.jsx(WP,{payees:I,onSelectOne:$,onSelectAll:ie,allSelected:Ne,onUpdate:W}),s.paymentType==="farmer_dry"&&n.jsx(JP,{payees:I,onSelectOne:$,onSelectAll:ie,allSelected:Ne,onUpdate:W}),s.paymentType==="service_provider"&&n.jsx(YP,{payees:I,onSelectOne:$,onSelectAll:ie,allSelected:Ne,onUpdate:W}),s.paymentType==="employee_payroll"&&n.jsx(XP,{payees:I,onSelectOne:$,onSelectAll:ie,allSelected:Ne,onUpdate:W})]}),G&&n.jsx(ot,{isOpen:Y,onClose:()=>J(!1),title:a("printDocuments"),widthClass:"max-w-screen-xl",children:n.jsx($P,{data:G})}),q&&n.jsx(zt,{isOpen:q,onClose:()=>z(!1),onConfirm:ne,title:a("confirmPayment"),message:a("confirmPaymentMessage").replace("{count}",String(ue.length)),confirmText:a("confirm")}),O&&n.jsx(KP,{isOpen:O,onClose:()=>F(!1),initialConfig:D,onSave:fe=>{ae(fe),F(!1)}})]})},ZP=()=>{const{t:e,language:t}=we(),{settings:s}=Ke(),{monthlyPayments:a,farmers:i,employees:l,serviceProviders:c,deleteMonthlyPayment:u,updateMonthlyPayment:f,repayments:h,cultivationCycles:m,farmerDeliveries:x,seaweedTypes:y,sites:b}=He(),[T,_]=S.useState(!1),[j,E]=S.useState(null),[k,C]=S.useState(!1),[A,M]=S.useState(null),[I,P]=S.useState({key:"date",direction:"descending"}),[D,U]=S.useState(new Set),[O,F]=S.useState(!1),[q,z]=S.useState(null),Y=S.useMemo(()=>{const le=new Map;return i.forEach(ne=>le.set(`${Wt.FARMER}-${ne.id}`,`${ne.firstName} ${ne.lastName}`)),l.forEach(ne=>le.set(`${Wt.EMPLOYEE}-${ne.id}`,`${ne.firstName} ${ne.lastName}`)),c.forEach(ne=>le.set(`${Wt.SERVICE_PROVIDER}-${ne.id}`,ne.name)),le},[i,l,c]),J=S.useMemo(()=>{let le=[...a];return le.sort((ne,je)=>{let fe,Z;return I.key==="recipientName"?(fe=Y.get(`${ne.recipientType}-${ne.recipientId}`)||"",Z=Y.get(`${je.recipientType}-${je.recipientId}`)||""):(fe=ne[I.key],Z=je[I.key]),fe<Z?I.direction==="ascending"?-1:1:fe>Z?I.direction==="ascending"?1:-1:0}),le},[a,I,Y]),G=le=>{let ne="ascending";I.key===le&&I.direction==="ascending"&&(ne="descending"),P({key:le,direction:ne})},B=le=>I.key!==le?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):I.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Q=({sortKey:le,label:ne})=>n.jsx("th",{className:"p-3",children:n.jsxs("button",{onClick:()=>G(le),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[ne,B(le)]})}),W=(le=null)=>{E(le),_(!0)},ae=le=>{M(le),C(!0)},$=()=>{A&&u(A),C(!1),M(null)},ie=async le=>{if(!D.has(le.id)){U(ne=>new Set(ne).add(le.id)),f({...le,paymentStatus:"PROCESSING"});try{const ne=await HP(le);ne.success?(f({...le,paymentStatus:"COMPLETED",transactionId:ne.transactionId}),alert(`Payment Successful! Transaction ID: ${ne.transactionId}`)):(f({...le,paymentStatus:"FAILED"}),alert(`Payment Failed: ${ne.message}`))}catch(ne){console.error("Payment processing error",ne),f({...le,paymentStatus:"FAILED"}),alert("An unexpected error occurred.")}finally{U(ne=>{const je=new Set(ne);return je.delete(le.id),je})}}},ue=le=>{if(le.recipientType!==Wt.FARMER){alert("Only Farmer receipts are currently supported for detailed printing.");return}const ne=i.find(ze=>ze.id===le.recipientId);if(!ne)return;const je=b.find(ze=>ze.id===ne.siteId),fe=le.paymentRunId,Z=h.filter(ze=>ze.farmerId===ne.id&&ze.paymentRunId===fe),ee=[];m.filter(ze=>ze.paymentRunId===fe).forEach(ze=>{const Se=(ze.harvestedWeight||0)-(ze.cuttingsTakenAtHarvestKg||0),Le=y.find(be=>be.id===ze.seaweedTypeId);ee.push({description:`Harvest: ${Le==null?void 0:Le.name} (${ze.harvestDate})`,weight:Se,unitPrice:Le==null?void 0:Le.wetPrice,amount:Se*((Le==null?void 0:Le.wetPrice)||0)})}),x.filter(ze=>ze.paymentRunId===fe).forEach(ze=>{const Se=y.find(Le=>Le.id===ze.seaweedTypeId);ee.push({description:`Delivery: ${Se==null?void 0:Se.name} (${ze.date})`,weight:ze.totalWeightKg,unitPrice:Se==null?void 0:Se.dryPrice,amount:ze.totalWeightKg*((Se==null?void 0:Se.dryPrice)||0)})}),ee.length===0&&ee.push({description:"Manual Payment / Adjustment",amount:le.amount+Z.reduce((ze,Se)=>ze+Se.amount,0)});const De=Z.map(ze=>({description:ze.notes||"Credit Repayment",amount:ze.amount})),Re=ee.reduce((ze,Se)=>ze+Se.amount,0),Ve=De.reduce((ze,Se)=>ze+Se.amount,0);z({payment:le,farmer:ne,siteName:(je==null?void 0:je.name)||"",grossDetails:ee,deductions:De,totalGross:Re,totalDeductions:Ve,netPaid:le.amount}),F(!0)},Ne=(le,ne)=>{const je=`${le}-${ne}`,fe=Y.get(je);return fe||n.jsx("span",{className:"text-gray-500 italic",children:e("unknown")})};return n.jsxs(Ge,{title:e("paymentHistory"),children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx(Q,{sortKey:"date",label:e("paymentDate")}),n.jsx(Q,{sortKey:"period",label:e("period")}),n.jsx(Q,{sortKey:"recipientName",label:e("recipient")}),n.jsx(Q,{sortKey:"recipientType",label:e("recipientType")}),n.jsx("th",{className:"p-3 text-right",children:e("amount")}),n.jsx("th",{className:"p-3",children:e("paymentMethod")}),n.jsx("th",{className:"p-3",children:e("paymentStatus")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsx("tbody",{children:J.map(le=>{const ne=D.has(le.id);return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[n.jsx("td",{className:"p-3",children:le.date}),n.jsx("td",{className:"p-3",children:VP(le.period,t)}),n.jsx("td",{className:"p-3 font-semibold",children:Ne(le.recipientType,le.recipientId)}),n.jsx("td",{className:"p-3",children:e(`recipientType_${le.recipientType}`)}),n.jsx("td",{className:"p-3 text-right",children:Ae(le.amount,s.localization)}),n.jsx("td",{className:"p-3",children:e(`paymentMethod_${le.method}`)}),n.jsxs("td",{className:"p-3",children:[le.paymentStatus?n.jsx(vn,{status:le.paymentStatus}):"-",le.transactionId&&n.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate max-w-[100px]",title:le.transactionId,children:le.transactionId})]}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[le.recipientType===Wt.FARMER&&n.jsx(se,{variant:"ghost",onClick:()=>ue(le),title:e("print"),children:n.jsx(te,{name:"Printer",className:"w-4 h-4"})}),le.method==="mobile_money"&&(le.paymentStatus==="PENDING"||le.paymentStatus==="FAILED")&&n.jsx(se,{variant:"primary",className:"!py-1 !px-2 text-xs",onClick:()=>ie(le),disabled:ne,children:ne?n.jsx(te,{name:"Activity",className:"w-3 h-3 animate-spin"}):e("payNow")}),n.jsx(se,{variant:"ghost",onClick:()=>W(le),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",onClick:()=>ae(le.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},le.id)})})]})}),T&&n.jsx(BP,{isOpen:T,onClose:()=>_(!1),payment:j}),k&&n.jsx(zt,{isOpen:k,onClose:()=>C(!1),onConfirm:$,title:e("confirmDeletePayment"),message:e("confirmDeletePaymentMessage")}),q&&n.jsx(ot,{isOpen:O,onClose:()=>F(!1),title:e("farmerReceipt"),widthClass:"max-w-screen-md",children:n.jsx(qP,{data:q})})]})},eO=({onPrepare:e})=>{const{t}=we(),{sites:s,seaweedTypes:a}=He(),[i,l]=S.useState({periodName:"",startDate:"",endDate:new Date().toISOString().split("T")[0],paymentType:"farmer_wet",siteId:"all",seaweedTypeId:"all"}),c=i.paymentType.startsWith("farmer")||i.paymentType==="service_provider";return n.jsxs(Ge,{title:t("paymentRunSetup"),children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[n.jsx(de,{label:t("periodName"),value:i.periodName,onChange:u=>l(f=>({...f,periodName:u.target.value})),placeholder:"e.g. July 2024 Payments",required:!0}),n.jsx(de,{label:t("startDate"),type:"date",value:i.startDate,onChange:u=>l(f=>({...f,startDate:u.target.value})),required:!0}),n.jsx(de,{label:t("endDate"),type:"date",value:i.endDate,onChange:u=>l(f=>({...f,endDate:u.target.value})),required:!0}),n.jsxs(ke,{label:t("paymentType"),value:i.paymentType,onChange:u=>l(f=>({...f,paymentType:u.target.value})),children:[n.jsx("option",{value:"farmer_wet",children:t("wetDeliveryPayment")}),n.jsx("option",{value:"farmer_dry",children:t("dryDeliveryPayment")}),n.jsx("option",{value:"service_provider",children:t("serviceProviderPayment")}),n.jsx("option",{value:"employee_payroll",children:t("employeePayroll")})]}),n.jsxs(ke,{label:t("site"),value:i.siteId,onChange:u=>l(f=>({...f,siteId:u.target.value})),children:[n.jsx("option",{value:"all",children:t("allSites")}),s.map(u=>n.jsx("option",{value:u.id,children:u.name},u.id))]}),c&&n.jsxs(ke,{label:t("seaweedType"),value:i.seaweedTypeId,onChange:u=>l(f=>({...f,seaweedTypeId:u.target.value})),children:[n.jsx("option",{value:"all",children:t("allSeaweedTypes")}),a.map(u=>n.jsx("option",{value:u.id,children:u.name},u.id))]})]}),n.jsx("div",{className:"mt-6",children:n.jsx(se,{onClick:()=>e(i),disabled:!i.periodName||!i.startDate||!i.endDate,children:t("preparePaymentRun")})})]})},tO=()=>{const{t:e}=we(),[t,s]=S.useState("setup"),[a,i]=S.useState(null),l=f=>{i(f),s("review")},c=()=>{i(null),s("setup")},u=()=>{alert(e("paymentsRecordedSuccess")),i(null),s("setup")};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold mb-6",children:e("documentPaymentsTitle")}),t==="setup"&&n.jsx(eO,{onPrepare:l}),t==="review"&&a&&n.jsx(QP,{onCancel:c,onConfirmSuccess:u,config:a}),n.jsx("div",{className:"mt-8",children:n.jsx(ZP,{})})]})},tf=["PLANTING","PERIOD_1","PERIOD_2","PERIOD_3","PERIOD_4","PERIOD_5"],nO=({isOpen:e,onClose:t,test:s})=>{const{t:a}=we(),{sites:i,seaweedTypes:l,employees:c,addPeriodicTest:u,updatePeriodicTest:f,periodicTests:h}=He(),[m,x]=S.useState({identity:"",date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",zoneId:"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:""}),[y,b]=S.useState([]),[T,_]=S.useState({}),[j,E]=S.useState(!1),[k,C]=S.useState(null),A=S.useCallback(()=>{const D={};return m.identity.trim()||(D.identity=a("validationRequired")),m.date||(D.date=a("validationRequired")),m.siteId||(D.siteId=a("validationRequired")),m.seaweedTypeId||(D.seaweedTypeId=a("validationRequired")),m.zoneId||(D.zoneId=a("validationRequired")),m.conductorId||(D.conductorId=a("validationRequired")),(isNaN(m.weightKg)||m.weightKg<0)&&(D.weightKg=a("validationNonNegative")),D},[m,a]);S.useEffect(()=>{var D,U,O,F,q;x(s||{identity:"",date:new Date().toISOString().split("T")[0],siteId:((D=i[0])==null?void 0:D.id)||"",seaweedTypeId:((U=l[0])==null?void 0:U.id)||"",zoneId:((F=(O=i[0])==null?void 0:O.zones[0])==null?void 0:F.id)||"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:((q=c[0])==null?void 0:q.id)||""}),_({}),E(!1),C(null)},[s,e,i,l,c]),S.useEffect(()=>{if(m.period==="PLANTING"||!m.identity||!m.date||m.weightKg<=0){m.growthRate!==null&&x(F=>({...F,growthRate:null}));return}const D=tf.indexOf(m.period);if(D<=0)return;const U=tf[D-1],O=h.find(F=>F.identity.toLowerCase()===m.identity.toLowerCase()&&F.period===U&&F.siteId===m.siteId);if(O&&O.weightKg>0&&O.date){const F=new Date(O.date).getTime(),z=(new Date(m.date).getTime()-F)/(1e3*60*60*24);if(z>0){const Y=O.weightKg,J=m.weightKg,G=(Math.log(J)-Math.log(Y))/z*100,B=parseFloat(G.toFixed(2));m.growthRate!==B&&x(Q=>({...Q,growthRate:B}))}else m.growthRate!==null&&x(Y=>({...Y,growthRate:null}))}else m.growthRate!==null&&x(F=>({...F,growthRate:null}))},[m.period,m.identity,m.weightKg,m.date,m.siteId,h,m.growthRate]),S.useEffect(()=>{_(A())},[m,A]),S.useEffect(()=>{const D=i.find(U=>U.id===m.siteId);b((D==null?void 0:D.zones)||[]),D&&!D.zones.some(U=>U.id===m.zoneId)&&x(U=>{var O;return{...U,zoneId:((O=D.zones[0])==null?void 0:O.id)||""}})},[m.siteId,i]);const M=async()=>{var U,O,F,q,z,Y,J,G;E(!0),C(null);const D=i.find(B=>B.id===m.siteId);if(!D||!D.location||!m.date){C({type:"error",message:a("weatherFetchMissingInfo")}),E(!1);return}try{const[B,Q]=D.location.split(","),W=mn(B.trim()),ae=mn(Q.trim()),$=m.date,ie=`https://archive-api.open-meteo.com/v1/archive?latitude=${W.toFixed(4)}&longitude=${ae.toFixed(4)}&start_date=${$}&end_date=${$}&daily=temperature_2m_mean,precipitation_sum,wind_speed_10m_max,wind_direction_10m_dominant&timezone=auto`,ue=await fetch(ie);if(!ue.ok)throw new Error("Failed to fetch weather data from API.");const Ne=await ue.json();if(Ne.daily){const le=Ne.daily,ne={...m};((U=le.temperature_2m_mean)==null?void 0:U[0])!==null&&((O=le.temperature_2m_mean)==null?void 0:O[0])!==void 0&&(ne.temperature=le.temperature_2m_mean[0]),((F=le.precipitation_sum)==null?void 0:F[0])!==null&&((q=le.precipitation_sum)==null?void 0:q[0])!==void 0&&(ne.precipitation=le.precipitation_sum[0]),((z=le.wind_speed_10m_max)==null?void 0:z[0])!==null&&((Y=le.wind_speed_10m_max)==null?void 0:Y[0])!==void 0&&(ne.windSpeed=le.wind_speed_10m_max[0]),((J=le.wind_direction_10m_dominant)==null?void 0:J[0])!==null&&((G=le.wind_direction_10m_dominant)==null?void 0:G[0])!==void 0&&(ne.windDirection=le.wind_direction_10m_dominant[0]),ne.waveHeight=null,ne.salinity=null,x(ne),C({type:"success",message:a("weatherFetchSuccess")})}else throw new Error("No daily data in weather API response.")}catch(B){console.error("Error fetching weather data:",B),C({type:"error",message:a("weatherFetchError")})}finally{E(!1)}},I=()=>{const D=A();if(Object.keys(D).length>0){_(D);return}s?f({...s,...m}):u(m),t()},P=Object.keys(T).length>0;return n.jsxs(ot,{isOpen:e,onClose:t,title:a(s?"editTest":"addTest"),widthClass:"max-w-4xl",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsx(Ge,{title:a("sheetInfo"),className:"lg:col-span-1",children:n.jsxs("div",{className:"space-y-4",children:[n.jsx(de,{label:a("identity"),value:m.identity,onChange:D=>x(U=>({...U,identity:D.target.value})),error:T.identity,required:!0}),n.jsx(de,{label:a("date"),type:"date",value:m.date,onChange:D=>x(U=>({...U,date:D.target.value})),error:T.date,required:!0}),n.jsx(ke,{label:a("site"),value:m.siteId,onChange:D=>x(U=>({...U,siteId:D.target.value})),error:T.siteId,required:!0,children:i.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))}),n.jsx(ke,{label:a("seaweedType"),value:m.seaweedTypeId,onChange:D=>x(U=>({...U,seaweedTypeId:D.target.value})),error:T.seaweedTypeId,required:!0,children:l.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))}),n.jsx(ke,{label:a("zoneName"),value:m.zoneId,onChange:D=>x(U=>({...U,zoneId:D.target.value})),disabled:!m.siteId,error:T.zoneId,required:!0,children:y.map(D=>n.jsx("option",{value:D.id,children:D.name},D.id))}),n.jsx(ke,{label:a("period"),value:m.period,onChange:D=>x(U=>({...U,period:D.target.value})),required:!0,children:tf.map(D=>n.jsx("option",{value:D,children:a(`period_${D}`)},D))}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(de,{label:a("weightKg"),type:"number",value:m.weightKg,onChange:D=>x(U=>({...U,weightKg:parseFloat(D.target.value)||0})),error:T.weightKg,required:!0}),n.jsx(de,{label:`${a("growthRate")} (%)`,type:"number",value:m.growthRate!==null?m.growthRate:"",disabled:!0,placeholder:"Auto"})]}),n.jsx(ke,{label:a("conductor"),value:m.conductorId,onChange:D=>x(U=>({...U,conductorId:D.target.value})),error:T.conductorId,required:!0,children:c.map(D=>n.jsxs("option",{value:D.id,children:[D.firstName," ",D.lastName]},D.id))})]})}),n.jsx(Ge,{title:a("weatherData"),className:"lg:col-span-2",children:n.jsxs("div",{className:"space-y-4",children:[k&&n.jsx("p",{className:`text-xs ${k.type==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:k.message}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"radio",name:"weatherDataSource",value:"manual",checked:m.weatherDataSource==="manual",onChange:()=>x(D=>({...D,weatherDataSource:"manual"}))}),n.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:a("manualEntry")})]}),n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"radio",name:"weatherDataSource",value:"auto",checked:m.weatherDataSource==="auto",onChange:()=>x(D=>({...D,weatherDataSource:"auto"}))}),n.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:a("autoFill")})]})]}),m.weatherDataSource==="auto"&&n.jsxs(se,{type:"button",variant:"secondary",className:"w-full",onClick:M,disabled:j||!m.siteId||!m.date,children:[n.jsx(te,{name:j?"Activity":"Download",className:`w-5 h-5 ${j?"animate-spin":""}`}),a(j?"fetchingWeather":"fetchWeather")]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx(de,{label:`${a("temperature")} (C)`,type:"number",step:"any",value:m.temperature??"",onChange:D=>x(U=>({...U,temperature:D.target.value===""?null:parseFloat(D.target.value)})),disabled:m.weatherDataSource==="auto"}),n.jsx(de,{label:`${a("salinity")} ()`,type:"number",step:"any",value:m.salinity??"",onChange:D=>x(U=>({...U,salinity:D.target.value===""?null:parseFloat(D.target.value)}))}),n.jsx(de,{label:`${a("precipitation")} (mm)`,type:"number",step:"any",value:m.precipitation??"",onChange:D=>x(U=>({...U,precipitation:D.target.value===""?null:parseFloat(D.target.value)})),disabled:m.weatherDataSource==="auto"}),n.jsx(de,{label:`${a("windSpeed")} (km/h)`,type:"number",step:"any",value:m.windSpeed??"",onChange:D=>x(U=>({...U,windSpeed:D.target.value===""?null:parseFloat(D.target.value)})),disabled:m.weatherDataSource==="auto"}),n.jsx(de,{label:`${a("windDirection")} ()`,type:"number",step:"any",value:m.windDirection??"",onChange:D=>x(U=>({...U,windDirection:D.target.value===""?null:parseFloat(D.target.value)})),disabled:m.weatherDataSource==="auto"}),n.jsx(de,{label:`${a("waveHeight")} (m)`,type:"number",step:"any",value:m.waveHeight??"",onChange:D=>x(U=>({...U,waveHeight:D.target.value===""?null:parseFloat(D.target.value)}))})]})]})})]}),n.jsxs("div",{className:"flex justify-end gap-3 pt-4 mt-4 border-t dark:border-gray-700",children:[n.jsx(se,{variant:"secondary",onClick:t,children:a("cancel")}),n.jsx(se,{onClick:I,disabled:P,children:a("save")})]})]})},sO=()=>{const{t:e}=we(),{periodicTests:t,sites:s,seaweedTypes:a,employees:i,deletePeriodicTest:l}=He(),[c,u]=S.useState(!1),[f,h]=S.useState(null),[m,x]=S.useState(!1),[y,b]=S.useState(null),[T,_]=S.useState({key:"date",direction:"descending"}),{settings:j}=Ke(),E=S.useMemo(()=>new Map(s.map(z=>[z.id,z.name])),[s]),k=S.useMemo(()=>new Map(a.map(z=>[z.id,z.name])),[a]),C=S.useMemo(()=>new Map(i.map(z=>[z.id,`${z.firstName} ${z.lastName}`])),[i]),A=S.useMemo(()=>{const z=new Map;return s.forEach(Y=>Y.zones.forEach(J=>z.set(J.id,J.name))),z},[s]),M=S.useMemo(()=>{let z=[...t];return z.sort((Y,J)=>{let G,B;return T.key==="siteName"?G=E.get(Y.siteId)||"":T.key==="seaweedTypeName"?G=k.get(Y.seaweedTypeId)||"":T.key==="zoneName"?G=A.get(Y.zoneId)||"":T.key==="conductorName"?G=C.get(Y.conductorId)||"":G=Y[T.key],T.key==="siteName"?B=E.get(J.siteId)||"":T.key==="seaweedTypeName"?B=k.get(J.seaweedTypeId)||"":T.key==="zoneName"?B=A.get(J.zoneId)||"":T.key==="conductorName"?B=C.get(J.conductorId)||"":B=J[T.key],G===null?1:B===null?-1:G<B?T.direction==="ascending"?-1:1:G>B?T.direction==="ascending"?1:-1:0}),z},[t,T,E,k,A,C]),I=z=>{let Y="ascending";T.key===z&&T.direction==="ascending"&&(Y="descending"),_({key:z,direction:Y})},P=z=>T.key!==z?n.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):T.direction==="ascending"?n.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):n.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),D=({sortKey:z,label:Y,className:J})=>n.jsx("th",{className:`p-3 ${J}`,children:n.jsxs("button",{onClick:()=>I(z),className:`group flex items-center gap-2 w-full ${J!=null&&J.includes("text-right")?"justify-end":""}`,children:[Y,P(z)]})}),U=(z=null)=>{h(z),u(!0)},O=z=>{b(z),x(!0)},F=()=>{y&&l(y),x(!1),b(null)},q=async()=>{const z=M.map(J=>({identity:J.identity,date:J.date,site:E.get(J.siteId)||e("unknown"),seaweedType:k.get(J.seaweedTypeId)||e("unknown"),zone:A.get(J.zoneId)||e("unknown"),period:e(`period_${J.period}`),weightKg:J.weightKg,growthRate:J.growthRate,temperature:J.temperature,salinity:J.salinity,precipitation:J.precipitation,windSpeed:J.windSpeed,windDirection:J.windDirection,waveHeight:J.waveHeight,conductor:C.get(J.conductorId)||e("unknown"),source:J.weatherDataSource==="auto"?e("autoFill"):e("manualEntry")})),Y=[{header:e("identity"),key:"identity",width:15},{header:e("date"),key:"date",width:15},{header:e("site"),key:"site",width:20},{header:e("seaweedType"),key:"seaweedType",width:20},{header:e("zoning"),key:"zone",width:15},{header:e("period"),key:"period",width:15},{header:`${e("weightKg")} (Kg)`,key:"weightKg",width:15},{header:`${e("growthRate")} (%)`,key:"growthRate",width:15},{header:`${e("temperature")} (C)`,key:"temperature",width:15},{header:`${e("salinity")} ()`,key:"salinity",width:15},{header:`${e("precipitation")} (mm)`,key:"precipitation",width:15},{header:`${e("windSpeed")} (km/h)`,key:"windSpeed",width:15},{header:`${e("windDirection")} ()`,key:"windDirection",width:15},{header:`${e("waveHeight")} (m)`,key:"waveHeight",width:15},{header:e("conductor"),key:"conductor",width:20},{header:"Source",key:"source",width:15}];await Pi(z,Y,`PeriodicTests_${new Date().toISOString().split("T")[0]}`,"Periodic Tests")};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("periodicTestsTitle")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(se,{onClick:q,variant:"secondary",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]}),n.jsxs(se,{onClick:()=>U(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("addTest")]})]})]}),n.jsx(Ge,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"text-xs uppercase bg-gray-50 dark:bg-gray-700/50",children:n.jsxs("tr",{children:[n.jsx(D,{sortKey:"identity",label:e("identity")}),n.jsx(D,{sortKey:"date",label:e("date")}),n.jsx(D,{sortKey:"siteName",label:e("site")}),n.jsx(D,{sortKey:"seaweedTypeName",label:e("seaweedType")}),n.jsx(D,{sortKey:"zoneName",label:e("zoning")}),n.jsx(D,{sortKey:"period",label:e("period")}),n.jsx(D,{sortKey:"weightKg",label:`${e("weightKg")} (Kg)`,className:"text-right"}),n.jsx(D,{sortKey:"growthRate",label:`${e("growthRate")} (%)`,className:"text-right"}),n.jsx(D,{sortKey:"temperature",label:`${e("temperature")} (C)`,className:"text-right"}),n.jsx(D,{sortKey:"salinity",label:`${e("salinity")} ()`,className:"text-right"}),n.jsx(D,{sortKey:"precipitation",label:`${e("precipitation")} (mm)`,className:"text-right"}),n.jsx(D,{sortKey:"windSpeed",label:`${e("windSpeed")} (km/h)`,className:"text-right"}),n.jsx(D,{sortKey:"windDirection",label:`${e("windDirection")} ()`,className:"text-right"}),n.jsx(D,{sortKey:"waveHeight",label:`${e("waveHeight")} (m)`,className:"text-right"}),n.jsx(D,{sortKey:"conductorName",label:e("conductor")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsx("tbody",{children:M.map(z=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 align-middle",children:[n.jsx("td",{className:"p-3 font-mono",children:z.identity}),n.jsx("td",{className:"p-3",children:z.date}),n.jsx("td",{className:"p-3",children:E.get(z.siteId)||e("unknown")}),n.jsx("td",{className:"p-3",children:k.get(z.seaweedTypeId)||e("unknown")}),n.jsx("td",{className:"p-3",children:A.get(z.zoneId)||e("unknown")}),n.jsx("td",{className:"p-3",children:e(`period_${z.period}`)}),n.jsx("td",{className:"p-3 text-right",children:Fe(z.weightKg,j.localization)}),n.jsx("td",{className:"p-3 text-right font-semibold",children:z.growthRate!==null?`${Fe(z.growthRate,j.localization)}`:"-"}),n.jsx("td",{className:"p-3 text-right",children:z.temperature!==null?Fe(z.temperature,j.localization):"-"}),n.jsx("td",{className:"p-3 text-right",children:z.salinity!==null?Fe(z.salinity,j.localization):"-"}),n.jsx("td",{className:"p-3 text-right",children:z.precipitation!==null?Fe(z.precipitation,j.localization):"-"}),n.jsx("td",{className:"p-3 text-right",children:z.windSpeed!==null?Fe(z.windSpeed,j.localization):"-"}),n.jsx("td",{className:"p-3 text-right",children:z.windDirection!==null?Fe(z.windDirection,j.localization):"-"}),n.jsx("td",{className:"p-3 text-right",children:z.waveHeight!==null?Fe(z.waveHeight,j.localization):"-"}),n.jsx("td",{className:"p-3",children:C.get(z.conductorId)||e("unknown")}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-1",children:[n.jsx(se,{variant:"ghost",className:"p-2",onClick:()=>U(z),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),n.jsx(se,{variant:"danger",className:"p-2",onClick:()=>O(z.id),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},z.id))})]})})}),c&&n.jsx(nO,{isOpen:c,onClose:()=>u(!1),test:f}),m&&n.jsx(zt,{isOpen:m,onClose:()=>x(!1),onConfirm:F,title:e("confirmDeleteTitle"),message:e("confirmDeleteTest")})]})},xs=({icon:e,label:t,value:s,fullWidth:a})=>n.jsxs("div",{className:`flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50 ${a?"col-span-2":""}`,children:[n.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[n.jsx(te,{name:e,className:"w-4 h-4 mr-2"}),n.jsx("span",{children:t})]}),n.jsx("div",{className:"mt-1 text-md font-semibold text-gray-900 dark:text-gray-100 truncate",children:s||"N/A"})]}),aO=({data:e,onClose:t})=>{const{t:s}=we(),{settings:a}=Ke(),[i,l]=S.useState(!1),c=!!e,{module:u,site:f,zone:h,farmer:m,cycle:x,seaweedType:y}=e||{},b=a.localization.coordinateFormat;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`fixed inset-0 bg-black/30 z-40 transition-opacity duration-300 ${c?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:t,"aria-hidden":"true"}),n.jsxs("div",{className:`fixed top-0 right-0 h-full w-full max-w-md bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-l border-gray-200 dark:border-gray-700/50 shadow-2xl flex flex-col z-50 transform transition-transform duration-300 ease-in-out ${c?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"module-detail-panel-title",children:[n.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-inherit z-10",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("moduleDetails")}),n.jsx("h2",{id:"module-detail-panel-title",className:"text-xl font-bold font-mono",children:u==null?void 0:u.code})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"ghost",onClick:()=>l(!0),children:[n.jsx(te,{name:"FileText",className:"w-4 h-4 mr-1"}),s("history")]}),n.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":s("close"),children:n.jsx(te,{name:"X",className:"w-6 h-6"})})]})]}),c&&n.jsxs("main",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:[n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-3",children:s("generalInformation")}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(xs,{icon:"MapPin",label:s("site"),value:f==null?void 0:f.name}),n.jsx(xs,{icon:"Grid",label:s("zoneName"),value:h==null?void 0:h.name}),n.jsx(xs,{icon:"User",label:s("farmer"),value:m?`${m.firstName} ${m.lastName}`:s("status_FREE")}),n.jsxs("div",{className:"flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50",children:[n.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[n.jsx(te,{name:"Activity",className:"w-4 h-4 mr-2"}),n.jsx("span",{children:s("status")})]}),n.jsx("div",{className:"mt-1",children:n.jsx(vn,{status:m?"ASSIGNED":"FREE"})})]}),n.jsx(xs,{icon:"MapPin",label:s("latitude"),value:$x(u.latitude||"",b,!0)}),n.jsx(xs,{icon:"MapPin",label:s("longitude"),value:$x(u.longitude||"",b,!1)})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-3",children:s("configuration")}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(xs,{icon:"Layers",label:s("lines"),value:u.lines}),n.jsx(xs,{icon:"Package",label:s("galvanizedPoles"),value:u.poles.galvanized}),n.jsx(xs,{icon:"Package",label:s("woodPoles"),value:u.poles.wood}),n.jsx(xs,{icon:"Package",label:s("plasticPoles"),value:u.poles.plastic})]})]}),x&&n.jsxs("section",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-3",children:s("cultivationCycle")}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(xs,{icon:"Beaker",label:s("seaweedType"),value:y==null?void 0:y.name}),n.jsx(xs,{icon:"Calendar",label:s("plantingDate"),value:x.plantingDate}),n.jsx(xs,{icon:"Archive",label:s("initialWeight"),value:`${x.initialWeight} kg`})]})]})]})]}),c&&u&&n.jsx(jb,{isOpen:i,onClose:()=>l(!1),history:u.statusHistory,moduleCode:u.code})]})},rO=()=>{const{t:e}=we(),{settings:t}=Ke(),s=t.localization.coordinateFormat,a=S.useRef(null),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),u=S.useRef(null),f=S.useRef(null),h=S.useRef(null),m=S.useRef(new Map),{sites:x,modules:y,cultivationCycles:b,farmers:T,employees:_,seaweedTypes:j}=He(),[E,k]=S.useState(null),[C,A]=S.useState(!1),M=(D,U)=>{if(!D)return{color:"#808080",label:"Unknown"};const O=D.statusHistory||[],F=O.length>0?O[O.length-1].status:Ye.FREE;if(F===Ye.FREE)return{color:"#6b7280",label:e("status_FREE")};if(U&&(U.status===Ye.PLANTED||U.status===Ye.GROWING)){const q=new Date(U.plantingDate),Y=Math.floor((new Date().getTime()-q.getTime())/(1e3*3600*24));return Y>pa?{color:"#ef4444",label:e("overdueHarvest")}:Y>pa-Yf?{color:"#f59e0b",label:e("nearingHarvest")}:{color:"#22c55e",label:e("status_GROWING")}}return F===Ye.HARVESTED||F===Ye.DRYING||F===Ye.BAGGING?{color:"#3b82f6",label:e(`status_${F}`)}:F===Ye.MAINTENANCE?{color:"#f97316",label:e("status_MAINTENANCE")}:D.farmerId?{color:"#a855f7",label:e("status_ASSIGNED")}:{color:"#6b7280",label:e("status_FREE")}},I=[{color:"#22c55e",label:e("status_GROWING")},{color:"#f59e0b",label:e("nearingHarvest")},{color:"#ef4444",label:e("overdueHarvest")},{color:"#3b82f6",label:`${e("status_HARVESTED")} / ${e("status_DRYING")}`},{color:"#a855f7",label:e("status_ASSIGNED")},{color:"#6b7280",label:e("status_FREE")},{color:"#f97316",label:e("status_MAINTENANCE")}];S.useEffect(()=>{if(a.current&&!i.current){const D=L.map(a.current,{center:[-18.7669,46.8691],zoom:6,zoomControl:!1});L.control.zoom({position:"topleft"}).addTo(D);const U=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(D),O=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),F=L.featureGroup().addTo(D),q=L.featureGroup().addTo(D),z=L.featureGroup().addTo(D),Y=L.featureGroup().addTo(D),J=L.layerGroup().addTo(D);l.current=F,c.current=q,u.current=z,f.current=Y,h.current=J,i.current=D;const G={[e("streetView")]:U,[e("satelliteView")]:O},B={[`<i class="icon-sites"></i> ${e("sites")}`]:F,[`<i class="icon-zones"></i> ${e("zones")}`]:q,[`<i class="icon-modules"></i> ${e("modules")}`]:z};L.control.layers(G,B,{collapsed:!0,position:"topright"}).addTo(D)}},[e]),S.useEffect(()=>{const D=i.current;if(!D)return;l.current.clearLayers(),c.current.clearLayers(),u.current.clearLayers(),m.current.clear();const U=[];x.forEach(O=>{if(O.location)try{const q=O.location.split(",");if(q.length===2){const z=q[0].trim(),Y=q[1].trim(),J=mn(z),G=mn(Y),B=[J,G];U.push(B);const Q=y.filter(fe=>fe.siteId===O.id),W=Q.length,ae=T.filter(fe=>fe.siteId===O.id).length,ie=_.filter(fe=>fe.siteId===O.id).length,ue=new Set(Q.map(fe=>fe.id)),Ne=b.filter(fe=>ue.has(fe.moduleId)&&(fe.status==="PLANTED"||fe.status==="GROWING")).reduce((fe,Z)=>fe+(Z.linesPlanted||0),0),le=_.find(fe=>fe.id===O.managerId),ne=le?`${le.firstName} ${le.lastName}`:e("noManager"),je=L.marker(B);je.bindPopup(`
                            <div class="font-sans text-xs min-w-[240px]">
                                <div class="bg-blue-600 text-white px-3 py-2 rounded-t flex justify-between items-center">
                                    <h3 class="font-bold text-sm truncate max-w-[160px]">${O.name}</h3>
                                    <span class="text-[10px] bg-blue-700 px-1.5 py-0.5 rounded opacity-90">${O.code}</span>
                                </div>
                                <div class="p-3 bg-white border border-gray-200 rounded-b shadow-sm">
                                    <div class="mb-3 flex justify-between items-center border-b border-gray-100 pb-2">
                                        <span class="text-gray-500 flex items-center gap-1"><i class="w-3 h-3 bg-gray-400 rounded-full block"></i> ${e("manager")}:</span>
                                        <span class="font-medium text-right truncate max-w-[120px] text-gray-800">${ne}</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-blue-600 text-lg leading-none">${W}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${e("modules")}</span>
                                        </div>
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-green-600 text-lg leading-none">${ae}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${e("farmers")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-purple-600 text-lg leading-none">${ie}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${e("employees")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-orange-600 text-lg leading-none">${Ne}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${e("activeLines")}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,{closeButton:!1,minWidth:240}),l.current.addLayer(je)}}catch(q){console.error(`Could not parse location for site ${O.name}: ${O.location}`,q)}(O.zones||[]).forEach(q=>{const z=Nf(q.geoPoints);if(z.length>=3){const Y=z.reduce((B,Q)=>({x:B.x+Q.x,y:B.y+Q.y}),{x:0,y:0});Y.x/=z.length,Y.y/=z.length,z.sort((B,Q)=>{const W=Math.atan2(B.y-Y.y,B.x-Y.x),ae=Math.atan2(Q.y-Y.y,Q.x-Y.x);return W-ae});const J=z.map(B=>[B.y,B.x]);U.push(...J);const G=L.polygon(J,{color:"blue",weight:2,fillOpacity:.1});G.bindTooltip(q.name,{permanent:!0,direction:"center",className:"bg-transparent border-none shadow-none font-bold text-blue-800"}),c.current.addLayer(G)}})}),y.forEach(O=>{let F=null;if(O.latitude&&O.longitude)try{const B=mn(O.latitude),Q=mn(O.longitude);F=L.latLng(B,Q)}catch{}if(!F){const B=x.flatMap(Q=>Q.zones).find(Q=>Q.id===O.zoneId);if(B&&B.geoPoints&&B.geoPoints.length>0){const Q=Nf(B.geoPoints);if(Q.length>0){const W=Q.map(ie=>[ie.y,ie.x]),$=L.polygon(W).getBounds();$&&$.isValid()&&(F=$.getCenter())}}}if(!F)return;m.current.set(O.id,F);const q=b.find(B=>B.moduleId===O.id&&(B.status===Ye.PLANTED||B.status===Ye.GROWING||B.status===Ye.CUTTING)),z=T.find(B=>B.id===O.farmerId),Y=M(O,q),J=L.divIcon({html:`<div style="background-color: ${Y.color}; width: 10px; height: 10px; border: 1px solid #fff; opacity: 1; box-shadow: 1px 1px 2px rgba(0,0,0,0.5);"></div>`,iconSize:[10,10],iconAnchor:[5,5],className:""}),G=L.marker(F,{icon:J});G.bindTooltip(`${O.code}`,{direction:"top",offset:[0,-5],className:"text-xs"}),G.on("click",()=>{const B=x.find(ie=>ie.id===O.siteId),Q=B==null?void 0:B.zones.find(ie=>ie.id===O.zoneId),W=q?j.find(ie=>ie.id===q.seaweedTypeId):void 0,ae=q||b.filter(ie=>ie.moduleId===O.id).sort((ie,ue)=>new Date(ue.plantingDate).getTime()-new Date(ie.plantingDate).getTime())[0];k({module:O,cycle:ae,site:B,zone:Q,seaweedType:W,farmer:z})}),u.current.addLayer(G)}),U.length>0&&D.fitBounds(U,{padding:[50,50]})},[x,y,b,T,_,j,e,s]),S.useEffect(()=>{const D=f.current;if(D&&(D.clearLayers(),E&&E.module)){const U=m.current.get(E.module.id);U&&L.circleMarker(U,{radius:16,color:"#facc15",fill:!1,weight:4,opacity:.8}).addTo(D)}},[E,y]);const P=()=>{A(!0),setTimeout(()=>{if(!i.current||!h.current){A(!1);return}const D=h.current;D.clearLayers();const U=i.current.getCenter();if(U){const O=U.lat,F=U.lng,q=L.circle([O+.005,F+.005],{color:"green",fillColor:"#22c55e",fillOpacity:.4,radius:1500,weight:1}).bindPopup(`<b>${e("biomassLegendHigh")}</b><br>NDVI: 0.75<br>${e("satelliteSource")}`),z=L.circle([O-.005,F-.005],{color:"red",fillColor:"#ef4444",fillOpacity:.4,radius:1e3,weight:1}).bindPopup(`<b>${e("algalBloomRisk")}</b><br>Chlorophyll-a: High<br>${e("satelliteSource")}`);D.addLayer(q),D.addLayer(z),i.current.setView([O,F],Math.max(i.current.getZoom(),13))}A(!1)},2e3)};return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("farmMapTitle")}),n.jsx("div",{className:"flex gap-2",children:n.jsxs(se,{onClick:P,disabled:C,variant:"secondary",children:[n.jsx(te,{name:C?"Activity":"Eye",className:`w-5 h-5 mr-2 ${C?"animate-spin":""}`}),e(C?"analyzingSatellite":"loadSatelliteData")]})})]}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{ref:a,style:{height:"70vh"},className:"rounded-lg shadow-lg bg-blue-50 z-0"}),n.jsx("div",{className:"absolute bottom-8 left-4 z-[500] no-print hidden sm:block",children:n.jsx(Ge,{title:e("legend"),className:"p-3 !bg-white/90 backdrop-blur-sm border border-gray-200 shadow-lg",children:n.jsxs("div",{className:"space-y-2",children:[I.map(D=>n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm",style:{backgroundColor:D.color}}),n.jsx("span",{className:"text-[10px] font-medium",children:D.label})]},D.label)),n.jsx("hr",{className:"my-2 border-gray-300"}),n.jsx("h4",{className:"text-[10px] font-bold mb-1",children:e("satelliteAnalysisTitle")}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-green-500/50 border-green-600"}),n.jsx("span",{className:"text-[10px] font-medium",children:e("biomassLegendHigh")})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-red-500/50 border-red-600"}),n.jsx("span",{className:"text-[10px] font-medium",children:e("algalBloomRisk")})]})]})})})]}),n.jsx(aO,{data:E,onClose:()=>k(null)})]})},ld=({permission:e,children:t,fallback:s=null})=>{const{can:a}=Rs();return a(e)?n.jsx(n.Fragment,{children:t}):n.jsx(n.Fragment,{children:s})},iO=({isOpen:e,onClose:t,role:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState(new Set);S.useEffect(()=>{e&&c(new Set(s.permissions))},[e,s]);const u=(h,m)=>{c(x=>{const y=new Set(x);return m?y.add(h):y.delete(h),y})},f=()=>{a({...s,permissions:Array.from(l)})};return n.jsx(ot,{isOpen:e,onClose:t,title:`${i("managePermissionsFor")} "${s.name}"`,widthClass:"max-w-4xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:f,children:i("save")})]}),children:n.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:eb.map(h=>n.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700",children:[n.jsx("h3",{className:"font-semibold mb-3",children:h.name}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:h.permissions.map(m=>n.jsxs("label",{className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50 cursor-pointer",children:[n.jsx(_t,{checked:l.has(m.id),onChange:x=>u(m.id,x.target.checked)}),n.jsx("span",{className:"ml-2 text-sm",children:m.label})]},m.id))})]},h.name))})})},oO=()=>{const{t:e}=we(),{roles:t,addRole:s,updateRole:a,deleteRole:i}=He(),[l,c]=S.useState(!1),[u,f]=S.useState(null),[h,m]=S.useState(""),[x,y]=S.useState(!1),[b,T]=S.useState(null),[_,j]=S.useState(!1),E=P=>{P.isDefault||(f(P),c(!0))},k=()=>{u&&i(u.id),c(!1),f(null)},C=()=>{h.trim()&&(s({name:h.trim(),permissions:[]}),m(""))},A=P=>{T(P),y(!0)},M=P=>{T(P),j(!0)},I=P=>{a(P),y(!1),j(!1),T(null)};return n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:e("roleManagementTitle")}),n.jsxs(Ge,{children:[n.jsx("div",{className:"space-y-4 mb-6",children:t.map(P=>n.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:P.name}),P.isDefault&&n.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",e("default"),")"]})]}),n.jsx(ld,{permission:_e.ROLES_MANAGE,children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:()=>M(P),children:[n.jsx(te,{name:"UserCog",className:"w-4 h-4"}),e("managePermissions")]}),n.jsxs(se,{variant:"ghost",onClick:()=>A(P),children:[n.jsx(te,{name:"Edit2",className:"w-4 h-4"}),e("edit")]}),P.isDefault?n.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:e("cannotDeleteDefault")}):n.jsx(se,{variant:"danger",className:"p-2",onClick:()=>E(P),children:n.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},P.id))}),n.jsx(ld,{permission:_e.ROLES_MANAGE,children:n.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[n.jsx("h4",{className:"font-semibold mb-4",children:e("addRole")}),n.jsxs("div",{className:"flex items-end gap-4",children:[n.jsx(de,{containerClassName:"flex-grow",label:e("roleName"),value:h,onChange:P=>m(P.target.value)}),n.jsxs(se,{onClick:C,disabled:!h.trim(),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("add")]})]})]})})]}),x&&b&&n.jsx(lO,{isOpen:x,onClose:()=>y(!1),role:b,onSave:I}),_&&b&&n.jsx(iO,{isOpen:_,onClose:()=>j(!1),role:b,onSave:I}),l&&u&&n.jsx(zt,{isOpen:l,onClose:()=>c(!1),onConfirm:k,title:e("confirmDeleteTitle"),message:e("confirmDeleteRole")})]})},lO=({isOpen:e,onClose:t,role:s,onSave:a})=>{const{t:i}=we(),[l,c]=S.useState(s.name);S.useEffect(()=>{e&&c(s.name)},[e,s]);const u=()=>{l.trim()&&a({...s,name:l.trim()})};return n.jsx(ot,{isOpen:e,onClose:t,title:i("editRole"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:u,disabled:!l.trim(),children:i("save")})]}),children:n.jsx(de,{label:i("roleName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},cO=({employeeId:e,appliedDeductions:t,onToggle:s})=>{const{settings:a}=Ke(),[i,l]=S.useState(!1),c=S.useRef(null),u=S.useMemo(()=>{var f;return((f=Jt.find(h=>h.code===a.localization.country))==null?void 0:f.payroll)||Jt.find(h=>h.code==="MG").payroll},[a.localization.country]);return S.useEffect(()=>{const f=h=>{c.current&&!c.current.contains(h.target)&&l(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),n.jsxs("div",{ref:c,className:"relative inline-flex",children:[n.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>l(!i),children:n.jsx(te,{name:"Settings",className:"w-4 h-4"})}),i&&n.jsx("div",{className:"absolute right-0 bottom-full mb-2 z-10 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 p-2 space-y-2",children:u.constants.socialContributions.map(f=>{var h;return n.jsxs("label",{className:"flex items-center text-sm cursor-pointer",children:[n.jsx(_t,{checked:t.includes(f.key),onChange:m=>s(e,f.key,m.target.checked)}),n.jsx("span",{className:"ml-2",children:((h=u.labels.socialContributions.find(m=>m.key===f.key))==null?void 0:h.label)||f.key})]},f.key)})})]})},dO=({isOpen:e,onClose:t,onApply:s,sites:a,roles:i,payrollConfig:l})=>{const{t:c}=we(),[u,f]=S.useState({applyTo:"all",filterValue:"",action:"set",values:{bonuses:"",overtime:"",other:""},configureSocialDeductions:!1,deductionsToApply:{},showAffectedEmployees:!0});S.useEffect(()=>{if(e){const m=l.constants.socialContributions.reduce((x,y)=>(x[y.key]=!0,x),{});f(x=>({...x,filterValue:"",deductionsToApply:m}))}},[e,l]);const h=()=>{s(u)};return n.jsx(ot,{isOpen:e,onClose:t,title:c("bulkConfigure"),footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:c("cancel")}),n.jsx(se,{onClick:h,children:c("applyChanges")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs(ke,{label:c("applyTo"),value:u.applyTo,onChange:m=>f(x=>({...x,applyTo:m.target.value})),children:[n.jsx("option",{value:"all",children:c("allSelectedEmployees")}),n.jsx("option",{value:"site",children:c("bySite")}),n.jsx("option",{value:"role",children:c("byRole")})]}),u.applyTo==="site"&&n.jsxs(ke,{label:c("site"),value:u.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[n.jsx("option",{value:"",children:c("selectSite")}),a.map(m=>n.jsx("option",{value:m.id,children:m.name},m.id))]}),u.applyTo==="role"&&n.jsxs(ke,{label:c("role"),value:u.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[n.jsx("option",{value:"",children:c("selectRole")}),i.map(m=>n.jsx("option",{value:m,children:m},m))]})]}),n.jsxs("div",{className:"border-t pt-4",children:[n.jsxs(ke,{label:"Action",value:u.action,onChange:m=>f(x=>({...x,action:m.target.value})),children:[n.jsx("option",{value:"set",children:c("setValue")}),n.jsx("option",{value:"add",children:c("addToExisting")})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[n.jsx(de,{label:c("bonuses"),type:"number",placeholder:c("optional"),value:u.values.bonuses,onChange:m=>f(x=>({...x,values:{...x.values,bonuses:m.target.value}}))}),n.jsx(de,{label:c("overtime"),type:"number",placeholder:c("optional"),value:u.values.overtime,onChange:m=>f(x=>({...x,values:{...x.values,overtime:m.target.value}}))}),n.jsx(de,{label:c("otherDeductions"),type:"number",placeholder:c("optional"),value:u.values.other,onChange:m=>f(x=>({...x,values:{...x.values,other:m.target.value}}))})]})]}),n.jsxs("div",{className:"border-t pt-4",children:[n.jsxs("label",{className:"flex items-center space-x-2 font-semibold",children:[n.jsx(_t,{checked:u.configureSocialDeductions,onChange:m=>f(x=>({...x,configureSocialDeductions:m.target.checked}))}),n.jsx("span",{children:c("configureSocialDeductions")})]}),u.configureSocialDeductions&&n.jsx("div",{className:"pl-6 mt-2 space-y-2",children:l.constants.socialContributions.map(m=>{var x;return n.jsxs("label",{className:"flex items-center text-sm",children:[n.jsx(_t,{checked:u.deductionsToApply[m.key]??!1,onChange:y=>f(b=>({...b,deductionsToApply:{...b.deductionsToApply,[m.key]:y.target.checked}}))}),n.jsx("span",{className:"ml-2",children:((x=l.labels.socialContributions.find(y=>y.key===m.key))==null?void 0:x.label)||m.key})]},m.key)})})]}),n.jsx("div",{className:"border-t pt-4",children:n.jsxs("label",{className:"flex items-center space-x-2",children:[n.jsx(_t,{checked:u.showAffectedEmployees,onChange:m=>f(x=>({...x,showAffectedEmployees:m.target.checked}))}),n.jsx("span",{children:c("showAffectedEmployeesAfterUpdate")})]})})]})})},uO=({isOpen:e,onClose:t,employeeNames:s})=>{const{t:a}=we();return n.jsxs(ot,{isOpen:e,onClose:t,title:a("bulkUpdateSummary"),footer:n.jsx(se,{onClick:t,children:a("close")}),children:[n.jsx("p",{className:"mb-4",children:a("affectedEmployees").replace("{count}",String(s.length))}),n.jsx("div",{className:"max-h-60 overflow-y-auto bg-gray-100 dark:bg-gray-800/50 p-3 rounded-md",children:n.jsx("ul",{className:"list-disc list-inside",children:s.map(i=>n.jsx("li",{children:i},i))})})]})},hO=()=>{const{t:e}=we(),{employees:t,sites:s,addMultipleMonthlyPayments:a}=He(),{settings:i}=Ke(),[l,c]=S.useState(new Date().getMonth()),[u,f]=S.useState(new Date().getFullYear()),[h,m]=S.useState("all"),[x,y]=S.useState(new Set),[b,T]=S.useState([]),[_,j]=S.useState(new Set),E=S.useRef(null),[k,C]=S.useState(!1),[A,M]=S.useState(!1),[I,P]=S.useState(null),D=S.useMemo(()=>Array.from({length:10},(ne,je)=>new Date().getFullYear()-5+je),[]),U=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),O=S.useMemo(()=>Array.from({length:12},(ne,je)=>je),[]),F=`${e(U[l])} ${u}`,q=S.useMemo(()=>{var ne;return((ne=Jt.find(je=>je.code===i.localization.country))==null?void 0:ne.payroll)||Jt.find(je=>je.code==="MG").payroll},[i.localization.country]),z=S.useMemo(()=>{const ne=new Date(u,l+1,0);let je=t.filter(fe=>{if(!fe.hireDate)return!1;const Z=new Date(fe.hireDate);return!isNaN(Z.getTime())&&Z<=ne});return h==="all"?je:je.filter(fe=>fe.siteId===h)},[t,h,u,l]),Y=ne=>{y(je=>{const fe=new Set(je);return fe.has(ne)?fe.delete(ne):fe.add(ne),fe})},J=ne=>{ne.target.checked?y(new Set(z.map(je=>je.id))):y(new Set)};S.useEffect(()=>{if(E.current){const ne=x.size,je=z.length;E.current.checked=ne===je&&je>0,E.current.indeterminate=ne>0&&ne<je}},[x,z]);const G=ne=>{const je=parseFloat(ne.inputs.bonuses)||0,fe=parseFloat(ne.inputs.overtime)||0,Z=parseFloat(ne.inputs.other)||0;return{...Ko(ne.employee.grossWage,je,fe,Z,i.localization,{appliedDeductions:ne.appliedDeductions}),employee:ne.employee,inputs:ne.inputs,appliedDeductions:ne.appliedDeductions}},B=()=>{const ne=t.filter(Z=>x.has(Z.id)),je=q?q.constants.socialContributions.map(Z=>Z.key):[],fe=ne.map(Z=>{const ee={bonuses:"0",overtime:"0",other:"0"};return{...Ko(Z.grossWage,0,0,0,i.localization,{appliedDeductions:je}),employee:Z,inputs:ee,appliedDeductions:je}});T(fe),j(new Set)},Q=(ne,je,fe)=>{T(Z=>Z.map(ee=>{if(ee.employee.id===ne){const xe={...ee,inputs:{...ee.inputs,[je]:fe}};return G(xe)}return ee}))},W=(ne,je,fe)=>{T(Z=>Z.map(ee=>{if(ee.employee.id===ne){const xe=new Set(ee.appliedDeductions);fe?xe.add(je):xe.delete(je);const Oe={...ee,appliedDeductions:Array.from(xe)};return G(Oe)}return ee}))},ae=ne=>{const je=[];T(fe=>fe.map(Z=>{const ee=Z.employee;let xe=!1;switch(ne.applyTo){case"all":xe=!0;break;case"site":xe=ee.siteId===ne.filterValue;break;case"role":xe=ee.role===ne.filterValue;break}if(xe){je.push(`${ee.firstName} ${ee.lastName}`);let Oe={...Z.inputs},De=[...Z.appliedDeductions];["bonuses","overtime","other"].forEach(Le=>{const be=Le;if(ne.values[be]){const ye=parseFloat(ne.values[be])||0,Ue=parseFloat(Oe[be])||0,et=ne.action==="add"?Ue+ye:ye;Oe[be]=String(et)}}),ne.configureSocialDeductions&&(De=Object.entries(ne.deductionsToApply).filter(([,Le])=>Le).map(([Le])=>Le));const Re=parseFloat(Oe.bonuses)||0,Ve=parseFloat(Oe.overtime)||0,ze=parseFloat(Oe.other)||0;return{...Ko(ee.grossWage,Re,Ve,ze,i.localization,{appliedDeductions:De}),employee:ee,inputs:Oe,appliedDeductions:De}}return Z})),C(!1),ne.showAffectedEmployees?P(je):P(null)},$=()=>{const ne=`${u}-${String(l+1).padStart(2,"0")}`,je=new Date().toISOString().split("T")[0],fe=`payroll-${Date.now()}`,Z=b.map(ee=>({date:je,period:ne,recipientType:Wt.EMPLOYEE,recipientId:ee.employee.id,amount:ee.netPay,method:"cash",notes:JSON.stringify({type:"payroll_run",details:{gross:ee.totalGross,base:ee.baseSalary,bonuses:ee.inputs.bonuses,overtime:ee.inputs.overtime,deductions:ee.totalDeductions,otherDeductions:ee.inputs.other}}),paymentRunId:fe,paymentStatus:"PENDING"}));a(Z),M(!1),alert(e("payrollSavedSuccess"))},ie=ne=>{j(je=>{const fe=new Set(je);return fe.has(ne)?fe.delete(ne):fe.add(ne),fe})},ue=S.useMemo(()=>b.reduce((ne,je)=>({totalGross:ne.totalGross+je.totalGross,totalDeductions:ne.totalDeductions+je.totalDeductions,totalNet:ne.totalNet+je.netPay}),{totalGross:0,totalDeductions:0,totalNet:0}),[b]),{uniqueSites:Ne,uniqueRoles:le}=S.useMemo(()=>{const ne=new Set,je=new Set;b.forEach(ee=>{ee.employee.siteId&&ne.add(ee.employee.siteId),ee.employee.role&&je.add(ee.employee.role)});const fe=s.filter(ee=>ne.has(ee.id)),Z=Array.from(je).sort();return{uniqueSites:fe,uniqueRoles:Z}},[b,s]);return n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold mb-6",children:e("payrollCalculator")}),n.jsx(Ge,{className:"mb-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:e("period")}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(ke,{value:l,onChange:ne=>c(parseInt(ne.target.value)),children:O.map(ne=>n.jsx("option",{value:ne,children:e(U[ne])},ne))}),n.jsx(ke,{value:u,onChange:ne=>f(parseInt(ne.target.value)),children:D.map(ne=>n.jsx("option",{value:ne,children:ne},ne))})]})]}),n.jsxs(ke,{label:e("filterBySite"),value:h,onChange:ne=>m(ne.target.value),children:[n.jsx("option",{value:"all",children:e("allSites")}),s.map(ne=>n.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]})}),n.jsxs(Ge,{title:e("employeeSelection"),children:[n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:e("selectEmployeesAndCalculate")}),n.jsx("div",{className:"max-h-96 overflow-y-auto border dark:border-gray-700 rounded-lg",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm",children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-4",children:n.jsx(_t,{ref:E,onChange:J,"aria-label":e("selectAllEmployees")})}),n.jsx("th",{className:"p-3",children:e("name")}),n.jsx("th",{className:"p-3",children:e("site")}),n.jsx("th",{className:"p-3",children:e("role")}),n.jsx("th",{className:"p-3 text-right",children:e("grossWage")})]})}),n.jsx("tbody",{children:z.length>0?z.map(ne=>{var je;return n.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[n.jsx("td",{className:"p-3",children:n.jsx(_t,{checked:x.has(ne.id),onChange:()=>Y(ne.id)})}),n.jsxs("td",{className:"p-3 font-semibold",children:[ne.firstName," ",ne.lastName]}),n.jsx("td",{className:"p-3",children:((je=s.find(fe=>fe.id===ne.siteId))==null?void 0:je.name)||"N/A"}),n.jsx("td",{className:"p-3",children:ne.role}),n.jsx("td",{className:"p-3 text-right",children:Ae(ne.grossWage,i.localization)})]},ne.id)}):n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:e("noEmployeesMatchFilters")})})})]})}),n.jsx("div",{className:"mt-4",children:n.jsxs(se,{onClick:B,disabled:x.size===0,children:[n.jsx(te,{name:"Calculator",className:"w-5 h-5"}),e("processPayrollFor").replace("{count}",String(x.size))]})})]}),b.length>0&&n.jsxs(Ge,{className:"mt-6",title:e("payrollResults"),children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:e("payrollSummaryForPeriod").replace("{period}",F)}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:()=>C(!0),children:[n.jsx(te,{name:"Settings",className:"w-4 h-4"}),e("bulkConfigure")]}),n.jsxs(se,{onClick:()=>M(!0),children:[n.jsx(te,{name:"Save",className:"w-4 h-4"}),e("save")]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[n.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[n.jsx("p",{className:"text-sm text-gray-500",children:e("totalGrossPay")}),n.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalGross,i.localization)})]}),n.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[n.jsx("p",{className:"text-sm text-gray-500",children:e("totalAllDeductions")}),n.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalDeductions,i.localization)})]}),n.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[n.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:e("totalNetPay")}),n.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(ue.totalNet,i.localization)})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3 w-12"}),n.jsx("th",{className:"p-3 min-w-[150px]",children:e("employee")}),n.jsx("th",{className:"p-3 w-28 text-center",children:e("socialDeductions")}),n.jsx("th",{className:"p-3 text-right",children:e("grossSalary")}),n.jsx("th",{className:"p-3 w-32 text-right",children:e("bonuses")}),n.jsx("th",{className:"p-3 w-32 text-right",children:e("overtime")}),n.jsx("th",{className:"p-3 w-32 text-right",children:e("otherDeductions")}),n.jsx("th",{className:"p-3 text-right font-semibold",children:e("totalGross")}),n.jsx("th",{className:"p-3 text-right font-semibold",children:e("payrollTotalDeductions")}),n.jsx("th",{className:"p-3 text-right font-bold text-lg",children:e("netPay")})]})}),n.jsx("tbody",{children:b.map(ne=>{const je=_.has(ne.employee.id);return n.jsxs(gt.Fragment,{children:[n.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[n.jsx("td",{className:"p-3 text-center",children:n.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ie(ne.employee.id),children:n.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${je?"rotate-90":""}`})})}),n.jsxs("td",{className:"p-3 font-semibold",children:[ne.employee.firstName," ",ne.employee.lastName]}),n.jsx("td",{className:"p-3 text-center",children:n.jsx(cO,{employeeId:ne.employee.id,appliedDeductions:ne.appliedDeductions,onToggle:W})}),n.jsx("td",{className:"p-3 text-right",children:Ae(ne.baseSalary,i.localization)}),n.jsx("td",{children:n.jsx(de,{type:"number",value:ne.inputs.bonuses,onChange:fe=>Q(ne.employee.id,"bonuses",fe.target.value),containerClassName:"w-full",className:"text-right"})}),n.jsx("td",{children:n.jsx(de,{type:"number",value:ne.inputs.overtime,onChange:fe=>Q(ne.employee.id,"overtime",fe.target.value),containerClassName:"w-full",className:"text-right"})}),n.jsx("td",{children:n.jsx(de,{type:"number",value:ne.inputs.other,onChange:fe=>Q(ne.employee.id,"other",fe.target.value),containerClassName:"w-full",className:"text-right"})}),n.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(ne.totalGross,i.localization)}),n.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(ne.totalDeductions,i.localization)}),n.jsx("td",{className:"p-3 text-right font-bold text-lg",children:Ae(ne.netPay,i.localization)})]}),je&&n.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/50",children:n.jsxs("td",{colSpan:10,className:"p-4",children:[n.jsx("h4",{className:"font-semibold text-md mb-2",children:e("deductionDetails")}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pl-6",children:[ne.deductions.map(fe=>n.jsxs("div",{className:"flex justify-between text-xs",children:[n.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[fe.label,":"]}),n.jsx("span",{children:Ae(fe.amount,i.localization)})]},fe.label)),ne.deductions.length===0&&n.jsx("span",{className:"text-gray-500 text-xs",children:e("noStatutoryDeductions")})]})]})})]},ne.employee.id)})})]})})]}),n.jsx(dO,{isOpen:k,onClose:()=>C(!1),onApply:ae,sites:Ne,roles:le,payrollConfig:q}),I&&n.jsx(uO,{isOpen:!!I,onClose:()=>P(null),employeeNames:I}),A&&n.jsx(zt,{isOpen:A,onClose:()=>M(!1),onConfirm:$,title:e("confirmSavePayroll"),message:e("confirmSavePayrollMessage"),confirmText:e("save")})]})},fO=()=>{const{siteId:e}=Hv(),{sites:t}=He(),{t:s}=we(),a=t.find(l=>l.id===e),i=a?`${s("cultivationCycleManagementTitle")} - ${a.name}`:s("cultivationCycleManagementTitle");return e?n.jsx(dm,{initialFilters:{siteId:e},pageTitle:i}):n.jsx("div",{children:"Site not found"})},mO=()=>{const{typeId:e}=Hv(),{seaweedTypes:t}=He(),{t:s}=we(),a=t.find(l=>l.id===e),i=a?`${s("cultivationCycleManagementTitle")} - ${a.name}`:s("cultivationCycleManagementTitle");return e?n.jsx(dm,{initialFilters:{seaweedTypeId:e},pageTitle:i}):n.jsx("div",{children:"Seaweed type not found"})},$c=({steps:e})=>n.jsxs("div",{className:"flex flex-col md:flex-row items-stretch justify-between gap-2 my-8 relative",children:[n.jsx("div",{className:"hidden md:block absolute top-6 left-0 w-full h-1 bg-gray-200 dark:bg-gray-700 -z-10 transform translate-y-1/2"}),e.map((t,s)=>n.jsxs("div",{className:"flex-1 flex flex-col items-center text-center group relative",children:[s!==e.length-1&&n.jsx("div",{className:"md:hidden absolute left-1/2 bottom-0 w-1 h-8 bg-gray-200 dark:bg-gray-700 transform translate-y-full -translate-x-1/2"}),n.jsx("div",{className:"w-12 h-12 rounded-full bg-white dark:bg-gray-800 border-4 border-blue-100 dark:border-blue-900 flex items-center justify-center shadow-sm mb-3 z-10 group-hover:border-blue-500 transition-colors duration-300",children:n.jsx(te,{name:t.icon,className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),n.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200 mb-1",children:t.title}),t.desc&&n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2",children:t.desc})]},s))]}),Hc=({title:e,fields:t})=>n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-4 my-4",children:[n.jsxs("h4",{className:"font-bold text-sm text-blue-800 dark:text-blue-300 mb-3 flex items-center",children:[n.jsx(te,{name:"Edit",className:"w-4 h-4 mr-2"}),e]}),n.jsx("div",{className:"grid grid-cols-1 gap-2",children:t.map((s,a)=>n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-baseline text-xs",children:[n.jsxs("span",{className:"font-mono font-semibold text-gray-700 dark:text-gray-300 w-32 shrink-0",children:[s.name," ",s.required&&n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsx("span",{className:"text-gray-600 dark:text-gray-400 italic border-l-2 border-gray-200 dark:border-gray-600 pl-2 sm:ml-2",children:s.description})]},a))})]}),nf=({title:e,subItems:t,color:s})=>{const a={blue:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",green:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",orange:"bg-orange-50 border-orange-200 dark:bg-orange-900/20 dark:border-orange-800"};return n.jsxs("div",{className:`p-4 rounded-lg border ${a[s]} flex-1 min-w-[200px]`,children:[n.jsx("h4",{className:"font-bold mb-3 text-center uppercase text-sm",children:e}),n.jsx("ul",{className:"space-y-2",children:t.map((i,l)=>n.jsxs("li",{className:"flex items-center text-xs bg-white dark:bg-gray-800 p-2 rounded shadow-sm",children:[n.jsx("div",{className:`w-2 h-2 rounded-full mr-2 bg-${s}-500`}),i]},l))})]})},sf=({text:e})=>{const{t}=we();return n.jsxs("div",{className:"flex items-start p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 rounded-r text-xs my-4",children:[n.jsx(te,{name:"Sun",className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("span",{className:"font-bold block mb-1",children:t("tip_title")}),e]})]})},pO=()=>{const{t:e}=we();return n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:e("legend_module_status")}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["FREE","ASSIGNED","PLANTED","GROWING","HARVESTED","DRYING"].map(t=>n.jsx(vn,{status:t},t))}),n.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:e("legend_module_desc")})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:e("legend_incident_severity")}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["LOW","MEDIUM","HIGH","CRITICAL"].map(t=>n.jsx(vn,{status:t},t))}),n.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:e("legend_incident_desc")})]})]})},Ya=({title:e,children:t,defaultOpen:s=!1})=>{const[a,i]=S.useState(s);return n.jsxs(Ge,{className:"mb-4 overflow-hidden transition-all hover:shadow-md",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none p-1",onClick:()=>i(!a),children:[n.jsx("h2",{className:"text-lg font-bold uppercase tracking-wide text-gray-800 dark:text-gray-100",children:e}),n.jsx(te,{name:"ChevronDown",className:`w-6 h-6 transition-transform duration-200 ${a?"rotate-180":""}`})]}),n.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${a?"max-h-[3000px] opacity-100 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700/50":"max-h-0 opacity-0"}`,children:t})]})},gO=()=>{const{t:e}=we();return n.jsxs("div",{className:"pb-20 max-w-5xl mx-auto font-sans",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-blue-900 dark:text-blue-100",children:e("userManual")}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-2xl mx-auto text-sm",children:e("manual_introduction_text").replace(/<[^>]*>?/gm,"")})]}),n.jsx(Ya,{title:e("manual_architecture_title"),defaultOpen:!0,children:n.jsxs("div",{className:"flex flex-wrap gap-4",children:[n.jsx(nf,{title:e("operations"),color:"green",subItems:[e("siteManagementTitle"),e("moduleManagementTitle"),e("cultivationCycleManagementTitle"),e("harvestProcessingTitle")]}),n.jsx(nf,{title:e("inventory"),color:"orange",subItems:[e("onSiteStorageTitle"),e("siteTransfersTitle"),e("pressedWarehouseTitle"),e("exports")]}),n.jsx(nf,{title:e("stakeholders"),color:"blue",subItems:[e("farmerManagementTitle"),e("farmerCreditsTitle"),e("documentPaymentsTitle"),e("reports")]})]})}),n.jsxs(Ya,{title:e("manual_setup_title"),children:[n.jsx("p",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:e("manual_setup_desc")}),n.jsx($c,{steps:[{title:e("step_sites"),icon:"MapPin",desc:e("step_desc_define_locations")},{title:e("step_modules"),icon:"Grid",desc:e("step_desc_create_infra")},{title:e("step_farmers"),icon:"User",desc:e("step_desc_add_personnel")},{title:e("step_assign"),icon:"UserCog",desc:e("step_desc_link_farmers")}]}),n.jsx(Hc,{title:e("siteManagementTitle"),fields:[{name:e("siteName"),description:e("field_site_name"),required:!0},{name:e("manager"),description:e("field_manager")},{name:e("zones"),description:e("field_zones")}]}),n.jsx(sf,{text:e("tip_map_interaction")})]}),n.jsxs(Ya,{title:e("manual_production_title"),children:[n.jsx("h3",{className:"font-bold text-md mb-2 text-gray-800 dark:text-gray-200",children:e("cyclePerformance")}),n.jsx($c,{steps:[{title:e("flow_planting"),icon:"GitBranch"},{title:e("flow_growing"),icon:"Sun"},{title:e("flow_harvest"),icon:"Scissors"},{title:e("flow_drying"),icon:"Wind"},{title:e("flow_bagging"),icon:"Archive"},{title:e("flow_stock"),icon:"Warehouse"}]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsx(Hc,{title:e("guide_how_to_harvest"),fields:[{name:e("date"),description:e("date"),required:!0},{name:e("harvestedWeight"),description:e("field_harvest_weight"),required:!0},{name:e("cuttingsTaken"),description:e("field_cuttings_taken")},{name:e("linesHarvested"),description:e("numberOfLines"),required:!0}]}),n.jsxs("div",{className:"p-4 text-sm text-gray-600 dark:text-gray-400",children:[n.jsx("h4",{className:"font-bold mb-2",children:e("notes")}),n.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[n.jsx("li",{children:e("manual_desc_planting")}),n.jsx("li",{children:e("manual_desc_harvest")}),n.jsx("li",{children:e("manual_desc_processing")})]})]})]}),n.jsx(sf,{text:e("tip_auto_growth")})]}),n.jsxs(Ya,{title:e("manual_inventory_title"),children:[n.jsx($c,{steps:[{title:e("stocks_sur_sites"),icon:"MapPin",desc:e("step_desc_collection")},{title:e("flow_transfer"),icon:"Truck",desc:e("step_desc_shipping_slip")},{title:e("flow_warehouse"),icon:"Building",desc:e("step_desc_reception")},{title:e("flow_pressing"),icon:"Archive",desc:e("step_desc_processing")},{title:e("flow_export"),icon:"Globe",desc:e("step_desc_shipping")}]}),n.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 p-2 border-l-2 border-blue-500 bg-blue-50 dark:bg-blue-900/10",children:[n.jsxs("strong",{children:[e("notes"),":"]})," ",e("manual_inventory_note")]})]}),n.jsxs(Ya,{title:e("manual_finance_title"),children:[n.jsx("p",{className:"text-sm mb-4",children:e("manual_finance_desc")}),n.jsx(Hc,{title:e("guide_how_to_pay"),fields:[{name:e("period"),description:e("deliveryPeriod"),required:!0},{name:e("paymentType"),description:e("desc_select_payment_type"),required:!0},{name:e("site"),description:e("desc_filter_site")}]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[n.jsxs("div",{className:"p-3 border rounded-lg bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[n.jsx("h5",{className:"font-bold text-xs uppercase text-green-800 dark:text-green-300 mb-2",children:e("manual_finance_formula_title")}),n.jsx("p",{className:"text-xs font-mono whitespace-pre-line",children:n.jsx("strong",{children:e("manual_finance_formula_text")})})]}),n.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800",children:[n.jsx("h5",{className:"font-bold text-xs uppercase text-blue-800 dark:text-blue-300 mb-2",children:e("reports")}),n.jsx("p",{className:"text-xs",children:e("manual_finance_reports_text")})]})]})]}),n.jsxs(Ya,{title:e("manual_monitoring_title"),children:[n.jsx($c,{steps:[{title:e("step_log_test"),icon:"Beaker",desc:e("step_desc_weekly")},{title:e("step_analyze_pest"),icon:"Camera",desc:e("step_desc_ai")},{title:e("step_resolve_incident"),icon:"Check",desc:e("step_desc_action")}]}),n.jsx(Hc,{title:e("guide_periodic_test"),fields:[{name:e("date"),description:e("date"),required:!0},{name:e("period"),description:e("desc_select_period"),required:!0},{name:e("field_water_temp"),description:e("desc_optional_api")},{name:e("field_salinity"),description:e("desc_manual_entry")}]}),n.jsx(sf,{text:e("tip_ai_pest")})]}),n.jsx(Ya,{title:e("manual_reports_title"),children:n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[n.jsx("span",{className:"font-bold text-blue-600",children:e("globalFarmReport")}),": ",e("report_type_global")]}),n.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[n.jsx("span",{className:"font-bold text-blue-600",children:e("individualFarmerReport")}),": ",e("report_type_farmer")]}),n.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[n.jsx("span",{className:"font-bold text-blue-600",children:e("documentPaymentsTitle")}),": ",e("report_type_payment")]})]})}),n.jsx(Ya,{title:e("status_legend_title"),children:n.jsx(pO,{})}),n.jsx("div",{className:"mt-8 text-center text-xs text-gray-400",children:n.jsxs("p",{children:[e("appName")," v1.1 - ",e("manual_introduction")]})})]})},yO=(e,t)=>new Date(e,t+1,0).getDate(),xO=(e,t)=>{const s=new Date(e,t,1).getDay();return s===0?6:s-1},kv=(e,t)=>e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear(),vO=()=>{const{t:e,language:t}=we(),{cultivationCycles:s,monthlyPayments:a,incidents:i,periodicTests:l,modules:c,seaweedTypes:u,incidentTypes:f,sites:h}=He(),[m,x]=S.useState(new Date),[y,b]=S.useState(null),[T,_]=S.useState({HARVEST:!0,PAYMENT:!0,INCIDENT:!0,TEST:!0}),[j,E]=S.useState(!1),k=S.useMemo(()=>{const Y=[];s.forEach(G=>{if(G.status===Ye.PLANTED||G.status===Ye.GROWING){const B=new Date(G.plantingDate),Q=new Date(B);Q.setDate(B.getDate()+pa);const W=c.find($=>$.id===G.moduleId),ae=u.find($=>$.id===G.seaweedTypeId);Y.push({id:`harvest-${G.id}`,date:Q,type:"HARVEST",title:`${e("projectedHarvest")}: ${W==null?void 0:W.code}`,colorClass:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/50 dark:text-green-200 dark:border-green-800",details:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[e("module"),":"]})," ",W==null?void 0:W.code]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("seaweedType"),":"]})," ",ae==null?void 0:ae.name]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("plantingDate"),":"]})," ",G.plantingDate]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("initialWeight"),":"]})," ",G.initialWeight," kg"]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("status"),":"]})," ",n.jsx(vn,{status:G.status})]})]})})}});const J=new Set;return a.forEach(G=>{const B=G.paymentRunId||G.date;J.has(B)||(J.add(B),Y.push({id:`pay-${G.id}`,date:new Date(G.date),type:"PAYMENT",title:`${e("paymentRun")}`,colorClass:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/50 dark:text-blue-200 dark:border-blue-800",details:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[e("date"),":"]})," ",G.date]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("period"),":"]})," ",G.period]}),n.jsx("p",{className:"text-sm text-gray-500",children:"Details available in Document Payments."})]})}))}),i.forEach(G=>{var W,ae;const B=((W=f.find($=>$.id===G.type))==null?void 0:W.name)||G.type,Q=((ae=h.find($=>$.id===G.siteId))==null?void 0:ae.name)||"Unknown Site";Y.push({id:`inc-${G.id}`,date:new Date(G.date),type:"INCIDENT",title:`${e("incidentsLabel")}: ${B}`,colorClass:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/50 dark:text-red-200 dark:border-red-800",details:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[e("site"),":"]})," ",Q]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("type"),":"]})," ",B]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("severity"),":"]})," ",n.jsx(vn,{status:G.severity})]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("status"),":"]})," ",n.jsx(vn,{status:G.status})]}),n.jsxs("p",{className:"italic",children:['"',G.description,'"']})]})})}),l.forEach(G=>{var Q;const B=((Q=h.find(W=>W.id===G.siteId))==null?void 0:Q.name)||"Unknown Site";Y.push({id:`test-${G.id}`,date:new Date(G.date),type:"TEST",title:`${e("periodicTest")}: ${G.identity}`,colorClass:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/50 dark:text-purple-200 dark:border-purple-800",details:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("p",{children:[n.jsxs("strong",{children:[e("identity"),":"]})," ",G.identity]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("site"),":"]})," ",B]}),n.jsxs("p",{children:[n.jsxs("strong",{children:[e("growthRate"),":"]})," ",G.growthRate?`${G.growthRate}%`:"-"]})]})})}),Y.filter(G=>T[G.type])},[s,a,i,l,c,u,f,h,e,T]),C=()=>{x(new Date(m.getFullYear(),m.getMonth()+1,1))},A=()=>{x(new Date(m.getFullYear(),m.getMonth()-1,1))},M=()=>{x(new Date)},I=async()=>{const Y=new Date(m.getFullYear(),m.getMonth(),1),J=new Date(m.getFullYear(),m.getMonth()+1,0),G=k.filter(B=>B.date>=Y&&B.date<=J).map(B=>({date:B.date.toLocaleDateString(t),type:B.type,title:B.title}));if(G.length===0){alert(e("noDataForReport"));return}await Pi(G,[{header:e("date"),key:"date",width:15},{header:e("category"),key:"type",width:15},{header:e("description"),key:"title",width:50}],`Calendar_${m.toLocaleDateString(t,{month:"long",year:"numeric"})}`,"Calendar Events")},P=m.getFullYear(),D=m.getMonth(),U=yO(P,D),O=xO(P,D),F=[];for(let Y=0;Y<O;Y++)F.push(null);for(let Y=1;Y<=U;Y++)F.push(new Date(P,D,Y));const q=m.toLocaleDateString(t,{month:"long",year:"numeric"}),z=["mon","tue","wed","thu","fri","sat","sun"].map(Y=>e(Y));return n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[n.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[n.jsx(te,{name:"Calendar",className:"w-8 h-8 text-blue-600"}),e("operationalCalendarTitle")]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(se,{variant:"secondary",onClick:I,className:"hidden sm:flex",children:[n.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),e("exportExcel")]}),n.jsxs("div",{className:"flex items-center bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-1",children:[n.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:n.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"})}),n.jsx("span",{className:"px-4 font-bold min-w-[150px] text-center capitalize",children:q}),n.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:n.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})}),n.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),n.jsx("button",{onClick:M,className:"px-3 py-1 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-md",children:"Today"}),n.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),n.jsxs("div",{className:"relative",children:[n.jsx("button",{onClick:()=>E(!j),className:`p-2 rounded-md ${j?"bg-blue-100 text-blue-700":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:e("filterEvents"),children:n.jsx(te,{name:"Filter",className:"w-5 h-5"})}),j&&n.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-20",children:n.jsx("div",{className:"space-y-1",children:["HARVEST","PAYMENT","INCIDENT","TEST"].map(Y=>n.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:T[Y],onChange:J=>_(G=>({...G,[Y]:J.target.checked})),className:"mr-2"}),n.jsx("span",{className:"text-sm capitalize",children:Y.toLowerCase()})]},Y))})})]})]})]})]}),n.jsxs(Ge,{className:"flex-grow flex flex-col p-0 overflow-hidden",children:[n.jsx("div",{className:"grid grid-cols-7 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:z.map(Y=>n.jsx("div",{className:"py-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:Y},Y))}),n.jsx("div",{className:"grid grid-cols-7 flex-grow auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:F.map((Y,J)=>{if(!Y)return n.jsx("div",{className:"bg-gray-50/50 dark:bg-gray-900/50 min-h-[120px]"},`empty-${J}`);const G=k.filter(Q=>kv(Q.date,Y)),B=kv(Y,new Date);return n.jsxs("div",{className:`bg-white dark:bg-gray-900 min-h-[120px] p-2 flex flex-col transition-colors hover:bg-gray-50 dark:hover:bg-gray-800 relative ${B?"bg-blue-50/30":""}`,children:[n.jsx("span",{className:`text-sm font-medium mb-1 w-7 h-7 flex items-center justify-center rounded-full ${B?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300"}`,children:Y.getDate()}),n.jsx("div",{className:"flex-grow space-y-1 overflow-y-auto max-h-[120px] custom-scrollbar",children:G.map(Q=>n.jsx("div",{onClick:()=>b(Q),className:`text-xs px-2 py-1 rounded border truncate cursor-pointer shadow-sm hover:opacity-80 transition-opacity ${Q.colorClass}`,title:Q.title,children:Q.title},Q.id))})]},Y.toISOString())})})]}),y&&n.jsx(ot,{isOpen:!!y,onClose:()=>b(null),title:y.title,widthClass:"max-w-md",footer:n.jsx(se,{onClick:()=>b(null),children:e("close")}),children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:`p-3 rounded-lg mb-4 border ${y.colorClass}`,children:n.jsx("span",{className:"font-bold uppercase tracking-wider text-xs",children:y.type})}),y.details]})})]})},Dv=({year:e,siteName:t})=>{const{t:s}=we(),{settings:a}=Ke(),i=S.useMemo(()=>{var l;return((l=Jt.find(c=>c.code===a.localization.country))==null?void 0:l.name)||a.localization.country},[a.localization.country]);return n.jsxs("header",{className:"mb-4",children:[n.jsxs("div",{className:"grid grid-cols-4 items-center",children:[n.jsx("div",{className:"col-span-1",children:n.jsx("img",{src:a.company.logoUrl,alt:`${a.company.name} logo`,className:"h-10 w-auto object-contain"})}),n.jsxs("div",{className:"col-span-2 text-center",children:[n.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:a.company.name}),n.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700",children:[n.jsxs("p",{children:[s("capital"),": ",Ae(a.company.capital,a.localization)]}),n.jsxs("p",{children:[s("address"),": ",a.company.address]}),n.jsxs("p",{children:[s("nif"),": ",a.company.nif," / ",s("stat"),": ",a.company.stat," / ",s("rc"),": ",a.company.rc]}),n.jsxs("p",{children:[s("phone"),": ",a.company.phone," / ",s("email"),": ",a.company.email]}),n.jsxs("p",{children:[s("country"),": ",i]})]})]}),n.jsx("div",{className:"col-span-1 text-right",children:n.jsx("p",{className:"font-bold text-xs",children:e})})]}),n.jsx("div",{className:"border-b-2 border-black mt-1 mb-2"}),n.jsx("h2",{className:"text-center text-base font-bold uppercase underline mb-1",children:s("farmerMonthlyReport")}),t&&n.jsx("h3",{className:"text-center text-sm font-bold text-blue-800 uppercase",children:t})]})},bO=({year:e})=>{const{t,language:s}=we(),{settings:a}=Ke(),{cultivationCycles:i,modules:l,sites:c,seaweedTypes:u,farmers:f}=He(),h=S.useMemo(()=>{const x={},y=new Date(e,0,1),b=new Date(e,11,31,23,59,59);return i.forEach(_=>{const j=l.find(I=>I.id===_.moduleId);if(!j||!j.farmerId||!j.siteId)return;const E=j.siteId,k=_.seaweedTypeId,C=j.farmerId,A=f.find(I=>I.id===C);if(!A)return;x[E]||(x[E]={}),x[E][k]||(x[E][k]={}),x[E][k][C]||(x[E][k][C]={name:`${A.lastName} ${A.firstName}`,months:Array.from({length:12},()=>({planted:0,harvested:0,production:0}))});const M=new Date(_.plantingDate);if(M>=y&&M<=b){const I=M.getMonth();x[E][k][C].months[I].planted+=_.linesPlanted||j.lines||0}if(_.harvestDate){const I=new Date(_.harvestDate);if(I>=y&&I<=b){const P=I.getMonth();x[E][k][C].months[P].harvested+=_.linesHarvested||0;const D=(_.harvestedWeight||0)-(_.cuttingsTakenAtHarvestKg||0);x[E][k][C].months[P].production+=D}}}),Object.keys(x).map(_=>{var k;const j=((k=c.find(C=>C.id===_))==null?void 0:k.name)||"Unknown Site",E=Object.keys(x[_]).map(C=>{var P;const A=((P=u.find(D=>D.id===C))==null?void 0:P.name)||"Unknown Type",M=Object.values(x[_][C]).sort((D,U)=>D.name.localeCompare(U.name)),I=Array.from({length:12},()=>({planted:0,harvested:0,production:0}));return M.forEach(D=>{D.months.forEach((U,O)=>{I[O].planted+=U.planted,I[O].harvested+=U.harvested,I[O].production+=U.production})}),{id:C,name:A,farmers:M,totals:I}}).sort((C,A)=>C.name.localeCompare(A.name));return{id:_,name:j,types:E}}).sort((_,j)=>_.name.localeCompare(j.name))},[f,i,l,e,c,u]),m=S.useMemo(()=>{const x=[];for(let y=0;y<12;y++)x.push(new Date(e,y,1).toLocaleDateString(s,{month:"short",year:"2-digit"}));return x},[e,s]);return h.length===0?n.jsxs(ks,{landscape:!0,children:[n.jsx(Dv,{year:e}),n.jsxs("div",{className:"p-8 text-center border border-dashed border-gray-300 rounded-lg bg-gray-50",children:[n.jsx("p",{className:"text-sm text-gray-500",children:t("noDataForReport")}),n.jsx("div",{className:"mt-4 overflow-x-auto opacity-50",children:n.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:t("farmer")}),m.map((x,y)=>n.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:x},y))]})}),n.jsx("tbody",{children:n.jsx("tr",{children:n.jsx("td",{className:"border border-black p-4 text-center",colSpan:25,children:"-"})})})]})})]})]}):n.jsx(n.Fragment,{children:h.map(x=>n.jsxs(ks,{landscape:!0,children:[n.jsx(Dv,{year:e,siteName:x.name}),x.types.map(y=>n.jsxs("div",{className:"mb-8 break-inside-avoid",children:[n.jsxs("h4",{className:"font-bold text-xs mb-2 pl-2 border-l-4 border-green-500 bg-gray-50 p-1",children:[t("seaweedType"),": ",y.name]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:t("farmer")}),m.map((b,T)=>n.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:b},T))]})}),n.jsx("tbody",{children:y.farmers.map(b=>n.jsxs("tr",{children:[n.jsx("td",{className:"border border-black p-1 font-bold",children:b.name}),b.months.map((T,_)=>n.jsxs(gt.Fragment,{children:[n.jsx("td",{className:"border border-black p-0.5 text-center align-middle",style:{width:"30px"},children:n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-blue-600 font-semibold",children:T.planted||"-"}),n.jsx("span",{className:"border-t border-gray-300 my-0.5"}),n.jsx("span",{className:"text-red-600 font-semibold",children:T.harvested||"-"})]})}),n.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold bg-gray-50/50",style:{width:"30px"},children:T.production?Fe(T.production,{...a.localization,nonMonetaryDecimals:0}):"-"})]},_))]},b.name))}),n.jsx("tfoot",{children:n.jsxs("tr",{className:"bg-gray-100",children:[n.jsx("td",{className:"border border-black p-1 font-bold",children:t("total")}),y.totals.map((b,T)=>n.jsxs(gt.Fragment,{children:[n.jsx("td",{className:"border border-black p-0.5 text-center align-middle",children:n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-blue-600 font-bold",children:b.planted}),n.jsx("span",{className:"border-t border-gray-400 my-0.5"}),n.jsx("span",{className:"text-red-600 font-bold",children:b.harvested})]})}),n.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold",children:Fe(b.production,{...a.localization,nonMonetaryDecimals:0})})]},T))]})})]})})]},y.id)),n.jsxs("div",{className:"mt-auto pt-4 flex gap-4 text-[8px] border-t border-gray-300",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-blue-600 font-bold",children:t("legendColorBlue")})," ",t("legendPlantedLines")]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-red-600 font-bold",children:t("legendColorRed")})," ",t("legendHarvestedLines")]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"font-bold",children:t("legendColorBlack")})," ",t("legendProductionKg")]})]})]},x.id))})},Wo=({title:e,generator:t,className:s,minimal:a=!1})=>{const{t:i}=we(),[l,c]=S.useState(""),[u,f]=S.useState(!1),[h,m]=S.useState(""),x=async()=>{f(!0),m("");try{const b=(await t()).split("###").map(T=>{if(!T.trim())return"";const[_,...j]=T.trim().split(`
`);return`
${`**${_.replace(/^[0-9.]+\s*/,"")}**`}
${j.join(`
`).trim()}`}).join(`
`).trim();c(b)}catch(y){console.error("Error generating narrative",y),m(i("errorGeneratingNarrative"))}finally{f(!1)}};return n.jsxs("div",{className:`flex flex-col h-full ${s||"mt-4"}`,children:[n.jsx("div",{className:"no-print mb-1 flex-shrink-0",children:n.jsxs(se,{onClick:x,disabled:u,className:"!text-xs !py-0.5 !px-2 h-6",children:[n.jsx(te,{name:u?"Activity":"Bot",className:`w-3 h-3 ${u?"animate-spin":""}`}),e]})}),n.jsxs("div",{className:`${a?"flex-grow overflow-hidden":"p-4 bg-white rounded-lg border border-gray-200"} min-h-[20px]`,children:[u&&n.jsxs("p",{className:"text-xs italic text-center text-black",children:[i("loading"),"..."]}),h&&n.jsx("p",{className:"text-xs text-red-600 text-center",children:h}),l&&n.jsx("div",{className:a?"text-xs leading-normal text-black whitespace-pre-wrap font-normal h-full text-justify":"prose prose-sm max-w-none whitespace-pre-wrap text-black",dangerouslySetInnerHTML:{__html:l.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />")}})]})]})},NO=({month:e,year:t,farmerId:s})=>{const{t:a,language:i}=we(),{settings:l}=Ke(),{farmers:c,sites:u,cultivationCycles:f,modules:h,incidents:m}=He(),x=new Date(t,e).toLocaleDateString(i,{month:"long",year:"numeric"}),y=new Date(t,e,1),b=new Date(t,e+1,0,23,59,59);S.useMemo(()=>{var C;return((C=Jt.find(A=>A.code===l.localization.country))==null?void 0:C.name)||l.localization.country},[l.localization.country]);const T=S.useMemo(()=>c.find(C=>C.id===s),[c,s]),_=S.useMemo(()=>u.find(C=>C.id===(T==null?void 0:T.siteId)),[u,T]),j=S.useMemo(()=>h.filter(C=>C.farmerId===s),[h,s]),E=S.useMemo(()=>{const C=f.filter(U=>{const O=h.find(F=>F.id===U.moduleId);return(O==null?void 0:O.farmerId)===s&&(new Date(U.plantingDate)<=b&&new Date(U.plantingDate)>=y||U.harvestDate&&new Date(U.harvestDate)<=b&&new Date(U.harvestDate)>=y)}),A=C.filter(U=>U.harvestDate&&new Date(U.harvestDate)>=y&&new Date(U.harvestDate)<=b),M=C.filter(U=>new Date(U.plantingDate)>=y&&new Date(U.plantingDate)<=b),I=A.reduce((U,O)=>U+(O.harvestedWeight||0),0),P=C.filter(U=>U.status==="PLANTED"||U.status==="GROWING").length,D=m.filter(U=>new Date(U.date)>=y&&new Date(U.date)<=b&&U.affectedModuleIds.some(O=>j.some(F=>F.id===O)));return{plantedLines:M.reduce((U,O)=>U+(O.linesPlanted||0),0),harvestedLines:A.reduce((U,O)=>U+(O.linesHarvested||0),0),harvestedWeight:I,activeCycles:P,incidentsCount:D.length,incidents:D,harvestedCycles:A}},[f,h,s,y,b,m,j]),k=S.useMemo(()=>{const C=[];return E.harvestedCycles.forEach(M=>{if(M.harvestDate&&M.plantingDate&&M.harvestedWeight&&M.initialWeight){const I=(new Date(M.harvestDate).getTime()-new Date(M.plantingDate).getTime())/864e5,P=pd(M.initialWeight,M.harvestedWeight,I);P!==null&&C.push(P)}}),{avgGrowthRate:C.length>0?C.reduce((M,I)=>M+I,0)/C.length:0}},[E.harvestedCycles]);return T?n.jsxs(ks,{children:[n.jsxs("header",{className:"mb-6 border-b pb-4",children:[n.jsx("h1",{className:"text-xl font-bold text-center uppercase mb-2",children:a("individualFarmerReport")}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsxs("div",{children:[n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[a("farmer"),":"]})," ",T.firstName," ",T.lastName]}),n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[a("code"),":"]})," ",T.code]}),n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[a("site"),":"]})," ",_==null?void 0:_.name]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{children:[n.jsxs("span",{className:"font-bold",children:[a("period"),":"]})," ",x]}),n.jsx("p",{children:l.company.name})]})]})]}),n.jsxs("section",{className:"mb-6",children:[n.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:a("productionSummary")}),n.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[n.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:a("totalPlantedLines")}),n.jsx("p",{className:"text-xl font-bold",children:E.plantedLines})]}),n.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:a("totalHarvestedLines")}),n.jsx("p",{className:"text-xl font-bold",children:E.harvestedLines})]}),n.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:a("totalHarvestedWeight")}),n.jsxs("p",{className:"text-xl font-bold",children:[Fe(E.harvestedWeight,l.localization)," kg"]})]}),n.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[n.jsx("p",{className:"text-xs text-gray-500 uppercase",children:a("growthRate")}),n.jsxs("p",{className:"text-xl font-bold",children:[k.avgGrowthRate.toFixed(2),"%"]})]})]})]}),n.jsxs("section",{className:"mb-6",children:[n.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:a("incidentsReported")}),E.incidents.length>0?n.jsxs("table",{className:"w-full text-sm text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50",children:[n.jsx("th",{className:"p-2",children:a("date")}),n.jsx("th",{className:"p-2",children:a("type")}),n.jsx("th",{className:"p-2",children:a("severity")})]})}),n.jsx("tbody",{children:E.incidents.map(C=>n.jsxs("tr",{className:"border-b border-gray-100",children:[n.jsx("td",{className:"p-2",children:C.date}),n.jsx("td",{className:"p-2",children:C.type}),n.jsx("td",{className:"p-2",children:C.severity})]},C.id))})]}):n.jsx("p",{className:"text-sm text-gray-500 italic",children:a("noIncidentsForFarmer")})]}),n.jsx("section",{children:n.jsx(Wo,{title:a("narrativeFarmerPerformance"),generator:()=>v2({farmerName:`${T.firstName} ${T.lastName}`,siteName:(_==null?void 0:_.name)||"",period:x,production:E,efficiency:k,incidentsCount:E.incidentsCount},i)})})]}):n.jsx("div",{children:a("noDataForReport")})},SO=({month:e,year:t,sections:s})=>{const{t:a,language:i}=we(),{settings:l}=Ke(),{cultivationCycles:c,modules:u,sites:f,seaweedTypes:h,farmerCredits:m,repayments:x,farmers:y,creditTypes:b,stockMovements:T,employees:_,incidents:j,incidentTypes:E}=He(),k=new Date(t,e).toLocaleDateString(i,{month:"long",year:"numeric"}),C=new Date(t,e,1),A=new Date(t,e+1,0,23,59,59),M=S.useMemo(()=>{var q;return((q=Jt.find(z=>z.code===l.localization.country))==null?void 0:q.name)||l.localization.country},[l.localization.country]),I=S.useMemo(()=>s.includes("production")?c.filter(q=>q.harvestDate&&new Date(q.harvestDate)>=C&&new Date(q.harvestDate)<=A).map(q=>{const z=u.find(G=>G.id===q.moduleId),Y=q.harvestDate?(new Date(q.harvestDate).getTime()-new Date(q.plantingDate).getTime())/(1e3*3600*24):0,J=(q.harvestedWeight||0)-(q.cuttingsTakenAtHarvestKg||0);return{cycle:{...q,harvestedWeight:J},module:z,site:f.find(G=>G.id===(z==null?void 0:z.siteId)),seaweedType:h.find(G=>G.id===q.seaweedTypeId),duration:Math.round(Y)}}).sort((q,z)=>new Date(q.cycle.harvestDate).getTime()-new Date(z.cycle.harvestDate).getTime()):[],[s,c,u,f,h,C,A]),P=S.useMemo(()=>{if(!s.includes("finance"))return{reportData:[],summaryStats:{totalCredits:0,totalAmount:0,topFarmers:[]}};const q=new Map(y.map(B=>[B.id,`${B.firstName} ${B.lastName}`])),z=new Map(b.map(B=>[B.id,B.name])),Y=m.filter(B=>B.date&&new Date(B.date)>=C&&new Date(B.date)<=A).map(B=>({...B,farmerName:q.get(B.farmerId)||a("unknown"),creditTypeName:z.get(B.creditTypeId)||a("unknown")})),J=new Map;Y.forEach(B=>{J.set(B.farmerName,(J.get(B.farmerName)||0)+B.totalAmount)});const G=Array.from(J.entries()).sort(([,B],[,Q])=>Q-B).slice(0,5).map(([B,Q])=>({name:B,total:Q}));return{reportData:Y,summaryStats:{totalCredits:Y.length,totalAmount:Y.reduce((B,Q)=>B+Q.totalAmount,0),topFarmers:G}}},[s,m,y,b,C,A,a]),D=S.useMemo(()=>{if(!s.includes("inventory"))return{reportData:[],summaryStats:{totalKg:0,totalBags:0,totalValue:0}};const q=new Map;T.forEach(G=>{if(new Date(G.date)<=A){const B=`${G.siteId}|${G.seaweedTypeId}`,Q=q.get(B)||{kg:0,bags:0};Q.kg+=(G.inKg||0)-(G.outKg||0),Q.bags+=(G.inBags||0)-(G.outBags||0),q.set(B,Q)}});const z=new Map(f.map(G=>[G.id,G.name])),Y=new Map(h.map(G=>[G.id,{name:G.name,dryPrice:G.dryPrice}])),J=Array.from(q.entries()).map(([G,B])=>{const[Q,W]=G.split("|"),ae=z.get(Q)||a("unknown"),$=Y.get(W),ie=($==null?void 0:$.name)||a("unknown"),ue=B.kg*(($==null?void 0:$.dryPrice)||0);return{siteName:ae,seaweedTypeName:ie,currentStockKg:Math.max(0,B.kg),currentStockBags:Math.max(0,B.bags),value:ue}}).filter(G=>G.currentStockKg>.01||G.currentStockBags>0);return{reportData:J,summaryStats:{totalKg:J.reduce((G,B)=>G+B.currentStockKg,0),totalBags:J.reduce((G,B)=>G+B.currentStockBags,0),totalValue:J.reduce((G,B)=>G+B.value,0)}}},[s,T,f,h,A,a]),U=S.useCallback(async()=>I.length===0?a("noDataForReport"):await T2(I,i),[I,i,a]),O=S.useCallback(async()=>P.reportData.length===0?a("noDataForReport"):await j2(P.reportData,P.summaryStats,i),[P,i,a]),F=S.useCallback(async()=>D.reportData.length===0?a("noDataForReport"):await _2(D.reportData,D.summaryStats,i),[D,i,a]);return n.jsxs(ks,{children:[n.jsx("header",{className:"mb-8 border-b-2 border-gray-800 dark:border-gray-200 pb-4",children:n.jsxs("div",{className:"grid grid-cols-4 items-center",children:[n.jsx("div",{className:"col-span-1",children:n.jsx("img",{src:l.company.logoUrl,alt:`${l.company.name} logo`,className:"h-14 w-auto object-contain"})}),n.jsxs("div",{className:"col-span-2 text-center",children:[n.jsx("h1",{className:"font-bold text-xl uppercase mb-1 text-gray-900 dark:text-gray-100",children:l.company.name}),n.jsxs("div",{className:"text-[9px] leading-tight space-y-0 text-gray-600 dark:text-gray-400",children:[n.jsxs("p",{children:[a("address"),": ",l.company.address]}),n.jsxs("p",{children:[a("nif"),": ",l.company.nif," / ",a("stat"),": ",l.company.stat]}),n.jsxs("p",{children:[a("country"),": ",M]})]})]}),n.jsxs("div",{className:"col-span-1 text-right",children:[n.jsx("h2",{className:"text-xl font-bold uppercase text-gray-900 dark:text-gray-100",children:a("customReportTitle")}),n.jsx("p",{className:"font-bold text-sm mt-1 text-blue-600 dark:text-blue-400",children:k})]})]})}),s.includes("production")&&n.jsxs("section",{className:"mb-10 break-inside-avoid",children:[n.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-blue-500 mb-4 pb-1 text-blue-800 dark:text-blue-300 flex items-center",children:[n.jsx("span",{className:"bg-blue-500 w-2 h-6 mr-2 rounded-sm inline-block"}),a("section_production")]}),n.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:n.jsxs("table",{className:"w-full text-left text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-blue-50 dark:bg-blue-900/30 border-b border-blue-200 dark:border-blue-800",children:[n.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:a("site")}),n.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:a("module")}),n.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:a("seaweedType")}),n.jsxs("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:[a("harvestedWeight")," (Net Kg)"]}),n.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:a("duration")})]})}),n.jsx("tbody",{children:I.length>0?I.map((q,z)=>{var Y,J,G;return n.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${z%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[n.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(Y=q.site)==null?void 0:Y.name}),n.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:(J=q.module)==null?void 0:J.code}),n.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(G=q.seaweedType)==null?void 0:G.name}),n.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Fe(q.cycle.harvestedWeight||0,l.localization)}),n.jsxs("td",{className:"p-2 text-right text-gray-600 dark:text-gray-400",children:[q.duration," ",a("days")]})]},q.cycle.id)}):n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:a("noDataForReport")})})})]})}),I.length>0&&n.jsx(Wo,{title:a("aiAnalysis"),generator:U,minimal:!0})]}),s.includes("finance")&&n.jsxs("section",{className:"mb-10 break-inside-avoid",children:[n.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-green-500 mb-4 pb-1 text-green-800 dark:text-green-300 flex items-center",children:[n.jsx("span",{className:"bg-green-500 w-2 h-6 mr-2 rounded-sm inline-block"}),a("section_finance")]}),n.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 text-center",children:[n.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[n.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:a("totalCreditsIssued")}),n.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:P.summaryStats.totalCredits})]}),n.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[n.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:a("totalCreditAmount")}),n.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:Ae(P.summaryStats.totalAmount,l.localization)})]})]}),P.reportData.length>0&&n.jsx(Wo,{title:a("aiAnalysis"),generator:O,minimal:!0})]}),s.includes("inventory")&&n.jsxs("section",{className:"mb-10 break-inside-avoid",children:[n.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-yellow-500 mb-4 pb-1 text-yellow-800 dark:text-yellow-300 flex items-center",children:[n.jsx("span",{className:"bg-yellow-500 w-2 h-6 mr-2 rounded-sm inline-block"}),a("section_inventory")]}),n.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:n.jsxs("table",{className:"w-full text-left text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800",children:[n.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:a("site")}),n.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:a("seaweedType")}),n.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:a("stockKg")}),n.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:a("stockBales")})]})}),n.jsx("tbody",{children:D.reportData.length>0?D.reportData.map((q,z)=>n.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${z%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[n.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:q.siteName}),n.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:q.seaweedTypeName}),n.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Fe(q.currentStockKg,l.localization)}),n.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Fe(q.currentStockBags,{...l.localization,nonMonetaryDecimals:0})})]},`${q.siteName}-${q.seaweedTypeName}`)):n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:a("noDataForReport")})})})]})}),D.reportData.length>0&&n.jsx(Wo,{title:a("aiAnalysis"),generator:F,minimal:!0})]}),s.includes("incidents")&&n.jsxs("section",{className:"mb-10 break-inside-avoid",children:[n.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-red-500 mb-4 pb-1 text-red-800 dark:text-red-300 flex items-center",children:[n.jsx("span",{className:"bg-red-500 w-2 h-6 mr-2 rounded-sm inline-block"}),a("section_incidents")]}),n.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-center",children:n.jsx("p",{className:"text-sm italic text-gray-500 dark:text-gray-400",children:a("noMajorIncidents")})})]})]})},Oi=({children:e,className:t=""})=>n.jsx("div",{className:`report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col h-auto min-h-[210mm] overflow-visible print:overflow-visible print:shadow-none ${t}`,children:n.jsx("div",{className:"flex-grow flex flex-col font-sans text-xs leading-normal text-black p-6 box-border w-full",children:e})}),Li=({period:e,title:t})=>{const{settings:s}=Ke(),{t:a}=we();return n.jsxs("header",{className:"flex-shrink-0 text-black relative mb-4 border-b-2 border-gray-800 pb-2",children:[n.jsx("div",{className:"absolute top-0 right-0 text-[9px] font-bold text-gray-600",children:e}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:s.company.logoUrl,alt:"Logo",className:"h-10 w-auto object-contain"})}),n.jsxs("div",{className:"flex-grow text-center",children:[n.jsx("h1",{className:"font-bold text-sm uppercase mb-1 tracking-wide",children:s.company.name}),n.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight",children:[n.jsxs("span",{children:[a("company_sarl")," ",Ae(s.company.capital,s.localization)]}),n.jsx("span",{className:"text-gray-400",children:"|"}),n.jsxs("span",{children:["NIF: ",s.company.nif]}),n.jsx("span",{className:"text-gray-400",children:"|"}),n.jsxs("span",{children:["STAT: ",s.company.stat]}),n.jsx("span",{className:"text-gray-400",children:"|"}),n.jsxs("span",{children:["RCS: ",s.company.rc]})]}),n.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight mt-0.5",children:[n.jsx("span",{children:s.company.address}),n.jsx("span",{className:"text-gray-400",children:"|"}),n.jsxs("span",{children:[a("phone"),": ",s.company.phone]})]})]}),n.jsx("div",{className:"w-20"})," "]}),n.jsx("div",{className:"text-center mt-3",children:t&&n.jsx("h2",{className:"font-bold text-sm uppercase tracking-wider inline-block pb-0.5",children:t})})]})},Ui=({page:e,totalPages:t})=>n.jsxs("div",{className:"mt-auto pt-4 text-center text-[8px] text-gray-500 border-t border-gray-300 print:mt-auto break-before-avoid",children:["Page ",e," / ",t]}),oe=({children:e,className:t="",colSpan:s,rowSpan:a,header:i=!1,align:l="center",bold:c=!1,title:u})=>n.jsx("td",{colSpan:s,rowSpan:a,title:u,className:`px-1 py-0.5 border border-gray-400 text-[8px] text-black align-middle text-${l} ${i?"font-bold bg-gray-100 text-gray-900":""} ${c?"font-bold":""} ${t}`,children:e||n.jsx(n.Fragment,{children:""})}),Za=({generator:e,className:t="",title:s})=>{const{t:a}=we();return n.jsxs("div",{className:`text-black flex flex-col mt-4 break-inside-avoid ${t}`,children:[n.jsxs("div",{className:"font-bold text-[9px] mb-1 uppercase text-blue-800 border-b border-blue-200 inline-block self-start",children:[s," :"]}),n.jsx("div",{className:"relative text-[9pt] leading-snug text-justify text-gray-800 bg-gray-50 p-2 rounded border border-gray-200",children:n.jsx(Wo,{title:a("narratif_explicatif_tableau"),generator:e,minimal:!0,className:"mt-0 !h-auto"})})]})},wO=({month:e,year:t})=>{const{t:s,language:a}=we(),i=He(),{sites:l,seaweedTypes:c,cultivationCycles:u,modules:f,incidents:h,periodicTests:m,farmers:x,stockMovements:y,pressedStockMovements:b,exportDocuments:T,creditTypes:_,farmerCredits:j,repayments:E,employees:k,roles:C,monthlyPayments:A,incidentTypes:M}=i,I=S.useMemo(()=>{const B=new Date(t,e,1),Q=new Date(t,e+1,0,23,59,59),W=new Date(t,e).toLocaleDateString(a,{month:"long",year:"numeric"}).toUpperCase(),ae=[];for(let fe=0;fe<12;fe++){const Z=new Date(t,fe),ee=Z.toLocaleString(a,{month:"short"}).replace(".","").toUpperCase(),xe=Z.getFullYear().toString().slice(-2);ae.push(`${ee} ${xe}`)}const $=[];for(let fe=5;fe>=0;fe--)$.push(new Date(t,e-fe));const ie=new Date(t,e+1),ue=new Date(t,e+2),Ne=new Date(t,e+3),le=[ie.toLocaleDateString(a,{month:"long",year:"numeric"}).toUpperCase(),ue.toLocaleDateString(a,{month:"long",year:"numeric"}).toUpperCase(),Ne.toLocaleDateString(a,{month:"long",year:"numeric"}).toUpperCase()],je=new Date(t,e-1,1).toLocaleDateString(a,{month:"long",year:"numeric"}).toUpperCase();return{startDate:B,endDate:Q,period:W,year:t,month:e,months:ae,sixMonths:$,prevMonthName:je,nextMonths:le}},[t,e,a]),{pivotData:P,sortedIncidentTypes:D,displaySites:U,displaySeaweedTypes:O,onSiteStockReportData:F,pressedWarehouseReportData:q,monthlyProductionData:z}=S.useMemo(()=>{const B={},Q=()=>({farmerCount:0,lineAge:{"0-10":0,"11-20":0,"21-30":0,"30-40":0,"40-50":0,">50":0},totalLinesInWater:0,totalLinesHarvested:0,totalLinesPlanted:0,productionKg:0,avgGrowthRate:0,growthRateCount:0,forecast:{m1:0,m2:0,m3:0},incidents:{},weather:{tempSum:0,tempCount:0,salinitySum:0,salinityCount:0,rainSum:0,rainCount:0,windSpeedSum:0,windSpeedCount:0,windDirSum:0,windDirCount:0}});c.forEach(Z=>{B[Z.id]={},l.forEach(ee=>{B[Z.id][ee.id]=Q()}),B[Z.id].TOTAL=Q()});const W={};l.forEach(Z=>{W[Z.id]={},c.forEach(ee=>{W[Z.id][ee.id]=Array.from({length:12},()=>({production:0,growthRateSum:0,growthRateCount:0}))})}),u.forEach(Z=>{const ee=f.find(Re=>Re.id===Z.moduleId);if(!ee)return;const xe=Z.seaweedTypeId,Oe=ee.siteId;if(Z.harvestDate&&Z.harvestedWeight&&W[Oe]&&W[Oe][xe]){const Re=new Date(Z.harvestDate);if(Re.getFullYear()===t){const Ve=Re.getMonth(),ze=W[Oe][xe][Ve],Se=(Z.harvestedWeight||0)-(Z.cuttingsTakenAtHarvestKg||0);if(ze.production+=Se,Z.initialWeight&&Z.initialWeight>0){const Le=(Re.getTime()-new Date(Z.plantingDate).getTime())/864e5;if(Le>0){const be=(Math.log(Z.harvestedWeight)-Math.log(Z.initialWeight))/Le*100;ze.growthRateSum+=be,ze.growthRateCount++}}}}if(!B[xe]||!B[xe][Oe])return;[B[xe][Oe],B[xe].TOTAL].forEach(Re=>{if((Z.status===Ye.PLANTED||Z.status===Ye.GROWING)&&new Date(Z.plantingDate)<=I.endDate){const Ve=Z.linesPlanted||ee.lines||0,ze=(I.endDate.getTime()-new Date(Z.plantingDate).getTime())/(1e3*60*60*24);Re.totalLinesInWater+=Ve;let Se=">50";ze<=10?Se="0-10":ze<=20?Se="11-20":ze<=30?Se="21-30":ze<=40?Se="30-40":ze<=50&&(Se="40-50"),Re.lineAge[Se]+=Ve;const be=new Date(new Date(Z.plantingDate).getTime()+pa*24*60*60*1e3).getMonth(),ye=new Date(t,e+1).getMonth(),Ue=new Date(t,e+2).getMonth(),et=new Date(t,e+3).getMonth(),At=Ve*.8;be===ye?Re.forecast.m1+=At:be===Ue?Re.forecast.m2+=At:be===et&&(Re.forecast.m3+=At)}if(Z.harvestDate&&new Date(Z.harvestDate)>=I.startDate&&new Date(Z.harvestDate)<=I.endDate){Re.totalLinesHarvested+=Z.linesHarvested||0;const Ve=(Z.harvestedWeight||0)-(Z.cuttingsTakenAtHarvestKg||0);if(Re.productionKg+=Ve,Z.harvestedWeight&&Z.initialWeight&&Z.initialWeight>0){const ze=(new Date(Z.harvestDate).getTime()-new Date(Z.plantingDate).getTime())/864e5;if(ze>0){const Se=(Math.log(Z.harvestedWeight)-Math.log(Z.initialWeight))/ze*100;Re.avgGrowthRate=(Re.avgGrowthRate*Re.growthRateCount+Se)/(Re.growthRateCount+1),Re.growthRateCount++}}}new Date(Z.plantingDate)>=I.startDate&&new Date(Z.plantingDate)<=I.endDate&&(Re.totalLinesPlanted+=Z.linesPlanted||ee.lines||0)})});const ae={};f.forEach(Z=>{var ee;if(Z.farmerId&&Z.siteId){const xe=u.find(De=>De.moduleId===Z.id&&(De.status==="PLANTED"||De.status==="GROWING")),Oe=xe?xe.seaweedTypeId:(ee=c[0])==null?void 0:ee.id;if(Oe){const De=`${Oe}-${Z.siteId}`,Re=`${Oe}-TOTAL`;ae[De]||(ae[De]=new Set),ae[Re]||(ae[Re]=new Set),ae[De].add(Z.farmerId),ae[Re].add(Z.farmerId)}}}),Object.entries(ae).forEach(([Z,ee])=>{const[xe,Oe]=Z.split("-");B[xe]&&B[xe][Oe]&&(B[xe][Oe].farmerCount=ee.size)});const $={};h.forEach(Z=>{const ee=new Date(Z.date);if(ee>=I.startDate&&ee<=I.endDate){$[Z.type]=($[Z.type]||0)+1;const xe=new Set;Z.affectedModuleIds&&Z.affectedModuleIds.length>0&&Z.affectedModuleIds.forEach(Oe=>{var ze;const De=f.find(Se=>Se.id===Oe);if(!De)return;let Re=u.find(Se=>Se.moduleId===De.id&&new Date(Se.plantingDate)<=ee&&(!Se.harvestDate||new Date(Se.harvestDate)>=ee));Re||(Re=u.filter(Le=>Le.moduleId===De.id&&new Date(Le.plantingDate)<=ee).sort((Le,be)=>new Date(be.plantingDate).getTime()-new Date(Le.plantingDate).getTime())[0]);const Ve=Re?Re.seaweedTypeId:(ze=c[0])==null?void 0:ze.id;Ve&&De.siteId&&xe.add(`${Ve}|${De.siteId}`)}),xe.forEach(Oe=>{const[De,Re]=Oe.split("|");B[De]&&B[De][Re]&&(B[De][Re].incidents[Z.type]=(B[De][Re].incidents[Z.type]||0)+1,B[De].TOTAL.incidents[Z.type]=(B[De].TOTAL.incidents[Z.type]||0)+1)})}}),m.forEach(Z=>{var ee,xe;new Date(Z.date)>=I.startDate&&new Date(Z.date)<=I.endDate&&[(ee=B[Z.seaweedTypeId])==null?void 0:ee[Z.siteId],(xe=B[Z.seaweedTypeId])==null?void 0:xe.TOTAL].forEach(De=>{De&&(Z.temperature&&(De.weather.tempSum+=Z.temperature,De.weather.tempCount++),Z.salinity&&(De.weather.salinitySum+=Z.salinity,De.weather.salinityCount++),Z.precipitation&&(De.weather.rainSum+=Z.precipitation,De.weather.rainCount++),Z.windSpeed&&(De.weather.windSpeedSum+=Z.windSpeed,De.weather.windSpeedCount++),Z.windDirection&&(De.weather.windDirSum+=Z.windDirection,De.weather.windDirCount++))})});const ie={};l.forEach(Z=>{Z.id!=="pressing-warehouse"&&(ie[Z.id]={},c.forEach(ee=>{ie[Z.id][ee.id]={openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0}}))}),y.forEach(Z=>{if(Z.siteId==="pressing-warehouse"||!ie[Z.siteId]||!ie[Z.siteId][Z.seaweedTypeId])return;const ee=new Date(Z.date),xe=ie[Z.siteId][Z.seaweedTypeId];ee<I.startDate?(xe.openingKg+=(Z.inKg||0)-(Z.outKg||0),xe.openingBags+=(Z.inBags||0)-(Z.outBags||0)):ee<=I.endDate&&(xe.entriesKg+=Z.inKg||0,xe.entriesBags+=Z.inBags||0,xe.exitsKg+=Z.outKg||0,xe.exitsBags+=Z.outBags||0)}),Object.values(ie).forEach(Z=>{Object.values(Z).forEach(ee=>{ee.closingKg=ee.openingKg+ee.entriesKg-ee.exitsKg,ee.closingBags=ee.openingBags+ee.entriesBags-ee.exitsBags})});const ue={};c.forEach(Z=>{ue[Z.id]={bulk:{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},pressed:{openingKg:0,openingBales:0,entriesKg:0,entriesBales:0,exitsKg:0,exitsBales:0,closingKg:0,closingBales:0}}}),b.forEach(Z=>{if(!ue[Z.seaweedTypeId])return;const ee=new Date(Z.date)<I.startDate,xe=new Date(Z.date)>=I.startDate&&new Date(Z.date)<=I.endDate;if(Z.type===mt.BULK_IN_FROM_SITE||Z.type===mt.FARMER_DELIVERY){const Oe=Z.inBales||0;ee&&(ue[Z.seaweedTypeId].bulk.openingKg+=Z.inKg||0,ue[Z.seaweedTypeId].bulk.openingBags+=Oe),xe&&(ue[Z.seaweedTypeId].bulk.entriesKg+=Z.inKg||0,ue[Z.seaweedTypeId].bulk.entriesBags+=Oe)}if(Z.type===mt.PRESSING_CONSUMPTION){const Oe=Z.outBales||0;ee&&(ue[Z.seaweedTypeId].bulk.openingKg-=Z.outKg||0,ue[Z.seaweedTypeId].bulk.openingBags-=Oe),xe&&(ue[Z.seaweedTypeId].bulk.exitsKg+=Z.outKg||0,ue[Z.seaweedTypeId].bulk.exitsBags+=Oe)}(Z.type===mt.INITIAL_STOCK||Z.type===mt.PRESSING_IN)&&(ee&&(ue[Z.seaweedTypeId].pressed.openingKg+=Z.inKg||0,ue[Z.seaweedTypeId].pressed.openingBales+=Z.inBales||0),xe&&Z.type===mt.PRESSING_IN&&(ue[Z.seaweedTypeId].pressed.entriesKg+=Z.inKg||0,ue[Z.seaweedTypeId].pressed.entriesBales+=Z.inBales||0)),(Z.type===mt.EXPORT_OUT||Z.type===mt.RETURN_TO_SITE)&&(ee&&(ue[Z.seaweedTypeId].pressed.openingKg-=Z.outKg||0,ue[Z.seaweedTypeId].pressed.openingBales-=Z.outBales||0),xe&&(ue[Z.seaweedTypeId].pressed.exitsKg+=Z.outKg||0,ue[Z.seaweedTypeId].pressed.exitsBales+=Z.outBales||0))}),Object.keys(ue).forEach(Z=>{const ee=ue[Z];ee.bulk.closingKg=ee.bulk.openingKg+ee.bulk.entriesKg-ee.bulk.exitsKg,ee.bulk.closingBags=ee.bulk.openingBags+ee.bulk.entriesBags-ee.bulk.exitsBags,ee.pressed.closingKg=ee.pressed.openingKg+ee.pressed.entriesKg-ee.pressed.exitsKg,ee.pressed.closingBales=ee.pressed.openingBales+ee.pressed.entriesBales-ee.pressed.exitsBales});const Ne=l.filter(Z=>Z.id!=="pressing-warehouse");let le=c;c.length===0&&(le=[{id:"default",name:s("allSeaweedTypes"),dryPrice:0,wetPrice:0,scientificName:"",description:"",priceHistory:[]}]);const je=Object.keys($).sort((Z,ee)=>$[ee]-$[Z]).slice(0,3).map(Z=>{var ee;return((ee=M.find(xe=>xe.id===Z))==null?void 0:ee.name)||Z}),fe={totalLinesInWater:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesInWater,0),totalHarvestedLines:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesHarvested,0),totalPlantedLines:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesPlanted,0),totalProductionKg:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.productionKg,0),avgGrowthRate:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.avgGrowthRate,0)/(Object.keys(B).length||1),incidentCount:Object.values($).reduce((Z,ee)=>Z+ee,0)};return{pivotData:B,sortedIncidentTypes:je,displaySites:Ne,displaySeaweedTypes:le,onSiteStockReportData:ie,pressedWarehouseReportData:ue,monthlyProductionData:W,page1Data:fe}},[u,f,x,h,m,l,c,I,y,b,t,e,M,s]),{groupedFarmerStats:Y,totals:J}=S.useMemo(()=>{const B=new Map,Q=ue=>`${ue.getFullYear()}-${ue.getMonth()}`,W=(ue,Ne,le)=>{B.has(ue)||B.set(ue,new Map);const ne=B.get(ue);ne.has(Ne)||ne.set(Ne,new Map);const je=ne.get(Ne);return je.has(le)||je.set(le,{planted:0,harvested:0,production:0}),je.get(le)};u.forEach(ue=>{const Ne=f.find(ee=>ee.id===ue.moduleId);if(!(Ne!=null&&Ne.farmerId))return;const le=Ne.farmerId,ne=ue.seaweedTypeId,je=new Date(ue.plantingDate),fe=Q(je),Z=W(le,ne,fe);if(Z.planted+=ue.linesPlanted||Ne.lines||0,ue.harvestDate){const ee=new Date(ue.harvestDate),xe=Q(ee),Oe=W(le,ne,xe);Oe.harvested+=ue.linesHarvested||0;const De=(ue.harvestedWeight||0)-(ue.cuttingsTakenAtHarvestKg||0);Oe.production+=De}});const ae={};x.forEach(ue=>{const Ne=l.find(ne=>ne.id===ue.siteId);if(!Ne)return;const le=B.get(ue.id);le&&le.forEach((ne,je)=>{const fe=I.sixMonths.map(ee=>{const xe=Q(ee);return ne.get(xe)||{planted:0,harvested:0,production:0}});if(fe.some(ee=>ee.planted>0||ee.harvested>0||ee.production>0)){const ee=c.find(xe=>xe.id===je);if(!ee)return;ae[Ne.id]||(ae[Ne.id]={siteName:Ne.name,seaweedTypes:{}}),ae[Ne.id].seaweedTypes[je]||(ae[Ne.id].seaweedTypes[je]={typeName:ee.name,farmers:[]}),ae[Ne.id].seaweedTypes[je].farmers.push({id:ue.id,name:`${ue.lastName} ${ue.firstName}`,stats:fe})}})});const $=Object.values(ae).map(ue=>({...ue,seaweedTypes:Object.values(ue.seaweedTypes).map(Ne=>({...Ne,farmers:Ne.farmers.sort((le,ne)=>le.name.localeCompare(ne.name))})).sort((Ne,le)=>Ne.typeName.localeCompare(le.typeName))})).sort((ue,Ne)=>ue.siteName.localeCompare(Ne.siteName)),ie=I.sixMonths.map((ue,Ne)=>$.reduce((le,ne)=>(ne.seaweedTypes.forEach(je=>{je.farmers.forEach(fe=>{const Z=fe.stats[Ne];le.planted+=Z.planted,le.harvested+=Z.harvested,le.production+=Z.production})}),le),{planted:0,harvested:0,production:0}));return{groupedFarmerStats:$,totals:ie}},[x,I.sixMonths,u,f,l,c]),G=6;return n.jsxs(n.Fragment,{children:[n.jsx(TO,{period:I.period,pivotData:P,displaySites:U,displaySeaweedTypes:O,incidentTypes:D,nextMonths:I.nextMonths,t:s,page:1,totalPages:G}),n.jsx(jO,{period:I.period,employees:k,sites:U,roles:C,page:2,totalPages:G,monthlyPayments:A,month:e,year:t}),n.jsx(_O,{period:I.period,onSiteData:F,warehouseData:q,sites:U,seaweedTypes:c,page:3,totalPages:G}),n.jsx(EO,{period:I.period,year:I.year,exportDocuments:T,seaweedTypes:c,page:4,totalPages:G}),n.jsx(CO,{period:I.period,months:I.months,monthlyData:z,year:t,sites:U,seaweedTypes:c,page:5,totalPages:G}),n.jsx(IO,{period:I.period,sixMonths:I.sixMonths,prevMonthName:I.prevMonthName,creditTypes:_,farmerCredits:j,repayments:E,year:t,month:e,groupedData:Y,totals:J,page:6,totalPages:G})]})},TO=({period:e,pivotData:t,displaySites:s,displaySeaweedTypes:a,incidentTypes:i,nextMonths:l,t:c,page:u,totalPages:f})=>{const{settings:h}=Ke(),m=(b,T)=>{var _;return(_=t[b])==null?void 0:_[T]},x=b=>{const T=c("days");return b.includes(">")?`> 50 ${T}`:`${b} ${T}`},y=1+(s.length+1)*a.length;return n.jsxs(Oi,{children:[n.jsx(Li,{period:e,title:c("globalFarmReport")}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx("div",{className:"w-full overflow-hidden",children:n.jsxs("table",{className:"w-full border-collapse mb-2 table-fixed text-[8px]",children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"150px"}}),Array.from({length:y-1}).map((b,T)=>n.jsx("col",{},T))]}),n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsxs(oe,{rowSpan:2,header:!0,className:"align-middle bg-gray-200 border-b-2 border-gray-500 text-center",children:[c("period"),":",n.jsx("br",{}),e]}),a.map(b=>n.jsx(oe,{colSpan:s.length+1,header:!0,className:"bg-blue-50 border-b border-blue-300 text-blue-900 uppercase tracking-widest",children:b.name},b.id))]}),n.jsx("tr",{children:a.map(b=>n.jsxs(gt.Fragment,{children:[s.map(T=>n.jsx(oe,{header:!0,className:"bg-gray-50 text-gray-700 font-semibold",children:T.name},T.id)),n.jsx(oe,{header:!0,className:"bg-blue-100 text-blue-900 font-bold border-l border-blue-200",children:c("total")})]},b.id))})]}),n.jsxs("tbody",{children:[n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[9px] tracking-wider border-t-2 border-gray-600 font-bold",children:c("apercuGeneralDeLaFerme")})}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"font-semibold bg-gray-50 pl-2",children:c("fermier_effectif")}),a.map(b=>{var T;return n.jsxs(gt.Fragment,{children:[s.map(_=>{var j;return n.jsx(oe,{children:((j=m(b.id,_.id))==null?void 0:j.farmerCount)||"-"},_.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-100 border-l border-gray-300",children:((T=m(b.id,"TOTAL"))==null?void 0:T.farmerCount)||"-"})]},b.id)})]}),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("tranche_age_lignes")})}),["0-10","11-20","21-30","30-40","40-50",">50"].map((b,T)=>n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:x(b)}),a.map(_=>{var j;return n.jsxs(gt.Fragment,{children:[s.map(E=>{var k;return n.jsx(oe,{children:((k=m(_.id,E.id))==null?void 0:k.lineAge[b])||"-"},E.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((j=m(_.id,"TOTAL"))==null?void 0:j.lineAge[b])||"-"})]},_.id)})]},b)),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("bilan_lignes")})}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 font-bold text-blue-900 border-r border-gray-300",children:c("total_lignes_eau")}),a.map(b=>{var T;return n.jsxs(gt.Fragment,{children:[s.map(_=>{var j;return n.jsx(oe,{bold:!0,className:"text-blue-900",children:((j=m(b.id,_.id))==null?void 0:j.totalLinesInWater)||"-"},_.id)}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-blue-900 border-l border-blue-200",children:((T=m(b.id,"TOTAL"))==null?void 0:T.totalLinesInWater)||"-"})]},b.id)})]}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_recoltees")}),a.map(b=>{var T;return n.jsxs(gt.Fragment,{children:[s.map(_=>{var j;return n.jsx(oe,{children:((j=m(b.id,_.id))==null?void 0:j.totalLinesHarvested)||"-"},_.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(b.id,"TOTAL"))==null?void 0:T.totalLinesHarvested)||"-"})]},b.id)})]}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_plantees")}),a.map(b=>{var T;return n.jsxs(gt.Fragment,{children:[s.map(_=>{var j;return n.jsx(oe,{children:((j=m(b.id,_.id))==null?void 0:j.totalLinesPlanted)||"-"},_.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(b.id,"TOTAL"))==null?void 0:T.totalLinesPlanted)||"-"})]},b.id)})]}),n.jsxs("tr",{className:"border-t-2 border-gray-400",children:[n.jsx(oe,{header:!0,align:"left",className:"bg-green-100 text-green-900 uppercase font-bold pl-2",children:c("production_periode_kg")}),a.map(b=>{var T,_;return n.jsxs(gt.Fragment,{children:[s.map(j=>{var E,k;return n.jsx(oe,{className:"font-bold bg-green-50",children:(E=m(b.id,j.id))!=null&&E.productionKg?Fe((k=m(b.id,j.id))==null?void 0:k.productionKg,h.localization):"-"},j.id)}),n.jsx(oe,{bold:!0,className:"bg-green-100 text-green-900 border-l border-green-300",children:(T=m(b.id,"TOTAL"))!=null&&T.productionKg?Fe((_=m(b.id,"TOTAL"))==null?void 0:_.productionKg,h.localization):"-"})]},b.id)})]}),n.jsxs("tr",{children:[n.jsx(oe,{header:!0,align:"left",className:"bg-yellow-100 text-yellow-900 uppercase font-bold pl-2",children:c("taux_croissance_moyen")}),a.map(b=>{var T,_;return n.jsxs(gt.Fragment,{children:[s.map(j=>{var E,k;return n.jsx(oe,{className:"bg-yellow-50",children:(((E=m(b.id,j.id))==null?void 0:E.avgGrowthRate)||0)>0?`${(((k=m(b.id,j.id))==null?void 0:k.avgGrowthRate)||0).toFixed(2)}%`:"-"},j.id)}),n.jsx(oe,{bold:!0,className:"bg-yellow-100 text-yellow-900 border-l border-yellow-300",children:(((T=m(b.id,"TOTAL"))==null?void 0:T.avgGrowthRate)||0)>0?`${(((_=m(b.id,"TOTAL"))==null?void 0:_.avgGrowthRate)||0).toFixed(2)}%`:"-"})]},b.id)})]}),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("prevision_production")})}),["m1","m2","m3"].map((b,T)=>n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:l[T]}),a.map(_=>{var j,E;return n.jsxs(gt.Fragment,{children:[s.map(k=>{var C,A;return n.jsx(oe,{children:(C=m(_.id,k.id))!=null&&C.forecast[b]?Fe((A=m(_.id,k.id))==null?void 0:A.forecast[b],h.localization):"-"},k.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:(j=m(_.id,"TOTAL"))!=null&&j.forecast[b]?Fe((E=m(_.id,"TOTAL"))==null?void 0:E.forecast[b],h.localization):"-"})]},_.id)})]},b)),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,className:"bg-gray-200 text-black font-bold py-1.5 text-center text-[9px] border-t-2 border-gray-600 tracking-widest",children:c("monitoringReport").toUpperCase()})}),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[8px] tracking-wider font-bold",children:c("incidentsLabel")})}),i.length>0?i.map((b,T)=>n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-red-700 font-medium border-r border-gray-300",children:b}),a.map(_=>{var j;return n.jsxs(gt.Fragment,{children:[s.map(E=>{var k,C;return n.jsx(oe,{className:(k=m(_.id,E.id))!=null&&k.incidents[b]?"bg-red-50 font-bold text-red-600":"",children:((C=m(_.id,E.id))==null?void 0:C.incidents[b])||"-"},E.id)}),n.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((j=m(_.id,"TOTAL"))==null?void 0:j.incidents[b])||"-"})]},_.id)})]},b)):n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-green-600 italic bg-green-50",children:c("noMajorIncidents")}),n.jsx(oe,{colSpan:y-1,className:"bg-gray-50",children:"-"})]}),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("vent")})}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("vitesse_kmh")}),a.map(b=>n.jsxs(gt.Fragment,{children:[s.map(T=>{const _=m(b.id,T.id);return n.jsx(oe,{children:_&&_.weather.windSpeedCount?(_.weather.windSpeedSum/_.weather.windSpeedCount).toFixed(1):"-"},T.id)}),n.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},b.id))]}),n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("direction_deg")}),a.map(b=>n.jsxs(gt.Fragment,{children:[s.map(T=>{const _=m(b.id,T.id);return n.jsx(oe,{children:_&&_.weather.windDirCount?(_.weather.windDirSum/_.weather.windDirCount).toFixed(0):"-"},T.id)}),n.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},b.id))]}),n.jsx("tr",{children:n.jsx(oe,{colSpan:y,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("autres_parametres")})}),[{label:"temperature_c",key:"temp"},{label:"salinite_ppt",key:"salinity"},{label:"pluviometrie_mm",key:"rain"}].map((b,T)=>n.jsxs("tr",{children:[n.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c(b.label)}),a.map(_=>n.jsxs(gt.Fragment,{children:[s.map(j=>{const E=m(_.id,j.id),k=E==null?void 0:E.weather[`${b.key}Count`],C=E==null?void 0:E.weather[`${b.key}Sum`];return n.jsx(oe,{children:k?(C/k).toFixed(1):"-"},j.id)}),n.jsx(oe,{bold:!0,align:"center",className:"bg-gray-50 border-l border-gray-300",children:c("averageShort")})]},_.id))]},b.label))]})]})}),n.jsx(Za,{title:c("narratif_explicatif_tableau"),generator:async()=>E2({})})]}),n.jsx(Ui,{page:u,totalPages:f})]})},jO=({period:e,employees:t,sites:s,roles:a,page:i,totalPages:l,monthlyPayments:c,month:u,year:f})=>{const{t:h}=we(),{settings:m}=Ke(),x=S.useMemo(()=>{const j=new Map;if(!c)return j;const E=`${f}-${String(u+1).padStart(2,"0")}`;return c.filter(C=>C.period.startsWith(E)&&C.recipientType===Wt.EMPLOYEE).forEach(C=>{try{const A=JSON.parse(C.notes||"{}");A.type==="payroll_run"&&A.details&&A.details.gross!==void 0&&j.set(C.recipientId,parseFloat(A.details.gross)||0)}catch{}}),j},[c,f,u]),y=S.useCallback((j,E,k)=>{const C=t.filter(P=>P.role===j&&P.employeeType===E&&(k?P.siteId===k:!0)),A=C.length,M=P=>x.get(P.id)??0,I=C.reduce((P,D)=>P+M(D),0);return{count:A,amount:I}},[t,x]),b=["PERMANENT","CASUAL"],T=a.map(j=>j.name).sort(),_=S.useMemo(()=>{const j={};return b.forEach(E=>{j[E]={totalCount:0,totalAmount:0,sites:{}},s.forEach(k=>j[E].sites[k.id]={count:0,amount:0}),T.forEach(k=>{const C=y(k,E);j[E].totalCount+=C.count,j[E].totalAmount+=C.amount,s.forEach(A=>{const M=y(k,E,A.id);j[E].sites[A.id].count+=M.count,j[E].sites[A.id].amount+=M.amount})})}),j},[a,s,y]);return n.jsxs(Oi,{children:[n.jsx(Li,{period:e,title:h("repartition_salaries_site")}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx("div",{className:"w-full",children:n.jsxs("table",{className:"w-full border-collapse text-[7px] table-fixed border border-gray-400",children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"20%"}}),n.jsx("col",{style:{width:"8%"}}),n.jsx("col",{style:{width:"12%"}}),s.map(j=>n.jsxs(gt.Fragment,{children:[n.jsx("col",{}),n.jsx("col",{})]},j.id))]}),n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,className:"w-[20%] border-gray-400 bg-gray-100"}),n.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 text-blue-900 font-bold border-b border-gray-400 uppercase text-center",children:h("total")}),s.map(j=>n.jsx(oe,{colSpan:2,header:!0,className:"bg-gray-50 border-b border-gray-400 uppercase text-center font-bold",children:j.name},j.id))]}),n.jsxs("tr",{children:[n.jsx(oe,{header:!0,className:"bg-blue-50 text-center border-r border-blue-200",children:h("effectif")}),n.jsx(oe,{header:!0,className:"bg-blue-50 text-center",children:h("montant_du_mois")}),s.map(j=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{header:!0,className:"bg-gray-50 text-center border-l border-gray-300",children:h("effectif")}),n.jsx(oe,{header:!0,className:"bg-gray-50 text-center",children:h("montant_du_mois")})]},`sub-${j.id}`))]})]}),n.jsx("tbody",{children:b.map(j=>n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{colSpan:3+s.length*2,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase tracking-widest border-t-2 border-gray-400 font-bold",children:h(j==="CASUAL"?"journalier":"permanent")})}),T.map(E=>{const k=y(E,j);return k.count===0?null:n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{align:"left",className:"pl-2 font-medium border-r border-gray-300",children:E}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-center border-r border-blue-100",children:k.count}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right pr-2",children:k.amount?Ae(k.amount,m.localization):"-"}),s.map(C=>{const A=y(E,j,C.id);return n.jsxs(gt.Fragment,{children:[n.jsx(oe,{className:`text-center border-l border-gray-300 ${A.count?"":"text-gray-300"}`,children:A.count||"-"}),n.jsx(oe,{className:`text-right pr-2 ${A.amount?"":"text-gray-300"}`,children:A.amount?Ae(A.amount,m.localization):"-"})]},C.id)})]},`${j}-${E}`)}),n.jsxs("tr",{className:"bg-gray-100 font-bold border-t-2 border-gray-400",children:[n.jsx(oe,{align:"left",className:"pl-2 uppercase border-r border-gray-400",children:h(j==="CASUAL"?"total_journalier":"total_permanent")}),n.jsx(oe,{className:"bg-blue-200 text-center border-r border-blue-300",children:_[j].totalCount}),n.jsx(oe,{className:"bg-blue-200 text-right pr-2",children:Ae(_[j].totalAmount,m.localization)}),s.map(E=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{className:"text-center border-l border-gray-400 bg-gray-50",children:_[j].sites[E.id].count}),n.jsx(oe,{className:"text-right pr-2 bg-gray-50",children:Ae(_[j].sites[E.id].amount,m.localization)})]},`tot-${E.id}`))]})]},j))})]})}),n.jsx("div",{className:"w-full",children:n.jsx(Za,{title:h("narratif_repartition_salaries"),generator:async()=>C2({})})})]}),n.jsx(Ui,{page:i,totalPages:l})]})},_O=({period:e,onSiteData:t,warehouseData:s,sites:a,seaweedTypes:i,page:l,totalPages:c})=>{const{t:u}=we(),{settings:f}=Ke(),h=n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"16%"}}),n.jsx("col",{style:{width:"6%"}})," ",n.jsx("col",{style:{width:"5%"}})," ",n.jsx("col",{style:{width:"10%"}}),n.jsx("col",{style:{width:"6%"}})," ",n.jsx("col",{style:{width:"5%"}})," ",n.jsx("col",{style:{width:"10%"}}),n.jsx("col",{style:{width:"6%"}})," ",n.jsx("col",{style:{width:"5%"}})," ",n.jsx("col",{style:{width:"10%"}}),n.jsx("col",{style:{width:"6%"}})," ",n.jsx("col",{style:{width:"5%"}})," ",n.jsx("col",{style:{width:"10%"}})]});return n.jsxs(Oi,{children:[n.jsx(Li,{period:e}),n.jsxs("div",{className:"flex flex-col gap-6 mt-2",children:[n.jsxs("section",{children:[n.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-green-600 pl-2",children:[u("stocks_sur_sites")," :"]}),n.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:u("stock_ouverture")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:u("entrees")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:u("sorties")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:u("stock_fermeture")})]}),n.jsxs("tr",{children:[n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("sac")}),n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("sac")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("sac")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("sac")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("valeur")})]})]}),n.jsx("tbody",{children:a.map(m=>n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-500 font-bold pl-2",children:m.name})}),i.map(x=>{var T;const y=((T=t[m.id])==null?void 0:T[x.id])||{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},b=x.dryPrice||0;return n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{className:"pl-4 font-medium border-r border-gray-300",align:"left",children:x.name}),n.jsx(oe,{className:"text-right",children:y.openingKg?Fe(y.openingKg,f.localization):"-"}),n.jsx(oe,{className:"text-center",children:y.openingBags||"-"}),n.jsx(oe,{className:"text-right border-r border-gray-300",children:y.openingKg?Ae(y.openingKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:y.entriesKg?Fe(y.entriesKg,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:y.entriesBags||"-"}),n.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:y.entriesKg?Ae(y.entriesKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:y.exitsKg?Fe(y.exitsKg,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:y.exitsBags||"-"}),n.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:y.exitsKg?Ae(y.exitsKg*b,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.closingKg?Fe(y.closingKg,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:y.closingBags||"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.closingKg?Ae(y.closingKg*b,f.localization):"-"})]},x.id)})]},m.id))})]}),n.jsx(Za,{title:u("narratif_stocks_sites"),generator:async()=>I2({})})]}),n.jsxs("section",{children:[n.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-orange-500 pl-2",children:[u("stock_magasin_presse")," :"]}),n.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:u("stock_ouverture")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:u("entrees")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:u("sorties")}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:u("stock_fermeture")})]}),n.jsxs("tr",{children:[n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("colis")}),n.jsx(oe,{header:!0,className:"bg-gray-100",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("colis")}),n.jsx(oe,{header:!0,className:"bg-green-50",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("colis")}),n.jsx(oe,{header:!0,className:"bg-red-50",children:u("valeur")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("poids_kg")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("colis")}),n.jsx(oe,{header:!0,className:"bg-blue-50",children:u("valeur")})]})]}),n.jsx("tbody",{children:i.map((m,x)=>{const y=s[m.id],b=m.dryPrice||0;return y?n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-400 font-bold pl-2",children:m.name.toUpperCase()})}),n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:u("algues_en_vrac")}),n.jsx(oe,{className:"text-right",children:y.bulk.openingKg?Fe(y.bulk.openingKg,f.localization):"-"}),n.jsx(oe,{className:"text-center",children:y.bulk.openingBags||"-"}),n.jsx(oe,{className:"text-right border-r border-gray-300",children:y.bulk.openingKg?Ae(y.bulk.openingKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:y.bulk.entriesKg?Fe(y.bulk.entriesKg,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:y.bulk.entriesBags||"-"}),n.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:y.bulk.entriesKg?Ae(y.bulk.entriesKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:y.bulk.exitsKg?Fe(y.bulk.exitsKg,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:y.bulk.exitsBags||"-"}),n.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:y.bulk.exitsKg?Ae(y.bulk.exitsKg*b,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.bulk.closingKg?Fe(y.bulk.closingKg,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:y.bulk.closingBags||"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.bulk.closingKg?Ae(y.bulk.closingKg*b,f.localization):"-"})]}),n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:u("algues_pressees")}),n.jsx(oe,{className:"text-right",children:y.pressed.openingKg?Fe(y.pressed.openingKg,f.localization):"-"}),n.jsx(oe,{className:"text-center",children:y.pressed.openingBales||"-"}),n.jsx(oe,{className:"text-right border-r border-gray-300",children:y.pressed.openingKg?Ae(y.pressed.openingKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:y.pressed.entriesKg?Fe(y.pressed.entriesKg,f.localization):"-"}),n.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:y.pressed.entriesBales||"-"}),n.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:y.pressed.entriesKg?Ae(y.pressed.entriesKg*b,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:y.pressed.exitsKg?Fe(y.pressed.exitsKg,f.localization):"-"}),n.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:y.pressed.exitsBales||"-"}),n.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:y.pressed.exitsKg?Ae(y.pressed.exitsKg*b,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.pressed.closingKg?Fe(y.pressed.closingKg,f.localization):"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:y.pressed.closingBales||"-"}),n.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:y.pressed.closingKg?Ae(y.pressed.closingKg*b,f.localization):"-"})]})]},`presse-algue-${m.id}`):null})})]}),n.jsx(Za,{title:u("narratif_stocks_magasin"),generator:async()=>A2({})})]})]}),n.jsx(Ui,{page:l,totalPages:c})]})},EO=({period:e,year:t,exportDocuments:s,seaweedTypes:a,page:i,totalPages:l})=>{const{t:c}=we(),{settings:u}=Ke(),f=y=>{if(y.length===0)return n.jsx("tr",{children:n.jsx(oe,{colSpan:8,align:"center",className:"italic text-gray-500 py-4 bg-gray-50",children:"- No exports -"})});const b={};return a.forEach(T=>b[T.id]=[]),y.forEach(T=>{b[T.seaweedTypeId]||(b[T.seaweedTypeId]=[]),b[T.seaweedTypeId].push(T)}),a.map(T=>{var M;const _=b[T.id]||[];if(_.length===0)return null;const j=_.reduce((I,P)=>I+P.containers.reduce((D,U)=>D+U.seaweedWeightKg,0),0),E=_.reduce((I,P)=>I+P.containers.reduce((D,U)=>D+U.packagesCount,0),0),k=_.reduce((I,P)=>I+P.containers.length,0),C=_.reduce((I,P)=>I+P.containers.reduce((D,U)=>D+U.value,0),0),A=((M=_[0])==null?void 0:M.currency)||u.localization.currency;return n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{header:!0,align:"left",colSpan:7,className:"bg-gray-200 uppercase font-bold tracking-wider border-t-2 border-gray-500 pl-2",children:T.name.toUpperCase()})}),_.map(I=>{const P=I.containers.reduce((F,q)=>F+q.seaweedWeightKg,0),D=I.containers.reduce((F,q)=>F+q.packagesCount,0),U=I.containers.length,O=I.containers.reduce((F,q)=>F+q.value,0);return n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{className:"text-right pr-4",children:Fe(P,u.localization)}),n.jsx(oe,{className:"text-right pr-4",children:Fe(D,{...u.localization,nonMonetaryDecimals:0})}),n.jsx(oe,{className:"text-center",children:U}),n.jsx(oe,{className:"text-right pr-4",children:Ae(O,{...u.localization,currencySymbol:I.currency})}),n.jsx(oe,{children:I.invoiceNo}),n.jsx(oe,{children:I.poNo}),n.jsx(oe,{children:I.destinationCountry})]},I.id)}),n.jsxs("tr",{className:"border-t border-gray-400 font-bold bg-gray-50",children:[n.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Fe(j,u.localization)}),n.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Fe(E,{...u.localization,nonMonetaryDecimals:0})}),n.jsx(oe,{bold:!0,className:"text-center border-r border-gray-300",children:k}),n.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Ae(C,{...u.localization,currencySymbol:A})}),n.jsx(oe,{colSpan:3,align:"left",className:"bg-gray-100 pl-2 italic text-gray-500",children:c("total")})]})]},T.id)})},h=S.useMemo(()=>s.filter(y=>y.date.includes(String(t))),[s,e,t]),m=S.useMemo(()=>s.filter(y=>new Date(y.date).getFullYear()===t),[s,t]),x=({title:y,docs:b})=>n.jsxs("section",{className:"mb-4 flex-shrink-0",children:[n.jsx("p",{className:"text-xs mb-2 text-black font-bold uppercase border-b border-black inline-block",children:y}),n.jsxs("table",{className:"w-full border-collapse border border-gray-400 table-fixed text-[8px]",children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"12%"}}),n.jsx("col",{style:{width:"10%"}}),n.jsx("col",{style:{width:"8%"}}),n.jsx("col",{style:{width:"15%"}}),n.jsx("col",{style:{width:"15%"}}),n.jsx("col",{style:{width:"15%"}}),n.jsx("col",{style:{width:"25%"}})]}),n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("quantite_expedie")," (Kg)"]}),n.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("colis")," (",c("baleSingular"),")"]}),n.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("nombre_conteneur")," (TC)"]}),n.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("valeur_totale")}),n.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("facture_n")}),n.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("po")}),n.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("destinataire")})]})}),n.jsx("tbody",{children:f(b)})]})]});return n.jsxs(Oi,{children:[n.jsx(Li,{period:e}),n.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-purple-600 pl-2",children:[c("liste_exportations_realisees")," :"]}),n.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[n.jsx(x,{title:`${c("de_la_periode")} (${e})`,docs:h}),n.jsx(x,{title:`${c("de_annee")} (${t})`,docs:m}),n.jsx(Za,{title:c("narratif_exportations_realisees"),generator:async()=>k2({})})]}),n.jsx(Ui,{page:i,totalPages:l})]})},CO=({period:e,months:t,monthlyData:s,year:a,sites:i,seaweedTypes:l,page:c,totalPages:u})=>{const{t:f}=we(),{settings:h}=Ke();return n.jsxs(Oi,{children:[n.jsx(Li,{period:e,title:f("production_mensuelle_par_site")}),n.jsxs("div",{className:"flex-grow flex flex-col gap-2 mt-2 overflow-visible",children:[n.jsxs("table",{className:"w-full border-collapse text-[6px] flex-shrink-0 table-fixed border border-gray-400",children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"14%"}}),t.map((m,x)=>n.jsxs(gt.Fragment,{children:[n.jsx("col",{style:{width:"3.5%"}}),n.jsx("col",{style:{width:"3.6%"}})]},x))]}),n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,className:"bg-gray-200 border-gray-400"}),t.map((m,x)=>n.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 border-gray-400 border-b text-blue-900 uppercase font-bold text-[7px]",children:m},x))]}),n.jsx("tr",{children:t.map((m,x)=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0 border-r",children:"%"}),n.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0",children:"Kg"})]},`sub-h-${x}`))})]}),n.jsx("tbody",{children:i.map(m=>n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{colSpan:1+t.length*2,header:!0,align:"left",className:"bg-gray-200 py-1 px-2 uppercase font-bold border-t-2 border-gray-400",children:m.name})}),l.map(x=>{var b;const y=((b=s[m.id])==null?void 0:b[x.id])||[];return n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{className:"pl-4 font-semibold bg-gray-50 border-r border-gray-300",align:"left",children:x.name}),t.map((T,_)=>{const j=y[_],E=j&&j.growthRateCount>0?j.growthRateSum/j.growthRateCount:0;return n.jsxs(gt.Fragment,{children:[n.jsx(oe,{className:"border-r border-gray-200 text-[6px] text-center",children:E>0?`${E.toFixed(1)}`:"-"}),n.jsx(oe,{className:"border-r border-gray-300 text-[6px] text-center bg-gray-50 font-medium",children:j&&j.production>0?Fe(j.production,{...h.localization,nonMonetaryDecimals:0}):"-"})]},_)})]},x.id)})]},m.id))})]}),n.jsx(Za,{title:f("narratif_production_mensuelle"),generator:async()=>D2({})})]}),n.jsx(Ui,{page:c,totalPages:u})]})},IO=({period:e,sixMonths:t,prevMonthName:s,creditTypes:a,farmerCredits:i,repayments:l,year:c,month:u,groupedData:f,totals:h,page:m,totalPages:x})=>{const{t:y,language:b}=we(),{settings:T}=Ke(),_=t.map(k=>{const C=k.toLocaleString(b,{month:"short"}).replace(".","").toUpperCase(),A=k.getFullYear().toString().slice(-2);return`${C} ${A}`}),j=n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"20%"}}),_.map((k,C)=>n.jsxs(gt.Fragment,{children:[n.jsx("col",{style:{width:"4%"}}),n.jsx("col",{style:{width:"4%"}}),n.jsx("col",{style:{width:"5%"}})]},C))]}),E=S.useMemo(()=>{const k=U=>{const O={},F={balance:0,farmers:new Set},q=i.filter(G=>new Date(G.date)<=U),z=l.filter(G=>new Date(G.date)<=U),Y=q.reduce((G,B)=>G+B.totalAmount,0),J=z.reduce((G,B)=>G+B.amount,0);return F.balance=Y-J,a.forEach(G=>{const B=q.filter($=>$.creditTypeId===G.id),Q=B.reduce(($,ie)=>$+ie.totalAmount,0),W=Y>0?Q/Y:0,ae=J*W;O[G.id]={balance:Q-ae,farmers:new Set(B.map($=>$.farmerId)).size},B.forEach($=>F.farmers.add($.farmerId))}),{stats:O,totalStats:{balance:F.balance,farmers:F.farmers.size}}},C=new Date(c,u,0,23,59,59),A=new Date(c,u+1,0,23,59,59),M=k(C),I=k(A),P=l.filter(U=>new Date(U.date)<new Date(c,u,1)&&new Date(U.date)>=new Date(c,u-1,1)).reduce((U,O)=>U+O.amount,0),D=l.filter(U=>new Date(U.date)>=new Date(c,u,1)&&new Date(U.date)<=A).reduce((U,O)=>U+O.amount,0);return{prevMonthStats:M,currMonthStats:I,prevMonthRepayments:P,currMonthRepayments:D}},[i,l,a,c,u]);return n.jsxs(Oi,{children:[n.jsx(Li,{period:e}),n.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[n.jsxs("section",{className:"flex flex-col",children:[n.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-yellow-500 pl-2",children:[y("situation_credits")," :"]}),n.jsxs("table",{className:"w-full border-collapse flex-shrink-0 mb-2 border border-gray-400 table-fixed text-[8px]",children:[n.jsxs("colgroup",{children:[n.jsx("col",{style:{width:"25%"}}),n.jsx("col",{style:{width:"12.5%"}})," ",n.jsx("col",{style:{width:"12.5%"}})," ",n.jsx("col",{style:{width:"12.5%"}}),n.jsx("col",{style:{width:"12.5%"}})," ",n.jsx("col",{style:{width:"12.5%"}})," ",n.jsx("col",{style:{width:"12.5%"}})]}),n.jsxs("thead",{children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-100 border-gray-400"}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 text-gray-600 uppercase font-bold border-gray-400 border-b text-center",children:s}),n.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 text-blue-900 uppercase font-bold border-gray-400 border-b border-l-2 border-l-blue-300 text-center",children:e})]}),n.jsxs("tr",{children:[n.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:y("effectif_fermiers_concernes")}),n.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:y("solde_credits")}),n.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:y("total_remboursements")}),n.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px] border-l-2 border-l-blue-300",children:y("effectif_fermiers_concernes")}),n.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:y("solde_credits")}),n.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:y("total_remboursements")})]})]}),n.jsx("tbody",{children:a.map(k=>{const C=E.prevMonthStats.stats[k.id],A=E.currMonthStats.stats[k.id];return n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{header:!0,align:"left",className:"pl-2 text-gray-700 border-r border-gray-300",children:k.name}),n.jsx(oe,{className:"text-center",children:(C==null?void 0:C.farmers)||"-"}),n.jsx(oe,{className:"text-right pr-2",children:C!=null&&C.balance?Ae(C.balance,T.localization):"-"}),n.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:"-"}),n.jsx(oe,{className:"bg-blue-50 font-semibold text-center text-blue-900",children:(A==null?void 0:A.farmers)||"-"}),n.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:A!=null&&A.balance?Ae(A.balance,T.localization):"-"}),n.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:"-"})]},k.id)})}),n.jsx("tfoot",{children:n.jsxs("tr",{className:"font-bold bg-gray-100 border-t-2 border-gray-400",children:[n.jsx(oe,{header:!0,align:"left",className:"pl-2 border-r border-gray-300",children:y("total")}),n.jsx(oe,{className:"text-center",children:E.prevMonthStats.totalStats.farmers}),n.jsx(oe,{className:"text-right pr-2",children:Ae(E.prevMonthStats.totalStats.balance,T.localization)}),n.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:Ae(E.prevMonthRepayments,T.localization)}),n.jsx(oe,{className:"bg-blue-100 font-bold text-center text-blue-900",children:E.currMonthStats.totalStats.farmers}),n.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthStats.totalStats.balance,T.localization)}),n.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthRepayments,T.localization)})]})})]}),n.jsx(Za,{title:y("narratif_situation_credits"),generator:async()=>R2(E)})]}),n.jsxs("section",{className:"flex flex-col mt-4",children:[n.jsx("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-indigo-500 pl-2",children:y("statistique_individuelle_fermiers")}),n.jsx("div",{className:"border border-gray-400 overflow-hidden",children:n.jsxs("table",{className:"w-full border-collapse text-[6px] table-fixed",children:[j,n.jsxs("thead",{className:"sticky top-0 z-10",children:[n.jsxs("tr",{children:[n.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-200 align-middle text-[8px] border-b-2 border-gray-500",children:y("farmer")}),_.map((k,C)=>n.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-100 border-b border-gray-400 font-bold",children:k},C))]}),n.jsx("tr",{children:_.map((k,C)=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:y("status_PLANTED"),children:y("status_PLANTED").charAt(0)}),n.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:y("status_HARVESTED"),children:y("status_HARVESTED").charAt(0)}),n.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-400 bg-white font-normal",children:"Kg"})]},`sub-h-${C}`))})]}),n.jsx("tbody",{children:f.map(k=>n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{colSpan:1+_.length*3,header:!0,align:"left",className:"bg-blue-100 py-1 text-[8px] uppercase tracking-widest border-t-2 border-gray-500 font-bold pl-2",children:k.siteName})}),k.seaweedTypes.map(C=>n.jsxs(gt.Fragment,{children:[n.jsx("tr",{children:n.jsx(oe,{colSpan:1+_.length*3,header:!0,align:"left",className:"bg-green-50 py-0.5 pl-4 text-[7px] text-green-800 italic border-t border-gray-300 font-medium",children:C.typeName})}),C.farmers.map(A=>n.jsxs("tr",{className:"border-b border-gray-300",children:[n.jsx(oe,{align:"left",className:"align-middle truncate px-1 border-r border-gray-300 bg-white font-normal",title:A.name,children:A.name}),A.stats.map((M,I)=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-blue-600 font-semibold",children:M.planted||"-"}),n.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-red-600 font-semibold",children:M.harvested||"-"}),n.jsx(oe,{className:"font-bold border-r border-gray-300 text-right pr-1 align-middle bg-gray-50/50",children:M.production?Fe(M.production,{...T.localization,nonMonetaryDecimals:0}):"-"})]},`cell-group-${I}`))]},A.id))]},C.typeName))]},k.siteName))}),n.jsx("tfoot",{children:n.jsxs("tr",{className:"font-bold border-t-2 border-gray-500",children:[n.jsx(oe,{header:!0,className:"align-middle uppercase tracking-widest text-[8px] border-r border-gray-400",children:y("total")}),h.map((k,C)=>n.jsxs(gt.Fragment,{children:[n.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-blue-600 font-bold",children:k.planted}),n.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-red-600 font-bold",children:k.harvested}),n.jsx(oe,{header:!0,className:"font-bold border-r border-gray-400 text-right pr-1 align-middle bg-gray-100",children:Fe(k.production,{...T.localization,nonMonetaryDecimals:0})})]},`total-cell-group-${C}`))]})})]})}),n.jsx(Za,{title:y("narratif_statistique_individuelle"),generator:async()=>M2(f)})]})]}),n.jsx(Ui,{page:m,totalPages:x})]})},AO=()=>{const{t:e}=we(),{farmers:t}=He(),{settings:s}=Ke(),[a,i]=S.useState("global_farm_report"),[l,c]=S.useState(()=>new Date().getMonth()),[u,f]=S.useState(()=>new Date().getFullYear()),[h,m]=S.useState(""),[x,y]=S.useState(["production","finance","inventory"]),[b,T]=S.useState(!1),[_,j]=S.useState(!1),[E,k]=S.useState(!1),C=S.useMemo(()=>Array.from({length:10},(J,G)=>new Date().getFullYear()-5+G),[]),A=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),M=S.useMemo(()=>Array.from({length:12},(J,G)=>G),[]),I=S.useMemo(()=>[...t].sort((J,G)=>J.firstName.localeCompare(G.firstName)),[t]);S.useEffect(()=>{I.length>0&&!h&&m(I[0].id)},[I,h]);const P=()=>{T(!0)},D=()=>{window.print()},U=async()=>{k(!0);try{const J=`${a}_${u}_${l+1}`,G=e("reportsTitle");await F2(G,J)}catch(J){console.error("Excel export failed",J),alert("Export failed. See console for details.")}finally{k(!1)}},O=async()=>{j(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:J}=window.jspdf,G=window.html2canvas,B=document.getElementById("printable-area");if(!B)throw new Error("Printable area not found");const Q=["farmer_monthly","global_farm_report"].includes(a),W=Q?"l":"p",ae=new J({orientation:W,unit:"mm",format:"a4",compress:!0});ae.setProperties({title:`${a.replace(/_/g," ").toUpperCase()} - ${u}-${(l+1).toString().padStart(2,"0")}`,subject:"AlgaManage Report",author:s.company.name||"AlgaManage",creator:"AlgaManage System"});const $=B.getElementsByClassName(Q?"report-page-landscape":"print-page"),ie=$.length>0?$:B.getElementsByClassName("print-page");for(let le=0;le<ie.length;le++){const ne=ie[le],je=await G(ne,{scale:3,useCORS:!0,logging:!1,windowWidth:Q?1920:1200,windowHeight:ne.scrollHeight+50,backgroundColor:"#ffffff"}),fe=je.toDataURL("image/jpeg",.95),Z=je.width,ee=je.height,xe=ae.internal.pageSize.getWidth(),Oe=ae.internal.pageSize.getHeight(),De=xe/Z,Re=ee*De;le>0&&ae.addPage(),Re<=Oe+2,ae.addImage(fe,"JPEG",0,0,xe,Re,void 0,"FAST")}const ue=(l+1).toString().padStart(2,"0"),Ne=a.split("_").map(le=>le.charAt(0).toUpperCase()+le.slice(1)).join("_");ae.save(`${Ne}_${u}_${ue}.pdf`)}catch(J){console.error("Error generating PDF:",J),alert(e("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),j(!1)}},F=J=>{y(G=>G.includes(J)?G.filter(B=>B!==J):[...G,J]),T(!1)},q=["individual_farmer","custom","global_farm_report"].includes(a),z=["farmer_monthly"].includes(a),Y=()=>{if(!b)return n.jsx("div",{className:"text-center p-8 text-gray-500 no-print",children:e("selectFiltersAndGenerate")});switch(a){case"global_farm_report":return n.jsx(wO,{month:l,year:u});case"farmer_monthly":return n.jsx(bO,{year:u});case"individual_farmer":return n.jsx(NO,{month:l,year:u,farmerId:h});case"custom":return n.jsx(SO,{month:l,year:u,sections:x});default:return null}};return n.jsxs("div",{className:"pb-20",children:[n.jsx("h1",{className:"text-3xl font-bold mb-6",children:e("reportsTitle")}),n.jsx(Ge,{title:e("selectReportType"),className:"mb-6 no-print",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[n.jsxs(ke,{label:e("selectReportType"),value:a,onChange:J=>{i(J.target.value),T(!1)},children:[n.jsx("option",{value:"global_farm_report",children:e("globalFarmReport")}),n.jsx("option",{value:"custom",children:e("customReport")}),n.jsx("option",{value:"farmer_monthly",children:e("farmerMonthlyReport")}),n.jsx("option",{value:"individual_farmer",children:e("individualFarmerReport")})]}),q&&n.jsxs(n.Fragment,{children:[n.jsx(ke,{label:e("month"),value:l,onChange:J=>c(parseInt(J.target.value)),children:M.map(J=>n.jsx("option",{value:J,children:e(A[J])},J))}),n.jsx(ke,{label:e("year"),value:u,onChange:J=>f(parseInt(J.target.value)),children:C.map(J=>n.jsx("option",{value:J,children:J},J))})]}),z&&n.jsx(ke,{label:e("year"),value:u,onChange:J=>f(parseInt(J.target.value)),children:C.map(J=>n.jsx("option",{value:J,children:J},J))}),a==="individual_farmer"&&n.jsx(ke,{label:e("selectFarmer"),value:h,onChange:J=>m(J.target.value),children:I.map(J=>n.jsxs("option",{value:J.id,children:[J.firstName," ",J.lastName]},J.id))}),n.jsx("div",{className:q||z?"":"xl:col-start-5",children:n.jsxs(se,{onClick:P,className:"w-full h-[42px]",children:[n.jsx(te,{name:"FileText",className:"w-5 h-5"}),e("generateReport")]})})]}),a==="custom"&&n.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[n.jsx("h4",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:e("selectSections")}),n.jsxs("div",{className:"flex flex-wrap gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(_t,{checked:x.includes("production"),onChange:()=>F("production")}),n.jsx("span",{className:"text-sm",children:e("section_production")})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(_t,{checked:x.includes("finance"),onChange:()=>F("finance")}),n.jsx("span",{className:"text-sm",children:e("section_finance")})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(_t,{checked:x.includes("inventory"),onChange:()=>F("inventory")}),n.jsx("span",{className:"text-sm",children:e("section_inventory")})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(_t,{checked:x.includes("hr"),onChange:()=>F("hr")}),n.jsx("span",{className:"text-sm",children:e("section_hr")})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(_t,{checked:x.includes("incidents"),onChange:()=>F("incidents")}),n.jsx("span",{className:"text-sm",children:e("section_incidents")})]})]})]})]})}),b&&n.jsx("div",{className:"fixed bottom-6 right-6 z-50 no-print flex gap-3",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[n.jsxs(se,{variant:"secondary",onClick:U,disabled:E,className:"rounded-full !px-4 shadow-sm",children:[n.jsx(te,{name:E?"Activity":"FileSpreadsheet",className:`w-5 h-5 ${E?"animate-spin":""}`}),n.jsx("span",{className:"ml-2 hidden sm:inline",children:e("exportExcel")})]}),n.jsxs(se,{variant:"secondary",onClick:O,disabled:_,className:"rounded-full !px-4 shadow-sm",children:[n.jsx(te,{name:_?"Activity":"Download",className:`w-5 h-5 ${_?"animate-spin":""}`}),n.jsx("span",{className:"ml-2 hidden sm:inline",children:e(_?"downloading":"downloadPdf")})]}),n.jsxs(se,{variant:"primary",onClick:D,className:"rounded-full !px-4 shadow-md",children:[n.jsx(te,{name:"Printer",className:"w-5 h-5"}),n.jsx("span",{className:"ml-2 hidden sm:inline",children:e("print")})]})]})}),n.jsx("div",{id:"printable-area",className:"overflow-x-auto pb-8",children:Y()})]})},kO=({isOpen:e,onClose:t,currentUser:s,onInviteSent:a})=>{const{t:i}=we(),{roles:l,addInvitation:c,addRole:u}=He(),[f,h]=S.useState({recipient:"",channel:"EMAIL",roleId:""}),[m,x]=S.useState({}),[y,b]=S.useState("role"),[T,_]=S.useState(new Set),[j,E]=S.useState(new Set);S.useEffect(()=>{var I,P;e&&(h({recipient:"",channel:"EMAIL",roleId:((I=l.find(D=>D.isDefault))==null?void 0:I.id)||((P=l[0])==null?void 0:P.id)||""}),_(new Set),b("role"),x({}))},[e,l]);const k=S.useCallback(()=>{const I={};return f.recipient.trim()?f.channel==="EMAIL"&&!/\S+@\S+\.\S+/.test(f.recipient)?I.recipient=i("validationEmail"):f.channel==="WHATSAPP"&&!/^\+?\d{7,15}$/.test(f.recipient)&&(I.recipient=i("validationPhone")):I.recipient=i("validationRequired"),y==="role"&&!f.roleId&&(I.roleId=i("validationRequired")),y==="custom"&&T.size===0&&(I.customPermissions=i("validationSelectAtLeastOne")),I},[f,i,y,T]);S.useEffect(()=>{x(k())},[f,y,T,k]);const C=()=>{if(Object.keys(m).length>0||!s)return;let I=f.roleId;if(y==="custom"){const O=i("customRoleFor").replace("{recipient}",f.recipient),F=u({name:O,permissions:Array.from(T)});if(F)I=F.id;else return}const P=c({recipient:f.recipient,channel:f.channel,roleId:I,invitedBy:s.id,status:Yo.PENDING,expiresAt:new Date(Date.now()+10080*60*1e3).toISOString()}),U=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${P.token}`;a(U,f.channel),t()},A=I=>{E(P=>{const D=new Set(P);return D.has(I)?D.delete(I):D.add(I),D})},M=Object.keys(m).length>0;return n.jsx(ot,{isOpen:e,onClose:t,title:i("inviteUser"),widthClass:"max-w-3xl",footer:n.jsxs(n.Fragment,{children:[n.jsx(se,{variant:"secondary",onClick:t,children:i("cancel")}),n.jsx(se,{onClick:C,disabled:M,children:i("sendInvitation")})]}),children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("inviteMode")}),n.jsxs("div",{className:"flex gap-4 p-1 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[n.jsx(se,{variant:y==="role"?"primary":"ghost",onClick:()=>b("role"),className:"flex-1",children:i("selectRoleMode")}),n.jsx(se,{variant:y==="custom"?"primary":"ghost",onClick:()=>b("custom"),className:"flex-1",children:i("customPermissionsMode")})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs(ke,{label:i("channel"),value:f.channel,onChange:I=>h(P=>({...P,channel:I.target.value,recipient:""})),children:[n.jsx("option",{value:"EMAIL",children:"Email"}),n.jsx("option",{value:"WHATSAPP",children:"WhatsApp"})]}),n.jsx(de,{label:f.channel==="EMAIL"?i("email"):i("phoneNumber"),type:f.channel==="EMAIL"?"email":"tel",value:f.recipient,onChange:I=>h(P=>({...P,recipient:I.target.value})),error:m.recipient,placeholder:f.channel==="WHATSAPP"?"+261...":"name@example.com",required:!0})]}),y==="role"&&n.jsxs(ke,{label:i("role"),value:f.roleId,onChange:I=>h(P=>({...P,roleId:I.target.value})),error:m.roleId,required:!0,children:[n.jsx("option",{value:"",children:i("selectRole")}),l.map(I=>n.jsx("option",{value:I.id,children:I.name},I.id))]}),y==="custom"&&n.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto border p-2 rounded-lg dark:border-gray-600",children:[eb.map(I=>n.jsxs("div",{children:[n.jsxs("div",{onClick:()=>A(I.name),className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer",children:[n.jsx("h4",{className:"font-semibold text-sm",children:I.name}),n.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${j.has(I.name)?"rotate-180":""}`})]}),j.has(I.name)&&n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 p-2",children:I.permissions.map(P=>n.jsxs("label",{className:"flex items-center p-1 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded cursor-pointer",children:[n.jsx(_t,{checked:T.has(P.id),onChange:D=>{_(U=>{const O=new Set(U);return D.target.checked?O.add(P.id):O.delete(P.id),O})}}),n.jsx("span",{className:"ml-2 text-sm",children:P.label})]},P.id))})]},I.name)),m.customPermissions&&n.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:m.customPermissions})]})]})})},DO=()=>{const{t:e,language:t}=we(),{users:s,roles:a,invitations:i,deleteInvitation:l}=He(),{currentUser:c}=Rs(),[u,f]=S.useState(!1),[h,m]=S.useState("users"),[x,y]=S.useState(null),[b,T]=S.useState(null),_=S.useMemo(()=>new Map(a.map(A=>[A.id,A.name])),[a]),j=A=>{l(A),y(null)},E=A=>{const I=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${A.token}`;if(A.channel==="WHATSAPP"){const P=e("resendWhatsAppMessage").replace("{link}",I),D=`https://wa.me/${A.recipient.replace(/\+/g,"")}?text=${encodeURIComponent(P)}`;T({link:D,channel:"WHATSAPP"})}else T({link:I,channel:"EMAIL"})},k=i.filter(A=>A.status===Yo.PENDING&&new Date(A.expiresAt)>new Date),C=S.useMemo(()=>new Map(s.map(A=>[A.id,`${A.firstName} ${A.lastName}`])),[s]);return n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("userManagement")}),n.jsx(ld,{permission:_e.USERS_INVITE,children:n.jsxs(se,{onClick:()=>f(!0),children:[n.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),e("inviteUser")]})})]}),n.jsxs(Ge,{children:[n.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:n.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[n.jsx("button",{onClick:()=>m("users"),className:`${h==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:e("currentUsers")}),n.jsxs("button",{onClick:()=>m("invitations"),className:`${h==="invitations"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[e("pendingInvitations")," (",k.length,")"]})]})}),h==="users"&&n.jsx("div",{className:"overflow-x-auto mt-4",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3",children:e("name")}),n.jsx("th",{className:"p-3",children:e("email")}),n.jsx("th",{className:"p-3",children:e("role")})]})}),n.jsx("tbody",{children:s.map(A=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsxs("td",{className:"p-3",children:[A.firstName," ",A.lastName]}),n.jsx("td",{className:"p-3",children:A.email}),n.jsx("td",{className:"p-3",children:_.get(A.roleId)||A.roleId})]},A.id))})]})}),h==="invitations"&&n.jsx("div",{className:"overflow-x-auto mt-4",children:n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b dark:border-gray-700",children:[n.jsx("th",{className:"p-3",children:e("recipient")}),n.jsx("th",{className:"p-3",children:e("channel")}),n.jsx("th",{className:"p-3",children:e("role")}),n.jsx("th",{className:"p-3",children:e("expiresAt")}),n.jsx("th",{className:"p-3",children:e("invitedBy")}),n.jsx("th",{className:"p-3 text-right",children:e("actions")})]})}),n.jsxs("tbody",{children:[k.map(A=>n.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[n.jsx("td",{className:"p-3",children:A.recipient}),n.jsx("td",{className:"p-3",children:A.channel}),n.jsx("td",{className:"p-3",children:_.get(A.roleId)||A.roleId}),n.jsx("td",{className:"p-3",children:new Date(A.expiresAt).toLocaleDateString(t)}),n.jsx("td",{className:"p-3",children:C.get(A.invitedBy)||"N/A"}),n.jsx("td",{className:"p-3 text-right",children:n.jsx(ld,{permission:_e.USERS_INVITE,children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(se,{variant:"secondary",onClick:()=>E(A),children:e("resend")}),n.jsx(se,{variant:"danger",onClick:()=>y(A.id),children:e("revoke")})]})})})]},A.id)),k.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"text-center p-8 text-gray-500",children:e("noPendingInvitations")})})]})]})})]}),n.jsx(kO,{isOpen:u,onClose:()=>f(!1),currentUser:c,onInviteSent:(A,M)=>T({link:A,channel:M})}),x&&n.jsx(zt,{isOpen:!!x,onClose:()=>y(null),onConfirm:()=>j(x),title:e("revokeInvitation"),message:e("confirmRevokeInvitation"),confirmText:e("revoke")}),b&&n.jsxs(ot,{isOpen:!!b,onClose:()=>T(null),title:e("invitationSent"),children:[n.jsx("p",{children:b.channel==="EMAIL"?e("invitationLinkMessage"):e("invitationWhatsAppMessage")}),b.channel==="EMAIL"?n.jsx(de,{value:b.link,readOnly:!0,className:"mt-2"}):n.jsx("a",{href:b.link,target:"_blank",rel:"noopener noreferrer",children:n.jsx(se,{className:"mt-2 w-full",children:e("openWhatsApp")})})]})]})},RO=()=>{const{t:e}=we(),{currentUser:t,updateProfile:s}=Rs(),[a,i]=S.useState({firstName:"",lastName:"",email:"",phone:""}),[l,c]=S.useState(!1),[u,f]=S.useState(null);S.useEffect(()=>{t&&i({firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",phone:t.phone||""})},[t]);const h=x=>{i(y=>({...y,[x.target.name]:x.target.value}))},m=x=>{if(x.preventDefault(),!a.firstName||!a.lastName||!a.email){f({type:"error",text:e("validationRequired")});return}try{s({firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone}),f({type:"success",text:e("profileUpdatedSuccess")}),c(!1),setTimeout(()=>f(null),3e3)}catch{f({type:"error",text:"Failed to update profile"})}};return n.jsxs("div",{className:"max-w-2xl mx-auto",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold",children:e("userProfileTitle")}),!l&&n.jsxs(se,{onClick:()=>c(!0),variant:"secondary",children:[n.jsx(te,{name:"Edit2",className:"w-4 h-4"}),e("editProfile")]})]}),n.jsxs(Ge,{children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:[n.jsxs("div",{className:"w-20 h-20 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl font-bold shadow-md",children:[a.firstName.charAt(0),a.lastName.charAt(0)]}),n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-bold",children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm uppercase",children:((t==null?void 0:t.roleId)||"").replace(/_/g," ")})]})]}),u&&n.jsx("div",{className:`p-3 mb-4 rounded-md text-sm text-center ${u.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:u.text}),n.jsxs("form",{onSubmit:m,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(de,{label:e("firstName"),name:"firstName",value:a.firstName,onChange:h,disabled:!l,required:!0}),n.jsx(de,{label:e("lastName"),name:"lastName",value:a.lastName,onChange:h,disabled:!l,required:!0})]}),n.jsx(de,{label:e("email"),name:"email",type:"email",value:a.email,onChange:h,disabled:!l,required:!0}),n.jsx(de,{label:e("phoneNumber"),name:"phone",type:"tel",value:a.phone,onChange:h,disabled:!l,placeholder:"+123456789"}),l&&n.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[n.jsx(se,{type:"button",variant:"secondary",onClick:()=>{c(!1),f(null)},children:e("cancel")}),n.jsx(se,{type:"submit",children:e("saveChanges")})]})]})]})]})},MO=()=>{const{t:e,language:t}=we(),s=Ds();S.useEffect(()=>{window.scrollTo(0,0)},[]);const a=e("appName"),i="LANXIS S.a.r.l";return n.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans",children:[n.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-20 border-b border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-sm",children:a.charAt(0)}),n.jsx("span",{className:"font-bold text-lg hidden sm:block",children:a})]}),n.jsxs(se,{variant:"secondary",onClick:()=>s(-1),children:[n.jsx(te,{name:"X",className:"w-5 h-5 mr-2"}),e("close")]})]})}),n.jsx("main",{className:"max-w-5xl mx-auto px-4 py-8 md:py-12",children:n.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 md:p-12 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700",children:[n.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-8 mb-8",children:[n.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-white",children:t==="fr"?"Conditions Gnrales d'Utilisation":"Terms of Use"}),n.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t==="fr"?`diteur du service : ${i}`:`Service Provider: ${i}`}),n.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t==="fr"?`Dernire mise  jour : ${new Date().toLocaleDateString("fr-FR")}`:`Last Updated: ${new Date().toLocaleDateString("en-US")}`})]}),n.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm md:text-base leading-relaxed text-justify space-y-8",children:t==="fr"?n.jsxs(n.Fragment,{children:[n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptation des Conditions"}),n.jsxs("p",{children:["Bienvenue sur ",n.jsx("strong",{children:a}),", un logiciel dit et fourni par ",n.jsx("strong",{children:i}),". En accdant  ce logiciel, en crant un compte ou en utilisant toute partie du Service pour la gestion de vos activits agricoles, vous acceptez d'tre li par les prsentes Conditions Gnrales d'Utilisation (CGU)."]}),n.jsxs("p",{className:"mt-2",children:["Si vous n'acceptez pas ces termes, vous ne devez pas accder  l'Application ni l'utiliser. Ces conditions rgissent la relation contractuelle entre vous (l'Utilisateur ou l'Entit Agricole) et ",i,"."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description du Service"}),n.jsxs("p",{children:[i," met  disposition ",a,", un systme logiciel de gestion (ERP) conu pour l'aquaculture et la culture d'algues. Le Service fournit des outils numriques pour la gestion des sites de production, le suivi des cycles de culture, la gestion des stocks, le suivi des ressources humaines et la gestion financire."]}),n.jsxs("p",{className:"mt-2",children:[`L'Application est fournie "telle quelle". `,i," se rserve le droit de modifier, suspendre ou interrompre tout aspect du Service (mises  jour, nouvelles fonctionnalits)  tout moment pour amliorer l'exprience utilisateur ou pour des raisons techniques."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Comptes et Scurit"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Identifiants :"})," Vous tes responsable de la confidentialit de vos identifiants de connexion. Toute action effectue via votre compte est rpute avoir t effectue par vous ou votre organisation."]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Exactitude :"})," Vous vous engagez  fournir des informations exactes concernant votre entit agricole (nom, identifiants fiscaux) dans les paramtres de l'Application."]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Scurit :"})," Vous devez informer ",i," immdiatement de toute violation de scurit ou utilisation non autorise de votre compte."]})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. Licence d'Utilisation et Proprit Intellectuelle"}),n.jsxs("p",{children:[i," vous accorde une licence limite, non exclusive, non transfrable et rvocable pour utiliser ",a," uniquement pour vos besoins internes de gestion agricole."]}),n.jsxs("p",{className:"mt-2",children:["Tous les droits de proprit intellectuelle relatifs au logiciel, y compris le code source, les bases de donnes, les algorithmes et l'interface utilisateur, demeurent la proprit exclusive de ",n.jsx("strong",{children:i}),"."]}),n.jsx("p",{className:"mt-2",children:"Vous ne pouvez pas :"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[n.jsxs("li",{children:["Revendre, sous-licencier ou distribuer l'Application  des tiers sans accord crit de ",i,"."]}),n.jsx("li",{children:"Copier, modifier ou crer des uvres drives bases sur le logiciel."}),n.jsx("li",{children:"Tenter de dcompiler ou d'extraire le code source de l'Application."})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Proprit des Donnes"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Vos Donnes :"})," Vous conservez tous les droits, titres et intrts sur les donnes que vous saisissez dans ",a," (donnes de rcolte, informations sur vos fermiers, donnes financires, etc.)."]}),n.jsxs("p",{className:"mt-2",children:[n.jsx("strong",{children:"Usage :"})," En utilisant le Service, vous accordez  ",i," le droit d'hberger, de traiter et d'afficher vos donnes uniquement dans le but de vous fournir le Service (par exemple, pour gnrer vos rapports ou vos tableaux de bord). ",i," s'engage  ne pas vendre vos donnes agricoles  des tiers."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation de Responsabilit"}),n.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[n.jsx("p",{className:"font-semibold mb-2",children:"Avertissement sur les prdictions :"}),n.jsxs("p",{children:[a," inclut des outils d'analyse et de prdiction (via IA ou algorithmes) concernant les rcoltes, la mto ou les risques biologiques. Ces informations sont fournies  titre indicatif uniquement pour aider  la prise de dcision.",i," ne garantit pas l'exactitude de ces prdictions et ne saurait tre tenu responsable des pertes de rcoltes, des pertes financires ou des dcisions agricoles prises sur la base de ces donnes."]})]}),n.jsxs("p",{className:"mt-4",children:["Dans toute la mesure permise par la loi, ",i," ne sera pas responsable des dommages indirects, incidents ou conscutifs rsultant de votre utilisation du Service."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Rsiliation"}),n.jsxs("p",{children:[i," peut suspendre ou rsilier votre accs au Service immdiatement, sans pravis ni responsabilit, en cas de violation des prsentes Conditions."]}),n.jsx("p",{className:"mt-2",children:"Vous pouvez cesser d'utiliser l'Application  tout moment. Sur demande, vos donnes peuvent tre supprimes de nos serveurs, sous rserve des obligations lgales de conservation."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Droit Applicable"}),n.jsxs("p",{children:["Tout litige relatif  l'interprtation ou  l'excution des prsentes conditions sera soumis  la comptence exclusive des tribunaux du lieu du sige social de ",i,"."]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptance of Terms"}),n.jsxs("p",{children:["Welcome to ",n.jsx("strong",{children:a}),", a software provided and published by ",n.jsx("strong",{children:i}),". By accessing this software, creating an account, or using any part of the Service for managing your agricultural activities, you agree to be bound by these Terms of Use."]}),n.jsxs("p",{className:"mt-2",children:["If you do not agree to these terms, you must not access or use the Application. These terms govern the contractual relationship between you (the User or Agricultural Entity) and ",i,"."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description of Service"}),n.jsxs("p",{children:[i," provides ",a,", an ERP (Enterprise Resource Planning) management system designed for aquaculture and seaweed farming. The Service provides digital tools for production site management, cultivation cycle tracking, inventory management, human resources tracking, and financial management."]}),n.jsxs("p",{className:"mt-2",children:['The Application is provided "as is". ',i," reserves the right to modify, suspend, or discontinue any aspect of the Service (updates, new features) at any time to improve user experience or for technical reasons."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Accounts and Security"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Credentials:"})," You are responsible for the confidentiality of your login credentials. Any action performed via your account is deemed to have been performed by you or your organization."]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Accuracy:"})," You agree to provide accurate information regarding your agricultural entity (name, tax IDs) within the Application settings."]}),n.jsxs("li",{children:[n.jsx("strong",{children:"Security:"})," You must notify ",i," immediately of any security breach or unauthorized use of your account."]})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. License to Use and Intellectual Property"}),n.jsxs("p",{children:[i," grants you a limited, non-exclusive, non-transferable, and revocable license to use ",a," solely for your internal agricultural management needs."]}),n.jsxs("p",{className:"mt-2",children:["All intellectual property rights related to the software, including source code, databases, algorithms, and the user interface, remain the exclusive property of ",n.jsx("strong",{children:i}),"."]}),n.jsx("p",{className:"mt-2",children:"You may not:"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[n.jsxs("li",{children:["Resell, sublicense, or distribute the Application to third parties without written consent from ",i,"."]}),n.jsx("li",{children:"Copy, modify, or create derivative works based on the software."}),n.jsx("li",{children:"Attempt to decompile or extract the source code of the Application."})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Data Ownership"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Your Data:"})," You retain all rights, title, and interest in the data you enter into ",a," (harvest data, farmer information, financial records, etc.)."]}),n.jsxs("p",{className:"mt-2",children:[n.jsx("strong",{children:"Usage:"})," By using the Service, you grant ",i," the right to host, process, and display your data solely for the purpose of providing the Service to you (e.g., generating your reports or dashboards). ",i," commits not to sell your agricultural data to third parties."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation of Liability"}),n.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[n.jsx("p",{className:"font-semibold mb-2",children:"Disclaimer regarding predictions:"}),n.jsxs("p",{children:[a," includes analysis and prediction tools (via AI or algorithms) regarding harvests, weather, or biological risks. This information is provided for indicative purposes only to assist in decision-making.",i," does not guarantee the accuracy of these predictions and shall not be held liable for crop losses, financial losses, or agricultural decisions made based on this data."]})]}),n.jsxs("p",{className:"mt-4",children:["To the fullest extent permitted by law, ",i," shall not be liable for any indirect, incidental, or consequential damages arising from your use of the Service."]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Termination"}),n.jsxs("p",{children:[i," may suspend or terminate your access to the Service immediately, without prior notice or liability, in the event of a breach of these Terms."]}),n.jsx("p",{className:"mt-2",children:"You may stop using the Application at any time. Upon request, your data can be deleted from our servers, subject to legal retention obligations."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Governing Law"}),n.jsxs("p",{children:["Any dispute relating to the interpretation or execution of these terms shall be subject to the exclusive jurisdiction of the courts where ",i," is registered."]})]})]})})]})})]})},PO=()=>n.jsx(vi,{children:n.jsx(Nj,{children:n.jsx(Ej,{children:n.jsx(oC,{children:n.jsx(lC,{children:n.jsx(dC,{children:n.jsx(OO,{})})})})})})}),OO=()=>n.jsx(lj,{children:n.jsxs(LT,{children:[n.jsx(nt,{path:"/login",element:n.jsx(xC,{})}),n.jsx(nt,{path:"/signup",element:n.jsx(NC,{})}),n.jsx(nt,{path:"/forgot-password",element:n.jsx(SC,{})}),n.jsx(nt,{path:"/reset-password",element:n.jsx(wC,{})}),n.jsx(nt,{path:"/terms",element:n.jsx(MO,{})}),n.jsxs(nt,{element:n.jsx(yC,{}),children:[n.jsxs(nt,{element:n.jsx(ha,{permission:_e.DASHBOARD_VIEW}),children:[n.jsx(nt,{path:"/",element:n.jsx(Ho,{to:"/dashboard",replace:!0})}),n.jsx(nt,{path:"/dashboard",element:n.jsx(AC,{})})]}),n.jsx(nt,{element:n.jsx(ha,{}),children:n.jsx(nt,{path:"/profile",element:n.jsx(RO,{})})}),n.jsxs(nt,{element:n.jsx(ha,{permission:_e.SETTINGS_VIEW}),children:[n.jsx(nt,{path:"/settings",element:n.jsx(Ho,{to:"/settings/general"})}),n.jsx(nt,{path:"/settings/general",element:n.jsx(kC,{})}),n.jsx(nt,{path:"/settings/users",element:n.jsx(DO,{})}),n.jsx(nt,{path:"/settings/roles",element:n.jsx(oO,{})}),n.jsx(nt,{path:"/settings/incident-types",element:n.jsx(OP,{})}),n.jsx(nt,{path:"/settings/incident-severities",element:n.jsx(UP,{})})]}),n.jsxs(nt,{element:n.jsx(ha,{permission:_e.OPERATIONS_VIEW}),children:[n.jsx(nt,{path:"/sites",element:n.jsx(vi,{children:n.jsx(PC,{})})}),n.jsx(nt,{path:"/sites/:siteId/cultivation",element:n.jsx(vi,{children:n.jsx(fO,{})})}),n.jsx(nt,{path:"/seaweed-types",element:n.jsx(vi,{children:n.jsx(HC,{})})}),n.jsx(nt,{path:"/seaweed-types/:typeId/cultivation",element:n.jsx(vi,{children:n.jsx(mO,{})})}),n.jsx(nt,{path:"/modules",element:n.jsx(vi,{children:n.jsx(KC,{})})}),n.jsx(nt,{path:"/operations/cutting",element:n.jsx(EP,{})}),n.jsx(nt,{path:"/operations/map",element:n.jsx(rO,{})}),n.jsx(nt,{path:"/operations/calendar",element:n.jsx(vO,{})}),n.jsx(nt,{path:"/cultivation",element:n.jsx($2,{})}),n.jsx(nt,{path:"/harvesting",element:n.jsx(H2,{})}),n.jsx(nt,{path:"/drying",element:n.jsx(q2,{})}),n.jsx(nt,{path:"/bagging",element:n.jsx(K2,{})})]}),n.jsxs(nt,{element:n.jsx(ha,{permission:_e.INVENTORY_VIEW}),children:[n.jsx(nt,{path:"/inventory/on-site-storage",element:n.jsx(eP,{})}),n.jsx(nt,{path:"/inventory/farmer-deliveries",element:n.jsx(_P,{})}),n.jsx(nt,{path:"/inventory/site-transfers",element:n.jsx(RP,{})}),n.jsx(nt,{path:"/inventory/pressed-warehouse",element:n.jsx(pP,{})}),n.jsx(nt,{path:"/exports",element:n.jsx(NP,{})})]}),n.jsxs(nt,{element:n.jsx(ha,{permission:_e.STAKEHOLDERS_VIEW}),children:[n.jsx(nt,{path:"/farmers",element:n.jsx(aP,{})}),n.jsx(nt,{path:"/employees",element:n.jsx(cP,{})}),n.jsx(nt,{path:"/providers",element:n.jsx(SP,{})}),n.jsx(nt,{path:"/farmer-credits",element:n.jsx(UC,{})}),n.jsx(nt,{path:"/document-payments",element:n.jsx(tO,{})}),n.jsx(nt,{path:"/payroll-calculator",element:n.jsx(hO,{})})]}),n.jsxs(nt,{element:n.jsx(ha,{permission:_e.MONITORING_VIEW}),children:[n.jsx(nt,{path:"/monitoring/incidents",element:n.jsx(MP,{})}),n.jsx(nt,{path:"/monitoring/tests",element:n.jsx(sO,{})})]}),n.jsx(nt,{element:n.jsx(ha,{permission:_e.REPORTS_VIEW}),children:n.jsx(nt,{path:"/reports",element:n.jsx(AO,{})})}),n.jsx(nt,{element:n.jsx(ha,{}),children:n.jsx(nt,{path:"/manual",element:n.jsx(gO,{})})})]}),n.jsx(nt,{path:"*",element:n.jsx(Ho,{to:"/login",replace:!0})})]})}),_N=document.getElementById("root");if(!_N)throw new Error("Could not find root element to mount to");const LO=Uw.createRoot(_N);LO.render(n.jsx(gt.StrictMode,{children:n.jsx(PO,{})}));export{FO as g,UO as h,pi as s};
