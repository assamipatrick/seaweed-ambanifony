(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();function pg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var qm={exports:{}},$l={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mb;function Cj(){if(mb)return $l;mb=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,l){var c=null;if(l!==void 0&&(c=""+l),i.key!==void 0&&(c=""+i.key),"key"in i){l={};for(var d in i)d!=="key"&&(l[d]=i[d])}else l=i;return i=l.ref,{$$typeof:t,type:r,key:c,ref:i!==void 0?i:null,props:l}}return $l.Fragment=e,$l.jsx=n,$l.jsxs=n,$l}var pb;function Ej(){return pb||(pb=1,qm.exports=Cj()),qm.exports}var s=Ej(),Wm={exports:{}},ct={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gb;function Ij(){if(gb)return ct;gb=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),g=Symbol.iterator;function N(H){return H===null||typeof H!="object"?null:(H=g&&H[g]||H["@@iterator"],typeof H=="function"?H:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,w={};function E(H,ae,ue){this.props=H,this.context=ae,this.refs=w,this.updater=ue||T}E.prototype.isReactComponent={},E.prototype.setState=function(H,ae){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,ae,"setState")},E.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function D(){}D.prototype=E.prototype;function I(H,ae,ue){this.props=H,this.context=ae,this.refs=w,this.updater=ue||T}var k=I.prototype=new D;k.constructor=I,C(k,E.prototype),k.isPureReactComponent=!0;var M=Array.isArray;function j(){}var O={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function F(H,ae,ue){var Ne=ue.ref;return{$$typeof:t,type:H,key:ae,ref:Ne!==void 0?Ne:null,props:ue}}function P(H,ae){return F(H.type,ae,H.props)}function U(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function q(H){var ae={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(ue){return ae[ue]})}var z=/\/+/g;function J(H,ae){return typeof H=="object"&&H!==null&&H.key!=null?q(""+H.key):ae.toString(36)}function Y(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(j,j):(H.status="pending",H.then(function(ae){H.status==="pending"&&(H.status="fulfilled",H.value=ae)},function(ae){H.status==="pending"&&(H.status="rejected",H.reason=ae)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function G(H,ae,ue,Ne,le){var ne=typeof H;(ne==="undefined"||ne==="boolean")&&(H=null);var Te=!1;if(H===null)Te=!0;else switch(ne){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(H.$$typeof){case t:case e:Te=!0;break;case m:return Te=H._init,G(Te(H._payload),ae,ue,Ne,le)}}if(Te)return le=le(H),Te=Ne===""?"."+J(H,0):Ne,M(le)?(ue="",Te!=null&&(ue=Te.replace(z,"$&/")+"/"),G(le,ae,ue,"",function(ee){return ee})):le!=null&&(U(le)&&(le=P(le,ue+(le.key==null||H&&H.key===le.key?"":(""+le.key).replace(z,"$&/")+"/")+Te)),ae.push(le)),1;Te=0;var fe=Ne===""?".":Ne+":";if(M(H))for(var Z=0;Z<H.length;Z++)Ne=H[Z],ne=fe+J(Ne,Z),Te+=G(Ne,ae,ue,ne,le);else if(Z=N(H),typeof Z=="function")for(H=Z.call(H),Z=0;!(Ne=H.next()).done;)Ne=Ne.value,ne=fe+J(Ne,Z++),Te+=G(Ne,ae,ue,ne,le);else if(ne==="object"){if(typeof H.then=="function")return G(Y(H),ae,ue,Ne,le);throw ae=String(H),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.")}return Te}function B(H,ae,ue){if(H==null)return H;var Ne=[],le=0;return G(H,Ne,"","",function(ne){return ae.call(ue,ne,le++)}),Ne}function Q(H){if(H._status===-1){var ae=H._result;ae=ae(),ae.then(function(ue){(H._status===0||H._status===-1)&&(H._status=1,H._result=ue)},function(ue){(H._status===0||H._status===-1)&&(H._status=2,H._result=ue)}),H._status===-1&&(H._status=0,H._result=ae)}if(H._status===1)return H._result.default;throw H._result}var K=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ae=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(ae))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)},re={map:B,forEach:function(H,ae,ue){B(H,function(){ae.apply(this,arguments)},ue)},count:function(H){var ae=0;return B(H,function(){ae++}),ae},toArray:function(H){return B(H,function(ae){return ae})||[]},only:function(H){if(!U(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return ct.Activity=x,ct.Children=re,ct.Component=E,ct.Fragment=n,ct.Profiler=i,ct.PureComponent=I,ct.StrictMode=r,ct.Suspense=f,ct.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,ct.__COMPILER_RUNTIME={__proto__:null,c:function(H){return O.H.useMemoCache(H)}},ct.cache=function(H){return function(){return H.apply(null,arguments)}},ct.cacheSignal=function(){return null},ct.cloneElement=function(H,ae,ue){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var Ne=C({},H.props),le=H.key;if(ae!=null)for(ne in ae.key!==void 0&&(le=""+ae.key),ae)!A.call(ae,ne)||ne==="key"||ne==="__self"||ne==="__source"||ne==="ref"&&ae.ref===void 0||(Ne[ne]=ae[ne]);var ne=arguments.length-2;if(ne===1)Ne.children=ue;else if(1<ne){for(var Te=Array(ne),fe=0;fe<ne;fe++)Te[fe]=arguments[fe+2];Ne.children=Te}return F(H.type,le,Ne)},ct.createContext=function(H){return H={$$typeof:c,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:l,_context:H},H},ct.createElement=function(H,ae,ue){var Ne,le={},ne=null;if(ae!=null)for(Ne in ae.key!==void 0&&(ne=""+ae.key),ae)A.call(ae,Ne)&&Ne!=="key"&&Ne!=="__self"&&Ne!=="__source"&&(le[Ne]=ae[Ne]);var Te=arguments.length-2;if(Te===1)le.children=ue;else if(1<Te){for(var fe=Array(Te),Z=0;Z<Te;Z++)fe[Z]=arguments[Z+2];le.children=fe}if(H&&H.defaultProps)for(Ne in Te=H.defaultProps,Te)le[Ne]===void 0&&(le[Ne]=Te[Ne]);return F(H,ne,le)},ct.createRef=function(){return{current:null}},ct.forwardRef=function(H){return{$$typeof:d,render:H}},ct.isValidElement=U,ct.lazy=function(H){return{$$typeof:m,_payload:{_status:-1,_result:H},_init:Q}},ct.memo=function(H,ae){return{$$typeof:h,type:H,compare:ae===void 0?null:ae}},ct.startTransition=function(H){var ae=O.T,ue={};O.T=ue;try{var Ne=H(),le=O.S;le!==null&&le(ue,Ne),typeof Ne=="object"&&Ne!==null&&typeof Ne.then=="function"&&Ne.then(j,K)}catch(ne){K(ne)}finally{ae!==null&&ue.types!==null&&(ae.types=ue.types),O.T=ae}},ct.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},ct.use=function(H){return O.H.use(H)},ct.useActionState=function(H,ae,ue){return O.H.useActionState(H,ae,ue)},ct.useCallback=function(H,ae){return O.H.useCallback(H,ae)},ct.useContext=function(H){return O.H.useContext(H)},ct.useDebugValue=function(){},ct.useDeferredValue=function(H,ae){return O.H.useDeferredValue(H,ae)},ct.useEffect=function(H,ae){return O.H.useEffect(H,ae)},ct.useEffectEvent=function(H){return O.H.useEffectEvent(H)},ct.useId=function(){return O.H.useId()},ct.useImperativeHandle=function(H,ae,ue){return O.H.useImperativeHandle(H,ae,ue)},ct.useInsertionEffect=function(H,ae){return O.H.useInsertionEffect(H,ae)},ct.useLayoutEffect=function(H,ae){return O.H.useLayoutEffect(H,ae)},ct.useMemo=function(H,ae){return O.H.useMemo(H,ae)},ct.useOptimistic=function(H,ae){return O.H.useOptimistic(H,ae)},ct.useReducer=function(H,ae,ue){return O.H.useReducer(H,ae,ue)},ct.useRef=function(H){return O.H.useRef(H)},ct.useState=function(H){return O.H.useState(H)},ct.useSyncExternalStore=function(H,ae,ue){return O.H.useSyncExternalStore(H,ae,ue)},ct.useTransition=function(){return O.H.useTransition()},ct.version="19.2.4",ct}var yb;function gg(){return yb||(yb=1,Wm.exports=Ij()),Wm.exports}var S=gg();const gt=pg(S);var $m={exports:{}},Kl={},Km={exports:{}},Ym={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xb;function jj(){return xb||(xb=1,(function(t){function e(G,B){var Q=G.length;G.push(B);e:for(;0<Q;){var K=Q-1>>>1,re=G[K];if(0<i(re,B))G[K]=B,G[Q]=re,Q=K;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var B=G[0],Q=G.pop();if(Q!==B){G[0]=Q;e:for(var K=0,re=G.length,H=re>>>1;K<H;){var ae=2*(K+1)-1,ue=G[ae],Ne=ae+1,le=G[Ne];if(0>i(ue,Q))Ne<re&&0>i(le,ue)?(G[K]=le,G[Ne]=Q,K=Ne):(G[K]=ue,G[ae]=Q,K=ae);else if(Ne<re&&0>i(le,Q))G[K]=le,G[Ne]=Q,K=Ne;else break e}}return B}function i(G,B){var Q=G.sortIndex-B.sortIndex;return Q!==0?Q:G.id-B.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,d=c.now();t.unstable_now=function(){return c.now()-d}}var f=[],h=[],m=1,x=null,g=3,N=!1,T=!1,C=!1,w=!1,E=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function k(G){for(var B=n(h);B!==null;){if(B.callback===null)r(h);else if(B.startTime<=G)r(h),B.sortIndex=B.expirationTime,e(f,B);else break;B=n(h)}}function M(G){if(C=!1,k(G),!T)if(n(f)!==null)T=!0,j||(j=!0,q());else{var B=n(h);B!==null&&Y(M,B.startTime-G)}}var j=!1,O=-1,A=5,F=-1;function P(){return w?!0:!(t.unstable_now()-F<A)}function U(){if(w=!1,j){var G=t.unstable_now();F=G;var B=!0;try{e:{T=!1,C&&(C=!1,D(O),O=-1),N=!0;var Q=g;try{t:{for(k(G),x=n(f);x!==null&&!(x.expirationTime>G&&P());){var K=x.callback;if(typeof K=="function"){x.callback=null,g=x.priorityLevel;var re=K(x.expirationTime<=G);if(G=t.unstable_now(),typeof re=="function"){x.callback=re,k(G),B=!0;break t}x===n(f)&&r(f),k(G)}else r(f);x=n(f)}if(x!==null)B=!0;else{var H=n(h);H!==null&&Y(M,H.startTime-G),B=!1}}break e}finally{x=null,g=Q,N=!1}B=void 0}}finally{B?q():j=!1}}}var q;if(typeof I=="function")q=function(){I(U)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,J=z.port2;z.port1.onmessage=U,q=function(){J.postMessage(null)}}else q=function(){E(U,0)};function Y(G,B){O=E(function(){G(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_next=function(G){switch(g){case 1:case 2:case 3:var B=3;break;default:B=g}var Q=g;g=B;try{return G()}finally{g=Q}},t.unstable_requestPaint=function(){w=!0},t.unstable_runWithPriority=function(G,B){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Q=g;g=G;try{return B()}finally{g=Q}},t.unstable_scheduleCallback=function(G,B,Q){var K=t.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?K+Q:K):Q=K,G){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=Q+re,G={id:m++,callback:B,priorityLevel:G,startTime:Q,expirationTime:re,sortIndex:-1},Q>K?(G.sortIndex=Q,e(h,G),n(f)===null&&G===n(h)&&(C?(D(O),O=-1):C=!0,Y(M,Q-K))):(G.sortIndex=re,e(f,G),T||N||(T=!0,j||(j=!0,q()))),G},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(G){var B=g;return function(){var Q=g;g=B;try{return G.apply(this,arguments)}finally{g=Q}}}})(Ym)),Ym}var vb;function Aj(){return vb||(vb=1,Km.exports=jj()),Km.exports}var Jm={exports:{}},$n={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bb;function kj(){if(bb)return $n;bb=1;var t=gg();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(f,h,m){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:x==null?null:""+x,children:f,containerInfo:h,implementation:m}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return $n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,$n.createPortal=function(f,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return l(f,h,null,m)},$n.flushSync=function(f){var h=c.T,m=r.p;try{if(c.T=null,r.p=2,f)return f()}finally{c.T=h,r.p=m,r.d.f()}},$n.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(f,h))},$n.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},$n.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var m=h.as,x=d(m,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,N=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;m==="style"?r.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:x,integrity:g,fetchPriority:N}):m==="script"&&r.d.X(f,{crossOrigin:x,integrity:g,fetchPriority:N,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},$n.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var m=d(h.as,h.crossOrigin);r.d.M(f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(f)},$n.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var m=h.as,x=d(m,h.crossOrigin);r.d.L(f,m,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},$n.preloadModule=function(f,h){if(typeof f=="string")if(h){var m=d(h.as,h.crossOrigin);r.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(f)},$n.requestFormReset=function(f){r.d.r(f)},$n.unstable_batchedUpdates=function(f,h){return f(h)},$n.useFormState=function(f,h,m){return c.H.useFormState(f,h,m)},$n.useFormStatus=function(){return c.H.useHostTransitionStatus()},$n.version="19.2.4",$n}var Nb;function F_(){if(Nb)return Jm.exports;Nb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Jm.exports=kj(),Jm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sb;function Dj(){if(Sb)return Kl;Sb=1;var t=Aj(),e=gg(),n=F_();function r(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function l(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function c(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function d(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function f(a){if(l(a)!==a)throw Error(r(188))}function h(a){var o=a.alternate;if(!o){if(o=l(a),o===null)throw Error(r(188));return o!==a?null:a}for(var u=a,p=o;;){var b=u.return;if(b===null)break;var _=b.alternate;if(_===null){if(p=b.return,p!==null){u=p;continue}break}if(b.child===_.child){for(_=b.child;_;){if(_===u)return f(b),a;if(_===p)return f(b),o;_=_.sibling}throw Error(r(188))}if(u.return!==p.return)u=b,p=_;else{for(var R=!1,$=b.child;$;){if($===u){R=!0,u=b,p=_;break}if($===p){R=!0,p=b,u=_;break}$=$.sibling}if(!R){for($=_.child;$;){if($===u){R=!0,u=_,p=b;break}if($===p){R=!0,p=_,u=b;break}$=$.sibling}if(!R)throw Error(r(189))}}if(u.alternate!==p)throw Error(r(190))}if(u.tag!==3)throw Error(r(188));return u.stateNode.current===u?a:o}function m(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=m(a),o!==null)return o;a=a.sibling}return null}var x=Object.assign,g=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),I=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function q(a){return a===null||typeof a!="object"?null:(a=U&&a[U]||a["@@iterator"],typeof a=="function"?a:null)}var z=Symbol.for("react.client.reference");function J(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case C:return"Fragment";case E:return"Profiler";case w:return"StrictMode";case M:return"Suspense";case j:return"SuspenseList";case F:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case T:return"Portal";case I:return a.displayName||"Context";case D:return(a._context.displayName||"Context")+".Consumer";case k:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case O:return o=a.displayName||null,o!==null?o:J(a.type)||"Memo";case A:o=a._payload,a=a._init;try{return J(a(o))}catch{}}return null}var Y=Array.isArray,G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},K=[],re=-1;function H(a){return{current:a}}function ae(a){0>re||(a.current=K[re],K[re]=null,re--)}function ue(a,o){re++,K[re]=a.current,a.current=o}var Ne=H(null),le=H(null),ne=H(null),Te=H(null);function fe(a,o){switch(ue(ne,o),ue(le,a),ue(Ne,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Lv(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Lv(o),a=Fv(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ae(Ne),ue(Ne,a)}function Z(){ae(Ne),ae(le),ae(ne)}function ee(a){a.memoizedState!==null&&ue(Te,a);var o=Ne.current,u=Fv(o,a.type);o!==u&&(ue(le,a),ue(Ne,u))}function xe(a){le.current===a&&(ae(Ne),ae(le)),Te.current===a&&(ae(Te),Hl._currentValue=Q)}var Oe,De;function Re(a){if(Oe===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Oe=o&&o[1]||"",De=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Oe+a+De}var $e=!1;function He(a,o){if(!a||$e)return"";$e=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var je=function(){throw Error()};if(Object.defineProperty(je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(je,[])}catch(we){var ve=we}Reflect.construct(a,[],je)}else{try{je.call()}catch(we){ve=we}a.call(je.prototype)}}else{try{throw Error()}catch(we){ve=we}(je=a())&&typeof je.catch=="function"&&je.catch(function(){})}}catch(we){if(we&&ve&&typeof we.stack=="string")return[we.stack,ve.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=p.DetermineComponentFrameRoot(),R=_[0],$=_[1];if(R&&$){var ie=R.split(`
`),ge=$.split(`
`);for(b=p=0;p<ie.length&&!ie[p].includes("DetermineComponentFrameRoot");)p++;for(;b<ge.length&&!ge[b].includes("DetermineComponentFrameRoot");)b++;if(p===ie.length||b===ge.length)for(p=ie.length-1,b=ge.length-1;1<=p&&0<=b&&ie[p]!==ge[b];)b--;for(;1<=p&&0<=b;p--,b--)if(ie[p]!==ge[b]){if(p!==1||b!==1)do if(p--,b--,0>b||ie[p]!==ge[b]){var Ee=`
`+ie[p].replace(" at new "," at ");return a.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",a.displayName)),Ee}while(1<=p&&0<=b);break}}}finally{$e=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Re(u):""}function Se(a,o){switch(a.tag){case 26:case 27:case 5:return Re(a.type);case 16:return Re("Lazy");case 13:return a.child!==o&&o!==null?Re("Suspense Fallback"):Re("Suspense");case 19:return Re("SuspenseList");case 0:case 15:return He(a.type,!1);case 11:return He(a.type.render,!1);case 1:return He(a.type,!0);case 31:return Re("Activity");default:return""}}function Le(a){try{var o="",u=null;do o+=Se(a,u),u=a,a=a.return;while(a);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var be=Object.prototype.hasOwnProperty,ye=t.unstable_scheduleCallback,Fe=t.unstable_cancelCallback,et=t.unstable_shouldYield,Lt=t.unstable_requestPaint,ut=t.unstable_now,$t=t.unstable_getCurrentPriorityLevel,Pt=t.unstable_ImmediatePriority,St=t.unstable_UserBlockingPriority,on=t.unstable_NormalPriority,tr=t.unstable_LowPriority,gr=t.unstable_IdlePriority,Da=t.log,Ge=t.unstable_setDisableYieldValue,Je=null,Ve=null;function jt(a){if(typeof Da=="function"&&Ge(a),Ve&&typeof Ve.setStrictMode=="function")try{Ve.setStrictMode(Je,a)}catch{}}var rt=Math.clz32?Math.clz32:Fn,Ft=Math.log,Ln=Math.LN2;function Fn(a){return a>>>=0,a===0?32:31-(Ft(a)/Ln|0)|0}var Tn=256,nr=262144,ln=4194304;function Ts(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function ni(a,o,u){var p=a.pendingLanes;if(p===0)return 0;var b=0,_=a.suspendedLanes,R=a.pingedLanes;a=a.warmLanes;var $=p&134217727;return $!==0?(p=$&~_,p!==0?b=Ts(p):(R&=$,R!==0?b=Ts(R):u||(u=$&~a,u!==0&&(b=Ts(u))))):($=p&~_,$!==0?b=Ts($):R!==0?b=Ts(R):u||(u=p&~a,u!==0&&(b=Ts(u)))),b===0?0:o!==0&&o!==b&&(o&_)===0&&(_=b&-b,u=o&-o,_>=u||_===32&&(u&4194048)!==0)?o:b}function sr(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function Mh(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hc(){var a=ln;return ln<<=1,(ln&62914560)===0&&(ln=4194304),a}function Qo(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Ji(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ph(a,o,u,p,b,_){var R=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var $=a.entanglements,ie=a.expirationTimes,ge=a.hiddenUpdates;for(u=R&~u;0<u;){var Ee=31-rt(u),je=1<<Ee;$[Ee]=0,ie[Ee]=-1;var ve=ge[Ee];if(ve!==null)for(ge[Ee]=null,Ee=0;Ee<ve.length;Ee++){var we=ve[Ee];we!==null&&(we.lane&=-536870913)}u&=~je}p!==0&&Vc(a,p,0),_!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=_&~(R&~o))}function Vc(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var p=31-rt(o);a.entangledLanes|=o,a.entanglements[p]=a.entanglements[p]|1073741824|u&261930}function qc(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var p=31-rt(u),b=1<<p;b&o|a[p]&o&&(a[p]|=o),u&=~b}}function Wc(a,o){var u=o&-o;return u=(u&42)!==0?1:Zo(u),(u&(a.suspendedLanes|o))!==0?0:u}function Zo(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function el(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function $c(){var a=B.p;return a!==0?a:(a=window.event,a===void 0?32:ob(a.type))}function Kc(a,o){var u=B.p;try{return B.p=a,o()}finally{B.p=u}}var rr=Math.random().toString(36).slice(2),xn="__reactFiber$"+rr,Un="__reactProps$"+rr,yr="__reactContainer$"+rr,tl="__reactEvents$"+rr,Oh="__reactListeners$"+rr,xr="__reactHandles$"+rr,nl="__reactResources$"+rr,Ra="__reactMarker$"+rr;function Yc(a){delete a[xn],delete a[Un],delete a[tl],delete a[Oh],delete a[xr]}function Xi(a){var o=a[xn];if(o)return o;for(var u=a.parentNode;u;){if(o=u[yr]||u[xn]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=qv(a);a!==null;){if(u=a[xn])return u;a=qv(a)}return o}a=u,u=a.parentNode}return null}function Qi(a){if(a=a[xn]||a[yr]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Ma(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(r(33))}function Zi(a){var o=a[nl];return o||(o=a[nl]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Cn(a){a[Ra]=!0}var Lh=new Set,Fh={};function si(a,o){ea(a,o),ea(a+"Capture",o)}function ea(a,o){for(Fh[a]=o,a=0;a<o.length;a++)Lh.add(o[a])}var My=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Uh={},Bh={};function Py(a){return be.call(Bh,a)?!0:be.call(Uh,a)?!1:My.test(a)?Bh[a]=!0:(Uh[a]=!0,!1)}function sl(a,o,u){if(Py(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function rl(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function ir(a,o,u,p){if(p===null)a.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+p)}}function us(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Gh(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Oy(a,o,u){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,_=p.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return b.call(this)},set:function(R){u=""+R,_.call(this,R)}}),Object.defineProperty(a,o,{enumerable:p.enumerable}),{getValue:function(){return u},setValue:function(R){u=""+R},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Jc(a){if(!a._valueTracker){var o=Gh(a)?"checked":"value";a._valueTracker=Oy(a,o,""+a[o])}}function zh(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),p="";return a&&(p=Gh(a)?a.checked?"true":"false":a.value),a=p,a!==u?(o.setValue(a),!0):!1}function il(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ly=/[\n"\\]/g;function hs(a){return a.replace(Ly,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Xc(a,o,u,p,b,_,R,$){a.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?a.type=R:a.removeAttribute("type"),o!=null?R==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+us(o)):a.value!==""+us(o)&&(a.value=""+us(o)):R!=="submit"&&R!=="reset"||a.removeAttribute("value"),o!=null?Qc(a,R,us(o)):u!=null?Qc(a,R,us(u)):p!=null&&a.removeAttribute("value"),b==null&&_!=null&&(a.defaultChecked=!!_),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?a.name=""+us($):a.removeAttribute("name")}function Hh(a,o,u,p,b,_,R,$){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(a.type=_),o!=null||u!=null){if(!(_!=="submit"&&_!=="reset"||o!=null)){Jc(a);return}u=u!=null?""+us(u):"",o=o!=null?""+us(o):u,$||o===a.value||(a.value=o),a.defaultValue=o}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=$?a.checked:!!p,a.defaultChecked=!!p,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.name=R),Jc(a)}function Qc(a,o,u){o==="number"&&il(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function ri(a,o,u,p){if(a=a.options,o){o={};for(var b=0;b<u.length;b++)o["$"+u[b]]=!0;for(u=0;u<a.length;u++)b=o.hasOwnProperty("$"+a[u].value),a[u].selected!==b&&(a[u].selected=b),b&&p&&(a[u].defaultSelected=!0)}else{for(u=""+us(u),o=null,b=0;b<a.length;b++){if(a[b].value===u){a[b].selected=!0,p&&(a[b].defaultSelected=!0);return}o!==null||a[b].disabled||(o=a[b])}o!==null&&(o.selected=!0)}}function V(a,o,u){if(o!=null&&(o=""+us(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+us(u):""}function X(a,o,u,p){if(o==null){if(p!=null){if(u!=null)throw Error(r(92));if(Y(p)){if(1<p.length)throw Error(r(93));p=p[0]}u=p}u==null&&(u=""),o=u}u=us(o),a.defaultValue=u,p=a.textContent,p===u&&p!==""&&p!==null&&(a.value=p),Jc(a)}function W(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var me=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Me(a,o,u){var p=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":p?a.setProperty(o,u):typeof u!="number"||u===0||me.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Pe(a,o,u){if(o!=null&&typeof o!="object")throw Error(r(62));if(a=a.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var b in o)p=o[b],o.hasOwnProperty(b)&&u[b]!==p&&Me(a,b,p)}else for(var _ in o)o.hasOwnProperty(_)&&Me(a,_,o[_])}function Ze(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),dt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function cn(a){return dt.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function sn(){}var dn=null;function Kn(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var kn=null,un=null;function ii(a){var o=Qi(a);if(o&&(a=o.stateNode)){var u=a[Un]||null;e:switch(a=o.stateNode,o.type){case"input":if(Xc(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+hs(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var p=u[o];if(p!==a&&p.form===a.form){var b=p[Un]||null;if(!b)throw Error(r(90));Xc(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(o=0;o<u.length;o++)p=u[o],p.form===a.form&&zh(p)}break e;case"textarea":V(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&ri(a,!!u.multiple,o,!1)}}}var vr=!1;function Zc(a,o,u){if(vr)return a(o,u);vr=!0;try{var p=a(o);return p}finally{if(vr=!1,(kn!==null||un!==null)&&(Bd(),kn&&(o=kn,a=un,un=kn=null,ii(o),a)))for(o=0;o<a.length;o++)ii(a[o])}}function al(a,o){var u=a.stateNode;if(u===null)return null;var p=u[Un]||null;if(p===null)return null;u=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(r(231,o,typeof u));return u}var br=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vh=!1;if(br)try{var ol={};Object.defineProperty(ol,"passive",{get:function(){Vh=!0}}),window.addEventListener("test",ol,ol),window.removeEventListener("test",ol,ol)}catch{Vh=!1}var ai=null,qh=null,ed=null;function Fy(){if(ed)return ed;var a,o=qh,u=o.length,p,b="value"in ai?ai.value:ai.textContent,_=b.length;for(a=0;a<u&&o[a]===b[a];a++);var R=u-a;for(p=1;p<=R&&o[u-p]===b[_-p];p++);return ed=b.slice(a,1<p?1-p:void 0)}function td(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function nd(){return!0}function Uy(){return!1}function rs(a){function o(u,p,b,_,R){this._reactName=u,this._targetInst=b,this.type=p,this.nativeEvent=_,this.target=R,this.currentTarget=null;for(var $ in a)a.hasOwnProperty($)&&(u=a[$],this[$]=u?u(_):_[$]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?nd:Uy,this.isPropagationStopped=Uy,this}return x(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=nd)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=nd)},persist:function(){},isPersistent:nd}),o}var ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sd=rs(ta),ll=x({},ta,{view:0,detail:0}),wE=rs(ll),Wh,$h,cl,rd=x({},ll,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==cl&&(cl&&a.type==="mousemove"?(Wh=a.screenX-cl.screenX,$h=a.screenY-cl.screenY):$h=Wh=0,cl=a),Wh)},movementY:function(a){return"movementY"in a?a.movementY:$h}}),By=rs(rd),TE=x({},rd,{dataTransfer:0}),CE=rs(TE),EE=x({},ll,{relatedTarget:0}),Kh=rs(EE),IE=x({},ta,{animationName:0,elapsedTime:0,pseudoElement:0}),jE=rs(IE),AE=x({},ta,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),kE=rs(AE),DE=x({},ta,{data:0}),Gy=rs(DE),RE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ME={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},PE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OE(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=PE[a])?!!o[a]:!1}function Yh(){return OE}var LE=x({},ll,{key:function(a){if(a.key){var o=RE[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=td(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ME[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yh,charCode:function(a){return a.type==="keypress"?td(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?td(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),FE=rs(LE),UE=x({},rd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zy=rs(UE),BE=x({},ll,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yh}),GE=rs(BE),zE=x({},ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),HE=rs(zE),VE=x({},rd,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qE=rs(VE),WE=x({},ta,{newState:0,oldState:0}),$E=rs(WE),KE=[9,13,27,32],Jh=br&&"CompositionEvent"in window,dl=null;br&&"documentMode"in document&&(dl=document.documentMode);var YE=br&&"TextEvent"in window&&!dl,Hy=br&&(!Jh||dl&&8<dl&&11>=dl),Vy=" ",qy=!1;function Wy(a,o){switch(a){case"keyup":return KE.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $y(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Pa=!1;function JE(a,o){switch(a){case"compositionend":return $y(o);case"keypress":return o.which!==32?null:(qy=!0,Vy);case"textInput":return a=o.data,a===Vy&&qy?null:a;default:return null}}function XE(a,o){if(Pa)return a==="compositionend"||!Jh&&Wy(a,o)?(a=Fy(),ed=qh=ai=null,Pa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Hy&&o.locale!=="ko"?null:o.data;default:return null}}var QE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ky(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!QE[a.type]:o==="textarea"}function Yy(a,o,u,p){kn?un?un.push(p):un=[p]:kn=p,o=$d(o,"onChange"),0<o.length&&(u=new sd("onChange","change",null,u,p),a.push({event:u,listeners:o}))}var ul=null,hl=null;function ZE(a){kv(a,0)}function id(a){var o=Ma(a);if(zh(o))return a}function Jy(a,o){if(a==="change")return o}var Xy=!1;if(br){var Xh;if(br){var Qh="oninput"in document;if(!Qh){var Qy=document.createElement("div");Qy.setAttribute("oninput","return;"),Qh=typeof Qy.oninput=="function"}Xh=Qh}else Xh=!1;Xy=Xh&&(!document.documentMode||9<document.documentMode)}function Zy(){ul&&(ul.detachEvent("onpropertychange",ex),hl=ul=null)}function ex(a){if(a.propertyName==="value"&&id(hl)){var o=[];Yy(o,hl,a,Kn(a)),Zc(ZE,o)}}function eI(a,o,u){a==="focusin"?(Zy(),ul=o,hl=u,ul.attachEvent("onpropertychange",ex)):a==="focusout"&&Zy()}function tI(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return id(hl)}function nI(a,o){if(a==="click")return id(o)}function sI(a,o){if(a==="input"||a==="change")return id(o)}function rI(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var fs=typeof Object.is=="function"?Object.is:rI;function fl(a,o){if(fs(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),p=Object.keys(o);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var b=u[p];if(!be.call(o,b)||!fs(a[b],o[b]))return!1}return!0}function tx(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function nx(a,o){var u=tx(a);a=0;for(var p;u;){if(u.nodeType===3){if(p=a+u.textContent.length,a<=o&&p>=o)return{node:u,offset:o-a};a=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=tx(u)}}function sx(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?sx(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function rx(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=il(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=il(a.document)}return o}function Zh(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var iI=br&&"documentMode"in document&&11>=document.documentMode,Oa=null,ef=null,ml=null,tf=!1;function ix(a,o,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;tf||Oa==null||Oa!==il(p)||(p=Oa,"selectionStart"in p&&Zh(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),ml&&fl(ml,p)||(ml=p,p=$d(ef,"onSelect"),0<p.length&&(o=new sd("onSelect","select",null,o,u),a.push({event:o,listeners:p}),o.target=Oa)))}function na(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var La={animationend:na("Animation","AnimationEnd"),animationiteration:na("Animation","AnimationIteration"),animationstart:na("Animation","AnimationStart"),transitionrun:na("Transition","TransitionRun"),transitionstart:na("Transition","TransitionStart"),transitioncancel:na("Transition","TransitionCancel"),transitionend:na("Transition","TransitionEnd")},nf={},ax={};br&&(ax=document.createElement("div").style,"AnimationEvent"in window||(delete La.animationend.animation,delete La.animationiteration.animation,delete La.animationstart.animation),"TransitionEvent"in window||delete La.transitionend.transition);function sa(a){if(nf[a])return nf[a];if(!La[a])return a;var o=La[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in ax)return nf[a]=o[u];return a}var ox=sa("animationend"),lx=sa("animationiteration"),cx=sa("animationstart"),aI=sa("transitionrun"),oI=sa("transitionstart"),lI=sa("transitioncancel"),dx=sa("transitionend"),ux=new Map,sf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");sf.push("scrollEnd");function zs(a,o){ux.set(a,o),si(o,[a])}var ad=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Cs=[],Fa=0,rf=0;function od(){for(var a=Fa,o=rf=Fa=0;o<a;){var u=Cs[o];Cs[o++]=null;var p=Cs[o];Cs[o++]=null;var b=Cs[o];Cs[o++]=null;var _=Cs[o];if(Cs[o++]=null,p!==null&&b!==null){var R=p.pending;R===null?b.next=b:(b.next=R.next,R.next=b),p.pending=b}_!==0&&hx(u,b,_)}}function ld(a,o,u,p){Cs[Fa++]=a,Cs[Fa++]=o,Cs[Fa++]=u,Cs[Fa++]=p,rf|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function af(a,o,u,p){return ld(a,o,u,p),cd(a)}function ra(a,o){return ld(a,null,null,o),cd(a)}function hx(a,o,u){a.lanes|=u;var p=a.alternate;p!==null&&(p.lanes|=u);for(var b=!1,_=a.return;_!==null;)_.childLanes|=u,p=_.alternate,p!==null&&(p.childLanes|=u),_.tag===22&&(a=_.stateNode,a===null||a._visibility&1||(b=!0)),a=_,_=_.return;return a.tag===3?(_=a.stateNode,b&&o!==null&&(b=31-rt(u),a=_.hiddenUpdates,p=a[b],p===null?a[b]=[o]:p.push(o),o.lane=u|536870912),_):null}function cd(a){if(50<Ol)throw Ol=0,pm=null,Error(r(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Ua={};function cI(a,o,u,p){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ms(a,o,u,p){return new cI(a,o,u,p)}function of(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Nr(a,o){var u=a.alternate;return u===null?(u=ms(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function fx(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function dd(a,o,u,p,b,_){var R=0;if(p=a,typeof a=="function")of(a)&&(R=1);else if(typeof a=="string")R=mj(a,u,Ne.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case F:return a=ms(31,u,o,b),a.elementType=F,a.lanes=_,a;case C:return ia(u.children,b,_,o);case w:R=8,b|=24;break;case E:return a=ms(12,u,o,b|2),a.elementType=E,a.lanes=_,a;case M:return a=ms(13,u,o,b),a.elementType=M,a.lanes=_,a;case j:return a=ms(19,u,o,b),a.elementType=j,a.lanes=_,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case I:R=10;break e;case D:R=9;break e;case k:R=11;break e;case O:R=14;break e;case A:R=16,p=null;break e}R=29,u=Error(r(130,a===null?"null":typeof a,"")),p=null}return o=ms(R,u,o,b),o.elementType=a,o.type=p,o.lanes=_,o}function ia(a,o,u,p){return a=ms(7,a,p,o),a.lanes=u,a}function lf(a,o,u){return a=ms(6,a,null,o),a.lanes=u,a}function mx(a){var o=ms(18,null,null,0);return o.stateNode=a,o}function cf(a,o,u){return o=ms(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var px=new WeakMap;function Es(a,o){if(typeof a=="object"&&a!==null){var u=px.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Le(o)},px.set(a,o),o)}return{value:a,source:o,stack:Le(o)}}var Ba=[],Ga=0,ud=null,pl=0,Is=[],js=0,oi=null,ar=1,or="";function Sr(a,o){Ba[Ga++]=pl,Ba[Ga++]=ud,ud=a,pl=o}function gx(a,o,u){Is[js++]=ar,Is[js++]=or,Is[js++]=oi,oi=a;var p=ar;a=or;var b=32-rt(p)-1;p&=~(1<<b),u+=1;var _=32-rt(o)+b;if(30<_){var R=b-b%5;_=(p&(1<<R)-1).toString(32),p>>=R,b-=R,ar=1<<32-rt(o)+b|u<<b|p,or=_+a}else ar=1<<_|u<<b|p,or=a}function df(a){a.return!==null&&(Sr(a,1),gx(a,1,0))}function uf(a){for(;a===ud;)ud=Ba[--Ga],Ba[Ga]=null,pl=Ba[--Ga],Ba[Ga]=null;for(;a===oi;)oi=Is[--js],Is[js]=null,or=Is[--js],Is[js]=null,ar=Is[--js],Is[js]=null}function yx(a,o){Is[js++]=ar,Is[js++]=or,Is[js++]=oi,ar=o.id,or=o.overflow,oi=a}var Bn=null,Zt=null,Tt=!1,li=null,As=!1,hf=Error(r(519));function ci(a){var o=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw gl(Es(o,a)),hf}function xx(a){var o=a.stateNode,u=a.type,p=a.memoizedProps;switch(o[xn]=a,o[Un]=p,u){case"dialog":bt("cancel",o),bt("close",o);break;case"iframe":case"object":case"embed":bt("load",o);break;case"video":case"audio":for(u=0;u<Fl.length;u++)bt(Fl[u],o);break;case"source":bt("error",o);break;case"img":case"image":case"link":bt("error",o),bt("load",o);break;case"details":bt("toggle",o);break;case"input":bt("invalid",o),Hh(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":bt("invalid",o);break;case"textarea":bt("invalid",o),X(o,p.value,p.defaultValue,p.children)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||p.suppressHydrationWarning===!0||Pv(o.textContent,u)?(p.popover!=null&&(bt("beforetoggle",o),bt("toggle",o)),p.onScroll!=null&&bt("scroll",o),p.onScrollEnd!=null&&bt("scrollend",o),p.onClick!=null&&(o.onclick=sn),o=!0):o=!1,o||ci(a,!0)}function vx(a){for(Bn=a.return;Bn;)switch(Bn.tag){case 5:case 31:case 13:As=!1;return;case 27:case 3:As=!0;return;default:Bn=Bn.return}}function za(a){if(a!==Bn)return!1;if(!Tt)return vx(a),Tt=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||Am(a.type,a.memoizedProps)),u=!u),u&&Zt&&ci(a),vx(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));Zt=Vv(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));Zt=Vv(a)}else o===27?(o=Zt,_i(a.type)?(a=Pm,Pm=null,Zt=a):Zt=o):Zt=Bn?Ds(a.stateNode.nextSibling):null;return!0}function aa(){Zt=Bn=null,Tt=!1}function ff(){var a=li;return a!==null&&(ls===null?ls=a:ls.push.apply(ls,a),li=null),a}function gl(a){li===null?li=[a]:li.push(a)}var mf=H(null),oa=null,_r=null;function di(a,o,u){ue(mf,o._currentValue),o._currentValue=u}function wr(a){a._currentValue=mf.current,ae(mf)}function pf(a,o,u){for(;a!==null;){var p=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),a===u)break;a=a.return}}function gf(a,o,u,p){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var _=b.dependencies;if(_!==null){var R=b.child;_=_.firstContext;e:for(;_!==null;){var $=_;_=b;for(var ie=0;ie<o.length;ie++)if($.context===o[ie]){_.lanes|=u,$=_.alternate,$!==null&&($.lanes|=u),pf(_.return,u,a),p||(R=null);break e}_=$.next}}else if(b.tag===18){if(R=b.return,R===null)throw Error(r(341));R.lanes|=u,_=R.alternate,_!==null&&(_.lanes|=u),pf(R,u,a),R=null}else R=b.child;if(R!==null)R.return=b;else for(R=b;R!==null;){if(R===a){R=null;break}if(b=R.sibling,b!==null){b.return=R.return,R=b;break}R=R.return}b=R}}function Ha(a,o,u,p){a=null;for(var b=o,_=!1;b!==null;){if(!_){if((b.flags&524288)!==0)_=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var R=b.alternate;if(R===null)throw Error(r(387));if(R=R.memoizedProps,R!==null){var $=b.type;fs(b.pendingProps.value,R.value)||(a!==null?a.push($):a=[$])}}else if(b===Te.current){if(R=b.alternate,R===null)throw Error(r(387));R.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Hl):a=[Hl])}b=b.return}a!==null&&gf(o,a,u,p),o.flags|=262144}function hd(a){for(a=a.firstContext;a!==null;){if(!fs(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function la(a){oa=a,_r=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Gn(a){return bx(oa,a)}function fd(a,o){return oa===null&&la(a),bx(a,o)}function bx(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},_r===null){if(a===null)throw Error(r(308));_r=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else _r=_r.next=o;return u}var dI=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,p){a.push(p)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},uI=t.unstable_scheduleCallback,hI=t.unstable_NormalPriority,vn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function yf(){return{controller:new dI,data:new Map,refCount:0}}function yl(a){a.refCount--,a.refCount===0&&uI(hI,function(){a.controller.abort()})}var xl=null,xf=0,Va=0,qa=null;function fI(a,o){if(xl===null){var u=xl=[];xf=0,Va=Nm(),qa={status:"pending",value:void 0,then:function(p){u.push(p)}}}return xf++,o.then(Nx,Nx),o}function Nx(){if(--xf===0&&xl!==null){qa!==null&&(qa.status="fulfilled");var a=xl;xl=null,Va=0,qa=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function mI(a,o){var u=[],p={status:"pending",value:null,reason:null,then:function(b){u.push(b)}};return a.then(function(){p.status="fulfilled",p.value=o;for(var b=0;b<u.length;b++)(0,u[b])(o)},function(b){for(p.status="rejected",p.reason=b,b=0;b<u.length;b++)(0,u[b])(void 0)}),p}var Sx=G.S;G.S=function(a,o){iv=ut(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&fI(a,o),Sx!==null&&Sx(a,o)};var ca=H(null);function vf(){var a=ca.current;return a!==null?a:Kt.pooledCache}function md(a,o){o===null?ue(ca,ca.current):ue(ca,o.pool)}function _x(){var a=vf();return a===null?null:{parent:vn._currentValue,pool:a}}var Wa=Error(r(460)),bf=Error(r(474)),pd=Error(r(542)),gd={then:function(){}};function wx(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Tx(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(sn,sn),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ex(a),a;default:if(typeof o.status=="string")o.then(sn,sn);else{if(a=Kt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=o,a.status="pending",a.then(function(p){if(o.status==="pending"){var b=o;b.status="fulfilled",b.value=p}},function(p){if(o.status==="pending"){var b=o;b.status="rejected",b.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ex(a),a}throw ua=o,Wa}}function da(a){try{var o=a._init;return o(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(ua=u,Wa):u}}var ua=null;function Cx(){if(ua===null)throw Error(r(459));var a=ua;return ua=null,a}function Ex(a){if(a===Wa||a===pd)throw Error(r(483))}var $a=null,vl=0;function yd(a){var o=vl;return vl+=1,$a===null&&($a=[]),Tx($a,a,o)}function bl(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function xd(a,o){throw o.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(o),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function Ix(a){function o(he,ce){if(a){var pe=he.deletions;pe===null?(he.deletions=[ce],he.flags|=16):pe.push(ce)}}function u(he,ce){if(!a)return null;for(;ce!==null;)o(he,ce),ce=ce.sibling;return null}function p(he){for(var ce=new Map;he!==null;)he.key!==null?ce.set(he.key,he):ce.set(he.index,he),he=he.sibling;return ce}function b(he,ce){return he=Nr(he,ce),he.index=0,he.sibling=null,he}function _(he,ce,pe){return he.index=pe,a?(pe=he.alternate,pe!==null?(pe=pe.index,pe<ce?(he.flags|=67108866,ce):pe):(he.flags|=67108866,ce)):(he.flags|=1048576,ce)}function R(he){return a&&he.alternate===null&&(he.flags|=67108866),he}function $(he,ce,pe,Ie){return ce===null||ce.tag!==6?(ce=lf(pe,he.mode,Ie),ce.return=he,ce):(ce=b(ce,pe),ce.return=he,ce)}function ie(he,ce,pe,Ie){var tt=pe.type;return tt===C?Ee(he,ce,pe.props.children,Ie,pe.key):ce!==null&&(ce.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===A&&da(tt)===ce.type)?(ce=b(ce,pe.props),bl(ce,pe),ce.return=he,ce):(ce=dd(pe.type,pe.key,pe.props,null,he.mode,Ie),bl(ce,pe),ce.return=he,ce)}function ge(he,ce,pe,Ie){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==pe.containerInfo||ce.stateNode.implementation!==pe.implementation?(ce=cf(pe,he.mode,Ie),ce.return=he,ce):(ce=b(ce,pe.children||[]),ce.return=he,ce)}function Ee(he,ce,pe,Ie,tt){return ce===null||ce.tag!==7?(ce=ia(pe,he.mode,Ie,tt),ce.return=he,ce):(ce=b(ce,pe),ce.return=he,ce)}function je(he,ce,pe){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=lf(""+ce,he.mode,pe),ce.return=he,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case N:return pe=dd(ce.type,ce.key,ce.props,null,he.mode,pe),bl(pe,ce),pe.return=he,pe;case T:return ce=cf(ce,he.mode,pe),ce.return=he,ce;case A:return ce=da(ce),je(he,ce,pe)}if(Y(ce)||q(ce))return ce=ia(ce,he.mode,pe,null),ce.return=he,ce;if(typeof ce.then=="function")return je(he,yd(ce),pe);if(ce.$$typeof===I)return je(he,fd(he,ce),pe);xd(he,ce)}return null}function ve(he,ce,pe,Ie){var tt=ce!==null?ce.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return tt!==null?null:$(he,ce,""+pe,Ie);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case N:return pe.key===tt?ie(he,ce,pe,Ie):null;case T:return pe.key===tt?ge(he,ce,pe,Ie):null;case A:return pe=da(pe),ve(he,ce,pe,Ie)}if(Y(pe)||q(pe))return tt!==null?null:Ee(he,ce,pe,Ie,null);if(typeof pe.then=="function")return ve(he,ce,yd(pe),Ie);if(pe.$$typeof===I)return ve(he,ce,fd(he,pe),Ie);xd(he,pe)}return null}function we(he,ce,pe,Ie,tt){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return he=he.get(pe)||null,$(ce,he,""+Ie,tt);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case N:return he=he.get(Ie.key===null?pe:Ie.key)||null,ie(ce,he,Ie,tt);case T:return he=he.get(Ie.key===null?pe:Ie.key)||null,ge(ce,he,Ie,tt);case A:return Ie=da(Ie),we(he,ce,pe,Ie,tt)}if(Y(Ie)||q(Ie))return he=he.get(pe)||null,Ee(ce,he,Ie,tt,null);if(typeof Ie.then=="function")return we(he,ce,pe,yd(Ie),tt);if(Ie.$$typeof===I)return we(he,ce,pe,fd(ce,Ie),tt);xd(ce,Ie)}return null}function Ye(he,ce,pe,Ie){for(var tt=null,At=null,Qe=ce,ft=ce=0,wt=null;Qe!==null&&ft<pe.length;ft++){Qe.index>ft?(wt=Qe,Qe=null):wt=Qe.sibling;var kt=ve(he,Qe,pe[ft],Ie);if(kt===null){Qe===null&&(Qe=wt);break}a&&Qe&&kt.alternate===null&&o(he,Qe),ce=_(kt,ce,ft),At===null?tt=kt:At.sibling=kt,At=kt,Qe=wt}if(ft===pe.length)return u(he,Qe),Tt&&Sr(he,ft),tt;if(Qe===null){for(;ft<pe.length;ft++)Qe=je(he,pe[ft],Ie),Qe!==null&&(ce=_(Qe,ce,ft),At===null?tt=Qe:At.sibling=Qe,At=Qe);return Tt&&Sr(he,ft),tt}for(Qe=p(Qe);ft<pe.length;ft++)wt=we(Qe,he,ft,pe[ft],Ie),wt!==null&&(a&&wt.alternate!==null&&Qe.delete(wt.key===null?ft:wt.key),ce=_(wt,ce,ft),At===null?tt=wt:At.sibling=wt,At=wt);return a&&Qe.forEach(function(Ii){return o(he,Ii)}),Tt&&Sr(he,ft),tt}function st(he,ce,pe,Ie){if(pe==null)throw Error(r(151));for(var tt=null,At=null,Qe=ce,ft=ce=0,wt=null,kt=pe.next();Qe!==null&&!kt.done;ft++,kt=pe.next()){Qe.index>ft?(wt=Qe,Qe=null):wt=Qe.sibling;var Ii=ve(he,Qe,kt.value,Ie);if(Ii===null){Qe===null&&(Qe=wt);break}a&&Qe&&Ii.alternate===null&&o(he,Qe),ce=_(Ii,ce,ft),At===null?tt=Ii:At.sibling=Ii,At=Ii,Qe=wt}if(kt.done)return u(he,Qe),Tt&&Sr(he,ft),tt;if(Qe===null){for(;!kt.done;ft++,kt=pe.next())kt=je(he,kt.value,Ie),kt!==null&&(ce=_(kt,ce,ft),At===null?tt=kt:At.sibling=kt,At=kt);return Tt&&Sr(he,ft),tt}for(Qe=p(Qe);!kt.done;ft++,kt=pe.next())kt=we(Qe,he,ft,kt.value,Ie),kt!==null&&(a&&kt.alternate!==null&&Qe.delete(kt.key===null?ft:kt.key),ce=_(kt,ce,ft),At===null?tt=kt:At.sibling=kt,At=kt);return a&&Qe.forEach(function(Tj){return o(he,Tj)}),Tt&&Sr(he,ft),tt}function Ht(he,ce,pe,Ie){if(typeof pe=="object"&&pe!==null&&pe.type===C&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case N:e:{for(var tt=pe.key;ce!==null;){if(ce.key===tt){if(tt=pe.type,tt===C){if(ce.tag===7){u(he,ce.sibling),Ie=b(ce,pe.props.children),Ie.return=he,he=Ie;break e}}else if(ce.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===A&&da(tt)===ce.type){u(he,ce.sibling),Ie=b(ce,pe.props),bl(Ie,pe),Ie.return=he,he=Ie;break e}u(he,ce);break}else o(he,ce);ce=ce.sibling}pe.type===C?(Ie=ia(pe.props.children,he.mode,Ie,pe.key),Ie.return=he,he=Ie):(Ie=dd(pe.type,pe.key,pe.props,null,he.mode,Ie),bl(Ie,pe),Ie.return=he,he=Ie)}return R(he);case T:e:{for(tt=pe.key;ce!==null;){if(ce.key===tt)if(ce.tag===4&&ce.stateNode.containerInfo===pe.containerInfo&&ce.stateNode.implementation===pe.implementation){u(he,ce.sibling),Ie=b(ce,pe.children||[]),Ie.return=he,he=Ie;break e}else{u(he,ce);break}else o(he,ce);ce=ce.sibling}Ie=cf(pe,he.mode,Ie),Ie.return=he,he=Ie}return R(he);case A:return pe=da(pe),Ht(he,ce,pe,Ie)}if(Y(pe))return Ye(he,ce,pe,Ie);if(q(pe)){if(tt=q(pe),typeof tt!="function")throw Error(r(150));return pe=tt.call(pe),st(he,ce,pe,Ie)}if(typeof pe.then=="function")return Ht(he,ce,yd(pe),Ie);if(pe.$$typeof===I)return Ht(he,ce,fd(he,pe),Ie);xd(he,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,ce!==null&&ce.tag===6?(u(he,ce.sibling),Ie=b(ce,pe),Ie.return=he,he=Ie):(u(he,ce),Ie=lf(pe,he.mode,Ie),Ie.return=he,he=Ie),R(he)):u(he,ce)}return function(he,ce,pe,Ie){try{vl=0;var tt=Ht(he,ce,pe,Ie);return $a=null,tt}catch(Qe){if(Qe===Wa||Qe===pd)throw Qe;var At=ms(29,Qe,null,he.mode);return At.lanes=Ie,At.return=he,At}finally{}}}var ha=Ix(!0),jx=Ix(!1),ui=!1;function Nf(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sf(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function hi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function fi(a,o,u){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(Ot&2)!==0){var b=p.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),p.pending=o,o=cd(a),hx(a,null,u),o}return ld(a,p,o,u),cd(a)}function Nl(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,qc(a,u)}}function _f(a,o){var u=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var b=null,_=null;if(u=u.firstBaseUpdate,u!==null){do{var R={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};_===null?b=_=R:_=_.next=R,u=u.next}while(u!==null);_===null?b=_=o:_=_.next=o}else b=_=o;u={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:_,shared:p.shared,callbacks:p.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var wf=!1;function Sl(){if(wf){var a=qa;if(a!==null)throw a}}function _l(a,o,u,p){wf=!1;var b=a.updateQueue;ui=!1;var _=b.firstBaseUpdate,R=b.lastBaseUpdate,$=b.shared.pending;if($!==null){b.shared.pending=null;var ie=$,ge=ie.next;ie.next=null,R===null?_=ge:R.next=ge,R=ie;var Ee=a.alternate;Ee!==null&&(Ee=Ee.updateQueue,$=Ee.lastBaseUpdate,$!==R&&($===null?Ee.firstBaseUpdate=ge:$.next=ge,Ee.lastBaseUpdate=ie))}if(_!==null){var je=b.baseState;R=0,Ee=ge=ie=null,$=_;do{var ve=$.lane&-536870913,we=ve!==$.lane;if(we?(_t&ve)===ve:(p&ve)===ve){ve!==0&&ve===Va&&(wf=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:$.tag,payload:$.payload,callback:null,next:null});e:{var Ye=a,st=$;ve=o;var Ht=u;switch(st.tag){case 1:if(Ye=st.payload,typeof Ye=="function"){je=Ye.call(Ht,je,ve);break e}je=Ye;break e;case 3:Ye.flags=Ye.flags&-65537|128;case 0:if(Ye=st.payload,ve=typeof Ye=="function"?Ye.call(Ht,je,ve):Ye,ve==null)break e;je=x({},je,ve);break e;case 2:ui=!0}}ve=$.callback,ve!==null&&(a.flags|=64,we&&(a.flags|=8192),we=b.callbacks,we===null?b.callbacks=[ve]:we.push(ve))}else we={lane:ve,tag:$.tag,payload:$.payload,callback:$.callback,next:null},Ee===null?(ge=Ee=we,ie=je):Ee=Ee.next=we,R|=ve;if($=$.next,$===null){if($=b.shared.pending,$===null)break;we=$,$=we.next,we.next=null,b.lastBaseUpdate=we,b.shared.pending=null}}while(!0);Ee===null&&(ie=je),b.baseState=ie,b.firstBaseUpdate=ge,b.lastBaseUpdate=Ee,_===null&&(b.shared.lanes=0),xi|=R,a.lanes=R,a.memoizedState=je}}function Ax(a,o){if(typeof a!="function")throw Error(r(191,a));a.call(o)}function kx(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)Ax(u[a],o)}var Ka=H(null),vd=H(0);function Dx(a,o){a=Rr,ue(vd,a),ue(Ka,o),Rr=a|o.baseLanes}function Tf(){ue(vd,Rr),ue(Ka,Ka.current)}function Cf(){Rr=vd.current,ae(Ka),ae(vd)}var ps=H(null),ks=null;function mi(a){var o=a.alternate;ue(gn,gn.current&1),ue(ps,a),ks===null&&(o===null||Ka.current!==null||o.memoizedState!==null)&&(ks=a)}function Ef(a){ue(gn,gn.current),ue(ps,a),ks===null&&(ks=a)}function Rx(a){a.tag===22?(ue(gn,gn.current),ue(ps,a),ks===null&&(ks=a)):pi()}function pi(){ue(gn,gn.current),ue(ps,ps.current)}function gs(a){ae(ps),ks===a&&(ks=null),ae(gn)}var gn=H(0);function bd(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Rm(u)||Mm(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Tr=0,ht=null,Gt=null,bn=null,Nd=!1,Ya=!1,fa=!1,Sd=0,wl=0,Ja=null,pI=0;function hn(){throw Error(r(321))}function If(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!fs(a[u],o[u]))return!1;return!0}function jf(a,o,u,p,b,_){return Tr=_,ht=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,G.H=a===null||a.memoizedState===null?g0:Vf,fa=!1,_=u(p,b),fa=!1,Ya&&(_=Px(o,u,p,b)),Mx(a),_}function Mx(a){G.H=El;var o=Gt!==null&&Gt.next!==null;if(Tr=0,bn=Gt=ht=null,Nd=!1,wl=0,Ja=null,o)throw Error(r(300));a===null||Nn||(a=a.dependencies,a!==null&&hd(a)&&(Nn=!0))}function Px(a,o,u,p){ht=a;var b=0;do{if(Ya&&(Ja=null),wl=0,Ya=!1,25<=b)throw Error(r(301));if(b+=1,bn=Gt=null,a.updateQueue!=null){var _=a.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}G.H=y0,_=o(u,p)}while(Ya);return _}function gI(){var a=G.H,o=a.useState()[0];return o=typeof o.then=="function"?Tl(o):o,a=a.useState()[0],(Gt!==null?Gt.memoizedState:null)!==a&&(ht.flags|=1024),o}function Af(){var a=Sd!==0;return Sd=0,a}function kf(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function Df(a){if(Nd){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Nd=!1}Tr=0,bn=Gt=ht=null,Ya=!1,wl=Sd=0,Ja=null}function Yn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?ht.memoizedState=bn=a:bn=bn.next=a,bn}function yn(){if(Gt===null){var a=ht.alternate;a=a!==null?a.memoizedState:null}else a=Gt.next;var o=bn===null?ht.memoizedState:bn.next;if(o!==null)bn=o,Gt=a;else{if(a===null)throw ht.alternate===null?Error(r(467)):Error(r(310));Gt=a,a={memoizedState:Gt.memoizedState,baseState:Gt.baseState,baseQueue:Gt.baseQueue,queue:Gt.queue,next:null},bn===null?ht.memoizedState=bn=a:bn=bn.next=a}return bn}function _d(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Tl(a){var o=wl;return wl+=1,Ja===null&&(Ja=[]),a=Tx(Ja,a,o),o=ht,(bn===null?o.memoizedState:bn.next)===null&&(o=o.alternate,G.H=o===null||o.memoizedState===null?g0:Vf),a}function wd(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Tl(a);if(a.$$typeof===I)return Gn(a)}throw Error(r(438,String(a)))}function Rf(a){var o=null,u=ht.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var p=ht.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(b){return b.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=_d(),ht.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),p=0;p<a;p++)u[p]=P;return o.index++,u}function Cr(a,o){return typeof o=="function"?o(a):o}function Td(a){var o=yn();return Mf(o,Gt,a)}function Mf(a,o,u){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=u;var b=a.baseQueue,_=p.pending;if(_!==null){if(b!==null){var R=b.next;b.next=_.next,_.next=R}o.baseQueue=b=_,p.pending=null}if(_=a.baseState,b===null)a.memoizedState=_;else{o=b.next;var $=R=null,ie=null,ge=o,Ee=!1;do{var je=ge.lane&-536870913;if(je!==ge.lane?(_t&je)===je:(Tr&je)===je){var ve=ge.revertLane;if(ve===0)ie!==null&&(ie=ie.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),je===Va&&(Ee=!0);else if((Tr&ve)===ve){ge=ge.next,ve===Va&&(Ee=!0);continue}else je={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ie===null?($=ie=je,R=_):ie=ie.next=je,ht.lanes|=ve,xi|=ve;je=ge.action,fa&&u(_,je),_=ge.hasEagerState?ge.eagerState:u(_,je)}else ve={lane:je,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ie===null?($=ie=ve,R=_):ie=ie.next=ve,ht.lanes|=je,xi|=je;ge=ge.next}while(ge!==null&&ge!==o);if(ie===null?R=_:ie.next=$,!fs(_,a.memoizedState)&&(Nn=!0,Ee&&(u=qa,u!==null)))throw u;a.memoizedState=_,a.baseState=R,a.baseQueue=ie,p.lastRenderedState=_}return b===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function Pf(a){var o=yn(),u=o.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=a;var p=u.dispatch,b=u.pending,_=o.memoizedState;if(b!==null){u.pending=null;var R=b=b.next;do _=a(_,R.action),R=R.next;while(R!==b);fs(_,o.memoizedState)||(Nn=!0),o.memoizedState=_,o.baseQueue===null&&(o.baseState=_),u.lastRenderedState=_}return[_,p]}function Ox(a,o,u){var p=ht,b=yn(),_=Tt;if(_){if(u===void 0)throw Error(r(407));u=u()}else u=o();var R=!fs((Gt||b).memoizedState,u);if(R&&(b.memoizedState=u,Nn=!0),b=b.queue,Ff(Ux.bind(null,p,b,a),[a]),b.getSnapshot!==o||R||bn!==null&&bn.memoizedState.tag&1){if(p.flags|=2048,Xa(9,{destroy:void 0},Fx.bind(null,p,b,u,o),null),Kt===null)throw Error(r(349));_||(Tr&127)!==0||Lx(p,o,u)}return u}function Lx(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=ht.updateQueue,o===null?(o=_d(),ht.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function Fx(a,o,u,p){o.value=u,o.getSnapshot=p,Bx(o)&&Gx(a)}function Ux(a,o,u){return u(function(){Bx(o)&&Gx(a)})}function Bx(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!fs(a,u)}catch{return!0}}function Gx(a){var o=ra(a,2);o!==null&&cs(o,a,2)}function Of(a){var o=Yn();if(typeof a=="function"){var u=a;if(a=u(),fa){jt(!0);try{u()}finally{jt(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cr,lastRenderedState:a},o}function zx(a,o,u,p){return a.baseState=u,Mf(a,Gt,typeof p=="function"?p:Cr)}function yI(a,o,u,p,b){if(Id(a))throw Error(r(485));if(a=o.action,a!==null){var _={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){_.listeners.push(R)}};G.T!==null?u(!0):_.isTransition=!1,p(_),u=o.pending,u===null?(_.next=o.pending=_,Hx(o,_)):(_.next=u.next,o.pending=u.next=_)}}function Hx(a,o){var u=o.action,p=o.payload,b=a.state;if(o.isTransition){var _=G.T,R={};G.T=R;try{var $=u(b,p),ie=G.S;ie!==null&&ie(R,$),Vx(a,o,$)}catch(ge){Lf(a,o,ge)}finally{_!==null&&R.types!==null&&(_.types=R.types),G.T=_}}else try{_=u(b,p),Vx(a,o,_)}catch(ge){Lf(a,o,ge)}}function Vx(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){qx(a,o,p)},function(p){return Lf(a,o,p)}):qx(a,o,u)}function qx(a,o,u){o.status="fulfilled",o.value=u,Wx(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,Hx(a,u)))}function Lf(a,o,u){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=u,Wx(o),o=o.next;while(o!==p)}a.action=null}function Wx(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function $x(a,o){return o}function Kx(a,o){if(Tt){var u=Kt.formState;if(u!==null){e:{var p=ht;if(Tt){if(Zt){t:{for(var b=Zt,_=As;b.nodeType!==8;){if(!_){b=null;break t}if(b=Ds(b.nextSibling),b===null){b=null;break t}}_=b.data,b=_==="F!"||_==="F"?b:null}if(b){Zt=Ds(b.nextSibling),p=b.data==="F!";break e}}ci(p)}p=!1}p&&(o=u[0])}}return u=Yn(),u.memoizedState=u.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$x,lastRenderedState:o},u.queue=p,u=f0.bind(null,ht,p),p.dispatch=u,p=Of(!1),_=Hf.bind(null,ht,!1,p.queue),p=Yn(),b={state:o,dispatch:null,action:a,pending:null},p.queue=b,u=yI.bind(null,ht,b,_,u),b.dispatch=u,p.memoizedState=a,[o,u,!1]}function Yx(a){var o=yn();return Jx(o,Gt,a)}function Jx(a,o,u){if(o=Mf(a,o,$x)[0],a=Td(Cr)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=Tl(o)}catch(R){throw R===Wa?pd:R}else p=o;o=yn();var b=o.queue,_=b.dispatch;return u!==o.memoizedState&&(ht.flags|=2048,Xa(9,{destroy:void 0},xI.bind(null,b,u),null)),[p,_,a]}function xI(a,o){a.action=o}function Xx(a){var o=yn(),u=Gt;if(u!==null)return Jx(o,u,a);yn(),o=o.memoizedState,u=yn();var p=u.queue.dispatch;return u.memoizedState=a,[o,p,!1]}function Xa(a,o,u,p){return a={tag:a,create:u,deps:p,inst:o,next:null},o=ht.updateQueue,o===null&&(o=_d(),ht.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(p=u.next,u.next=a,a.next=p,o.lastEffect=a),a}function Qx(){return yn().memoizedState}function Cd(a,o,u,p){var b=Yn();ht.flags|=a,b.memoizedState=Xa(1|o,{destroy:void 0},u,p===void 0?null:p)}function Ed(a,o,u,p){var b=yn();p=p===void 0?null:p;var _=b.memoizedState.inst;Gt!==null&&p!==null&&If(p,Gt.memoizedState.deps)?b.memoizedState=Xa(o,_,u,p):(ht.flags|=a,b.memoizedState=Xa(1|o,_,u,p))}function Zx(a,o){Cd(8390656,8,a,o)}function Ff(a,o){Ed(2048,8,a,o)}function vI(a){ht.flags|=4;var o=ht.updateQueue;if(o===null)o=_d(),ht.updateQueue=o,o.events=[a];else{var u=o.events;u===null?o.events=[a]:u.push(a)}}function e0(a){var o=yn().memoizedState;return vI({ref:o,nextImpl:a}),function(){if((Ot&2)!==0)throw Error(r(440));return o.impl.apply(void 0,arguments)}}function t0(a,o){return Ed(4,2,a,o)}function n0(a,o){return Ed(4,4,a,o)}function s0(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function r0(a,o,u){u=u!=null?u.concat([a]):null,Ed(4,4,s0.bind(null,o,a),u)}function Uf(){}function i0(a,o){var u=yn();o=o===void 0?null:o;var p=u.memoizedState;return o!==null&&If(o,p[1])?p[0]:(u.memoizedState=[a,o],a)}function a0(a,o){var u=yn();o=o===void 0?null:o;var p=u.memoizedState;if(o!==null&&If(o,p[1]))return p[0];if(p=a(),fa){jt(!0);try{a()}finally{jt(!1)}}return u.memoizedState=[p,o],p}function Bf(a,o,u){return u===void 0||(Tr&1073741824)!==0&&(_t&261930)===0?a.memoizedState=o:(a.memoizedState=u,a=ov(),ht.lanes|=a,xi|=a,u)}function o0(a,o,u,p){return fs(u,o)?u:Ka.current!==null?(a=Bf(a,u,p),fs(a,o)||(Nn=!0),a):(Tr&42)===0||(Tr&1073741824)!==0&&(_t&261930)===0?(Nn=!0,a.memoizedState=u):(a=ov(),ht.lanes|=a,xi|=a,o)}function l0(a,o,u,p,b){var _=B.p;B.p=_!==0&&8>_?_:8;var R=G.T,$={};G.T=$,Hf(a,!1,o,u);try{var ie=b(),ge=G.S;if(ge!==null&&ge($,ie),ie!==null&&typeof ie=="object"&&typeof ie.then=="function"){var Ee=mI(ie,p);Cl(a,o,Ee,vs(a))}else Cl(a,o,p,vs(a))}catch(je){Cl(a,o,{then:function(){},status:"rejected",reason:je},vs())}finally{B.p=_,R!==null&&$.types!==null&&(R.types=$.types),G.T=R}}function bI(){}function Gf(a,o,u,p){if(a.tag!==5)throw Error(r(476));var b=c0(a).queue;l0(a,b,o,Q,u===null?bI:function(){return d0(a),u(p)})}function c0(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cr,lastRenderedState:Q},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cr,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function d0(a){var o=c0(a);o.next===null&&(o=a.alternate.memoizedState),Cl(a,o.next.queue,{},vs())}function zf(){return Gn(Hl)}function u0(){return yn().memoizedState}function h0(){return yn().memoizedState}function NI(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=vs();a=hi(u);var p=fi(o,a,u);p!==null&&(cs(p,o,u),Nl(p,o,u)),o={cache:yf()},a.payload=o;return}o=o.return}}function SI(a,o,u){var p=vs();u={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Id(a)?m0(o,u):(u=af(a,o,u,p),u!==null&&(cs(u,a,p),p0(u,o,p)))}function f0(a,o,u){var p=vs();Cl(a,o,u,p)}function Cl(a,o,u,p){var b={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Id(a))m0(o,b);else{var _=a.alternate;if(a.lanes===0&&(_===null||_.lanes===0)&&(_=o.lastRenderedReducer,_!==null))try{var R=o.lastRenderedState,$=_(R,u);if(b.hasEagerState=!0,b.eagerState=$,fs($,R))return ld(a,o,b,0),Kt===null&&od(),!1}catch{}finally{}if(u=af(a,o,b,p),u!==null)return cs(u,a,p),p0(u,o,p),!0}return!1}function Hf(a,o,u,p){if(p={lane:2,revertLane:Nm(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Id(a)){if(o)throw Error(r(479))}else o=af(a,u,p,2),o!==null&&cs(o,a,2)}function Id(a){var o=a.alternate;return a===ht||o!==null&&o===ht}function m0(a,o){Ya=Nd=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function p0(a,o,u){if((u&4194048)!==0){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,qc(a,u)}}var El={readContext:Gn,use:wd,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useLayoutEffect:hn,useInsertionEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useSyncExternalStore:hn,useId:hn,useHostTransitionStatus:hn,useFormState:hn,useActionState:hn,useOptimistic:hn,useMemoCache:hn,useCacheRefresh:hn};El.useEffectEvent=hn;var g0={readContext:Gn,use:wd,useCallback:function(a,o){return Yn().memoizedState=[a,o===void 0?null:o],a},useContext:Gn,useEffect:Zx,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,Cd(4194308,4,s0.bind(null,o,a),u)},useLayoutEffect:function(a,o){return Cd(4194308,4,a,o)},useInsertionEffect:function(a,o){Cd(4,2,a,o)},useMemo:function(a,o){var u=Yn();o=o===void 0?null:o;var p=a();if(fa){jt(!0);try{a()}finally{jt(!1)}}return u.memoizedState=[p,o],p},useReducer:function(a,o,u){var p=Yn();if(u!==void 0){var b=u(o);if(fa){jt(!0);try{u(o)}finally{jt(!1)}}}else b=o;return p.memoizedState=p.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},p.queue=a,a=a.dispatch=SI.bind(null,ht,a),[p.memoizedState,a]},useRef:function(a){var o=Yn();return a={current:a},o.memoizedState=a},useState:function(a){a=Of(a);var o=a.queue,u=f0.bind(null,ht,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:Uf,useDeferredValue:function(a,o){var u=Yn();return Bf(u,a,o)},useTransition:function(){var a=Of(!1);return a=l0.bind(null,ht,a.queue,!0,!1),Yn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var p=ht,b=Yn();if(Tt){if(u===void 0)throw Error(r(407));u=u()}else{if(u=o(),Kt===null)throw Error(r(349));(_t&127)!==0||Lx(p,o,u)}b.memoizedState=u;var _={value:u,getSnapshot:o};return b.queue=_,Zx(Ux.bind(null,p,_,a),[a]),p.flags|=2048,Xa(9,{destroy:void 0},Fx.bind(null,p,_,u,o),null),u},useId:function(){var a=Yn(),o=Kt.identifierPrefix;if(Tt){var u=or,p=ar;u=(p&~(1<<32-rt(p)-1)).toString(32)+u,o="_"+o+"R_"+u,u=Sd++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=pI++,o="_"+o+"r_"+u.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:zf,useFormState:Kx,useActionState:Kx,useOptimistic:function(a){var o=Yn();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Hf.bind(null,ht,!0,u),u.dispatch=o,[a,o]},useMemoCache:Rf,useCacheRefresh:function(){return Yn().memoizedState=NI.bind(null,ht)},useEffectEvent:function(a){var o=Yn(),u={impl:a};return o.memoizedState=u,function(){if((Ot&2)!==0)throw Error(r(440));return u.impl.apply(void 0,arguments)}}},Vf={readContext:Gn,use:wd,useCallback:i0,useContext:Gn,useEffect:Ff,useImperativeHandle:r0,useInsertionEffect:t0,useLayoutEffect:n0,useMemo:a0,useReducer:Td,useRef:Qx,useState:function(){return Td(Cr)},useDebugValue:Uf,useDeferredValue:function(a,o){var u=yn();return o0(u,Gt.memoizedState,a,o)},useTransition:function(){var a=Td(Cr)[0],o=yn().memoizedState;return[typeof a=="boolean"?a:Tl(a),o]},useSyncExternalStore:Ox,useId:u0,useHostTransitionStatus:zf,useFormState:Yx,useActionState:Yx,useOptimistic:function(a,o){var u=yn();return zx(u,Gt,a,o)},useMemoCache:Rf,useCacheRefresh:h0};Vf.useEffectEvent=e0;var y0={readContext:Gn,use:wd,useCallback:i0,useContext:Gn,useEffect:Ff,useImperativeHandle:r0,useInsertionEffect:t0,useLayoutEffect:n0,useMemo:a0,useReducer:Pf,useRef:Qx,useState:function(){return Pf(Cr)},useDebugValue:Uf,useDeferredValue:function(a,o){var u=yn();return Gt===null?Bf(u,a,o):o0(u,Gt.memoizedState,a,o)},useTransition:function(){var a=Pf(Cr)[0],o=yn().memoizedState;return[typeof a=="boolean"?a:Tl(a),o]},useSyncExternalStore:Ox,useId:u0,useHostTransitionStatus:zf,useFormState:Xx,useActionState:Xx,useOptimistic:function(a,o){var u=yn();return Gt!==null?zx(u,Gt,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:Rf,useCacheRefresh:h0};y0.useEffectEvent=e0;function qf(a,o,u,p){o=a.memoizedState,u=u(p,o),u=u==null?o:x({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Wf={enqueueSetState:function(a,o,u){a=a._reactInternals;var p=vs(),b=hi(p);b.payload=o,u!=null&&(b.callback=u),o=fi(a,b,p),o!==null&&(cs(o,a,p),Nl(o,a,p))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var p=vs(),b=hi(p);b.tag=1,b.payload=o,u!=null&&(b.callback=u),o=fi(a,b,p),o!==null&&(cs(o,a,p),Nl(o,a,p))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=vs(),p=hi(u);p.tag=2,o!=null&&(p.callback=o),o=fi(a,p,u),o!==null&&(cs(o,a,u),Nl(o,a,u))}};function x0(a,o,u,p,b,_,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,_,R):o.prototype&&o.prototype.isPureReactComponent?!fl(u,p)||!fl(b,_):!0}function v0(a,o,u,p){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,p),o.state!==a&&Wf.enqueueReplaceState(o,o.state,null)}function ma(a,o){var u=o;if("ref"in o){u={};for(var p in o)p!=="ref"&&(u[p]=o[p])}if(a=a.defaultProps){u===o&&(u=x({},u));for(var b in a)u[b]===void 0&&(u[b]=a[b])}return u}function b0(a){ad(a)}function N0(a){console.error(a)}function S0(a){ad(a)}function jd(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function _0(a,o,u){try{var p=a.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function $f(a,o,u){return u=hi(u),u.tag=3,u.payload={element:null},u.callback=function(){jd(a,o)},u}function w0(a){return a=hi(a),a.tag=3,a}function T0(a,o,u,p){var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var _=p.value;a.payload=function(){return b(_)},a.callback=function(){_0(o,u,p)}}var R=u.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(a.callback=function(){_0(o,u,p),typeof b!="function"&&(vi===null?vi=new Set([this]):vi.add(this));var $=p.stack;this.componentDidCatch(p.value,{componentStack:$!==null?$:""})})}function _I(a,o,u,p,b){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=u.alternate,o!==null&&Ha(o,u,b,!0),u=ps.current,u!==null){switch(u.tag){case 31:case 13:return ks===null?Gd():u.alternate===null&&fn===0&&(fn=3),u.flags&=-257,u.flags|=65536,u.lanes=b,p===gd?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([p]):o.add(p),xm(a,p,b)),!1;case 22:return u.flags|=65536,p===gd?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([p]):u.add(p)),xm(a,p,b)),!1}throw Error(r(435,u.tag))}return xm(a,p,b),Gd(),!1}if(Tt)return o=ps.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=b,p!==hf&&(a=Error(r(422),{cause:p}),gl(Es(a,u)))):(p!==hf&&(o=Error(r(423),{cause:p}),gl(Es(o,u))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,p=Es(p,u),b=$f(a.stateNode,p,b),_f(a,b),fn!==4&&(fn=2)),!1;var _=Error(r(520),{cause:p});if(_=Es(_,u),Pl===null?Pl=[_]:Pl.push(_),fn!==4&&(fn=2),o===null)return!0;p=Es(p,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=b&-b,u.lanes|=a,a=$f(u.stateNode,p,a),_f(u,a),!1;case 1:if(o=u.type,_=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(vi===null||!vi.has(_))))return u.flags|=65536,b&=-b,u.lanes|=b,b=w0(b),T0(b,a,u,p),_f(u,b),!1}u=u.return}while(u!==null);return!1}var Kf=Error(r(461)),Nn=!1;function zn(a,o,u,p){o.child=a===null?jx(o,null,u,p):ha(o,a.child,u,p)}function C0(a,o,u,p,b){u=u.render;var _=o.ref;if("ref"in p){var R={};for(var $ in p)$!=="ref"&&(R[$]=p[$])}else R=p;return la(o),p=jf(a,o,u,R,_,b),$=Af(),a!==null&&!Nn?(kf(a,o,b),Er(a,o,b)):(Tt&&$&&df(o),o.flags|=1,zn(a,o,p,b),o.child)}function E0(a,o,u,p,b){if(a===null){var _=u.type;return typeof _=="function"&&!of(_)&&_.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=_,I0(a,o,_,p,b)):(a=dd(u.type,null,p,o,o.mode,b),a.ref=o.ref,a.return=o,o.child=a)}if(_=a.child,!nm(a,b)){var R=_.memoizedProps;if(u=u.compare,u=u!==null?u:fl,u(R,p)&&a.ref===o.ref)return Er(a,o,b)}return o.flags|=1,a=Nr(_,p),a.ref=o.ref,a.return=o,o.child=a}function I0(a,o,u,p,b){if(a!==null){var _=a.memoizedProps;if(fl(_,p)&&a.ref===o.ref)if(Nn=!1,o.pendingProps=p=_,nm(a,b))(a.flags&131072)!==0&&(Nn=!0);else return o.lanes=a.lanes,Er(a,o,b)}return Yf(a,o,u,p,b)}function j0(a,o,u,p){var b=p.children,_=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(_=_!==null?_.baseLanes|u:u,a!==null){for(p=o.child=a.child,b=0;p!==null;)b=b|p.lanes|p.childLanes,p=p.sibling;p=b&~_}else p=0,o.child=null;return A0(a,o,_,u,p)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&md(o,_!==null?_.cachePool:null),_!==null?Dx(o,_):Tf(),Rx(o);else return p=o.lanes=536870912,A0(a,o,_!==null?_.baseLanes|u:u,u,p)}else _!==null?(md(o,_.cachePool),Dx(o,_),pi(),o.memoizedState=null):(a!==null&&md(o,null),Tf(),pi());return zn(a,o,b,u),o.child}function Il(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function A0(a,o,u,p,b){var _=vf();return _=_===null?null:{parent:vn._currentValue,pool:_},o.memoizedState={baseLanes:u,cachePool:_},a!==null&&md(o,null),Tf(),Rx(o),a!==null&&Ha(a,o,p,!0),o.childLanes=b,null}function Ad(a,o){return o=Dd({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function k0(a,o,u){return ha(o,a.child,null,u),a=Ad(o,o.pendingProps),a.flags|=2,gs(o),o.memoizedState=null,a}function wI(a,o,u){var p=o.pendingProps,b=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(Tt){if(p.mode==="hidden")return a=Ad(o,p),o.lanes=536870912,Il(null,a);if(Ef(o),(a=Zt)?(a=Hv(a,As),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:oi!==null?{id:ar,overflow:or}:null,retryLane:536870912,hydrationErrors:null},u=mx(a),u.return=o,o.child=u,Bn=o,Zt=null)):a=null,a===null)throw ci(o);return o.lanes=536870912,null}return Ad(o,p)}var _=a.memoizedState;if(_!==null){var R=_.dehydrated;if(Ef(o),b)if(o.flags&256)o.flags&=-257,o=k0(a,o,u);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(r(558));else if(Nn||Ha(a,o,u,!1),b=(u&a.childLanes)!==0,Nn||b){if(p=Kt,p!==null&&(R=Wc(p,u),R!==0&&R!==_.retryLane))throw _.retryLane=R,ra(a,R),cs(p,a,R),Kf;Gd(),o=k0(a,o,u)}else a=_.treeContext,Zt=Ds(R.nextSibling),Bn=o,Tt=!0,li=null,As=!1,a!==null&&yx(o,a),o=Ad(o,p),o.flags|=4096;return o}return a=Nr(a.child,{mode:p.mode,children:p.children}),a.ref=o.ref,o.child=a,a.return=o,a}function kd(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(r(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Yf(a,o,u,p,b){return la(o),u=jf(a,o,u,p,void 0,b),p=Af(),a!==null&&!Nn?(kf(a,o,b),Er(a,o,b)):(Tt&&p&&df(o),o.flags|=1,zn(a,o,u,b),o.child)}function D0(a,o,u,p,b,_){return la(o),o.updateQueue=null,u=Px(o,p,u,b),Mx(a),p=Af(),a!==null&&!Nn?(kf(a,o,_),Er(a,o,_)):(Tt&&p&&df(o),o.flags|=1,zn(a,o,u,_),o.child)}function R0(a,o,u,p,b){if(la(o),o.stateNode===null){var _=Ua,R=u.contextType;typeof R=="object"&&R!==null&&(_=Gn(R)),_=new u(p,_),o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Wf,o.stateNode=_,_._reactInternals=o,_=o.stateNode,_.props=p,_.state=o.memoizedState,_.refs={},Nf(o),R=u.contextType,_.context=typeof R=="object"&&R!==null?Gn(R):Ua,_.state=o.memoizedState,R=u.getDerivedStateFromProps,typeof R=="function"&&(qf(o,u,R,p),_.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(R=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),R!==_.state&&Wf.enqueueReplaceState(_,_.state,null),_l(o,p,_,b),Sl(),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(a===null){_=o.stateNode;var $=o.memoizedProps,ie=ma(u,$);_.props=ie;var ge=_.context,Ee=u.contextType;R=Ua,typeof Ee=="object"&&Ee!==null&&(R=Gn(Ee));var je=u.getDerivedStateFromProps;Ee=typeof je=="function"||typeof _.getSnapshotBeforeUpdate=="function",$=o.pendingProps!==$,Ee||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||($||ge!==R)&&v0(o,_,p,R),ui=!1;var ve=o.memoizedState;_.state=ve,_l(o,p,_,b),Sl(),ge=o.memoizedState,$||ve!==ge||ui?(typeof je=="function"&&(qf(o,u,je,p),ge=o.memoizedState),(ie=ui||x0(o,u,ie,p,ve,ge,R))?(Ee||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(o.flags|=4194308)):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=ge),_.props=p,_.state=ge,_.context=R,p=ie):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{_=o.stateNode,Sf(a,o),R=o.memoizedProps,Ee=ma(u,R),_.props=Ee,je=o.pendingProps,ve=_.context,ge=u.contextType,ie=Ua,typeof ge=="object"&&ge!==null&&(ie=Gn(ge)),$=u.getDerivedStateFromProps,(ge=typeof $=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(R!==je||ve!==ie)&&v0(o,_,p,ie),ui=!1,ve=o.memoizedState,_.state=ve,_l(o,p,_,b),Sl();var we=o.memoizedState;R!==je||ve!==we||ui||a!==null&&a.dependencies!==null&&hd(a.dependencies)?(typeof $=="function"&&(qf(o,u,$,p),we=o.memoizedState),(Ee=ui||x0(o,u,Ee,p,ve,we,ie)||a!==null&&a.dependencies!==null&&hd(a.dependencies))?(ge||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(p,we,ie),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(p,we,ie)),typeof _.componentDidUpdate=="function"&&(o.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof _.componentDidUpdate!="function"||R===a.memoizedProps&&ve===a.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&ve===a.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=we),_.props=p,_.state=we,_.context=ie,p=Ee):(typeof _.componentDidUpdate!="function"||R===a.memoizedProps&&ve===a.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&ve===a.memoizedState||(o.flags|=1024),p=!1)}return _=p,kd(a,o),p=(o.flags&128)!==0,_||p?(_=o.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:_.render(),o.flags|=1,a!==null&&p?(o.child=ha(o,a.child,null,b),o.child=ha(o,null,u,b)):zn(a,o,u,b),o.memoizedState=_.state,a=o.child):a=Er(a,o,b),a}function M0(a,o,u,p){return aa(),o.flags|=256,zn(a,o,u,p),o.child}var Jf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xf(a){return{baseLanes:a,cachePool:_x()}}function Qf(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=xs),a}function P0(a,o,u){var p=o.pendingProps,b=!1,_=(o.flags&128)!==0,R;if((R=_)||(R=a!==null&&a.memoizedState===null?!1:(gn.current&2)!==0),R&&(b=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,a===null){if(Tt){if(b?mi(o):pi(),(a=Zt)?(a=Hv(a,As),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:oi!==null?{id:ar,overflow:or}:null,retryLane:536870912,hydrationErrors:null},u=mx(a),u.return=o,o.child=u,Bn=o,Zt=null)):a=null,a===null)throw ci(o);return Mm(a)?o.lanes=32:o.lanes=536870912,null}var $=p.children;return p=p.fallback,b?(pi(),b=o.mode,$=Dd({mode:"hidden",children:$},b),p=ia(p,b,u,null),$.return=o,p.return=o,$.sibling=p,o.child=$,p=o.child,p.memoizedState=Xf(u),p.childLanes=Qf(a,R,u),o.memoizedState=Jf,Il(null,p)):(mi(o),Zf(o,$))}var ie=a.memoizedState;if(ie!==null&&($=ie.dehydrated,$!==null)){if(_)o.flags&256?(mi(o),o.flags&=-257,o=em(a,o,u)):o.memoizedState!==null?(pi(),o.child=a.child,o.flags|=128,o=null):(pi(),$=p.fallback,b=o.mode,p=Dd({mode:"visible",children:p.children},b),$=ia($,b,u,null),$.flags|=2,p.return=o,$.return=o,p.sibling=$,o.child=p,ha(o,a.child,null,u),p=o.child,p.memoizedState=Xf(u),p.childLanes=Qf(a,R,u),o.memoizedState=Jf,o=Il(null,p));else if(mi(o),Mm($)){if(R=$.nextSibling&&$.nextSibling.dataset,R)var ge=R.dgst;R=ge,p=Error(r(419)),p.stack="",p.digest=R,gl({value:p,source:null,stack:null}),o=em(a,o,u)}else if(Nn||Ha(a,o,u,!1),R=(u&a.childLanes)!==0,Nn||R){if(R=Kt,R!==null&&(p=Wc(R,u),p!==0&&p!==ie.retryLane))throw ie.retryLane=p,ra(a,p),cs(R,a,p),Kf;Rm($)||Gd(),o=em(a,o,u)}else Rm($)?(o.flags|=192,o.child=a.child,o=null):(a=ie.treeContext,Zt=Ds($.nextSibling),Bn=o,Tt=!0,li=null,As=!1,a!==null&&yx(o,a),o=Zf(o,p.children),o.flags|=4096);return o}return b?(pi(),$=p.fallback,b=o.mode,ie=a.child,ge=ie.sibling,p=Nr(ie,{mode:"hidden",children:p.children}),p.subtreeFlags=ie.subtreeFlags&65011712,ge!==null?$=Nr(ge,$):($=ia($,b,u,null),$.flags|=2),$.return=o,p.return=o,p.sibling=$,o.child=p,Il(null,p),p=o.child,$=a.child.memoizedState,$===null?$=Xf(u):(b=$.cachePool,b!==null?(ie=vn._currentValue,b=b.parent!==ie?{parent:ie,pool:ie}:b):b=_x(),$={baseLanes:$.baseLanes|u,cachePool:b}),p.memoizedState=$,p.childLanes=Qf(a,R,u),o.memoizedState=Jf,Il(a.child,p)):(mi(o),u=a.child,a=u.sibling,u=Nr(u,{mode:"visible",children:p.children}),u.return=o,u.sibling=null,a!==null&&(R=o.deletions,R===null?(o.deletions=[a],o.flags|=16):R.push(a)),o.child=u,o.memoizedState=null,u)}function Zf(a,o){return o=Dd({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Dd(a,o){return a=ms(22,a,null,o),a.lanes=0,a}function em(a,o,u){return ha(o,a.child,null,u),a=Zf(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function O0(a,o,u){a.lanes|=o;var p=a.alternate;p!==null&&(p.lanes|=o),pf(a.return,o,u)}function tm(a,o,u,p,b,_){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:b,treeForkCount:_}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=p,R.tail=u,R.tailMode=b,R.treeForkCount=_)}function L0(a,o,u){var p=o.pendingProps,b=p.revealOrder,_=p.tail;p=p.children;var R=gn.current,$=(R&2)!==0;if($?(R=R&1|2,o.flags|=128):R&=1,ue(gn,R),zn(a,o,p,u),p=Tt?pl:0,!$&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&O0(a,u,o);else if(a.tag===19)O0(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(b){case"forwards":for(u=o.child,b=null;u!==null;)a=u.alternate,a!==null&&bd(a)===null&&(b=u),u=u.sibling;u=b,u===null?(b=o.child,o.child=null):(b=u.sibling,u.sibling=null),tm(o,!1,b,u,_,p);break;case"backwards":case"unstable_legacy-backwards":for(u=null,b=o.child,o.child=null;b!==null;){if(a=b.alternate,a!==null&&bd(a)===null){o.child=b;break}a=b.sibling,b.sibling=u,u=b,b=a}tm(o,!0,u,null,_,p);break;case"together":tm(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function Er(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),xi|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Ha(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(r(153));if(o.child!==null){for(a=o.child,u=Nr(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=Nr(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function nm(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&hd(a)))}function TI(a,o,u){switch(o.tag){case 3:fe(o,o.stateNode.containerInfo),di(o,vn,a.memoizedState.cache),aa();break;case 27:case 5:ee(o);break;case 4:fe(o,o.stateNode.containerInfo);break;case 10:di(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Ef(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(mi(o),o.flags|=128,null):(u&o.child.childLanes)!==0?P0(a,o,u):(mi(o),a=Er(a,o,u),a!==null?a.sibling:null);mi(o);break;case 19:var b=(a.flags&128)!==0;if(p=(u&o.childLanes)!==0,p||(Ha(a,o,u,!1),p=(u&o.childLanes)!==0),b){if(p)return L0(a,o,u);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ue(gn,gn.current),p)break;return null;case 22:return o.lanes=0,j0(a,o,u,o.pendingProps);case 24:di(o,vn,a.memoizedState.cache)}return Er(a,o,u)}function F0(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)Nn=!0;else{if(!nm(a,u)&&(o.flags&128)===0)return Nn=!1,TI(a,o,u);Nn=(a.flags&131072)!==0}else Nn=!1,Tt&&(o.flags&1048576)!==0&&gx(o,pl,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(a=da(o.elementType),o.type=a,typeof a=="function")of(a)?(p=ma(a,p),o.tag=1,o=R0(null,o,a,p,u)):(o.tag=0,o=Yf(null,o,a,p,u));else{if(a!=null){var b=a.$$typeof;if(b===k){o.tag=11,o=C0(null,o,a,p,u);break e}else if(b===O){o.tag=14,o=E0(null,o,a,p,u);break e}}throw o=J(a)||a,Error(r(306,o,""))}}return o;case 0:return Yf(a,o,o.type,o.pendingProps,u);case 1:return p=o.type,b=ma(p,o.pendingProps),R0(a,o,p,b,u);case 3:e:{if(fe(o,o.stateNode.containerInfo),a===null)throw Error(r(387));p=o.pendingProps;var _=o.memoizedState;b=_.element,Sf(a,o),_l(o,p,null,u);var R=o.memoizedState;if(p=R.cache,di(o,vn,p),p!==_.cache&&gf(o,[vn],u,!0),Sl(),p=R.element,_.isDehydrated)if(_={element:p,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){o=M0(a,o,p,u);break e}else if(p!==b){b=Es(Error(r(424)),o),gl(b),o=M0(a,o,p,u);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Zt=Ds(a.firstChild),Bn=o,Tt=!0,li=null,As=!0,u=jx(o,null,p,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(aa(),p===b){o=Er(a,o,u);break e}zn(a,o,p,u)}o=o.child}return o;case 26:return kd(a,o),a===null?(u=Yv(o.type,null,o.pendingProps,null))?o.memoizedState=u:Tt||(u=o.type,a=o.pendingProps,p=Kd(ne.current).createElement(u),p[xn]=o,p[Un]=a,Hn(p,u,a),Cn(p),o.stateNode=p):o.memoizedState=Yv(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return ee(o),a===null&&Tt&&(p=o.stateNode=Wv(o.type,o.pendingProps,ne.current),Bn=o,As=!0,b=Zt,_i(o.type)?(Pm=b,Zt=Ds(p.firstChild)):Zt=b),zn(a,o,o.pendingProps.children,u),kd(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Tt&&((b=p=Zt)&&(p=tj(p,o.type,o.pendingProps,As),p!==null?(o.stateNode=p,Bn=o,Zt=Ds(p.firstChild),As=!1,b=!0):b=!1),b||ci(o)),ee(o),b=o.type,_=o.pendingProps,R=a!==null?a.memoizedProps:null,p=_.children,Am(b,_)?p=null:R!==null&&Am(b,R)&&(o.flags|=32),o.memoizedState!==null&&(b=jf(a,o,gI,null,null,u),Hl._currentValue=b),kd(a,o),zn(a,o,p,u),o.child;case 6:return a===null&&Tt&&((a=u=Zt)&&(u=nj(u,o.pendingProps,As),u!==null?(o.stateNode=u,Bn=o,Zt=null,a=!0):a=!1),a||ci(o)),null;case 13:return P0(a,o,u);case 4:return fe(o,o.stateNode.containerInfo),p=o.pendingProps,a===null?o.child=ha(o,null,p,u):zn(a,o,p,u),o.child;case 11:return C0(a,o,o.type,o.pendingProps,u);case 7:return zn(a,o,o.pendingProps,u),o.child;case 8:return zn(a,o,o.pendingProps.children,u),o.child;case 12:return zn(a,o,o.pendingProps.children,u),o.child;case 10:return p=o.pendingProps,di(o,o.type,p.value),zn(a,o,p.children,u),o.child;case 9:return b=o.type._context,p=o.pendingProps.children,la(o),b=Gn(b),p=p(b),o.flags|=1,zn(a,o,p,u),o.child;case 14:return E0(a,o,o.type,o.pendingProps,u);case 15:return I0(a,o,o.type,o.pendingProps,u);case 19:return L0(a,o,u);case 31:return wI(a,o,u);case 22:return j0(a,o,u,o.pendingProps);case 24:return la(o),p=Gn(vn),a===null?(b=vf(),b===null&&(b=Kt,_=yf(),b.pooledCache=_,_.refCount++,_!==null&&(b.pooledCacheLanes|=u),b=_),o.memoizedState={parent:p,cache:b},Nf(o),di(o,vn,b)):((a.lanes&u)!==0&&(Sf(a,o),_l(o,null,null,u),Sl()),b=a.memoizedState,_=o.memoizedState,b.parent!==p?(b={parent:p,cache:p},o.memoizedState=b,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=b),di(o,vn,p)):(p=_.cache,di(o,vn,p),p!==b.cache&&gf(o,[vn],u,!0))),zn(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}function Ir(a){a.flags|=4}function sm(a,o,u,p,b){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(b&335544128)===b)if(a.stateNode.complete)a.flags|=8192;else if(uv())a.flags|=8192;else throw ua=gd,bf}else a.flags&=-16777217}function U0(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!eb(o))if(uv())a.flags|=8192;else throw ua=gd,bf}function Rd(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Hc():536870912,a.lanes|=o,to|=o)}function jl(a,o){if(!Tt)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function en(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,p=0;if(o)for(var b=a.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=p,a.childLanes=u,o}function CI(a,o,u){var p=o.pendingProps;switch(uf(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(o),null;case 1:return en(o),null;case 3:return u=o.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),wr(vn),Z(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(za(o)?Ir(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,ff())),en(o),null;case 26:var b=o.type,_=o.memoizedState;return a===null?(Ir(o),_!==null?(en(o),U0(o,_)):(en(o),sm(o,b,null,p,u))):_?_!==a.memoizedState?(Ir(o),en(o),U0(o,_)):(en(o),o.flags&=-16777217):(a=a.memoizedProps,a!==p&&Ir(o),en(o),sm(o,b,a,p,u)),null;case 27:if(xe(o),u=ne.current,b=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&Ir(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return en(o),null}a=Ne.current,za(o)?xx(o):(a=Wv(b,p,u),o.stateNode=a,Ir(o))}return en(o),null;case 5:if(xe(o),b=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&Ir(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return en(o),null}if(_=Ne.current,za(o))xx(o);else{var R=Kd(ne.current);switch(_){case 1:_=R.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:_=R.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":_=R.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":_=R.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":_=R.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof p.is=="string"?R.createElement("select",{is:p.is}):R.createElement("select"),p.multiple?_.multiple=!0:p.size&&(_.size=p.size);break;default:_=typeof p.is=="string"?R.createElement(b,{is:p.is}):R.createElement(b)}}_[xn]=o,_[Un]=p;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)_.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=_;e:switch(Hn(_,b,p),b){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Ir(o)}}return en(o),sm(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,u),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==p&&Ir(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(r(166));if(a=ne.current,za(o)){if(a=o.stateNode,u=o.memoizedProps,p=null,b=Bn,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}a[xn]=o,a=!!(a.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Pv(a.nodeValue,u)),a||ci(o,!0)}else a=Kd(a).createTextNode(p),a[xn]=o,o.stateNode=a}return en(o),null;case 31:if(u=o.memoizedState,a===null||a.memoizedState!==null){if(p=za(o),u!==null){if(a===null){if(!p)throw Error(r(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(557));a[xn]=o}else aa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;en(o),a=!1}else u=ff(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return o.flags&256?(gs(o),o):(gs(o),null);if((o.flags&128)!==0)throw Error(r(558))}return en(o),null;case 13:if(p=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=za(o),p!==null&&p.dehydrated!==null){if(a===null){if(!b)throw Error(r(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[xn]=o}else aa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;en(o),b=!1}else b=ff(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return o.flags&256?(gs(o),o):(gs(o),null)}return gs(o),(o.flags&128)!==0?(o.lanes=u,o):(u=p!==null,a=a!==null&&a.memoizedState!==null,u&&(p=o.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool),_=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(_=p.memoizedState.cachePool.pool),_!==b&&(p.flags|=2048)),u!==a&&u&&(o.child.flags|=8192),Rd(o,o.updateQueue),en(o),null);case 4:return Z(),a===null&&Tm(o.stateNode.containerInfo),en(o),null;case 10:return wr(o.type),en(o),null;case 19:if(ae(gn),p=o.memoizedState,p===null)return en(o),null;if(b=(o.flags&128)!==0,_=p.rendering,_===null)if(b)jl(p,!1);else{if(fn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(_=bd(a),_!==null){for(o.flags|=128,jl(p,!1),a=_.updateQueue,o.updateQueue=a,Rd(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)fx(u,a),u=u.sibling;return ue(gn,gn.current&1|2),Tt&&Sr(o,p.treeForkCount),o.child}a=a.sibling}p.tail!==null&&ut()>Fd&&(o.flags|=128,b=!0,jl(p,!1),o.lanes=4194304)}else{if(!b)if(a=bd(_),a!==null){if(o.flags|=128,b=!0,a=a.updateQueue,o.updateQueue=a,Rd(o,a),jl(p,!0),p.tail===null&&p.tailMode==="hidden"&&!_.alternate&&!Tt)return en(o),null}else 2*ut()-p.renderingStartTime>Fd&&u!==536870912&&(o.flags|=128,b=!0,jl(p,!1),o.lanes=4194304);p.isBackwards?(_.sibling=o.child,o.child=_):(a=p.last,a!==null?a.sibling=_:o.child=_,p.last=_)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=ut(),a.sibling=null,u=gn.current,ue(gn,b?u&1|2:u&1),Tt&&Sr(o,p.treeForkCount),a):(en(o),null);case 22:case 23:return gs(o),Cf(),p=o.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(u&536870912)!==0&&(o.flags&128)===0&&(en(o),o.subtreeFlags&6&&(o.flags|=8192)):en(o),u=o.updateQueue,u!==null&&Rd(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==u&&(o.flags|=2048),a!==null&&ae(ca),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),wr(vn),en(o),null;case 25:return null;case 30:return null}throw Error(r(156,o.tag))}function EI(a,o){switch(uf(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return wr(vn),Z(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return xe(o),null;case 31:if(o.memoizedState!==null){if(gs(o),o.alternate===null)throw Error(r(340));aa()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(gs(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(r(340));aa()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return ae(gn),null;case 4:return Z(),null;case 10:return wr(o.type),null;case 22:case 23:return gs(o),Cf(),a!==null&&ae(ca),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return wr(vn),null;case 25:return null;default:return null}}function B0(a,o){switch(uf(o),o.tag){case 3:wr(vn),Z();break;case 26:case 27:case 5:xe(o);break;case 4:Z();break;case 31:o.memoizedState!==null&&gs(o);break;case 13:gs(o);break;case 19:ae(gn);break;case 10:wr(o.type);break;case 22:case 23:gs(o),Cf(),a!==null&&ae(ca);break;case 24:wr(vn)}}function Al(a,o){try{var u=o.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var b=p.next;u=b;do{if((u.tag&a)===a){p=void 0;var _=u.create,R=u.inst;p=_(),R.destroy=p}u=u.next}while(u!==b)}}catch($){Bt(o,o.return,$)}}function gi(a,o,u){try{var p=o.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var _=b.next;p=_;do{if((p.tag&a)===a){var R=p.inst,$=R.destroy;if($!==void 0){R.destroy=void 0,b=o;var ie=u,ge=$;try{ge()}catch(Ee){Bt(b,ie,Ee)}}}p=p.next}while(p!==_)}}catch(Ee){Bt(o,o.return,Ee)}}function G0(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{kx(o,u)}catch(p){Bt(a,a.return,p)}}}function z0(a,o,u){u.props=ma(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(p){Bt(a,o,p)}}function kl(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof u=="function"?a.refCleanup=u(p):u.current=p}}catch(b){Bt(a,o,b)}}function lr(a,o){var u=a.ref,p=a.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(b){Bt(a,o,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(b){Bt(a,o,b)}else u.current=null}function H0(a){var o=a.type,u=a.memoizedProps,p=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(b){Bt(a,a.return,b)}}function rm(a,o,u){try{var p=a.stateNode;YI(p,a.type,u,o),p[Un]=o}catch(b){Bt(a,a.return,b)}}function V0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&_i(a.type)||a.tag===4}function im(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||V0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&_i(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function am(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=sn));else if(p!==4&&(p===27&&_i(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(am(a,o,u),a=a.sibling;a!==null;)am(a,o,u),a=a.sibling}function Md(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(p!==4&&(p===27&&_i(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(Md(a,o,u),a=a.sibling;a!==null;)Md(a,o,u),a=a.sibling}function q0(a){var o=a.stateNode,u=a.memoizedProps;try{for(var p=a.type,b=o.attributes;b.length;)o.removeAttributeNode(b[0]);Hn(o,p,u),o[xn]=a,o[Un]=u}catch(_){Bt(a,a.return,_)}}var jr=!1,Sn=!1,om=!1,W0=typeof WeakSet=="function"?WeakSet:Set,Dn=null;function II(a,o){if(a=a.containerInfo,Im=tu,a=rx(a),Zh(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var b=p.anchorOffset,_=p.focusNode;p=p.focusOffset;try{u.nodeType,_.nodeType}catch{u=null;break e}var R=0,$=-1,ie=-1,ge=0,Ee=0,je=a,ve=null;t:for(;;){for(var we;je!==u||b!==0&&je.nodeType!==3||($=R+b),je!==_||p!==0&&je.nodeType!==3||(ie=R+p),je.nodeType===3&&(R+=je.nodeValue.length),(we=je.firstChild)!==null;)ve=je,je=we;for(;;){if(je===a)break t;if(ve===u&&++ge===b&&($=R),ve===_&&++Ee===p&&(ie=R),(we=je.nextSibling)!==null)break;je=ve,ve=je.parentNode}je=we}u=$===-1||ie===-1?null:{start:$,end:ie}}else u=null}u=u||{start:0,end:0}}else u=null;for(jm={focusedElem:a,selectionRange:u},tu=!1,Dn=o;Dn!==null;)if(o=Dn,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Dn=a;else for(;Dn!==null;){switch(o=Dn,_=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)b=a[u],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&_!==null){a=void 0,u=o,b=_.memoizedProps,_=_.memoizedState,p=u.stateNode;try{var Ye=ma(u.type,b);a=p.getSnapshotBeforeUpdate(Ye,_),p.__reactInternalSnapshotBeforeUpdate=a}catch(st){Bt(u,u.return,st)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)Dm(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Dm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=o.sibling,a!==null){a.return=o.return,Dn=a;break}Dn=o.return}}function $0(a,o,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:kr(a,u),p&4&&Al(5,u);break;case 1:if(kr(a,u),p&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(R){Bt(u,u.return,R)}else{var b=ma(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(b,o,a.__reactInternalSnapshotBeforeUpdate)}catch(R){Bt(u,u.return,R)}}p&64&&G0(u),p&512&&kl(u,u.return);break;case 3:if(kr(a,u),p&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{kx(a,o)}catch(R){Bt(u,u.return,R)}}break;case 27:o===null&&p&4&&q0(u);case 26:case 5:kr(a,u),o===null&&p&4&&H0(u),p&512&&kl(u,u.return);break;case 12:kr(a,u);break;case 31:kr(a,u),p&4&&J0(a,u);break;case 13:kr(a,u),p&4&&X0(a,u),p&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=LI.bind(null,u),sj(a,u))));break;case 22:if(p=u.memoizedState!==null||jr,!p){o=o!==null&&o.memoizedState!==null||Sn,b=jr;var _=Sn;jr=p,(Sn=o)&&!_?Dr(a,u,(u.subtreeFlags&8772)!==0):kr(a,u),jr=b,Sn=_}break;case 30:break;default:kr(a,u)}}function K0(a){var o=a.alternate;o!==null&&(a.alternate=null,K0(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Yc(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var tn=null,is=!1;function Ar(a,o,u){for(u=u.child;u!==null;)Y0(a,o,u),u=u.sibling}function Y0(a,o,u){if(Ve&&typeof Ve.onCommitFiberUnmount=="function")try{Ve.onCommitFiberUnmount(Je,u)}catch{}switch(u.tag){case 26:Sn||lr(u,o),Ar(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Sn||lr(u,o);var p=tn,b=is;_i(u.type)&&(tn=u.stateNode,is=!1),Ar(a,o,u),Bl(u.stateNode),tn=p,is=b;break;case 5:Sn||lr(u,o);case 6:if(p=tn,b=is,tn=null,Ar(a,o,u),tn=p,is=b,tn!==null)if(is)try{(tn.nodeType===9?tn.body:tn.nodeName==="HTML"?tn.ownerDocument.body:tn).removeChild(u.stateNode)}catch(_){Bt(u,o,_)}else try{tn.removeChild(u.stateNode)}catch(_){Bt(u,o,_)}break;case 18:tn!==null&&(is?(a=tn,Gv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),co(a)):Gv(tn,u.stateNode));break;case 4:p=tn,b=is,tn=u.stateNode.containerInfo,is=!0,Ar(a,o,u),tn=p,is=b;break;case 0:case 11:case 14:case 15:gi(2,u,o),Sn||gi(4,u,o),Ar(a,o,u);break;case 1:Sn||(lr(u,o),p=u.stateNode,typeof p.componentWillUnmount=="function"&&z0(u,o,p)),Ar(a,o,u);break;case 21:Ar(a,o,u);break;case 22:Sn=(p=Sn)||u.memoizedState!==null,Ar(a,o,u),Sn=p;break;default:Ar(a,o,u)}}function J0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{co(a)}catch(u){Bt(o,o.return,u)}}}function X0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{co(a)}catch(u){Bt(o,o.return,u)}}function jI(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new W0),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new W0),o;default:throw Error(r(435,a.tag))}}function Pd(a,o){var u=jI(a);o.forEach(function(p){if(!u.has(p)){u.add(p);var b=FI.bind(null,a,p);p.then(b,b)}})}function as(a,o){var u=o.deletions;if(u!==null)for(var p=0;p<u.length;p++){var b=u[p],_=a,R=o,$=R;e:for(;$!==null;){switch($.tag){case 27:if(_i($.type)){tn=$.stateNode,is=!1;break e}break;case 5:tn=$.stateNode,is=!1;break e;case 3:case 4:tn=$.stateNode.containerInfo,is=!0;break e}$=$.return}if(tn===null)throw Error(r(160));Y0(_,R,b),tn=null,is=!1,_=b.alternate,_!==null&&(_.return=null),b.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Q0(o,a),o=o.sibling}var Hs=null;function Q0(a,o){var u=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:as(o,a),os(a),p&4&&(gi(3,a,a.return),Al(3,a),gi(5,a,a.return));break;case 1:as(o,a),os(a),p&512&&(Sn||u===null||lr(u,u.return)),p&64&&jr&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var b=Hs;if(as(o,a),os(a),p&512&&(Sn||u===null||lr(u,u.return)),p&4){var _=u!==null?u.memoizedState:null;if(p=a.memoizedState,u===null)if(p===null)if(a.stateNode===null){e:{p=a.type,u=a.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":_=b.getElementsByTagName("title")[0],(!_||_[Ra]||_[xn]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=b.createElement(p),b.head.insertBefore(_,b.querySelector("head > title"))),Hn(_,p,u),_[xn]=a,Cn(_),p=_;break e;case"link":var R=Qv("link","href",b).get(p+(u.href||""));if(R){for(var $=0;$<R.length;$++)if(_=R[$],_.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&_.getAttribute("rel")===(u.rel==null?null:u.rel)&&_.getAttribute("title")===(u.title==null?null:u.title)&&_.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){R.splice($,1);break t}}_=b.createElement(p),Hn(_,p,u),b.head.appendChild(_);break;case"meta":if(R=Qv("meta","content",b).get(p+(u.content||""))){for($=0;$<R.length;$++)if(_=R[$],_.getAttribute("content")===(u.content==null?null:""+u.content)&&_.getAttribute("name")===(u.name==null?null:u.name)&&_.getAttribute("property")===(u.property==null?null:u.property)&&_.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&_.getAttribute("charset")===(u.charSet==null?null:u.charSet)){R.splice($,1);break t}}_=b.createElement(p),Hn(_,p,u),b.head.appendChild(_);break;default:throw Error(r(468,p))}_[xn]=a,Cn(_),p=_}a.stateNode=p}else Zv(b,a.type,a.stateNode);else a.stateNode=Xv(b,p,a.memoizedProps);else _!==p?(_===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):_.count--,p===null?Zv(b,a.type,a.stateNode):Xv(b,p,a.memoizedProps)):p===null&&a.stateNode!==null&&rm(a,a.memoizedProps,u.memoizedProps)}break;case 27:as(o,a),os(a),p&512&&(Sn||u===null||lr(u,u.return)),u!==null&&p&4&&rm(a,a.memoizedProps,u.memoizedProps);break;case 5:if(as(o,a),os(a),p&512&&(Sn||u===null||lr(u,u.return)),a.flags&32){b=a.stateNode;try{W(b,"")}catch(Ye){Bt(a,a.return,Ye)}}p&4&&a.stateNode!=null&&(b=a.memoizedProps,rm(a,b,u!==null?u.memoizedProps:b)),p&1024&&(om=!0);break;case 6:if(as(o,a),os(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,u=a.stateNode;try{u.nodeValue=p}catch(Ye){Bt(a,a.return,Ye)}}break;case 3:if(Xd=null,b=Hs,Hs=Yd(o.containerInfo),as(o,a),Hs=b,os(a),p&4&&u!==null&&u.memoizedState.isDehydrated)try{co(o.containerInfo)}catch(Ye){Bt(a,a.return,Ye)}om&&(om=!1,Z0(a));break;case 4:p=Hs,Hs=Yd(a.stateNode.containerInfo),as(o,a),os(a),Hs=p;break;case 12:as(o,a),os(a);break;case 31:as(o,a),os(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Pd(a,p)));break;case 13:as(o,a),os(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Ld=ut()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Pd(a,p)));break;case 22:b=a.memoizedState!==null;var ie=u!==null&&u.memoizedState!==null,ge=jr,Ee=Sn;if(jr=ge||b,Sn=Ee||ie,as(o,a),Sn=Ee,jr=ge,os(a),p&8192)e:for(o=a.stateNode,o._visibility=b?o._visibility&-2:o._visibility|1,b&&(u===null||ie||jr||Sn||pa(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){ie=u=o;try{if(_=ie.stateNode,b)R=_.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{$=ie.stateNode;var je=ie.memoizedProps.style,ve=je!=null&&je.hasOwnProperty("display")?je.display:null;$.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Ye){Bt(ie,ie.return,Ye)}}}else if(o.tag===6){if(u===null){ie=o;try{ie.stateNode.nodeValue=b?"":ie.memoizedProps}catch(Ye){Bt(ie,ie.return,Ye)}}}else if(o.tag===18){if(u===null){ie=o;try{var we=ie.stateNode;b?zv(we,!0):zv(ie.stateNode,!1)}catch(Ye){Bt(ie,ie.return,Ye)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=a.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Pd(a,u))));break;case 19:as(o,a),os(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Pd(a,p)));break;case 30:break;case 21:break;default:as(o,a),os(a)}}function os(a){var o=a.flags;if(o&2){try{for(var u,p=a.return;p!==null;){if(V0(p)){u=p;break}p=p.return}if(u==null)throw Error(r(160));switch(u.tag){case 27:var b=u.stateNode,_=im(a);Md(a,_,b);break;case 5:var R=u.stateNode;u.flags&32&&(W(R,""),u.flags&=-33);var $=im(a);Md(a,$,R);break;case 3:case 4:var ie=u.stateNode.containerInfo,ge=im(a);am(a,ge,ie);break;default:throw Error(r(161))}}catch(Ee){Bt(a,a.return,Ee)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function Z0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;Z0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function kr(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)$0(a,o.alternate,o),o=o.sibling}function pa(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:gi(4,o,o.return),pa(o);break;case 1:lr(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&z0(o,o.return,u),pa(o);break;case 27:Bl(o.stateNode);case 26:case 5:lr(o,o.return),pa(o);break;case 22:o.memoizedState===null&&pa(o);break;case 30:pa(o);break;default:pa(o)}a=a.sibling}}function Dr(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,b=a,_=o,R=_.flags;switch(_.tag){case 0:case 11:case 15:Dr(b,_,u),Al(4,_);break;case 1:if(Dr(b,_,u),p=_,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ge){Bt(p,p.return,ge)}if(p=_,b=p.updateQueue,b!==null){var $=p.stateNode;try{var ie=b.shared.hiddenCallbacks;if(ie!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ie.length;b++)Ax(ie[b],$)}catch(ge){Bt(p,p.return,ge)}}u&&R&64&&G0(_),kl(_,_.return);break;case 27:q0(_);case 26:case 5:Dr(b,_,u),u&&p===null&&R&4&&H0(_),kl(_,_.return);break;case 12:Dr(b,_,u);break;case 31:Dr(b,_,u),u&&R&4&&J0(b,_);break;case 13:Dr(b,_,u),u&&R&4&&X0(b,_);break;case 22:_.memoizedState===null&&Dr(b,_,u),kl(_,_.return);break;case 30:break;default:Dr(b,_,u)}o=o.sibling}}function lm(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&yl(u))}function cm(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&yl(a))}function Vs(a,o,u,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)ev(a,o,u,p),o=o.sibling}function ev(a,o,u,p){var b=o.flags;switch(o.tag){case 0:case 11:case 15:Vs(a,o,u,p),b&2048&&Al(9,o);break;case 1:Vs(a,o,u,p);break;case 3:Vs(a,o,u,p),b&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&yl(a)));break;case 12:if(b&2048){Vs(a,o,u,p),a=o.stateNode;try{var _=o.memoizedProps,R=_.id,$=_.onPostCommit;typeof $=="function"&&$(R,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ie){Bt(o,o.return,ie)}}else Vs(a,o,u,p);break;case 31:Vs(a,o,u,p);break;case 13:Vs(a,o,u,p);break;case 23:break;case 22:_=o.stateNode,R=o.alternate,o.memoizedState!==null?_._visibility&2?Vs(a,o,u,p):Dl(a,o):_._visibility&2?Vs(a,o,u,p):(_._visibility|=2,Qa(a,o,u,p,(o.subtreeFlags&10256)!==0||!1)),b&2048&&lm(R,o);break;case 24:Vs(a,o,u,p),b&2048&&cm(o.alternate,o);break;default:Vs(a,o,u,p)}}function Qa(a,o,u,p,b){for(b=b&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var _=a,R=o,$=u,ie=p,ge=R.flags;switch(R.tag){case 0:case 11:case 15:Qa(_,R,$,ie,b),Al(8,R);break;case 23:break;case 22:var Ee=R.stateNode;R.memoizedState!==null?Ee._visibility&2?Qa(_,R,$,ie,b):Dl(_,R):(Ee._visibility|=2,Qa(_,R,$,ie,b)),b&&ge&2048&&lm(R.alternate,R);break;case 24:Qa(_,R,$,ie,b),b&&ge&2048&&cm(R.alternate,R);break;default:Qa(_,R,$,ie,b)}o=o.sibling}}function Dl(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,p=o,b=p.flags;switch(p.tag){case 22:Dl(u,p),b&2048&&lm(p.alternate,p);break;case 24:Dl(u,p),b&2048&&cm(p.alternate,p);break;default:Dl(u,p)}o=o.sibling}}var Rl=8192;function Za(a,o,u){if(a.subtreeFlags&Rl)for(a=a.child;a!==null;)tv(a,o,u),a=a.sibling}function tv(a,o,u){switch(a.tag){case 26:Za(a,o,u),a.flags&Rl&&a.memoizedState!==null&&pj(u,Hs,a.memoizedState,a.memoizedProps);break;case 5:Za(a,o,u);break;case 3:case 4:var p=Hs;Hs=Yd(a.stateNode.containerInfo),Za(a,o,u),Hs=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=Rl,Rl=16777216,Za(a,o,u),Rl=p):Za(a,o,u));break;default:Za(a,o,u)}}function nv(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Ml(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];Dn=p,rv(p,a)}nv(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)sv(a),a=a.sibling}function sv(a){switch(a.tag){case 0:case 11:case 15:Ml(a),a.flags&2048&&gi(9,a,a.return);break;case 3:Ml(a);break;case 12:Ml(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Od(a)):Ml(a);break;default:Ml(a)}}function Od(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];Dn=p,rv(p,a)}nv(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:gi(8,o,o.return),Od(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Od(o));break;default:Od(o)}a=a.sibling}}function rv(a,o){for(;Dn!==null;){var u=Dn;switch(u.tag){case 0:case 11:case 15:gi(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:yl(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,Dn=p;else e:for(u=a;Dn!==null;){p=Dn;var b=p.sibling,_=p.return;if(K0(p),p===u){Dn=null;break e}if(b!==null){b.return=_,Dn=b;break e}Dn=_}}}var AI={getCacheForType:function(a){var o=Gn(vn),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u},cacheSignal:function(){return Gn(vn).controller.signal}},kI=typeof WeakMap=="function"?WeakMap:Map,Ot=0,Kt=null,vt=null,_t=0,Ut=0,ys=null,yi=!1,eo=!1,dm=!1,Rr=0,fn=0,xi=0,ga=0,um=0,xs=0,to=0,Pl=null,ls=null,hm=!1,Ld=0,iv=0,Fd=1/0,Ud=null,vi=null,En=0,bi=null,no=null,Mr=0,fm=0,mm=null,av=null,Ol=0,pm=null;function vs(){return(Ot&2)!==0&&_t!==0?_t&-_t:G.T!==null?Nm():$c()}function ov(){if(xs===0)if((_t&536870912)===0||Tt){var a=nr;nr<<=1,(nr&3932160)===0&&(nr=262144),xs=a}else xs=536870912;return a=ps.current,a!==null&&(a.flags|=32),xs}function cs(a,o,u){(a===Kt&&(Ut===2||Ut===9)||a.cancelPendingCommit!==null)&&(so(a,0),Ni(a,_t,xs,!1)),Ji(a,u),((Ot&2)===0||a!==Kt)&&(a===Kt&&((Ot&2)===0&&(ga|=u),fn===4&&Ni(a,_t,xs,!1)),cr(a))}function lv(a,o,u){if((Ot&6)!==0)throw Error(r(327));var p=!u&&(o&127)===0&&(o&a.expiredLanes)===0||sr(a,o),b=p?MI(a,o):ym(a,o,!0),_=p;do{if(b===0){eo&&!p&&Ni(a,o,0,!1);break}else{if(u=a.current.alternate,_&&!DI(u)){b=ym(a,o,!1),_=!1;continue}if(b===2){if(_=o,a.errorRecoveryDisabledLanes&_)var R=0;else R=a.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var $=a;b=Pl;var ie=$.current.memoizedState.isDehydrated;if(ie&&(so($,R).flags|=256),R=ym($,R,!1),R!==2){if(dm&&!ie){$.errorRecoveryDisabledLanes|=_,ga|=_,b=4;break e}_=ls,ls=b,_!==null&&(ls===null?ls=_:ls.push.apply(ls,_))}b=R}if(_=!1,b!==2)continue}}if(b===1){so(a,0),Ni(a,o,0,!0);break}e:{switch(p=a,_=b,_){case 0:case 1:throw Error(r(345));case 4:if((o&4194048)!==o)break;case 6:Ni(p,o,xs,!yi);break e;case 2:ls=null;break;case 3:case 5:break;default:throw Error(r(329))}if((o&62914560)===o&&(b=Ld+300-ut(),10<b)){if(Ni(p,o,xs,!yi),ni(p,0,!0)!==0)break e;Mr=o,p.timeoutHandle=Uv(cv.bind(null,p,u,ls,Ud,hm,o,xs,ga,to,yi,_,"Throttled",-0,0),b);break e}cv(p,u,ls,Ud,hm,o,xs,ga,to,yi,_,null,-0,0)}}break}while(!0);cr(a)}function cv(a,o,u,p,b,_,R,$,ie,ge,Ee,je,ve,we){if(a.timeoutHandle=-1,je=o.subtreeFlags,je&8192||(je&16785408)===16785408){je={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:sn},tv(o,_,je);var Ye=(_&62914560)===_?Ld-ut():(_&4194048)===_?iv-ut():0;if(Ye=gj(je,Ye),Ye!==null){Mr=_,a.cancelPendingCommit=Ye(yv.bind(null,a,o,_,u,p,b,R,$,ie,Ee,je,null,ve,we)),Ni(a,_,R,!ge);return}}yv(a,o,_,u,p,b,R,$,ie)}function DI(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var b=u[p],_=b.getSnapshot;b=b.value;try{if(!fs(_(),b))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ni(a,o,u,p){o&=~um,o&=~ga,a.suspendedLanes|=o,a.pingedLanes&=~o,p&&(a.warmLanes|=o),p=a.expirationTimes;for(var b=o;0<b;){var _=31-rt(b),R=1<<_;p[_]=-1,b&=~R}u!==0&&Vc(a,u,o)}function Bd(){return(Ot&6)===0?(Ll(0),!1):!0}function gm(){if(vt!==null){if(Ut===0)var a=vt.return;else a=vt,_r=oa=null,Df(a),$a=null,vl=0,a=vt;for(;a!==null;)B0(a.alternate,a),a=a.return;vt=null}}function so(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,QI(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Mr=0,gm(),Kt=a,vt=u=Nr(a.current,null),_t=o,Ut=0,ys=null,yi=!1,eo=sr(a,o),dm=!1,to=xs=um=ga=xi=fn=0,ls=Pl=null,hm=!1,(o&8)!==0&&(o|=o&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=o;0<p;){var b=31-rt(p),_=1<<b;o|=a[b],p&=~_}return Rr=o,od(),u}function dv(a,o){ht=null,G.H=El,o===Wa||o===pd?(o=Cx(),Ut=3):o===bf?(o=Cx(),Ut=4):Ut=o===Kf?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ys=o,vt===null&&(fn=1,jd(a,Es(o,a.current)))}function uv(){var a=ps.current;return a===null?!0:(_t&4194048)===_t?ks===null:(_t&62914560)===_t||(_t&536870912)!==0?a===ks:!1}function hv(){var a=G.H;return G.H=El,a===null?El:a}function fv(){var a=G.A;return G.A=AI,a}function Gd(){fn=4,yi||(_t&4194048)!==_t&&ps.current!==null||(eo=!0),(xi&134217727)===0&&(ga&134217727)===0||Kt===null||Ni(Kt,_t,xs,!1)}function ym(a,o,u){var p=Ot;Ot|=2;var b=hv(),_=fv();(Kt!==a||_t!==o)&&(Ud=null,so(a,o)),o=!1;var R=fn;e:do try{if(Ut!==0&&vt!==null){var $=vt,ie=ys;switch(Ut){case 8:gm(),R=6;break e;case 3:case 2:case 9:case 6:ps.current===null&&(o=!0);var ge=Ut;if(Ut=0,ys=null,ro(a,$,ie,ge),u&&eo){R=0;break e}break;default:ge=Ut,Ut=0,ys=null,ro(a,$,ie,ge)}}RI(),R=fn;break}catch(Ee){dv(a,Ee)}while(!0);return o&&a.shellSuspendCounter++,_r=oa=null,Ot=p,G.H=b,G.A=_,vt===null&&(Kt=null,_t=0,od()),R}function RI(){for(;vt!==null;)mv(vt)}function MI(a,o){var u=Ot;Ot|=2;var p=hv(),b=fv();Kt!==a||_t!==o?(Ud=null,Fd=ut()+500,so(a,o)):eo=sr(a,o);e:do try{if(Ut!==0&&vt!==null){o=vt;var _=ys;t:switch(Ut){case 1:Ut=0,ys=null,ro(a,o,_,1);break;case 2:case 9:if(wx(_)){Ut=0,ys=null,pv(o);break}o=function(){Ut!==2&&Ut!==9||Kt!==a||(Ut=7),cr(a)},_.then(o,o);break e;case 3:Ut=7;break e;case 4:Ut=5;break e;case 7:wx(_)?(Ut=0,ys=null,pv(o)):(Ut=0,ys=null,ro(a,o,_,7));break;case 5:var R=null;switch(vt.tag){case 26:R=vt.memoizedState;case 5:case 27:var $=vt;if(R?eb(R):$.stateNode.complete){Ut=0,ys=null;var ie=$.sibling;if(ie!==null)vt=ie;else{var ge=$.return;ge!==null?(vt=ge,zd(ge)):vt=null}break t}}Ut=0,ys=null,ro(a,o,_,5);break;case 6:Ut=0,ys=null,ro(a,o,_,6);break;case 8:gm(),fn=6;break e;default:throw Error(r(462))}}PI();break}catch(Ee){dv(a,Ee)}while(!0);return _r=oa=null,G.H=p,G.A=b,Ot=u,vt!==null?0:(Kt=null,_t=0,od(),fn)}function PI(){for(;vt!==null&&!et();)mv(vt)}function mv(a){var o=F0(a.alternate,a,Rr);a.memoizedProps=a.pendingProps,o===null?zd(a):vt=o}function pv(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=D0(u,o,o.pendingProps,o.type,void 0,_t);break;case 11:o=D0(u,o,o.pendingProps,o.type.render,o.ref,_t);break;case 5:Df(o);default:B0(u,o),o=vt=fx(o,Rr),o=F0(u,o,Rr)}a.memoizedProps=a.pendingProps,o===null?zd(a):vt=o}function ro(a,o,u,p){_r=oa=null,Df(o),$a=null,vl=0;var b=o.return;try{if(_I(a,b,o,u,_t)){fn=1,jd(a,Es(u,a.current)),vt=null;return}}catch(_){if(b!==null)throw vt=b,_;fn=1,jd(a,Es(u,a.current)),vt=null;return}o.flags&32768?(Tt||p===1?a=!0:eo||(_t&536870912)!==0?a=!1:(yi=a=!0,(p===2||p===9||p===3||p===6)&&(p=ps.current,p!==null&&p.tag===13&&(p.flags|=16384))),gv(o,a)):zd(o)}function zd(a){var o=a;do{if((o.flags&32768)!==0){gv(o,yi);return}a=o.return;var u=CI(o.alternate,o,Rr);if(u!==null){vt=u;return}if(o=o.sibling,o!==null){vt=o;return}vt=o=a}while(o!==null);fn===0&&(fn=5)}function gv(a,o){do{var u=EI(a.alternate,a);if(u!==null){u.flags&=32767,vt=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){vt=a;return}vt=a=u}while(a!==null);fn=6,vt=null}function yv(a,o,u,p,b,_,R,$,ie){a.cancelPendingCommit=null;do Hd();while(En!==0);if((Ot&6)!==0)throw Error(r(327));if(o!==null){if(o===a.current)throw Error(r(177));if(_=o.lanes|o.childLanes,_|=rf,Ph(a,u,_,R,$,ie),a===Kt&&(vt=Kt=null,_t=0),no=o,bi=a,Mr=u,fm=_,mm=b,av=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,UI(on,function(){return Sv(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=G.T,G.T=null,b=B.p,B.p=2,R=Ot,Ot|=4;try{II(a,o,u)}finally{Ot=R,B.p=b,G.T=p}}En=1,xv(),vv(),bv()}}function xv(){if(En===1){En=0;var a=bi,o=no,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=G.T,G.T=null;var p=B.p;B.p=2;var b=Ot;Ot|=4;try{Q0(o,a);var _=jm,R=rx(a.containerInfo),$=_.focusedElem,ie=_.selectionRange;if(R!==$&&$&&$.ownerDocument&&sx($.ownerDocument.documentElement,$)){if(ie!==null&&Zh($)){var ge=ie.start,Ee=ie.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in $)$.selectionStart=ge,$.selectionEnd=Math.min(Ee,$.value.length);else{var je=$.ownerDocument||document,ve=je&&je.defaultView||window;if(ve.getSelection){var we=ve.getSelection(),Ye=$.textContent.length,st=Math.min(ie.start,Ye),Ht=ie.end===void 0?st:Math.min(ie.end,Ye);!we.extend&&st>Ht&&(R=Ht,Ht=st,st=R);var he=nx($,st),ce=nx($,Ht);if(he&&ce&&(we.rangeCount!==1||we.anchorNode!==he.node||we.anchorOffset!==he.offset||we.focusNode!==ce.node||we.focusOffset!==ce.offset)){var pe=je.createRange();pe.setStart(he.node,he.offset),we.removeAllRanges(),st>Ht?(we.addRange(pe),we.extend(ce.node,ce.offset)):(pe.setEnd(ce.node,ce.offset),we.addRange(pe))}}}}for(je=[],we=$;we=we.parentNode;)we.nodeType===1&&je.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof $.focus=="function"&&$.focus(),$=0;$<je.length;$++){var Ie=je[$];Ie.element.scrollLeft=Ie.left,Ie.element.scrollTop=Ie.top}}tu=!!Im,jm=Im=null}finally{Ot=b,B.p=p,G.T=u}}a.current=o,En=2}}function vv(){if(En===2){En=0;var a=bi,o=no,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=G.T,G.T=null;var p=B.p;B.p=2;var b=Ot;Ot|=4;try{$0(a,o.alternate,o)}finally{Ot=b,B.p=p,G.T=u}}En=3}}function bv(){if(En===4||En===3){En=0,Lt();var a=bi,o=no,u=Mr,p=av;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?En=5:(En=0,no=bi=null,Nv(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(vi=null),el(u),o=o.stateNode,Ve&&typeof Ve.onCommitFiberRoot=="function")try{Ve.onCommitFiberRoot(Je,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=G.T,b=B.p,B.p=2,G.T=null;try{for(var _=a.onRecoverableError,R=0;R<p.length;R++){var $=p[R];_($.value,{componentStack:$.stack})}}finally{G.T=o,B.p=b}}(Mr&3)!==0&&Hd(),cr(a),b=a.pendingLanes,(u&261930)!==0&&(b&42)!==0?a===pm?Ol++:(Ol=0,pm=a):Ol=0,Ll(0)}}function Nv(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,yl(o)))}function Hd(){return xv(),vv(),bv(),Sv()}function Sv(){if(En!==5)return!1;var a=bi,o=fm;fm=0;var u=el(Mr),p=G.T,b=B.p;try{B.p=32>u?32:u,G.T=null,u=mm,mm=null;var _=bi,R=Mr;if(En=0,no=bi=null,Mr=0,(Ot&6)!==0)throw Error(r(331));var $=Ot;if(Ot|=4,sv(_.current),ev(_,_.current,R,u),Ot=$,Ll(0,!1),Ve&&typeof Ve.onPostCommitFiberRoot=="function")try{Ve.onPostCommitFiberRoot(Je,_)}catch{}return!0}finally{B.p=b,G.T=p,Nv(a,o)}}function _v(a,o,u){o=Es(u,o),o=$f(a.stateNode,o,2),a=fi(a,o,2),a!==null&&(Ji(a,2),cr(a))}function Bt(a,o,u){if(a.tag===3)_v(a,a,u);else for(;o!==null;){if(o.tag===3){_v(o,a,u);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(vi===null||!vi.has(p))){a=Es(u,a),u=w0(2),p=fi(o,u,2),p!==null&&(T0(u,p,o,a),Ji(p,2),cr(p));break}}o=o.return}}function xm(a,o,u){var p=a.pingCache;if(p===null){p=a.pingCache=new kI;var b=new Set;p.set(o,b)}else b=p.get(o),b===void 0&&(b=new Set,p.set(o,b));b.has(u)||(dm=!0,b.add(u),a=OI.bind(null,a,o,u),o.then(a,a))}function OI(a,o,u){var p=a.pingCache;p!==null&&p.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Kt===a&&(_t&u)===u&&(fn===4||fn===3&&(_t&62914560)===_t&&300>ut()-Ld?(Ot&2)===0&&so(a,0):um|=u,to===_t&&(to=0)),cr(a)}function wv(a,o){o===0&&(o=Hc()),a=ra(a,o),a!==null&&(Ji(a,o),cr(a))}function LI(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),wv(a,u)}function FI(a,o){var u=0;switch(a.tag){case 31:case 13:var p=a.stateNode,b=a.memoizedState;b!==null&&(u=b.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(o),wv(a,u)}function UI(a,o){return ye(a,o)}var Vd=null,io=null,vm=!1,qd=!1,bm=!1,Si=0;function cr(a){a!==io&&a.next===null&&(io===null?Vd=io=a:io=io.next=a),qd=!0,vm||(vm=!0,GI())}function Ll(a,o){if(!bm&&qd){bm=!0;do for(var u=!1,p=Vd;p!==null;){if(a!==0){var b=p.pendingLanes;if(b===0)var _=0;else{var R=p.suspendedLanes,$=p.pingedLanes;_=(1<<31-rt(42|a)+1)-1,_&=b&~(R&~$),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(u=!0,Iv(p,_))}else _=_t,_=ni(p,p===Kt?_:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(_&3)===0||sr(p,_)||(u=!0,Iv(p,_));p=p.next}while(u);bm=!1}}function BI(){Tv()}function Tv(){qd=vm=!1;var a=0;Si!==0&&XI()&&(a=Si);for(var o=ut(),u=null,p=Vd;p!==null;){var b=p.next,_=Cv(p,o);_===0?(p.next=null,u===null?Vd=b:u.next=b,b===null&&(io=u)):(u=p,(a!==0||(_&3)!==0)&&(qd=!0)),p=b}En!==0&&En!==5||Ll(a),Si!==0&&(Si=0)}function Cv(a,o){for(var u=a.suspendedLanes,p=a.pingedLanes,b=a.expirationTimes,_=a.pendingLanes&-62914561;0<_;){var R=31-rt(_),$=1<<R,ie=b[R];ie===-1?(($&u)===0||($&p)!==0)&&(b[R]=Mh($,o)):ie<=o&&(a.expiredLanes|=$),_&=~$}if(o=Kt,u=_t,u=ni(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,u===0||a===o&&(Ut===2||Ut===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&Fe(p),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||sr(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(p!==null&&Fe(p),el(u)){case 2:case 8:u=St;break;case 32:u=on;break;case 268435456:u=gr;break;default:u=on}return p=Ev.bind(null,a),u=ye(u,p),a.callbackPriority=o,a.callbackNode=u,o}return p!==null&&p!==null&&Fe(p),a.callbackPriority=2,a.callbackNode=null,2}function Ev(a,o){if(En!==0&&En!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Hd()&&a.callbackNode!==u)return null;var p=_t;return p=ni(a,a===Kt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(lv(a,p,o),Cv(a,ut()),a.callbackNode!=null&&a.callbackNode===u?Ev.bind(null,a):null)}function Iv(a,o){if(Hd())return null;lv(a,o,!0)}function GI(){ZI(function(){(Ot&6)!==0?ye(Pt,BI):Tv()})}function Nm(){if(Si===0){var a=Va;a===0&&(a=Tn,Tn<<=1,(Tn&261888)===0&&(Tn=256)),Si=a}return Si}function jv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:cn(""+a)}function Av(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function zI(a,o,u,p,b){if(o==="submit"&&u&&u.stateNode===b){var _=jv((b[Un]||null).action),R=p.submitter;R&&(o=(o=R[Un]||null)?jv(o.formAction):R.getAttribute("formAction"),o!==null&&(_=o,R=null));var $=new sd("action","action",null,p,b);a.push({event:$,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Si!==0){var ie=R?Av(b,R):new FormData(b);Gf(u,{pending:!0,data:ie,method:b.method,action:_},null,ie)}}else typeof _=="function"&&($.preventDefault(),ie=R?Av(b,R):new FormData(b),Gf(u,{pending:!0,data:ie,method:b.method,action:_},_,ie))},currentTarget:b}]})}}for(var Sm=0;Sm<sf.length;Sm++){var _m=sf[Sm],HI=_m.toLowerCase(),VI=_m[0].toUpperCase()+_m.slice(1);zs(HI,"on"+VI)}zs(ox,"onAnimationEnd"),zs(lx,"onAnimationIteration"),zs(cx,"onAnimationStart"),zs("dblclick","onDoubleClick"),zs("focusin","onFocus"),zs("focusout","onBlur"),zs(aI,"onTransitionRun"),zs(oI,"onTransitionStart"),zs(lI,"onTransitionCancel"),zs(dx,"onTransitionEnd"),ea("onMouseEnter",["mouseout","mouseover"]),ea("onMouseLeave",["mouseout","mouseover"]),ea("onPointerEnter",["pointerout","pointerover"]),ea("onPointerLeave",["pointerout","pointerover"]),si("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),si("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),si("onBeforeInput",["compositionend","keypress","textInput","paste"]),si("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fl));function kv(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var p=a[u],b=p.event;p=p.listeners;e:{var _=void 0;if(o)for(var R=p.length-1;0<=R;R--){var $=p[R],ie=$.instance,ge=$.currentTarget;if($=$.listener,ie!==_&&b.isPropagationStopped())break e;_=$,b.currentTarget=ge;try{_(b)}catch(Ee){ad(Ee)}b.currentTarget=null,_=ie}else for(R=0;R<p.length;R++){if($=p[R],ie=$.instance,ge=$.currentTarget,$=$.listener,ie!==_&&b.isPropagationStopped())break e;_=$,b.currentTarget=ge;try{_(b)}catch(Ee){ad(Ee)}b.currentTarget=null,_=ie}}}}function bt(a,o){var u=o[tl];u===void 0&&(u=o[tl]=new Set);var p=a+"__bubble";u.has(p)||(Dv(o,a,2,!1),u.add(p))}function wm(a,o,u){var p=0;o&&(p|=4),Dv(u,a,p,o)}var Wd="_reactListening"+Math.random().toString(36).slice(2);function Tm(a){if(!a[Wd]){a[Wd]=!0,Lh.forEach(function(u){u!=="selectionchange"&&(qI.has(u)||wm(u,!1,a),wm(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Wd]||(o[Wd]=!0,wm("selectionchange",!1,o))}}function Dv(a,o,u,p){switch(ob(o)){case 2:var b=vj;break;case 8:b=bj;break;default:b=Bm}u=b.bind(null,o,u,a),b=void 0,!Vh||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),p?b!==void 0?a.addEventListener(o,u,{capture:!0,passive:b}):a.addEventListener(o,u,!0):b!==void 0?a.addEventListener(o,u,{passive:b}):a.addEventListener(o,u,!1)}function Cm(a,o,u,p,b){var _=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var $=p.stateNode.containerInfo;if($===b)break;if(R===4)for(R=p.return;R!==null;){var ie=R.tag;if((ie===3||ie===4)&&R.stateNode.containerInfo===b)return;R=R.return}for(;$!==null;){if(R=Xi($),R===null)return;if(ie=R.tag,ie===5||ie===6||ie===26||ie===27){p=_=R;continue e}$=$.parentNode}}p=p.return}Zc(function(){var ge=_,Ee=Kn(u),je=[];e:{var ve=ux.get(a);if(ve!==void 0){var we=sd,Ye=a;switch(a){case"keypress":if(td(u)===0)break e;case"keydown":case"keyup":we=FE;break;case"focusin":Ye="focus",we=Kh;break;case"focusout":Ye="blur",we=Kh;break;case"beforeblur":case"afterblur":we=Kh;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=By;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=CE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=GE;break;case ox:case lx:case cx:we=jE;break;case dx:we=HE;break;case"scroll":case"scrollend":we=wE;break;case"wheel":we=qE;break;case"copy":case"cut":case"paste":we=kE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=zy;break;case"toggle":case"beforetoggle":we=$E}var st=(o&4)!==0,Ht=!st&&(a==="scroll"||a==="scrollend"),he=st?ve!==null?ve+"Capture":null:ve;st=[];for(var ce=ge,pe;ce!==null;){var Ie=ce;if(pe=Ie.stateNode,Ie=Ie.tag,Ie!==5&&Ie!==26&&Ie!==27||pe===null||he===null||(Ie=al(ce,he),Ie!=null&&st.push(Ul(ce,Ie,pe))),Ht)break;ce=ce.return}0<st.length&&(ve=new we(ve,Ye,null,u,Ee),je.push({event:ve,listeners:st}))}}if((o&7)===0){e:{if(ve=a==="mouseover"||a==="pointerover",we=a==="mouseout"||a==="pointerout",ve&&u!==dn&&(Ye=u.relatedTarget||u.fromElement)&&(Xi(Ye)||Ye[yr]))break e;if((we||ve)&&(ve=Ee.window===Ee?Ee:(ve=Ee.ownerDocument)?ve.defaultView||ve.parentWindow:window,we?(Ye=u.relatedTarget||u.toElement,we=ge,Ye=Ye?Xi(Ye):null,Ye!==null&&(Ht=l(Ye),st=Ye.tag,Ye!==Ht||st!==5&&st!==27&&st!==6)&&(Ye=null)):(we=null,Ye=ge),we!==Ye)){if(st=By,Ie="onMouseLeave",he="onMouseEnter",ce="mouse",(a==="pointerout"||a==="pointerover")&&(st=zy,Ie="onPointerLeave",he="onPointerEnter",ce="pointer"),Ht=we==null?ve:Ma(we),pe=Ye==null?ve:Ma(Ye),ve=new st(Ie,ce+"leave",we,u,Ee),ve.target=Ht,ve.relatedTarget=pe,Ie=null,Xi(Ee)===ge&&(st=new st(he,ce+"enter",Ye,u,Ee),st.target=pe,st.relatedTarget=Ht,Ie=st),Ht=Ie,we&&Ye)t:{for(st=WI,he=we,ce=Ye,pe=0,Ie=he;Ie;Ie=st(Ie))pe++;Ie=0;for(var tt=ce;tt;tt=st(tt))Ie++;for(;0<pe-Ie;)he=st(he),pe--;for(;0<Ie-pe;)ce=st(ce),Ie--;for(;pe--;){if(he===ce||ce!==null&&he===ce.alternate){st=he;break t}he=st(he),ce=st(ce)}st=null}else st=null;we!==null&&Rv(je,ve,we,st,!1),Ye!==null&&Ht!==null&&Rv(je,Ht,Ye,st,!0)}}e:{if(ve=ge?Ma(ge):window,we=ve.nodeName&&ve.nodeName.toLowerCase(),we==="select"||we==="input"&&ve.type==="file")var At=Jy;else if(Ky(ve))if(Xy)At=sI;else{At=tI;var Qe=eI}else we=ve.nodeName,!we||we.toLowerCase()!=="input"||ve.type!=="checkbox"&&ve.type!=="radio"?ge&&Ze(ge.elementType)&&(At=Jy):At=nI;if(At&&(At=At(a,ge))){Yy(je,At,u,Ee);break e}Qe&&Qe(a,ve,ge),a==="focusout"&&ge&&ve.type==="number"&&ge.memoizedProps.value!=null&&Qc(ve,"number",ve.value)}switch(Qe=ge?Ma(ge):window,a){case"focusin":(Ky(Qe)||Qe.contentEditable==="true")&&(Oa=Qe,ef=ge,ml=null);break;case"focusout":ml=ef=Oa=null;break;case"mousedown":tf=!0;break;case"contextmenu":case"mouseup":case"dragend":tf=!1,ix(je,u,Ee);break;case"selectionchange":if(iI)break;case"keydown":case"keyup":ix(je,u,Ee)}var ft;if(Jh)e:{switch(a){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else Pa?Wy(a,u)&&(wt="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(wt="onCompositionStart");wt&&(Hy&&u.locale!=="ko"&&(Pa||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&Pa&&(ft=Fy()):(ai=Ee,qh="value"in ai?ai.value:ai.textContent,Pa=!0)),Qe=$d(ge,wt),0<Qe.length&&(wt=new Gy(wt,a,null,u,Ee),je.push({event:wt,listeners:Qe}),ft?wt.data=ft:(ft=$y(u),ft!==null&&(wt.data=ft)))),(ft=YE?JE(a,u):XE(a,u))&&(wt=$d(ge,"onBeforeInput"),0<wt.length&&(Qe=new Gy("onBeforeInput","beforeinput",null,u,Ee),je.push({event:Qe,listeners:wt}),Qe.data=ft)),zI(je,a,ge,u,Ee)}kv(je,o)})}function Ul(a,o,u){return{instance:a,listener:o,currentTarget:u}}function $d(a,o){for(var u=o+"Capture",p=[];a!==null;){var b=a,_=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||_===null||(b=al(a,u),b!=null&&p.unshift(Ul(a,b,_)),b=al(a,o),b!=null&&p.push(Ul(a,b,_))),a.tag===3)return p;a=a.return}return[]}function WI(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Rv(a,o,u,p,b){for(var _=o._reactName,R=[];u!==null&&u!==p;){var $=u,ie=$.alternate,ge=$.stateNode;if($=$.tag,ie!==null&&ie===p)break;$!==5&&$!==26&&$!==27||ge===null||(ie=ge,b?(ge=al(u,_),ge!=null&&R.unshift(Ul(u,ge,ie))):b||(ge=al(u,_),ge!=null&&R.push(Ul(u,ge,ie)))),u=u.return}R.length!==0&&a.push({event:o,listeners:R})}var $I=/\r\n?/g,KI=/\u0000|\uFFFD/g;function Mv(a){return(typeof a=="string"?a:""+a).replace($I,`
`).replace(KI,"")}function Pv(a,o){return o=Mv(o),Mv(a)===o}function zt(a,o,u,p,b,_){switch(u){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||W(a,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&W(a,""+p);break;case"className":rl(a,"class",p);break;case"tabIndex":rl(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":rl(a,u,p);break;case"style":Pe(a,p,_);break;case"data":if(o!=="object"){rl(a,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=cn(""+p),a.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(u==="formAction"?(o!=="input"&&zt(a,o,"name",b.name,b,null),zt(a,o,"formEncType",b.formEncType,b,null),zt(a,o,"formMethod",b.formMethod,b,null),zt(a,o,"formTarget",b.formTarget,b,null)):(zt(a,o,"encType",b.encType,b,null),zt(a,o,"method",b.method,b,null),zt(a,o,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=cn(""+p),a.setAttribute(u,p);break;case"onClick":p!=null&&(a.onclick=sn);break;case"onScroll":p!=null&&bt("scroll",a);break;case"onScrollEnd":p!=null&&bt("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}u=cn(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""+p):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":p===!0?a.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,p):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(u,p):a.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(u):a.setAttribute(u,p);break;case"popover":bt("beforetoggle",a),bt("toggle",a),sl(a,"popover",p);break;case"xlinkActuate":ir(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":ir(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":ir(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":ir(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":ir(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":ir(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":ir(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":ir(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":ir(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":sl(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=pt.get(u)||u,sl(a,u,p))}}function Em(a,o,u,p,b,_){switch(u){case"style":Pe(a,p,_);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"children":typeof p=="string"?W(a,p):(typeof p=="number"||typeof p=="bigint")&&W(a,""+p);break;case"onScroll":p!=null&&bt("scroll",a);break;case"onScrollEnd":p!=null&&bt("scrollend",a);break;case"onClick":p!=null&&(a.onclick=sn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Fh.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(b=u.endsWith("Capture"),o=u.slice(2,b?u.length-7:void 0),_=a[Un]||null,_=_!=null?_[u]:null,typeof _=="function"&&a.removeEventListener(o,_,b),typeof p=="function")){typeof _!="function"&&_!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,p,b);break e}u in a?a[u]=p:p===!0?a.setAttribute(u,""):sl(a,u,p)}}}function Hn(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":bt("error",a),bt("load",a);var p=!1,b=!1,_;for(_ in u)if(u.hasOwnProperty(_)){var R=u[_];if(R!=null)switch(_){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:zt(a,o,_,R,u,null)}}b&&zt(a,o,"srcSet",u.srcSet,u,null),p&&zt(a,o,"src",u.src,u,null);return;case"input":bt("invalid",a);var $=_=R=b=null,ie=null,ge=null;for(p in u)if(u.hasOwnProperty(p)){var Ee=u[p];if(Ee!=null)switch(p){case"name":b=Ee;break;case"type":R=Ee;break;case"checked":ie=Ee;break;case"defaultChecked":ge=Ee;break;case"value":_=Ee;break;case"defaultValue":$=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,o));break;default:zt(a,o,p,Ee,u,null)}}Hh(a,_,$,ie,ge,R,b,!1);return;case"select":bt("invalid",a),p=R=_=null;for(b in u)if(u.hasOwnProperty(b)&&($=u[b],$!=null))switch(b){case"value":_=$;break;case"defaultValue":R=$;break;case"multiple":p=$;default:zt(a,o,b,$,u,null)}o=_,u=R,a.multiple=!!p,o!=null?ri(a,!!p,o,!1):u!=null&&ri(a,!!p,u,!0);return;case"textarea":bt("invalid",a),_=b=p=null;for(R in u)if(u.hasOwnProperty(R)&&($=u[R],$!=null))switch(R){case"value":p=$;break;case"defaultValue":b=$;break;case"children":_=$;break;case"dangerouslySetInnerHTML":if($!=null)throw Error(r(91));break;default:zt(a,o,R,$,u,null)}X(a,p,b,_);return;case"option":for(ie in u)if(u.hasOwnProperty(ie)&&(p=u[ie],p!=null))switch(ie){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:zt(a,o,ie,p,u,null)}return;case"dialog":bt("beforetoggle",a),bt("toggle",a),bt("cancel",a),bt("close",a);break;case"iframe":case"object":bt("load",a);break;case"video":case"audio":for(p=0;p<Fl.length;p++)bt(Fl[p],a);break;case"image":bt("error",a),bt("load",a);break;case"details":bt("toggle",a);break;case"embed":case"source":case"link":bt("error",a),bt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in u)if(u.hasOwnProperty(ge)&&(p=u[ge],p!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:zt(a,o,ge,p,u,null)}return;default:if(Ze(o)){for(Ee in u)u.hasOwnProperty(Ee)&&(p=u[Ee],p!==void 0&&Em(a,o,Ee,p,u,void 0));return}}for($ in u)u.hasOwnProperty($)&&(p=u[$],p!=null&&zt(a,o,$,p,u,null))}function YI(a,o,u,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,_=null,R=null,$=null,ie=null,ge=null,Ee=null;for(we in u){var je=u[we];if(u.hasOwnProperty(we)&&je!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":ie=je;default:p.hasOwnProperty(we)||zt(a,o,we,null,p,je)}}for(var ve in p){var we=p[ve];if(je=u[ve],p.hasOwnProperty(ve)&&(we!=null||je!=null))switch(ve){case"type":_=we;break;case"name":b=we;break;case"checked":ge=we;break;case"defaultChecked":Ee=we;break;case"value":R=we;break;case"defaultValue":$=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,o));break;default:we!==je&&zt(a,o,ve,we,p,je)}}Xc(a,R,$,ie,ge,Ee,_,b);return;case"select":we=R=$=ve=null;for(_ in u)if(ie=u[_],u.hasOwnProperty(_)&&ie!=null)switch(_){case"value":break;case"multiple":we=ie;default:p.hasOwnProperty(_)||zt(a,o,_,null,p,ie)}for(b in p)if(_=p[b],ie=u[b],p.hasOwnProperty(b)&&(_!=null||ie!=null))switch(b){case"value":ve=_;break;case"defaultValue":$=_;break;case"multiple":R=_;default:_!==ie&&zt(a,o,b,_,p,ie)}o=$,u=R,p=we,ve!=null?ri(a,!!u,ve,!1):!!p!=!!u&&(o!=null?ri(a,!!u,o,!0):ri(a,!!u,u?[]:"",!1));return;case"textarea":we=ve=null;for($ in u)if(b=u[$],u.hasOwnProperty($)&&b!=null&&!p.hasOwnProperty($))switch($){case"value":break;case"children":break;default:zt(a,o,$,null,p,b)}for(R in p)if(b=p[R],_=u[R],p.hasOwnProperty(R)&&(b!=null||_!=null))switch(R){case"value":ve=b;break;case"defaultValue":we=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==_&&zt(a,o,R,b,p,_)}V(a,ve,we);return;case"option":for(var Ye in u)if(ve=u[Ye],u.hasOwnProperty(Ye)&&ve!=null&&!p.hasOwnProperty(Ye))switch(Ye){case"selected":a.selected=!1;break;default:zt(a,o,Ye,null,p,ve)}for(ie in p)if(ve=p[ie],we=u[ie],p.hasOwnProperty(ie)&&ve!==we&&(ve!=null||we!=null))switch(ie){case"selected":a.selected=ve&&typeof ve!="function"&&typeof ve!="symbol";break;default:zt(a,o,ie,ve,p,we)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in u)ve=u[st],u.hasOwnProperty(st)&&ve!=null&&!p.hasOwnProperty(st)&&zt(a,o,st,null,p,ve);for(ge in p)if(ve=p[ge],we=u[ge],p.hasOwnProperty(ge)&&ve!==we&&(ve!=null||we!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(r(137,o));break;default:zt(a,o,ge,ve,p,we)}return;default:if(Ze(o)){for(var Ht in u)ve=u[Ht],u.hasOwnProperty(Ht)&&ve!==void 0&&!p.hasOwnProperty(Ht)&&Em(a,o,Ht,void 0,p,ve);for(Ee in p)ve=p[Ee],we=u[Ee],!p.hasOwnProperty(Ee)||ve===we||ve===void 0&&we===void 0||Em(a,o,Ee,ve,p,we);return}}for(var he in u)ve=u[he],u.hasOwnProperty(he)&&ve!=null&&!p.hasOwnProperty(he)&&zt(a,o,he,null,p,ve);for(je in p)ve=p[je],we=u[je],!p.hasOwnProperty(je)||ve===we||ve==null&&we==null||zt(a,o,je,ve,p,we)}function Ov(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function JI(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,u=performance.getEntriesByType("resource"),p=0;p<u.length;p++){var b=u[p],_=b.transferSize,R=b.initiatorType,$=b.duration;if(_&&$&&Ov(R)){for(R=0,$=b.responseEnd,p+=1;p<u.length;p++){var ie=u[p],ge=ie.startTime;if(ge>$)break;var Ee=ie.transferSize,je=ie.initiatorType;Ee&&Ov(je)&&(ie=ie.responseEnd,R+=Ee*(ie<$?1:($-ge)/(ie-ge)))}if(--p,o+=8*(_+R)/(b.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Im=null,jm=null;function Kd(a){return a.nodeType===9?a:a.ownerDocument}function Lv(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Fv(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function Am(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var km=null;function XI(){var a=window.event;return a&&a.type==="popstate"?a===km?!1:(km=a,!0):(km=null,!1)}var Uv=typeof setTimeout=="function"?setTimeout:void 0,QI=typeof clearTimeout=="function"?clearTimeout:void 0,Bv=typeof Promise=="function"?Promise:void 0,ZI=typeof queueMicrotask=="function"?queueMicrotask:typeof Bv<"u"?function(a){return Bv.resolve(null).then(a).catch(ej)}:Uv;function ej(a){setTimeout(function(){throw a})}function _i(a){return a==="head"}function Gv(a,o){var u=o,p=0;do{var b=u.nextSibling;if(a.removeChild(u),b&&b.nodeType===8)if(u=b.data,u==="/$"||u==="/&"){if(p===0){a.removeChild(b),co(o);return}p--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")p++;else if(u==="html")Bl(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,Bl(u);for(var _=u.firstChild;_;){var R=_.nextSibling,$=_.nodeName;_[Ra]||$==="SCRIPT"||$==="STYLE"||$==="LINK"&&_.rel.toLowerCase()==="stylesheet"||u.removeChild(_),_=R}}else u==="body"&&Bl(a.ownerDocument.body);u=b}while(u);co(o)}function zv(a,o){var u=a;a=0;do{var p=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=p}while(u)}function Dm(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Dm(u),Yc(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function tj(a,o,u,p){for(;a.nodeType===1;){var b=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Ra])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(_=a.getAttribute("rel"),_==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(_!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(_=a.getAttribute("src"),(_!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&_&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var _=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===_)return a}else return a;if(a=Ds(a.nextSibling),a===null)break}return null}function nj(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Ds(a.nextSibling),a===null))return null;return a}function Hv(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Ds(a.nextSibling),a===null))return null;return a}function Rm(a){return a.data==="$?"||a.data==="$~"}function Mm(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function sj(a,o){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||u.readyState!=="loading")o();else{var p=function(){o(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function Ds(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var Pm=null;function Vv(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(o===0)return Ds(a.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}a=a.nextSibling}return null}function qv(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return a;o--}else u!=="/$"&&u!=="/&"||o++}a=a.previousSibling}return null}function Wv(a,o,u){switch(o=Kd(u),a){case"html":if(a=o.documentElement,!a)throw Error(r(452));return a;case"head":if(a=o.head,!a)throw Error(r(453));return a;case"body":if(a=o.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Bl(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Yc(a)}var Rs=new Map,$v=new Set;function Yd(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Pr=B.d;B.d={f:rj,r:ij,D:aj,C:oj,L:lj,m:cj,X:uj,S:dj,M:hj};function rj(){var a=Pr.f(),o=Bd();return a||o}function ij(a){var o=Qi(a);o!==null&&o.tag===5&&o.type==="form"?d0(o):Pr.r(a)}var ao=typeof document>"u"?null:document;function Kv(a,o,u){var p=ao;if(p&&typeof o=="string"&&o){var b=hs(o);b='link[rel="'+a+'"][href="'+b+'"]',typeof u=="string"&&(b+='[crossorigin="'+u+'"]'),$v.has(b)||($v.add(b),a={rel:a,crossOrigin:u,href:o},p.querySelector(b)===null&&(o=p.createElement("link"),Hn(o,"link",a),Cn(o),p.head.appendChild(o)))}}function aj(a){Pr.D(a),Kv("dns-prefetch",a,null)}function oj(a,o){Pr.C(a,o),Kv("preconnect",a,o)}function lj(a,o,u){Pr.L(a,o,u);var p=ao;if(p&&a&&o){var b='link[rel="preload"][as="'+hs(o)+'"]';o==="image"&&u&&u.imageSrcSet?(b+='[imagesrcset="'+hs(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(b+='[imagesizes="'+hs(u.imageSizes)+'"]')):b+='[href="'+hs(a)+'"]';var _=b;switch(o){case"style":_=oo(a);break;case"script":_=lo(a)}Rs.has(_)||(a=x({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Rs.set(_,a),p.querySelector(b)!==null||o==="style"&&p.querySelector(Gl(_))||o==="script"&&p.querySelector(zl(_))||(o=p.createElement("link"),Hn(o,"link",a),Cn(o),p.head.appendChild(o)))}}function cj(a,o){Pr.m(a,o);var u=ao;if(u&&a){var p=o&&typeof o.as=="string"?o.as:"script",b='link[rel="modulepreload"][as="'+hs(p)+'"][href="'+hs(a)+'"]',_=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=lo(a)}if(!Rs.has(_)&&(a=x({rel:"modulepreload",href:a},o),Rs.set(_,a),u.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(zl(_)))return}p=u.createElement("link"),Hn(p,"link",a),Cn(p),u.head.appendChild(p)}}}function dj(a,o,u){Pr.S(a,o,u);var p=ao;if(p&&a){var b=Zi(p).hoistableStyles,_=oo(a);o=o||"default";var R=b.get(_);if(!R){var $={loading:0,preload:null};if(R=p.querySelector(Gl(_)))$.loading=5;else{a=x({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Rs.get(_))&&Om(a,u);var ie=R=p.createElement("link");Cn(ie),Hn(ie,"link",a),ie._p=new Promise(function(ge,Ee){ie.onload=ge,ie.onerror=Ee}),ie.addEventListener("load",function(){$.loading|=1}),ie.addEventListener("error",function(){$.loading|=2}),$.loading|=4,Jd(R,o,p)}R={type:"stylesheet",instance:R,count:1,state:$},b.set(_,R)}}}function uj(a,o){Pr.X(a,o);var u=ao;if(u&&a){var p=Zi(u).hoistableScripts,b=lo(a),_=p.get(b);_||(_=u.querySelector(zl(b)),_||(a=x({src:a,async:!0},o),(o=Rs.get(b))&&Lm(a,o),_=u.createElement("script"),Cn(_),Hn(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},p.set(b,_))}}function hj(a,o){Pr.M(a,o);var u=ao;if(u&&a){var p=Zi(u).hoistableScripts,b=lo(a),_=p.get(b);_||(_=u.querySelector(zl(b)),_||(a=x({src:a,async:!0,type:"module"},o),(o=Rs.get(b))&&Lm(a,o),_=u.createElement("script"),Cn(_),Hn(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},p.set(b,_))}}function Yv(a,o,u,p){var b=(b=ne.current)?Yd(b):null;if(!b)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=oo(u.href),u=Zi(b).hoistableStyles,p=u.get(o),p||(p={type:"style",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=oo(u.href);var _=Zi(b).hoistableStyles,R=_.get(a);if(R||(b=b.ownerDocument||b,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(a,R),(_=b.querySelector(Gl(a)))&&!_._p&&(R.instance=_,R.state.loading=5),Rs.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Rs.set(a,u),_||fj(b,a,u,R.state))),o&&p===null)throw Error(r(528,""));return R}if(o&&p!==null)throw Error(r(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=lo(u),u=Zi(b).hoistableScripts,p=u.get(o),p||(p={type:"script",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function oo(a){return'href="'+hs(a)+'"'}function Gl(a){return'link[rel="stylesheet"]['+a+"]"}function Jv(a){return x({},a,{"data-precedence":a.precedence,precedence:null})}function fj(a,o,u,p){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=a.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),Hn(o,"link",u),Cn(o),a.head.appendChild(o))}function lo(a){return'[src="'+hs(a)+'"]'}function zl(a){return"script[async]"+a}function Xv(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var p=a.querySelector('style[data-href~="'+hs(u.href)+'"]');if(p)return o.instance=p,Cn(p),p;var b=x({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Cn(p),Hn(p,"style",b),Jd(p,u.precedence,a),o.instance=p;case"stylesheet":b=oo(u.href);var _=a.querySelector(Gl(b));if(_)return o.state.loading|=4,o.instance=_,Cn(_),_;p=Jv(u),(b=Rs.get(b))&&Om(p,b),_=(a.ownerDocument||a).createElement("link"),Cn(_);var R=_;return R._p=new Promise(function($,ie){R.onload=$,R.onerror=ie}),Hn(_,"link",p),o.state.loading|=4,Jd(_,u.precedence,a),o.instance=_;case"script":return _=lo(u.src),(b=a.querySelector(zl(_)))?(o.instance=b,Cn(b),b):(p=u,(b=Rs.get(_))&&(p=x({},u),Lm(p,b)),a=a.ownerDocument||a,b=a.createElement("script"),Cn(b),Hn(b,"link",p),a.head.appendChild(b),o.instance=b);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,Jd(p,u.precedence,a));return o.instance}function Jd(a,o,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,_=b,R=0;R<p.length;R++){var $=p[R];if($.dataset.precedence===o)_=$;else if(_!==b)break}_?_.parentNode.insertBefore(a,_.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function Om(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Lm(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Xd=null;function Qv(a,o,u){if(Xd===null){var p=new Map,b=Xd=new Map;b.set(u,p)}else b=Xd,p=b.get(u),p||(p=new Map,b.set(u,p));if(p.has(a))return p;for(p.set(a,null),u=u.getElementsByTagName(a),b=0;b<u.length;b++){var _=u[b];if(!(_[Ra]||_[xn]||a==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var R=_.getAttribute(o)||"";R=a+R;var $=p.get(R);$?$.push(_):p.set(R,[_])}}return p}function Zv(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function mj(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function eb(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function pj(a,o,u,p){if(u.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var b=oo(p.href),_=o.querySelector(Gl(b));if(_){o=_._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Qd.bind(a),o.then(a,a)),u.state.loading|=4,u.instance=_,Cn(_);return}_=o.ownerDocument||o,p=Jv(p),(b=Rs.get(b))&&Om(p,b),_=_.createElement("link"),Cn(_);var R=_;R._p=new Promise(function($,ie){R.onload=$,R.onerror=ie}),Hn(_,"link",p),u.instance=_}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=Qd.bind(a),o.addEventListener("load",u),o.addEventListener("error",u))}}var Fm=0;function gj(a,o){return a.stylesheets&&a.count===0&&eu(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var p=setTimeout(function(){if(a.stylesheets&&eu(a,a.stylesheets),a.unsuspend){var _=a.unsuspend;a.unsuspend=null,_()}},6e4+o);0<a.imgBytes&&Fm===0&&(Fm=62500*JI());var b=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&eu(a,a.stylesheets),a.unsuspend)){var _=a.unsuspend;a.unsuspend=null,_()}},(a.imgBytes>Fm?50:800)+o);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(b)}}:null}function Qd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)eu(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Zd=null;function eu(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Zd=new Map,o.forEach(yj,a),Zd=null,Qd.call(a))}function yj(a,o){if(!(o.state.loading&4)){var u=Zd.get(a);if(u)var p=u.get(null);else{u=new Map,Zd.set(a,u);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<b.length;_++){var R=b[_];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(u.set(R.dataset.precedence,R),p=R)}p&&u.set(null,p)}b=o.instance,R=b.getAttribute("data-precedence"),_=u.get(R)||p,_===p&&u.set(null,b),u.set(R,b),this.count++,p=Qd.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),_?_.parentNode.insertBefore(b,_.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),o.state.loading|=4}}var Hl={$$typeof:I,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function xj(a,o,u,p,b,_,R,$,ie){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qo(0),this.hiddenUpdates=Qo(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=_,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ie,this.incompleteTransitions=new Map}function tb(a,o,u,p,b,_,R,$,ie,ge,Ee,je){return a=new xj(a,o,u,R,ie,ge,Ee,je,$),o=1,_===!0&&(o|=24),_=ms(3,null,null,o),a.current=_,_.stateNode=a,o=yf(),o.refCount++,a.pooledCache=o,o.refCount++,_.memoizedState={element:p,isDehydrated:u,cache:o},Nf(_),a}function nb(a){return a?(a=Ua,a):Ua}function sb(a,o,u,p,b,_){b=nb(b),p.context===null?p.context=b:p.pendingContext=b,p=hi(o),p.payload={element:u},_=_===void 0?null:_,_!==null&&(p.callback=_),u=fi(a,p,o),u!==null&&(cs(u,a,o),Nl(u,a,o))}function rb(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function Um(a,o){rb(a,o),(a=a.alternate)&&rb(a,o)}function ib(a){if(a.tag===13||a.tag===31){var o=ra(a,67108864);o!==null&&cs(o,a,67108864),Um(a,67108864)}}function ab(a){if(a.tag===13||a.tag===31){var o=vs();o=Zo(o);var u=ra(a,o);u!==null&&cs(u,a,o),Um(a,o)}}var tu=!0;function vj(a,o,u,p){var b=G.T;G.T=null;var _=B.p;try{B.p=2,Bm(a,o,u,p)}finally{B.p=_,G.T=b}}function bj(a,o,u,p){var b=G.T;G.T=null;var _=B.p;try{B.p=8,Bm(a,o,u,p)}finally{B.p=_,G.T=b}}function Bm(a,o,u,p){if(tu){var b=Gm(p);if(b===null)Cm(a,o,p,nu,u),lb(a,p);else if(Sj(b,a,o,u,p))p.stopPropagation();else if(lb(a,p),o&4&&-1<Nj.indexOf(a)){for(;b!==null;){var _=Qi(b);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var R=Ts(_.pendingLanes);if(R!==0){var $=_;for($.pendingLanes|=2,$.entangledLanes|=2;R;){var ie=1<<31-rt(R);$.entanglements[1]|=ie,R&=~ie}cr(_),(Ot&6)===0&&(Fd=ut()+500,Ll(0))}}break;case 31:case 13:$=ra(_,2),$!==null&&cs($,_,2),Bd(),Um(_,2)}if(_=Gm(p),_===null&&Cm(a,o,p,nu,u),_===b)break;b=_}b!==null&&p.stopPropagation()}else Cm(a,o,p,null,u)}}function Gm(a){return a=Kn(a),zm(a)}var nu=null;function zm(a){if(nu=null,a=Xi(a),a!==null){var o=l(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=c(o),a!==null)return a;a=null}else if(u===31){if(a=d(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return nu=a,null}function ob(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($t()){case Pt:return 2;case St:return 8;case on:case tr:return 32;case gr:return 268435456;default:return 32}default:return 32}}var Hm=!1,wi=null,Ti=null,Ci=null,Vl=new Map,ql=new Map,Ei=[],Nj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lb(a,o){switch(a){case"focusin":case"focusout":wi=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Ci=null;break;case"pointerover":case"pointerout":Vl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ql.delete(o.pointerId)}}function Wl(a,o,u,p,b,_){return a===null||a.nativeEvent!==_?(a={blockedOn:o,domEventName:u,eventSystemFlags:p,nativeEvent:_,targetContainers:[b]},o!==null&&(o=Qi(o),o!==null&&ib(o)),a):(a.eventSystemFlags|=p,o=a.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),a)}function Sj(a,o,u,p,b){switch(o){case"focusin":return wi=Wl(wi,a,o,u,p,b),!0;case"dragenter":return Ti=Wl(Ti,a,o,u,p,b),!0;case"mouseover":return Ci=Wl(Ci,a,o,u,p,b),!0;case"pointerover":var _=b.pointerId;return Vl.set(_,Wl(Vl.get(_)||null,a,o,u,p,b)),!0;case"gotpointercapture":return _=b.pointerId,ql.set(_,Wl(ql.get(_)||null,a,o,u,p,b)),!0}return!1}function cb(a){var o=Xi(a.target);if(o!==null){var u=l(o);if(u!==null){if(o=u.tag,o===13){if(o=c(u),o!==null){a.blockedOn=o,Kc(a.priority,function(){ab(u)});return}}else if(o===31){if(o=d(u),o!==null){a.blockedOn=o,Kc(a.priority,function(){ab(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function su(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Gm(a.nativeEvent);if(u===null){u=a.nativeEvent;var p=new u.constructor(u.type,u);dn=p,u.target.dispatchEvent(p),dn=null}else return o=Qi(u),o!==null&&ib(o),a.blockedOn=u,!1;o.shift()}return!0}function db(a,o,u){su(a)&&u.delete(o)}function _j(){Hm=!1,wi!==null&&su(wi)&&(wi=null),Ti!==null&&su(Ti)&&(Ti=null),Ci!==null&&su(Ci)&&(Ci=null),Vl.forEach(db),ql.forEach(db)}function ru(a,o){a.blockedOn===o&&(a.blockedOn=null,Hm||(Hm=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,_j)))}var iu=null;function ub(a){iu!==a&&(iu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){iu===a&&(iu=null);for(var o=0;o<a.length;o+=3){var u=a[o],p=a[o+1],b=a[o+2];if(typeof p!="function"){if(zm(p||u)===null)continue;break}var _=Qi(u);_!==null&&(a.splice(o,3),o-=3,Gf(_,{pending:!0,data:b,method:u.method,action:p},p,b))}}))}function co(a){function o(ie){return ru(ie,a)}wi!==null&&ru(wi,a),Ti!==null&&ru(Ti,a),Ci!==null&&ru(Ci,a),Vl.forEach(o),ql.forEach(o);for(var u=0;u<Ei.length;u++){var p=Ei[u];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Ei.length&&(u=Ei[0],u.blockedOn===null);)cb(u),u.blockedOn===null&&Ei.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var b=u[p],_=u[p+1],R=b[Un]||null;if(typeof _=="function")R||ub(u);else if(R){var $=null;if(_&&_.hasAttribute("formAction")){if(b=_,R=_[Un]||null)$=R.formAction;else if(zm(b)!==null)continue}else $=R.action;typeof $=="function"?u[p+1]=$:(u.splice(p,3),p-=3),ub(u)}}}function hb(){function a(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(R){return b=R})},focusReset:"manual",scroll:"manual"})}function o(){b!==null&&(b(),b=null),p||setTimeout(u,20)}function u(){if(!p&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,b=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),b!==null&&(b(),b=null)}}}function Vm(a){this._internalRoot=a}au.prototype.render=Vm.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(r(409));var u=o.current,p=vs();sb(u,p,a,o,null,null)},au.prototype.unmount=Vm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;sb(a.current,2,null,a,null,null),Bd(),o[yr]=null}};function au(a){this._internalRoot=a}au.prototype.unstable_scheduleHydration=function(a){if(a){var o=$c();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Ei.length&&o!==0&&o<Ei[u].priority;u++);Ei.splice(u,0,a),u===0&&cb(a)}};var fb=e.version;if(fb!=="19.2.4")throw Error(r(527,fb,"19.2.4"));B.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=h(o),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var wj={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{Je=ou.inject(wj),Ve=ou}catch{}}return Kl.createRoot=function(a,o){if(!i(a))throw Error(r(299));var u=!1,p="",b=b0,_=N0,R=S0;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(b=o.onUncaughtError),o.onCaughtError!==void 0&&(_=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=tb(a,1,!1,null,null,u,p,null,b,_,R,hb),a[yr]=o.current,Tm(a),new Vm(o)},Kl.hydrateRoot=function(a,o,u){if(!i(a))throw Error(r(299));var p=!1,b="",_=b0,R=N0,$=S0,ie=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onUncaughtError!==void 0&&(_=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&($=u.onRecoverableError),u.formState!==void 0&&(ie=u.formState)),o=tb(a,1,!0,o,u??null,p,b,ie,_,R,$,hb),o.context=nb(null),u=o.current,p=vs(),p=Zo(p),b=hi(p),b.callback=null,fi(u,b,p),u=p,o.current.lanes=u,Ji(o,u),cr(o),a[yr]=o.current,Tm(a),new au(o)},Kl.version="19.2.4",Kl}var _b;function Rj(){if(_b)return $m.exports;_b=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$m.exports=Dj(),$m.exports}var Mj=Rj();const Pj=pg(Mj);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var wb="popstate";function Oj(t={}){function e(i,l){let{pathname:c="/",search:d="",hash:f=""}=Ia(i.location.hash.substring(1));return!c.startsWith("/")&&!c.startsWith(".")&&(c="/"+c),_p("",{pathname:c,search:d,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(i,l){let c=i.document.querySelector("base"),d="";if(c&&c.getAttribute("href")){let f=i.location.href,h=f.indexOf("#");d=h===-1?f:f.slice(0,h)}return d+"#"+(typeof l=="string"?l:mc(l))}function r(i,l){Ss(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return Fj(e,n,r,t)}function nn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ss(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Lj(){return Math.random().toString(36).substring(2,10)}function Tb(t,e){return{usr:t.state,key:t.key,idx:e}}function _p(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ia(e):e,state:n,key:e&&e.key||r||Lj()}}function mc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ia(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Fj(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:l=!1}=r,c=i.history,d="POP",f=null,h=m();h==null&&(h=0,c.replaceState({...c.state,idx:h},""));function m(){return(c.state||{idx:null}).idx}function x(){d="POP";let w=m(),E=w==null?null:w-h;h=w,f&&f({action:d,location:C.location,delta:E})}function g(w,E){d="PUSH";let D=_p(C.location,w,E);n&&n(D,w),h=m()+1;let I=Tb(D,h),k=C.createHref(D);try{c.pushState(I,"",k)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(k)}l&&f&&f({action:d,location:C.location,delta:1})}function N(w,E){d="REPLACE";let D=_p(C.location,w,E);n&&n(D,w),h=m();let I=Tb(D,h),k=C.createHref(D);c.replaceState(I,"",k),l&&f&&f({action:d,location:C.location,delta:0})}function T(w){return Uj(w)}let C={get action(){return d},get location(){return t(i,c)},listen(w){if(f)throw new Error("A history only accepts one active listener");return i.addEventListener(wb,x),f=w,()=>{i.removeEventListener(wb,x),f=null}},createHref(w){return e(i,w)},createURL:T,encodeLocation(w){let E=T(w);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:g,replace:N,go(w){return c.go(w)}};return C}function Uj(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),nn(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:mc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function U_(t,e,n="/"){return Bj(t,e,n,!1)}function Bj(t,e,n,r){let i=typeof e=="string"?Ia(e):e,l=Vr(i.pathname||"/",n);if(l==null)return null;let c=B_(t);Gj(c);let d=null;for(let f=0;d==null&&f<c.length;++f){let h=Qj(l);d=Jj(c[f],h,r)}return d}function B_(t,e=[],n=[],r="",i=!1){let l=(c,d,f=i,h)=>{let m={relativePath:h===void 0?c.path||"":h,caseSensitive:c.caseSensitive===!0,childrenIndex:d,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(r)&&f)return;nn(m.relativePath.startsWith(r),`Absolute route path "${m.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(r.length)}let x=Gr([r,m.relativePath]),g=n.concat(m);c.children&&c.children.length>0&&(nn(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${x}".`),B_(c.children,e,g,x,f)),!(c.path==null&&!c.index)&&e.push({path:x,score:Kj(x,c.index),routesMeta:g})};return t.forEach((c,d)=>{var f;if(c.path===""||!((f=c.path)!=null&&f.includes("?")))l(c,d);else for(let h of G_(c.path))l(c,d,!0,h)}),e}function G_(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),l=n.replace(/\?$/,"");if(r.length===0)return i?[l,""]:[l];let c=G_(r.join("/")),d=[];return d.push(...c.map(f=>f===""?l:[l,f].join("/"))),i&&d.push(...c),d.map(f=>t.startsWith("/")&&f===""?"/":f)}function Gj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Yj(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var zj=/^:[\w-]+$/,Hj=3,Vj=2,qj=1,Wj=10,$j=-2,Cb=t=>t==="*";function Kj(t,e){let n=t.split("/"),r=n.length;return n.some(Cb)&&(r+=$j),e&&(r+=Vj),n.filter(i=>!Cb(i)).reduce((i,l)=>i+(zj.test(l)?Hj:l===""?qj:Wj),r)}function Yj(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function Jj(t,e,n=!1){let{routesMeta:r}=t,i={},l="/",c=[];for(let d=0;d<r.length;++d){let f=r[d],h=d===r.length-1,m=l==="/"?e:e.slice(l.length)||"/",x=ju({path:f.relativePath,caseSensitive:f.caseSensitive,end:h},m),g=f.route;if(!x&&h&&n&&!r[r.length-1].route.index&&(x=ju({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!x)return null;Object.assign(i,x.params),c.push({params:i,pathname:Gr([l,x.pathname]),pathnameBase:nA(Gr([l,x.pathnameBase])),route:g}),x.pathnameBase!=="/"&&(l=Gr([l,x.pathnameBase]))}return c}function ju(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Xj(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let l=i[0],c=l.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((h,{paramName:m,isOptional:x},g)=>{if(m==="*"){let T=d[g]||"";c=l.slice(0,l.length-T.length).replace(/(.)\/+$/,"$1")}const N=d[g];return x&&!N?h[m]=void 0:h[m]=(N||"").replace(/%2F/g,"/"),h},{}),pathname:l,pathnameBase:c,pattern:t}}function Xj(t,e=!1,n=!0){Ss(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,d,f)=>(r.push({paramName:d,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function Qj(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ss(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Vr(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Zj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function eA(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Ia(t):t,l;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?l=Eb(n.substring(1),"/"):l=Eb(n,e)):l=e,{pathname:l,search:sA(r),hash:rA(i)}}function Eb(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Xm(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function tA(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function yg(t){let e=tA(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function xg(t,e,n,r=!1){let i;typeof t=="string"?i=Ia(t):(i={...t},nn(!i.pathname||!i.pathname.includes("?"),Xm("?","pathname","search",i)),nn(!i.pathname||!i.pathname.includes("#"),Xm("#","pathname","hash",i)),nn(!i.search||!i.search.includes("#"),Xm("#","search","hash",i)));let l=t===""||i.pathname==="",c=l?"/":i.pathname,d;if(c==null)d=n;else{let x=e.length-1;if(!r&&c.startsWith("..")){let g=c.split("/");for(;g[0]==="..";)g.shift(),x-=1;i.pathname=g.join("/")}d=x>=0?e[x]:"/"}let f=eA(i,d),h=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(h||m)&&(f.pathname+="/"),f}var Gr=t=>t.join("/").replace(/\/\/+/g,"/"),nA=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),sA=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,rA=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,iA=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function aA(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function oA(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var z_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function H_(t,e){let n=t;if(typeof n!="string"||!Zj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(z_)try{let l=new URL(window.location.href),c=n.startsWith("//")?new URL(l.protocol+n):new URL(n),d=Vr(c.pathname,e);c.origin===l.origin&&d!=null?n=d+c.search+c.hash:i=!0}catch{Ss(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var V_=["POST","PUT","PATCH","DELETE"];new Set(V_);var lA=["GET",...V_];new Set(lA);var Po=S.createContext(null);Po.displayName="DataRouter";var ch=S.createContext(null);ch.displayName="DataRouterState";var cA=S.createContext(!1),q_=S.createContext({isTransitioning:!1});q_.displayName="ViewTransition";var dA=S.createContext(new Map);dA.displayName="Fetchers";var uA=S.createContext(null);uA.displayName="Await";var _s=S.createContext(null);_s.displayName="Navigation";var Ic=S.createContext(null);Ic.displayName="Location";var Bs=S.createContext({outlet:null,matches:[],isDataRoute:!1});Bs.displayName="Route";var vg=S.createContext(null);vg.displayName="RouteError";var W_="REACT_ROUTER_ERROR",hA="REDIRECT",fA="ROUTE_ERROR_RESPONSE";function mA(t){if(t.startsWith(`${W_}:${hA}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function pA(t){if(t.startsWith(`${W_}:${fA}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new iA(e.status,e.statusText,e.data)}catch{}}function gA(t,{relative:e}={}){nn(Oo(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=S.useContext(_s),{hash:i,pathname:l,search:c}=jc(t,{relative:e}),d=l;return n!=="/"&&(d=l==="/"?n:Gr([n,l])),r.createHref({pathname:d,search:c,hash:i})}function Oo(){return S.useContext(Ic)!=null}function mr(){return nn(Oo(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(Ic).location}var $_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function K_(t){S.useContext(_s).static||S.useLayoutEffect(t)}function Qs(){let{isDataRoute:t}=S.useContext(Bs);return t?kA():yA()}function yA(){nn(Oo(),"useNavigate() may be used only in the context of a <Router> component.");let t=S.useContext(Po),{basename:e,navigator:n}=S.useContext(_s),{matches:r}=S.useContext(Bs),{pathname:i}=mr(),l=JSON.stringify(yg(r)),c=S.useRef(!1);return K_(()=>{c.current=!0}),S.useCallback((f,h={})=>{if(Ss(c.current,$_),!c.current)return;if(typeof f=="number"){n.go(f);return}let m=xg(f,JSON.parse(l),i,h.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Gr([e,m.pathname])),(h.replace?n.replace:n.push)(m,h.state,h)},[e,n,l,i,t])}var xA=S.createContext(null);function vA(t){let e=S.useContext(Bs).outlet;return S.useMemo(()=>e&&S.createElement(xA.Provider,{value:t},e),[e,t])}function Y_(){let{matches:t}=S.useContext(Bs),e=t[t.length-1];return e?e.params:{}}function jc(t,{relative:e}={}){let{matches:n}=S.useContext(Bs),{pathname:r}=mr(),i=JSON.stringify(yg(n));return S.useMemo(()=>xg(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function bA(t,e){return J_(t,e)}function J_(t,e,n,r,i){var D;nn(Oo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=S.useContext(_s),{matches:c}=S.useContext(Bs),d=c[c.length-1],f=d?d.params:{},h=d?d.pathname:"/",m=d?d.pathnameBase:"/",x=d&&d.route;{let I=x&&x.path||"";Q_(h,!x||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let g=mr(),N;if(e){let I=typeof e=="string"?Ia(e):e;nn(m==="/"||((D=I.pathname)==null?void 0:D.startsWith(m)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${I.pathname}" was given in the \`location\` prop.`),N=I}else N=g;let T=N.pathname||"/",C=T;if(m!=="/"){let I=m.replace(/^\//,"").split("/");C="/"+T.replace(/^\//,"").split("/").slice(I.length).join("/")}let w=U_(t,{pathname:C});Ss(x||w!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),Ss(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=TA(w&&w.map(I=>Object.assign({},I,{params:Object.assign({},f,I.params),pathname:Gr([m,l.encodeLocation?l.encodeLocation(I.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?m:Gr([m,l.encodeLocation?l.encodeLocation(I.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathnameBase])})),c,n,r,i);return e&&E?S.createElement(Ic.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},E):E}function NA(){let t=AA(),e=aA(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},l={padding:"2px 4px",backgroundColor:r},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=S.createElement(S.Fragment,null,S.createElement("p",null," Hey developer "),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:l},"ErrorBoundary")," or"," ",S.createElement("code",{style:l},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),n?S.createElement("pre",{style:i},n):null,c)}var SA=S.createElement(NA,null),X_=class extends S.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=pA(t.digest);n&&(t=n)}let e=t!==void 0?S.createElement(Bs.Provider,{value:this.props.routeContext},S.createElement(vg.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?S.createElement(_A,{error:t},e):e}};X_.contextType=cA;var Qm=new WeakMap;function _A({children:t,error:e}){let{basename:n}=S.useContext(_s);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=mA(e.digest);if(r){let i=Qm.get(e);if(i)throw i;let l=H_(r.location,n);if(z_&&!Qm.get(e))if(l.isExternal||r.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:r.replace}));throw Qm.set(e,c),c}return S.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return t}function wA({routeContext:t,match:e,children:n}){let r=S.useContext(Po);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),S.createElement(Bs.Provider,{value:t},n)}function TA(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=n==null?void 0:n.errors;if(c!=null){let m=l.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);nn(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,m+1))}let d=!1,f=-1;if(n)for(let m=0;m<l.length;m++){let x=l[m];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(f=m),x.route.id){let{loaderData:g,errors:N}=n,T=x.route.loader&&!g.hasOwnProperty(x.route.id)&&(!N||N[x.route.id]===void 0);if(x.route.lazy||T){d=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let h=n&&r?(m,x)=>{var g,N;r(m,{location:n.location,params:((N=(g=n.matches)==null?void 0:g[0])==null?void 0:N.params)??{},unstable_pattern:oA(n.matches),errorInfo:x})}:void 0;return l.reduceRight((m,x,g)=>{let N,T=!1,C=null,w=null;n&&(N=c&&x.route.id?c[x.route.id]:void 0,C=x.route.errorElement||SA,d&&(f<0&&g===0?(Q_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,w=null):f===g&&(T=!0,w=x.route.hydrateFallbackElement||null)));let E=e.concat(l.slice(0,g+1)),D=()=>{let I;return N?I=C:T?I=w:x.route.Component?I=S.createElement(x.route.Component,null):x.route.element?I=x.route.element:I=m,S.createElement(wA,{match:x,routeContext:{outlet:m,matches:E,isDataRoute:n!=null},children:I})};return n&&(x.route.ErrorBoundary||x.route.errorElement||g===0)?S.createElement(X_,{location:n.location,revalidation:n.revalidation,component:C,error:N,children:D(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:h}):D()},null)}function bg(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function CA(t){let e=S.useContext(Po);return nn(e,bg(t)),e}function EA(t){let e=S.useContext(ch);return nn(e,bg(t)),e}function IA(t){let e=S.useContext(Bs);return nn(e,bg(t)),e}function Ng(t){let e=IA(t),n=e.matches[e.matches.length-1];return nn(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function jA(){return Ng("useRouteId")}function AA(){var r;let t=S.useContext(vg),e=EA("useRouteError"),n=Ng("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function kA(){let{router:t}=CA("useNavigate"),e=Ng("useNavigate"),n=S.useRef(!1);return K_(()=>{n.current=!0}),S.useCallback(async(i,l={})=>{Ss(n.current,$_),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...l}))},[t,e])}var Ib={};function Q_(t,e,n){!e&&!Ib[t]&&(Ib[t]=!0,Ss(!1,n))}S.memo(DA);function DA({routes:t,future:e,state:n,onError:r}){return J_(t,void 0,n,r,e)}function rc({to:t,replace:e,state:n,relative:r}){nn(Oo(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=S.useContext(_s);Ss(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=S.useContext(Bs),{pathname:c}=mr(),d=Qs(),f=xg(t,yg(l),c,r==="path"),h=JSON.stringify(f);return S.useEffect(()=>{d(JSON.parse(h),{replace:e,state:n,relative:r})},[d,h,r,e,n]),null}function Z_(t){return vA(t.context)}function nt(t){nn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function RA({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:l=!1,unstable_useTransitions:c}){nn(!Oo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),f=S.useMemo(()=>({basename:d,navigator:i,static:l,unstable_useTransitions:c,future:{}}),[d,i,l,c]);typeof n=="string"&&(n=Ia(n));let{pathname:h="/",search:m="",hash:x="",state:g=null,key:N="default"}=n,T=S.useMemo(()=>{let C=Vr(h,d);return C==null?null:{location:{pathname:C,search:m,hash:x,state:g,key:N},navigationType:r}},[d,h,m,x,g,N,r]);return Ss(T!=null,`<Router basename="${d}"> is not able to match the URL "${h}${m}${x}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:S.createElement(_s.Provider,{value:f},S.createElement(Ic.Provider,{children:e,value:T}))}function MA({children:t,location:e}){return bA(wp(t),e)}function wp(t,e=[]){let n=[];return S.Children.forEach(t,(r,i)=>{if(!S.isValidElement(r))return;let l=[...e,i];if(r.type===S.Fragment){n.push.apply(n,wp(r.props.children,l));return}nn(r.type===nt,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),nn(!r.props.index||!r.props.children,"An index route cannot have child routes.");let c={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(c.children=wp(r.props.children,l)),n.push(c)}),n}var bu="get",Nu="application/x-www-form-urlencoded";function dh(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function PA(t){return dh(t)&&t.tagName.toLowerCase()==="button"}function OA(t){return dh(t)&&t.tagName.toLowerCase()==="form"}function LA(t){return dh(t)&&t.tagName.toLowerCase()==="input"}function FA(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function UA(t,e){return t.button===0&&(!e||e==="_self")&&!FA(t)}function Tp(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function BA(t,e){let n=Tp(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(l=>{n.append(i,l)})}),n}var lu=null;function GA(){if(lu===null)try{new FormData(document.createElement("form"),0),lu=!1}catch{lu=!0}return lu}var zA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zm(t){return t!=null&&!zA.has(t)?(Ss(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nu}"`),null):t}function HA(t,e){let n,r,i,l,c;if(OA(t)){let d=t.getAttribute("action");r=d?Vr(d,e):null,n=t.getAttribute("method")||bu,i=Zm(t.getAttribute("enctype"))||Nu,l=new FormData(t)}else if(PA(t)||LA(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||d.getAttribute("action");if(r=f?Vr(f,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||bu,i=Zm(t.getAttribute("formenctype"))||Zm(d.getAttribute("enctype"))||Nu,l=new FormData(d,t),!GA()){let{name:h,type:m,value:x}=t;if(m==="image"){let g=h?`${h}.`:"";l.append(`${g}x`,"0"),l.append(`${g}y`,"0")}else h&&l.append(h,x)}}else{if(dh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=bu,r=null,i=Nu,c=t}return l&&i==="text/plain"&&(c=l,l=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Sg(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function VA(t,e,n,r){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${r}`:i.pathname=`${i.pathname}.${r}`:i.pathname==="/"?i.pathname=`_root.${r}`:e&&Vr(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function qA(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function WA(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function $A(t,e,n){let r=await Promise.all(t.map(async i=>{let l=e.routes[i.route.id];if(l){let c=await qA(l,n);return c.links?c.links():[]}return[]}));return XA(r.flat(1).filter(WA).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function jb(t,e,n,r,i,l){let c=(f,h)=>n[h]?f.route.id!==n[h].route.id:!0,d=(f,h)=>{var m;return n[h].pathname!==f.pathname||((m=n[h].route.path)==null?void 0:m.endsWith("*"))&&n[h].params["*"]!==f.params["*"]};return l==="assets"?e.filter((f,h)=>c(f,h)||d(f,h)):l==="data"?e.filter((f,h)=>{var x;let m=r.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(c(f,h)||d(f,h))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((x=n[0])==null?void 0:x.params)||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function KA(t,e,{includeHydrateFallback:n}={}){return YA(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let l=[i.module];return i.clientActionModule&&(l=l.concat(i.clientActionModule)),i.clientLoaderModule&&(l=l.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(l=l.concat(i.hydrateFallbackModule)),i.imports&&(l=l.concat(i.imports)),l}).flat(1))}function YA(t){return[...new Set(t)]}function JA(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function XA(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let l=JSON.stringify(JA(i));return n.has(l)||(n.add(l),r.push({key:l,link:i})),r},[])}function ew(){let t=S.useContext(Po);return Sg(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function QA(){let t=S.useContext(ch);return Sg(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var _g=S.createContext(void 0);_g.displayName="FrameworkContext";function tw(){let t=S.useContext(_g);return Sg(t,"You must render this element inside a <HydratedRouter> element"),t}function ZA(t,e){let n=S.useContext(_g),[r,i]=S.useState(!1),[l,c]=S.useState(!1),{onFocus:d,onBlur:f,onMouseEnter:h,onMouseLeave:m,onTouchStart:x}=e,g=S.useRef(null);S.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let C=E=>{E.forEach(D=>{c(D.isIntersecting)})},w=new IntersectionObserver(C,{threshold:.5});return g.current&&w.observe(g.current),()=>{w.disconnect()}}},[t]),S.useEffect(()=>{if(r){let C=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(C)}}},[r]);let N=()=>{i(!0)},T=()=>{i(!1),c(!1)};return n?t!=="intent"?[l,g,{}]:[l,g,{onFocus:Yl(d,N),onBlur:Yl(f,T),onMouseEnter:Yl(h,N),onMouseLeave:Yl(m,T),onTouchStart:Yl(x,N)}]:[!1,g,{}]}function Yl(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function ek({page:t,...e}){let{router:n}=ew(),r=S.useMemo(()=>U_(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?S.createElement(nk,{page:t,matches:r,...e}):null}function tk(t){let{manifest:e,routeModules:n}=tw(),[r,i]=S.useState([]);return S.useEffect(()=>{let l=!1;return $A(t,e,n).then(c=>{l||i(c)}),()=>{l=!0}},[t,e,n]),r}function nk({page:t,matches:e,...n}){let r=mr(),{future:i,manifest:l,routeModules:c}=tw(),{basename:d}=ew(),{loaderData:f,matches:h}=QA(),m=S.useMemo(()=>jb(t,e,h,l,r,"data"),[t,e,h,l,r]),x=S.useMemo(()=>jb(t,e,h,l,r,"assets"),[t,e,h,l,r]),g=S.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,w=!1;if(e.forEach(D=>{var k;let I=l.routes[D.route.id];!I||!I.hasLoader||(!m.some(M=>M.route.id===D.route.id)&&D.route.id in f&&((k=c[D.route.id])!=null&&k.shouldRevalidate)||I.hasClientLoader?w=!0:C.add(D.route.id))}),C.size===0)return[];let E=VA(t,d,i.unstable_trailingSlashAwareDataRequests,"data");return w&&C.size>0&&E.searchParams.set("_routes",e.filter(D=>C.has(D.route.id)).map(D=>D.route.id).join(",")),[E.pathname+E.search]},[d,i.unstable_trailingSlashAwareDataRequests,f,r,l,m,e,t,c]),N=S.useMemo(()=>KA(x,l),[x,l]),T=tk(x);return S.createElement(S.Fragment,null,g.map(C=>S.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),N.map(C=>S.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),T.map(({key:C,link:w})=>S.createElement("link",{key:C,nonce:n.nonce,...w,crossOrigin:w.crossOrigin??n.crossOrigin})))}function sk(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var rk=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{rk&&(window.__reactRouterVersion="7.13.0")}catch{}function ik({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=S.useRef();i.current==null&&(i.current=Oj({window:r,v5Compat:!0}));let l=i.current,[c,d]=S.useState({action:l.action,location:l.location}),f=S.useCallback(h=>{n===!1?d(h):S.startTransition(()=>d(h))},[n]);return S.useLayoutEffect(()=>l.listen(f),[l,f]),S.createElement(RA,{basename:t,children:e,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:n})}var nw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ls=S.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:l,replace:c,state:d,target:f,to:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g,...N},T){let{basename:C,unstable_useTransitions:w}=S.useContext(_s),E=typeof h=="string"&&nw.test(h),D=H_(h,C);h=D.to;let I=gA(h,{relative:i}),[k,M,j]=ZA(r,N),O=lk(h,{replace:c,state:d,target:f,preventScrollReset:m,relative:i,viewTransition:x,unstable_defaultShouldRevalidate:g,unstable_useTransitions:w});function A(P){e&&e(P),P.defaultPrevented||O(P)}let F=S.createElement("a",{...N,...j,href:D.absoluteURL||I,onClick:D.isExternal||l?e:A,ref:sk(T,M),target:f,"data-discover":!E&&n==="render"?"true":void 0});return k&&!E?S.createElement(S.Fragment,null,F,S.createElement(ek,{page:I})):F});Ls.displayName="Link";var sw=S.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:l,to:c,viewTransition:d,children:f,...h},m){let x=jc(c,{relative:h.relative}),g=mr(),N=S.useContext(ch),{navigator:T,basename:C}=S.useContext(_s),w=N!=null&&fk(x)&&d===!0,E=T.encodeLocation?T.encodeLocation(x).pathname:x.pathname,D=g.pathname,I=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;n||(D=D.toLowerCase(),I=I?I.toLowerCase():null,E=E.toLowerCase()),I&&C&&(I=Vr(I,C)||I);const k=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let M=D===E||!i&&D.startsWith(E)&&D.charAt(k)==="/",j=I!=null&&(I===E||!i&&I.startsWith(E)&&I.charAt(E.length)==="/"),O={isActive:M,isPending:j,isTransitioning:w},A=M?e:void 0,F;typeof r=="function"?F=r(O):F=[r,M?"active":null,j?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let P=typeof l=="function"?l(O):l;return S.createElement(Ls,{...h,"aria-current":A,className:F,ref:m,style:P,to:c,viewTransition:d},typeof f=="function"?f(O):f)});sw.displayName="NavLink";var ak=S.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:l,method:c=bu,action:d,onSubmit:f,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g,...N},T)=>{let{unstable_useTransitions:C}=S.useContext(_s),w=uk(),E=hk(d,{relative:h}),D=c.toLowerCase()==="get"?"get":"post",I=typeof d=="string"&&nw.test(d),k=M=>{if(f&&f(M),M.defaultPrevented)return;M.preventDefault();let j=M.nativeEvent.submitter,O=(j==null?void 0:j.getAttribute("formmethod"))||c,A=()=>w(j||M.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:i,state:l,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g});C&&n!==!1?S.startTransition(()=>A()):A()};return S.createElement("form",{ref:T,method:D,action:E,onSubmit:r?f:k,...N,"data-discover":!I&&t==="render"?"true":void 0})});ak.displayName="Form";function ok(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rw(t){let e=S.useContext(Po);return nn(e,ok(t)),e}function lk(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:d,unstable_useTransitions:f}={}){let h=Qs(),m=mr(),x=jc(t,{relative:l});return S.useCallback(g=>{if(UA(g,e)){g.preventDefault();let N=n!==void 0?n:mc(m)===mc(x),T=()=>h(t,{replace:N,state:r,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:d});f?S.startTransition(()=>T()):T()}},[m,h,x,n,r,e,t,i,l,c,d,f])}function wg(t){Ss(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=S.useRef(Tp(t)),n=S.useRef(!1),r=mr(),i=S.useMemo(()=>BA(r.search,n.current?null:e.current),[r.search]),l=Qs(),c=S.useCallback((d,f)=>{const h=Tp(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,l("?"+h,f)},[l,i]);return[i,c]}var ck=0,dk=()=>`__${String(++ck)}__`;function uk(){let{router:t}=rw("useSubmit"),{basename:e}=S.useContext(_s),n=jA(),r=t.fetch,i=t.navigate;return S.useCallback(async(l,c={})=>{let{action:d,method:f,encType:h,formData:m,body:x}=HA(l,e);if(c.navigate===!1){let g=c.fetcherKey||dk();await r(g,n,c.action||d,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,flushSync:c.flushSync})}else await i(c.action||d,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,replace:c.replace,state:c.state,fromRouteId:n,flushSync:c.flushSync,viewTransition:c.viewTransition})},[r,i,e,n])}function hk(t,{relative:e}={}){let{basename:n}=S.useContext(_s),r=S.useContext(Bs);nn(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),l={...jc(t||".",{relative:e})},c=mr();if(t==null){l.search=c.search;let d=new URLSearchParams(l.search),f=d.getAll("index");if(f.some(m=>m==="")){d.delete("index"),f.filter(x=>x).forEach(x=>d.append("index",x));let m=d.toString();l.search=m?`?${m}`:""}}return(!t||t===".")&&i.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:Gr([n,l.pathname])),mc(l)}function fk(t,{relative:e}={}){let n=S.useContext(q_);nn(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=rw("useViewTransitionState"),i=jc(t,{relative:e});if(!n.isTransitioning)return!1;let l=Vr(n.currentLocation.pathname,r)||n.currentLocation.pathname,c=Vr(n.nextLocation.pathname,r)||n.nextLocation.pathname;return ju(i.pathname,c)!=null||ju(i.pathname,l)!=null}var mk=F_(),Au=(t=>(t.EN="en",t.FR="fr",t))(Au||{}),pc=(t=>(t.PENDING="PENDING",t.ACCEPTED="ACCEPTED",t.EXPIRED="EXPIRED",t))(pc||{}),Tg=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(Tg||{}),dr=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(dr||{}),Cg=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(Cg||{}),rn=(t=>(t.FARMER="FARMER",t.EMPLOYEE="EMPLOYEE",t.SERVICE_PROVIDER="SERVICE_PROVIDER",t))(rn||{}),Xe=(t=>(t.CREATED="CREATED",t.FREE="FREE",t.ASSIGNED="ASSIGNED",t.CUTTING="CUTTING",t.PLANTED="PLANTED",t.GROWING="GROWING",t.HARVESTED="HARVESTED",t.DRYING="DRYING",t.BAGGING="BAGGING",t.BAGGED="BAGGED",t.IN_STOCK="IN_STOCK",t.EXPORTED="EXPORTED",t.MAINTENANCE="MAINTENANCE",t.STORED="STORED",t))(Xe||{}),bs=(t=>(t.INITIAL_STOCK="INITIAL_STOCK",t.BAGGING_TRANSFER="BAGGING_TRANSFER",t.EXPORT_OUT="EXPORT_OUT",t.FARMER_DELIVERY="FARMER_DELIVERY",t.PRESSING_OUT="PRESSING_OUT",t.PRESSING_IN="PRESSING_IN",t.SITE_TRANSFER_IN="SITE_TRANSFER_IN",t.SITE_TRANSFER_OUT="SITE_TRANSFER_OUT",t.ADJUSTMENT_IN="ADJUSTMENT_IN",t.ADJUSTMENT_OUT="ADJUSTMENT_OUT",t))(bs||{}),mt=(t=>(t.INITIAL_STOCK="INITIAL_STOCK",t.PRESSING_IN="PRESSING_IN",t.EXPORT_OUT="EXPORT_OUT",t.RETURN_TO_SITE="RETURN_TO_SITE",t.BULK_IN_FROM_SITE="BULK_IN_FROM_SITE",t.PRESSING_CONSUMPTION="PRESSING_CONSUMPTION",t.FARMER_DELIVERY="FARMER_DELIVERY",t.ADJUSTMENT_IN="ADJUSTMENT_IN",t.ADJUSTMENT_OUT="ADJUSTMENT_OUT",t))(mt||{}),Cp=(t=>(t.COMMERCIAL_INVOICE="COMMERCIAL_INVOICE",t.PACKING_LIST="PACKING_LIST",t.CERTIFICATE_OF_ORIGIN="CERTIFICATE_OF_ORIGIN",t))(Cp||{}),Ep=(t=>(t.GP20="20' GP",t.GP40="40' GP",t.HC40="40' HC",t))(Ep||{}),Jt=(t=>(t.AWAITING_OUTBOUND="AWAITING_OUTBOUND",t.IN_TRANSIT="IN_TRANSIT",t.PENDING_RECEPTION="PENDING_RECEPTION",t.COMPLETED="COMPLETED",t.CANCELLED="CANCELLED",t))(Jt||{}),Ps=(t=>(t.OPEN="OPEN",t.IN_PROGRESS="IN_PROGRESS",t.RESOLVED="RESOLVED",t.CLOSED="CLOSED",t))(Ps||{});const Ce={DASHBOARD_VIEW:"dashboard:view",OPERATIONS_VIEW:"operations:view",FARM_MAP_VIEW:"farmmap:view",OPERATIONAL_CALENDAR_VIEW:"calendar:view",SITES_VIEW:"sites:view",SITES_MANAGE:"sites:manage",SEAWEED_TYPES_VIEW:"seaweed_types:view",SEAWEED_TYPES_MANAGE:"seaweed_types:manage",MODULES_VIEW:"modules:view",MODULES_MANAGE:"modules:manage",CUTTING_OPERATIONS_VIEW:"cutting_operations:view",CUTTING_OPERATIONS_MANAGE:"cutting_operations:manage",CYCLES_VIEW:"cycles:view",CYCLES_MANAGE:"cycles:manage",HARVESTING_VIEW:"harvesting:view",HARVESTING_MANAGE:"harvesting:manage",DRYING_VIEW:"drying:view",DRYING_MANAGE:"drying:manage",BAGGING_VIEW:"bagging:view",BAGGING_MANAGE:"bagging:manage",INVENTORY_VIEW:"inventory:view",INVENTORY_MANAGE_ON_SITE:"inventory:manage:on_site",INVENTORY_MANAGE_DELIVERIES:"inventory:manage:deliveries",INVENTORY_MANAGE_TRANSFERS:"inventory:manage:transfers",INVENTORY_MANAGE_WAREHOUSE:"inventory:manage:warehouse",EXPORTS_VIEW:"exports:view",EXPORTS_MANAGE:"exports:manage",STAKEHOLDERS_VIEW:"stakeholders:view",FARMERS_VIEW:"farmers:view",FARMERS_MANAGE:"farmers:manage",EMPLOYEES_VIEW:"employees:view",EMPLOYEES_MANAGE:"employees:manage",PROVIDERS_VIEW:"providers:view",PROVIDERS_MANAGE:"providers:manage",CREDITS_VIEW:"credits:view",CREDITS_MANAGE:"credits:manage",PAYMENTS_VIEW:"payments:view",PAYMENTS_MANAGE:"payments:manage",PAYROLL_VIEW:"payroll:view",PAYROLL_MANAGE:"payroll:manage",MONITORING_VIEW:"monitoring:view",TESTS_VIEW:"tests:view",TESTS_MANAGE:"tests:manage",INCIDENTS_VIEW:"incidents:view",INCIDENTS_MANAGE:"incidents:manage",GALLERY_VIEW:"gallery:view",GALLERY_MANAGE:"gallery:manage",REPORTS_VIEW:"reports:view",SETTINGS_VIEW:"settings:view",SETTINGS_GENERAL_MANAGE:"settings:general:manage",USERS_VIEW:"users:view",USERS_INVITE:"users:invite",ROLES_VIEW:"roles:view",ROLES_MANAGE:"roles:manage",INCIDENT_SETTINGS_MANAGE:"settings:incidents:manage"},iw=[{name:"Dashboard",permissions:[{id:Ce.DASHBOARD_VIEW,label:"View Dashboard"}]},{name:"Operations",permissions:[{id:Ce.OPERATIONS_VIEW,label:"View Operations Menu"},{id:Ce.FARM_MAP_VIEW,label:"View Farm Map"},{id:Ce.OPERATIONAL_CALENDAR_VIEW,label:"View Calendar"},{id:Ce.SITES_VIEW,label:"View Sites"},{id:Ce.SITES_MANAGE,label:"Manage Sites"},{id:Ce.SEAWEED_TYPES_VIEW,label:"View Seaweed Types"},{id:Ce.SEAWEED_TYPES_MANAGE,label:"Manage Seaweed Types"},{id:Ce.MODULES_VIEW,label:"View Modules"},{id:Ce.MODULES_MANAGE,label:"Manage Modules"},{id:Ce.CUTTING_OPERATIONS_VIEW,label:"View Cutting Operations"},{id:Ce.CUTTING_OPERATIONS_MANAGE,label:"Manage Cutting Operations"},{id:Ce.CYCLES_VIEW,label:"View Cultivation Cycles"},{id:Ce.CYCLES_MANAGE,label:"Manage Cultivation Cycles"},{id:Ce.HARVESTING_VIEW,label:"View Harvesting"},{id:Ce.HARVESTING_MANAGE,label:"Manage Harvesting"},{id:Ce.DRYING_VIEW,label:"View Drying"},{id:Ce.DRYING_MANAGE,label:"Manage Drying"},{id:Ce.BAGGING_VIEW,label:"View Bagging"},{id:Ce.BAGGING_MANAGE,label:"Manage Bagging"}]},{name:"Inventory",permissions:[{id:Ce.INVENTORY_VIEW,label:"View Inventory Menu"},{id:Ce.INVENTORY_MANAGE_ON_SITE,label:"Manage On-Site Storage"},{id:Ce.INVENTORY_MANAGE_DELIVERIES,label:"Manage Farmer Deliveries"},{id:Ce.INVENTORY_MANAGE_TRANSFERS,label:"Manage Site Transfers"},{id:Ce.INVENTORY_MANAGE_WAREHOUSE,label:"Manage Pressing Warehouse"},{id:Ce.EXPORTS_VIEW,label:"View Exports"},{id:Ce.EXPORTS_MANAGE,label:"Manage Exports"}]},{name:"Stakeholders & Payments",permissions:[{id:Ce.STAKEHOLDERS_VIEW,label:"View Stakeholders Menu"},{id:Ce.FARMERS_VIEW,label:"View Farmers"},{id:Ce.FARMERS_MANAGE,label:"Manage Farmers"},{id:Ce.EMPLOYEES_VIEW,label:"View Employees"},{id:Ce.EMPLOYEES_MANAGE,label:"Manage Employees"},{id:Ce.PROVIDERS_VIEW,label:"View Service Providers"},{id:Ce.PROVIDERS_MANAGE,label:"Manage Service Providers"},{id:Ce.CREDITS_VIEW,label:"View Farmer Credits"},{id:Ce.CREDITS_MANAGE,label:"Manage Farmer Credits"},{id:Ce.PAYMENTS_VIEW,label:"View Payments"},{id:Ce.PAYMENTS_MANAGE,label:"Manage Payments"},{id:Ce.PAYROLL_VIEW,label:"View Payroll"},{id:Ce.PAYROLL_MANAGE,label:"Manage Payroll"}]},{name:"Monitoring",permissions:[{id:Ce.MONITORING_VIEW,label:"View Monitoring Menu"},{id:Ce.TESTS_VIEW,label:"View Periodic Tests"},{id:Ce.TESTS_MANAGE,label:"Manage Periodic Tests"},{id:Ce.INCIDENTS_VIEW,label:"View Incidents"},{id:Ce.INCIDENTS_MANAGE,label:"Manage Incidents"},{id:Ce.GALLERY_VIEW,label:"View Photo Gallery"},{id:Ce.GALLERY_MANAGE,label:"Manage Photo Gallery"}]},{name:"Reports",permissions:[{id:Ce.REPORTS_VIEW,label:"View Reports"}]},{name:"Settings",permissions:[{id:Ce.SETTINGS_VIEW,label:"View Settings Menu"},{id:Ce.SETTINGS_GENERAL_MANAGE,label:"Manage General Settings"},{id:Ce.USERS_VIEW,label:"View Users"},{id:Ce.USERS_INVITE,label:"Invite New Users"},{id:Ce.ROLES_VIEW,label:"View Roles"},{id:Ce.ROLES_MANAGE,label:"Manage Roles & Permissions"},{id:Ce.INCIDENT_SETTINGS_MANAGE,label:"Manage Incident Settings"}]}],ku=[{id:"dark-formal",name:"Dark Formal",className:"dark",font:"font-serif"},{id:"dark-glass",name:"Dark Glass",className:"dark glass-dark",font:"font-sans"},{id:"light-formal",name:"Light Formal",className:"light",font:"font-serif"},{id:"light-glass",name:"Light Glass",className:"light glass-light",font:"font-sans"}],aw=[{value:.01,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}],Ab=[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"}],pk={company:{logoUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMjAgNjAiIHdpZHRoPSIyMjAiIGhlaWdodD0iNjAiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMDZiNmQ0O3N0b3Atb3BhY2l0eToxIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzA4OTFiMjtzdG9wLW9wYWNpdHk6MSIgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48c3R5bGU+LmxvZ28tdGV4dCB7IGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCAnUm9ib3RvJywgJ0hlbHZldGljYSBOZXVlJywgc2Fucy1zZXJpZjsgZm9udC1zaXplOiAzMnB4OyBmb250LXdlaWdodDogNjAwOyBmaWxsOiB1cmwoI2dyYWQxKTsgfTwvc3R5bGU+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAsIDEwKSI+PHBhdGggZD0iTTE1LDAgQzUsNSA1LDE1IDE1LDIwIFMyNSwyNSAxNSwzMCBDNSwzNSA1LDQ1IDE1LDUwIiBzdHJva2U9Im5vbmUiIGZpbGw9IiMwODkxYjIiIHRyYW5zZm9ybT0ic2NhbGUoMC44KSB0cmFuc2xhdGUoMCwgLTUpIi8+PHBhdGggZD0iTTIwLDAgQzEwLDUgMTAsMTUgMjAsMjAgUzMwLDI1IDIwLDMwIEMxMCwzNSAxMCw0NSAyMCw1MCIgc3Ryb2tlPSJub25lIiBmaWxsPSIjMDZiNmQ0IiB0cmFuc2Zvcm09InNjYWxlKDAuNykgdHJhbnNsYXRlKDUsIC01KSIvPjwvZz48dGV4dCB4PSI1MCIgeT0iNDAiIGNsYXNzPSJsb2dvLXRleHQiPlNFQUZBUk08L3RleHQ+PC9zdmc+",name:"OceanReef Seaweed Inc.",phone:"+1 (555) 123-4567",email:"contact@oceanreef.com",address:"123 Ocean Drive, Marine City, MC 45678",nif:"123456789",rc:"RC/XYZ/2024/001",stat:"STAT-98765",capital:1e6},localization:{country:"US",currency:"USD",currencySymbol:"$",thousandsSeparator:",",decimalSeparator:".",monetaryDecimals:2,nonMonetaryDecimals:2,denominations:aw.map(t=>({id:`d-${t.value}-${t.type}`,...t})),coordinateFormat:"DMS"},theme:ku[0],language:Au.EN},an=[{code:"BR",name:"Brazil",currency:"BRL",symbol:"R$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"}]},{code:"CA",name:"Canada",currency:"CAD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"CL",name:"Chile",currency:"CLP",symbol:"$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}]},{code:"CN",name:"China",currency:"CNY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.1,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"FR",name:"France",currency:"EUR",symbol:"",thousandsSeparator:" ",decimalSeparator:",",denominations:Ab},{code:"IN",name:"India",currency:"INR",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:2e3,type:"banknote"}]},{code:"ID",name:"Indonesia",currency:"IDR",symbol:"Rp",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"}]},{code:"IE",name:"Ireland",currency:"EUR",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:Ab},{code:"JP",name:"Japan",currency:"JPY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"MG",name:"Madagascar",currency:"MGA",symbol:"Ar",thousandsSeparator:" ",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"coin"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}],payroll:{constants:{socialContributions:[{key:"cnaps",rate:.01,cap:2041600},{key:"sanitary",rate:.01,cap:2041600}],incomeTax:{brackets:[{from:0,to:35e4,rate:0},{from:35e4,to:4e5,rate:.05},{from:4e5,to:5e5,rate:.1},{from:5e5,to:6e5,rate:.15},{from:6e5,to:1/0,rate:.2}],minimumPerception:3e3}},labels:{socialContributions:[{key:"cnaps",label:"CNaPS"},{key:"sanitary",label:"OSTIE / SANITAIRE"}],incomeTax:"IRSA"}}},{code:"MY",name:"Malaysia",currency:"MYR",symbol:"RM",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"KP",name:"North Korea",currency:"KPW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"}]},{code:"NO",name:"Norway",currency:"NOK",symbol:"kr",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"PH",name:"Philippines",currency:"PHP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"KR",name:"South Korea",currency:"KRW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:5e4,type:"banknote"}]},{code:"TZ",name:"Tanzania",currency:"TZS",symbol:"TSh",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:50,type:"coin"},{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"GB",name:"United Kingdom",currency:"GBP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"}]},{code:"US",name:"United States",currency:"USD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:aw},{code:"VN",name:"Vietnam",currency:"VND",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:2e3,type:"coin"},{value:5e3,type:"coin"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"},{value:2e5,type:"banknote"},{value:5e5,type:"banknote"}]}],kb=["EXW (Ex Works)","FCA (Free Carrier)","CPT (Carriage Paid To)","CIP (Carriage and Insurance Paid To)","DAP (Delivered at Place)","DPU (Delivered at Place Unloaded)","DDP (Delivered Duty Paid)","FAS (Free Alongside Ship)","FOB (Free on Board)","CFR (Cost and Freight)","CIF (Cost, Insurance and Freight)"],Db=["Cash in Advance (Prepayment)","Letter of Credit (L/C)","Documentary Collection (D/C)","Open Account (O/A)","Consignment"],gk=[{label:{en:"Dashboard",fr:"Tableau de bord"},path:"/dashboard",icon:"Home",permission:Ce.DASHBOARD_VIEW},{label:{en:"Operations",fr:"Oprations"},icon:"Layers",permission:Ce.OPERATIONS_VIEW,children:[{label:{en:"Farm Map",fr:"Carte de la ferme"},path:"/operations/map",icon:"Map"},{label:{en:"Operational Calendar",fr:"Calendrier Oprationnel"},path:"/operations/calendar",icon:"Calendar"},{label:{en:"Production Sites",fr:"Sites de production"},path:"/sites",icon:"MapPin"},{label:{en:"Seaweed Types",fr:"Types d'algues"},path:"/seaweed-types",icon:"Beaker"},{label:{en:"Module Management",fr:"Gestion des modules"},path:"/modules",icon:"Grid"},{label:{en:"Cutting Operations",fr:"Oprations de coupe"},path:"/operations/cutting",icon:"Scissors"},{label:{en:"Cultivation Cycle",fr:"Cycle de culture"},path:"/cultivation",icon:"GitBranch"},{label:{en:"Harvest & Processing",fr:"Rcolte et traitement"},path:"/harvesting",icon:"Scissors"},{label:{en:"Drying Management",fr:"Gestion du schage"},path:"/drying",icon:"Wind"},{label:{en:"Bagging",fr:"Mise en sac"},path:"/bagging",icon:"Archive"}]},{label:{en:"Inventory",fr:"Inventaire"},icon:"Package",permission:Ce.INVENTORY_VIEW,children:[{label:{en:"On-Site Storage",fr:"Stockage sur site"},path:"/inventory/on-site-storage",icon:"Warehouse"},{label:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},path:"/inventory/farmer-deliveries",icon:"Truck"},{label:{en:"Shipping Slips",fr:"Bons d'expdition"},path:"/inventory/site-transfers",icon:"ArrowRightLeft"},{label:{en:"Pressing Warehouse",fr:"Magasin de presse"},path:"/inventory/pressed-warehouse",icon:"Building"},{label:{en:"Exports",fr:"Exportations"},path:"/exports",icon:"Globe"}]},{label:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},icon:"Users",permission:Ce.STAKEHOLDERS_VIEW,children:[{label:{en:"Farmer Management",fr:"Gestion des fermiers"},path:"/farmers",icon:"User"},{label:{en:"Employee Management",fr:"Gestion des employs"},path:"/employees",icon:"Briefcase"},{label:{en:"Service Providers",fr:"Prestataires de services"},path:"/providers",icon:"Truck"},{label:{en:"Farmer Credits",fr:"Crdits fermiers"},path:"/farmer-credits",icon:"CreditCard"},{label:{en:"Document Payments",fr:"Paiements sur document"},path:"/document-payments",icon:"FileText"}]},{label:{en:"Monitoring",fr:"Suivi"},icon:"Activity",permission:Ce.MONITORING_VIEW,children:[{label:{en:"Periodic Tests",fr:"Tests priodiques"},path:"/monitoring/tests",icon:"Beaker"},{label:{en:"Incident Management",fr:"Gestion des incidents"},path:"/monitoring/incidents",icon:"AlertTriangle"}]},{label:{en:"Reports",fr:"Rapports"},path:"/reports",icon:"FileSpreadsheet",permission:Ce.REPORTS_VIEW},{label:{en:"User Manual",fr:"Manuel d'utilisateur"},path:"/manual",icon:"BookOpen"},{label:{en:"Settings",fr:"Paramtres"},icon:"Settings",permission:Ce.SETTINGS_VIEW,children:[{label:{en:"General",fr:"Gnraux"},path:"/settings/general",icon:"SlidersHorizontal"},{label:{en:"User Management",fr:"Gestion des utilisateurs"},path:"/settings/users",icon:"Users"},{label:{en:"Roles",fr:"Rles"},path:"/settings/roles",icon:"UserCog"},{label:{en:"Incident Types",fr:"Types d'incident"},path:"/settings/incident-types",icon:"Layers"},{label:{en:"Incident Severities",fr:"Svrits d'incident"},path:"/settings/incident-severities",icon:"TrendingUp"}]}],zr=45,Eg=7,Ip=30;function yk(t,e){const[n,r]=S.useState(()=>{if(typeof window>"u")return e;try{const l=window.localStorage.getItem(t);return l?JSON.parse(l):e}catch(l){return console.warn(`Error reading localStorage key ${t}:`,l),e}}),i=l=>{try{const c=l instanceof Function?l(n):l;r(c),typeof window<"u"&&window.localStorage.setItem(t,JSON.stringify(c))}catch(c){console.warn(`Error setting localStorage key ${t}:`,c)}};return S.useEffect(()=>{const l=c=>{if(c.key===t&&c.newValue!==null)try{r(JSON.parse(c.newValue))}catch(d){console.warn(`Error parsing storage change for key ${t}:`,d)}};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[t]),[n,i]}const ow=S.createContext(void 0),xk=({children:t})=>{const[e,n]=yk("appSettings",pk);S.useEffect(()=>{document.body.className="";const i=e.theme.className.split(" ").filter(Boolean);document.body.classList.add(...i,e.theme.font)},[e]);const r=i=>{n(i)};return s.jsx(ow.Provider,{value:{settings:e,updateSettings:r},children:t})},Ke=()=>{const t=S.useContext(ow);if(t===void 0)throw new Error("useSettings must be used within a SettingsProvider");return t},vk={appName:{en:"SEAFARM MONITOR",fr:"SEAFARM MONITOR"},seaweedType:{en:"Seaweed Type",fr:"Type d'algue"},serviceProvider:{en:"Service Provider",fr:"Prestataire"},farmer:{en:"Farmer",fr:"Fermier"},employee:{en:"Employee",fr:"Employ"},employees:{en:"Employees",fr:"Employs"},farmers:{en:"Farmers",fr:"Fermiers"},modules:{en:"Modules",fr:"Modules"},module:{en:"Module",fr:"Module"},site:{en:"Site",fr:"Site"},zone:{en:"Zone",fr:"Zone"},incident:{en:"Incident",fr:"Incident"},actions:{en:"Actions",fr:"Actions"},edit:{en:"Edit",fr:"Modifier"},delete:{en:"Delete",fr:"Supprimer"},cancel:{en:"Cancel",fr:"Annuler"},save:{en:"Save",fr:"Enregistrer"},confirm:{en:"Confirm",fr:"Confirmer"},close:{en:"Close",fr:"Fermer"},add:{en:"Add",fr:"Ajouter"},loading:{en:"Loading...",fr:"Chargement..."},date:{en:"Date",fr:"Date"},notes:{en:"Notes",fr:"Notes"},status:{en:"Status",fr:"Statut"},print:{en:"Print",fr:"Imprimer"},downloadPdf:{en:"Download PDF",fr:"Tlcharger en PDF"},exportExcel:{en:"Export Excel",fr:"Exporter Excel"},downloading:{en:"Downloading...",fr:"Tlchargement..."},back:{en:"Back",fr:"Retour"},optional:{en:"optional",fr:"optionnel"},apply:{en:"Apply",fr:"Appliquer"},all:{en:"All",fr:"Tous"},scan:{en:"Scan",fr:"Scanner"},unknown:{en:"Unknown",fr:"Inconnu"},yes:{en:"Yes",fr:"Oui"},no:{en:"No",fr:"Non"},none:{en:"None",fr:"Aucun"},batch:{en:"Batch",fr:"Lot"},unknown_batch:{en:"Unknown Batch",fr:"Lot inconnu"},welcomeBack:{en:"Welcome Back",fr:"Bon retour"},invalidCredentials:{en:"Invalid credentials",fr:"Identifiants invalides"},email:{en:"Email Address",fr:"Adresse email"},password:{en:"Password",fr:"Mot de passe"},forgotPassword:{en:"Forgot Password?",fr:"Mot de passe oubli ?"},forgotPasswordTitle:{en:"Forgot Password",fr:"Mot de passe oubli"},forgotPasswordInstructions:{en:"Enter your email address and we will send you a link to reset your password.",fr:"Entrez votre adresse email et nous vous enverrons un lien pour rinitialiser votre mot de passe."},sendResetLink:{en:"Send Reset Link",fr:"Envoyer le lien"},resetLinkSentTitle:{en:"Reset Link Sent",fr:"Lien de rinitialisation envoy"},resetLinkSentInstructions:{en:"Check your email for instructions to reset your password.",fr:"Vrifiez votre email pour les instructions de rinitialisation."},backToLogin:{en:"Back to Login",fr:"Retour  la connexion"},resetPasswordTitle:{en:"Reset Password",fr:"Rinitialiser le mot de passe"},newPassword:{en:"New Password",fr:"Nouveau mot de passe"},confirmNewPassword:{en:"Confirm New Password",fr:"Confirmer le nouveau mot de passe"},passwordMismatch:{en:"Passwords do not match",fr:"Les mots de passe ne correspondent pas"},passwordResetSuccess:{en:"Password reset successfully. Redirecting to login...",fr:"Mot de passe rinitialis avec succs. Redirection vers la connexion..."},invalidOrExpiredToken:{en:"Invalid or expired token.",fr:"Jeton invalide ou expir."},emailExists:{en:"Email already exists",fr:"L'email existe dj"},unassigned:{en:"Unassigned",fr:"Non assign"},traceabilityReport:{en:"Traceability Report",fr:"Rapport de traabilit"},moduleTraceability:{en:"Module Traceability",fr:"Traabilit du module"},batchTraceability:{en:"Batch Traceability",fr:"Traabilit du lot"},originInformation:{en:"Origin Information",fr:"Informations d'origine"},batchHistory:{en:"Batch History",fr:"Historique du lot"},dryingProcess:{en:"Drying Process",fr:"Processus de schage"},noActiveCycleFoundForModule:{en:"No active cycle found for this module.",fr:"Aucun cycle actif trouv pour ce module."},noDataForReport:{en:"No data available for this report period.",fr:"Aucune donne disponible pour cette priode de rapport."},noActions:{en:"No actions available.",fr:"Aucune action disponible."},search:{en:"Search",fr:"Rechercher"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},confirmDeleteTitle:{en:"Confirm Deletion",fr:"Confirmer la suppression"},tip_title:{en:"Tip",fr:"Astuce"},noHistory:{en:"No history events.",fr:"Aucun historique."},days:{en:"days",fr:"jours"},category:{en:"Category",fr:"Catgorie"},viewDetails:{en:"View Details",fr:"Voir dtails"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},termsOfUse:{en:"Terms of Use",fr:"Conditions d'utilisation"},privacyPolicy:{en:"Privacy Policy",fr:"Politique de confidentialit"},agreeToTerms:{en:"By signing up, you agree to our",fr:"En vous inscrivant, vous acceptez nos"},dashboard:{en:"Dashboard",fr:"Tableau de bord"},operations:{en:"Operations",fr:"Oprations"},inventory:{en:"Inventory",fr:"Inventaire"},stakeholders:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},monitoring:{en:"Monitoring",fr:"Suivi"},reports:{en:"Reports",fr:"Rapports"},userManual:{en:"User Manual",fr:"Manuel utilisateur"},settings:{en:"Settings",fr:"Paramtres"},profile:{en:"Profile",fr:"Profil"},logout:{en:"Logout",fr:"Dconnexion"},toggleTheme:{en:"Toggle Theme",fr:"Changer de thme"},notifications:{en:"Notifications",fr:"Notifications"},notifications_count:{en:"{count} notifications",fr:"{count} notifications"},noNotifications:{en:"No new notifications",fr:"Aucune nouvelle notification"},analyticalDashboard:{en:"Analytical Dashboard",fr:"Tableau de bord analytique"},activeCycles:{en:"Active Cycles",fr:"Cycles actifs"},totalCredits:{en:"Total Credits",fr:"Crdits totaux"},openIncidents:{en:"Open Incidents",fr:"Incidents ouverts"},employeeDistributionBySite:{en:"Employee Distribution by Site",fr:"Rpartition des employs par site"},recentIncidents:{en:"Recent Incidents",fr:"Incidents rcents"},noIncidents:{en:"No recent incidents.",fr:"Aucun incident rcent."},productionTrend:{en:"Production Trend",fr:"Tendance de la production"},performanceCorrelation:{en:"Performance Correlation",fr:"Corrlation des performances"},sitePerformance:{en:"Site Performance",fr:"Performance des sites"},farmerSegmentation:{en:"Farmer Segmentation",fr:"Segmentation des fermiers"},yieldBySeaweedType:{en:"Yield by Seaweed Type",fr:"Rendement par type d'algue"},yieldKgAxis:{en:"Yield (Kg)",fr:"Rendement (Kg)"},durationDaysAxis:{en:"Duration (days)",fr:"Dure (jours)"},totalYieldKgAxis:{en:"Total Yield (Kg)",fr:"Rendement total (Kg)"},numberOfCyclesAxis:{en:"Number of Cycles",fr:"Nombre de cycles"},averageYieldKg:{en:"Average Yield (Kg)",fr:"Rendement moyen (Kg)"},cyclePerformance:{en:"Cycle Performance",fr:"Performance du cycle"},totalYield:{en:"Total Yield",fr:"Rendement total"},aiOperationalInsights:{en:"AI Operational Insights",fr:"Aperus oprationnels par IA"},aiOperationalInsightsDescription:{en:"Get AI-powered insights on your farm operations.",fr:"Obtenez des aperus de vos oprations agricoles, optimiss par l'IA."},generateInsights:{en:"Generate Insights",fr:"Gnrer l'analyse"},farmMapTitle:{en:"Farm Map",fr:"Carte de la ferme"},streetView:{en:"Street View",fr:"Vue rue"},satelliteView:{en:"Satellite View",fr:"Vue satellite"},coordinates:{en:"Coordinates",fr:"Coordonnes"},activeLines:{en:"Active Lines",fr:"Lignes actives"},nearingHarvest:{en:"Nearing Harvest",fr:"Rcolte proche"},overdueHarvest:{en:"Overdue Harvest",fr:"Rcolte en retard"},satelliteAnalysisTitle:{en:"Satellite Analysis",fr:"Analyse satellite"},biomassLegendHigh:{en:"High Biomass",fr:"Biomasse leve"},algalBloomRisk:{en:"Algal Bloom Risk",fr:"Risque d'efflorescence algale"},satelliteSource:{en:"Source: Sentinel-2",fr:"Source: Sentinel-2"},analyzingSatellite:{en:"Analyzing...",fr:"Analyse..."},loadSatelliteData:{en:"Load Satellite Data",fr:"Charger donnes satellite"},operationalCalendarTitle:{en:"Operational Calendar",fr:"Calendrier oprationnel"},projectedHarvest:{en:"Projected Harvest",fr:"Rcolte prvue"},paymentRun:{en:"Payment Run",fr:"Paiement"},incidentsLabel:{en:"Incidents",fr:"Incidents"},periodicTest:{en:"Periodic Test",fr:"Test priodique"},growthRate:{en:"Growth Rate",fr:"Taux de croissance"},identity:{en:"Identity",fr:"Identit"},filterEvents:{en:"Filter Events",fr:"Filtrer les vnements"},invalidQRCode:{en:"Invalid QR Code",fr:"QR Code invalide"},scanInstruction:{en:"Position the QR code inside the frame.",fr:"Positionnez le code QR  l'intrieur du cadre."},photoGallery:{en:"Photo Gallery",fr:"Galerie Photos"},addPhoto:{en:"Add Photo",fr:"Ajouter une Photo"},photoCommentPlaceholder:{en:"Add a comment for this photo...",fr:"Ajoutez un commentaire pour cette photo..."},uploadDate:{en:"Uploaded on",fr:"Ajout le"},noPhotos:{en:"No photos in the gallery.",fr:"Aucune photo dans la galerie."},confirmDeletePhoto:{en:"Are you sure you want to delete this photo?",fr:"tes-vous sr de vouloir supprimer cette photo ?"},photoUploadedSuccess:{en:"Photo uploaded successfully.",fr:"Photo tlcharge avec succs."},validationRequired:{en:"This field is required",fr:"Ce champ est requis"},validationPositiveNumber:{en:"Must be a positive number",fr:"Doit tre un nombre positif"},validationNonNegative:{en:"Must be a non-negative number",fr:"Doit tre un nombre non-ngatif"},validationEmail:{en:"Invalid email format",fr:"Format d'email invalide"},validationSelectAtLeastOne:{en:"Select at least one item",fr:"Slectionnez au moins un lment"},validationDDLatitudeRange:{en:"Latitude must be a number between -90 and 90.",fr:"La latitude doit tre un nombre entre -90 et 90."},validationDDLongitudeRange:{en:"Longitude must be a number between -180 and 180.",fr:"La longitude doit tre un nombre entre -180 et 180."},settingsTitle:{en:"General Settings",fr:"Paramtres gnraux"},companySection:{en:"Company Information",fr:"Informations de l'entreprise"},localizationSection:{en:"Localization",fr:"Localisation"},denominationsSection:{en:"Currency Denominations",fr:"Coupures montaires"},interfaceSection:{en:"Interface",fr:"Interface"},saveConfiguration:{en:"Save Configuration",fr:"Enregistrer la configuration"},configurationSaved:{en:"Configuration saved successfully.",fr:"Configuration enregistre avec succs."},companyName:{en:"Company Name",fr:"Raison sociale"},capital:{en:"Share Capital",fr:"Capital social"},nif:{en:"Tax ID (NIF)",fr:"NIF"},rc:{en:"Trade Register (RC)",fr:"Registre du commerce (RCS)"},stat:{en:"Statistical ID (STAT)",fr:"Numro statistique (STAT)"},logo:{en:"Company Logo",fr:"Logo de l'entreprise"},changeLogo:{en:"Upload Logo",fr:"Tlcharger le logo"},removeLogo:{en:"Remove Logo",fr:"Supprimer le logo"},logoPreview:{en:"Logo Preview",fr:"Aperu du logo"},country:{en:"Country",fr:"Pays"},currencyFormat:{en:"Currency Format",fr:"Format de la devise"},separator_comma:{en:"Comma",fr:"Virgule"},separator_dot:{en:"Dot",fr:"Point"},separator_space:{en:"Space",fr:"Espace"},thousandsSeparator:{en:"Thousands Separator",fr:"Sparateur de milliers"},decimalSeparator:{en:"Decimal Separator",fr:"Sparateur dcimal"},monetaryDecimals:{en:"Monetary Decimals",fr:"Dcimales montaires"},nonMonetaryDecimals:{en:"Non-monetary Decimals",fr:"Dcimales non montaires"},coins:{en:"Coins",fr:"Pices"},banknotes:{en:"Bank Notes",fr:"Billets de banque"},denominationsDescriptionNew:{en:"Select the denominations available in your currency.",fr:"Slectionnez les coupures disponibles dans votre devise."},noDenominationsForCountry:{en:"No denominations found for this country.",fr:"Aucune coupure montaire trouve pour ce pays."},language_en:{en:"English",fr:"Anglais"},language_fr:{en:"French",fr:"Franais"},visualAppearance:{en:"Visual Appearance",fr:"Apparence visuelle"},roleManagementTitle:{en:"Role Management",fr:"Gestion des rles"},addRole:{en:"Add New Role",fr:"Ajouter un nouveau rle"},roleName:{en:"Role Name",fr:"Nom du rle"},editRole:{en:"Edit Role",fr:"Modifier le rle"},confirmDeleteRole:{en:"Are you sure you want to delete this role?",fr:"tes-vous sr de vouloir supprimer ce rle ?"},dataManagementSection:{en:"Data Management",fr:"Gestion des donnes"},resetData:{en:"Reset All Data",fr:"Rinitialiser les donnes"},resetDataWarning:{en:"This will permanently delete all data in the application. This action cannot be undone.",fr:"Cette action supprimera dfinitivement toutes les donnes de l'application. Cette action est irrversible."},confirmResetData:{en:"Are you sure you want to reset all data? This is irreversible.",fr:"tes-vous sr de vouloir rinitialiser toutes les donnes ? C'est irrversible."},dataResetSuccess:{en:"All data has been reset successfully.",fr:"Toutes les donnes ont t rinitialises avec succs."},userProfileTitle:{en:"User Profile",fr:"Profil Utilisateur"},editProfile:{en:"Edit Profile",fr:"Modifier le profil"},profileUpdatedSuccess:{en:"Profile updated successfully.",fr:"Profil mis  jour avec succs."},saveChanges:{en:"Save Changes",fr:"Enregistrer les modifications"},phoneNumber:{en:"Phone Number",fr:"Numro de Tlphone"},customRoleFor:{en:"Custom Role for {recipient}",fr:"Rle personnalis pour {recipient}"},sendInvitation:{en:"Send Invitation",fr:"Envoyer l'Invitation"},inviteMode:{en:"Invite Mode",fr:"Mode d'Invitation"},selectRoleMode:{en:"Assign Role",fr:"Assigner un Rle"},customPermissionsMode:{en:"Custom Permissions",fr:"Permissions Personnalises"},validationPhone:{en:"Invalid phone number",fr:"Numro de tlphone invalide"},manual_architecture_title:{en:"System Architecture",fr:"Architecture du systme"},manual_setup_title:{en:"Initial Setup & Configuration",fr:"Configuration initiale"},manual_production_title:{en:"Production & Cultivation",fr:"Production & Culture"},manual_inventory_title:{en:"Logistics Flow",fr:"Flux logistique"},manual_finance_title:{en:"Finance & Payments",fr:"Finance & Paiements"},manual_monitoring_title:{en:"Monitoring & Quality Control",fr:"Suivi & Contrle qualit"},manual_reports_title:{en:"Data Reporting & Export",fr:"Rapports & Exportation"},status_legend_title:{en:"Status Color Codes",fr:"Lgende des codes couleurs"},manual_setup_desc:{en:"Before starting operations, ensure the base data is correctly configured.",fr:"Avant de commencer les oprations, assurez-vous que les donnes de base sont correctement configures."},step_desc_define_locations:{en:"Define Locations",fr:"Dfinir les lieux"},step_desc_create_infra:{en:"Create Infrastructure",fr:"Crer l'infrastructure"},step_desc_add_personnel:{en:"Add Personnel",fr:"Ajouter le personnel"},step_desc_link_farmers:{en:"Link Farmers to Modules",fr:"Lier fermiers aux modules"},step_desc_collection:{en:"Collection",fr:"Collecte"},step_desc_shipping_slip:{en:"Shipping Slip",fr:"Bon d'expdition"},step_desc_reception:{en:"Reception",fr:"Rception"},step_desc_processing:{en:"Processing",fr:"Traitement"},step_desc_shipping:{en:"Shipping",fr:"Expdition"},step_desc_weekly:{en:"Weekly",fr:"Hebdomadaire"},step_desc_ai:{en:"AI Diagnosis",fr:"Diagnostic IA"},step_desc_action:{en:"Action Plan",fr:"Plan d'action"},manual_inventory_note:{en:'Note: Site Transfers create "Shipping Slips". Pressing uses "Pressing Slips" to convert Bulk stock to Pressed Bales.',fr:`Note : Les transferts inter-sites crent des "Bons d'expdition". Le pressage utilise des "Bons de pressage" pour convertir le vrac en balles.`},desc_select_payment_type:{en:"Select Wet/Dry/Service/Payroll",fr:"Slectionner Humide/Sec/Prestation/Paie"},desc_filter_site:{en:"Filter by site (optional)",fr:"Filtrer par site (optionnel)"},manual_finance_formula_title:{en:"Net Payable Formula",fr:"Formule du net  payer"},manual_finance_formula_text:{en:`(Harvest Weight - Cuttings) * Price
- Credits (Rice, Cash)
= Net Payment`,fr:`(Poids Rcolt - Boutures) * Prix
- Crdits (Riz, Espces)
= Net  Payer`},manual_finance_reports_text:{en:"Generate PDF Payment Sheets and Individual Receipts automatically from the Document Payments page.",fr:"Gnrez automatiquement des feuilles de paiement PDF et des reus individuels depuis la page Documents de Paiement."},desc_select_period:{en:"Select growth period (Planting -> P5)",fr:"Slectionner priode de croissance (Plantation -> P5)"},desc_optional_api:{en:"Optional (can fetch from API)",fr:"Optionnel (via API)"},desc_manual_entry:{en:"Manual Entry",fr:"Saisie manuelle"},legend_module_desc:{en:"Green indicates active growth. Blue indicates post-harvest processing.",fr:"Vert indique une croissance active. Bleu indique le traitement post-rcolte."},legend_incident_desc:{en:"Critical incidents trigger immediate alerts on the Dashboard.",fr:"Les incidents critiques dclenchent des alertes immdiates sur le tableau de bord."},manual_finance_desc:{en:"Track farmer credits, record repayments, and generate payment sheets for wet/dry deliveries and services.",fr:"Suivez les crdits fermiers, enregistrez les remboursements et gnrez des feuilles de paiement pour les livraisons humides/sches et les services."},step_sites:{en:"Create Sites",fr:"Crer sites"},step_modules:{en:"Setup Modules",fr:"Config modules"},step_farmers:{en:"Register Farmers",fr:"Enr. fermiers"},step_assign:{en:"Assignation",fr:"Assignation"},step_log_test:{en:"Log Environmental Data",fr:"Saisie donnes environnement"},step_analyze_pest:{en:"Analyze Pests (AI)",fr:"Analyse parasites (IA)"},step_resolve_incident:{en:"Resolve & Close",fr:"Rsoudre & fermer"},field_site_name:{en:'The display name of the site (e.g., "Site A").',fr:`Le nom d'affichage du site (ex: "Site A").`},field_manager:{en:"The employee responsible for this site.",fr:"L'employ responsable de ce site."},field_zones:{en:"Geographical subdivisions drawn on the map.",fr:"Subdivisions gographiques dessines sur la carte."},field_module_code:{en:"Unique identifier (auto-generated or manual).",fr:"Identifiant unique (auto-gnr ou manuel)."},field_module_lines:{en:"Number of cultivation lines in this module.",fr:"Nombre de lignes de culture dans ce module."},field_harvest_weight:{en:"Wet weight of seaweed measured immediately after harvest.",fr:"Poids humide des algues mesur immdiatement aprs la rcolte."},field_cuttings_taken:{en:"Weight of seaweed kept for replanting (deducted from net production).",fr:"Poids des algues conserves pour la replantation (dduit de la production nette)."},field_water_temp:{en:"Water Temperature (C)",fr:"Temprature eau (C)"},field_salinity:{en:"Salinity ()",fr:"Salinit ()"},report_type_global:{en:"Global Farm Report: The master monthly document.",fr:"Rapport Global : Le document mensuel de rfrence."},report_type_farmer:{en:"Individual Farmer Report: For performance reviews.",fr:"Rapport Individuel : Pour les revues de performance."},report_type_payment:{en:"Payment Sheets: For payroll and cash distribution.",fr:"Feuilles de Paie : Pour la distribution."},legend_module_status:{en:"Module Statuses",fr:"Statuts des modules"},legend_incident_severity:{en:"Incident Severity",fr:"Gravit incident"},status_PLANTED:{en:"Planted",fr:"Plant"},status_GROWING:{en:"Growing",fr:"En croissance"},status_HARVESTED:{en:"Harvested",fr:"Rcolt"},status_DRYING:{en:"Drying",fr:"Schage"},status_BAGGING:{en:"Bagging",fr:"Ensachage"},status_BAGGED:{en:"Bagged",fr:"Ensach"},status_IN_STOCK:{en:"In Stock",fr:"En stock"},status_EXPORTED:{en:"Exported",fr:"Export"},status_MAINTENANCE:{en:"Maintenance",fr:"Maintenance"},status_STORED:{en:"Stored",fr:"Stock"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},status_CREATED:{en:"Created",fr:"Cr"},status_CUTTING:{en:"Cutting",fr:"Bouturage"},flow_planting:{en:"Planting",fr:"Plantation"},flow_growing:{en:"Growth",fr:"Croissance"},flow_harvest:{en:"Harvest",fr:"Rcolte"},flow_drying:{en:"Drying",fr:"Schage"},flow_bagging:{en:"Bagging",fr:"Ensachage"},flow_stock:{en:"Stock",fr:"Stock"},flow_transfer:{en:"Transfer",fr:"Transfert"},flow_warehouse:{en:"Warehouse",fr:"Magasin"},flow_pressing:{en:"Pressing",fr:"Pressage"},flow_export:{en:"Export",fr:"Export"},tip_auto_growth:{en:"The system automatically calculates growth rates based on initial and harvest weights.",fr:"Le systme calcule automatiquement les taux de croissance bass sur les poids initiaux et rcolts."},tip_map_interaction:{en:"You can click on modules on the map to see their status and perform actions directly.",fr:"Vous pouvez cliquer sur les modules sur la carte pour voir leur statut et effectuer des actions directement."},tip_offline:{en:"The app works offline. Data syncs when connection is restored.",fr:"L'application fonctionne hors ligne. Les donnes se synchronisent au retour de la connexion."},tip_ai_pest:{en:"Use the camera icon in Incident Reporting to take a picture of diseased seaweed. The AI will identify the pest and suggest treatment.",fr:"Utilisez l'icne camra dans le signalement d'incident pour photographier une algue malade. L'IA identifiera le problme et suggrera un traitement."},guide_how_to_harvest:{en:"How to Record a Harvest",fr:"Comment enregistrer une rcolte"},guide_how_to_pay:{en:"How to Run Payments",fr:"Comment excuter les paiements"},guide_periodic_test:{en:"Recording a Periodic Test",fr:"Enregistrer un test priodique"},manual_desc_planting:{en:'Record a "Cutting Operation" to start a cycle.',fr:'Enregistrez une "Opration de coupe" pour dmarrer un cycle.'},manual_desc_harvest:{en:"Log harvested weight. Cycle moves to Drying.",fr:"Saisissez le poids rcolt. Le cycle passe en schage."},manual_desc_processing:{en:"Track dry weight and bag count. Inventory is updated.",fr:"Suivez le poids sec et le nombre de sacs. L'inventaire est mis  jour."},mon:{en:"Mon",fr:"Lun"},tue:{en:"Tue",fr:"Mar"},wed:{en:"Wed",fr:"Mer"},thu:{en:"Thu",fr:"Jeu"},fri:{en:"Fri",fr:"Ven"},sat:{en:"Sat",fr:"Sam"},sun:{en:"Sun",fr:"Dim"},january:{en:"January",fr:"Janvier"},february:{en:"February",fr:"Fvrier"},march:{en:"March",fr:"Mars"},april:{en:"April",fr:"Avril"},may:{en:"May",fr:"Mai"},june:{en:"June",fr:"Juin"},july:{en:"July",fr:"Juillet"},august:{en:"August",fr:"Aot"},september:{en:"September",fr:"Septembre"},october:{en:"October",fr:"Octobre"},november:{en:"November",fr:"Novembre"},december:{en:"December",fr:"Dcembre"},legend:{en:"Legend",fr:"Lgende"},assignedModule:{en:"Assigned Module",fr:"Module assign"},freeModule:{en:"Free Module",fr:"Module libre"}},bk={siteManagementTitle:{en:"Site Management",fr:"Gestion des sites"},addSite:{en:"Add Site",fr:"Ajouter un site"},sitePerformanceOverview:{en:"Site Performance Overview",fr:"Aperu des performances des sites"},geminiSiteAnalysis:{en:"Gemini Site Analysis",fr:"Analyse de Site par Gemini"},generateAnalysis:{en:"Generate Analysis",fr:"Gnrer l'analyse"},sites:{en:"Sites",fr:"Sites"},totalModules:{en:"Total Modules",fr:"Total des modules"},totalHarvestedWeightBySite:{en:"Total Harvested Weight by Site",fr:"Poids total rcolt par site"},avgHarvestPerModuleCurrentYear:{en:"Avg Yield/Module (Current Year)",fr:"Rendement moyen/module (Anne en cours)"},geoPoints:{en:"Geo Points",fr:"Points Gographiques"},addPoint:{en:"Add Point",fr:"Ajouter un point"},remove:{en:"Remove",fr:"Retirer"},latitude:{en:"Latitude",fr:"Latitude"},longitude:{en:"Longitude",fr:"Longitude"},latitudeDMS:{en:"Latitude (DMS)",fr:"Latitude (DMS)"},longitudeDMS:{en:"Longitude (DMS)",fr:"Longitude (DMS)"},siteLayout:{en:"Site Layout",fr:"Plan du Site"},siteName:{en:"Site Name",fr:"Nom du site"},siteCode:{en:"Site Code",fr:"Code du site"},manager:{en:"Manager",fr:"Responsable"},noManager:{en:"No Manager",fr:"Aucun responsable"},zones:{en:"Zones",fr:"Zones"},zoneName:{en:"Zone Name",fr:"Nom de la zone"},addZone:{en:"Add Zone",fr:"Ajouter une zone"},selectZone:{en:"Select Zone",fr:"Slectionner une zone"},noZonesDefined:{en:"No zones defined for this site.",fr:"Aucune zone dfinie pour ce site."},editSite:{en:"Edit Site",fr:"Modifier le site"},confirmDeleteSite:{en:"Are you sure you want to delete this site?",fr:"tes-vous sr de vouloir supprimer ce site ?"},invalidDMSFormat:{en:"Invalid DMS format",fr:"Format DMS invalide"},coordinateFormat_DMS:{en:"Degrees, Minutes, Seconds",fr:"Degrs, Minutes, Secondes"},coordinateFormat_DD:{en:"Decimal Degrees",fr:"Degrs Dcimaux"},noPoints:{en:"No geo points added yet.",fr:"Aucun point gographique ajout."},moduleManagementTitle:{en:"Module Management",fr:"Gestion des Modules"},addModule:{en:"Add Module",fr:"Ajouter un Module"},moduleCode:{en:"Module Code",fr:"Code Module"},farmer:{en:"Farmer",fr:"Fermier"},filtersTitle:{en:"Filters",fr:"Filtres"},allSites:{en:"All Sites",fr:"Tous les Sites"},allZones:{en:"All Zones",fr:"Toutes les Zones"},allFarmers:{en:"All Farmers",fr:"Tous les Fermiers"},allStatuses:{en:"All Statuses",fr:"Tous les Statuts"},clearFilters:{en:"Clear Filters",fr:"Effacer les Filtres"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},alerts:{en:"Alerts",fr:"Alertes"},confirmDeleteModule:{en:"Are you sure you want to delete this module?",fr:"tes-vous sr de vouloir supprimer ce module ?"},editModule:{en:"Edit Module",fr:"Modifier le Module"},configuration:{en:"Configuration",fr:"Configuration"},lines:{en:"Lines",fr:"Lignes"},galvanizedPoles:{en:"Galvanized Poles",fr:"Piquets Galvaniss"},woodPoles:{en:"Wood Poles",fr:"Piquets en Bois"},plasticPoles:{en:"Plastic Poles",fr:"Piquets en Plastique"},moduleMoveActiveCycleWarning:{en:"Warning: This module has an active cultivation cycle. Moving it might affect data consistency.",fr:"Attention : Ce module a un cycle de culture actif. Le dplacer pourrait affecter la cohrence des donnes."},moduleStatusHistoryTitle:{en:"Module Status History",fr:"Historique du Statut du Module"},notes_moduleReadyForAssignment:{en:"Module is ready for assignment.",fr:"Le module est prt  tre assign."},notes_moduleAssignedToFarmer:{en:"Assigned to farmer {farmerName}",fr:"Assign au fermier {farmerName}"},notes_cycleCompletedModuleAvailable:{en:"Cycle completed. Module is available.",fr:"Cycle termin. Le module est disponible."},moduleDetails:{en:"Module Details",fr:"Dtails du Module"},generalInformation:{en:"General Information",fr:"Informations Gnrales"},cultivationCycleManagementTitle:{en:"Cultivation Cycles",fr:"Cycles de Culture"},cultivationCycle:{en:"Cultivation Cycle",fr:"Cycle de Culture"},addCycle:{en:"Add Cycle",fr:"Ajouter un Cycle"},ageInDays:{en:"Age (Days)",fr:"ge (Jours)"},harvestDate:{en:"Harvest Date",fr:"Date de Rcolte"},harvest:{en:"Harvest",fr:"Rcolter"},history:{en:"History",fr:"Historique"},performance:{en:"Performance",fr:"Performance"},initialWeight:{en:"Initial Weight",fr:"Poids Initial"},linesPlanted:{en:"Lines Planted",fr:"Lignes Plantes"},harvestedWeight:{en:"Harvested Weight",fr:"Poids Rcolt"},linesHarvested:{en:"Lines Harvested",fr:"Lignes Rcoltes"},aiPrediction:{en:"AI Prediction",fr:"Prdiction IA"},retry:{en:"Retry",fr:"Ressayer"},predictedHarvest:{en:"Predicted Harvest",fr:"Rcolte Prvue"},predictedYieldKg:{en:"Predicted Yield (Kg)",fr:"Rendement Prvu (Kg)"},confidence:{en:"Confidence",fr:"Confiance"},predict:{en:"Predict",fr:"Prdire"},predictionError:{en:"Prediction failed",fr:"chec de la prdiction"},editCycle:{en:"Edit Cycle",fr:"Modifier le Cycle"},module:{en:"Module",fr:"Module"},plantingDate:{en:"Planting Date",fr:"Date de Plantation"},confirmHarvestTitle:{en:"Confirm Harvest",fr:"Confirmer la Rcolte"},confirmHarvestMessage:{en:"Please enter the harvest details below.",fr:"Veuillez entrer les dtails de la rcolte ci-dessous."},wetProduction:{en:"Wet Production (Net)",fr:"Production Humide (Net)"},harvestReason:{en:"Harvest Reason",fr:"Motif de Rcolte"},harvestReason_maturity:{en:"Harvest for maturity",fr:"Rcolte pour maturit"},other:{en:"Other",fr:"Autre"},otherReasonPlaceholder:{en:"Specify reason...",fr:"Prcisez le motif..."},validationReasonRequired:{en:"Reason required",fr:"Motif requis"},exactAge:{en:"Exact Age: {days} days",fr:"ge exact : {days} jours"},confirmDeleteCycle:{en:"Are you sure you want to delete this cycle?",fr:"tes-vous sr de vouloir supprimer ce cycle ?"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netHarvestedWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},cultivationCycleHistoryTitle:{en:"Cycle History",fr:"Historique du Cycle"},noCycleHistoryEvents:{en:"No history events found for this cycle.",fr:"Aucun vnement historique trouv pour ce cycle."},cuttingOperationsTitle:{en:"Cutting Operations",fr:"Oprations de Coupe"},newPlanting:{en:"New Planting (Cutting)",fr:"Nouvelle Plantation (Bouturage)"},addOperation:{en:"Add Operation",fr:"Ajouter une Opration"},beneficiaryFarmers:{en:"Beneficiary Farmers",fr:"Fermiers Bnficiaires"},modules_cutting:{en:"Modules",fr:"Modules"},isPaid:{en:"Is Paid",fr:"Est Pay"},paid:{en:"Paid",fr:"Pay"},unpaid:{en:"Unpaid",fr:"Impay"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},noBeneficiary:{en:"No Beneficiary",fr:"Aucun Bnficiaire"},editCuttingOperation:{en:"Edit Cutting Operation",fr:"Modifier l'Opration de Coupe"},confirmDeleteCuttingOperation:{en:"Are you sure you want to delete this operation? This will also remove the associated cultivation cycle and any related farmer credits. This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer cette opration ? Cela supprimera galement le cycle de culture associ et tous les crdits fermiers lis. Cette action est irrversible."},selectProvider:{en:"Select Provider",fr:"Slectionner un Prestataire"},unitPricePerLine:{en:"Unit Price per Line",fr:"Prix Unitaire par Ligne"},totalLinesCut:{en:"Total Lines Cut",fr:"Total Lignes Coupes"},noFarmersAssignedToModules:{en:"No farmers assigned to selected modules.",fr:"Aucun fermier assign aux modules slectionns."},dateOperation:{en:"Operation Date",fr:"Date de l'Opration"},detailsModule:{en:"Module Details",fr:"Dtails du Module"},zonePlantation:{en:"Planting Zone",fr:"Zone de Plantation"},numModule:{en:"Module Number",fr:"Numro de Module"},selectAModule:{en:"Select a Module",fr:"Slectionner un Module"},nombreLignesCoupees:{en:"Number of Lines Cut",fr:"Nombre de Lignes Coupes"},poidsInitialLignes:{en:"Initial Weight (Total)",fr:"Poids Initial (Total)"},fermierBeneficiaire:{en:"Beneficiary Farmer",fr:"Fermier Bnficiaire"},valeurBouturage:{en:"Cutting Value",fr:"Valeur du Bouturage"},notes_plantingOperationForModule:{en:"Planting operation for module {code}",fr:"Opration de plantation pour le module {code}"},validationLinesCutPositive:{en:"Lines cut must be greater than 0",fr:"Le nombre de lignes coupes doit tre suprieur  0"},validationPlantingDateAfterOperation:{en:"Planting date must be on or after the operation date.",fr:"La date de plantation doit tre identique ou postrieure  la date de l'opration."},harvestProcessingTitle:{en:"Harvest & Processing",fr:"Rcolte et Traitement"},dryingManagementTitle:{en:"Drying Management",fr:"Gestion du Schage"},baggingManagementTitle:{en:"Bagging Management",fr:"Gestion de l'Ensachage"},startDrying:{en:"Start Drying",fr:"Dmarrer le Schage"},noHarvestedBatches:{en:"No harvested batches waiting for drying.",fr:"Aucun lot rcolt en attente de schage."},startDryingFor:{en:"Start Drying for",fr:"Dmarrer le schage pour"},growthRateUnit:{en:"% / day",fr:"% / jour"},dryingStartDate:{en:"Drying Start Date",fr:"Date de Dbut de Schage"},geminiSuggestion:{en:"Gemini Suggestion",fr:"Suggestion Gemini"},noSuggestion:{en:"No suggestion available.",fr:"Aucune suggestion disponible."},completeDrying:{en:"Complete Drying",fr:"Terminer le Schage"},noBatchesDrying:{en:"No batches currently drying.",fr:"Aucun lot en cours de schage."},completeDryingFor:{en:"Complete Drying for",fr:"Terminer le schage pour"},dryingCompletionDate:{en:"Drying Completion Date",fr:"Date de Fin de Schage"},baggingStartDate:{en:"Bagging Start Date",fr:"Date de Dbut d'Ensachage"},actualDryWeight:{en:"Actual Dry Weight (Kg)",fr:"Poids Sec Rel (Kg)"},dryWeightToBag:{en:"Dry Weight to Bag (Kg)",fr:"Poids Sec  Ensacher (Kg)"},completeBagging:{en:"Complete Bagging",fr:"Terminer l'Ensachage"},noBatchesBagging:{en:"No batches currently bagging.",fr:"Aucun lot en cours d'ensachage."},completeSelectedBatches:{en:"Complete Selected ({count})",fr:"Terminer la Slection ({count})"},confirmBatchBaggingTitle:{en:"Batch Bagging Completion",fr:"Terminaison d'Ensachage en Lot"},confirmBatchBaggingMessage:{en:"You are about to complete bagging for {count} batches. Default bagging date will be set to {date}. Proceed?",fr:"Vous tes sur le point de terminer l'ensachage pour {count} lots. La date par dfaut sera {date}. Continuer ?"},completeBaggingFor:{en:"Complete Bagging for",fr:"Terminer l'ensachage pour"},confirmAndMoveToStock:{en:"Confirm & Move to Stock",fr:"Confirmer & Mettre en Stock"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},weightToBag:{en:"Weight to Bag",fr:"Poids  Ensacher"},bagWeights:{en:"Bag Weights (Kg)",fr:"Poids des Sacs (Kg)"},bag:{en:"Bag",fr:"Sac"},validationAtLeastOneRequired:{en:"At least one weight is required.",fr:"Au moins un poids est requis."},totalBaggedWeightKg:{en:"Total Bagged Weight",fr:"Poids Total Ensach"},batchBaggingCompleteSuccess:{en:"Batch bagging completed successfully.",fr:"Ensachage par lot termin avec succs."},selectBatch:{en:"Select batch {code}",fr:"Slectionner le lot {code}"},dryingDuration:{en:"Drying Duration (Days)",fr:"Dure de Schage (Jours)"},pricePerLine:{en:"Price per Line",fr:"Prix par Ligne"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"}},Nk={clientDetails:{en:"Client / Debtor Details",fr:"Dtails Client / Dbiteur"},notifyPartyDetails:{en:"Notify Party / Consignee Details",fr:"Dtails Destinataire / Partie  notifier"},documentDetails:{en:"Document Details",fr:"Dtails du Document"},docType:{en:"Document Type",fr:"Type de document"},invoiceNo:{en:"Invoice No.",fr:"N Facture"},natureLabel:{en:"Nature of Goods",fr:"Nature de la Marchandise"},poNo:{en:"P.O. No.",fr:"N Bon de Commande"},domiciliationNo:{en:"Domiciliation No.",fr:"N Domiciliation"},rexReference:{en:"REX Reference",fr:"Rfrence REX"},destinationCountry:{en:"Destination Country",fr:"Pays de Destination"},city:{en:"City",fr:"Ville"},notifyParty:{en:"Notify Party",fr:"Destinataire ( notifier)"},debtor:{en:"Debtor / Client",fr:"Client / Dbiteur"},vessel:{en:"Vessel",fr:"Navire"},seaWaybill:{en:"Sea Waybill",fr:"Lettre de Transport Maritime"},voyageNo:{en:"Voyage No.",fr:"N de Voyage"},currency:{en:"Currency",fr:"Devise"},localExchangeRate:{en:"Local Exchange Rate",fr:"Taux de change local"},customsNomenclature:{en:"Customs Nomenclature (HS Code)",fr:"Nomenclature Douanire (Code SH)"},countryOfOrigin:{en:"Country of Origin",fr:"Pays d'Origine"},incoterms:{en:"Incoterms",fr:"Incoterms"},paymentTerms:{en:"Payment Terms",fr:"Conditions de Paiement"},swiftBank:{en:"SWIFT / Bank",fr:"Banque / SWIFT"},selectPressingSlips:{en:"Select Pressing Slips",fr:"Slectionner les Bons de Pressage"},availableSlips:{en:"Available Slips",fr:"Bons Disponibles"},selectedSlips:{en:"Selected Slips",fr:"Bons Slectionns"},totalSelectedWeight:{en:"Total Weight",fr:"Poids Total"},totalSelectedBales:{en:"Total Bales",fr:"Total Balles"},noSlipsAvailable:{en:"No slips available for the selected seaweed type.",fr:"Aucun bon disponible pour le type d'algue slectionn."},containerManagement:{en:"Container Management",fr:"Gestion des Conteneurs"},container:{en:"Container",fr:"Conteneur"},identification:{en:"Identification",fr:"Identification"},weights:{en:"Weights",fr:"Poids"},contentsAndValue:{en:"Contents & Value",fr:"Contenu & Valeur"},containerNo:{en:"Container No.",fr:"N Conteneur"},sealNo:{en:"Seal No.",fr:"N de Plomb"},containerType:{en:"Container Type",fr:"Type de Conteneur"},volumeM3:{en:"Volume (m)",fr:"Volume (m)"},tareKg:{en:"Tare Weight (Kg)",fr:"Poids  Vide (Tare) (Kg)"},packageWeightKg:{en:"Packaging Weight (Kg)",fr:"Poids de l'Emballage (Kg)"},seaweedWeightKg:{en:"Net Seaweed Weight (Kg)",fr:"Poids Net des Algues (Kg)"},grossWeightKg:{en:"Gross Weight (Kg)",fr:"Poids Brut (Kg)"},packagesCount:{en:"Bale Count",fr:"Nombre de Balles"},unitPrice:{en:"Unit Price",fr:"Prix Unitaire"},addContainer:{en:"Add Container",fr:"Ajouter un Conteneur"},totalContainerWeight:{en:"Total Container Weight",fr:"Poids Total des Conteneurs"},totalContainerBales:{en:"Total Container Bales",fr:"Total des Balles"},validationContainerWeights:{en:"Sum of container seaweed weights must match total selected slip weight.",fr:"La somme des poids d'algues des conteneurs doit correspondre au poids total des bons slectionns."},validationContainerBales:{en:"Sum of container bale counts must match total selected slip bales.",fr:"La somme du nombre de balles des conteneurs doit correspondre au total des balles des bons slectionns."},alert_noValidSlips:{en:"No valid pressing slips selected. Please select at least one.",fr:"Aucun bon de pressage valide slectionn. Veuillez en slectionner au moins un."},alert_cannotDetermineSourceSite:{en:"Could not determine the origin site for the selected slips. Please check the data consistency.",fr:"Impossible de dterminer le site d'origine pour les bons slectionns. Veuillez vrifier la cohrence des donnes."},COMMERCIAL_INVOICE:{en:"Commercial Invoice",fr:"Facture Commerciale"},PACKING_LIST:{en:"Packing List",fr:"Liste de Colisage"},CERTIFICATE_OF_ORIGIN:{en:"Certificate of Origin",fr:"Certificat d'Origine"},onSiteStorageTitle:{en:"On-Site Storage",fr:"Stockage sur site"},recordMovement:{en:"Record Movement",fr:"Enregistrer un mouvement"},stockStatus:{en:"Stock Status",fr:"tat du stock"},normalTransfer:{en:"Normal Transfer",fr:"Transfert normal"},movementHistory:{en:"Movement History",fr:"Historique des mouvements"},farmerDeliveriesTitle:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},recordDelivery:{en:"Record Delivery",fr:"Enregistrer une livraison"},slipNo:{en:"Slip No.",fr:"N Bordereau"},farmerLabel:{en:"Farmer",fr:"Fermier"},totalBags:{en:"Total Bales",fr:"Total Balles"},noDeliveriesRecorded:{en:"No deliveries recorded yet.",fr:"Aucune livraison enregistre pour le moment."},confirmDeleteDelivery:{en:"Are you sure you want to delete this delivery? This will also reverse the stock movement.",fr:"tes-vous sr de vouloir supprimer cette livraison ? Cela annulera galement le mouvement de stock."},newDelivery:{en:"New Dry Seaweed Delivery",fr:"Nouvelle livraison d'algues sches"},receivedAtWarehouse:{en:"Record as Received",fr:"Enregistrer comme reu"},destination:{en:"Destination",fr:"Destination"},siteTransfersTitle:{en:"Shipping Slips (Inter-Site Transfers)",fr:"Bons d'expdition (Transferts inter-sites)"},pressedWarehouseTitle:{en:"Pressing Warehouse",fr:"Magasin de Presse"},summaryView:{en:"Summary",fr:"Rsum"},pressingSlips:{en:"Pressing Slips",fr:"Bons de Pressage"},recordPressingSlip:{en:"Record Pressing Slip",fr:"Saisir Bon de Pressage"},newPressingSlip:{en:"New Pressing Slip",fr:"Nouveau Bon de Pressage"},editPressingSlip:{en:"Edit Pressing Slip",fr:"Modifier Bon de Pressage"},bulkSeaweed:{en:"Bulk Seaweed",fr:"Algues en Vrac"},pressedSeaweed:{en:"Pressed Seaweed",fr:"Algues Presses"},forPressing:{en:"For Pressing",fr:"Pour Pressage"},bales:{en:"Bales",fr:"Balles"},linkedExport:{en:"Linked Export",fr:"Export Li"},cannotDeleteLinkedSlip:{en:"Cannot delete: Linked to Export",fr:"Suppression impossible: Li  un Export"},confirmDeletePressingSlip:{en:"Are you sure you want to delete this pressing slip? This will reverse the stock movements.",fr:"tes-vous sr de vouloir supprimer ce bon de pressage ? Cela annulera les mouvements de stock."},confirmDeletePressingSlipLinked:{en:"This slip cannot be deleted because it is linked to an export document.",fr:"Ce bon ne peut pas tre supprim car il est li  un document d'exportation."},exports:{en:"Exports",fr:"Exportations"},createExportDocument:{en:"Create Export Document",fr:"Crer Document Export"},editExportDocument:{en:"Edit Export Document",fr:"Modifier Document Export"},docNo:{en:"Doc No.",fr:"N Doc."},containers:{en:"Containers",fr:"Conteneurs"},documents:{en:"Documents",fr:"Documents"},confirmDeleteExport:{en:"Are you sure you want to delete this export document? This will reverse stock movements.",fr:"tes-vous sr de vouloir supprimer ce document ? Cela annulera les mouvements de stock."},totalStockKgHeader:{en:"Total Stock (Kg)",fr:"Stock total (Kg)"},totalWeightKgDelivery:{en:"Total Weight (Kg)",fr:"Poids total (Kg)"},balesCountLabel:{en:"Bale Count",fr:"Nombre de balles"},bags:{en:"Bags",fr:"Sacs"},sac:{en:"Bag",fr:"Sac"},baleSingular:{en:"Bale",fr:"Balle"},totalStockValue:{en:"Total Stock Value",fr:"Valeur totale du stock"},distinctStockItems:{en:"Distinct Items",fr:"Articles distincts"},stockSummaryBySiteAndType:{en:"Stock Summary by Site & Type",fr:"Rsum du stock par site et type"},stockKg:{en:"Stock (Kg)",fr:"Stock (Kg)"},stockBales:{en:"Stock (Bales)",fr:"Stock (Balles)"},stockBags:{en:"Stock (Bags)",fr:"Stock (Sacs)"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},warehouse_totalBalesInStock:{en:"Total Bales in Stock",fr:"Total Balles en Stock"},warehouse_weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},noStockData:{en:"No stock data available",fr:"Aucune donne de stock disponible"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},availableBulkStock:{en:"Available Bulk Stock",fr:"Stock Vrac Disponible"},bulkWeightConsumed:{en:"Bulk Weight Consumed",fr:"Poids Vrac Consomm"},pressedBalesProduced:{en:"Pressed Bales Produced",fr:"Balles presses produites"},pressedWeightProduced:{en:"Pressed Weight Produced",fr:"Poids press produit"},pressedWeightObtained:{en:"Pressed Weight Obtained",fr:"Poids Press Obtenu"},bulkInputSection:{en:"Input (Bulk)",fr:"Entre (Vrac)"},pressedOutputSection:{en:"Output (Pressed)",fr:"Sortie (Press)"},recordStockAdjustment:{en:"Record Adjustment",fr:"Enregistrer un ajustement"},direction:{en:"Direction",fr:"Sens"},in:{en:"In",fr:"Entre"},out:{en:"Out",fr:"Sortie"},kg:{en:"Kg",fr:"Kg"},reasonForAdjustment:{en:"Reason for Adjustment",fr:"Motif de l'ajustement"},recordInitialPressedStock:{en:"Record Initial Stock (Bales)",fr:"Enregistrer le stock initial (Balles)"},sourceSite:{en:"Source Site",fr:"Site d'origine"},pendingTransfers:{en:"Pending Transfers",fr:"Transferts en attente"},transferToWarehouse:{en:"Transfer to Warehouse",fr:"Transfrer  l'entrept"},noPendingTransfers:{en:"No pending transfers.",fr:"Aucun transfert en attente."},confirmTransfer:{en:"Confirm Transfer",fr:"Confirmer le transfert"},confirmNormalTransferMessage:{en:"You are about to transfer {count} bagged batches to the warehouse stock. Proceed?",fr:"Vous tes sur le point de transfrer {count} lots ensachs vers le stock de l'entrept. Continuer ?"},createShippingSlip:{en:"Create Shipping Slip",fr:"Crer un bon d'expdition"},destinationSite:{en:"Destination Site",fr:"Site de destination"},transporter:{en:"Transporter",fr:"Transporteur"},currentStock:{en:"Current Stock",fr:"Stock actuel"},shippedWeightKg:{en:"Shipped Weight (Kg)",fr:"Poids expdi (Kg)"},shippedBags:{en:"Shipped Bags",fr:"Sacs expdis"},confirmCompleteTransferTitle:{en:"Complete Transfer",fr:"Terminer le transfert"},confirmCancelTransferTitle:{en:"Cancel Transfer",fr:"Annuler le transfert"},completionDate:{en:"Completion Date",fr:"Date de rception"},cancellationDate:{en:"Cancellation Date",fr:"Date d'annulation"},receivedWeightKg:{en:"Received Weight (Kg)",fr:"Poids reu (Kg)"},receivedBags:{en:"Received Bags",fr:"Sacs reus"},cancellationReason:{en:"Reason for Cancellation",fr:"Motif de l'annulation"},movementType:{en:"Movement Type",fr:"Type de mouvement"},designation:{en:"Designation",fr:"Dsignation"},balance:{en:"Balance",fr:"Solde"},bagWeights:{en:"Bag Weights",fr:"Poids des sacs"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"},moduleCode:{en:"Module Code",fr:"Code Module"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},stockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock initial"},stockMovement_BAGGING_TRANSFER:{en:"From Bagging",fr:"Depuis ensachage"},stockMovement_EXPORT_OUT:{en:"Export",fr:"Export"},stockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison fermier"},stockMovement_PRESSING_OUT:{en:"Sent to Pressing",fr:"Envoy au pressage"},stockMovement_PRESSING_IN:{en:"Received from Pressing",fr:"Reu du pressage"},stockMovement_SITE_TRANSFER_IN:{en:"Transfer In",fr:"Transfert entrant"},stockMovement_SITE_TRANSFER_OUT:{en:"Transfer Out",fr:"Transfert sortant"},stockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},stockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},pressedStockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock Initial"},pressedStockMovement_PRESSING_IN:{en:"Pressing Production",fr:"Production Pressage"},pressedStockMovement_EXPORT_OUT:{en:"Export Shipment",fr:"Expdition Export"},pressedStockMovement_RETURN_TO_SITE:{en:"Return to Site",fr:"Retour au Site"},pressedStockMovement_BULK_IN_FROM_SITE:{en:"Bulk Transfer In",fr:"Transfert Vrac Entrant"},pressedStockMovement_PRESSING_CONSUMPTION:{en:"Pressing Consumption",fr:"Consommation Pressage"},pressedStockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison Fermier"},pressedStockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},pressedStockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},status_AWAITING_OUTBOUND:{en:"Awaiting Shipment",fr:"En attente d'expdition"},status_IN_TRANSIT:{en:"In Transit",fr:"En transit"},status_PENDING_RECEPTION:{en:"Pending Reception",fr:"En attente de rception"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_CANCELLED:{en:"Cancelled",fr:"Annul"},transport:{en:"Means of Transport",fr:"Moyen de transport"},representative:{en:"Carrier Representative",fr:"Reprsentant du transporteur"},transport_Truck:{en:"Truck",fr:"Camion"},transport_Boat:{en:"Boat",fr:"Bateau"},validationSameSite:{en:"Source and Destination cannot be the same.",fr:"Le site d'origine et de destination ne peuvent pas tre les mmes."},validationStockUnavailableWeight:{en:"Insufficient weight in stock. Available: {availableStock} kg.",fr:"Poids insuffisant en stock. Disponible : {availableStock} kg."},validationStockUnavailableBags:{en:"Insufficient bags in stock. Available: {availableStock}.",fr:"Nombre de sacs insuffisant en stock. Disponible : {availableStock}."},validationStockUnavailableBulk:{en:"Insufficient bulk stock. Available: {availableStock} kg.",fr:"Stock vrac insuffisant. Disponible : {availableStock} kg."},transportDetails:{en:"Transport Details",fr:"Dtails du transport"},siteTransferHistoryTitle:{en:"Transfer History",fr:"Historique du transfert"},stockTransferDate:{en:"Stock Transfer Date",fr:"Date de transfert au stock"},aiStockAnalysis:{en:"AI Stock Analysis",fr:"Analyse de Stock par IA"}},Sk={farmerManagementTitle:{en:"Farmer Management",fr:"Gestion des fermiers"},employeeManagementTitle:{en:"Employee Management",fr:"Gestion des employs"},addFarmer:{en:"Add Farmer",fr:"Ajouter un fermier"},addEmployee:{en:"Add Employee",fr:"Ajouter un employ"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},code:{en:"Code",fr:"Code"},gender:{en:"Gender",fr:"Genre"},dob:{en:"Date of Birth",fr:"Date de naissance"},birthPlace:{en:"Birth Place",fr:"Lieu de naissance"},idNumber:{en:"ID Number",fr:"Numro CIN"},address:{en:"Address",fr:"Adresse"},maritalStatus:{en:"Marital Status",fr:"tat civil"},nationality:{en:"Nationality",fr:"Nationalit"},parentsInfo:{en:"Parents Info",fr:"Infos parents"},role:{en:"Role",fr:"Fonction"},team:{en:"Team",fr:"quipe"},hireDate:{en:"Hire Date",fr:"Date d'embauche"},grossWage:{en:"Gross Wage",fr:"Salaire brut"},category:{en:"Category",fr:"Catgorie"},noSpecificSite:{en:"No Specific Site",fr:"Aucun site spcifique"},itemsSelected:{en:"{count} items selected",fr:"{count} lments slectionns"},itemsSelected_count:{en:"{count} items selected",fr:"{count} lments slectionns"},deleteSelected:{en:"Delete Selected",fr:"Supprimer la slection"},assignSite:{en:"Assign Site",fr:"Assigner un site"},confirmBulkDeleteTitle:{en:"Delete Multiple Items",fr:"Supprimer plusieurs lments"},confirmBulkDeleteFarmers:{en:"Are you sure you want to delete {count} farmers? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} fermiers ? Cette action est irrversible."},confirmBulkDeleteEmployees:{en:"Are you sure you want to delete {count} employees? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} employs ? Cette action est irrversible."},editFarmer:{en:"Edit Farmer",fr:"Modifier le fermier"},editEmployee:{en:"Edit Employee",fr:"Modifier l'employ"},gender_Male:{en:"Male",fr:"Masculin"},gender_Female:{en:"Female",fr:"Fminin"},gender_Other:{en:"Other",fr:"Autre"},maritalStatus_Single:{en:"Single",fr:"Clibataire"},maritalStatus_Married:{en:"Married",fr:"Mari(e)"},maritalStatus_Divorced:{en:"Divorced",fr:"Divorc(e)"},maritalStatus_Widowed:{en:"Widowed",fr:"Veuf/Veuve"},employeeType:{en:"Employment Type",fr:"Type de contrat"},employeeType_PERMANENT:{en:"Permanent",fr:"Permanent"},employeeType_CASUAL:{en:"Casual/Daily",fr:"Journalier"},selectRole:{en:"Select Role",fr:"Slectionner une fonction"},farmerProfile:{en:"Farmer Profile",fr:"Profil fermier"},employeeProfile:{en:"Employee Profile",fr:"Profil employ"},assignSiteTitle:{en:"Assign Site to Selected Items",fr:"Assigner un site aux lments slectionns"},assign:{en:"Assign",fr:"Assigner"},assignFarmerTitle:{en:"Assign Farmer to Modules",fr:"Assigner un fermier aux modules"},multiSiteSelectionWarning:{en:"Selection contains modules from multiple sites. Please select modules from a single site to assign a farmer.",fr:"La slection contient des modules de plusieurs sites. Veuillez slectionner des modules d'un seul site pour assigner un fermier."},noFarmersForSiteWarning:{en:"No farmers found for the site of the selected modules.",fr:"Aucun fermier trouv pour le site des modules slectionns."},searchByNameOrCode:{en:"Search by Name or Code",fr:"Rechercher par nom ou code"},filterBySite:{en:"Filter by Site",fr:"Filtrer par site"},filterByRole:{en:"Filter by Role",fr:"Filtrer par rle"},noEmployeesMatchFilters:{en:"No employees match the current filters.",fr:"Aucun employ ne correspond aux filtres actuels."},selectEmployeeNamed:{en:"Select {name}",fr:"Slectionner {name}"},selectAllEmployees:{en:"Select All Employees",fr:"Slectionner tous les employs"},confirmDeleteEmployee:{en:"Are you sure you want to delete this employee?",fr:"tes-vous sr de vouloir supprimer cet employ ?"},serviceProvidersTitle:{en:"Service Providers",fr:"Prestataires de services"},addProvider:{en:"Add Provider",fr:"Ajouter un prestataire"},serviceType:{en:"Service Type",fr:"Type de service"},contactPerson:{en:"Contact Person",fr:"Personne de contact"},noProviders:{en:"No service providers recorded.",fr:"Aucun prestataire de services enregistr."},editProvider:{en:"Edit Provider",fr:"Modifier le prestataire"},confirmDeleteProvider:{en:"Are you sure you want to delete this provider?",fr:"tes-vous sr de vouloir supprimer ce prestataire ?"},broadcastMessage:{en:"Broadcast",fr:"Diffuser"},broadcastTitle:{en:"Farmer Communication Hub",fr:"Hub de communication fermiers"},composeMessage:{en:"Compose Message",fr:"Rdiger le message"},messageHistory:{en:"Message History",fr:"Historique des messages"},recipientScope:{en:"Recipient Scope",fr:"Porte des destinataires"},scope_ALL:{en:"All Farmers",fr:"Tous les fermiers"},scope_SITE:{en:"Specific Site",fr:"Site spcifique"},scope_SELECTED:{en:"Selected Farmers",fr:"Fermiers slectionns"},messageContent:{en:"Message Content",fr:"Contenu du message"},charCount:{en:"{count} characters",fr:"{count} caractres"},sendMessage:{en:"Send Message",fr:"Envoyer le message"},messageSentSuccess:{en:"Message broadcast initiated successfully.",fr:"Diffusion du message initie avec succs."},channel_SMS:{en:"SMS",fr:"SMS"},channel_WHATSAPP:{en:"WhatsApp",fr:"WhatsApp"},farmerCreditsTitle:{en:"Farmer Credits",fr:"Crdits fermiers"},creditStatus:{en:"Credit Status",fr:"Statut des crdits"},recordCredit:{en:"Record Credit",fr:"Enregistrer un crdit"},recordRepayment:{en:"Record Repayment",fr:"Enregistrer un remboursement"},creditTypeSettings:{en:"Credit Type Settings",fr:"Paramtres des types de crdit"},contractedCredits:{en:"Contracted Credits",fr:"Crdits contracts"},repayments:{en:"Repayments",fr:"Remboursements"},lastRepaymentDate:{en:"Last Repayment",fr:"Dernier remboursement"},remainingBalance:{en:"Remaining Balance",fr:"Solde restant"},selectAllFarmers:{en:"Select All Farmers",fr:"Slectionner tous les fermiers"},selectFarmerNamed:{en:"Select {name}",fr:"Slectionner {name}"},expand:{en:"Expand",fr:"Dvelopper"},collapse:{en:"Collapse",fr:"Rduire"},recordBulkCredit:{en:"Record Bulk Credit",fr:"Crdit group"},recordBulkRepayment:{en:"Record Bulk Repayment",fr:"Remboursement group"},creditsTaken:{en:"Credits Taken",fr:"Crdits pris"},creditType:{en:"Credit Type",fr:"Type de crdit"},creditTypes:{en:"Credit Types",fr:"Types de crdit"},totalAmount:{en:"Total Amount",fr:"Montant total"},noCredits:{en:"No credits recorded.",fr:"Aucun crdit enregistr."},repaymentsMade:{en:"Repayments Made",fr:"Remboursements effectus"},repaymentMethod:{en:"Repayment Method",fr:"Mthode de remboursement"},repaymentMethod_cash:{en:"Cash",fr:"Espces"},repaymentMethod_harvest_deduction:{en:"Harvest Deduction",fr:"Retenue sur rcolte"},noRepayments:{en:"No repayments recorded.",fr:"Aucun remboursement enregistr."},selectSite:{en:"Select Site",fr:"Slectionner un site"},selectFarmer:{en:"Select Farmer",fr:"Slectionner un fermier"},selectType:{en:"Select Type",fr:"Slectionner un type"},withQuantity:{en:"With Quantity",fr:"Avec quantit"},withUnitPrice:{en:"With Unit Price",fr:"Avec prix unitaire"},directAmount:{en:"Direct Amount",fr:"Montant direct"},unit:{en:"Unit",fr:"Unit"},addNewCreditType:{en:"Add New Credit Type",fr:"Ajouter un nouveau type de crdit"},confirmDeleteCreditType:{en:"Are you sure you want to delete this credit type?",fr:"tes-vous sr de vouloir supprimer ce type de crdit ?"},recordCreditForSelected:{en:"Record Credit for {count} Farmers",fr:"Enregistrer un crdit pour {count} fermiers"},bulkCreditMessage:{en:"This credit will be applied to all {count} selected farmers.",fr:"Ce crdit sera appliqu  tous les {count} fermiers slectionns."},recordRepaymentForSelected:{en:"Record Repayment for {count} Farmers",fr:"Enregistrer un remboursement pour {count} fermiers"},bulkRepaymentMessage:{en:"This repayment will be recorded for all {count} selected farmers.",fr:"Ce remboursement sera enregistr pour tous les {count} fermiers slectionns."},repaymentAmount:{en:"Repayment Amount",fr:"Montant du remboursement"},repaymentRecorded:{en:"Repayment recorded successfully.",fr:"Remboursement enregistr avec succs."},confirmDeleteFarmer:{en:"Are you sure you want to delete this farmer?",fr:"tes-vous sr de vouloir supprimer ce fermier ?"},editCreditType:{en:"Edit Credit Type",fr:"Modifier le type de crdit"},quantity:{en:"Quantity",fr:"Quantit"},farmerStatus:{en:"Status",fr:"Statut"},status_ACTIVE:{en:"Active",fr:"Actif"},status_INACTIVE:{en:"Inactive",fr:"Inactif"},joinDate:{en:"Hire Date",fr:"Date d'embauche"},exitDate:{en:"Exit Date",fr:"Date de dpart"},exitReason:{en:"Exit Reason",fr:"Motif du dpart"},fireFarmer:{en:"Fire/Deactivate",fr:"Dbaucher"},hireFarmer:{en:"Re-hire/Activate",fr:"R-embaucher"},confirmFire:{en:"Confirm Deactivation",fr:"Confirmer la dbauche"},confirmFireMessage:{en:"You are about to deactivate {name}. They will be marked as inactive but their data will be preserved.",fr:"Vous tes sur point de dbaucher {name}. Il sera marqu comme inactif mais ses donnes seront conserves."},fire:{en:"Deactivate",fr:"Dbaucher"},seaweedTypeManagementTitle:{en:"Seaweed Type Management",fr:"Gestion des types d'algues"},addSeaweedType:{en:"Add Seaweed Type",fr:"Ajouter un type d'algue"},name:{en:"Name",fr:"Nom"},scientificName:{en:"Scientific Name",fr:"Nom scientifique"},description:{en:"Description",fr:"Description"},wetPrice:{en:"Wet Price",fr:"Prix humide"},dryPrice:{en:"Dry Price",fr:"Prix sec"},cycles:{en:"Cycles",fr:"Cycles"},priceHistory:{en:"Price History",fr:"Historique des prix"},editSeaweedType:{en:"Edit Seaweed Type",fr:"Modifier le type d'algue"},confirmDeleteSeaweedType:{en:"Are you sure you want to delete this seaweed type?",fr:"tes-vous sr de vouloir supprimer ce type d'algue ?"},addNewPrice:{en:"Add New Price",fr:"Ajouter un nouveau prix"},effectiveDate:{en:"Effective Date",fr:"Date d'effet"},noPriceHistory:{en:"No price history available.",fr:"Aucun historique de prix disponible."},allSeaweedTypes:{en:"All Seaweed Types",fr:"Tous les types d'algues"},payrollCalculator:{en:"Payroll Calculator",fr:"Calculateur de paie"},selectEmployeesAndCalculate:{en:"Select employees and calculate payroll.",fr:"Slectionnez des employs et calculez la paie."},processPayrollFor:{en:"Process Payroll for {count} Employees",fr:"Traiter la paie pour {count} employs"},payrollResults:{en:"Payroll Results",fr:"Rsultats de paie"},payrollSummaryForPeriod:{en:"Payroll Summary for {period}",fr:"Rsum de paie pour {period}"},bulkConfigure:{en:"Bulk Configure",fr:"Configuration groupe"},totalAllDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalNetPay:{en:"Total Net Pay",fr:"Total net  payer"},socialDeductions:{en:"Social Deductions",fr:"Dductions sociales"},otherDeductions:{en:"Other Deductions",fr:"Autres dductions"},payrollTotalDeductions:{en:"Total Deductions",fr:"Total dductions"},deductionDetails:{en:"Deduction Details",fr:"Dtails des dductions"},noStatutoryDeductions:{en:"No statutory deductions.",fr:"Aucune dduction statutaire."},applyTo:{en:"Apply To",fr:"Appliquer "},allSelectedEmployees:{en:"All Selected Employees",fr:"Tous les employs slectionns"},bySite:{en:"By Site",fr:"Par site"},byRole:{en:"By Role",fr:"Par rle"},setValue:{en:"Set Value",fr:"Dfinir la valeur"},addToExisting:{en:"Add to Existing",fr:"Ajouter  l'existant"},bonuses:{en:"Bonuses",fr:"Primes"},overtime:{en:"Overtime",fr:"Heures sup."},configureSocialDeductions:{en:"Configure Social Deductions",fr:"Configurer dductions sociales"},showAffectedEmployeesAfterUpdate:{en:"Show affected employees after update",fr:"Afficher les employs affects aprs mise  jour"},applyChanges:{en:"Apply Changes",fr:"Appliquer les changements"},bulkUpdateSummary:{en:"Bulk Update Summary",fr:"Rsum mise  jour groupe"},affectedEmployees:{en:"Affected Employees ({count})",fr:"Employs affects ({count})"},confirmSavePayroll:{en:"Save Payroll Run",fr:"Sauvegarder le cycle de paie"},confirmSavePayrollMessage:{en:"This will save the current payroll calculation as pending payments for all selected employees.",fr:"Cela enregistrera le calcul de paie actuel comme paiements en attente pour tous les employs slectionns."},payrollSavedSuccess:{en:"Payroll run saved successfully.",fr:"Cycle de paie enregistr avec succs."},paymentHistory:{en:"Payment History",fr:"Historique des paiements"},recipientType:{en:"Recipient Type",fr:"Type de bnficiaire"},payNow:{en:"Pay Now",fr:"Payer Maintenant"},paymentRunSetup:{en:"Payment Run Setup",fr:"Configuration cycle de paiement"},periodName:{en:"Period Name",fr:"Nom de la priode"},startDate:{en:"Start Date",fr:"Date de dbut"},endDate:{en:"End Date",fr:"Date de fin"},paymentType:{en:"Payment Type",fr:"Type de paiement"},wetDeliveryPayment:{en:"Wet Harvest Payment",fr:"Paiement Rcolte Humide"},dryDeliveryPayment:{en:"Dry Delivery Payment",fr:"Paiement Livraison Sche"},serviceProviderPayment:{en:"Service Provider Payment",fr:"Paiement Prestataire"},preparePaymentRun:{en:"Prepare Payment Run",fr:"Prparer le cycle de paiement"},reviewPaymentRun:{en:"Review Payment Run",fr:"Rviser le Cycle de Paiement"},configureDeductions:{en:"Configure Deductions",fr:"Configurer les Dductions"},confirmAndPay:{en:"Confirm & Pay",fr:"Confirmer et Payer"},totalPayees:{en:"Total Payees",fr:"Total des Bnficiaires"},totalBaseAmount:{en:"Total Base Amount",fr:"Total de Base"},errorGeneratingNarrative:{en:"Error generating narrative.",fr:"Erreur lors de la gnration du narratif."},totalDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalAmountInWords:{en:"Total Amount in Words",fr:"Arrt la prsente fiche  la somme de"},totalNetPayable:{en:"Total Net Payable",fr:"Total Net  Payer"},newPayment:{en:"New Payment",fr:"Nouveau Paiement"},editPayment:{en:"Edit Payment",fr:"Modifier Paiement"},selectRecipientType:{en:"Select Recipient Type",fr:"Slectionner le Type de Bnficiaire"},recipient:{en:"Recipient",fr:"Destinataire"},selectRecipient:{en:"Select Recipient",fr:"Slectionner le destinataire"},amount:{en:"Amount",fr:"Montant"},paymentMethod:{en:"Payment Method",fr:"Mthode de paiement"},paymentMethod_cash:{en:"Cash",fr:"Espces"},paymentMethod_bank_transfer:{en:"Bank Transfer",fr:"Virement bancaire"},paymentMethod_mobile_money:{en:"Mobile Money",fr:"Mobile Money"},paymentStatus:{en:"Payment Status",fr:"Statut du paiement"},status_PENDING:{en:"Pending",fr:"En attente"},status_PROCESSING:{en:"Processing",fr:"En cours"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_FAILED:{en:"Failed",fr:"chou"},transactionId:{en:"Transaction ID",fr:"ID transaction"},confirmPayment:{en:"Confirm Payment",fr:"Confirmer le paiement"},confirmPaymentMessage:{en:"You are about to record payments for {count} beneficiaries. Proceed?",fr:"Vous tes sur le point d'enregistrer les paiements pour {count} bnficiaires. Continuer ?"},paymentsRecordedSuccess:{en:"Payments recorded successfully.",fr:"Paiements enregistrs avec succs."},alert_noPayrollConfig:{en:"No payroll configuration found for this country.",fr:"Aucune configuration de paie trouve pour ce pays."},adjustment:{en:"Adjustment",fr:"Ajustement"},totalGrossPay:{en:"Total Gross Pay",fr:"Total salaire brut"},employeeSelection:{en:"Employee Selection",fr:"Slection des employs"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},farmerReceipt:{en:"Farmer Receipt",fr:"Reu fermier"},payslip:{en:"Payslip",fr:"Fiche de paie"},receiptNo:{en:"Receipt No.",fr:"N reu"},paymentDetails:{en:"Payment Details",fr:"Dtails du paiement"},grossAmount:{en:"Gross Amount",fr:"Montant brut"},netPaid:{en:"Net Paid",fr:"Net pay"},mobileMoneyRef:{en:"Mobile Money Ref",fr:"Rf. Mobile Money"},paidBy:{en:"Paid By",fr:"Pay par"},receivedBy:{en:"Received By",fr:"Reu par"},deductions:{en:"Deductions",fr:"Dductions"},recipientType_FARMER:{en:"Farmer",fr:"Fermier"},recipientType_EMPLOYEE:{en:"Employee",fr:"Employ"},recipientType_SERVICE_PROVIDER:{en:"Service Provider",fr:"Prestataire"},allRoles:{en:"All Roles",fr:"Toutes les fonctions"},documentPaymentsTitle:{en:"Payment Documents",fr:"Documents de Paiement"},cuttingPaymentSheetTitle:{en:"CUTTING SERVICE PAYMENT SHEET",fr:"FICHE DE PAIEMENT DE PRESTATION DE BOUTURAGE"},serviceProviderPaymentSheetTitle:{en:"Service Provider Payment",fr:"Paiement Prestataire"},wetDeliveryPaymentSheetTitle:{en:"Wet Seaweed Delivery Payment",fr:"Paiement de livraison d'algues humides"},dryDeliveryPaymentSheetTitle:{en:"Dry Seaweed Delivery Payment",fr:"Paiement de livraison d'algues sches"},employeePayroll:{en:"Employee Payroll",fr:"Paie des Employs"},printDocuments:{en:"Print Documents",fr:"Impression des Documents"},dateLabel:{en:"Date",fr:"Date"},exploitationSite:{en:"Exploitation Site",fr:"Site d'exploitation"},deliveryPeriod:{en:"Delivery Period",fr:"Priode de livraison"},checkNumber:{en:"Check No.",fr:"N du chque"},checkAmount:{en:"Check Amount",fr:"Montant du chque"},pricePerKg:{en:"Price per Kg",fr:"Prix par kg"},page:{en:"Page",fr:"Page"},totalPaymentAmount:{en:"Total Payment Amount",fr:"Montant total du paiement"},dateTrans:{en:"Trans. Date",fr:"Date trans."},poids:{en:"Weight",fr:"Poids"},valeur:{en:"Value",fr:"Valeur"},creditsHeader:{en:"Credits",fr:"Crdits"},creditDeduction:{en:"Credit Deduction",fr:"Dduction Crdit"},resteAPayer:{en:"Net Payable",fr:"Reste  payer"},responsibleSignature:{en:"Responsible Signature",fr:"Signature du responsable"},signature:{en:"Signature",fr:"Signature"},theResponsible:{en:"The Responsible",fr:"Le Responsable"},provider:{en:"Provider",fr:"Prestataire"},numberOfPages:{en:"Number of Pages",fr:"Nombre de pages"},checkAmountInWords:{en:"Check Amount in Words",fr:"Montant du chque en lettres"},totalToPay:{en:"TOTAL TO PAY",fr:"TOTAL  PAYER"},various:{en:"Various",fr:"Divers"},denominationBreakdown:{en:"Denomination Breakdown",fr:"Rpartition des coupures"},breakdownByBeneficiary:{en:"Breakdown by Beneficiary",fr:"Rpartition par bnficiaire"},beneficiary:{en:"Beneficiary",fr:"Bnficiaire"},denomination:{en:"Denomination",fr:"Coupure"},total:{en:"Total",fr:"Total"},period:{en:"Period",fr:"Priode"},unpaidOperations:{en:"Unpaid Ops.",fr:"Oprations Impayes"},serviceDate:{en:"Service Date",fr:"Date de prestation"},perProcurationem:{en:"Per Procurationem",fr:"Par Procuration"},theManager:{en:"The Manager",fr:"Le Grant"},numberOfLines:{en:"Number of Lines",fr:"Nombre de Lignes"},montantAPayer:{en:"Amount to Pay",fr:"Montant  Payer"},summaryTable:{en:"Summary Table",fr:"Tableau de Synthse"},commercialInvoice:{en:"Commercial Invoice",fr:"Facture Commerciale"},packingAndWeightList:{en:"Packing List",fr:"Liste de Colisage"},certificateOfOrigin:{en:"Certificate of Origin",fr:"Certificat d'Origine"},deliveryAddress:{en:"Delivery Address",fr:"Adresse de livraison"},orderRef:{en:"Order Ref.",fr:"Rf. Commande"},packages:{en:"Packages",fr:"Colis"},netWeight:{en:"Net Weight",fr:"Poids Net"},totalExclTax:{en:"TOTAL EXCL. TAX",fr:"TOTAL HT"},amountInWords:{en:"Amount in Words",fr:"Arrt la prsente facture  la somme de"},bankDetails:{en:"Bank Details",fr:"Coordonnes Bancaires"},senderLabel:{en:"Sender",fr:"Expditeur"},recipientLabel:{en:"Recipient",fr:"Destinataire"},signedAtLocation:{en:"Signed at {location}, on {date}",fr:"Fait  {location}, le {date}"},managePermissions:{en:"Manage Permissions",fr:"Grer les permissions"},managePermissionsFor:{en:"Manage Permissions for",fr:"Grer les permissions pour"},default:{en:"Default",fr:"Par dfaut"},cannotDeleteDefault:{en:"Cannot delete a default item.",fr:"Impossible de supprimer un lment par dfaut."},value:{en:"Value",fr:"Valeur"},totalValue:{en:"Total Value",fr:"Valeur Totale"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},netWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},totalWeightKg:{en:"Total Weight (Kg)",fr:"Poids Total (Kg)"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netPayable:{en:"Net Payable",fr:"Net  Payer"},baseAmount:{en:"Base Amount",fr:"Montant de Base"},grossSalary:{en:"Gross Salary",fr:"Salaire Brut"},totalGross:{en:"Total Gross",fr:"Total Brut"},netPay:{en:"Net Pay",fr:"Net  Payer"}},_k={incidentManagementTitle:{en:"Incident Management",fr:"Gestion des Incidents"},reportIncident:{en:"Report Incident",fr:"Signaler un Incident"},inProgressIncidents:{en:"In Progress",fr:"En Cours"},criticalIncidents:{en:"Critical",fr:"Critique"},incidentType:{en:"Incident Type",fr:"Type d'Incident"},severity:{en:"Severity",fr:"Gravit"},reportedBy:{en:"Reported By",fr:"Signal Par"},status_OPEN:{en:"Open",fr:"Ouvert"},status_IN_PROGRESS:{en:"In Progress",fr:"En Cours"},status_RESOLVED:{en:"Resolved",fr:"Rsolu"},status_CLOSED:{en:"Closed",fr:"Ferm"},severity_LOW:{en:"Low",fr:"Faible"},severity_MEDIUM:{en:"Medium",fr:"Moyenne"},severity_HIGH:{en:"High",fr:"Haute"},severity_CRITICAL:{en:"Critical",fr:"Critique"},confirmDeleteIncident:{en:"Are you sure you want to delete this incident?",fr:"tes-vous sr de vouloir supprimer cet incident ?"},editIncident:{en:"Edit Incident",fr:"Modifier l'Incident"},uploadPhoto:{en:"Upload Photo",fr:"Tlcharger une Photo"},uploadPhotoInstruction:{en:"Upload or take a photo to analyze with AI",fr:"Tlchargez ou prenez une photo pour analyser avec l'IA"},analyzeWithAI:{en:"Analyze with AI",fr:"Analyser avec l'IA"},analyzeInstructions:{en:"Describe the issue or upload an image...",fr:"Dcrivez le problme ou tlchargez une image..."},aiSuggestions:{en:"AI Suggestions",fr:"Suggestions IA"},suggestedType:{en:"Suggested Type",fr:"Type Suggr"},suggestedSeverity:{en:"Suggested Severity",fr:"Gravit Suggre"},suggestedModules:{en:"Suggested Modules",fr:"Modules Suggrs"},suggestedTreatment:{en:"Suggested Treatment",fr:"Traitement Suggr"},affectedModules:{en:"Affected Modules",fr:"Modules Affects"},resolvedDate:{en:"Resolved Date",fr:"Date de Rsolution"},resolutionNotes:{en:"Resolution Notes",fr:"Notes de Rsolution"},incidentTypeManagementTitle:{en:"Incident Types",fr:"Types d'Incidents"},addIncidentType:{en:"Add Incident Type",fr:"Ajouter un Type d'Incident"},typeName:{en:"Type Name",fr:"Nom du Type"},editIncidentType:{en:"Edit Incident Type",fr:"Modifier le Type d'Incident"},confirmDeleteIncidentType:{en:"Are you sure you want to delete this type?",fr:"tes-vous sr de vouloir supprimer ce type ?"},incidentSeverityManagementTitle:{en:"Incident Severities",fr:"Gravits d'Incidents"},addIncidentSeverity:{en:"Add Severity",fr:"Ajouter une Gravit"},severityName:{en:"Severity Name",fr:"Nom de la Gravit"},editIncidentSeverity:{en:"Edit Severity",fr:"Modifier la Gravit"},confirmDeleteIncidentSeverity:{en:"Are you sure you want to delete this severity?",fr:"tes-vous sr de vouloir supprimer cette gravit ?"},noMajorIncidents:{en:"No major incidents reported.",fr:"Aucun incident majeur signal."},descriptionPlaceholder:{en:"Describe the incident...",fr:"Dcrivez l'incident..."},periodicTestsTitle:{en:"Periodic Tests",fr:"Tests Priodiques"},addTest:{en:"Add Test",fr:"Ajouter un Test"},identity:{en:"Identity/Code",fr:"Identit/Code"},zoning:{en:"Zoning",fr:"Zonage"},conductor:{en:"Conductor",fr:"Conducteur"},sheetInfo:{en:"Sheet Info",fr:"Infos Fiche"},weatherData:{en:"Weather Data",fr:"Donnes Mto"},manualEntry:{en:"Manual Entry",fr:"Saisie Manuelle"},autoFill:{en:"Auto Fill (API)",fr:"Remplissage Auto (API)"},fetchWeather:{en:"Fetch Weather",fr:"Rcuprer Mto"},fetchingWeather:{en:"Fetching...",fr:"Rcupration..."},weatherFetchSuccess:{en:"Weather data fetched successfully.",fr:"Donnes mto rcupres avec succs."},weatherFetchError:{en:"Failed to fetch weather data.",fr:"chec de la rcupration des donnes mto."},weatherFetchMissingInfo:{en:"Missing site coordinates or date.",fr:"Coordonnes du site ou date manquantes."},temperature:{en:"Temperature",fr:"Temprature"},salinity:{en:"Salinity",fr:"Salinit"},precipitation:{en:"Precipitation",fr:"Prcipitations"},windSpeed:{en:"Wind Speed",fr:"Vitesse du Vent"},windDirection:{en:"Wind Direction",fr:"Direction du Vent"},waveHeight:{en:"Wave Height",fr:"Hauteur des Vagues"},editTest:{en:"Edit Test",fr:"Modifier le Test"},confirmDeleteTest:{en:"Are you sure you want to delete this test?",fr:"tes-vous sr de vouloir supprimer ce test ?"},period_PLANTING:{en:"Planting",fr:"Plantation"},period_PERIOD_1:{en:"Period 1",fr:"Priode 1"},period_PERIOD_2:{en:"Period 2",fr:"Priode 2"},period_PERIOD_3:{en:"Period 3",fr:"Priode 3"},period_PERIOD_4:{en:"Period 4",fr:"Priode 4"},period_PERIOD_5:{en:"Period 5",fr:"Priode 5"},userManagement:{en:"User Management",fr:"Gestion des Utilisateurs"},inviteUser:{en:"Invite User",fr:"Inviter un Utilisateur"},currentUsers:{en:"Current Users",fr:"Utilisateurs Actuels"},pendingInvitations:{en:"Pending Invitations",fr:"Invitations en Attente"},recipient:{en:"Recipient",fr:"Destinataire"},channel:{en:"Channel",fr:"Canal"},expiresAt:{en:"Expires At",fr:"Expire Le"},invitedBy:{en:"Invited By",fr:"Invit Par"},resend:{en:"Resend",fr:"Renvoyer"},revoke:{en:"Revoke",fr:"Rvoquer"},noPendingInvitations:{en:"No pending invitations.",fr:"Aucune invitation en attente."},revokeInvitation:{en:"Revoke Invitation",fr:"Rvoquer l'Invitation"},confirmRevokeInvitation:{en:"Are you sure you want to revoke this invitation?",fr:"tes-vous sr de vouloir rvoquer cette invitation ?"},invitationSent:{en:"Invitation Sent",fr:"Invitation Envoye"},invitationLinkMessage:{en:"Share this link with the user:",fr:"Partagez ce lien avec l'utilisateur :"},invitationWhatsAppMessage:{en:"Send this WhatsApp message:",fr:"Envoyez ce message WhatsApp :"},openWhatsApp:{en:"Open WhatsApp",fr:"Ouvrir WhatsApp"},resendWhatsAppMessage:{en:"You have been invited to AlgaManage. Click here to join: {link}",fr:"Vous avez t invit  AlgaManage. Cliquez ici pour rejoindre : {link}"},reportsTitle:{en:"Reports",fr:"Rapports"},selectReportType:{en:"Select Report Type",fr:"Slectionner le Type de Rapport"},globalFarmReport:{en:"Global Farm Report",fr:"Rapport Global de Ferme"},customReport:{en:"Custom Report",fr:"Rapport Personnalis"},farmerMonthlyReport:{en:"Farmer Monthly Report",fr:"Rapport Mensuel Fermier"},individualFarmerReport:{en:"Individual Farmer Report",fr:"Rapport Individuel Fermier"},month:{en:"Month",fr:"Mois"},year:{en:"Year",fr:"Anne"},generateReport:{en:"Generate Report",fr:"Gnrer le Rapport"},selectSections:{en:"Select Sections",fr:"Slectionner les Sections"},section_production:{en:"Production",fr:"Production"},section_finance:{en:"Finance",fr:"Finance"},section_inventory:{en:"Inventory",fr:"Inventaire"},section_hr:{en:"HR",fr:"RH"},section_incidents:{en:"Incidents",fr:"Incidents"},selectFiltersAndGenerate:{en:'Select report type and filters, then click "Generate Report".',fr:'Slectionnez un type de rapport et des filtres, puis cliquez sur "Gnrer le Rapport".'},pdfGenerationError:{en:"Error generating PDF.",fr:"Erreur lors de la gnration du PDF."},company_sarl:{en:"S.A.R.L Capital:",fr:"S.A.R.L au capital de"},narratif_explicatif_tableau:{en:"Narrative Explanation",fr:"Narratif explicatif du tableau"},apercuGeneralDeLaFerme:{en:"General Farm Overview",fr:"Aperu Gnral de la Ferme"},fermier_effectif:{en:"Farmers (Count)",fr:"Fermiers (Effectif)"},tranche_age_lignes:{en:"Line Age Brackets (Days)",fr:"Tranche d'ge des lignes (Jours)"},bilan_lignes:{en:"Line Summary",fr:"Bilan des Lignes"},total_lignes_eau:{en:"Total Lines in Water",fr:"Total lignes  l'eau"},total_lignes_recoltees:{en:"Total Harvested Lines",fr:"Total lignes rcoltes"},total_lignes_plantees:{en:"Total Planted Lines",fr:"Total lignes plantes"},production_periode_kg:{en:"Production for Period (Kg)",fr:"Production de la priode (Kg)"},taux_croissance_moyen:{en:"Average Growth Rate",fr:"Taux de croissance moyen"},prevision_production:{en:"Production Forecast (Kg)",fr:"Prvision de production (Kg)"},monitoringReport:{en:"Monitoring Report",fr:"Rapport de Suivi"},vent:{en:"Wind",fr:"Vent"},vitesse_kmh:{en:"Speed (km/h)",fr:"Vitesse (km/h)"},direction_deg:{en:"Direction ()",fr:"Direction ()"},autres_parametres:{en:"Other Parameters",fr:"Autres Paramtres"},temperature_c:{en:"Temperature (C)",fr:"Temprature (C)"},salinite_ppt:{en:"Salinity ()",fr:"Salinit ()"},pluviometrie_mm:{en:"Precipitation (mm)",fr:"Pluviomtrie (mm)"},averageShort:{en:"Avg",fr:"Moy"},repartition_salaries_site:{en:"Employee Distribution by Site",fr:"Rpartition des Salaris par Site"},effectif:{en:"Count",fr:"Effectif"},montant_du_mois:{en:"Monthly Amount",fr:"Montant du mois"},journalier:{en:"Daily Workers",fr:"Journaliers"},permanent:{en:"Permanent Staff",fr:"Permanents"},total_journalier:{en:"Total Daily",fr:"Total Journaliers"},total_permanent:{en:"Total Permanent",fr:"Total Permanents"},narratif_repartition_salaries:{en:"Narrative (HR)",fr:"Narratif (RH)"},stocks_sur_sites:{en:"Stocks on Sites",fr:"Stocks sur Sites"},stock_ouverture:{en:"Opening Stock",fr:"Stock Ouverture"},entrees:{en:"Entries",fr:"Entres"},sorties:{en:"Exits",fr:"Sorties"},stock_fermeture:{en:"Closing Stock",fr:"Stock Fermeture"},poids_kg:{en:"Weight (Kg)",fr:"Poids (Kg)"},narratif_stocks_sites:{en:"Narrative (Site Stocks)",fr:"Narratif (Stocks Sites)"},stock_magasin_presse:{en:"Pressing Warehouse Stock",fr:"Stock Magasin de Presse"},colis:{en:"Package",fr:"Colis"},algues_en_vrac:{en:"Bulk Seaweed",fr:"Algues en Vrac"},algues_pressees:{en:"Pressed Seaweed",fr:"Algues Presses"},narratif_stocks_magasin:{en:"Narrative (Warehouse)",fr:"Narratif (Magasin)"},liste_exportations_realisees:{en:"List of Realized Exports",fr:"Liste des Exportations Ralises"},quantite_expedie:{en:"Qty Shipped",fr:"Qte Expdie"},nombre_conteneur:{en:"Container Count",fr:"Nbr Conteneur"},valeur_totale:{en:"Total Value",fr:"Valeur Totale"},facture_n:{en:"Invoice N",fr:"Facture N"},po:{en:"PO",fr:"PO"},destinataire:{en:"Consignee",fr:"Destinataire"},de_la_periode:{en:"Of the Period",fr:"De la Priode"},de_annee:{en:"Of the Year",fr:"De l'Anne"},narratif_exportations_realisees:{en:"Narrative (Exports)",fr:"Narratif (Exportations)"},production_mensuelle_par_site:{en:"Monthly Production by Site",fr:"Production Mensuelle par Site"},narratif_production_mensuelle:{en:"Narrative (Production)",fr:"Narratif (Production)"},situation_credits:{en:"Credit Situation",fr:"Situation des Crdits"},effectif_fermiers_concernes:{en:"Farmers Concerned",fr:"Effectif fermiers concerns"},solde_credits:{en:"Credit Balance",fr:"Solde crdits"},total_remboursements:{en:"Total Repayments",fr:"Total remboursements"},narratif_situation_credits:{en:"Narrative (Credits)",fr:"Narratif (Crdits)"},statistique_individuelle_fermiers:{en:"Individual Farmer Statistics",fr:"Statistique Individuelle des Fermiers"},narratif_statistique_individuelle:{en:"Narrative (Farmers)",fr:"Narratif (Fermiers)"},report_narrative_note:{en:"Note: Narratives are generated by AI based on data.",fr:"Note : Les narratifs sont gnrs par IA sur la base des donnes."},customReportTitle:{en:"Custom Report",fr:"Rapport Personnalis"},totalCreditsIssued:{en:"Total Credits Issued",fr:"Total Crdits mis"},totalCreditAmount:{en:"Total Credit Amount",fr:"Montant Total Crdits"},aiAnalysis:{en:"AI Analysis",fr:"Analyse IA"},productionSummary:{en:"Production Summary",fr:"Rsum de la Production"},totalPlantedLines:{en:"Total Planted Lines",fr:"Total Lignes Plantes"},incidentsReported:{en:"Incidents Reported",fr:"Incidents Signals"},noIncidentsForFarmer:{en:"No incidents reported for this farmer.",fr:"Aucun incident signal pour ce fermier."},narrativeFarmerPerformance:{en:"Farmer Performance Review",fr:"Bilan Performance Fermier"},legendColorBlue:{en:"Blue:",fr:"Bleu :"},legendColorRed:{en:"Red:",fr:"Rouge :"},legendColorBlack:{en:"Black:",fr:"Noir :"},legendPlantedLines:{en:"Planted Lines",fr:"Lignes Plantes"},legendHarvestedLines:{en:"Harvested Lines",fr:"Lignes Rcoltes"},legendProductionKg:{en:"Production (Kg)",fr:"Production (Kg)"},pagination:{showing:{en:"Showing",fr:"Affichage de"},of:{en:"of",fr:"sur"},results:{en:"results",fr:"rsultats"},previous:{en:"Previous",fr:"Prcdent"},next:{en:"Next",fr:"Suivant"},itemsPerPage:{en:"Items per page",fr:"lments par page"}},manual_introduction:{en:"Introduction",fr:"Introduction"},manual_introduction_text:{en:"Welcome to AlgaManage, your comprehensive Seaweed Farm ERP system. This manual will guide you through the key features of the application.",fr:"Bienvenue sur AlgaManage, votre systme ERP complet pour la gestion de fermes d'algues. Ce manuel vous guidera  travers les principales fonctionnalits de l'application."},manual_user_management:{en:"User Management",fr:"Gestion des Utilisateurs"},manual_user_management_text:{en:'<ul><li><strong>Invite Users:</strong> Go to Settings > User Management. Click "Invite User", enter their email or phone number, and select a role.</li><li><strong>Manage Roles:</strong> Define custom roles with specific permissions in Settings > Roles.</li></ul>',fr:'<ul><li><strong>Inviter des Utilisateurs :</strong> Allez dans Paramtres > Gestion des Utilisateurs. Cliquez sur "Inviter un Utilisateur", entrez leur email ou numro de tlphone, et slectionnez un rle.</li><li><strong>Grer les Rles :</strong> Dfinissez des rles personnaliss avec des permissions spcifiques dans Paramtres > Rles.</li></ul>'},manual_dashboard:{en:"Dashboard",fr:"Tableau de Bord"},manual_dashboard_text:{en:"<p>The dashboard provides a real-time overview of your farm's performance, including active cycles, harvest forecasts, and key alerts.</p>",fr:"<p>Le tableau de bord offre un aperu en temps rel des performances de votre ferme, incluant les cycles actifs, les prvisions de rcolte et les alertes cls.</p>"},manual_operations:{en:"Operations",fr:"Oprations"},manual_operations_text:{en:"<ul><li><strong>Map:</strong> Visualize sites, zones, and modules geographically.</li><li><strong>Cycles:</strong> Track cultivation from planting to harvest.</li><li><strong>Harvesting:</strong> Record harvests and manage post-harvest processing (drying, bagging).</li></ul>",fr:"<ul><li><strong>Carte :</strong> Visualisez gographiquement les sites, zones et modules.</li><li><strong>Cycles :</strong> Suivez la culture de la plantation  la rcolte.</li><li><strong>Rcolte :</strong> Enregistrez les rcoltes et grez le traitement post-rcolte (schage, mise en sac).</li></ul>"},manual_inventory:{en:"Inventory",fr:"Inventaire"},manual_inventory_text:{en:"<p>Manage stock levels across sites and the central warehouse. Track movements, farmer deliveries, and prepare shipments for export.</p>",fr:"<p>Grez les niveaux de stock sur les sites et dans l'entrept central. Suivez les mouvements, les livraisons des fermiers et prparez les expditions pour l'export.</p>"},manual_stakeholders:{en:"Stakeholders",fr:"Acteurs"},manual_stakeholders_text:{en:"<p>Maintain records of farmers, employees, and service providers. Manage contracts and assignments.</p>",fr:"<p>Maintenez les registres des fermiers, employs et prestataires. Grez les contrats et les affectations.</p>"},manual_monitoring:{en:"Monitoring",fr:"Suivi"},manual_monitoring_text:{en:"<p>Log environmental data (periodic tests) and report incidents (pests, equipment failure) to ensure optimal farm health.</p>",fr:"<p>Enregistrez les donnes environnementales (tests priodiques) et signalez les incidents (parasites, pannes d'quipement) pour assurer la sant optimale de la ferme.</p>"},manual_reports:{en:"Reports",fr:"Rapports"},manual_reports_text:{en:"<p>Generate comprehensive PDF reports for production, financials, inventory, and more. Use the custom report builder for specific needs.</p>",fr:"<p>Gnrez des rapports PDF complets pour la production, les finances, l'inventaire et plus encore. Utilisez le gnrateur de rapports personnaliss pour des besoins spcifiques.</p>"},manual_settings:{en:"Settings",fr:"Paramtres"},manual_settings_text:{en:"<p>Configure global application settings, including company details, currency, language, and system data management.</p>",fr:"<p>Configurez les paramtres globaux de l'application, y compris les dtails de l'entreprise, la devise, la langue et la gestion des donnes systme.</p>"},manual_step_periodic_test_title:{en:"Tracking Growth Trends",fr:"Suivre les tendances de croissance"},manual_step_periodic_test_text:{en:'To track a specific line over time, use a consistent "Identity/Code" (e.g., "LINE-A1") for every period (Planting through P5). This allows the system to calculate the SGR between consecutive dates.',fr:`Pour suivre une ligne spcifique dans le temps, utilisez un "Identifiant/Code" cohrent (ex: "LINE-A1") pour chaque priode (de la plantation jusqu' P5). Cela permet au systme de calculer le SGR entre des dates conscutives.`},manual_incidents_guide_title:{en:"Incident Reporting",fr:"Signalement d'Incidents"},manual_incidents_guide_text:{en:"Log any issues affecting your farm, from pests to equipment failure. Uploading a photo enables AI-powered diagnosis and treatment suggestions.",fr:"Signalez tout problme affectant votre ferme, des parasites aux pannes d'quipement. Le tlchargement d'une photo permet un diagnostic et des suggestions de traitement par IA."},manual_storage_guide_title:{en:"On-Site Storage & Bagging Transfer",fr:"Stockage sur Site & Transfert aprs Ensachage"},manual_storage_guide_text:{en:"This section tracks seaweed that has been bagged but not yet transferred to a central warehouse. It represents the final stage of on-site production.",fr:"Cette section suit les algues qui ont t mises en sac mais pas encore transfres  un entrept central. Elle reprsente la dernire tape de la production sur site."},manual_step_normal_transfer_title:{en:"Normal Transfer Guide",fr:"Guide du Transfert Normal"},manual_step_normal_transfer_text:{en:`1. Harvest a batch.
2. Complete Drying & Bagging.
3. Navigate to On-Site Storage > Normal Transfer.
4. Select the bagged batches.
5. Click "Transfer to Warehouse" and confirm the date.`,fr:`1. Rcoltez un lot.
2. Terminez le schage et la mise en sac.
3. Allez dans Stockage sur site > Transfert normal.
4. Slectionnez les lots ensachs.
5. Cliquez sur "Transfrer  l'entrept" et confirmez la date.`},manual_deliveries_guide_title:{en:"Farmer Deliveries (Dry)",fr:"Livraisons Fermiers (Sec)"},manual_deliveries_guide_text:{en:"Record dry seaweed delivered directly by farmers to a site or the central warehouse.",fr:"Enregistrez les algues sches livres directement par les fermiers  un site ou  l'entrept central."},manual_transfers_guide_title:{en:"Inter-Site Transfers (Shipping Slips)",fr:"Transferts Inter-Sites (Bons d'expdition)"},manual_transfers_guide_text:{en:"Use this to move stock between different farm sites or from a farm site to the central pressing warehouse.",fr:"Utilisez cette fonction pour dplacer le stock entre diffrents sites de la ferme ou d'un site  l'entrept central de pressage."},manual_step_shipping_slip_title:{en:"Creating a Shipping Slip",fr:"Crer un bon d'expdition"},manual_step_shipping_slip_text:{en:`1. Select Source Site.
2. Select Destination (Warehouse or other Site).
3. Enter individual bag weights.
4. Save to initiate "Awaiting Shipment" status.`,fr:`1. Slectionnez le site d'origine.
2. Slectionnez la destination (Magasin ou autre site).
3. Saisissez les poids individuels des sacs.
4. Enregistrez pour initier le statut "En attente d'expdition".`},manual_pressing_guide_title:{en:"Pressing Warehouse",fr:"Entrept de Pressage"},manual_pressing_guide_text:{en:'This module manages two types of stock: "Bulk Seaweed" (raw material) and "Pressed Seaweed" (finished goods). A "Pressing Slip" consumes bulk stock to create pressed stock.',fr:'Ce module gre deux types de stock : "Algues en Vrac" (matire premire) et "Algues Presses" (produit fini). Un "Bon de Pressage" consomme du stock en vrac pour crer du stock press.'},manual_exports_guide_title:{en:"Exports",fr:"Exportations"},manual_exports_guide_text:{en:"Create export documents (Invoice, Packing List, C.O.) by linking one or more completed Pressing Slips. This deducts the final product from the warehouse stock.",fr:"Crez des documents d'exportation (Facture, Liste de Colisage, C.O.) en liant un ou plusieurs Bons de Pressage termins. Cela dduit le produit fini du stock de l'entrept."},manual_tests_guide_title:{en:"Periodic Tests",fr:"Tests Priodiques"},manual_tests_guide_text:{en:"Record environmental data (growth, salinity, temperature) to monitor site health.",fr:"Enregistrez les donnes environnementales (croissance, salinit, temprature) pour surveiller la sant du site."}},Rb={...vk,...bk,...Nk,...Sk,..._k},lw=S.createContext(void 0),wk=({children:t})=>{const{settings:e}=Ke(),n=e.language,r=S.useCallback(i=>Rb[i]?Rb[i][n]:i,[n]);return s.jsx(lw.Provider,{value:{language:n,t:r},children:t})},_e=()=>{const t=S.useContext(lw);if(t===void 0)throw new Error("useLocalization must be used within a LocalizationProvider");return t},Tk="modulepreload",Ck=function(t){return"/"+t},Mb={},Jn=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));i=c(n.map(h=>{if(h=Ck(h),h in Mb)return;Mb[h]=!0;const m=h.endsWith(".css"),x=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${x}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":Tk,m||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),m)return new Promise((N,T)=>{g.addEventListener("load",N),g.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return i.then(c=>{for(const d of c||[])d.status==="rejected"&&l(d.reason);return e().catch(l)})},Ek=()=>{};var Pb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cw={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Be=function(t,e){if(!t)throw Lo(e)},Lo=function(t){return new Error("Firebase Database ("+cw.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Ik=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const l=t[n++];e[r++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=t[n++],c=t[n++],d=t[n++],f=((i&7)<<18|(l&63)<<12|(c&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const l=t[n++],c=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(l&63)<<6|c&63)}}return e.join("")},Ig={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const l=t[i],c=i+1<t.length,d=c?t[i+1]:0,f=i+2<t.length,h=f?t[i+2]:0,m=l>>2,x=(l&3)<<4|d>>4;let g=(d&15)<<2|h>>6,N=h&63;f||(N=64,c||(g=64)),r.push(n[m],n[x],n[g],n[N])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(dw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ik(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const l=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const h=i<t.length?n[t.charAt(i)]:64;++i;const x=i<t.length?n[t.charAt(i)]:64;if(++i,l==null||d==null||h==null||x==null)throw new jk;const g=l<<2|d>>4;if(r.push(g),h!==64){const N=d<<4&240|h>>2;if(r.push(N),x!==64){const T=h<<6&192|x;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class jk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uw=function(t){const e=dw(t);return Ig.encodeByteArray(e,!0)},Du=function(t){return uw(t).replace(/\./g,"")},Ru=function(t){try{return Ig.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(t){return hw(void 0,t)}function hw(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!kk(n)||(t[n]=hw(t[n],e[n]));return t}function kk(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=()=>Dk().__FIREBASE_DEFAULTS__,Mk=()=>{if(typeof process>"u"||typeof Pb>"u")return;const t=Pb.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Pk=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Ru(t[1]);return e&&JSON.parse(e)},jg=()=>{try{return Ek()||Rk()||Mk()||Pk()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},fw=t=>{var e,n;return(n=(e=jg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},Ok=t=>{const e=fw(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},mw=()=>{var t;return(t=jg())==null?void 0:t.config},pw=t=>{var e;return(e=jg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function gw(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Du(JSON.stringify(n)),Du(JSON.stringify(c)),""].join(".")}const ic={};function Fk(){const t={prod:[],emulator:[]};for(const e of Object.keys(ic))ic[e]?t.emulator.push(e):t.prod.push(e);return t}function Uk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Ob=!1;function yw(t,e){if(typeof window>"u"||typeof document>"u"||!Fo(window.location.host)||ic[t]===e||ic[t]||Ob)return;ic[t]=e;function n(g){return`__firebase__banner__${g}`}const r="__firebase__banner",l=Fk().prod.length>0;function c(){const g=document.getElementById(r);g&&g.remove()}function d(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function f(g,N){g.setAttribute("width","24"),g.setAttribute("id",N),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{Ob=!0,c()},g}function m(g,N){g.setAttribute("id",N),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function x(){const g=Uk(r),N=n("text"),T=document.getElementById(N)||document.createElement("span"),C=n("learnmore"),w=document.getElementById(C)||document.createElement("a"),E=n("preprendIcon"),D=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const I=g.element;d(I),m(w,C);const k=h();f(D,E),I.append(D,T,w,k),document.body.appendChild(I)}l?(T.innerText="Preview backend disconnected.",D.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(D.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",N)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",x):x()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ag(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ns())}function Bk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gk(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function xw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zk(){const t=ns();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Hk(){return cw.NODE_ADMIN===!0}function Vk(){try{return typeof indexedDB=="object"}catch{return!1}}function qk(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var l;e(((l=i.error)==null?void 0:l.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk="FirebaseError";class Wi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Wk,Object.setPrototypeOf(this,Wi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kc.prototype.create)}}class kc{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,l=this.errors[e],c=l?$k(l,r):"Error",d=`${this.serviceName}: ${c} (${i}).`;return new Wi(i,d,r)}}function $k(t,e){return t.replace(Kk,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Kk=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(t){return JSON.parse(t)}function jn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw=function(t){let e={},n={},r={},i="";try{const l=t.split(".");e=gc(Ru(l[0])||""),n=gc(Ru(l[1])||""),i=l[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},Yk=function(t){const e=vw(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},Jk=function(t){const e=vw(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Co(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function jp(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Mu(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function Sa(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const l=t[i],c=e[i];if(Lb(l)&&Lb(c)){if(!Sa(l,c))return!1}else if(l!==c)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Lb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let x=0;x<16;x++)r[x]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let x=0;x<16;x++)r[x]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let x=16;x<80;x++){const g=r[x-3]^r[x-8]^r[x-14]^r[x-16];r[x]=(g<<1|g>>>31)&4294967295}let i=this.chain_[0],l=this.chain_[1],c=this.chain_[2],d=this.chain_[3],f=this.chain_[4],h,m;for(let x=0;x<80;x++){x<40?x<20?(h=d^l&(c^d),m=1518500249):(h=l^c^d,m=1859775393):x<60?(h=l&c|d&(l|c),m=2400959708):(h=l^c^d,m=3395469782);const g=(i<<5|i>>>27)+h+f+m+r[x]&4294967295;f=d,d=c,c=(l<<30|l>>>2)&4294967295,l=i,i=g}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+d&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const l=this.buf_;let c=this.inbuf_;for(;i<n;){if(c===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(l[c]=e.charCodeAt(i),++c,++i,c===this.blockSize){this.compress_(l),c=0;break}}else for(;i<n;)if(l[c]=e[i],++c,++i,c===this.blockSize){this.compress_(l),c=0;break}}this.inbuf_=c,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let l=24;l>=0;l-=8)e[r]=this.chain_[i]>>l&255,++r;return e}}function Qk(t,e){const n=new Zk(t,e);return n.subscribe.bind(n)}class Zk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");eD(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=ep),i.error===void 0&&(i.error=ep),i.complete===void 0&&(i.complete=ep);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eD(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function ep(){}function uh(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const l=i-55296;r++,Be(r<t.length,"Surrogate pair missing trail surrogate.");const c=t.charCodeAt(r)-56320;i=65536+(l<<10)+c}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},hh=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gs(t){return t&&t._delegate?t._delegate:t}class _a{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Ac;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rD(e))try{this.getOrInitializeService({instanceIdentifier:ya})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:i});r.resolve(l)}catch{}}}}clearInstance(e=ya){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ya){return this.instances.has(e)}getOptions(e=ya){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[l,c]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(l);r===d&&c.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const l=this.instances.get(r);return l&&e(l,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sD(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ya){return this.component?this.component.multipleInstances?e:ya:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sD(t){return t===ya?void 0:t}function rD(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new nD(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(qt||(qt={}));const aD={debug:qt.DEBUG,verbose:qt.VERBOSE,info:qt.INFO,warn:qt.WARN,error:qt.ERROR,silent:qt.SILENT},oD=qt.INFO,lD={[qt.DEBUG]:"log",[qt.VERBOSE]:"log",[qt.INFO]:"info",[qt.WARN]:"warn",[qt.ERROR]:"error"},cD=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=lD[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kg{constructor(e){this.name=e,this._logLevel=oD,this._logHandler=cD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in qt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?aD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,qt.DEBUG,...e),this._logHandler(this,qt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,qt.VERBOSE,...e),this._logHandler(this,qt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,qt.INFO,...e),this._logHandler(this,qt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,qt.WARN,...e),this._logHandler(this,qt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,qt.ERROR,...e),this._logHandler(this,qt.ERROR,...e)}}const dD=(t,e)=>e.some(n=>t instanceof n);let Fb,Ub;function uD(){return Fb||(Fb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hD(){return Ub||(Ub=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bw=new WeakMap,Ap=new WeakMap,Nw=new WeakMap,tp=new WeakMap,Dg=new WeakMap;function fD(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",l),t.removeEventListener("error",c)},l=()=>{n(Li(t.result)),i()},c=()=>{r(t.error),i()};t.addEventListener("success",l),t.addEventListener("error",c)});return e.then(n=>{n instanceof IDBCursor&&bw.set(n,t)}).catch(()=>{}),Dg.set(e,t),e}function mD(t){if(Ap.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",c),t.removeEventListener("abort",c)},l=()=>{n(),i()},c=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",l),t.addEventListener("error",c),t.addEventListener("abort",c)});Ap.set(t,e)}let kp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Ap.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Nw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Li(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function pD(t){kp=t(kp)}function gD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(np(this),e,...n);return Nw.set(r,e.sort?e.sort():[e]),Li(r)}:hD().includes(t)?function(...e){return t.apply(np(this),e),Li(bw.get(this))}:function(...e){return Li(t.apply(np(this),e))}}function yD(t){return typeof t=="function"?gD(t):(t instanceof IDBTransaction&&mD(t),dD(t,uD())?new Proxy(t,kp):t)}function Li(t){if(t instanceof IDBRequest)return fD(t);if(tp.has(t))return tp.get(t);const e=yD(t);return e!==t&&(tp.set(t,e),Dg.set(e,t)),e}const np=t=>Dg.get(t);function xD(t,e,{blocked:n,upgrade:r,blocking:i,terminated:l}={}){const c=indexedDB.open(t,e),d=Li(c);return r&&c.addEventListener("upgradeneeded",f=>{r(Li(c.result),f.oldVersion,f.newVersion,Li(c.transaction),f)}),n&&c.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),d.then(f=>{l&&f.addEventListener("close",()=>l()),i&&f.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),d}const vD=["get","getKey","getAll","getAllKeys","count"],bD=["put","add","delete","clear"],sp=new Map;function Bb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(sp.get(e))return sp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=bD.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||vD.includes(n)))return;const l=async function(c,...d){const f=this.transaction(c,i?"readwrite":"readonly");let h=f.store;return r&&(h=h.index(d.shift())),(await Promise.all([h[n](...d),i&&f.done]))[0]};return sp.set(e,l),l}pD(t=>({...t,get:(e,n,r)=>Bb(e,n)||t.get(e,n,r),has:(e,n)=>!!Bb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(SD(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function SD(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Dp="@firebase/app",Gb="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qr=new kg("@firebase/app"),_D="@firebase/app-compat",wD="@firebase/analytics-compat",TD="@firebase/analytics",CD="@firebase/app-check-compat",ED="@firebase/app-check",ID="@firebase/auth",jD="@firebase/auth-compat",AD="@firebase/database",kD="@firebase/data-connect",DD="@firebase/database-compat",RD="@firebase/functions",MD="@firebase/functions-compat",PD="@firebase/installations",OD="@firebase/installations-compat",LD="@firebase/messaging",FD="@firebase/messaging-compat",UD="@firebase/performance",BD="@firebase/performance-compat",GD="@firebase/remote-config",zD="@firebase/remote-config-compat",HD="@firebase/storage",VD="@firebase/storage-compat",qD="@firebase/firestore",WD="@firebase/ai",$D="@firebase/firestore-compat",KD="firebase",YD="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp="[DEFAULT]",JD={[Dp]:"fire-core",[_D]:"fire-core-compat",[TD]:"fire-analytics",[wD]:"fire-analytics-compat",[ED]:"fire-app-check",[CD]:"fire-app-check-compat",[ID]:"fire-auth",[jD]:"fire-auth-compat",[AD]:"fire-rtdb",[kD]:"fire-data-connect",[DD]:"fire-rtdb-compat",[RD]:"fire-fn",[MD]:"fire-fn-compat",[PD]:"fire-iid",[OD]:"fire-iid-compat",[LD]:"fire-fcm",[FD]:"fire-fcm-compat",[UD]:"fire-perf",[BD]:"fire-perf-compat",[GD]:"fire-rc",[zD]:"fire-rc-compat",[HD]:"fire-gcs",[VD]:"fire-gcs-compat",[qD]:"fire-fst",[$D]:"fire-fst-compat",[WD]:"fire-vertex","fire-js":"fire-js",[KD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pu=new Map,XD=new Map,Mp=new Map;function zb(t,e){try{t.container.addComponent(e)}catch(n){qr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Eo(t){const e=t.name;if(Mp.has(e))return qr.debug(`There were multiple attempts to register component ${e}.`),!1;Mp.set(e,t);for(const n of Pu.values())zb(n,t);for(const n of XD.values())zb(n,t);return!0}function Rg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Fi=new kc("app","Firebase",QD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _a("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Fi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bo=YD;function Sw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Rp,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Fi.create("bad-app-name",{appName:String(i)});if(n||(n=mw()),!n)throw Fi.create("no-options");const l=Pu.get(i);if(l){if(Sa(n,l.options)&&Sa(r,l.config))return l;throw Fi.create("duplicate-app",{appName:i})}const c=new iD(i);for(const f of Mp.values())c.addComponent(f);const d=new ZD(n,r,c);return Pu.set(i,d),d}function _w(t=Rp){const e=Pu.get(t);if(!e&&t===Rp&&mw())return Sw();if(!e)throw Fi.create("no-app",{appName:t});return e}function Ui(t,e,n){let r=JD[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qr.warn(c.join(" "));return}Eo(new _a(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eR="firebase-heartbeat-database",tR=1,yc="firebase-heartbeat-store";let rp=null;function ww(){return rp||(rp=xD(eR,tR,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(yc)}catch(n){console.warn(n)}}}}).catch(t=>{throw Fi.create("idb-open",{originalErrorMessage:t.message})})),rp}async function nR(t){try{const n=(await ww()).transaction(yc),r=await n.objectStore(yc).get(Tw(t));return await n.done,r}catch(e){if(e instanceof Wi)qr.warn(e.message);else{const n=Fi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qr.warn(n.message)}}}async function Hb(t,e){try{const r=(await ww()).transaction(yc,"readwrite");await r.objectStore(yc).put(e,Tw(t)),await r.done}catch(n){if(n instanceof Wi)qr.warn(n.message);else{const r=Fi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});qr.warn(r.message)}}}function Tw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=1024,rR=30;class iR{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new oR(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=Vb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(c=>c.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>rR){const c=lR(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){qr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Vb(),{heartbeatsToSend:r,unsentEntries:i}=aR(this._heartbeatsCache.heartbeats),l=Du(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(n){return qr.warn(n),""}}}function Vb(){return new Date().toISOString().substring(0,10)}function aR(t,e=sR){const n=[];let r=t.slice();for(const i of t){const l=n.find(c=>c.agent===i.agent);if(l){if(l.dates.push(i.date),qb(n)>e){l.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),qb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class oR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Vk()?qk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await nR(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function qb(t){return Du(JSON.stringify({version:2,heartbeats:t})).length}function lR(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cR(t){Eo(new _a("platform-logger",e=>new ND(e),"PRIVATE")),Eo(new _a("heartbeat",e=>new iR(e),"PRIVATE")),Ui(Dp,Gb,t),Ui(Dp,Gb,"esm2020"),Ui("fire-js","")}cR("");var dR="firebase",uR="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ui(dR,uR,"app");var Wb={};const $b="@firebase/database",Kb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cw="";function hR(t){Cw=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),jn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:gc(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return pr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new fR(e)}}catch{}return new mR},ba=Ew("localStorage"),pR=Ew("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new kg("@firebase/database"),gR=(function(){let t=1;return function(){return t++}})(),Iw=function(t){const e=tD(t),n=new Xk;n.update(e);const r=n.digest();return Ig.encodeByteArray(r)},Dc=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Dc.apply(null,r):typeof r=="object"?e+=jn(r):e+=r,e+=" "}return e};let ac=null,Yb=!0;const yR=function(t,e){Be(!0,"Can't turn on custom loggers persistently."),vo.logLevel=qt.VERBOSE,ac=vo.log.bind(vo)},qn=function(...t){if(Yb===!0&&(Yb=!1,ac===null&&pR.get("logging_enabled")===!0&&yR()),ac){const e=Dc.apply(null,t);ac(e)}},Rc=function(t){return function(...e){qn(t,...e)}},Pp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Dc(...t);vo.error(e)},Wr=function(...t){const e=`FIREBASE FATAL ERROR: ${Dc(...t)}`;throw vo.error(e),new Error(e)},ts=function(...t){const e="FIREBASE WARNING: "+Dc(...t);vo.warn(e)},xR=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Mg=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},vR=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Io="[MIN_NAME]",wa="[MAX_NAME]",ja=function(t,e){if(t===e)return 0;if(t===Io||e===wa)return-1;if(e===Io||t===wa)return 1;{const n=Jb(t),r=Jb(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},bR=function(t,e){return t===e?0:t<e?-1:1},Jl=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+jn(e))},Pg=function(t){if(typeof t!="object"||t===null)return jn(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=jn(e[r]),n+=":",n+=Pg(t[e[r]]);return n+="}",n},jw=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Wn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Aw=function(t){Be(!Mg(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,l,c,d,f;t===0?(l=0,c=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(d=Math.min(Math.floor(Math.log(t)/Math.LN2),r),l=d+r,c=Math.round(t*Math.pow(2,n-d)-Math.pow(2,n))):(l=0,c=Math.round(t/Math.pow(2,1-r-n))));const h=[];for(f=n;f;f-=1)h.push(c%2?1:0),c=Math.floor(c/2);for(f=e;f;f-=1)h.push(l%2?1:0),l=Math.floor(l/2);h.push(i?1:0),h.reverse();const m=h.join("");let x="";for(f=0;f<64;f+=8){let g=parseInt(m.substr(f,8),2).toString(16);g.length===1&&(g="0"+g),x=x+g}return x.toLowerCase()},NR=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},SR=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function _R(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const wR=new RegExp("^-?(0*)\\d{1,10}$"),TR=-2147483648,CR=2147483647,Jb=function(t){if(wR.test(t)){const e=Number(t);if(e>=TR&&e<=CR)return e}return null},Go=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw ts("Exception was thrown by user callback.",n),e},Math.floor(0))}},ER=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},oc=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,ur(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ts(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(qn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ts(e)}}class Su{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Su.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="5",kw="v",Dw="s",Rw="r",Mw="f",Pw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ow="ls",Lw="p",Op="ac",Fw="websocket",Uw="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e,n,r,i,l=!1,c="",d=!1,f=!1,h=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=l,this.persistenceKey=c,this.includeNamespaceInQueryParams=d,this.isUsingEmulator=f,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ba.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ba.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function AR(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Gw(t,e,n){Be(typeof e=="string","typeof type must == string"),Be(typeof n=="object","typeof params must == object");let r;if(e===Fw)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Uw)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);AR(t)&&(n.ns=t.namespace);const i=[];return Wn(n,(l,c)=>{i.push(l+"="+c)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(){this.counters_={}}incrementCounter(e,n=1){pr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Ak(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip={},ap={};function Lg(t){const e=t.toString();return ip[e]||(ip[e]=new kR),ip[e]}function DR(t,e){const n=t.toString();return ap[n]||(ap[n]=e()),ap[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Go(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb="start",MR="close",PR="pLPCommand",OR="pRTLPCB",zw="id",Hw="pw",Vw="ser",LR="cb",FR="seg",UR="ts",BR="d",GR="dframe",qw=1870,Ww=30,zR=qw-Ww,HR=25e3,VR=3e4;class mo{constructor(e,n,r,i,l,c,d){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.transportSessionId=c,this.lastSessionId=d,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Rc(e),this.stats_=Lg(n),this.urlFn=f=>(this.appCheckToken&&(f[Op]=this.appCheckToken),Gw(n,Uw,f))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new RR(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(VR)),vR(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Fg((...l)=>{const[c,d,f,h,m]=l;if(this.incrementIncomingBytes_(l),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===Xb)this.id=d,this.password=f;else if(c===MR)d?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(d,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...l)=>{const[c,d]=l;this.incrementIncomingBytes_(l),this.myPacketOrderer.handleResponse(c,d)},()=>{this.onClosed_()},this.urlFn);const r={};r[Xb]="t",r[Vw]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[LR]=this.scriptTagHolder.uniqueCallbackIdentifier),r[kw]=Og,this.transportSessionId&&(r[Dw]=this.transportSessionId),this.lastSessionId&&(r[Ow]=this.lastSessionId),this.applicationId&&(r[Lw]=this.applicationId),this.appCheckToken&&(r[Op]=this.appCheckToken),typeof location<"u"&&location.hostname&&Pw.test(location.hostname)&&(r[Rw]=Mw);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){mo.forceAllow_=!0}static forceDisallow(){mo.forceDisallow_=!0}static isAvailable(){return mo.forceAllow_?!0:!mo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!NR()&&!SR()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=jn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=uw(n),i=jw(r,zR);for(let l=0;l<i.length;l++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[l]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[GR]="t",r[zw]=e,r[Hw]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=jn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Fg{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=gR(),window[PR+this.uniqueCallbackIdentifier]=e,window[OR+this.uniqueCallbackIdentifier]=n,this.myIFrame=Fg.createIFrame_();let l="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(l='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+l+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(d){qn("frame writing exception"),d.stack&&qn(d.stack),qn(d)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||qn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[zw]=this.myID,e[Hw]=this.myPW,e[Vw]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Ww+r.length<=qw;){const c=this.pendingSegs.shift();r=r+"&"+FR+i+"="+c.seg+"&"+UR+i+"="+c.ts+"&"+BR+i+"="+c.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(HR)),l=()=>{clearTimeout(i),r()};this.addTag(e,l)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{qn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qR=16384,WR=45e3;let Ou=null;typeof MozWebSocket<"u"?Ou=MozWebSocket:typeof WebSocket<"u"&&(Ou=WebSocket);class qs{constructor(e,n,r,i,l,c,d){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Rc(this.connId),this.stats_=Lg(n),this.connURL=qs.connectionURL_(n,c,d,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,l){const c={};return c[kw]=Og,typeof location<"u"&&location.hostname&&Pw.test(location.hostname)&&(c[Rw]=Mw),n&&(c[Dw]=n),r&&(c[Ow]=r),i&&(c[Op]=i),l&&(c[Lw]=l),Gw(e,Fw,c)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ba.set("previous_websocket_failure",!0);try{let r;Hk(),this.mySock=new Ou(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){qs.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Ou!==null&&!qs.forceDisallow_}static previouslyFailed(){return ba.isInMemoryStorage||ba.get("previous_websocket_failure")===!0}markConnectionHealthy(){ba.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=gc(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Be(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=jn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=jw(n,qR);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WR))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}qs.responsesRequiredToBeHealthy=2;qs.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{static get ALL_TRANSPORTS(){return[mo,qs]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=qs&&qs.isAvailable();let r=n&&!qs.previouslyFailed();if(e.webSocketOnly&&(n||ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[qs];else{const i=this.transports_=[];for(const l of xc.ALL_TRANSPORTS)l&&l.isAvailable()&&i.push(l);xc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}xc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $R=6e4,KR=5e3,YR=10*1024,JR=100*1024,op="t",Qb="d",XR="s",Zb="r",QR="e",eN="o",tN="a",nN="n",sN="p",ZR="h";class e1{constructor(e,n,r,i,l,c,d,f,h,m){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=l,this.onMessage_=c,this.onReady_=d,this.onDisconnect_=f,this.onKill_=h,this.lastSessionId=m,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Rc("c:"+this.id+":"),this.transportManager_=new xc(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=oc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>JR?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>YR?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(op in e){const n=e[op];n===tN?this.upgradeIfSecondaryHealthy_():n===Zb?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===eN&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Jl("t",e),r=Jl("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:sN,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:tN,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:nN,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Jl("t",e),r=Jl("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Jl(op,e);if(Qb in e){const r=e[Qb];if(n===ZR){const i={...r};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===nN){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===XR?this.onConnectionShutdown_(r):n===Zb?this.onReset_(r):n===QR?Pp("Server Error: "+r):n===eN?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Pp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Og!==r&&ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),oc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor($R))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):oc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(KR))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:sN,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ba.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e){this.allowedEvents_=e,this.listeners_={},Be(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let l=0;l<i.length;l++)if(i[l].callback===n&&(!r||r===i[l].context)){i.splice(l,1);return}}validateEventType_(e){Be(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu extends Kw{static getInstance(){return new Lu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ag()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Be(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rN=32,iN=768;class Wt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Dt(){return new Wt("")}function yt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function zi(t){return t.pieces_.length-t.pieceNum_}function Xt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Wt(t.pieces_,e)}function Ug(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function t1(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function vc(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Yw(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Wt(e,0)}function mn(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Wt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new Wt(n,0)}function Nt(t){return t.pieceNum_>=t.pieces_.length}function es(t,e){const n=yt(t),r=yt(e);if(n===null)return e;if(n===r)return es(Xt(t),Xt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function n1(t,e){const n=vc(t,0),r=vc(e,0);for(let i=0;i<n.length&&i<r.length;i++){const l=ja(n[i],r[i]);if(l!==0)return l}return n.length===r.length?0:n.length<r.length?-1:1}function Bg(t,e){if(zi(t)!==zi(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Os(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(zi(t)>zi(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class s1{constructor(e,n){this.errorPrefix_=n,this.parts_=vc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=hh(this.parts_[r]);Jw(this)}}function r1(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=hh(e),Jw(t)}function i1(t){const e=t.parts_.pop();t.byteLength_-=hh(e),t.parts_.length>0&&(t.byteLength_-=1)}function Jw(t){if(t.byteLength_>iN)throw new Error(t.errorPrefix_+"has a key path longer than "+iN+" bytes ("+t.byteLength_+").");if(t.parts_.length>rN)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+rN+") or object contains a cycle "+xa(t))}function xa(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg extends Kw{static getInstance(){return new Gg}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Be(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl=1e3,a1=300*1e3,aN=30*1e3,o1=1.3,l1=3e4,c1="server_kill",oN=3;class Hr extends $w{constructor(e,n,r,i,l,c,d,f){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=l,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.authOverride_=f,this.id=Hr.nextPersistentConnectionId_++,this.log_=Rc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Xl,this.maxReconnectDelay_=a1,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,f)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Gg.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Lu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,l={r:i,a:e,b:n};this.log_(jn(l)),Be(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(l),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new Ac,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:c=>{const d=c.d;c.s==="ok"?n.resolve(d):n.reject(d)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(l),n.promise}listen(e,n,r,i){this.initConnection_();const l=e._queryIdentifier,c=e._path.toString();this.log_("Listen called for "+c+" "+l),this.listens.has(c)||this.listens.set(c,new Map),Be(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Be(!this.listens.get(c).has(l),"listen() called twice for same path/queryId.");const d={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(c).set(l,d),this.connected_&&this.sendListen_(d)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const l={p:r},c="q";e.tag&&(l.q=n._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest(c,l,d=>{const f=d.d,h=d.s;Hr.warnOnListenWarnings_(f,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",d),h!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(h,f))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&pr(e,"w")){const r=Co(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',l=n._path.toString();ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${l} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Jk(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=aN)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Yk(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const l=i.s,c=i.d||"error";this.authToken_===e&&(l==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(l,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),Be(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const l={p:e},c="n";i&&(l.q=r,l.t=i),this.sendRequest(c,l)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const l={p:n,d:r};this.log_("onDisconnect "+e,l),this.sendRequest(e,l,c=>{i&&setTimeout(()=>{i(c.s,c.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,l){this.initConnection_();const c={p:n,d:r};l!==void 0&&(c.h=l),this.outstandingPuts_.push({action:e,request:c,onComplete:i}),this.outstandingPutCount_++;const d=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(d):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,l=>{this.log_(n+" response",l),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(l.s,l.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const l=r.d;this.log_("reportStats","Error sending stats: "+l)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+jn(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Pp("Unrecognized action received from server: "+jn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Be(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Xl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Xl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>l1&&(this.reconnectDelay_=Xl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*o1)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Hr.nextConnectionId_++,l=this.lastSessionId;let c=!1,d=null;const f=function(){d?d.close():(c=!0,r())},h=function(x){Be(d,"sendRequest call when we're not connected not allowed."),d.sendRequest(x)};this.realtime_={close:f,sendRequest:h};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[x,g]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);c?qn("getToken() completed but was canceled"):(qn("getToken() completed. Creating connection."),this.authToken_=x&&x.accessToken,this.appCheckToken_=g&&g.token,d=new e1(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,N=>{ts(N+" ("+this.repoInfo_.toString()+")"),this.interrupt(c1)},l))}catch(x){this.log_("Failed to get token: "+x),c||(this.repoInfo_.nodeAdmin&&ts(x),f())}}}interrupt(e){qn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],jp(this.interruptReasons_)&&(this.reconnectDelay_=Xl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(l=>Pg(l)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new Wt(e).toString();let i;if(this.listens.has(r)){const l=this.listens.get(r);i=l.get(n),l.delete(n),l.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){qn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=oN&&(this.reconnectDelay_=aN,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){qn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=oN&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Cw.replace(/\./g,"-")]=1,Ag()?e["framework.cordova"]=1:xw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Lu.getInstance().currentlyOnline();return jp(this.interruptReasons_)&&e}}Hr.nextPersistentConnectionId_=0;Hr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new xt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new xt(Io,e),i=new xt(Io,n);return this.compare(r,i)!==0}minPost(){return xt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cu;class Xw extends fh{static get __EMPTY_NODE(){return cu}static set __EMPTY_NODE(e){cu=e}compare(e,n){return ja(e.name,n.name)}isDefinedOn(e){throw Lo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return xt.MIN}maxPost(){return new xt(wa,cu)}makePost(e,n){return Be(typeof e=="string","KeyIndex indexValue must always be a string."),new xt(e,cu)}toString(){return".key"}}const bo=new Xw;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e,n,r,i,l=null){this.isReverse_=i,this.resultGenerator_=l,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(e=e,c=n?r(e.key,n):1,i&&(c*=-1),c<0)this.isReverse_?e=e.left:e=e.right;else if(c===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Mn{constructor(e,n,r,i,l){this.key=e,this.value=n,this.color=r??Mn.RED,this.left=i??ds.EMPTY_NODE,this.right=l??ds.EMPTY_NODE}copy(e,n,r,i,l){return new Mn(e??this.key,n??this.value,r??this.color,i??this.left,l??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const l=r(e,i.key);return l<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):l===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return ds.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return ds.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Mn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Mn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Mn.RED=!0;Mn.BLACK=!1;class d1{copy(e,n,r,i,l){return this}insert(e,n,r){return new Mn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ds{constructor(e,n=ds.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new ds(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Mn.BLACK,null,null))}remove(e){return new ds(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Mn.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new du(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new du(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new du(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new du(this.root_,null,this.comparator_,!0,e)}}ds.EMPTY_NODE=new d1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1(t,e){return ja(t.name,e.name)}function zg(t,e){return ja(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lp;function h1(t){Lp=t}const Qw=function(t){return typeof t=="number"?"number:"+Aw(t):"string:"+t},Zw=function(t){if(t.isLeafNode()){const e=t.val();Be(typeof e=="string"||typeof e=="number"||typeof e=="object"&&pr(e,".sv"),"Priority must be a string or number.")}else Be(t===Lp||t.isEmpty(),"priority of unexpected type.");Be(t===Lp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lN;class Rn{static set __childrenNodeConstructor(e){lN=e}static get __childrenNodeConstructor(){return lN}constructor(e,n=Rn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Be(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Zw(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Rn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Rn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Nt(e)?this:yt(e)===".priority"?this.priorityNode_:Rn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Rn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=yt(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(Be(r!==".priority"||zi(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Rn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Xt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Qw(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Aw(this.value_):e+=this.value_,this.lazyHash_=Iw(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Rn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Rn.__childrenNodeConstructor?-1:(Be(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=Rn.VALUE_TYPE_ORDER.indexOf(n),l=Rn.VALUE_TYPE_ORDER.indexOf(r);return Be(i>=0,"Unknown leaf type: "+n),Be(l>=0,"Unknown leaf type: "+r),i===l?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:l-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Rn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eT,tT;function f1(t){eT=t}function m1(t){tT=t}class p1 extends fh{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),l=r.compareTo(i);return l===0?ja(e.name,n.name):l}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return xt.MIN}maxPost(){return new xt(wa,new Rn("[PRIORITY-POST]",tT))}makePost(e,n){const r=eT(e);return new xt(n,new Rn("[PRIORITY-POST]",r))}toString(){return".priority"}}const pn=new p1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g1=Math.log(2);class y1{constructor(e){const n=l=>parseInt(Math.log(l)/g1,10),r=l=>parseInt(Array(l+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Fu=function(t,e,n,r){t.sort(e);const i=function(f,h){const m=h-f;let x,g;if(m===0)return null;if(m===1)return x=t[f],g=n?n(x):x,new Mn(g,x.node,Mn.BLACK,null,null);{const N=parseInt(m/2,10)+f,T=i(f,N),C=i(N+1,h);return x=t[N],g=n?n(x):x,new Mn(g,x.node,Mn.BLACK,T,C)}},l=function(f){let h=null,m=null,x=t.length;const g=function(T,C){const w=x-T,E=x;x-=T;const D=i(w+1,E),I=t[w],k=n?n(I):I;N(new Mn(k,I.node,C,null,D))},N=function(T){h?(h.left=T,h=T):(m=T,h=T)};for(let T=0;T<f.count;++T){const C=f.nextBitIsOne(),w=Math.pow(2,f.count-(T+1));C?g(w,Mn.BLACK):(g(w,Mn.BLACK),g(w,Mn.RED))}return m},c=new y1(t.length),d=l(c);return new ds(r||e,d)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lp;const uo={};class Fr{static get Default(){return Be(uo&&pn,"ChildrenNode.ts has not been loaded"),lp=lp||new Fr({".priority":uo},{".priority":pn}),lp}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Co(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof ds?n:null}hasIndex(e){return pr(this.indexSet_,e.toString())}addIndex(e,n){Be(e!==bo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const l=n.getIterator(xt.Wrap);let c=l.getNext();for(;c;)i=i||e.isDefinedOn(c.node),r.push(c),c=l.getNext();let d;i?d=Fu(r,e.getCompare()):d=uo;const f=e.toString(),h={...this.indexSet_};h[f]=e;const m={...this.indexes_};return m[f]=d,new Fr(m,h)}addToIndexes(e,n){const r=Mu(this.indexes_,(i,l)=>{const c=Co(this.indexSet_,l);if(Be(c,"Missing index implementation for "+l),i===uo)if(c.isDefinedOn(e.node)){const d=[],f=n.getIterator(xt.Wrap);let h=f.getNext();for(;h;)h.name!==e.name&&d.push(h),h=f.getNext();return d.push(e),Fu(d,c.getCompare())}else return uo;else{const d=n.get(e.name);let f=i;return d&&(f=f.remove(new xt(e.name,d))),f.insert(e,e.node)}});return new Fr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Mu(this.indexes_,i=>{if(i===uo)return i;{const l=n.get(e.name);return l?i.remove(new xt(e.name,l)):i}});return new Fr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ql;class it{static get EMPTY_NODE(){return Ql||(Ql=new it(new ds(zg),null,Fr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Zw(this.priorityNode_),this.children_.isEmpty()&&Be(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ql}updatePriority(e){return this.children_.isEmpty()?this:new it(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ql:n}}getChild(e){const n=yt(e);return n===null?this:this.getImmediateChild(n).getChild(Xt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(Be(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new xt(e,n);let i,l;n.isEmpty()?(i=this.children_.remove(e),l=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),l=this.indexMap_.addToIndexes(r,this.children_));const c=i.isEmpty()?Ql:this.priorityNode_;return new it(i,c,l)}}updateChild(e,n){const r=yt(e);if(r===null)return n;{Be(yt(e)!==".priority"||zi(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Xt(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,l=!0;if(this.forEachChild(pn,(c,d)=>{n[c]=d.val(e),r++,l&&it.INTEGER_REGEXP_.test(c)?i=Math.max(i,Number(c)):l=!1}),!e&&l&&i<2*r){const c=[];for(const d in n)c[d]=n[d];return c}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Qw(this.getPriority().val())+":"),this.forEachChild(pn,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":Iw(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const l=i.getPredecessorKey(new xt(e,n));return l?l.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new xt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new xt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,xt.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)<0;)i.getNext(),l=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,xt.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)>0;)i.getNext(),l=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Mc?-1:0}withIndex(e){if(e===bo||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new it(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===bo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(pn),i=n.getIterator(pn);let l=r.getNext(),c=i.getNext();for(;l&&c;){if(l.name!==c.name||!l.node.equals(c.node))return!1;l=r.getNext(),c=i.getNext()}return l===null&&c===null}else return!1;else return!1}}resolveIndex_(e){return e===bo?null:this.indexMap_.get(e.toString())}}it.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class x1 extends it{constructor(){super(new ds(zg),it.EMPTY_NODE,Fr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return it.EMPTY_NODE}isEmpty(){return!1}}const Mc=new x1;Object.defineProperties(xt,{MIN:{value:new xt(Io,it.EMPTY_NODE)},MAX:{value:new xt(wa,Mc)}});Xw.__EMPTY_NODE=it.EMPTY_NODE;Rn.__childrenNodeConstructor=it;h1(Mc);m1(Mc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1=!0;function In(t,e=null){if(t===null)return it.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),Be(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Rn(n,In(e))}if(!(t instanceof Array)&&v1){const n=[];let r=!1;if(Wn(t,(c,d)=>{if(c.substring(0,1)!=="."){const f=In(d);f.isEmpty()||(r=r||!f.getPriority().isEmpty(),n.push(new xt(c,f)))}}),n.length===0)return it.EMPTY_NODE;const l=Fu(n,u1,c=>c.name,zg);if(r){const c=Fu(n,pn.getCompare());return new it(l,In(e),new Fr({".priority":c},{".priority":pn}))}else return new it(l,In(e),Fr.Default)}else{let n=it.EMPTY_NODE;return Wn(t,(r,i)=>{if(pr(t,r)&&r.substring(0,1)!=="."){const l=In(i);(l.isLeafNode()||!l.isEmpty())&&(n=n.updateImmediateChild(r,l))}}),n.updatePriority(In(e))}}f1(In);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1 extends fh{constructor(e){super(),this.indexPath_=e,Be(!Nt(e)&&yt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),l=r.compareTo(i);return l===0?ja(e.name,n.name):l}makePost(e,n){const r=In(e),i=it.EMPTY_NODE.updateChild(this.indexPath_,r);return new xt(n,i)}maxPost(){const e=it.EMPTY_NODE.updateChild(this.indexPath_,Mc);return new xt(wa,e)}toString(){return vc(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1 extends fh{compare(e,n){const r=e.node.compareTo(n.node);return r===0?ja(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return xt.MIN}maxPost(){return xt.MAX}makePost(e,n){const r=In(e);return new xt(n,r)}toString(){return".value"}}const S1=new N1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(t){return{type:"value",snapshotNode:t}}function jo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function bc(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Nc(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function _1(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e){this.index_=e}updateChild(e,n,r,i,l,c){Be(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const d=e.getImmediateChild(n);return d.getChild(i).equals(r.getChild(i))&&d.isEmpty()===r.isEmpty()||(c!=null&&(r.isEmpty()?e.hasChild(n)?c.trackChildChange(bc(n,d)):Be(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):d.isEmpty()?c.trackChildChange(jo(n,r)):c.trackChildChange(Nc(n,r,d))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(pn,(i,l)=>{n.hasChild(i)||r.trackChildChange(bc(i,l))}),n.isLeafNode()||n.forEachChild(pn,(i,l)=>{if(e.hasChild(i)){const c=e.getImmediateChild(i);c.equals(l)||r.trackChildChange(Nc(i,l,c))}else r.trackChildChange(jo(i,l))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?it.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e){this.indexedFilter_=new Hg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Sc.getStartPost_(e),this.endPost_=Sc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,l,c){return this.matches(new xt(n,r))||(r=it.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,l,c)}updateFullNode(e,n,r){n.isLeafNode()&&(n=it.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(it.EMPTY_NODE);const l=this;return n.forEachChild(pn,(c,d)=>{l.matches(new xt(c,d))||(i=i.updateImmediateChild(c,it.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Sc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,l,c){return this.rangedFilter_.matches(new xt(n,r))||(r=it.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,l,c):this.fullLimitUpdateChild_(e,n,r,l,c)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=it.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=it.EMPTY_NODE.withIndex(this.index_);let l;this.reverse_?l=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):l=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;l.hasNext()&&c<this.limit_;){const d=l.getNext();if(this.withinDirectionalStart(d))if(this.withinDirectionalEnd(d))i=i.updateImmediateChild(d.name,d.node),c++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(it.EMPTY_NODE);let l;this.reverse_?l=i.getReverseIterator(this.index_):l=i.getIterator(this.index_);let c=0;for(;l.hasNext();){const d=l.getNext();c<this.limit_&&this.withinDirectionalStart(d)&&this.withinDirectionalEnd(d)?c++:i=i.updateImmediateChild(d.name,it.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,l){let c;if(this.reverse_){const x=this.index_.getCompare();c=(g,N)=>x(N,g)}else c=this.index_.getCompare();const d=e;Be(d.numChildren()===this.limit_,"");const f=new xt(n,r),h=this.reverse_?d.getFirstChild(this.index_):d.getLastChild(this.index_),m=this.rangedFilter_.matches(f);if(d.hasChild(n)){const x=d.getImmediateChild(n);let g=i.getChildAfterChild(this.index_,h,this.reverse_);for(;g!=null&&(g.name===n||d.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);const N=g==null?1:c(g,f);if(m&&!r.isEmpty()&&N>=0)return l!=null&&l.trackChildChange(Nc(n,r,x)),d.updateImmediateChild(n,r);{l!=null&&l.trackChildChange(bc(n,x));const C=d.updateImmediateChild(n,it.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(l!=null&&l.trackChildChange(jo(g.name,g.node)),C.updateImmediateChild(g.name,g.node)):C}}else return r.isEmpty()?e:m&&c(h,f)>=0?(l!=null&&(l.trackChildChange(bc(h.name,h.node)),l.trackChildChange(jo(n,r))),d.updateImmediateChild(n,r).updateImmediateChild(h.name,it.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Be(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Be(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Io}hasEnd(){return this.endSet_}getIndexEndValue(){return Be(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Be(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wa}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Be(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===pn}copy(){const e=new Vg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function T1(t){return t.loadsAllData()?new Hg(t.getIndex()):t.hasLimit()?new w1(t):new Sc(t)}function cN(t){const e={};if(t.isDefault())return e;let n;if(t.index_===pn?n="$priority":t.index_===S1?n="$value":t.index_===bo?n="$key":(Be(t.index_ instanceof b1,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=jn(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=jn(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+jn(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=jn(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+jn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function dN(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==pn&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu extends $w{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(Be(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Rc("p:rest:"),this.listens_={}}listen(e,n,r,i){const l=e._path.toString();this.log_("Listen called for "+l+" "+e._queryIdentifier);const c=Uu.getListenId_(e,r),d={};this.listens_[c]=d;const f=cN(e._queryParams);this.restRequest_(l+".json",f,(h,m)=>{let x=m;if(h===404&&(x=null,h=null),h===null&&this.onDataUpdate_(l,x,!1,r),Co(this.listens_,c)===d){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",i(g,null)}})}unlisten(e,n){const r=Uu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=cN(e._queryParams),r=e._path.toString(),i=new Ac;return this.restRequest_(r+".json",n,(l,c)=>{let d=c;l===404&&(d=null,l=null),l===null?(this.onDataUpdate_(r,d,!1,null),i.resolve(d)):i.reject(new Error(d))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,l])=>{i&&i.accessToken&&(n.auth=i.accessToken),l&&l.token&&(n.ac=l.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Uo(n);this.log_("Sending REST request for "+c);const d=new XMLHttpRequest;d.onreadystatechange=()=>{if(r&&d.readyState===4){this.log_("REST Response for "+c+" received. status:",d.status,"response:",d.responseText);let f=null;if(d.status>=200&&d.status<300){try{f=gc(d.responseText)}catch{ts("Failed to parse JSON response for "+c+": "+d.responseText)}r(null,f)}else d.status!==401&&d.status!==404&&ts("Got unsuccessful REST response for "+c+" Status: "+d.status),r(d.status);r=null}},d.open("GET",c,!0),d.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(){this.rootNode_=it.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(){return{value:null,children:new Map}}function sT(t,e,n){if(Nt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=yt(e);t.children.has(r)||t.children.set(r,Bu());const i=t.children.get(r);e=Xt(e),sT(i,e,n)}}function Fp(t,e,n){t.value!==null?n(e,t.value):E1(t,(r,i)=>{const l=new Wt(e.toString()+"/"+r);Fp(i,l,n)})}function E1(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Wn(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uN=10*1e3,j1=30*1e3,A1=300*1e3;class k1{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new I1(e);const r=uN+(j1-uN)*Math.random();oc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;Wn(e,(i,l)=>{l>0&&pr(this.statsToReport_,i)&&(n[i]=l,r=!0)}),r&&this.server_.reportStats(n),oc(this.reportStats_.bind(this),Math.floor(Math.random()*2*A1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ws;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ws||(Ws={}));function qg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Wg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function $g(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Ws.ACK_USER_WRITE,this.source=qg()}operationForChild(e){if(Nt(this.path)){if(this.affectedTree.value!=null)return Be(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Wt(e));return new Gu(Dt(),n,this.revert)}}else return Be(yt(this.path)===e,"operationForChild called for unrelated child."),new Gu(Xt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e,n){this.source=e,this.path=n,this.type=Ws.LISTEN_COMPLETE}operationForChild(e){return Nt(this.path)?new _c(this.source,Dt()):new _c(this.source,Xt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Ws.OVERWRITE}operationForChild(e){return Nt(this.path)?new Ta(this.source,Dt(),this.snap.getImmediateChild(e)):new Ta(this.source,Xt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Ws.MERGE}operationForChild(e){if(Nt(this.path)){const n=this.children.subtree(new Wt(e));return n.isEmpty()?null:n.value?new Ta(this.source,Dt(),n.value):new Ao(this.source,Dt(),n)}else return Be(yt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ao(this.source,Xt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Nt(e))return this.isFullyInitialized()&&!this.filtered_;const n=yt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function R1(t,e,n,r){const i=[],l=[];return e.forEach(c=>{c.type==="child_changed"&&t.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&l.push(_1(c.childName,c.snapshotNode))}),Zl(t,i,"child_removed",e,r,n),Zl(t,i,"child_added",e,r,n),Zl(t,i,"child_moved",l,r,n),Zl(t,i,"child_changed",e,r,n),Zl(t,i,"value",e,r,n),i}function Zl(t,e,n,r,i,l){const c=r.filter(d=>d.type===n);c.sort((d,f)=>P1(t,d,f)),c.forEach(d=>{const f=M1(t,d,l);i.forEach(h=>{h.respondsTo(d.type)&&e.push(h.createEvent(f,t.query_))})})}function M1(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function P1(t,e,n){if(e.childName==null||n.childName==null)throw Lo("Should only compare child_ events.");const r=new xt(e.childName,e.snapshotNode),i=new xt(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(t,e){return{eventCache:t,serverCache:e}}function lc(t,e,n,r){return mh(new Hi(e,n,r),t.serverCache)}function rT(t,e,n,r){return mh(t.eventCache,new Hi(e,n,r))}function zu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ca(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cp;const O1=()=>(cp||(cp=new ds(bR)),cp);class Yt{static fromObject(e){let n=new Yt(null);return Wn(e,(r,i)=>{n=n.set(new Wt(r),i)}),n}constructor(e,n=O1()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Dt(),value:this.value};if(Nt(e))return null;{const r=yt(e),i=this.children.get(r);if(i!==null){const l=i.findRootMostMatchingPathAndValue(Xt(e),n);return l!=null?{path:mn(new Wt(r),l.path),value:l.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Nt(e))return this;{const n=yt(e),r=this.children.get(n);return r!==null?r.subtree(Xt(e)):new Yt(null)}}set(e,n){if(Nt(e))return new Yt(n,this.children);{const r=yt(e),l=(this.children.get(r)||new Yt(null)).set(Xt(e),n),c=this.children.insert(r,l);return new Yt(this.value,c)}}remove(e){if(Nt(e))return this.children.isEmpty()?new Yt(null):new Yt(null,this.children);{const n=yt(e),r=this.children.get(n);if(r){const i=r.remove(Xt(e));let l;return i.isEmpty()?l=this.children.remove(n):l=this.children.insert(n,i),this.value===null&&l.isEmpty()?new Yt(null):new Yt(this.value,l)}else return this}}get(e){if(Nt(e))return this.value;{const n=yt(e),r=this.children.get(n);return r?r.get(Xt(e)):null}}setTree(e,n){if(Nt(e))return n;{const r=yt(e),l=(this.children.get(r)||new Yt(null)).setTree(Xt(e),n);let c;return l.isEmpty()?c=this.children.remove(r):c=this.children.insert(r,l),new Yt(this.value,c)}}fold(e){return this.fold_(Dt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,l)=>{r[i]=l.fold_(mn(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Dt(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(Nt(e))return null;{const l=yt(e),c=this.children.get(l);return c?c.findOnPath_(Xt(e),mn(n,l),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Dt(),n)}foreachOnPath_(e,n,r){if(Nt(e))return this;{this.value&&r(n,this.value);const i=yt(e),l=this.children.get(i);return l?l.foreachOnPath_(Xt(e),mn(n,i),r):new Yt(null)}}foreach(e){this.foreach_(Dt(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(mn(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e){this.writeTree_=e}static empty(){return new Ks(new Yt(null))}}function cc(t,e,n){if(Nt(e))return new Ks(new Yt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let l=r.value;const c=es(i,e);return l=l.updateChild(c,n),new Ks(t.writeTree_.set(i,l))}else{const i=new Yt(n),l=t.writeTree_.setTree(e,i);return new Ks(l)}}}function Up(t,e,n){let r=t;return Wn(n,(i,l)=>{r=cc(r,mn(e,i),l)}),r}function hN(t,e){if(Nt(e))return Ks.empty();{const n=t.writeTree_.setTree(e,new Yt(null));return new Ks(n)}}function Bp(t,e){return Aa(t,e)!=null}function Aa(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(es(n.path,e)):null}function fN(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(pn,(r,i)=>{e.push(new xt(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new xt(r,i.value))}),e}function Bi(t,e){if(Nt(e))return t;{const n=Aa(t,e);return n!=null?new Ks(new Yt(n)):new Ks(t.writeTree_.subtree(e))}}function Gp(t){return t.writeTree_.isEmpty()}function ko(t,e){return iT(Dt(),t.writeTree_,e)}function iT(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,l)=>{i===".priority"?(Be(l.value!==null,"Priority writes must always be leaf nodes"),r=l.value):n=iT(mn(t,i),l,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(mn(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(t,e){return cT(e,t)}function L1(t,e,n,r,i){Be(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=cc(t.visibleWrites,e,n)),t.lastWriteId=r}function F1(t,e,n,r){Be(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=Up(t.visibleWrites,e,n),t.lastWriteId=r}function U1(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function B1(t,e){const n=t.allWrites.findIndex(d=>d.writeId===e);Be(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,l=!1,c=t.allWrites.length-1;for(;i&&c>=0;){const d=t.allWrites[c];d.visible&&(c>=n&&G1(d,r.path)?i=!1:Os(r.path,d.path)&&(l=!0)),c--}if(i){if(l)return z1(t),!0;if(r.snap)t.visibleWrites=hN(t.visibleWrites,r.path);else{const d=r.children;Wn(d,f=>{t.visibleWrites=hN(t.visibleWrites,mn(r.path,f))})}return!0}else return!1}function G1(t,e){if(t.snap)return Os(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Os(mn(t.path,n),e))return!0;return!1}function z1(t){t.visibleWrites=aT(t.allWrites,H1,Dt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function H1(t){return t.visible}function aT(t,e,n){let r=Ks.empty();for(let i=0;i<t.length;++i){const l=t[i];if(e(l)){const c=l.path;let d;if(l.snap)Os(n,c)?(d=es(n,c),r=cc(r,d,l.snap)):Os(c,n)&&(d=es(c,n),r=cc(r,Dt(),l.snap.getChild(d)));else if(l.children){if(Os(n,c))d=es(n,c),r=Up(r,d,l.children);else if(Os(c,n))if(d=es(c,n),Nt(d))r=Up(r,Dt(),l.children);else{const f=Co(l.children,yt(d));if(f){const h=f.getChild(Xt(d));r=cc(r,Dt(),h)}}}else throw Lo("WriteRecord should have .snap or .children")}}return r}function oT(t,e,n,r,i){if(!r&&!i){const l=Aa(t.visibleWrites,e);if(l!=null)return l;{const c=Bi(t.visibleWrites,e);if(Gp(c))return n;if(n==null&&!Bp(c,Dt()))return null;{const d=n||it.EMPTY_NODE;return ko(c,d)}}}else{const l=Bi(t.visibleWrites,e);if(!i&&Gp(l))return n;if(!i&&n==null&&!Bp(l,Dt()))return null;{const c=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(Os(h.path,e)||Os(e,h.path))},d=aT(t.allWrites,c,e),f=n||it.EMPTY_NODE;return ko(d,f)}}}function V1(t,e,n){let r=it.EMPTY_NODE;const i=Aa(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(pn,(l,c)=>{r=r.updateImmediateChild(l,c)}),r;if(n){const l=Bi(t.visibleWrites,e);return n.forEachChild(pn,(c,d)=>{const f=ko(Bi(l,new Wt(c)),d);r=r.updateImmediateChild(c,f)}),fN(l).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}else{const l=Bi(t.visibleWrites,e);return fN(l).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}}function q1(t,e,n,r,i){Be(r||i,"Either existingEventSnap or existingServerSnap must exist");const l=mn(e,n);if(Bp(t.visibleWrites,l))return null;{const c=Bi(t.visibleWrites,l);return Gp(c)?i.getChild(n):ko(c,i.getChild(n))}}function W1(t,e,n,r){const i=mn(e,n),l=Aa(t.visibleWrites,i);if(l!=null)return l;if(r.isCompleteForChild(n)){const c=Bi(t.visibleWrites,i);return ko(c,r.getNode().getImmediateChild(n))}else return null}function $1(t,e){return Aa(t.visibleWrites,e)}function K1(t,e,n,r,i,l,c){let d;const f=Bi(t.visibleWrites,e),h=Aa(f,Dt());if(h!=null)d=h;else if(n!=null)d=ko(f,n);else return[];if(d=d.withIndex(c),!d.isEmpty()&&!d.isLeafNode()){const m=[],x=c.getCompare(),g=l?d.getReverseIteratorFrom(r,c):d.getIteratorFrom(r,c);let N=g.getNext();for(;N&&m.length<i;)x(N,r)!==0&&m.push(N),N=g.getNext();return m}else return[]}function Y1(){return{visibleWrites:Ks.empty(),allWrites:[],lastWriteId:-1}}function Hu(t,e,n,r){return oT(t.writeTree,t.treePath,e,n,r)}function Kg(t,e){return V1(t.writeTree,t.treePath,e)}function mN(t,e,n,r){return q1(t.writeTree,t.treePath,e,n,r)}function Vu(t,e){return $1(t.writeTree,mn(t.treePath,e))}function J1(t,e,n,r,i,l){return K1(t.writeTree,t.treePath,e,n,r,i,l)}function Yg(t,e,n){return W1(t.writeTree,t.treePath,e,n)}function lT(t,e){return cT(mn(t.treePath,e),t.writeTree)}function cT(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;Be(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),Be(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const l=i.type;if(n==="child_added"&&l==="child_removed")this.changeMap.set(r,Nc(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&l==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&l==="child_changed")this.changeMap.set(r,bc(r,i.oldSnap));else if(n==="child_changed"&&l==="child_added")this.changeMap.set(r,jo(r,e.snapshotNode));else if(n==="child_changed"&&l==="child_changed")this.changeMap.set(r,Nc(r,e.snapshotNode,i.oldSnap));else throw Lo("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const dT=new Q1;class Jg{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Hi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Yg(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ca(this.viewCache_),l=J1(this.writes_,i,n,1,r,e);return l.length===0?null:l[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z1(t){return{filter:t}}function eM(t,e){Be(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Be(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function tM(t,e,n,r,i){const l=new X1;let c,d;if(n.type===Ws.OVERWRITE){const h=n;h.source.fromUser?c=zp(t,e,h.path,h.snap,r,i,l):(Be(h.source.fromServer,"Unknown source."),d=h.source.tagged||e.serverCache.isFiltered()&&!Nt(h.path),c=qu(t,e,h.path,h.snap,r,i,d,l))}else if(n.type===Ws.MERGE){const h=n;h.source.fromUser?c=sM(t,e,h.path,h.children,r,i,l):(Be(h.source.fromServer,"Unknown source."),d=h.source.tagged||e.serverCache.isFiltered(),c=Hp(t,e,h.path,h.children,r,i,d,l))}else if(n.type===Ws.ACK_USER_WRITE){const h=n;h.revert?c=aM(t,e,h.path,r,i,l):c=rM(t,e,h.path,h.affectedTree,r,i,l)}else if(n.type===Ws.LISTEN_COMPLETE)c=iM(t,e,n.path,r,l);else throw Lo("Unknown operation type: "+n.type);const f=l.getChanges();return nM(e,c,f),{viewCache:c,changes:f}}function nM(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),l=zu(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(l)||!r.getNode().getPriority().equals(l.getPriority()))&&n.push(nT(zu(e)))}}function uT(t,e,n,r,i,l){const c=e.eventCache;if(Vu(r,n)!=null)return e;{let d,f;if(Nt(n))if(Be(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=Ca(e),m=h instanceof it?h:it.EMPTY_NODE,x=Kg(r,m);d=t.filter.updateFullNode(e.eventCache.getNode(),x,l)}else{const h=Hu(r,Ca(e));d=t.filter.updateFullNode(e.eventCache.getNode(),h,l)}else{const h=yt(n);if(h===".priority"){Be(zi(n)===1,"Can't have a priority with additional path components");const m=c.getNode();f=e.serverCache.getNode();const x=mN(r,n,m,f);x!=null?d=t.filter.updatePriority(m,x):d=c.getNode()}else{const m=Xt(n);let x;if(c.isCompleteForChild(h)){f=e.serverCache.getNode();const g=mN(r,n,c.getNode(),f);g!=null?x=c.getNode().getImmediateChild(h).updateChild(m,g):x=c.getNode().getImmediateChild(h)}else x=Yg(r,h,e.serverCache);x!=null?d=t.filter.updateChild(c.getNode(),h,x,m,i,l):d=c.getNode()}}return lc(e,d,c.isFullyInitialized()||Nt(n),t.filter.filtersNodes())}}function qu(t,e,n,r,i,l,c,d){const f=e.serverCache;let h;const m=c?t.filter:t.filter.getIndexedFilter();if(Nt(n))h=m.updateFullNode(f.getNode(),r,null);else if(m.filtersNodes()&&!f.isFiltered()){const N=f.getNode().updateChild(n,r);h=m.updateFullNode(f.getNode(),N,null)}else{const N=yt(n);if(!f.isCompleteForPath(n)&&zi(n)>1)return e;const T=Xt(n),w=f.getNode().getImmediateChild(N).updateChild(T,r);N===".priority"?h=m.updatePriority(f.getNode(),w):h=m.updateChild(f.getNode(),N,w,T,dT,null)}const x=rT(e,h,f.isFullyInitialized()||Nt(n),m.filtersNodes()),g=new Jg(i,x,l);return uT(t,x,n,i,g,d)}function zp(t,e,n,r,i,l,c){const d=e.eventCache;let f,h;const m=new Jg(i,e,l);if(Nt(n))h=t.filter.updateFullNode(e.eventCache.getNode(),r,c),f=lc(e,h,!0,t.filter.filtersNodes());else{const x=yt(n);if(x===".priority")h=t.filter.updatePriority(e.eventCache.getNode(),r),f=lc(e,h,d.isFullyInitialized(),d.isFiltered());else{const g=Xt(n),N=d.getNode().getImmediateChild(x);let T;if(Nt(g))T=r;else{const C=m.getCompleteChild(x);C!=null?Ug(g)===".priority"&&C.getChild(Yw(g)).isEmpty()?T=C:T=C.updateChild(g,r):T=it.EMPTY_NODE}if(N.equals(T))f=e;else{const C=t.filter.updateChild(d.getNode(),x,T,g,m,c);f=lc(e,C,d.isFullyInitialized(),t.filter.filtersNodes())}}}return f}function pN(t,e){return t.eventCache.isCompleteForChild(e)}function sM(t,e,n,r,i,l,c){let d=e;return r.foreach((f,h)=>{const m=mn(n,f);pN(e,yt(m))&&(d=zp(t,d,m,h,i,l,c))}),r.foreach((f,h)=>{const m=mn(n,f);pN(e,yt(m))||(d=zp(t,d,m,h,i,l,c))}),d}function gN(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Hp(t,e,n,r,i,l,c,d){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let f=e,h;Nt(n)?h=r:h=new Yt(null).setTree(n,r);const m=e.serverCache.getNode();return h.children.inorderTraversal((x,g)=>{if(m.hasChild(x)){const N=e.serverCache.getNode().getImmediateChild(x),T=gN(t,N,g);f=qu(t,f,new Wt(x),T,i,l,c,d)}}),h.children.inorderTraversal((x,g)=>{const N=!e.serverCache.isCompleteForChild(x)&&g.value===null;if(!m.hasChild(x)&&!N){const T=e.serverCache.getNode().getImmediateChild(x),C=gN(t,T,g);f=qu(t,f,new Wt(x),C,i,l,c,d)}}),f}function rM(t,e,n,r,i,l,c){if(Vu(i,n)!=null)return e;const d=e.serverCache.isFiltered(),f=e.serverCache;if(r.value!=null){if(Nt(n)&&f.isFullyInitialized()||f.isCompleteForPath(n))return qu(t,e,n,f.getNode().getChild(n),i,l,d,c);if(Nt(n)){let h=new Yt(null);return f.getNode().forEachChild(bo,(m,x)=>{h=h.set(new Wt(m),x)}),Hp(t,e,n,h,i,l,d,c)}else return e}else{let h=new Yt(null);return r.foreach((m,x)=>{const g=mn(n,m);f.isCompleteForPath(g)&&(h=h.set(m,f.getNode().getChild(g)))}),Hp(t,e,n,h,i,l,d,c)}}function iM(t,e,n,r,i){const l=e.serverCache,c=rT(e,l.getNode(),l.isFullyInitialized()||Nt(n),l.isFiltered());return uT(t,c,n,r,dT,i)}function aM(t,e,n,r,i,l){let c;if(Vu(r,n)!=null)return e;{const d=new Jg(r,e,i),f=e.eventCache.getNode();let h;if(Nt(n)||yt(n)===".priority"){let m;if(e.serverCache.isFullyInitialized())m=Hu(r,Ca(e));else{const x=e.serverCache.getNode();Be(x instanceof it,"serverChildren would be complete if leaf node"),m=Kg(r,x)}m=m,h=t.filter.updateFullNode(f,m,l)}else{const m=yt(n);let x=Yg(r,m,e.serverCache);x==null&&e.serverCache.isCompleteForChild(m)&&(x=f.getImmediateChild(m)),x!=null?h=t.filter.updateChild(f,m,x,Xt(n),d,l):e.eventCache.getNode().hasChild(m)?h=t.filter.updateChild(f,m,it.EMPTY_NODE,Xt(n),d,l):h=f,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(c=Hu(r,Ca(e)),c.isLeafNode()&&(h=t.filter.updateFullNode(h,c,l)))}return c=e.serverCache.isFullyInitialized()||Vu(r,Dt())!=null,lc(e,h,c,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Hg(r.getIndex()),l=T1(r);this.processor_=Z1(l);const c=n.serverCache,d=n.eventCache,f=i.updateFullNode(it.EMPTY_NODE,c.getNode(),null),h=l.updateFullNode(it.EMPTY_NODE,d.getNode(),null),m=new Hi(f,c.isFullyInitialized(),i.filtersNodes()),x=new Hi(h,d.isFullyInitialized(),l.filtersNodes());this.viewCache_=mh(x,m),this.eventGenerator_=new D1(this.query_)}get query(){return this.query_}}function lM(t){return t.viewCache_.serverCache.getNode()}function cM(t){return zu(t.viewCache_)}function dM(t,e){const n=Ca(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Nt(e)&&!n.getImmediateChild(yt(e)).isEmpty())?n.getChild(e):null}function yN(t){return t.eventRegistrations_.length===0}function uM(t,e){t.eventRegistrations_.push(e)}function xN(t,e,n){const r=[];if(n){Be(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(l=>{const c=l.createCancelEvent(n,i);c&&r.push(c)})}if(e){let i=[];for(let l=0;l<t.eventRegistrations_.length;++l){const c=t.eventRegistrations_[l];if(!c.matches(e))i.push(c);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(l+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function vN(t,e,n,r){e.type===Ws.MERGE&&e.source.queryId!==null&&(Be(Ca(t.viewCache_),"We should always have a full cache before handling merges"),Be(zu(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,l=tM(t.processor_,i,e,n,r);return eM(t.processor_,l.viewCache),Be(l.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=l.viewCache,hT(t,l.changes,l.viewCache.eventCache.getNode(),null)}function hM(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(pn,(l,c)=>{r.push(jo(l,c))}),n.isFullyInitialized()&&r.push(nT(n.getNode())),hT(t,r,n.getNode(),e)}function hT(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return R1(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wu;class fT{constructor(){this.views=new Map}}function fM(t){Be(!Wu,"__referenceConstructor has already been defined"),Wu=t}function mM(){return Be(Wu,"Reference.ts has not been loaded"),Wu}function pM(t){return t.views.size===0}function Xg(t,e,n,r){const i=e.source.queryId;if(i!==null){const l=t.views.get(i);return Be(l!=null,"SyncTree gave us an op for an invalid query."),vN(l,e,n,r)}else{let l=[];for(const c of t.views.values())l=l.concat(vN(c,e,n,r));return l}}function mT(t,e,n,r,i){const l=e._queryIdentifier,c=t.views.get(l);if(!c){let d=Hu(n,i?r:null),f=!1;d?f=!0:r instanceof it?(d=Kg(n,r),f=!1):(d=it.EMPTY_NODE,f=!1);const h=mh(new Hi(d,f,!1),new Hi(r,i,!1));return new oM(e,h)}return c}function gM(t,e,n,r,i,l){const c=mT(t,e,r,i,l);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,c),uM(c,n),hM(c,n)}function yM(t,e,n,r){const i=e._queryIdentifier,l=[];let c=[];const d=Vi(t);if(i==="default")for(const[f,h]of t.views.entries())c=c.concat(xN(h,n,r)),yN(h)&&(t.views.delete(f),h.query._queryParams.loadsAllData()||l.push(h.query));else{const f=t.views.get(i);f&&(c=c.concat(xN(f,n,r)),yN(f)&&(t.views.delete(i),f.query._queryParams.loadsAllData()||l.push(f.query)))}return d&&!Vi(t)&&l.push(new(mM())(e._repo,e._path)),{removed:l,events:c}}function pT(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Gi(t,e){let n=null;for(const r of t.views.values())n=n||dM(r,e);return n}function gT(t,e){if(e._queryParams.loadsAllData())return gh(t);{const r=e._queryIdentifier;return t.views.get(r)}}function yT(t,e){return gT(t,e)!=null}function Vi(t){return gh(t)!=null}function gh(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $u;function xM(t){Be(!$u,"__referenceConstructor has already been defined"),$u=t}function vM(){return Be($u,"Reference.ts has not been loaded"),$u}let bM=1;class bN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Yt(null),this.pendingWriteTree_=Y1(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function xT(t,e,n,r,i){return L1(t.pendingWriteTree_,e,n,r,i),i?zo(t,new Ta(qg(),e,n)):[]}function NM(t,e,n,r){F1(t.pendingWriteTree_,e,n,r);const i=Yt.fromObject(n);return zo(t,new Ao(qg(),e,i))}function Oi(t,e,n=!1){const r=U1(t.pendingWriteTree_,e);if(B1(t.pendingWriteTree_,e)){let l=new Yt(null);return r.snap!=null?l=l.set(Dt(),!0):Wn(r.children,c=>{l=l.set(new Wt(c),!0)}),zo(t,new Gu(r.path,l,n))}else return[]}function Pc(t,e,n){return zo(t,new Ta(Wg(),e,n))}function SM(t,e,n){const r=Yt.fromObject(n);return zo(t,new Ao(Wg(),e,r))}function _M(t,e){return zo(t,new _c(Wg(),e))}function wM(t,e,n){const r=Zg(t,n);if(r){const i=ey(r),l=i.path,c=i.queryId,d=es(l,e),f=new _c($g(c),d);return ty(t,l,f)}else return[]}function Ku(t,e,n,r,i=!1){const l=e._path,c=t.syncPointTree_.get(l);let d=[];if(c&&(e._queryIdentifier==="default"||yT(c,e))){const f=yM(c,e,n,r);pM(c)&&(t.syncPointTree_=t.syncPointTree_.remove(l));const h=f.removed;if(d=f.events,!i){const m=h.findIndex(g=>g._queryParams.loadsAllData())!==-1,x=t.syncPointTree_.findOnPath(l,(g,N)=>Vi(N));if(m&&!x){const g=t.syncPointTree_.subtree(l);if(!g.isEmpty()){const N=EM(g);for(let T=0;T<N.length;++T){const C=N[T],w=C.query,E=ST(t,C);t.listenProvider_.startListening(dc(w),wc(t,w),E.hashFn,E.onComplete)}}}!x&&h.length>0&&!r&&(m?t.listenProvider_.stopListening(dc(e),null):h.forEach(g=>{const N=t.queryToTagMap.get(yh(g));t.listenProvider_.stopListening(dc(g),N)}))}IM(t,h)}return d}function vT(t,e,n,r){const i=Zg(t,r);if(i!=null){const l=ey(i),c=l.path,d=l.queryId,f=es(c,e),h=new Ta($g(d),f,n);return ty(t,c,h)}else return[]}function TM(t,e,n,r){const i=Zg(t,r);if(i){const l=ey(i),c=l.path,d=l.queryId,f=es(c,e),h=Yt.fromObject(n),m=new Ao($g(d),f,h);return ty(t,c,m)}else return[]}function Vp(t,e,n,r=!1){const i=e._path;let l=null,c=!1;t.syncPointTree_.foreachOnPath(i,(g,N)=>{const T=es(g,i);l=l||Gi(N,T),c=c||Vi(N)});let d=t.syncPointTree_.get(i);d?(c=c||Vi(d),l=l||Gi(d,Dt())):(d=new fT,t.syncPointTree_=t.syncPointTree_.set(i,d));let f;l!=null?f=!0:(f=!1,l=it.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((N,T)=>{const C=Gi(T,Dt());C&&(l=l.updateImmediateChild(N,C))}));const h=yT(d,e);if(!h&&!e._queryParams.loadsAllData()){const g=yh(e);Be(!t.queryToTagMap.has(g),"View does not exist, but we have a tag");const N=jM();t.queryToTagMap.set(g,N),t.tagToQueryMap.set(N,g)}const m=ph(t.pendingWriteTree_,i);let x=gM(d,e,n,m,l,f);if(!h&&!c&&!r){const g=gT(d,e);x=x.concat(AM(t,e,g))}return x}function Qg(t,e,n){const i=t.pendingWriteTree_,l=t.syncPointTree_.findOnPath(e,(c,d)=>{const f=es(c,e),h=Gi(d,f);if(h)return h});return oT(i,e,l,n,!0)}function CM(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(h,m)=>{const x=es(h,n);r=r||Gi(m,x)});let i=t.syncPointTree_.get(n);i?r=r||Gi(i,Dt()):(i=new fT,t.syncPointTree_=t.syncPointTree_.set(n,i));const l=r!=null,c=l?new Hi(r,!0,!1):null,d=ph(t.pendingWriteTree_,e._path),f=mT(i,e,d,l?c.getNode():it.EMPTY_NODE,l);return cM(f)}function zo(t,e){return bT(e,t.syncPointTree_,null,ph(t.pendingWriteTree_,Dt()))}function bT(t,e,n,r){if(Nt(t.path))return NT(t,e,n,r);{const i=e.get(Dt());n==null&&i!=null&&(n=Gi(i,Dt()));let l=[];const c=yt(t.path),d=t.operationForChild(c),f=e.children.get(c);if(f&&d){const h=n?n.getImmediateChild(c):null,m=lT(r,c);l=l.concat(bT(d,f,h,m))}return i&&(l=l.concat(Xg(i,t,r,n))),l}}function NT(t,e,n,r){const i=e.get(Dt());n==null&&i!=null&&(n=Gi(i,Dt()));let l=[];return e.children.inorderTraversal((c,d)=>{const f=n?n.getImmediateChild(c):null,h=lT(r,c),m=t.operationForChild(c);m&&(l=l.concat(NT(m,d,f,h)))}),i&&(l=l.concat(Xg(i,t,r,n))),l}function ST(t,e){const n=e.query,r=wc(t,n);return{hashFn:()=>(lM(e)||it.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?wM(t,n._path,r):_M(t,n._path);{const l=_R(i,n);return Ku(t,n,null,l)}}}}function wc(t,e){const n=yh(e);return t.queryToTagMap.get(n)}function yh(t){return t._path.toString()+"$"+t._queryIdentifier}function Zg(t,e){return t.tagToQueryMap.get(e)}function ey(t){const e=t.indexOf("$");return Be(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Wt(t.substr(0,e))}}function ty(t,e,n){const r=t.syncPointTree_.get(e);Be(r,"Missing sync point for query tag that we're tracking");const i=ph(t.pendingWriteTree_,e);return Xg(r,n,i,null)}function EM(t){return t.fold((e,n,r)=>{if(n&&Vi(n))return[gh(n)];{let i=[];return n&&(i=pT(n)),Wn(r,(l,c)=>{i=i.concat(c)}),i}})}function dc(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(vM())(t._repo,t._path):t}function IM(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const i=yh(r),l=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(l)}}}function jM(){return bM++}function AM(t,e,n){const r=e._path,i=wc(t,e),l=ST(t,n),c=t.listenProvider_.startListening(dc(e),i,l.hashFn,l.onComplete),d=t.syncPointTree_.subtree(r);if(i)Be(!Vi(d.value),"If we're adding a query, it shouldn't be shadowed");else{const f=d.fold((h,m,x)=>{if(!Nt(h)&&m&&Vi(m))return[gh(m).query];{let g=[];return m&&(g=g.concat(pT(m).map(N=>N.query))),Wn(x,(N,T)=>{g=g.concat(T)}),g}});for(let h=0;h<f.length;++h){const m=f[h];t.listenProvider_.stopListening(dc(m),wc(t,m))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new ny(n)}node(){return this.node_}}class sy{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=mn(this.path_,e);return new sy(this.syncTree_,n)}node(){return Qg(this.syncTree_,this.path_)}}const kM=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},NN=function(t,e,n){if(!t||typeof t!="object")return t;if(Be(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return DM(t[".sv"],e,n);if(typeof t[".sv"]=="object")return RM(t[".sv"],e);Be(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},DM=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Be(!1,"Unexpected server value: "+t)}},RM=function(t,e,n){t.hasOwnProperty("increment")||Be(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&Be(!1,"Unexpected increment value: "+r);const i=e.node();if(Be(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const c=i.getValue();return typeof c!="number"?r:c+r},_T=function(t,e,n,r){return ry(e,new sy(n,t),r)},wT=function(t,e,n){return ry(t,new ny(e),n)};function ry(t,e,n){const r=t.getPriority().val(),i=NN(r,e.getImmediateChild(".priority"),n);let l;if(t.isLeafNode()){const c=t,d=NN(c.getValue(),e,n);return d!==c.getValue()||i!==c.getPriority().val()?new Rn(d,In(i)):t}else{const c=t;return l=c,i!==c.getPriority().val()&&(l=l.updatePriority(new Rn(i))),c.forEachChild(pn,(d,f)=>{const h=ry(f,e.getImmediateChild(d),n);h!==f&&(l=l.updateImmediateChild(d,h))}),l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function ay(t,e){let n=e instanceof Wt?e:new Wt(e),r=t,i=yt(n);for(;i!==null;){const l=Co(r.node.children,i)||{children:{},childCount:0};r=new iy(i,r,l),n=Xt(n),i=yt(n)}return r}function Ho(t){return t.node.value}function TT(t,e){t.node.value=e,qp(t)}function CT(t){return t.node.childCount>0}function MM(t){return Ho(t)===void 0&&!CT(t)}function xh(t,e){Wn(t.node.children,(n,r)=>{e(new iy(n,t,r))})}function ET(t,e,n,r){n&&e(t),xh(t,i=>{ET(i,e,!0)})}function PM(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Oc(t){return new Wt(t.parent===null?t.name:Oc(t.parent)+"/"+t.name)}function qp(t){t.parent!==null&&OM(t.parent,t.name,t)}function OM(t,e,n){const r=MM(n),i=pr(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,qp(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,qp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=/[\[\].#$\/\u0000-\u001F\u007F]/,FM=/[\[\].#$\u0000-\u001F\u007F]/,dp=10*1024*1024,oy=function(t){return typeof t=="string"&&t.length!==0&&!LM.test(t)},IT=function(t){return typeof t=="string"&&t.length!==0&&!FM.test(t)},UM=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),IT(t)},BM=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Mg(t)||t&&typeof t=="object"&&pr(t,".sv")},GM=function(t,e,n,r){vh(uh(t,"value"),e,n)},vh=function(t,e,n){const r=n instanceof Wt?new s1(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+xa(r));if(typeof e=="function")throw new Error(t+"contains a function "+xa(r)+" with contents = "+e.toString());if(Mg(e))throw new Error(t+"contains "+e.toString()+" "+xa(r));if(typeof e=="string"&&e.length>dp/3&&hh(e)>dp)throw new Error(t+"contains a string greater than "+dp+" utf8 bytes "+xa(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,l=!1;if(Wn(e,(c,d)=>{if(c===".value")i=!0;else if(c!==".priority"&&c!==".sv"&&(l=!0,!oy(c)))throw new Error(t+" contains an invalid key ("+c+") "+xa(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);r1(r,c),vh(t,d,r),i1(r)}),i&&l)throw new Error(t+' contains ".value" child '+xa(r)+" in addition to actual children.")}},zM=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const l=vc(r);for(let c=0;c<l.length;c++)if(!(l[c]===".priority"&&c===l.length-1)){if(!oy(l[c]))throw new Error(t+"contains an invalid key ("+l[c]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(n1);let i=null;for(n=0;n<e.length;n++){if(r=e[n],i!==null&&Os(i,r))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},HM=function(t,e,n,r){const i=uh(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const l=[];Wn(e,(c,d)=>{const f=new Wt(c);if(vh(i,d,mn(n,f)),Ug(f)===".priority"&&!BM(d))throw new Error(i+"contains an invalid value for '"+f.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");l.push(f)}),zM(i,l)},jT=function(t,e,n,r){if(!IT(n))throw new Error(uh(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},VM=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),jT(t,e,n)},AT=function(t,e){if(yt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},qM=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!oy(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!UM(n))throw new Error(uh(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function bh(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],l=i.getPath();n!==null&&!Bg(l,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:l}),n.events.push(i)}n&&t.eventLists_.push(n)}function kT(t,e,n){bh(t,n),DT(t,r=>Bg(r,e))}function Fs(t,e,n){bh(t,n),DT(t,r=>Os(r,e)||Os(e,r))}function DT(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const l=i.path;e(l)?($M(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function $M(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();ac&&qn("event: "+n.toString()),Go(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KM="repo_interrupt",YM=25;class JM{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new WM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Bu(),this.transactionQueueTree_=new iy,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function XM(t,e,n){if(t.stats_=Lg(t.repoInfo_),t.forceRestClient_||ER())t.server_=new Uu(t.repoInfo_,(r,i,l,c)=>{SN(t,r,i,l,c)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>_N(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{jn(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Hr(t.repoInfo_,e,(r,i,l,c)=>{SN(t,r,i,l,c)},r=>{_N(t,r)},r=>{ZM(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=DR(t.repoInfo_,()=>new k1(t.stats_,t.server_)),t.infoData_=new C1,t.infoSyncTree_=new bN({startListening:(r,i,l,c)=>{let d=[];const f=t.infoData_.getNode(r._path);return f.isEmpty()||(d=Pc(t.infoSyncTree_,r._path,f),setTimeout(()=>{c("ok")},0)),d},stopListening:()=>{}}),ly(t,"connected",!1),t.serverSyncTree_=new bN({startListening:(r,i,l,c)=>(t.server_.listen(r,l,i,(d,f)=>{const h=c(d,f);Fs(t.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function QM(t){const n=t.infoData_.getNode(new Wt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Nh(t){return kM({timestamp:QM(t)})}function SN(t,e,n,r,i){t.dataUpdateCount++;const l=new Wt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let c=[];if(i)if(r){const f=Mu(n,h=>In(h));c=TM(t.serverSyncTree_,l,f,i)}else{const f=In(n);c=vT(t.serverSyncTree_,l,f,i)}else if(r){const f=Mu(n,h=>In(h));c=SM(t.serverSyncTree_,l,f)}else{const f=In(n);c=Pc(t.serverSyncTree_,l,f)}let d=l;c.length>0&&(d=Do(t,l)),Fs(t.eventQueue_,d,c)}function _N(t,e){ly(t,"connected",e),e===!1&&sP(t)}function ZM(t,e){Wn(e,(n,r)=>{ly(t,n,r)})}function ly(t,e,n){const r=new Wt("/.info/"+e),i=In(n);t.infoData_.updateSnapshot(r,i);const l=Pc(t.infoSyncTree_,r,i);Fs(t.eventQueue_,r,l)}function cy(t){return t.nextWriteId_++}function eP(t,e,n){const r=CM(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(i=>{const l=In(i).withIndex(e._queryParams.getIndex());Vp(t.serverSyncTree_,e,n,!0);let c;if(e._queryParams.loadsAllData())c=Pc(t.serverSyncTree_,e._path,l);else{const d=wc(t.serverSyncTree_,e);c=vT(t.serverSyncTree_,e._path,l,d)}return Fs(t.eventQueue_,e._path,c),Ku(t.serverSyncTree_,e,n,null,!0),l},i=>(Lc(t,"get for query "+jn(e)+" failed: "+i),Promise.reject(new Error(i))))}function tP(t,e,n,r,i){Lc(t,"set",{path:e.toString(),value:n,priority:r});const l=Nh(t),c=In(n,r),d=Qg(t.serverSyncTree_,e),f=wT(c,d,l),h=cy(t),m=xT(t.serverSyncTree_,e,f,h,!0);bh(t.eventQueue_,m),t.server_.put(e.toString(),c.val(!0),(g,N)=>{const T=g==="ok";T||ts("set at "+e+" failed: "+g);const C=Oi(t.serverSyncTree_,h,!T);Fs(t.eventQueue_,e,C),Wp(t,i,g,N)});const x=uy(t,e);Do(t,x),Fs(t.eventQueue_,x,[])}function nP(t,e,n,r){Lc(t,"update",{path:e.toString(),value:n});let i=!0;const l=Nh(t),c={};if(Wn(n,(d,f)=>{i=!1,c[d]=_T(mn(e,d),In(f),t.serverSyncTree_,l)}),i)qn("update() called with empty data.  Don't do anything."),Wp(t,r,"ok",void 0);else{const d=cy(t),f=NM(t.serverSyncTree_,e,c,d);bh(t.eventQueue_,f),t.server_.merge(e.toString(),n,(h,m)=>{const x=h==="ok";x||ts("update at "+e+" failed: "+h);const g=Oi(t.serverSyncTree_,d,!x),N=g.length>0?Do(t,e):e;Fs(t.eventQueue_,N,g),Wp(t,r,h,m)}),Wn(n,h=>{const m=uy(t,mn(e,h));Do(t,m)}),Fs(t.eventQueue_,e,[])}}function sP(t){Lc(t,"onDisconnectEvents");const e=Nh(t),n=Bu();Fp(t.onDisconnect_,Dt(),(i,l)=>{const c=_T(i,l,t.serverSyncTree_,e);sT(n,i,c)});let r=[];Fp(n,Dt(),(i,l)=>{r=r.concat(Pc(t.serverSyncTree_,i,l));const c=uy(t,i);Do(t,c)}),t.onDisconnect_=Bu(),Fs(t.eventQueue_,Dt(),r)}function rP(t,e,n){let r;yt(e._path)===".info"?r=Vp(t.infoSyncTree_,e,n):r=Vp(t.serverSyncTree_,e,n),kT(t.eventQueue_,e._path,r)}function RT(t,e,n){let r;yt(e._path)===".info"?r=Ku(t.infoSyncTree_,e,n):r=Ku(t.serverSyncTree_,e,n),kT(t.eventQueue_,e._path,r)}function iP(t){t.persistentConnection_&&t.persistentConnection_.interrupt(KM)}function Lc(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),qn(n,...e)}function Wp(t,e,n,r){e&&Go(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let l=i;r&&(l+=": "+r);const c=new Error(l);c.code=i,e(c)}})}function MT(t,e,n){return Qg(t.serverSyncTree_,e,n)||it.EMPTY_NODE}function dy(t,e=t.transactionQueueTree_){if(e||Sh(t,e),Ho(e)){const n=OT(t,e);Be(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&aP(t,Oc(e),n)}else CT(e)&&xh(e,n=>{dy(t,n)})}function aP(t,e,n){const r=n.map(h=>h.currentWriteId),i=MT(t,e,r);let l=i;const c=i.hash();for(let h=0;h<n.length;h++){const m=n[h];Be(m.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),m.status=1,m.retryCount++;const x=es(e,m.path);l=l.updateChild(x,m.currentOutputSnapshotRaw)}const d=l.val(!0),f=e;t.server_.put(f.toString(),d,h=>{Lc(t,"transaction put response",{path:f.toString(),status:h});let m=[];if(h==="ok"){const x=[];for(let g=0;g<n.length;g++)n[g].status=2,m=m.concat(Oi(t.serverSyncTree_,n[g].currentWriteId)),n[g].onComplete&&x.push(()=>n[g].onComplete(null,!0,n[g].currentOutputSnapshotResolved)),n[g].unwatcher();Sh(t,ay(t.transactionQueueTree_,e)),dy(t,t.transactionQueueTree_),Fs(t.eventQueue_,e,m);for(let g=0;g<x.length;g++)Go(x[g])}else{if(h==="datastale")for(let x=0;x<n.length;x++)n[x].status===3?n[x].status=4:n[x].status=0;else{ts("transaction at "+f.toString()+" failed: "+h);for(let x=0;x<n.length;x++)n[x].status=4,n[x].abortReason=h}Do(t,e)}},c)}function Do(t,e){const n=PT(t,e),r=Oc(n),i=OT(t,n);return oP(t,i,r),r}function oP(t,e,n){if(e.length===0)return;const r=[];let i=[];const c=e.filter(d=>d.status===0).map(d=>d.currentWriteId);for(let d=0;d<e.length;d++){const f=e[d],h=es(n,f.path);let m=!1,x;if(Be(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),f.status===4)m=!0,x=f.abortReason,i=i.concat(Oi(t.serverSyncTree_,f.currentWriteId,!0));else if(f.status===0)if(f.retryCount>=YM)m=!0,x="maxretry",i=i.concat(Oi(t.serverSyncTree_,f.currentWriteId,!0));else{const g=MT(t,f.path,c);f.currentInputSnapshot=g;const N=e[d].update(g.val());if(N!==void 0){vh("transaction failed: Data returned ",N,f.path);let T=In(N);typeof N=="object"&&N!=null&&pr(N,".priority")||(T=T.updatePriority(g.getPriority()));const w=f.currentWriteId,E=Nh(t),D=wT(T,g,E);f.currentOutputSnapshotRaw=T,f.currentOutputSnapshotResolved=D,f.currentWriteId=cy(t),c.splice(c.indexOf(w),1),i=i.concat(xT(t.serverSyncTree_,f.path,D,f.currentWriteId,f.applyLocally)),i=i.concat(Oi(t.serverSyncTree_,w,!0))}else m=!0,x="nodata",i=i.concat(Oi(t.serverSyncTree_,f.currentWriteId,!0))}Fs(t.eventQueue_,n,i),i=[],m&&(e[d].status=2,(function(g){setTimeout(g,Math.floor(0))})(e[d].unwatcher),e[d].onComplete&&(x==="nodata"?r.push(()=>e[d].onComplete(null,!1,e[d].currentInputSnapshot)):r.push(()=>e[d].onComplete(new Error(x),!1,null))))}Sh(t,t.transactionQueueTree_);for(let d=0;d<r.length;d++)Go(r[d]);dy(t,t.transactionQueueTree_)}function PT(t,e){let n,r=t.transactionQueueTree_;for(n=yt(e);n!==null&&Ho(r)===void 0;)r=ay(r,n),e=Xt(e),n=yt(e);return r}function OT(t,e){const n=[];return LT(t,e,n),n.sort((r,i)=>r.order-i.order),n}function LT(t,e,n){const r=Ho(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);xh(e,i=>{LT(t,i,n)})}function Sh(t,e){const n=Ho(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,TT(e,n.length>0?n:void 0)}xh(e,r=>{Sh(t,r)})}function uy(t,e){const n=Oc(PT(t,e)),r=ay(t.transactionQueueTree_,e);return PM(r,i=>{up(t,i)}),up(t,r),ET(r,i=>{up(t,i)}),n}function up(t,e){const n=Ho(e);if(n){const r=[];let i=[],l=-1;for(let c=0;c<n.length;c++)n[c].status===3||(n[c].status===1?(Be(l===c-1,"All SENT items should be at beginning of queue."),l=c,n[c].status=3,n[c].abortReason="set"):(Be(n[c].status===0,"Unexpected transaction status in abort"),n[c].unwatcher(),i=i.concat(Oi(t.serverSyncTree_,n[c].currentWriteId,!0)),n[c].onComplete&&r.push(n[c].onComplete.bind(null,new Error("set"),!1,null))));l===-1?TT(e,void 0):n.length=l+1,Fs(t.eventQueue_,Oc(e),i);for(let c=0;c<r.length;c++)Go(r[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function cP(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ts(`Invalid query segment '${n}' in query '${t}'`)}return e}const wN=function(t,e){const n=dP(t),r=n.namespace;n.domain==="firebase.com"&&Wr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&Wr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||xR();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Bw(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new Wt(n.pathString)}},dP=function(t){let e="",n="",r="",i="",l="",c=!0,d="https",f=443;if(typeof t=="string"){let h=t.indexOf("//");h>=0&&(d=t.substring(0,h-1),t=t.substring(h+2));let m=t.indexOf("/");m===-1&&(m=t.length);let x=t.indexOf("?");x===-1&&(x=t.length),e=t.substring(0,Math.min(m,x)),m<x&&(i=lP(t.substring(m,x)));const g=cP(t.substring(Math.min(t.length,x)));h=e.indexOf(":"),h>=0?(c=d==="https"||d==="wss",f=parseInt(e.substring(h+1),10)):h=e.length;const N=e.slice(0,h);if(N.toLowerCase()==="localhost")n="localhost";else if(N.split(".").length<=2)n=N;else{const T=e.indexOf(".");r=e.substring(0,T).toLowerCase(),n=e.substring(T+1),l=r}"ns"in g&&(l=g.ns)}return{host:e,port:f,domain:n,subdomain:r,secure:c,scheme:d,pathString:i,namespace:l}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+jn(this.snapshot.exportVal())}}class hP{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FT{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return Be(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return Nt(this._path)?null:Ug(this._path)}get ref(){return new Jr(this._repo,this._path)}get _queryIdentifier(){const e=dN(this._queryParams),n=Pg(e);return n==="{}"?"default":n}get _queryObject(){return dN(this._queryParams)}isEqual(e){if(e=Gs(e),!(e instanceof hy))return!1;const n=this._repo===e._repo,r=Bg(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+t1(this._path)}}class Jr extends hy{constructor(e,n){super(e,n,new Vg,!1)}get parent(){const e=Yw(this._path);return e===null?null:new Jr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Tc{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Wt(e),r=$p(this.ref,e);return new Tc(this._node.getChild(n),r,pn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new Tc(i,$p(this.ref,r),pn)))}hasChild(e){const n=new Wt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ct(t,e){return t=Gs(t),t._checkNotDeleted("ref"),e!==void 0?$p(t._root,e):t._root}function $p(t,e){return t=Gs(t),yt(t._path)===null?VM("child","path",e):jT("child","path",e),new Jr(t._repo,mn(t._path,e))}function Xr(t){return AT("remove",t._path),Qr(t,null)}function Qr(t,e){t=Gs(t),AT("set",t._path),GM("set",e,t._path);const n=new Ac;return tP(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function $i(t,e){HM("update",e,t._path);const n=new Ac;return nP(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Ki(t){t=Gs(t);const e=new FT(()=>{}),n=new _h(e);return eP(t._repo,t,n).then(r=>new Tc(r,new Jr(t._repo,t._path),t._queryParams.getIndex()))}class _h{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new uP("value",this,new Tc(e.snapshotNode,new Jr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new hP(this,e,n):null}matches(e){return e instanceof _h?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function fP(t,e,n,r,i){const l=new FT(n,void 0),c=new _h(l);return rP(t._repo,t,c),()=>RT(t._repo,t,c)}function mP(t,e,n,r){return fP(t,"value",e)}function pP(t,e,n){RT(t._repo,t,null)}fM(Jr);xM(Jr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gP="FIREBASE_DATABASE_EMULATOR_HOST",Kp={};let yP=!1;function xP(t,e,n,r){const i=e.lastIndexOf(":"),l=e.substring(0,i),c=Fo(l);t.repoInfo_=new Bw(e,c,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function vP(t,e,n,r,i){let l=r||t.options.databaseURL;l===void 0&&(t.options.projectId||Wr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qn("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let c=wN(l,i),d=c.repoInfo,f;typeof process<"u"&&Wb&&(f=Wb[gP]),f?(l=`http://${f}?ns=${d.namespace}`,c=wN(l,i),d=c.repoInfo):c.repoInfo.secure;const h=new jR(t.name,t.options,e);qM("Invalid Firebase Database URL",c),Nt(c.path)||Wr("Database URL must point to the root of a Firebase Database (not including a child path).");const m=NP(d,t,h,new IR(t,n));return new SP(m,t)}function bP(t,e){const n=Kp[e];(!n||n[t.key]!==t)&&Wr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),iP(t),delete n[t.key]}function NP(t,e,n,r){let i=Kp[e.name];i||(i={},Kp[e.name]=i);let l=i[t.toURLString()];return l&&Wr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new JM(t,yP,n,r),i[t.toURLString()]=l,l}class SP{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(XM(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jr(this._repo,Dt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(bP(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Wr("Cannot call "+e+" on a deleted database.")}}function _P(t=_w(),e){const n=Rg(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=Ok("database");r&&wP(n,...r)}return n}function wP(t,e,n,r={}){t=Gs(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,l=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&Sa(r,l.repoInfo_.emulatorOptions))return;Wr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(l.repoInfo_.nodeAdmin)r.mockUserToken&&Wr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new Su(Su.OWNER);else if(r.mockUserToken){const d=typeof r.mockUserToken=="string"?r.mockUserToken:Lk(r.mockUserToken,t.app.options.projectId);c=new Su(d)}Fo(e)&&(gw(e),yw("Database",!0)),xP(l,i,r,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TP(t){hR(Bo),Eo(new _a("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),l=e.getProvider("app-check-internal");return vP(r,i,l,n)},"PUBLIC").setMultipleInstances(!0)),Ui($b,Kb,t),Ui($b,Kb,"esm2020")}Hr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Hr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};TP();function UT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const CP=UT,BT=new kc("auth","Firebase",UT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yu=new kg("@firebase/auth");function EP(t,...e){Yu.logLevel<=qt.WARN&&Yu.warn(`Auth (${Bo}): ${t}`,...e)}function _u(t,...e){Yu.logLevel<=qt.ERROR&&Yu.error(`Auth (${Bo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(t,...e){throw fy(t,...e)}function hr(t,...e){return fy(t,...e)}function GT(t,e,n){const r={...CP(),[e]:n};return new kc("auth","Firebase",r).create(e,{appName:t.name})}function Na(t){return GT(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return BT.create(t,...e)}function at(t,e,...n){if(!t)throw fy(e,...n)}function Ur(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _u(e),new Error(e)}function Kr(t,e){t||Ur(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function IP(){return TN()==="http:"||TN()==="https:"}function TN(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(IP()||Gk()||"connection"in navigator)?navigator.onLine:!0}function AP(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,n){this.shortDelay=e,this.longDelay=n,Kr(n>e,"Short delay should be less than long delay!"),this.isMobile=Ag()||xw()}get(){return jP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function my(t,e){Kr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ur("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ur("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ur("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],RP=new Fc(3e4,6e4);function py(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Vo(t,e,n,r,i={}){return HT(t,i,async()=>{let l={},c={};r&&(e==="GET"?c=r:l={body:JSON.stringify(r)});const d=Uo({key:t.config.apiKey,...c}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const h={method:e,headers:f,...l};return Bk()||(h.referrerPolicy="no-referrer"),t.emulatorConfig&&Fo(t.emulatorConfig.host)&&(h.credentials="include"),zT.fetch()(await VT(t,t.config.apiHost,n,d),h)})}async function HT(t,e,n){t._canInitEmulator=!1;const r={...kP,...e};try{const i=new PP(t),l=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw uu(t,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const d=l.ok?c.errorMessage:c.error.message,[f,h]=d.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw uu(t,"credential-already-in-use",c);if(f==="EMAIL_EXISTS")throw uu(t,"email-already-in-use",c);if(f==="USER_DISABLED")throw uu(t,"user-disabled",c);const m=r[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw GT(t,m,h);$r(t,m)}}catch(i){if(i instanceof Wi)throw i;$r(t,"network-request-failed",{message:String(i)})}}async function MP(t,e,n,r,i={}){const l=await Vo(t,e,n,r,i);return"mfaPendingCredential"in l&&$r(t,"multi-factor-auth-required",{_serverResponse:l}),l}async function VT(t,e,n,r){const i=`${e}${n}?${r}`,l=t,c=l.config.emulator?my(t.config,i):`${t.config.apiScheme}://${i}`;return DP.includes(n)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}class PP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(hr(this.auth,"network-request-failed")),RP.get())})}}function uu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=hr(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OP(t,e){return Vo(t,"POST","/v1/accounts:delete",e)}async function Ju(t,e){return Vo(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function LP(t,e=!1){const n=Gs(t),r=await n.getIdToken(e),i=gy(r);at(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,c=l==null?void 0:l.sign_in_provider;return{claims:i,token:r,authTime:uc(hp(i.auth_time)),issuedAtTime:uc(hp(i.iat)),expirationTime:uc(hp(i.exp)),signInProvider:c||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function hp(t){return Number(t)*1e3}function gy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return _u("JWT malformed, contained fewer than 3 sections"),null;try{const i=Ru(n);return i?JSON.parse(i):(_u("Failed to decode base64 JWT payload"),null)}catch(i){return _u("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function CN(t){const e=gy(t);return at(e,"internal-error"),at(typeof e.exp<"u","internal-error"),at(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Wi&&FP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function FP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=uc(this.lastLoginAt),this.creationTime=uc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xu(t){var x;const e=t.auth,n=await t.getIdToken(),r=await Cc(t,Ju(e,{idToken:n}));at(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const l=(x=i.providerUserInfo)!=null&&x.length?qT(i.providerUserInfo):[],c=GP(t.providerData,l),d=t.isAnonymous,f=!(t.email&&i.passwordHash)&&!(c!=null&&c.length),h=d?f:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Jp(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(t,m)}async function BP(t){const e=Gs(t);await Xu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GP(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function qT(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zP(t,e){const n=await HT(t,{},async()=>{const r=Uo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=t.config,c=await VT(t,i,"/v1/token",`key=${l}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:d,body:r};return t.emulatorConfig&&Fo(t.emulatorConfig.host)&&(f.credentials="include"),zT.fetch()(c,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function HP(t,e){return Vo(t,"POST","/v2/accounts:revokeToken",py(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){at(e.idToken,"internal-error"),at(typeof e.idToken<"u","internal-error"),at(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):CN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){at(e.length!==0,"internal-error");const n=CN(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(at(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:l}=await zP(e,n);this.updateTokensAndExpiration(r,i,Number(l))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:l}=n,c=new No;return r&&(at(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(at(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),l&&(at(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new No,this.toJSON())}_performRefresh(){return Ur("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(t,e){at(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class $s{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new UP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Jp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Cc(this,this.stsTokenManager.getToken(this.auth,e));return at(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return LP(this,e)}reload(){return BP(this)}_assign(e){this!==e&&(at(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new $s({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){at(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Xu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(Na(this.auth));const e=await this.getIdToken();return await Cc(this,OP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,l=n.phoneNumber??void 0,c=n.photoURL??void 0,d=n.tenantId??void 0,f=n._redirectEventId??void 0,h=n.createdAt??void 0,m=n.lastLoginAt??void 0,{uid:x,emailVerified:g,isAnonymous:N,providerData:T,stsTokenManager:C}=n;at(x&&C,e,"internal-error");const w=No.fromJSON(this.name,C);at(typeof x=="string",e,"internal-error"),ji(r,e.name),ji(i,e.name),at(typeof g=="boolean",e,"internal-error"),at(typeof N=="boolean",e,"internal-error"),ji(l,e.name),ji(c,e.name),ji(d,e.name),ji(f,e.name),ji(h,e.name),ji(m,e.name);const E=new $s({uid:x,auth:e,email:i,emailVerified:g,displayName:r,isAnonymous:N,photoURL:c,phoneNumber:l,tenantId:d,stsTokenManager:w,createdAt:h,lastLoginAt:m});return T&&Array.isArray(T)&&(E.providerData=T.map(D=>({...D}))),f&&(E._redirectEventId=f),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new No;i.updateFromServerResponse(n);const l=new $s({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Xu(l),l}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];at(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?qT(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!(l!=null&&l.length),d=new No;d.updateFromIdToken(r);const f=new $s({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:c}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Jp(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(l!=null&&l.length)};return Object.assign(f,h),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN=new Map;function Br(t){Kr(t instanceof Function,"Expected a class definition");let e=EN.get(t);return e?(Kr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,EN.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}WT.type="NONE";const IN=WT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(t,e,n){return`firebase:${t}:${e}:${n}`}class So{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:l}=this.auth;this.fullUserKey=wu(this.userKey,i.apiKey,l),this.fullPersistenceKey=wu("persistence",i.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Ju(this.auth,{idToken:e}).catch(()=>{});return n?$s._fromGetAccountInfoResponse(this.auth,n,e):null}return $s._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new So(Br(IN),e,r);const i=(await Promise.all(n.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let l=i[0]||Br(IN);const c=wu(r,e.config.apiKey,e.name);let d=null;for(const h of n)try{const m=await h._get(c);if(m){let x;if(typeof m=="string"){const g=await Ju(e,{idToken:m}).catch(()=>{});if(!g)break;x=await $s._fromGetAccountInfoResponse(e,g,m)}else x=$s._fromJSON(e,m);h!==l&&(d=x),l=h;break}}catch{}const f=i.filter(h=>h._shouldAllowMigration);return!l._shouldAllowMigration||!f.length?new So(l,e,r):(l=f[0],d&&await l._set(c,d.toJSON()),await Promise.all(n.map(async h=>{if(h!==l)try{await h._remove(c)}catch{}})),new So(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(JT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($T(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(QT(e))return"Blackberry";if(ZT(e))return"Webos";if(KT(e))return"Safari";if((e.includes("chrome/")||YT(e))&&!e.includes("edge/"))return"Chrome";if(XT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function $T(t=ns()){return/firefox\//i.test(t)}function KT(t=ns()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function YT(t=ns()){return/crios\//i.test(t)}function JT(t=ns()){return/iemobile/i.test(t)}function XT(t=ns()){return/android/i.test(t)}function QT(t=ns()){return/blackberry/i.test(t)}function ZT(t=ns()){return/webos/i.test(t)}function yy(t=ns()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function VP(t=ns()){var e;return yy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function qP(){return zk()&&document.documentMode===10}function eC(t=ns()){return yy(t)||XT(t)||ZT(t)||QT(t)||/windows phone/i.test(t)||JT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(t,e=[]){let n;switch(t){case"Browser":n=jN(ns());break;case"Worker":n=`${jN(ns())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Bo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=l=>new Promise((c,d)=>{try{const f=e(l);c(f)}catch(f){d(f)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $P(t,e={}){return Vo(t,"GET","/v2/passwordPolicy",py(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP=6;class YP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??KP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new AN(this),this.idTokenSubscription=new AN(this),this.beforeStateQueue=new WP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=BT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Br(n)),this._initializationPromise=this.queue(async()=>{var r,i,l;if(!this._deleted&&(this.persistenceManager=await So.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((l=this.currentUser)==null?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Ju(this,{idToken:e}),r=await $s._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var l;if(ur(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(d=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(d,d))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(l=this.redirectUser)==null?void 0:l._redirectEventId,d=r==null?void 0:r._redirectEventId,f=await this.tryRedirectSignIn(e);(!c||c===d)&&(f!=null&&f.user)&&(r=f.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(c){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return at(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Xu(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=AP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(Na(this));const n=e?Gs(e):null;return n&&at(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&at(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(Na(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(Na(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Br(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $P(this),n=new YP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new kc("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await HP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Br(e)||this._popupRedirectResolver;at(n,this,"argument-error"),this.redirectPersistenceManager=await So.create(this,[Br(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n);let c=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(at(d,this,"internal-error"),d.then(()=>{c||l(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,r,i);return()=>{c=!0,f()}}else{const f=e.addObserver(n);return()=>{c=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return at(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&EP(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function xy(t){return Gs(t)}class AN{constructor(e){this.auth=e,this.observer=null,this.addObserver=Qk(n=>this.observer=n)}get next(){return at(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function XP(t){vy=t}function QP(t){return vy.loadJS(t)}function ZP(){return vy.gapiScript}function e2(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(t,e){const n=Rg(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),l=n.getOptions();if(Sa(l,e??{}))return i;$r(i,"already-initialized")}return n.initialize({options:e})}function n2(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Br);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function s2(t,e,n){const r=xy(t);at(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,l=nC(e),{host:c,port:d}=r2(e),f=d===null?"":`:${d}`,h={url:`${l}//${c}${f}/`},m=Object.freeze({host:c,port:d,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){at(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),at(Sa(h,r.config.emulator)&&Sa(m,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=m,r.settings.appVerificationDisabledForTesting=!0,Fo(c)?(gw(`${l}//${c}${f}`),yw("Auth",!0)):i2()}function nC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function r2(t){const e=nC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const l=i[1];return{host:l,port:kN(r.substr(l.length+1))}}else{const[l,c]=r.split(":");return{host:l,port:kN(c)}}}function kN(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function i2(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ur("not implemented")}_getIdTokenResponse(e){return Ur("not implemented")}_linkToIdToken(e,n){return Ur("not implemented")}_getReauthenticationResolver(e){return Ur("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _o(t,e){return MP(t,"POST","/v1/accounts:signInWithIdp",py(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a2="http://localhost";class Ea extends sC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ea(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):$r("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...l}=n;if(!r||!i)return null;const c=new Ea(r,i);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const n=this.buildRequest();return _o(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,_o(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,_o(e,n)}buildRequest(){const e={requestUri:a2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Uo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc extends rC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di extends Uc{constructor(){super("facebook.com")}static credential(e){return Ea._fromParams({providerId:Di.PROVIDER_ID,signInMethod:Di.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Di.credentialFromTaggedObject(e)}static credentialFromError(e){return Di.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Di.credential(e.oauthAccessToken)}catch{return null}}}Di.FACEBOOK_SIGN_IN_METHOD="facebook.com";Di.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri extends Uc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ea._fromParams({providerId:Ri.PROVIDER_ID,signInMethod:Ri.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ri.credentialFromTaggedObject(e)}static credentialFromError(e){return Ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ri.credential(n,r)}catch{return null}}}Ri.GOOGLE_SIGN_IN_METHOD="google.com";Ri.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi extends Uc{constructor(){super("github.com")}static credential(e){return Ea._fromParams({providerId:Mi.PROVIDER_ID,signInMethod:Mi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Mi.credentialFromTaggedObject(e)}static credentialFromError(e){return Mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Mi.credential(e.oauthAccessToken)}catch{return null}}}Mi.GITHUB_SIGN_IN_METHOD="github.com";Mi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi extends Uc{constructor(){super("twitter.com")}static credential(e,n){return Ea._fromParams({providerId:Pi.PROVIDER_ID,signInMethod:Pi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Pi.credentialFromTaggedObject(e)}static credentialFromError(e){return Pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Pi.credential(n,r)}catch{return null}}}Pi.TWITTER_SIGN_IN_METHOD="twitter.com";Pi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const l=await $s._fromIdTokenResponse(e,r,i),c=DN(r);return new Ro({user:l,providerId:c,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=DN(r);return new Ro({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function DN(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu extends Wi{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Qu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new Qu(e,n,r,i)}}function iC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Qu._fromErrorAndOperation(t,l,e,r):l})}async function o2(t,e,n=!1){const r=await Cc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ro._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l2(t,e,n=!1){const{auth:r}=t;if(ur(r.app))return Promise.reject(Na(r));const i="reauthenticate";try{const l=await Cc(t,iC(r,i,e,t),n);at(l.idToken,r,"internal-error");const c=gy(l.idToken);at(c,r,"internal-error");const{sub:d}=c;return at(t.uid===d,r,"user-mismatch"),Ro._forOperation(t,i,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&$r(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c2(t,e,n=!1){if(ur(t.app))return Promise.reject(Na(t));const r="signIn",i=await iC(t,r,e),l=await Ro._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(l.user),l}function d2(t,e,n,r){return Gs(t).onIdTokenChanged(e,n,r)}function u2(t,e,n){return Gs(t).beforeAuthStateChanged(e,n)}const Zu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Zu,"1"),this.storage.removeItem(Zu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2=1e3,f2=10;class oC extends aC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=eC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((c,d,f)=>{this.notifyListeners(c,f)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const c=this.storage.getItem(r);!n&&this.localCache[r]===c||this.notifyListeners(r,c)},l=this.storage.getItem(r);qP()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,f2):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},h2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}oC.type="LOCAL";const m2=oC;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC extends aC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}lC.type="SESSION";const cC=lC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new wh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:l}=n.data,c=this.handlersMap[i];if(!(c!=null&&c.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(c).map(async h=>h(n.origin,l)),f=await p2(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}wh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function by(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,c;return new Promise((d,f)=>{const h=by("",20);i.port1.start();const m=setTimeout(()=>{f(new Error("unsupported_event"))},r);c={messageChannel:i,onMessage(x){const g=x;if(g.data.eventId===h)switch(g.data.status){case"ack":clearTimeout(m),l=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),d(g.data.response);break;default:clearTimeout(m),clearTimeout(l),f(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:h,data:n},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(){return window}function y2(t){fr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(){return typeof fr().WorkerGlobalScope<"u"&&typeof fr().importScripts=="function"}async function x2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function v2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function b2(){return dC()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC="firebaseLocalStorageDb",N2=1,eh="firebaseLocalStorage",hC="fbase_key";class Bc{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Th(t,e){return t.transaction([eh],e?"readwrite":"readonly").objectStore(eh)}function S2(){const t=indexedDB.deleteDatabase(uC);return new Bc(t).toPromise()}function Xp(){const t=indexedDB.open(uC,N2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(eh,{keyPath:hC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(eh)?e(r):(r.close(),await S2(),e(await Xp()))})})}async function RN(t,e,n){const r=Th(t,!0).put({[hC]:e,value:n});return new Bc(r).toPromise()}async function _2(t,e){const n=Th(t,!1).get(e),r=await new Bc(n).toPromise();return r===void 0?null:r.value}function MN(t,e){const n=Th(t,!0).delete(e);return new Bc(n).toPromise()}const w2=800,T2=3;class fC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>T2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wh._getInstance(b2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await x2(),!this.activeServiceWorker)return;this.sender=new g2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||v2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xp();return await RN(e,Zu,"1"),await MN(e,Zu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>RN(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>_2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>MN(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=Th(i,!1).getAll();return new Bc(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),w2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fC.type="LOCAL";const C2=fC;new Fc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E2(t,e){return e?Br(e):(at(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ny extends sC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _o(e,this._buildIdpRequest())}_linkToIdToken(e,n){return _o(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return _o(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function I2(t){return c2(t.auth,new Ny(t),t.bypassAuthState)}function j2(t){const{auth:e,user:n}=t;return at(n,e,"internal-error"),l2(n,new Ny(t),t.bypassAuthState)}async function A2(t){const{auth:e,user:n}=t;return at(n,e,"internal-error"),o2(n,new Ny(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e,n,r,i,l=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:l,error:c,type:d}=e;if(c){this.reject(c);return}const f={auth:this.auth,requestUri:n,sessionId:r,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(f))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return I2;case"linkViaPopup":case"linkViaRedirect":return A2;case"reauthViaPopup":case"reauthViaRedirect":return j2;default:$r(this.auth,"internal-error")}}resolve(e){Kr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2=new Fc(2e3,1e4);class po extends mC{constructor(e,n,r,i,l){super(e,n,i,l),this.provider=r,this.authWindow=null,this.pollId=null,po.currentPopupAction&&po.currentPopupAction.cancel(),po.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return at(e,this.auth,"internal-error"),e}async onExecution(){Kr(this.filter.length===1,"Popup operations only handle one event");const e=by();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(hr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(hr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,po.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(hr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,k2.get())};e()}}po.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2="pendingRedirect",Tu=new Map;class R2 extends mC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Tu.get(this.auth._key());if(!e){try{const r=await M2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Tu.set(this.auth._key(),e)}return this.bypassAuthState||Tu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function M2(t,e){const n=L2(e),r=O2(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function P2(t,e){Tu.set(t._key(),e)}function O2(t){return Br(t._redirectPersistence)}function L2(t){return wu(D2,t.config.apiKey,t.name)}async function F2(t,e,n=!1){if(ur(t.app))return Promise.reject(Na(t));const r=xy(t),i=E2(r,e),c=await new R2(r,i,n).execute();return c&&!n&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U2=600*1e3;class B2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!G2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!pC(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(hr(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=U2&&this.cachedEventUids.clear(),this.cachedEventUids.has(PN(e))}saveEventToCache(e){this.cachedEventUids.add(PN(e)),this.lastProcessedEventTime=Date.now()}}function PN(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function pC({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function G2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pC(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z2(t,e={}){return Vo(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,V2=/^https?/;async function q2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await z2(t);for(const n of e)try{if(W2(n))return}catch{}$r(t,"unauthorized-domain")}function W2(t){const e=Yp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const c=new URL(t);return c.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&c.hostname===r}if(!V2.test(n))return!1;if(H2.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=new Fc(3e4,6e4);function ON(){const t=fr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function K2(t){return new Promise((e,n)=>{var i,l,c;function r(){ON(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ON(),n(hr(t,"network-request-failed"))},timeout:$2.get()})}if((l=(i=fr().gapi)==null?void 0:i.iframes)!=null&&l.Iframe)e(gapi.iframes.getContext());else if((c=fr().gapi)!=null&&c.load)r();else{const d=e2("iframefcb");return fr()[d]=()=>{gapi.load?r():n(hr(t,"network-request-failed"))},QP(`${ZP()}?onload=${d}`).catch(f=>n(f))}}).catch(e=>{throw Cu=null,e})}let Cu=null;function Y2(t){return Cu=Cu||K2(t),Cu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=new Fc(5e3,15e3),X2="__/auth/iframe",Q2="emulator/auth/iframe",Z2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},eO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tO(t){const e=t.config;at(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?my(e,Q2):`https://${t.config.authDomain}/${X2}`,r={apiKey:e.apiKey,appName:t.name,v:Bo},i=eO.get(t.config.apiHost);i&&(r.eid=i);const l=t._getFrameworks();return l.length&&(r.fw=l.join(",")),`${n}?${Uo(r).slice(1)}`}async function nO(t){const e=await Y2(t),n=fr().gapi;return at(n,t,"internal-error"),e.open({where:document.body,url:tO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Z2,dontclear:!0},r=>new Promise(async(i,l)=>{await r.restyle({setHideOnLeave:!1});const c=hr(t,"network-request-failed"),d=fr().setTimeout(()=>{l(c)},J2.get());function f(){fr().clearTimeout(d),i(r)}r.ping(f).then(f,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rO=500,iO=600,aO="_blank",oO="http://localhost";class LN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function lO(t,e,n,r=rO,i=iO){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const f={...sO,width:r.toString(),height:i.toString(),top:l,left:c},h=ns().toLowerCase();n&&(d=YT(h)?aO:n),$T(h)&&(e=e||oO,f.scrollbars="yes");const m=Object.entries(f).reduce((g,[N,T])=>`${g}${N}=${T},`,"");if(VP(h)&&d!=="_self")return cO(e||"",d),new LN(null);const x=window.open(e||"",d,m);at(x,t,"popup-blocked");try{x.focus()}catch{}return new LN(x)}function cO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO="__/auth/handler",uO="emulator/auth/handler",hO=encodeURIComponent("fac");async function FN(t,e,n,r,i,l){at(t.config.authDomain,t,"auth-domain-config-required"),at(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Bo,eventId:i};if(e instanceof rC){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",jp(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,x]of Object.entries({}))c[m]=x}if(e instanceof Uc){const m=e.getScopes().filter(x=>x!=="");m.length>0&&(c.scopes=m.join(","))}t.tenantId&&(c.tid=t.tenantId);const d=c;for(const m of Object.keys(d))d[m]===void 0&&delete d[m];const f=await t._getAppCheckToken(),h=f?`#${hO}=${encodeURIComponent(f)}`:"";return`${fO(t)}?${Uo(d).slice(1)}${h}`}function fO({config:t}){return t.emulator?my(t,uO):`https://${t.authDomain}/${dO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp="webStorageSupport";class mO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cC,this._completeRedirectFn=F2,this._overrideRedirectResult=P2}async _openPopup(e,n,r,i){var c;Kr((c=this.eventManagers[e._key()])==null?void 0:c.manager,"_initialize() not called before _openPopup()");const l=await FN(e,n,r,Yp(),i);return lO(e,l,by())}async _openRedirect(e,n,r,i){await this._originValidation(e);const l=await FN(e,n,r,Yp(),i);return y2(l),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:l}=this.eventManagers[n];return i?Promise.resolve(i):(Kr(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await nO(e),r=new B2(e);return n.register("authEvent",i=>(at(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(fp,{type:fp},i=>{var c;const l=(c=i==null?void 0:i[0])==null?void 0:c[fp];l!==void 0&&n(!!l),$r(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=q2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return eC()||KT()||yy()}}const pO=mO;var UN="@firebase/auth",BN="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){at(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function xO(t){Eo(new _a("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:d}=r.options;at(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const f={apiKey:c,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tC(t)},h=new JP(r,i,l,f);return n2(h,n),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Eo(new _a("auth-internal",e=>{const n=xy(e.getProvider("auth").getImmediate());return(r=>new gO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ui(UN,BN,yO(t)),Ui(UN,BN,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vO=300,bO=pw("authIdTokenMaxAge")||vO;let GN=null;const NO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>bO)return;const i=n==null?void 0:n.token;GN!==i&&(GN=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function SO(t=_w()){const e=Rg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=t2(t,{popupRedirectResolver:pO,persistence:[C2,m2,cC]}),r=pw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(r,location.origin);if(location.origin===l.origin){const c=NO(l.toString());u2(n,c,()=>c(n.currentUser)),d2(n,d=>c(d))}}const i=fw("auth");return i&&s2(n,`http://${i}`),n}function _O(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}XP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const l=hr("internal-error");l.customData=i,n(l)},r.type="text/javascript",r.charset="UTF-8",_O().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});xO("Browser");const wO={apiKey:"AIzaSyDEMO_KEY_REPLACE_WITH_YOUR_ACTUAL_KEY",authDomain:"seafarm-demo.firebaseapp.com",databaseURL:"https://seafarm-demo-default-rtdb.firebaseio.com",projectId:"seafarm-demo",storageBucket:"seafarm-demo.appspot.com",messagingSenderId:"123456789012",appId:"1:123456789012:web:abcdef1234567890"},gC=Sw(wO),Et=_P(gC);SO(gC);function Zr(){return crypto.randomUUID()}function It(t,e){return console.error(`[Firebase Error - ${e}]`,t),null}function Lr(t,e){const n=Ct(Et,t);return mP(n,r=>{const i=r.val();if(i){const l=Object.keys(i).map(c=>({id:c,...i[c]}));e(l)}else e([])}),()=>pP(n)}async function TO(){try{const t=Ct(Et,"sites"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchSites"),[]}}async function CO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`sites/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addSite")}}async function EO(t){try{const{id:e,...n}=t,r=Ct(Et,`sites/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateSite")}}async function IO(t){try{const e=Ct(Et,`sites/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteSite"),!1}}async function jO(){try{const t=Ct(Et,"employees"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchEmployees"),[]}}async function AO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`employees/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addEmployee")}}async function kO(t){try{const{id:e,...n}=t,r=Ct(Et,`employees/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateEmployee")}}async function DO(t){try{const e=Ct(Et,`employees/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteEmployee"),!1}}async function RO(t){try{const e=t.map(n=>{const r=Ct(Et,`employees/${n}`);return Xr(r)});return await Promise.all(e),!0}catch(e){return It(e,"deleteMultipleEmployees"),!1}}async function MO(){try{const t=Ct(Et,"farmers"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchFarmers"),[]}}async function PO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`farmers/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addFarmer")}}async function OO(t){try{const{id:e,...n}=t,r=Ct(Et,`farmers/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateFarmer")}}async function LO(t){try{const e=Ct(Et,`farmers/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteFarmer"),!1}}async function FO(){try{const t=Ct(Et,"service_providers"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchServiceProviders"),[]}}async function UO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`service_providers/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addServiceProvider")}}async function BO(t){try{const{id:e,...n}=t,r=Ct(Et,`service_providers/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateServiceProvider")}}async function GO(t){try{const e=Ct(Et,`service_providers/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteServiceProvider"),!1}}async function zO(){try{const t=Ct(Et,"credit_types"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchCreditTypes"),[]}}async function HO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`credit_types/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addCreditType")}}async function VO(t){try{const{id:e,...n}=t,r=Ct(Et,`credit_types/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateCreditType")}}async function qO(t){try{const e=Ct(Et,`credit_types/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteCreditType"),!1}}async function WO(){try{const t=Ct(Et,"seaweed_types"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchSeaweedTypes"),[]}}async function $O(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`seaweed_types/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addSeaweedType")}}async function KO(t){try{const{id:e,...n}=t,r=Ct(Et,`seaweed_types/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateSeaweedType")}}async function YO(t){try{const e=Ct(Et,`seaweed_types/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteSeaweedType"),!1}}async function JO(){try{const t=Ct(Et,"modules"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchModules"),[]}}async function XO(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`modules/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addModule")}}async function QO(t){try{const{id:e,...n}=t,r=Ct(Et,`modules/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateModule")}}async function ZO(t){try{const e=Ct(Et,`modules/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteModule"),!1}}async function eL(){try{const t=Ct(Et,"cultivation_cycles"),e=await Ki(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>({id:r,...n[r]}))}return[]}catch(t){return It(t,"fetchCultivationCycles"),[]}}async function tL(t){try{const e=Zr(),n={...t,id:e},r=Ct(Et,`cultivation_cycles/${e}`);return await Qr(r,n),n}catch(e){return It(e,"addCultivationCycle")}}async function nL(t){try{const{id:e,...n}=t,r=Ct(Et,`cultivation_cycles/${e}`);return await $i(r,n),t}catch(e){return It(e,"updateCultivationCycle")}}async function sL(t){try{const e=Ct(Et,`cultivation_cycles/${t}`);return await Xr(e),!0}catch(e){return It(e,"deleteCultivationCycle"),!1}}const Xn=Object.freeze(Object.defineProperty({__proto__:null,addCreditType:HO,addCultivationCycle:tL,addEmployee:AO,addFarmer:PO,addModule:XO,addSeaweedType:$O,addServiceProvider:UO,addSite:CO,deleteCreditType:qO,deleteCultivationCycle:sL,deleteEmployee:DO,deleteFarmer:LO,deleteModule:ZO,deleteMultipleEmployees:RO,deleteSeaweedType:YO,deleteServiceProvider:GO,deleteSite:IO,fetchCreditTypes:zO,fetchCultivationCycles:eL,fetchEmployees:jO,fetchFarmers:MO,fetchModules:JO,fetchSeaweedTypes:WO,fetchServiceProviders:FO,fetchSites:TO,generateId:Zr,handleFirebaseError:It,subscribeToCollection:Lr,updateCreditType:VO,updateCultivationCycle:nL,updateEmployee:kO,updateFarmer:OO,updateModule:QO,updateSeaweedType:KO,updateServiceProvider:BO,updateSite:EO},Symbol.toStringTag,{value:"Module"}));function rL({sites:t,setSites:e,employees:n,setEmployees:r,farmers:i,setFarmers:l,serviceProviders:c,setServiceProviders:d,creditTypes:f,setCreditTypes:h,seaweedTypes:m,setSeaweedTypes:x,modules:g,setModules:N,cultivationCycles:T,setCultivationCycles:C}){return S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for sites...");const w=Lr("sites",E=>{console.log(`[Firebase] Received ${E.length} sites from Firebase`),E.length>0?e(E):console.log("[Firebase] No sites in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up sites subscription"),w()}},[e]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for employees...");const w=Lr("employees",E=>{console.log(`[Firebase] Received ${E.length} employees from Firebase`),E.length>0?r(E):console.log("[Firebase] No employees in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up employees subscription"),w()}},[r]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for farmers...");const w=Lr("farmers",E=>{console.log(`[Firebase] Received ${E.length} farmers from Firebase`),E.length>0?l(E):console.log("[Firebase] No farmers in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up farmers subscription"),w()}},[l]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for service providers...");const w=Lr("service_providers",E=>{console.log(`[Firebase] Received ${E.length} service providers from Firebase`),E.length>0?d(E):console.log("[Firebase] No service providers in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up service providers subscription"),w()}},[d]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for credit types...");const w=Lr("credit_types",E=>{console.log(`[Firebase] Received ${E.length} credit types from Firebase`),E.length>0?h(E):console.log("[Firebase] No credit types in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up credit types subscription"),w()}},[h]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for seaweed types...");const w=Lr("seaweed_types",E=>{console.log(`[Firebase] Received ${E.length} seaweed types from Firebase`),E.length>0?x(E):console.log("[Firebase] No seaweed types in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up seaweed types subscription"),w()}},[x]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for modules...");const w=Lr("modules",E=>{console.log(`[Firebase] Received ${E.length} modules from Firebase`),E.length>0?N(E):console.log("[Firebase] No modules in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up modules subscription"),w()}},[N]),S.useEffect(()=>{console.log("[Firebase] Setting up real-time subscription for cultivation cycles...");const w=Lr("cultivation_cycles",E=>{console.log(`[Firebase] Received ${E.length} cultivation cycles from Firebase`),E.length>0?C(E):console.log("[Firebase] No cultivation cycles in Firebase, keeping local data")});return()=>{console.log("[Firebase] Cleaning up cultivation cycles subscription"),w()}},[C]),{isConnected:!0,isLoading:!1}}const zN=[{id:"ENVIRONMENTAL",name:"Environmental",isDefault:!0},{id:"EQUIPMENT_FAILURE",name:"Equipment Failure",isDefault:!0},{id:"PEST_DISEASE",name:"Pest/Disease",isDefault:!0},{id:"SECURITY",name:"Security",isDefault:!0},{id:"OTHER",name:"Other",isDefault:!0}],HN=[{id:"LOW",name:"Low",isDefault:!0},{id:"MEDIUM",name:"Medium",isDefault:!0},{id:"HIGH",name:"High",isDefault:!0},{id:"CRITICAL",name:"Critical",isDefault:!0}],VN=[{id:"SITE_MANAGER",name:"Site Manager (Admin)",permissions:[Ce.DASHBOARD_VIEW,Ce.OPERATIONS_VIEW,Ce.INVENTORY_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.MONITORING_VIEW,Ce.REPORTS_VIEW,Ce.SETTINGS_VIEW,Ce.USERS_VIEW,Ce.ROLES_VIEW,Ce.SITES_VIEW,Ce.MODULES_VIEW,Ce.SITES_MANAGE,Ce.MODULES_MANAGE,Ce.EMPLOYEES_MANAGE,Ce.FARMERS_MANAGE,Ce.INCIDENTS_MANAGE,Ce.SETTINGS_GENERAL_MANAGE,Ce.ROLES_MANAGE,Ce.USERS_INVITE,Ce.PAYMENTS_MANAGE,Ce.CREDITS_MANAGE,Ce.PAYROLL_MANAGE,Ce.INVENTORY_MANAGE_ON_SITE,Ce.EXPORTS_MANAGE,Ce.GALLERY_VIEW,Ce.GALLERY_MANAGE],isDefault:!0},{id:"OPERATIONS_LEAD",name:"Directeur des Oprations (Admin)",permissions:[Ce.DASHBOARD_VIEW,Ce.OPERATIONS_VIEW,Ce.INVENTORY_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.MONITORING_VIEW,Ce.REPORTS_VIEW,Ce.SETTINGS_VIEW,Ce.USERS_VIEW,Ce.ROLES_VIEW,Ce.SITES_VIEW,Ce.MODULES_VIEW,Ce.SITES_MANAGE,Ce.MODULES_MANAGE,Ce.EMPLOYEES_MANAGE,Ce.FARMERS_MANAGE,Ce.INCIDENTS_MANAGE,Ce.SETTINGS_GENERAL_MANAGE,Ce.ROLES_MANAGE,Ce.USERS_INVITE,Ce.PAYMENTS_MANAGE,Ce.CREDITS_MANAGE,Ce.PAYROLL_MANAGE,Ce.INVENTORY_MANAGE_ON_SITE,Ce.EXPORTS_MANAGE,Ce.GALLERY_VIEW,Ce.GALLERY_MANAGE],isDefault:!0},{id:"ACCOUNTANT",name:"Accountant",permissions:[Ce.DASHBOARD_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.PAYMENTS_VIEW,Ce.PAYMENTS_MANAGE,Ce.CREDITS_VIEW,Ce.CREDITS_MANAGE,Ce.PAYROLL_VIEW,Ce.PAYROLL_MANAGE,Ce.REPORTS_VIEW],isDefault:!0}],qN=[{id:"user-admin",email:"admin@seafarm.com",password:"password",firstName:"Admin",lastName:"User",roleId:"OPERATIONS_LEAD"}],WN=[{id:"ct-1",name:"Rice",hasQuantity:!0,unit:"Kg",hasUnitPrice:!0,isDirectAmount:!1},{id:"ct-2",name:"Cash Advance",hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0},{id:"ct-3",name:"Cutting Service Fee",hasQuantity:!1,unit:"",hasUnitPrice:!1,isDirectAmount:!0}];function Vt(t,e){try{const n=localStorage.getItem(t);if(n===null)return e;const r=JSON.parse(n);return r??e}catch(n){return console.error(`Error loading ${t} from localStorage`,n),e}}const yC=S.createContext(void 0),iL=({children:t})=>{const[e,n]=S.useState(()=>Vt("sites",[])),[r,i]=S.useState(()=>Vt("employees",[])),[l,c]=S.useState(()=>Vt("farmers",[])),[d,f]=S.useState(()=>Vt("serviceProviders",[])),[h,m]=S.useState(()=>Vt("creditTypes",WN)),[x,g]=S.useState(()=>Vt("farmerCredits",[])),[N,T]=S.useState(()=>Vt("repayments",[])),[C,w]=S.useState(()=>Vt("monthlyPayments",[])),[E,D]=S.useState(()=>Vt("seaweedTypes",[])),[I,k]=S.useState(()=>Vt("modules",[])),[M,j]=S.useState(()=>Vt("cultivationCycles",[])),[O,A]=S.useState(()=>Vt("stockMovements",[])),[F,P]=S.useState(()=>Vt("pressingSlips",[])),[U,q]=S.useState(()=>Vt("pressedStockMovements",[])),[z,J]=S.useState(()=>Vt("exportDocuments",[])),[Y,G]=S.useState(()=>Vt("siteTransfers",[])),[B,Q]=S.useState(()=>Vt("cuttingOperations",[])),[K,re]=S.useState(()=>Vt("farmerDeliveries",[])),[H,ae]=S.useState(()=>Vt("incidents",[])),[ue,Ne]=S.useState(()=>Vt("incidentTypes",zN)),[le,ne]=S.useState(()=>Vt("incidentSeverities",HN)),[Te,fe]=S.useState(()=>Vt("roles",VN)),[Z,ee]=S.useState(()=>Vt("periodicTests",[])),[xe,Oe]=S.useState(()=>Vt("pestObservations",[])),[De,Re]=S.useState(()=>Vt("users",qN)),[$e,He]=S.useState(()=>Vt("invitations",[])),[Se,Le]=S.useState(()=>Vt("messageLogs",[])),[be,ye]=S.useState(()=>Vt("galleryPhotos",[])),Fe=S.useRef(!1);rL({sites:e,setSites:n,employees:r,setEmployees:i,farmers:l,setFarmers:c,serviceProviders:d,setServiceProviders:f,creditTypes:h,setCreditTypes:m,seaweedTypes:E,setSeaweedTypes:D,modules:I,setModules:k,cultivationCycles:M,setCultivationCycles:j}),S.useEffect(()=>{localStorage.setItem("sites",JSON.stringify(e))},[e]),S.useEffect(()=>{localStorage.setItem("employees",JSON.stringify(r))},[r]),S.useEffect(()=>{localStorage.setItem("farmers",JSON.stringify(l))},[l]),S.useEffect(()=>{localStorage.setItem("serviceProviders",JSON.stringify(d))},[d]),S.useEffect(()=>{localStorage.setItem("creditTypes",JSON.stringify(h))},[h]),S.useEffect(()=>{localStorage.setItem("farmerCredits",JSON.stringify(x))},[x]),S.useEffect(()=>{localStorage.setItem("repayments",JSON.stringify(N))},[N]),S.useEffect(()=>{localStorage.setItem("monthlyPayments",JSON.stringify(C))},[C]),S.useEffect(()=>{localStorage.setItem("seaweedTypes",JSON.stringify(E))},[E]),S.useEffect(()=>{localStorage.setItem("modules",JSON.stringify(I))},[I]),S.useEffect(()=>{localStorage.setItem("cultivationCycles",JSON.stringify(M))},[M]),S.useEffect(()=>{localStorage.setItem("stockMovements",JSON.stringify(O))},[O]),S.useEffect(()=>{localStorage.setItem("pressingSlips",JSON.stringify(F))},[F]),S.useEffect(()=>{localStorage.setItem("pressedStockMovements",JSON.stringify(U))},[U]),S.useEffect(()=>{localStorage.setItem("exportDocuments",JSON.stringify(z))},[z]),S.useEffect(()=>{localStorage.setItem("siteTransfers",JSON.stringify(Y))},[Y]),S.useEffect(()=>{localStorage.setItem("cuttingOperations",JSON.stringify(B))},[B]),S.useEffect(()=>{localStorage.setItem("farmerDeliveries",JSON.stringify(K))},[K]),S.useEffect(()=>{localStorage.setItem("incidents",JSON.stringify(H))},[H]),S.useEffect(()=>{localStorage.setItem("incidentTypes",JSON.stringify(ue))},[ue]),S.useEffect(()=>{localStorage.setItem("incidentSeverities",JSON.stringify(le))},[le]),S.useEffect(()=>{localStorage.setItem("roles",JSON.stringify(Te))},[Te]),S.useEffect(()=>{localStorage.setItem("periodicTests",JSON.stringify(Z))},[Z]),S.useEffect(()=>{localStorage.setItem("pestObservations",JSON.stringify(xe))},[xe]),S.useEffect(()=>{localStorage.setItem("users",JSON.stringify(De))},[De]),S.useEffect(()=>{localStorage.setItem("invitations",JSON.stringify($e))},[$e]),S.useEffect(()=>{localStorage.setItem("messageLogs",JSON.stringify(Se))},[Se]),S.useEffect(()=>{localStorage.setItem("galleryPhotos",JSON.stringify(be))},[be]),S.useEffect(()=>{if(Fe.current)return;Fe.current=!0;const V="ps-req-002";if(!F.some(X=>X.id===V)){let X="seaweed-type-1";if(!E.find(pt=>pt.id===X)){const pt={id:X,name:"Spinosum (Type 1)",scientificName:"Eucheuma denticulatum",description:"Requested Seaweed Type",wetPrice:400,dryPrice:1800,priceHistory:[]};D(dt=>[...dt,pt])}const me={id:`psm-init-${V}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.BULK_IN_FROM_SITE,designation:"Initial Bulk Stock (Seed)",inKg:1e3,inBales:20},Me={id:V,slipNo:"PRESS-REQ-TODAY",date:new Date().toISOString().split("T")[0],sourceSiteId:"pressing-warehouse",seaweedTypeId:X,consumedWeightKg:500,consumedBags:8,producedWeightKg:150,producedBalesCount:15},Pe={id:`psm-cons-${V}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${Me.slipNo}`,outKg:500,outBales:8,relatedId:V},Ze={id:`psm-prod-${V}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${Me.slipNo}`,inKg:150,inBales:15,relatedId:V};q(pt=>[...pt,me,Pe,Ze]),P(pt=>[...pt,Me])}},[F,E]);const et=V=>{const X={...V,id:crypto.randomUUID()};n(W=>[...W,X]),Jn(()=>Promise.resolve().then(()=>Xn),[]).then(W=>W.addSite(X)).catch(W=>console.error("[addSite] Firebase sync failed:",W))},Lt=V=>{n(X=>X.map(W=>W.id===V.id?V:W)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.updateSite(V)).catch(X=>console.error("[updateSite] Firebase sync failed:",X))},ut=V=>{n(X=>X.filter(W=>W.id!==V)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.deleteSite(V)).catch(X=>console.error("[deleteSite] Firebase sync failed:",X))},$t=V=>l.filter(X=>X.siteId===V),Pt=V=>{const X={...V,id:crypto.randomUUID(),status:Tg.ACTIVE,hireDate:V.hireDate||new Date().toISOString().split("T")[0]};i(W=>[...W,X]),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.addEmployee(X)).catch(W=>console.error("[addEmployee] Firebase sync failed:",W))},St=V=>{i(X=>X.map(W=>W.id===V.id?V:W)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.updateEmployee(V)).catch(X=>console.error("[updateEmployee] Firebase sync failed:",X))},on=V=>{i(X=>X.filter(W=>W.id!==V)),n(X=>X.map(W=>W.managerId===V?{...W,managerId:void 0}:W)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.deleteEmployee(V)).catch(X=>console.error("[deleteEmployee] Firebase sync failed:",X))},tr=V=>{const X=new Set(V);i(W=>W.filter(me=>!X.has(me.id))),n(W=>W.map(me=>me.managerId&&X.has(me.managerId)?{...me,managerId:void 0}:me)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.deleteMultipleEmployees(V)).catch(W=>console.error("[deleteMultipleEmployees] Firebase sync failed:",W))},gr=(V,X)=>{const W=new Set(V);i(me=>me.map(Me=>W.has(Me.id)?{...Me,siteId:X}:Me))},Da=V=>{const X={...V,id:crypto.randomUUID(),status:V.status||dr.ACTIVE,joinDate:V.joinDate||new Date().toISOString().split("T")[0]};c(W=>[...W,X]),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.addFarmer(X)).catch(W=>console.error("[addFarmer] Firebase sync failed:",W))},Ge=V=>{c(X=>X.map(W=>W.id===V.id?V:W)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.updateFarmer(V)).catch(X=>console.error("[updateFarmer] Firebase sync failed:",X))},Je=V=>{c(X=>X.filter(W=>W.id!==V)),g(X=>X.filter(W=>W.farmerId!==V)),T(X=>X.filter(W=>W.farmerId!==V)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.deleteFarmer(V)).catch(X=>console.error("[deleteFarmer] Firebase sync failed:",X))},Ve=V=>{const X=new Set(V);c(W=>W.filter(me=>!X.has(me.id))),g(W=>W.filter(me=>!X.has(me.farmerId))),T(W=>W.filter(me=>!X.has(me.farmerId))),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.deleteMultipleFarmers(V)).catch(W=>console.error("[deleteMultipleFarmers] Firebase sync failed:",W))},jt=(V,X)=>{const W=new Set(V);c(me=>me.map(Me=>W.has(Me.id)?{...Me,siteId:X}:Me))},rt=V=>{const X={...V,id:`sp-${Date.now()}`,status:Cg.ACTIVE,joinDate:V.joinDate||new Date().toISOString().split("T")[0]};f(W=>[...W,X])},Ft=V=>f(X=>X.map(W=>W.id===V.id?V:W)),Ln=V=>f(X=>X.filter(W=>W.id!==V)),Fn=V=>m(X=>[...X,{...V,id:`ct-${Date.now()}`}]),Tn=V=>m(X=>X.map(W=>W.id===V.id?V:W)),nr=V=>{m(X=>X.filter(W=>W.id!==V)),g(X=>X.filter(W=>W.creditTypeId!==V))},ln=V=>g(X=>[...X,{...V,id:`fc-${Date.now()}`}]),Ts=V=>{const X=V.map(W=>({...W,id:`fc-${Date.now()}-${Math.random()}`}));g(W=>[...W,...X])},ni=V=>T(X=>[...X,{...V,id:`rep-${Date.now()}`}]),sr=V=>{const X=V.map(W=>({...W,id:`rep-${Date.now()}-${Math.random()}`}));T(W=>[...W,...X])},Mh=V=>{const X={...V,id:`pay-${Date.now()}`};w(W=>[...W,X])},Hc=V=>{const X=V.map(W=>({...W,id:`pay-${Date.now()}-${Math.random()}`}));w(W=>[...W,...X])},Qo=V=>w(X=>X.map(W=>W.id===V.id?V:W)),Ji=V=>w(X=>X.filter(W=>W.id!==V)),Ph=V=>{const X={...V,id:`st-${Date.now()}`,priceHistory:[{date:new Date().toISOString().split("T")[0],wetPrice:V.wetPrice,dryPrice:V.dryPrice}]};D(W=>[...W,X])},Vc=V=>D(X=>X.map(W=>W.id===V.id?V:W)),qc=V=>D(X=>X.filter(W=>W.id!==V)),Wc=(V,X)=>{D(W=>W.map(me=>me.id===V?{...me,wetPrice:X.wetPrice,dryPrice:X.dryPrice,priceHistory:[...me.priceHistory,X]}:me))},Zo=V=>{const X={...V,id:crypto.randomUUID(),statusHistory:[{status:Xe.CREATED,date:new Date().toISOString()},{status:Xe.FREE,date:new Date().toISOString(),notes:"Module is ready for assignment."}]};k(W=>[...W,X]),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.addModule(X)).catch(W=>console.error("[addModule] Firebase sync failed:",W))},el=V=>{k(X=>X.map(W=>W.id===V.id?V:W)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.updateModule(V)).catch(X=>console.error("[updateModule] Firebase sync failed:",X))},$c=V=>{k(X=>X.filter(W=>W.id!==V)),j(X=>X.filter(W=>W.moduleId!==V)),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(X=>X.deleteModule(V)).catch(X=>console.error("[deleteModule] Firebase sync failed:",X))},Kc=V=>{const X=new Set(V);k(W=>W.filter(me=>!X.has(me.id))),j(W=>W.filter(me=>me.moduleId&&!X.has(me.moduleId))),Jn(()=>Promise.resolve().then(()=>Xn),void 0).then(W=>W.deleteMultipleModules(V)).catch(W=>console.error("[deleteMultipleModules] Firebase sync failed:",W))},rr=(V,X)=>{const W=new Set(V),me=l.find(Me=>Me.id===X);me&&k(Me=>Me.map(Pe=>W.has(Pe.id)?{...Pe,farmerId:X,statusHistory:[...Pe.statusHistory,{status:Xe.ASSIGNED,date:new Date().toISOString(),notes:`Assigned to farmer ${me.firstName} ${me.lastName}`}]}:Pe))},xn=(V,X)=>{const W=V.cuttingOperationId?B.find(Ze=>Ze.id===V.cuttingOperationId):void 0,me=I.find(Ze=>Ze.id===V.moduleId);if(!me)return;const Me={...V,id:`cyc-${Date.now()}`,linesPlanted:V.linesPlanted||me.lines,cuttingOperationId:V.cuttingOperationId||(W==null?void 0:W.id)};j(Ze=>[...Ze,Me]);const Pe=l.find(Ze=>Ze.id===X);k(Ze=>Ze.map(pt=>{if(pt.id===V.moduleId){const dt=[...pt.statusHistory];return W&&dt.push({status:Xe.CUTTING,date:W.date}),dt.push({status:Xe.ASSIGNED,date:V.plantingDate,notes:`Assigned to farmer ${Pe==null?void 0:Pe.firstName} ${Pe==null?void 0:Pe.lastName}`}),dt.push({status:Xe.PLANTED,date:V.plantingDate}),{...pt,farmerId:X,statusHistory:dt}}return pt}))},Un=V=>{let X;j(W=>(X=W.find(me=>me.id===V.id),W.map(me=>me.id===V.id?V:me))),V.cuttingOperationId&&Q(W=>W.map(me=>{if(me.id===V.cuttingOperationId){const Me=me.moduleCuts.map(Ze=>Ze.moduleId===V.moduleId?{...Ze,linesCut:V.linesPlanted||Ze.linesCut}:Ze),Pe=Me.reduce((Ze,pt)=>Ze+pt.linesCut*me.unitPrice,0);return{...me,seaweedTypeId:V.seaweedTypeId,moduleCuts:Me,totalAmount:Pe}}return me})),X&&X.status!==V.status&&k(W=>W.map(me=>{if(me.id===V.moduleId){const Me=V.exportDate||V.stockDate||V.baggingStartDate||V.dryingStartDate||V.harvestDate||new Date().toISOString(),Pe=[...me.statusHistory,{status:V.status,date:Me}];let Ze={...me,statusHistory:Pe};return V.status===Xe.IN_STOCK&&(Pe.push({status:Xe.FREE,date:V.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}),Ze={...Ze,farmerId:void 0}),Ze}return me}))},yr=V=>{const X=new Map(V.map(me=>[me.id,me]));j(me=>me.map(Me=>X.get(Me.id)||Me));const W=new Map;V.forEach(me=>{me.status===Xe.IN_STOCK&&W.set(me.moduleId,me)}),W.size>0&&k(me=>me.map(Me=>{if(W.has(Me.id)){const Pe=W.get(Me.id),Ze=[...Me.statusHistory,{status:Xe.IN_STOCK,date:Pe.stockDate||new Date().toISOString()},{status:Xe.FREE,date:Pe.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}];return{...Me,farmerId:void 0,statusHistory:Ze}}return Me}))},tl=V=>j(X=>X.filter(W=>W.id!==V)),Oh=(V,X,W)=>{const me=`cut-${Date.now()}`,Me={...V,id:me,beneficiaryFarmerId:W};Q(Ze=>[...Ze,Me]);const Pe=[];V.moduleCuts.forEach(Ze=>{const pt=I.find(dt=>dt.id===Ze.moduleId);if(W){const dt=Ze.linesCut*V.unitPrice;dt>0&&Pe.push({id:`fc-${Date.now()}-${Math.random()}`,date:V.date,siteId:V.siteId,farmerId:W,creditTypeId:"ct-3",totalAmount:dt,relatedOperationId:me,notes:`Cutting/Planting service for module ${(pt==null?void 0:pt.code)||Ze.moduleId}`})}}),Pe.length>0&&g(Ze=>[...Ze,...Pe]),xn({...X,cuttingOperationId:me},W)},xr=V=>A(X=>[...X,{...V,id:`sm-${Date.now()}`}]),nl=V=>A(X=>[...X,...V.map(W=>({...W,id:`sm-${Date.now()}-${Math.random()}`}))]),ri={sites:e,addSite:et,updateSite:Lt,deleteSite:ut,employees:r,addEmployee:Pt,updateEmployee:St,deleteEmployee:on,deleteMultipleEmployees:tr,updateEmployeesSite:gr,farmers:l,addFarmer:Da,updateFarmer:Ge,getFarmersBySite:$t,deleteFarmer:Je,deleteMultipleFarmers:Ve,updateFarmersSite:jt,serviceProviders:d,addServiceProvider:rt,updateServiceProvider:Ft,deleteServiceProvider:Ln,creditTypes:h,addCreditType:Fn,updateCreditType:Tn,deleteCreditType:nr,farmerCredits:x,addFarmerCredit:ln,addMultipleFarmerCredits:Ts,repayments:N,addRepayment:ni,addMultipleRepayments:sr,monthlyPayments:C,addMonthlyPayment:Mh,addMultipleMonthlyPayments:Hc,updateMonthlyPayment:Qo,deleteMonthlyPayment:Ji,seaweedTypes:E,addSeaweedType:Ph,updateSeaweedType:Vc,deleteSeaweedType:qc,updateSeaweedPrices:Wc,modules:I,cultivationCycles:M,addModule:Zo,updateModule:el,deleteModule:$c,deleteMultipleModules:Kc,updateModulesFarmer:rr,addCultivationCycle:xn,updateCultivationCycle:Un,updateMultipleCultivationCycles:yr,deleteCultivationCycle:tl,startCultivationFromCuttings:Oh,stockMovements:O,addStockMovement:xr,addMultipleStockMovements:nl,recordReturnFromPressing:V=>{xr({date:V.date,siteId:V.siteId,seaweedTypeId:V.seaweedTypeId,type:bs.PRESSING_IN,designation:V.designation,inKg:V.kg,inBags:V.bags,relatedId:V.pressingSlipId}),q(X=>{var W;return[...X,{id:`psm-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.RETURN_TO_SITE,designation:`Return to site: ${((W=e.find(me=>me.id===V.siteId))==null?void 0:W.name)||V.siteId}`,outBales:V.bags,outKg:V.kg,relatedId:V.pressingSlipId}]})},farmerDeliveries:K,addFarmerDelivery:V=>{const X=`DEL-${new Date().getFullYear()}-${String(K.length+1).padStart(3,"0")}`,W={...V,id:`fd-${Date.now()}`,slipNo:X};re(Pe=>[...Pe,W]);const me=l.find(Pe=>Pe.id===V.farmerId),Me=`Delivery from ${(me==null?void 0:me.firstName)||""} ${(me==null?void 0:me.lastName)||""} (${X})`;V.destination==="PRESSING_WAREHOUSE_BULK"?q(Pe=>[...Pe,{id:`psm-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.FARMER_DELIVERY,designation:Me,inKg:V.totalWeightKg,inBales:V.totalBags,relatedId:W.id}]):xr({date:V.date,siteId:V.siteId,seaweedTypeId:V.seaweedTypeId,type:bs.FARMER_DELIVERY,designation:Me,inKg:V.totalWeightKg,inBags:V.totalBags,relatedId:W.id})},deleteFarmerDelivery:V=>{re(X=>X.filter(W=>W.id!==V)),A(X=>X.filter(W=>W.relatedId!==V||W.type!==bs.FARMER_DELIVERY)),q(X=>X.filter(W=>W.relatedId!==V||W.type!==mt.FARMER_DELIVERY))},addInitialStock:V=>A(X=>[...X,{...V,id:`sm-${Date.now()}`,type:bs.INITIAL_STOCK}]),transferBaggedToStock:(V,X)=>{const W=X||new Date().toISOString().split("T")[0],me=M.filter(Pe=>V.includes(Pe.id)&&Pe.status===Xe.BAGGED).map(Pe=>({...Pe,status:Xe.IN_STOCK,stockDate:W})),Me=me.map(Pe=>{const Ze=I.find(pt=>pt.id===Pe.moduleId);return!Ze||!Pe.baggedWeightKg||!Pe.baggedBagsCount?null:{date:W,siteId:Ze.siteId,seaweedTypeId:Pe.seaweedTypeId,type:bs.BAGGING_TRANSFER,designation:`From Bagging (Module ${Ze.code})`,inKg:Pe.baggedWeightKg,inBags:Pe.baggedBagsCount,relatedId:Pe.id}}).filter(Pe=>Pe!==null);me.length>0&&yr(me),Me.length>0&&nl(Me)},exportStockBatch:V=>{const X=M.find(me=>me.id===V);if(!X)return;Un({...X,status:Xe.EXPORTED,exportDate:new Date().toISOString().split("T")[0]});const W=I.find(me=>me.id===X.moduleId);W&&X.harvestedWeight&&xr({date:new Date().toISOString().split("T")[0],siteId:W.siteId,seaweedTypeId:X.seaweedTypeId,type:bs.EXPORT_OUT,designation:`Export from Batch (Module ${W.code})`,outKg:X.harvestedWeight,outBags:Math.ceil(X.harvestedWeight/50),relatedId:X.id})},pressingSlips:F,pressedStockMovements:U,...{addPressingSlip:V=>{const X=`PRESS-${new Date().getFullYear()}-${String(F.length+1).padStart(3,"0")}`,W={...V,id:`ps-${Date.now()}`,slipNo:X};P(me=>[...me,W]),q(me=>[...me,{id:`psm-cons-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${W.slipNo}`,outKg:W.consumedWeightKg,outBales:W.consumedBags,relatedId:W.id},{id:`psm-prod-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${W.slipNo}`,inBales:W.producedBalesCount,inKg:W.producedWeightKg,relatedId:W.id}])},updatePressingSlip:V=>{P(X=>X.map(W=>W.id===V.id?V:W)),q(X=>[...X.filter(me=>me.relatedId!==V.id),{id:`psm-upd-cons-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${V.slipNo}`,outKg:V.consumedWeightKg,outBales:V.consumedBags,relatedId:V.id},{id:`psm-upd-prod-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.PRESSING_IN,designation:`Produced from Pressing Slip ${V.slipNo}`,inBales:V.producedBalesCount,inKg:V.producedWeightKg,relatedId:V.id}])},deletePressingSlip:V=>{P(X=>X.filter(W=>W.id!==V)),q(X=>X.filter(W=>W.relatedId!==V))},addInitialPressedStock:V=>q(X=>[...X,{...V,id:`psm-${Date.now()}`,type:mt.INITIAL_STOCK}]),addPressedStockAdjustment:V=>q(X=>[...X,{...V,id:`psm-adj-${Date.now()}`,relatedId:`adj-${Date.now()}`}])},exportDocuments:z,...{addExportDocument:(V,X)=>{const W=`EXP-${new Date().getFullYear()}-${String(z.length+1).padStart(3,"0")}`,me={...V,id:`ed-${Date.now()}`,docNo:W,containers:V.containers.map(pt=>({...pt,id:`ec-${Date.now()}-${Math.random()}`}))};J(pt=>[...pt,me]),P(pt=>pt.map(dt=>me.pressingSlipIds.includes(dt.id)?{...dt,exportDocId:me.id}:dt));const Me=F.filter(pt=>me.pressingSlipIds.includes(pt.id)),Pe=Me.reduce((pt,dt)=>pt+dt.producedBalesCount,0),Ze=Me.reduce((pt,dt)=>pt+dt.producedWeightKg,0);Pe>0&&q(pt=>[...pt,{id:`psm-${Date.now()}`,date:me.date,siteId:"pressing-warehouse",seaweedTypeId:me.seaweedTypeId,type:mt.EXPORT_OUT,designation:`Export Shipment ${me.docNo}`,outBales:Pe,outKg:Ze,relatedId:me.id}])},updateExportDocument:V=>{J(Pe=>Pe.map(Ze=>Ze.id===V.id?V:Ze)),P(Pe=>Pe.map(Ze=>V.pressingSlipIds.includes(Ze.id)?{...Ze,exportDocId:V.id}:Ze.exportDocId===V.id?{...Ze,exportDocId:void 0}:Ze));const X=U.filter(Pe=>Pe.relatedId!==V.id),W=F.filter(Pe=>V.pressingSlipIds.includes(Pe.id)),me=W.reduce((Pe,Ze)=>Pe+Ze.producedBalesCount,0),Me=W.reduce((Pe,Ze)=>Pe+Ze.producedWeightKg,0);me>0&&X.push({id:`psm-${Date.now()}`,date:V.date,siteId:"pressing-warehouse",seaweedTypeId:V.seaweedTypeId,type:mt.EXPORT_OUT,designation:`Export Shipment ${V.docNo}`,outBales:me,outKg:Me,relatedId:V.id}),q(X)},deleteExportDocument:V=>{P(X=>X.map(W=>W.exportDocId===V?{...W,exportDocId:void 0}:W)),J(X=>X.filter(W=>W.id!==V)),q(X=>X.filter(W=>W.relatedId!==V))}},siteTransfers:Y,...{addSiteTransfer:V=>{var W;const X={...V,id:`st-${Date.now()}`,status:Jt.AWAITING_OUTBOUND,history:[{status:Jt.AWAITING_OUTBOUND,date:new Date().toISOString(),notes:"Transfer initiated."}]};G(me=>[...me,X]),xr({date:X.date,siteId:X.sourceSiteId,seaweedTypeId:X.seaweedTypeId,type:bs.SITE_TRANSFER_OUT,designation:`Transfer to ${(W=e.find(me=>me.id===X.destinationSiteId))==null?void 0:W.name} (${X.id})`,outKg:X.weightKg,outBags:X.bags,relatedId:X.id})},updateSiteTransfer:V=>{var me;const X=Y.find(Me=>Me.id===V.id);if(!X)return;const W={...V};if(X.status!==W.status){let Me="";W.status===Jt.IN_TRANSIT?Me="Marked as in transit.":W.status===Jt.PENDING_RECEPTION?Me="Marked as arrived at destination, pending checks.":W.status===Jt.COMPLETED?Me=`Completed. Received ${W.receivedWeightKg}kg in ${W.receivedBags} bags.`:W.status===Jt.CANCELLED&&(Me=`Cancelled. Reason: ${W.notes}`),W.history=[...X.history||[],{status:W.status,date:new Date().toISOString(),notes:Me}]}G(Me=>Me.map(Pe=>Pe.id===W.id?W:Pe)),X.status!==Jt.COMPLETED&&W.status===Jt.COMPLETED&&(W.destinationSiteId==="pressing-warehouse"?q(Me=>{var Pe;return[...Me,{id:`psm-${Date.now()}`,date:W.completionDate||new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:mt.BULK_IN_FROM_SITE,designation:`Transfer from ${(Pe=e.find(Ze=>Ze.id===W.sourceSiteId))==null?void 0:Pe.name} (${W.id})`,inKg:W.receivedWeightKg,inBales:W.receivedBags,relatedId:W.id}]}):xr({date:W.completionDate||new Date().toISOString().split("T")[0],siteId:W.destinationSiteId,seaweedTypeId:W.seaweedTypeId,type:bs.SITE_TRANSFER_IN,designation:`Transfer from ${(me=e.find(Me=>Me.id===W.sourceSiteId))==null?void 0:me.name} (${W.id})`,inKg:W.receivedWeightKg,inBags:W.receivedBags,relatedId:W.id})),X.status!==Jt.CANCELLED&&W.status===Jt.CANCELLED&&xr({date:W.completionDate||new Date().toISOString().split("T")[0],siteId:W.sourceSiteId,seaweedTypeId:W.seaweedTypeId,type:bs.SITE_TRANSFER_IN,designation:`Cancelled Transfer ${W.id}: ${W.notes||""}`.trim(),inKg:W.weightKg,inBags:W.bags,relatedId:W.id})}},cuttingOperations:B,...{addCuttingOperation:V=>{const X={...V,id:`cut-${Date.now()}`},W=[];V.moduleCuts.forEach(me=>{const Me=I.find(Pe=>Pe.id===me.moduleId);if(Me&&Me.farmerId){const Pe=me.linesCut*V.unitPrice;Pe>0&&W.push({id:`fc-${Date.now()}-${Math.random()}`,date:V.date,siteId:V.siteId,farmerId:Me.farmerId,creditTypeId:"ct-3",totalAmount:Pe,relatedOperationId:X.id,notes:`Cutting service for module ${Me.code}`})}}),Q(me=>[...me,X]),W.length>0&&g(me=>[...me,...W])},updateCuttingOperation:(V,X,W)=>{var Ze,pt;const me=B.find(dt=>dt.id===V.id);if(!me){console.error("Original operation not found for update:",V.id);return}const Me=(Ze=me.moduleCuts[0])==null?void 0:Ze.moduleId,Pe=(pt=V.moduleCuts[0])==null?void 0:pt.moduleId;if(Q(dt=>dt.map(cn=>cn.id===V.id?V:cn)),j(dt=>dt.map(cn=>{var sn;if(cn.cuttingOperationId===V.id){const dn=(X==null?void 0:X[Pe])??cn.initialWeight;return{...cn,moduleId:Pe,seaweedTypeId:V.seaweedTypeId,plantingDate:W||V.date,linesPlanted:(sn=V.moduleCuts[0])==null?void 0:sn.linesCut,initialWeight:dn}}return cn})),g(dt=>{const cn=dt.filter(Kn=>Kn.relatedOperationId!==V.id),sn=[],dn=V.beneficiaryFarmerId;if(dn){const Kn=V.moduleCuts.reduce((kn,un)=>kn+un.linesCut*V.unitPrice,0);if(Kn>0){const kn=I.find(un=>un.id===Pe);sn.push({id:`fc-edit-${Date.now()}`,date:V.date,siteId:V.siteId,farmerId:dn,creditTypeId:"ct-3",totalAmount:Kn,relatedOperationId:V.id,notes:`Cutting service for module ${(kn==null?void 0:kn.code)||Pe}`})}}return[...cn,...sn]}),Me&&Pe&&Me!==Pe){const dt=l.find(sn=>sn.id===V.beneficiaryFarmerId),cn=W||V.date;k(sn=>sn.map(dn=>{var Kn;if(dn.id===Me){const kn=((Kn=I.find(un=>un.id===Pe))==null?void 0:Kn.code)||Pe;return{...dn,farmerId:void 0,statusHistory:[...dn.statusHistory,{status:Xe.FREE,date:new Date().toISOString(),notes:`Operation moved to module ${kn}`}]}}return dn.id===Pe?{...dn,farmerId:V.beneficiaryFarmerId,statusHistory:[...dn.statusHistory,{status:Xe.ASSIGNED,date:cn,notes:`Assigned to farmer ${dt==null?void 0:dt.firstName} ${dt==null?void 0:dt.lastName}`},{status:Xe.PLANTED,date:cn}]}:dn}))}else if(Pe){const dt=l.find(sn=>sn.id===V.beneficiaryFarmerId),cn=W||V.date;k(sn=>sn.map(dn=>{if(dn.id===Pe){let Kn=!1,kn={...dn};const un=[...dn.statusHistory];dn.farmerId!==V.beneficiaryFarmerId&&(kn.farmerId=V.beneficiaryFarmerId,un.push({status:Xe.ASSIGNED,date:cn,notes:`Re-assigned to farmer ${dt==null?void 0:dt.firstName} ${dt==null?void 0:dt.lastName}`}),Kn=!0);const ii=un.map(vr=>vr.status).lastIndexOf(Xe.PLANTED);if(ii>-1&&un[ii].date!==cn){un[ii]={...un[ii],date:cn};const vr=un.map(Zc=>Zc.status).lastIndexOf(Xe.ASSIGNED,ii);vr>-1&&(un[vr]={...un[vr],date:cn}),Kn=!0}if(Kn)return kn.statusHistory=un,kn}return dn}))}},updateMultipleCuttingOperations:(V,X)=>{const W=new Set(V);Q(me=>me.map(Me=>W.has(Me.id)?{...Me,isPaid:!0,paymentDate:X}:Me))},deleteCuttingOperation:V=>{var me;const X=B.find(Me=>Me.id===V);if(!X){console.error("Operation to delete not found:",V);return}const W=(me=X.moduleCuts[0])==null?void 0:me.moduleId;W&&k(Me=>Me.map(Pe=>Pe.id===W?{...Pe,farmerId:void 0,statusHistory:[...Pe.statusHistory,{status:Xe.FREE,date:new Date().toISOString(),notes:"Cutting operation deleted, module freed."}]}:Pe)),j(Me=>Me.filter(Pe=>Pe.cuttingOperationId!==V)),g(Me=>Me.filter(Pe=>Pe.relatedOperationId!==V)),Q(Me=>Me.filter(Pe=>Pe.id!==V))}},incidents:H,...{addIncident:V=>ae(X=>[...X,{...V,id:`inc-${Date.now()}`}]),updateIncident:V=>ae(X=>X.map(W=>W.id===V.id?V:W)),deleteIncident:V=>ae(X=>X.filter(W=>W.id!==V)),addIncidentType:V=>{const X=V.name.toUpperCase().replace(/\s/g,"_");ue.some(W=>W.id===X)||Ne(W=>[...W,{...V,id:X,isDefault:!1}])},updateIncidentType:V=>Ne(X=>X.map(W=>W.id===V.id?{...W,name:V.name}:W)),deleteIncidentType:V=>{Ne(W=>W.filter(me=>me.id!==V&&!me.isDefault));const X=ue.find(W=>W.id==="OTHER");X&&ae(W=>W.map(me=>me.type===V?{...me,type:X.id}:me))},addIncidentSeverity:V=>{const X=V.name.toUpperCase().replace(/\s/g,"_");le.some(W=>W.id===X)||ne(W=>[...W,{...V,id:X,isDefault:!1}])},updateIncidentSeverity:V=>ne(X=>X.map(W=>W.id===V.id?{...W,name:V.name}:W)),deleteIncidentSeverity:V=>{ne(W=>W.filter(me=>me.id!==V&&!me.isDefault));const X=le.find(W=>W.id==="LOW");X&&ae(W=>W.map(me=>me.severity===V?{...me,severity:X.id}:me))}},incidentTypes:ue,incidentSeverities:le,roles:Te,...{addRole:V=>{const X=V.name.toUpperCase().replace(/\s/g,"_");if(Te.some(me=>me.id===X))return;const W={...V,id:X,isDefault:!1};return fe(me=>[...me,W]),W},updateRole:V=>fe(X=>X.map(W=>W.id===V.id?V:W)),deleteRole:V=>fe(X=>X.filter(W=>W.id!==V&&!W.isDefault))},periodicTests:Z,...{addPeriodicTest:V=>ee(X=>[...X,{...V,id:`pt-${Date.now()}`}]),updatePeriodicTest:V=>ee(X=>X.map(W=>W.id===V.id?V:W)),deletePeriodicTest:V=>ee(X=>X.filter(W=>W.id!==V))},pestObservations:xe,users:De,findUserByEmail:V=>De.find(X=>X.email.toLowerCase()===V.toLowerCase()),addUser:(V,X)=>{if(De.some(me=>me.email.toLowerCase()===V.email.toLowerCase()))return;X&&He(me=>me.map(Me=>Me.token===X?{...Me,status:pc.ACCEPTED}:Me));const W={id:`user-${Date.now()}`,...V};return Re(me=>[...me,W]),W},setUserPasswordResetToken:(V,X,W)=>{let me=!1;return Re(Me=>Me.map(Pe=>Pe.email.toLowerCase()===V.toLowerCase()?(me=!0,{...Pe,passwordResetToken:X,passwordResetExpires:W}):Pe)),me},findUserByPasswordResetToken:V=>{const X=De.find(W=>W.passwordResetToken===V);return X&&X.passwordResetExpires&&new Date<new Date(X.passwordResetExpires)?X:void 0},updateUserPassword:(V,X)=>{let W=!1;return Re(me=>me.map(Me=>Me.id===V?(W=!0,{...Me,password:X,passwordResetToken:void 0,passwordResetExpires:void 0}):Me)),W},updateUser:V=>Re(X=>X.map(W=>W.id===V.id?V:W)),markCyclesAsPaid:(V,X)=>{const W=new Set(V);j(me=>me.map(Me=>W.has(Me.id)?{...Me,paymentRunId:X}:Me))},markDeliveriesAsPaid:(V,X)=>{const W=new Set(V);re(me=>me.map(Me=>W.has(Me.id)?{...Me,paymentRunId:X}:Me))},invitations:$e,addInvitation:V=>{const X={...V,id:`inv-${Date.now()}`,token:`inv-token-${Date.now()}-${Math.random()}`,createdAt:new Date().toISOString()};return He(W=>[...W,X]),X},deleteInvitation:V=>He(X=>X.filter(W=>W.id!==V)),findInvitationByToken:V=>{const X=$e.find(W=>W.token===V&&W.status===pc.PENDING);return X&&new Date(X.expiresAt)>new Date?X:void 0},addMessageLog:V=>Le(X=>[{...V,id:`msg-${Date.now()}`},...X]),messageLogs:Se,galleryPhotos:be,addGalleryPhoto:V=>ye(X=>[{...V,id:`photo-${Date.now()}`},...X]),updateGalleryPhotoComment:(V,X)=>ye(W=>W.map(me=>me.id===V?{...me,comment:X}:me)),deleteGalleryPhoto:V=>ye(X=>X.filter(W=>W.id!==V)),clearAllData:()=>{localStorage.clear(),n([]),i([]),c([]),f([]),m(WN),g([]),T([]),w([]),D([]),k([]),j([]),A([]),P([]),q([]),J([]),G([]),Q([]),re([]),ae([]),Ne(zN),ne(HN),fe(VN),ee([]),Oe([]),Re(qN),He([]),Le([]),ye([])}};return s.jsx(yC.Provider,{value:ri,children:t})},qe=()=>{const t=S.useContext(yC);if(t===void 0)throw new Error("useData must be used within a DataProvider");return t},xC=S.createContext(void 0),aL=({children:t})=>{const{modules:e,cultivationCycles:n}=qe(),[r,i]=S.useState([]);return S.useEffect(()=>{const l=new Date;l.setHours(0,0,0,0);const c=[];e.forEach(d=>{if(!d.farmerId){const f=n.filter(h=>h.moduleId===d.id&&h.harvestDate).sort((h,m)=>new Date(m.harvestDate).getTime()-new Date(h.harvestDate).getTime());if(f.length>0){const h=new Date(f[0].harvestDate);Math.floor((l.getTime()-h.getTime())/(1e3*3600*24))>Ip&&c.push({id:`unassigned-${d.id}`,type:"MODULE_UNASSIGNED",messageKey:"notification_unassigned",messageParams:{code:d.code,days:Ip},date:l.toISOString(),relatedId:d.id,path:`/modules?highlight=${d.id}`})}}}),n.forEach(d=>{if(d.status===Xe.PLANTED||d.status===Xe.GROWING){const f=new Date(d.plantingDate);f.setHours(0,0,0,0);const h=Math.floor((l.getTime()-f.getTime())/(1e3*3600*24)),m=e.find(x=>x.id===d.moduleId);h>zr?c.push({id:`overdue-${d.id}`,type:"HARVEST_OVERDUE",messageKey:"notification_overdue",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:d.id,path:`/cultivation?highlight=${d.id}`}):h>zr-Eg&&c.push({id:`nearing-${d.id}`,type:"HARVEST_NEARING",messageKey:"notification_nearing",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:d.id,path:`/cultivation?highlight=${d.id}`})}}),c.sort((d,f)=>new Date(f.date).getTime()-new Date(d.date).getTime()),i(c)},[e,n]),s.jsx(xC.Provider,{value:{notifications:r},children:t})},oL=()=>{const t=S.useContext(xC);if(t===void 0)throw new Error("useNotifications must be used within a NotificationProvider");return t},vC=S.createContext(void 0),lL=({children:t})=>{const[e,n]=S.useState(null),[r,i]=S.useState(new Set),[l,c]=S.useState(!0),{findUserByEmail:d,addUser:f,setUserPasswordResetToken:h,findUserByPasswordResetToken:m,updateUserPassword:x,roles:g,updateUser:N}=qe(),T=S.useCallback(j=>r.has(j),[r]);S.useEffect(()=>{try{const j=localStorage.getItem("seafarm_monitor_user");if(j){const O=JSON.parse(j);if(n(O),g.length>0){const A=g.find(P=>P.id===O.roleId),F=A?A.permissions:[];i(new Set(F))}}}catch(j){console.error("Failed to parse user from localStorage",j),localStorage.removeItem("seafarm_monitor_user")}finally{c(!1)}},[g]);const C=S.useCallback(async(j,O)=>{const A=d(j);if(A&&A.password===O){const F=g.find(z=>z.id===A.roleId),P=F?F.permissions:[];i(new Set(P));const{password:U,...q}=A;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(q)),n(q),!0}return!1},[d,g]),w=S.useCallback(async(j,O)=>{const A=f(j,O);if(A){const F=g.find(z=>z.id===A.roleId),P=F?F.permissions:[];i(new Set(P));const{password:U,...q}=A;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(q)),n(q),!0}return!1},[f,g]),E=S.useCallback(()=>{n(null),i(new Set),localStorage.removeItem("seafarm_monitor_user")},[]),D=S.useCallback(async j=>{if(d(j)){const A=`mock-token-${Date.now()}`,F=new Date(Date.now()+36e5);h(j,A,F);const P=`${window.location.origin}${window.location.pathname}#/reset-password?token=${A}`;return console.log("--- PASSWORD RESET (FOR TESTING) ---"),console.log(`Reset link for ${j}: ${P}`),console.log("------------------------------------"),P}return null},[d,h]),I=S.useCallback(async(j,O)=>{const A=m(j);if(!A)return!1;const F=x(A.id,O);return F&&E(),F},[m,x,E]),k=S.useCallback(j=>{if(!e)return;const O={...e,...j};N(O),n(O),localStorage.setItem("seafarm_monitor_user",JSON.stringify(O))},[e,N]),M={currentUser:e,loading:l,login:C,signup:w,logout:E,sendPasswordResetLink:D,resetPassword:I,can:T,updateProfile:k};return s.jsx(vC.Provider,{value:M,children:!l&&t})},Zs=()=>{const t=S.useContext(vC);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t};class ho extends S.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error(" ErrorBoundary caught an error:",e),console.error("Error info:",n),this.setState({error:e,errorInfo:n})}render(){var e;return this.state.hasError?this.props.fallback?this.props.fallback:s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:s.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-12 w-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Oops! Something went wrong"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Une erreur s'est produite lors du chargement de cette page"})]})]}),s.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Details:"}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:s.jsx("p",{className:"text-sm text-red-800 font-mono",children:(e=this.state.error)==null?void 0:e.toString()})})]}),this.state.errorInfo&&s.jsxs("details",{className:"mt-4",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 hover:text-gray-900",children:"Component Stack Trace"}),s.jsx("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-md p-4",children:s.jsx("pre",{className:"text-xs text-gray-700 overflow-auto",children:this.state.errorInfo.componentStack})})]}),s.jsxs("div",{className:"mt-6 flex gap-4",children:[s.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Reload Page"}),s.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors",children:"Go Back"})]}),s.jsx("div",{className:"mt-4 text-center",children:s.jsx("a",{href:"/#/",className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"Return to Dashboard"})})]})}):this.props.children}}const cL={Activity:s.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}),AlertTriangle:s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),Archive:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),s.jsx("rect",{width:"22",height:"5",x:"1",y:"3"}),s.jsx("line",{x1:"10",x2:"14",y1:"12",y2:"12"})]}),ArrowRightLeft:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m16 3 4 4-4 4"}),s.jsx("path",{d:"M20 7H4"}),s.jsx("path",{d:"m8 21-4-4 4-4"}),s.jsx("path",{d:"M4 17h16"})]}),ArrowUp:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),s.jsx("polyline",{points:"5 12 12 5 19 12"})]}),ArrowDown:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("polyline",{points:"19 12 12 19 5 12"})]}),Beaker:s.jsx("path",{d:"M4.5 3h15M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3M6 14h12"}),Bell:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),s.jsx("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),BookOpen:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),s.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),Bot:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"10",x:"3",y:"11",rx:"2"}),s.jsx("circle",{cx:"12",cy:"5",r:"2"}),s.jsx("path",{d:"M12 7v4"}),s.jsx("line",{x1:"8",x2:"8",y1:"16",y2:"16"}),s.jsx("line",{x1:"16",x2:"16",y1:"16",y2:"16"})]}),Briefcase:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),Building:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),s.jsx("path",{d:"M9 22v-4h6v4"}),s.jsx("path",{d:"M8 6h.01"}),s.jsx("path",{d:"M16 6h.01"}),s.jsx("path",{d:"M12 6h.01"}),s.jsx("path",{d:"M12 10h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M16 10h.01"}),s.jsx("path",{d:"M16 14h.01"}),s.jsx("path",{d:"M8 10h.01"}),s.jsx("path",{d:"M8 14h.01"})]}),Calculator:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2"}),s.jsx("line",{x1:"8",x2:"16",y1:"6",y2:"6"}),s.jsx("line",{x1:"16",x2:"16",y1:"14",y2:"18"}),s.jsx("path",{d:"M16 10h.01"}),s.jsx("path",{d:"M12 10h.01"}),s.jsx("path",{d:"M8 10h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M8 14h.01"}),s.jsx("path",{d:"M12 18h.01"}),s.jsx("path",{d:"M8 18h.01"})]}),Calendar:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),s.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),s.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),Check:s.jsx("polyline",{points:"20 6 9 17 4 12"}),ChevronDown:s.jsx("polyline",{points:"6 9 12 15 18 9"}),ChevronLeft:s.jsx("polyline",{points:"15 18 9 12 15 6"}),ChevronRight:s.jsx("polyline",{points:"9 18 15 12 9 6"}),CreditCard:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),s.jsx("line",{x1:"2",x2:"22",y1:"10",y2:"10"})]}),DollarSign:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),s.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),Download:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),Edit:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),Edit2:s.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}),Eye:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),FileSpreadsheet:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),s.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),s.jsx("path",{d:"M8 13h2"}),s.jsx("path",{d:"M8 17h2"}),s.jsx("path",{d:"M14 13h2"}),s.jsx("path",{d:"M14 17h2"})]}),FileText:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),s.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),s.jsx("path",{d:"M10 9H8"}),s.jsx("path",{d:"M16 13H8"}),s.jsx("path",{d:"M16 17H8"})]}),Filter:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}),GitBranch:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"6",x2:"6",y1:"3",y2:"15"}),s.jsx("circle",{cx:"18",cy:"6",r:"3"}),s.jsx("circle",{cx:"6",cy:"18",r:"3"}),s.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]}),Globe:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),s.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),Grid:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),Home:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),s.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),Image:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),s.jsx("circle",{cx:"9",cy:"9",r:"2"}),s.jsx("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),Layers:s.jsxs(s.Fragment,{children:[s.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),s.jsx("polyline",{points:"2 17 12 22 22 17"}),s.jsx("polyline",{points:"2 12 12 17 22 12"})]}),Lock:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),s.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),LogOut:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),s.jsx("polyline",{points:"16 17 21 12 16 7"}),s.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),Map:s.jsxs(s.Fragment,{children:[s.jsx("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"}),s.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"18"}),s.jsx("line",{x1:"16",x2:"16",y1:"6",y2:"22"})]}),MapPin:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),Menu:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),s.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),s.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),Moon:s.jsx("path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}),Package:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m16.5 9.4-9-5.19"}),s.jsx("path",{d:"m21 16-9 5.19-9-5.19"}),s.jsx("path",{d:"m3 11.1 9 5.19 9-5.19"}),s.jsx("line",{x1:"12",x2:"12",y1:"5.9",y2:"21.19"}),s.jsx("path",{d:"M12 2 3 7l9 5.19L21 7Z"})]}),PlusCircle:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"16"}),s.jsx("line",{x1:"8",x2:"16",y1:"12",y2:"12"})]}),Printer:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),s.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),s.jsx("rect",{width:"12",height:"8",x:"6",y:"14"})]}),QrCode:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"5",height:"5",x:"3",y:"3",rx:"1"}),s.jsx("rect",{width:"5",height:"5",x:"16",y:"3",rx:"1"}),s.jsx("rect",{width:"5",height:"5",x:"3",y:"16",rx:"1"}),s.jsx("path",{d:"M21 16h-3a2 2 0 0 0-2 2v3"}),s.jsx("path",{d:"M21 21v.01"}),s.jsx("path",{d:"M12 7v3a2 2 0 0 1-2 2H7"}),s.jsx("path",{d:"M3 12h.01"}),s.jsx("path",{d:"M12 3h.01"}),s.jsx("path",{d:"M12 16v.01"}),s.jsx("path",{d:"M16 12h1"}),s.jsx("path",{d:"M21 12v.01"}),s.jsx("path",{d:"M12 21v-1"})]}),Save:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),s.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),s.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Scissors:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"6",cy:"6",r:"3"}),s.jsx("circle",{cx:"6",cy:"18",r:"3"}),s.jsx("line",{x1:"20",x2:"8.12",y1:"4",y2:"15.88"}),s.jsx("line",{x1:"14.47",x2:"20",y1:"14.48",y2:"20"}),s.jsx("line",{x1:"8.12",x2:"12",y1:"8.12",y2:"12"})]}),Search:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"})]}),Settings:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),SlidersHorizontal:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"21",x2:"14",y1:"4",y2:"4"}),s.jsx("line",{x1:"10",x2:"3",y1:"4",y2:"4"}),s.jsx("line",{x1:"21",x2:"12",y1:"12",y2:"12"}),s.jsx("line",{x1:"8",x2:"3",y1:"12",y2:"12"}),s.jsx("line",{x1:"21",x2:"16",y1:"20",y2:"20"}),s.jsx("line",{x1:"12",x2:"3",y1:"20",y2:"20"}),s.jsx("line",{x1:"14",x2:"14",y1:"2",y2:"6"}),s.jsx("line",{x1:"8",x2:"8",y1:"10",y2:"14"}),s.jsx("line",{x1:"16",x2:"16",y1:"18",y2:"22"})]}),Sun:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"4"}),s.jsx("path",{d:"M12 2v2"}),s.jsx("path",{d:"M12 20v2"}),s.jsx("path",{d:"m4.93 4.93 1.41 1.41"}),s.jsx("path",{d:"m17.66 17.66 1.41 1.41"}),s.jsx("path",{d:"M2 12h2"}),s.jsx("path",{d:"M20 12h2"}),s.jsx("path",{d:"m6.34 17.66-1.41 1.41"}),s.jsx("path",{d:"m19.07 4.93-1.41 1.41"})]}),Trash2:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),s.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),s.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),s.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),TrendingUp:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),s.jsx("polyline",{points:"17 6 23 6 23 12"})]}),Truck:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"13",x:"1",y:"5",rx:"2"}),s.jsx("polygon",{points:"16 8 20 8 23 11 23 16 16 16 16 8"}),s.jsx("circle",{cx:"5.5",cy:"18.5",r:"2.5"}),s.jsx("circle",{cx:"18.5",cy:"18.5",r:"2.5"})]}),User:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),UserCog:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"18",cy:"15",r:"3"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M10 15H6a4 4 0 0 0-4 4v2"}),s.jsx("path",{d:"m21.7 16.4.9-.9"}),s.jsx("path",{d:"m15.2 13.9-.9-.9"}),s.jsx("path",{d:"m16.6 18.7.3 1.2"}),s.jsx("path",{d:"m19.1 12.2.3-1.2"}),s.jsx("path",{d:"m19.6 18.7-.4-1"}),s.jsx("path",{d:"m16.8 12.3-.4-1"}),s.jsx("path",{d:"m14.3 16.6 1-.4"}),s.jsx("path",{d:"m20.7 13.8 1-.4"})]}),Users:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Warehouse:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"}),s.jsx("path",{d:"M6 18h12"}),s.jsx("path",{d:"M6 14h12"}),s.jsx("rect",{width:"12",height:"12",x:"6",y:"10"})]}),Wind:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"}),s.jsx("path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2"}),s.jsx("path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2"})]}),X:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"18",x2:"6",y1:"6",y2:"18"}),s.jsx("line",{x1:"6",x2:"18",y1:"6",y2:"18"})]})},te=({name:t,className:e="w-6 h-6",...n})=>{const r=cL[t];return r?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...n,children:r}):(console.warn(`Icon "${t}" not found`),null)},$N=({text:t})=>s.jsxs("div",{className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-gray-900/90 dark:bg-black/90 backdrop-blur text-white text-sm font-medium rounded-md shadow-lg whitespace-nowrap z-50 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-opacity delay-150 pointer-events-none",children:[t,s.jsx("div",{className:"absolute top-1/2 -left-1 -translate-y-1/2 w-0 h-0 border-y-4 border-y-transparent border-r-4 border-r-gray-900/90 dark:border-r-black/90"})]}),dL=({isOpen:t,setOpen:e})=>{const{language:n,t:r}=_e(),{can:i}=Zs(),{pathname:l}=mr(),[c,d]=S.useState({}),f=S.useMemo(()=>gk.map(g=>{if(!g.permission||i(g.permission))if(g.children){const N=g.children.filter(T=>!T.permission||i(T.permission));if(N.length>0)return{...g,children:N};if(g.path)return{...g,children:[]}}else return g;return null}).filter(g=>g!==null),[i]);S.useEffect(()=>{const g={};f.forEach(N=>{N.children&&N.children.some(C=>C.path&&l.startsWith(C.path))&&(g[N.label.en]=!0)}),d(g)},[l,f]);const h=g=>{d(N=>({...N,[g]:!N[g]}))},m=({item:g})=>s.jsxs("div",{className:"relative group",children:[s.jsxs(sw,{to:g.path,onClick:()=>{window.innerWidth<768&&e(!1)},className:({isActive:N})=>`flex items-center p-2 my-1 rounded-md transition-all duration-200 w-full ${N?"bg-blue-600/90 text-white shadow-lg shadow-blue-500/30 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[s.jsx(te,{name:g.icon,className:"w-5 h-5 flex-shrink-0"}),t&&s.jsx("span",{className:"ml-3 whitespace-nowrap",children:g.label[n]})]}),!t&&s.jsx($N,{text:g.label[n]})]}),x=({item:g})=>{var C,w;const N=((C=g.children)==null?void 0:C.some(E=>E.path&&l.startsWith(E.path)))||!1,T=c[g.label.en]||!1;return s.jsxs("div",{children:[s.jsxs("div",{className:"relative group",children:[s.jsxs("div",{onClick:()=>h(g.label.en),className:`flex items-center justify-between p-2 my-1 rounded-md cursor-pointer transition-all duration-200 ${N?"bg-blue-100/80 dark:bg-blue-900/40 font-semibold text-blue-800 dark:text-blue-200 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:g.icon,className:"w-5 h-5 flex-shrink-0"}),t&&s.jsx("span",{className:"ml-3 whitespace-nowrap",children:g.label[n]})]}),t&&s.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${T?"rotate-180":""}`})]}),!t&&s.jsx($N,{text:g.label[n]})]}),T&&t&&s.jsx("div",{className:"pl-6 ml-4 border-l-2 border-blue-200/50 dark:border-blue-800/50",children:(w=g.children)==null?void 0:w.map(E=>s.jsx(m,{item:E},E.path))})]})};return s.jsxs("aside",{className:`fixed top-0 left-0 h-full bg-white/70 dark:bg-black/40 backdrop-blur-xl border-r border-white/20 dark:border-gray-700/50 transition-all duration-300 z-50 ${t?"w-64":"w-16"} ${t?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[s.jsxs("div",{className:"flex items-center justify-between p-3 h-[73px]",children:[t&&s.jsx("span",{className:"text-xl font-bold ml-1 text-gray-800 dark:text-white",children:r("appName")}),s.jsx("button",{onClick:()=>e(!t),className:"p-2 rounded-md hover:bg-white/50 dark:hover:bg-white/10 hidden md:inline-flex text-gray-600 dark:text-gray-300",children:s.jsx(te,{name:"Menu",className:"w-6 h-6"})})]}),s.jsx("nav",{className:"p-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700",style:{height:"calc(100vh - 73px)"},children:f.map(g=>g.children&&g.children.length>0?s.jsx(x,{item:g},g.label.en):s.jsx(m,{item:g},g.path))})]})},se=({children:t,variant:e="primary",className:n="",type:r="button",...i})=>{const l="px-4 py-2 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",c={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 focus:ring-gray-500"};return s.jsx("button",{type:r,className:`${l} ${c[e]} ${n}`,...i,children:t})},uL=()=>{const{notifications:t}=oL(),{t:e}=_e(),[n,r]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{const d=f=>{i.current&&!i.current.contains(f.target)&&r(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]);const l=d=>{switch(d){case"MODULE_UNASSIGNED":return s.jsx(te,{name:"Grid",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_NEARING":return s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_OVERDUE":return s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-red-500 flex-shrink-0"});default:return s.jsx(te,{name:"Bell",className:"w-5 h-5 text-gray-500 flex-shrink-0"})}},c=(d,f)=>{let h=e(d);for(const m in f)h=h.replace(`{${m}}`,String(f[m]));return h};return s.jsxs("div",{className:"relative",ref:i,children:[s.jsxs("button",{onClick:()=>r(!n),className:"relative p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900","aria-label":e("notifications_count").replace("{count}",String(t.length)),children:[s.jsx(te,{name:"Bell",className:"w-6 h-6"}),t.length>0&&s.jsxs("span",{className:"absolute top-0 right-0 flex h-5 w-5",children:[s.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),s.jsx("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-red-500 text-white text-xs items-center justify-center",children:t.length})]})]}),n&&s.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-w-xs sm:max-w-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-2xl z-50",children:[s.jsx("div",{className:"p-3 font-semibold border-b border-gray-200 dark:border-gray-700",children:e("notifications")}),s.jsx("ul",{className:"max-h-96 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-700",children:t.length>0?t.map(d=>s.jsx("li",{children:s.jsxs(Ls,{to:d.path,onClick:()=>r(!1),className:"flex items-start gap-3 p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[l(d.type),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm",children:c(d.messageKey,d.messageParams)}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(d.date).toLocaleDateString()})]})]})},d.id)):s.jsx("li",{className:"p-4 text-center text-sm text-gray-500 dark:text-gray-400",children:e("noNotifications")})})]})]})},ot=({isOpen:t,onClose:e,title:n,children:r,footer:i,widthClass:l="max-w-4xl"})=>{const{t:c}=_e(),[d,f]=S.useState(!1);return S.useEffect(()=>(f(!0),()=>f(!1)),[]),S.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),S.useEffect(()=>{const h=m=>{m.key==="Escape"&&e()};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[e]),!t||!d?null:mk.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-[1050]",onClick:e,children:s.jsxs("div",{className:`bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-xl shadow-2xl flex flex-col w-full m-4 ${l} max-h-[90vh] animate-in fade-in zoom-in-95 duration-200`,onClick:h=>h.stopPropagation(),children:[s.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:n}),s.jsx("button",{onClick:e,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:s.jsx(te,{name:"X",className:"w-6 h-6"})})]}),s.jsx("main",{className:"p-6 overflow-y-auto flex-grow custom-scrollbar",children:r}),i&&s.jsx("footer",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:i})]})}),document.body)},hL=({isOpen:t,onClose:e,onScan:n})=>{const{t:r}=_e(),i=S.useRef(null),[l,c]=S.useState("");return S.useEffect(()=>(t&&!i.current&&setTimeout(()=>{try{const d=new Html5QrcodeScanner("qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);d.render(f=>{d.clear().then(()=>{n(f)})},f=>{}),i.current=d}catch{c("Camera access needed or library missing.")}},100),()=>{i.current&&(i.current.clear().catch(d=>console.error(d)),i.current=null)}),[t,n]),s.jsx(ot,{isOpen:t,onClose:e,title:r("scanQRCode"),widthClass:"max-w-md",children:s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("div",{id:"qr-reader",className:"w-full"}),l&&s.jsx("p",{className:"text-red-500 mt-2",children:l}),s.jsx("p",{className:"text-sm text-gray-500 mt-4 text-center",children:r("scanInstruction")})]})})},An=({status:t})=>{const{t:e}=_e();if(!t)return null;const n={FREE:{textKey:"status_FREE",color:"gray"},ASSIGNED:{textKey:"status_ASSIGNED",color:"green"},CREATED:{textKey:"status_CREATED",color:"indigo"},CUTTING:{textKey:"status_CUTTING",color:"orange"},PLANTED:{textKey:"status_PLANTED",color:"blue"},GROWING:{textKey:"status_GROWING",color:"cyan"},HARVESTED:{textKey:"status_HARVESTED",color:"yellow"},DRYING:{textKey:"status_DRYING",color:"orange"},BAGGING:{textKey:"status_BAGGING",color:"purple"},IN_STOCK:{textKey:"status_IN_STOCK",color:"pink"},EXPORTED:{textKey:"status_EXPORTED",color:"red"},MAINTENANCE:{textKey:"status_MAINTENANCE",color:"gray"},STORED:{textKey:"status_STORED",color:"gray"},[Jt.AWAITING_OUTBOUND]:{textKey:"status_AWAITING_OUTBOUND",color:"yellow"},[Jt.IN_TRANSIT]:{textKey:"status_IN_TRANSIT",color:"blue"},[Jt.COMPLETED]:{textKey:"status_COMPLETED",color:"green"},[Jt.CANCELLED]:{textKey:"status_CANCELLED",color:"red"},LOW:{textKey:"severity_LOW",color:"cyan"},MEDIUM:{textKey:"severity_MEDIUM",color:"yellow"},HIGH:{textKey:"severity_HIGH",color:"orange"},CRITICAL:{textKey:"severity_CRITICAL",color:"red"},OPEN:{textKey:"status_OPEN",color:"blue"},IN_PROGRESS:{textKey:"status_IN_PROGRESS",color:"purple"},RESOLVED:{textKey:"status_RESOLVED",color:"green"},CLOSED:{textKey:"status_CLOSED",color:"gray"},PERMANENT:{textKey:"employeeType_PERMANENT",color:"blue"},CASUAL:{textKey:"employeeType_CASUAL",color:"green"},ACTIVE:{textKey:"status_ACTIVE",color:"green"},INACTIVE:{textKey:"status_INACTIVE",color:"red"}},{textKey:r,color:i}=n[t]||{textKey:t,color:"gray"},l=e(r)||t,c={green:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700/50 dark:text-gray-300",indigo:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",cyan:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/50 dark:text-cyan-300",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",purple:"bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300",pink:"bg-pink-100 text-pink-800 dark:bg-pink-900/50 dark:text-pink-300",red:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${c[i]}`,children:l})},ze=({children:t,className:e="",title:n,onClick:r})=>{const i=`
    bg-white/80 dark:bg-gray-800/60
    backdrop-blur-xl
    border border-white/20 dark:border-gray-700/50
    rounded-xl shadow-xl p-6 
    ${r?"cursor-pointer hover:bg-white/90 dark:hover:bg-gray-800/70 transition-all":""} 
    ${e}
  `;return s.jsxs("div",{className:i.trim(),onClick:r,children:[n&&s.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:n}),t]})},fL=({isOpen:t,onClose:e,scannedData:n})=>{var g,N,T,C;const{t:r,language:i}=_e(),{modules:l,cultivationCycles:c,sites:d,farmers:f,seaweedTypes:h}=qe(),m=S.useMemo(()=>{if(!n)return null;let w,E;if(n.type==="module"?(w=l.find(j=>j.id===n.id),w&&(E=c.filter(j=>j.moduleId===w.id).sort((j,O)=>new Date(O.plantingDate).getTime()-new Date(j.plantingDate).getTime())[0])):n.type==="batch"&&(E=c.find(j=>j.id===n.id),E&&(w=l.find(j=>j.id===E.moduleId))),!w)return null;const D=d.find(j=>j.id===w.siteId),I=D==null?void 0:D.zones.find(j=>j.id===w.zoneId),k=w.farmerId?f.find(j=>j.id===w.farmerId):void 0,M=E?h.find(j=>j.id===E.seaweedTypeId):void 0;return{module:w,cycle:E,site:D,zone:I,farmer:k,seaweedType:M}},[n,l,c,d,f,h]);if(!m)return null;const x=(n==null?void 0:n.type)==="module"?m.module.code:m.cycle?`${((g=m.seaweedType)==null?void 0:g.name)||r("batch")} - ${new Date(m.cycle.plantingDate).toLocaleDateString()}`:r("unknown_batch");return s.jsx(ot,{isOpen:t,onClose:e,title:r("traceabilityReport"),widthClass:"max-w-3xl",footer:s.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded",children:r("close")}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-800 rounded-full",children:s.jsx("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-blue-900 dark:text-blue-100 uppercase",children:x}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 uppercase tracking-wide",children:(n==null?void 0:n.type)==="module"?r("moduleTraceability"):r("batchTraceability")})]})]}),s.jsx(ze,{title:r("originInformation"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("site")}),s.jsx("p",{className:"font-semibold",children:(N=m.site)==null?void 0:N.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("zone")}),s.jsx("p",{className:"font-semibold",children:(T=m.zone)==null?void 0:T.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("module")}),s.jsx("p",{className:"font-semibold font-mono",children:m.module.code})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("farmer")}),s.jsx("p",{className:"font-semibold",children:m.farmer?`${m.farmer.firstName} ${m.farmer.lastName}`:r("unassigned")})]})]})}),m.cycle?s.jsxs(ze,{title:r("batchHistory"),children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("seaweedType")}),s.jsx("p",{className:"font-semibold",children:(C=m.seaweedType)==null?void 0:C.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("status")}),s.jsx("div",{className:"mt-1",children:s.jsx(An,{status:m.cycle.status})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("initialWeight")}),s.jsxs("p",{className:"font-semibold",children:[m.cycle.initialWeight," kg"]})]})]}),s.jsxs("div",{className:"mt-4 relative border-l-2 border-gray-200 dark:border-gray-700 ml-3 space-y-6 pl-6 pb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-blue-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("plantingDate")}),s.jsx("p",{className:"font-semibold",children:new Date(m.cycle.plantingDate).toLocaleDateString(i,{dateStyle:"medium"})})]}),m.cycle.harvestDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-green-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("harvestDate")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.harvestDate).toLocaleDateString(i,{dateStyle:"medium"}),s.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.harvestedWeight," kg"]})]})]}),m.cycle.dryingStartDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-yellow-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("dryingProcess")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.dryingStartDate).toLocaleDateString(i,{dateStyle:"medium"}),m.cycle.dryingCompletionDate&&` - ${new Date(m.cycle.dryingCompletionDate).toLocaleDateString(i,{dateStyle:"medium"})}`]})]}),m.cycle.baggedDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-purple-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("baggedDate")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.baggedDate).toLocaleDateString(i,{dateStyle:"medium"}),s.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.baggedWeightKg," kg / ",m.cycle.baggedBagsCount," ",r("bales")]})]})]})]})]}):s.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800",children:r("noActiveCycleFoundForModule")})]})})},mL=({onMenuClick:t})=>{const{settings:e,updateSettings:n}=Ke(),{t:r}=_e(),{currentUser:i,logout:l}=Zs(),c=Qs(),[d,f]=S.useState(!1),h=S.useRef(null),[m,x]=S.useState(!1),[g,N]=S.useState(null),[T,C]=S.useState(!1),[w,E]=S.useState(navigator.onLine),D=e.theme.className.includes("dark");S.useEffect(()=>{const j=()=>E(!0),O=()=>E(!1);return window.addEventListener("online",j),window.addEventListener("offline",O),()=>{window.removeEventListener("online",j),window.removeEventListener("offline",O)}},[]);const I=()=>{const j=e.theme.id.includes("glass");let O;D?O=j?"light-glass":"light-formal":O=j?"dark-glass":"dark-formal";const A=ku.find(F=>F.id===O);A&&n({...e,theme:A})},k=()=>{l(),c("/login")},M=j=>{x(!1);try{const O=JSON.parse(j);if(O.t&&O.id){const A=O.t==="m"?"module":"batch";N({type:A,id:O.id}),C(!0)}else alert(r("invalidQRCode"))}catch{alert(r("invalidQRCode"))}};return S.useEffect(()=>{const j=O=>{h.current&&!h.current.contains(O.target)&&f(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"bg-white/70 dark:bg-black/40 backdrop-blur-md shadow-sm p-2 sm:p-4 flex items-center justify-between sticky top-0 z-40 border-b border-white/20 dark:border-gray-700/50",children:[s.jsxs("div",{className:"flex items-center min-w-0",children:[" ",s.jsx("button",{onClick:t,className:"p-2 -ml-2 mr-2 rounded-md text-gray-600 dark:text-gray-300 md:hidden hover:bg-gray-200 dark:hover:bg-gray-700",children:s.jsx(te,{name:"Menu",className:"w-6 h-6"})}),s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-8 sm:h-10 mr-3 sm:mr-4 flex-shrink-0"}),s.jsx("h1",{className:"hidden sm:block text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 truncate",children:e.company.name})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`flex items-center px-2 py-1 rounded-full text-xs font-medium ${w?"bg-green-100/80 text-green-800":"bg-red-100/80 text-red-800"}`,children:[s.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${w?"bg-green-500":"bg-red-500"}`}),w?"Online":"Offline"]}),s.jsxs(se,{variant:"secondary",onClick:()=>x(!0),className:"hidden sm:flex !py-1.5 !px-3",children:[s.jsx(te,{name:"QrCode",className:"w-5 h-5 mr-1"}),r("scan")]}),s.jsx(se,{variant:"ghost",onClick:()=>x(!0),className:"sm:hidden p-2 !rounded-full",children:s.jsx(te,{name:"QrCode",className:"w-6 h-6"})}),s.jsx(uL,{}),s.jsx(se,{variant:"ghost",onClick:I,className:"p-2 !rounded-full","aria-label":r("toggleTheme"),children:s.jsx(te,{name:D?"Sun":"Moon",className:"w-6 h-6"})}),i&&s.jsxs("div",{className:"relative",ref:h,children:[s.jsxs("button",{onClick:()=>f(!d),className:"flex items-center gap-2 p-1 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors",children:[s.jsxs("span",{className:"font-semibold hidden sm:inline text-gray-700 dark:text-gray-200",children:[i.firstName," ",i.lastName]}),s.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm",children:[i.firstName.charAt(0),i.lastName.charAt(0)]})]}),d&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-xl z-50 p-1",children:[s.jsxs("button",{onClick:()=>{f(!1),c("/profile")},className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"User",className:"w-4 h-4"}),r("profile")]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),s.jsxs("button",{onClick:k,className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"LogOut",className:"w-4 h-4"}),r("logout")]})]})]})]})]}),s.jsx(hL,{isOpen:m,onClose:()=>x(!1),onScan:M}),s.jsx(fL,{isOpen:T,onClose:()=>C(!1),scannedData:g})]})},pL=()=>{const{settings:t}=Ke(),[e,n]=S.useState(!0);return s.jsxs("div",{className:`${t.theme.className} ${t.theme.font} min-h-screen flex transition-colors duration-500 relative bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center bg-fixed text-gray-800 dark:text-gray-200`,children:[s.jsx("div",{className:"absolute inset-0 bg-gray-100/80 dark:bg-black/70 backdrop-blur-sm z-0 pointer-events-none"}),s.jsxs("div",{className:"flex flex-1 z-10 relative h-full",children:[e&&s.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 bg-black/50 z-40 md:hidden"}),s.jsx(dL,{isOpen:e,setOpen:n}),s.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${e?"md:ml-64":"md:ml-16"}`,children:[s.jsx(mL,{onMenuClick:()=>n(r=>!r)}),s.jsx("main",{className:"p-4 sm:p-6 overflow-y-auto flex-grow scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent",children:s.jsx(Z_,{})})]})]})]})},Or=({permission:t})=>{const{currentUser:e,can:n}=Zs();return e?t&&!n(t)?s.jsx(rc,{to:"/dashboard",replace:!0}):s.jsx(Z_,{}):s.jsx(rc,{to:"/login",replace:!0})},gL=()=>{const{t}=_e(),{settings:e}=Ke(),n=Qs(),{login:r}=Zs(),[i,l]=S.useState("admin@seafarm.com"),[c,d]=S.useState("password"),[f,h]=S.useState(""),[m,x]=S.useState(!1),g=async N=>{N.preventDefault(),h(""),x(!0),await r(i,c)?n("/dashboard"):(h(t("invalidCredentials")),x(!1))};return s.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),s.jsxs("div",{className:"w-full max-w-4xl z-10 grid grid-cols-1 md:grid-cols-2 rounded-2xl overflow-hidden shadow-2xl border border-gray-700",children:[s.jsxs("div",{className:"hidden md:flex flex-col justify-center items-center p-8 bg-gradient-to-br from-blue-900/80 to-black/80 text-white relative",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-20 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.5),transparent_70%)]"}),s.jsx("h1",{className:"text-4xl font-bold mb-4 relative z-10",children:t("welcomeBack")}),s.jsx("p",{className:"text-center text-gray-300 relative z-10",children:"Efficiently manage your seaweed farm operations, inventory, and payments in one place."}),s.jsxs("div",{className:"mt-8 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 text-sm text-gray-300 relative z-10",children:[s.jsx("p",{className:"font-semibold text-blue-400 mb-1",children:"Default Access:"}),s.jsx("p",{children:"Email: admin@seafarm.com"}),s.jsx("p",{children:"Pass: password"})]})]}),s.jsxs("div",{className:"p-8 md:p-12 bg-black/80 backdrop-blur-md flex flex-col justify-center",children:[s.jsx("div",{className:"flex justify-center mb-8",children:e.company.logoUrl?s.jsx("img",{src:e.company.logoUrl,alt:"Logo",className:"h-16 object-contain drop-shadow-lg"}):s.jsx("div",{className:"h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:s.jsx(te,{name:"Activity",className:"w-8 h-8 text-white"})})}),s.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-2",children:"Login"}),s.jsx("p",{className:"text-gray-400 text-center mb-8",children:"Enter your credentials to access your account"}),s.jsxs("form",{onSubmit:g,className:"space-y-6",children:[f&&s.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center",children:f}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:t("email")}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(te,{name:"User",className:"h-5 w-5 text-gray-500"})}),s.jsx("input",{type:"email",value:i,onChange:N=>l(N.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:"name@company.com"})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:t("password")}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(te,{name:"Lock",className:"h-5 w-5 text-gray-500"})}),s.jsx("input",{type:"password",value:c,onChange:N=>d(N.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:""})]})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("label",{className:"flex items-center text-gray-400 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 bg-gray-800 border-gray-600 rounded"}),s.jsx("span",{className:"ml-2",children:"Remember me"})]}),s.jsx(Ls,{to:"/forgot-password",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:t("forgotPassword")})]}),s.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 px-4 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold rounded-lg shadow-lg transform transition-all hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center",children:m?s.jsx(te,{name:"Activity",className:"animate-spin h-5 w-5"}):"Login"})]}),s.jsxs("div",{className:"mt-6 flex flex-col gap-2 text-center text-sm text-gray-400",children:[s.jsxs("p",{children:["Don't have an account?"," ",s.jsx(Ls,{to:"/signup",className:"text-blue-400 hover:text-blue-300 font-bold transition-colors",children:"Sign Up"})]}),s.jsx(Ls,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline mt-2",children:t("termsOfUse")})]})]})]})]})},yL="pk_test_TYooMQauvdEDq54NiTphI7jx",xL=({amount:t,currency:e,onSuccess:n,onProcessing:r,buttonText:i="Pay Now"})=>{const l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useRef(null),[h,m]=S.useState(null),[x,g]=S.useState(!1);S.useEffect(()=>{if(window.Stripe&&l.current&&!c.current)try{const T=window.Stripe(yL);c.current=T;const C=T.elements();d.current=C;const w={base:{color:"#ffffff",fontFamily:'"Segoe UI", "Roboto", "Helvetica Neue", sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#9ca3af"},backgroundColor:"transparent"},invalid:{color:"#ef4444",iconColor:"#ef4444"}},E=C.create("card",{style:w,hidePostalCode:!0});E.mount(l.current),f.current=E,E.on("change",D=>{g(D.complete),m(D.error?D.error.message:null)})}catch(T){console.error("Stripe initialization error:",T),m("Failed to load payment system.")}return()=>{f.current}},[]);const N=async T=>{if(T.preventDefault(),!c.current||!f.current)return;r(!0);const C=await c.current.createPaymentMethod({type:"card",card:f.current});C.error?(m(C.error.message),r(!1)):setTimeout(()=>{n(C.paymentMethod.id),r(!1)},1e3)};return s.jsxs("form",{onSubmit:N,className:"w-full",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-2",children:"Card Details (Secure via Stripe)"}),s.jsx("div",{ref:l,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent transition-all min-h-[46px]"}),h&&s.jsxs("div",{className:"mt-2 text-sm text-red-400 flex items-center",children:[s.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),h]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-4",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(te,{name:"Lock",className:"w-3 h-3"})," SSL Secure Payment"]}),s.jsx("span",{children:"Powered by Stripe"})]}),s.jsxs("button",{type:"submit",disabled:!c.current||!x,className:"w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 rounded-lg font-bold shadow-lg transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(te,{name:"CreditCard",className:"w-4 h-4"})," ",i]})]})},vL=()=>{const{t}=_e(),e=Qs(),{signup:n}=Zs(),[r,i]=S.useState("account"),[l,c]=S.useState(!1),[d,f]=S.useState(""),[h,m]=S.useState({firstName:"",lastName:"",email:"",password:"",organizationName:""}),[x,g]=S.useState("starter"),[N,T]=S.useState(""),C=[{id:"starter",name:"Starter Plan",price:20,limit:5,description:"Perfect for small farms getting started.",features:["Up to 5 Users","Basic Reporting","Map View","Inventory Management"]},{id:"pro",name:"Pro Plan",price:35,limit:10,description:"Advanced features for growing operations.",features:["Up to 10 Users","Advanced AI Analytics","Priority Support","Multiple Sites"]}],w=k=>{if(k.preventDefault(),h.password.length<6){f("Password must be at least 6 characters");return}f(""),i("plan")},E=k=>{g(k),i("payment")},D=async k=>{c(!0),f("");try{console.log("Payment Method ID received:",k),await n({firstName:h.firstName,lastName:h.lastName,email:h.email,password:h.password,organizationName:h.organizationName,planId:x,roleId:"SITE_MANAGER",paymentMethodId:k})?e("/dashboard"):(f(t("emailExists")),c(!1))}catch{f("Registration failed. Please try again."),c(!1)}},I=C.find(k=>k.id===x);return s.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center text-white",children:[s.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),s.jsxs("div",{className:"w-full max-w-5xl z-10 grid grid-cols-1 md:grid-cols-12 rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-black/40 backdrop-blur-xl min-h-[600px]",children:[s.jsxs("div",{className:"md:col-span-5 bg-gradient-to-b from-blue-900/90 to-black/90 p-8 flex flex-col justify-between relative overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-cyan-500/20 rounded-full filter blur-3xl -translate-y-1/2 translate-x-1/2"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Get Started"}),s.jsx("p",{className:"text-gray-300 text-sm",children:"Join the future of seaweed farming management."}),s.jsxs("div",{className:"mt-10 space-y-6",children:[s.jsxs("div",{className:`flex items-center gap-4 ${r==="account"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="account"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"1"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Account"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Your details & organization"})]})]}),s.jsxs("div",{className:`flex items-center gap-4 ${r==="plan"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="plan"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"2"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Plan"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Choose your capacity"})]})]}),s.jsxs("div",{className:`flex items-center gap-4 ${r==="payment"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="payment"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"3"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Payment"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Secure credit card checkout"})]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-8",children:[s.jsxs("div",{className:"text-xs text-gray-400",children:["Already have an account? ",s.jsx(Ls,{to:"/login",className:"text-cyan-400 hover:underline",children:"Log In"})]}),s.jsx(Ls,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline",children:t("termsOfUse")})]})]}),s.jsxs("div",{className:"md:col-span-7 p-8 md:p-12 flex flex-col justify-center relative",children:[d&&s.jsx("div",{className:"absolute top-4 left-8 right-8 p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center z-20",children:d}),r==="account"&&s.jsxs("form",{onSubmit:w,className:"space-y-5 animate-fade-in",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Create Account"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"First Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.firstName,onChange:k=>m({...h,firstName:k.target.value}),placeholder:"John"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Last Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.lastName,onChange:k=>m({...h,lastName:k.target.value}),placeholder:"Doe"})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Email Address"}),s.jsx("input",{type:"email",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.email,onChange:k=>m({...h,email:k.target.value}),placeholder:"john@example.com"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Organization Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.organizationName,onChange:k=>m({...h,organizationName:k.target.value}),placeholder:"Ocean Harvest Ltd."})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Password"}),s.jsx("input",{type:"password",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.password,onChange:k=>m({...h,password:k.target.value}),placeholder:""})]}),s.jsxs("div",{className:"text-xs text-gray-400",children:[t("agreeToTerms")," ",s.jsx(Ls,{to:"/terms",className:"text-cyan-400 hover:underline",children:t("termsOfUse")})]}),s.jsx("button",{type:"submit",className:"w-full py-3 mt-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 rounded-lg font-bold shadow-lg transition-all",children:"Next: Select Plan"})]}),r==="plan"&&s.jsxs("div",{className:"space-y-6 animate-fade-in",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Select Plan"}),s.jsx("button",{onClick:()=>i("account"),className:"text-sm text-gray-400 hover:text-white",children:"Back"})]}),s.jsx("div",{className:"grid gap-4",children:C.map(k=>s.jsxs("div",{onClick:()=>E(k.id),className:`p-4 rounded-xl border-2 cursor-pointer transition-all flex justify-between items-center group
                                         ${x===k.id?"border-blue-500 bg-blue-900/20":"border-gray-700 bg-gray-800/30 hover:border-gray-500"}`,children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-lg text-white group-hover:text-blue-400 transition-colors",children:k.name}),s.jsx("p",{className:"text-sm text-gray-400",children:k.description}),s.jsx("ul",{className:"mt-2 text-xs text-gray-300 space-y-1",children:k.features.slice(0,2).map(M=>s.jsxs("li",{className:"flex items-center gap-1",children:[s.jsx(te,{name:"Check",className:"w-3 h-3 text-green-400"})," ",M]},M))})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",k.price,s.jsx("span",{className:"text-sm font-normal text-gray-400",children:"/mo"})]}),s.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Up to ",k.limit," users"]})]})]},k.id))})]}),r==="payment"&&s.jsxs("div",{className:"space-y-5 animate-fade-in",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Secure Payment"}),s.jsx("button",{type:"button",onClick:()=>i("plan"),className:"text-sm text-gray-400 hover:text-white",children:"Change Plan"})]}),s.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg flex justify-between items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-bold text-white",children:I==null?void 0:I.name}),s.jsx("p",{className:"text-xs text-gray-400",children:"Billed monthly"})]}),s.jsxs("p",{className:"text-xl font-bold text-white",children:["$",I==null?void 0:I.price]})]}),s.jsxs("div",{className:"space-y-1 mb-4",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Cardholder Name"}),s.jsxs("div",{className:"relative",children:[s.jsx(te,{name:"User",className:"absolute left-3 top-3.5 w-5 h-5 text-gray-500"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 pl-10 text-white focus:ring-2 focus:ring-blue-500 outline-none",value:N,onChange:k=>T(k.target.value),placeholder:"JOHN DOE"})]})]}),l?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[s.jsx(te,{name:"Activity",className:"w-10 h-10 text-blue-500 animate-spin"}),s.jsx("p",{className:"text-gray-300",children:"Processing Payment..."})]}):s.jsx(xL,{amount:(I==null?void 0:I.price)||20,currency:"USD",onSuccess:D,onProcessing:c,buttonText:`Pay $${I==null?void 0:I.price} & Join`})]})]})]})]})},de=({label:t,id:e,containerClassName:n="",error:r,type:i,className:l="",...c})=>{const{required:d}=c,f=r?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:`w-full ${n}`,children:[t&&s.jsxs("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t,d&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:e,type:i,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            placeholder-gray-400
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0 
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            ${f} 
            ${i==="date"?"pr-10":""}
            ${l}
          `,...c}),i==="date"&&s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:s.jsx(te,{name:"Calendar",className:"w-5 h-5 text-gray-400"})})]}),r&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:r})]})},bL=()=>{const{t}=_e(),{settings:e}=Ke(),{sendPasswordResetLink:n}=Zs(),[r,i]=S.useState(""),[l,c]=S.useState(!1),[d,f]=S.useState(!1),[h,m]=S.useState(null),x=async g=>{g.preventDefault(),c(!0);const N=await n(r);m(N),c(!1),f(!0)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-12"})}),s.jsx(ze,{title:t("forgotPasswordTitle"),children:d?s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("resetLinkSentTitle")}),s.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:t("resetLinkSentInstructions")}),h&&s.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg text-left",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4 text-blue-600"}),s.jsx("p",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase",children:"Demo Email Simulator"})]}),s.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["In a production environment, the following link would be sent to ",s.jsx("strong",{children:r}),". For this demo, click the link below to proceed:"]}),s.jsx(Ls,{to:h.substring(h.indexOf("#")+1),className:"text-sm font-medium text-blue-600 hover:text-blue-500 underline break-all",children:h})]}),s.jsx(Ls,{to:"/login",children:s.jsx(se,{className:"w-full mt-6",children:t("backToLogin")})})]}):s.jsxs("form",{onSubmit:x,className:"space-y-6",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("forgotPasswordInstructions")}),s.jsx(de,{label:t("email"),id:"email",type:"email",value:r,onChange:g=>i(g.target.value),required:!0,autoComplete:"email",autoFocus:!0}),s.jsx(se,{type:"submit",className:"w-full",disabled:l||!r,children:l?s.jsx(te,{name:"Activity",className:"animate-spin"}):t("sendResetLink")}),s.jsx("p",{className:"mt-6 text-center text-sm",children:s.jsx(Ls,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:t("backToLogin")})})]})})]})})},NL=()=>{const{t}=_e(),{settings:e}=Ke(),n=Qs(),[r]=wg(),{resetPassword:i}=Zs(),[l,c]=S.useState(""),[d,f]=S.useState(""),[h,m]=S.useState(""),[x,g]=S.useState(""),[N,T]=S.useState(!1),[C,w]=S.useState(null);S.useEffect(()=>{const D=r.get("token");D||m(t("invalidOrExpiredToken")),w(D)},[r,t]);const E=async D=>{if(D.preventDefault(),l!==d){m(t("passwordMismatch"));return}if(!C){m(t("invalidOrExpiredToken"));return}m(""),g(""),T(!0),await i(C,l)?(g(t("passwordResetSuccess")),setTimeout(()=>{n("/login")},3e3)):m(t("invalidOrExpiredToken")),T(!1)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-12"})}),s.jsx(ze,{title:t("resetPasswordTitle"),children:x?s.jsx("div",{className:"p-3 text-center bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-md text-sm",children:x}):s.jsxs("form",{onSubmit:E,className:"space-y-6",children:[h&&s.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-md text-sm",children:h}),s.jsx(de,{label:t("newPassword"),id:"password",type:"password",value:l,onChange:D=>c(D.target.value),required:!0,autoComplete:"new-password",autoFocus:!0,disabled:!C||N}),s.jsx(de,{label:t("confirmNewPassword"),id:"confirmPassword",type:"password",value:d,onChange:D=>f(D.target.value),required:!0,autoComplete:"new-password",disabled:!C||N}),s.jsx(se,{type:"submit",className:"w-full",disabled:N||!C||!l||!d,children:N?s.jsx(te,{name:"Activity",className:"animate-spin"}):t("resetPassword")})]})})]})})};function bC(t,e){if(isNaN(t)||t===null)return"";const n=Math.abs(t),r=Math.floor(n),i=(n-r)*60,l=Math.floor(i),c=((i-l)*60).toFixed(2);let d="";return e?d=t>=0?"N":"S":d=t>=0?"E":"W",`${r} ${l}' ${c}" ${d}`}function wn(t){if(!t)throw new Error("Empty input");const e=t.trim();if(/^-?\d+(\.\d+)?$/.test(e)){const h=parseFloat(e);if(!isNaN(h))return h}const n=/(-?\d+(\.\d+)?)\s*(?:\s*(\d+(\.\d+)?)\s*')?(?:\s*(\d+(\.\d+)?)\s*")?\s*([NSEW])/i,r=e.match(n);if(!r){const h=e.match(/(-?\d+(\.\d+)?)\s*([NSEW])/i);if(h){const m=parseFloat(h[1]),x=h[3].toUpperCase();return(x==="S"||x==="W")&&m>0?-m:m}throw new Error(`Invalid coordinate format: "${t}"`)}const i=parseFloat(r[1]),l=parseFloat(r[3]||"0"),c=parseFloat(r[5]||"0"),d=r[7].toUpperCase();if(isNaN(i)||l<0||c<0)throw new Error(`Invalid numbers in DMS string: "${t}"`);let f=Math.abs(i)+l/60+c/3600;if((d==="S"||d==="W")&&(f=f*-1),(d==="N"||d==="S")&&Math.abs(f)>90)throw new Error(`Latitude out of range (-90 to 90): "${t}"`);if((d==="E"||d==="W")&&Math.abs(f)>180)throw new Error(`Longitude out of range (-180 to 180): "${t}"`);return f}function Qp(t){const e=[];for(const n of t)if(!(!n||!n.trim()))try{const r=n.split(",");if(r.length!==2)throw new Error("Invalid geo-point format, expected 'lat, lon'");const i=r[0].trim(),l=r[1].trim();if(!i||!l)continue;const c=wn(i),d=wn(l);e.push({x:d,y:c})}catch{}return e}function KN(t,e,n){if(!t)return"";let r;try{r=wn(t)}catch{return t}return e==="DD"?r.toFixed(6):bC(r,n)}function Ch(t,e,n){if(t<=0||e<=0||n<=0)return null;const r=(Math.log(e)-Math.log(t))/n*100;return parseFloat(r.toFixed(2))}const SL=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n}=qe(),{settings:r}=Ke(),{t:i,language:l}=_e(),c=S.useMemo(()=>{const d=[],f=[],h=new Date;for(let m=5;m>=0;m--){const x=new Date(h.getFullYear(),h.getMonth()-m,1);d.push(x.toLocaleDateString(l,{month:"short",year:"2-digit"})),f.push(0)}return n.forEach(m=>{if(m.harvestDate&&m.harvestedWeight){const x=new Date(m.harvestDate),g=(h.getFullYear()-x.getFullYear())*12+(h.getMonth()-x.getMonth());if(g>=0&&g<6){const N=(m.harvestedWeight||0)-(m.cuttingsTakenAtHarvestKg||0);f[5-g]+=N}}}),{labels:d,data:f}},[n,l]);return S.useEffect(()=>{if(!t.current)return;const d=r.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"line",data:{labels:c.labels,datasets:[{label:i("netHarvestedWeightKg"),data:c.data,fill:!0,backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgba(59, 130, 246, 1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,r.theme,i]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},_L=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n,seaweedTypes:r}=qe(),{settings:i}=Ke(),{t:l}=_e(),c=S.useMemo(()=>{const d={};n.forEach(h=>{if(h.harvestDate&&h.harvestedWeight&&h.initialWeight&&h.plantingDate){const m=(new Date(h.harvestDate).getTime()-new Date(h.plantingDate).getTime())/864e5,x=Ch(h.initialWeight,h.harvestedWeight,m);x!==null&&(d[h.seaweedTypeId]||(d[h.seaweedTypeId]={sgrSum:0,count:0}),d[h.seaweedTypeId].sgrSum+=x,d[h.seaweedTypeId].count++)}});const f=new Map(r.map(h=>[h.id,h.name]));return Object.entries(d).map(([h,{sgrSum:m,count:x}])=>({label:f.get(h)||l("unknown"),avgSGR:m/x}))},[n,r,l]);return S.useEffect(()=>{if(!t.current)return;const d=i.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("growthRate")+" (%)",data:c.map(x=>x.avgSGR),backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"% / day",color:f},ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},YN=()=>{const t=S.useRef(null),e=S.useRef(null),{sites:n,modules:r,cultivationCycles:i}=qe(),{t:l}=_e(),c=S.useMemo(()=>{const d=new Map;return i.forEach(f=>{if(f.harvestedWeight){const h=r.find(m=>m.id===f.moduleId);if(h){const m=(f.harvestedWeight||0)-(f.cuttingsTakenAtHarvestKg||0);d.set(h.siteId,(d.get(h.siteId)||0)+m)}}}),d},[i,r]);return S.useEffect(()=>{t.current&&!e.current&&(e.current=L.map(t.current,{center:[-18.76,46.86],zoom:6,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(e.current));const d=e.current;if(!d)return;setTimeout(()=>{d.invalidateSize()},100),d.eachLayer(h=>{(h instanceof L.Marker||h instanceof L.CircleMarker)&&d.removeLayer(h)});const f=Math.max(...Array.from(c.values()),1);n.forEach(h=>{if(h.location)try{const[m,x]=h.location.split(","),g=wn(m.trim()),N=wn(x.trim()),T=c.get(h.id)||0,C=5+T/f*20;L.circleMarker([g,N],{radius:C,fillColor:"#2563eb",color:"#1d4ed8",weight:1,opacity:1,fillOpacity:.6}).addTo(d).bindPopup(`<b>${h.name}</b><br>${l("netProduction")}: ${T.toFixed(0)} kg`)}catch{console.debug("Site without valid coordinates:",h.name,h.location)}})},[n,c,l]),s.jsx("div",{ref:t,className:"w-full h-full min-h-[600px] rounded-lg z-0"})},wL=()=>{const{farmers:t,cultivationCycles:e,modules:n}=qe(),{t:r}=_e(),i=S.useMemo(()=>{const w={};return e.forEach(E=>{if(E.harvestedWeight){const D=n.find(I=>I.id===E.moduleId);if(D!=null&&D.farmerId){w[D.farmerId]||(w[D.farmerId]={yield:0,cycles:0});const I=(E.harvestedWeight||0)-(E.cuttingsTakenAtHarvestKg||0);w[D.farmerId].yield+=I,w[D.farmerId].cycles++}}}),Object.entries(w).map(([E,D])=>{const I=t.find(k=>k.id===E);return{name:I?`${I.firstName} ${I.lastName}`:r("unknown"),yield:D.yield,cycles:D.cycles}})},[t,e,n,r]);if(i.length===0)return s.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:r("noDataForReport")});const l=window.Recharts;if(!l)return s.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Loading chart library..."});const{ResponsiveContainer:c,BubbleChart:d,XAxis:f,YAxis:h,ZAxis:m,Tooltip:x,CartesianGrid:g,Legend:N,Bubble:T}=l,C=({active:w,payload:E,label:D})=>{if(w&&E&&E.length){const I=E[0].payload;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded shadow-lg text-xs z-50",children:[s.jsx("p",{className:"font-bold text-gray-900 dark:text-white mb-1",children:I.name}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[r("totalYield"),": ",s.jsxs("span",{className:"font-semibold",children:[I.yield.toFixed(1)," kg"]})]}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[r("numberOfCyclesAxis"),": ",s.jsx("span",{className:"font-semibold",children:I.cycles})]})]})}return null};return s.jsx("div",{className:"w-full h-64",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(d,{data:i,children:[s.jsx(g,{strokeDasharray:"3 3"}),s.jsx(f,{dataKey:"yield",name:r("totalYieldKgAxis"),type:"number"}),s.jsx(h,{dataKey:"cycles",name:r("numberOfCyclesAxis"),type:"number"}),s.jsx(m,{dataKey:"yield",range:[10,100],name:r("totalYield")}),s.jsx(x,{content:s.jsx(C,{}),cursor:{strokeDasharray:"3 3"}}),s.jsx(N,{}),s.jsx(T,{name:`${r("totalYield")} (${r("netWeight")})`,dataKey:"yield",fill:"#8884d8"})]})})})},TL=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n,seaweedTypes:r}=qe(),{settings:i}=Ke(),{t:l}=_e(),c=S.useMemo(()=>{const d={};n.forEach(h=>{if(h.harvestedWeight){d[h.seaweedTypeId]||(d[h.seaweedTypeId]={yield:0,count:0});const m=(h.harvestedWeight||0)-(h.cuttingsTakenAtHarvestKg||0);d[h.seaweedTypeId].yield+=m,d[h.seaweedTypeId].count++}});const f=new Map(r.map(h=>[h.id,h.name]));return Object.entries(d).map(([h,{yield:m,count:x}])=>({label:f.get(h)||l("unknown"),avgYield:m/x}))},[n,r,l]);return S.useEffect(()=>{if(!t.current)return;const d=i.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("averageYieldKg"),data:c.map(x=>x.avgYield),backgroundColor:"rgba(139, 92, 246, 0.6)",borderColor:"rgba(139, 92, 246, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},CL=()=>{const{t}=_e(),{incidents:e,incidentTypes:n}=qe(),r=Qs(),i=S.useMemo(()=>[...e].sort((c,d)=>new Date(d.date).getTime()-new Date(c.date).getTime()).slice(0,5),[e]),l=S.useMemo(()=>new Map(n.map(c=>[c.id,c.name])),[n]);return s.jsxs("div",{className:"space-y-3 h-full overflow-y-auto",children:[i.map(c=>s.jsxs("div",{className:"flex items-start gap-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-900/50 cursor-pointer",onClick:()=>r("/monitoring/incidents"),children:[s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 mt-1 flex-shrink-0"}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"font-semibold text-sm",children:l.get(c.type)||c.type}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c.date})]}),s.jsx(An,{status:c.status})]},c.id)),i.length===0&&s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-gray-500",children:t("noIncidents")})})]})},EL=()=>{const{t}=_e();return s.jsxs("div",{className:"flex justify-between items-center h-full px-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Sun",className:"w-12 h-12 text-yellow-400 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold",children:"28C"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Sunny"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Wind: 12 km/h NE"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Humidity: 65%"})]})]})},IL=()=>{const{t}=_e(),e=Qs(),[n,r]=S.useState("director");return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl lg:text-4xl font-bold tracking-tight text-gray-900 dark:text-white",children:t("analyticalDashboard")}),s.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 p-1 rounded-lg flex",children:[s.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="director"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>r("director"),children:"Director"}),s.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="field"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>r("field"),children:"Field"})]})]}),n==="director"?s.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[s.jsx(ze,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("productionTrend"),children:s.jsx(SL,{})}),s.jsx(ze,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("growthRate"),children:s.jsx(_L,{})}),s.jsx(ze,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("yieldBySeaweedType"),children:s.jsx(TL,{})}),s.jsx(ze,{className:"col-span-12 md:col-span-6 lg:col-span-6 row-span-2",title:t("sitePerformance"),children:s.jsx(YN,{})}),s.jsx(ze,{className:"col-span-12 md:col-span-6 lg:col-span-6",title:t("farmerSegmentation"),children:s.jsx(wL,{})})]}):s.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[s.jsx(ze,{className:"col-span-12 lg:col-span-8 row-span-2 p-0 overflow-hidden",title:t("farmMapTitle"),children:s.jsx(YN,{})}),s.jsx(ze,{className:"col-span-12 lg:col-span-4 h-48",title:"Current Weather",children:s.jsx(EL,{})}),s.jsx(ze,{className:"col-span-12 lg:col-span-4 flex-grow flex flex-col",title:t("recentIncidents"),children:s.jsx(CL,{})}),s.jsx(ze,{className:"col-span-12",title:"Quick Actions",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsxs(se,{className:"flex-1 py-8 flex-col gap-2",onClick:()=>e("/monitoring/incidents"),children:[s.jsx(te,{name:"PlusCircle",className:"w-8 h-8"}),t("reportIncident")]}),s.jsxs(se,{className:"flex-1 py-8 flex-col gap-2",variant:"secondary",onClick:()=>e("/harvesting"),children:[s.jsx(te,{name:"Scissors",className:"w-8 h-8"}),t("harvest")]})]})})]})]})},ke=({label:t,id:e,containerClassName:n="",children:r,error:i,className:l="",...c})=>{const d=i?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:`w-full ${n}`,children:[t&&s.jsx("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{id:e,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            appearance-none pr-8
            ${d}
            ${l}
          `,...c,children:r}),s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-gray-500"})})]}),i&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},Rt=S.forwardRef(({className:t="",...e},n)=>s.jsx("input",{ref:n,type:"checkbox",className:`
        h-4 w-4 rounded 
        border-gray-300 dark:border-gray-600 
        text-blue-600 focus:ring-blue-500 
        bg-white dark:bg-gray-700 
        cursor-pointer 
        transition-all duration-200 
        focus:ring-offset-2 dark:focus:ring-offset-gray-900
        ${t}
      `,...e}));Rt.displayName="Checkbox";const Qt=({isOpen:t,onClose:e,onConfirm:n,title:r,message:i,confirmText:l,cancelText:c,confirmDisabled:d=!1})=>{const{t:f}=_e(),h=s.jsx(s.Fragment,{children:d?s.jsx(se,{variant:"secondary",onClick:e,children:f("close")}):s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:c||f("cancel")}),s.jsx(se,{variant:"danger",onClick:n,children:l||f("delete")})]})});return s.jsx(ot,{isOpen:t,onClose:e,title:r,widthClass:"max-w-md",footer:h,children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-red-100 dark:bg-red-900/50 mr-4",children:s.jsx(te,{name:"AlertTriangle",className:"h-6 w-6 text-red-600 dark:text-red-400"})}),s.jsx("div",{children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i})})]})})},NC=(t,e)=>e===""?t:t.replace(/\B(?=(\d{3})+(?!\d))/g,e),Ae=(t,e)=>{const{currencySymbol:n,thousandsSeparator:r,decimalSeparator:i,monetaryDecimals:l}=e;(isNaN(t)||t===null)&&(t=0);const c=t.toFixed(l),[d,f]=c.split("."),h=NC(d,r),m=f!==void 0?`${h}${i}${f}`:h;return`${n} ${m}`},Ue=(t,e)=>{const{thousandsSeparator:n,decimalSeparator:r,nonMonetaryDecimals:i}=e;(isNaN(t)||t===null)&&(t=0);const l=t.toFixed(i),[c,d]=l.split("."),f=NC(c,n);return d!==void 0?`${f}${r}${d}`:f},Zp=(t,e)=>{const{decimalSeparator:n,thousandsSeparator:r}=e,c=t.replace(new RegExp(`\\${r}`,"g"),"").replace(new RegExp(`\\${n}`,"g"),".").replace(/[^0-9.-]/g,""),d=parseFloat(c);return isNaN(d)?0:d},jL=()=>{const{settings:t,updateSettings:e}=Ke(),{t:n}=_e(),{clearAllData:r}=qe(),[i,l]=S.useState(t),[c,d]=S.useState({}),f=S.useRef(null),[h,m]=S.useState(!1),x=S.useCallback(j=>{const O={},{company:A,localization:F}=j;return A.name.trim()||(O.companyName=n("validationRequired")),A.phone.trim()||(O.companyPhone=n("validationRequired")),A.nif.trim()||(O.companyNif=n("validationRequired")),A.rc.trim()||(O.companyRc=n("validationRequired")),A.stat.trim()||(O.companyStat=n("validationRequired")),A.email.trim()?/\S+@\S+\.\S+/.test(A.email)||(O.companyEmail=n("validationEmail")):O.companyEmail=n("validationRequired"),(isNaN(A.capital)||A.capital<=0)&&(O.companyCapital=n("validationPositiveNumber")),(isNaN(F.monetaryDecimals)||F.monetaryDecimals<0)&&(O.monetaryDecimals=n("validationNonNegative")),(isNaN(F.nonMonetaryDecimals)||F.nonMonetaryDecimals<0)&&(O.nonMonetaryDecimals=n("validationNonNegative")),O},[n]);S.useEffect(()=>{const j=x(i);d(j)},[i,x]);const g=(j,O,A)=>{l(F=>{const P={...F,[j]:{...F[j],[O]:A}};return(j==="localization"&&(O==="thousandsSeparator"||O==="decimalSeparator"||O==="monetaryDecimals"||O==="nonMonetaryDecimals"||O==="coordinateFormat")||j==="company"&&O==="capital")&&e(P),P})},N=j=>{const O=an.find(A=>A.code===j);O&&l(A=>{const F={...A,localization:{...A.localization,country:O.code,currency:O.currency,currencySymbol:O.symbol,thousandsSeparator:O.thousandsSeparator,decimalSeparator:O.decimalSeparator,denominations:O.denominations.map(P=>({id:`d-${P.value}-${P.type}`,...P}))}};return e(F),F})},T=()=>{Object.keys(c).length===0&&(e(i),alert(n("configurationSaved")))};S.useEffect(()=>{l(t)},[t]);const C=S.useMemo(()=>{const j=an.find(O=>O.code===i.localization.country);return(j==null?void 0:j.denominations)||[]},[i.localization.country]),w=(j,O,A)=>{let F=[...i.localization.denominations];A?F.some(P=>P.value===j&&P.type===O)||F.push({id:`d-${j}-${O}`,value:j,type:O}):F=F.filter(P=>!(P.value===j&&P.type===O)),F.sort((P,U)=>P.value-U.value),g("localization","denominations",F)},E=()=>{var j;(j=f.current)==null||j.click()},D=j=>{var A;const O=(A=j.target.files)==null?void 0:A[0];if(O){const F=new FileReader;F.onloadend=()=>{g("company","logoUrl",F.result)},F.readAsDataURL(O)}},I=()=>{g("company","logoUrl","")},k=()=>{r(),alert(n("dataResetSuccess")),m(!1)},M=Object.keys(c).length>0;return s.jsxs("div",{className:"pb-12",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:n("settingsTitle")}),s.jsx(se,{onClick:T,disabled:M,children:n("saveConfiguration")})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx(ze,{title:n("companySection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:n("companyName"),value:i.company.name,onChange:j=>g("company","name",j.target.value),error:c.companyName}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:n("email"),type:"email",value:i.company.email,onChange:j=>g("company","email",j.target.value),error:c.companyEmail}),s.jsx(de,{label:n("phone"),value:i.company.phone,onChange:j=>g("company","phone",j.target.value),error:c.companyPhone})]}),s.jsx(de,{label:n("address"),value:i.company.address,onChange:j=>g("company","address",j.target.value)}),s.jsx(de,{label:n("capital"),type:"text",value:Ae(i.company.capital,i.localization),onChange:j=>g("company","capital",Zp(j.target.value,i.localization)),error:c.companyCapital})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Legal Identifiers"}),s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.jsx(de,{label:n("nif"),value:i.company.nif,onChange:j=>g("company","nif",j.target.value),error:c.companyNif}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(de,{label:n("rc"),value:i.company.rc,onChange:j=>g("company","rc",j.target.value),error:c.companyRc}),s.jsx(de,{label:n("stat"),value:i.company.stat,onChange:j=>g("company","stat",j.target.value),error:c.companyStat})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("logo")}),s.jsxs("div",{className:"flex items-center gap-4 p-3 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/30",children:[s.jsx("div",{className:"w-24 h-24 bg-white dark:bg-gray-700 rounded-md flex items-center justify-center border shadow-sm overflow-hidden",children:i.company.logoUrl?s.jsx("img",{src:i.company.logoUrl,alt:n("logoPreview"),className:"w-full h-full object-contain p-1"}):s.jsx(te,{name:"Image",className:"w-10 h-10 text-gray-300"})}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs(se,{type:"button",variant:"secondary",onClick:E,className:"text-sm",children:[s.jsx(te,{name:"Image",className:"w-4 h-4 mr-2"}),n("changeLogo")]}),i.company.logoUrl&&s.jsxs(se,{type:"button",variant:"ghost",onClick:I,className:"text-sm text-red-600 hover:text-red-700 hover:bg-red-50",children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),n("removeLogo")]}),s.jsx("input",{type:"file",ref:f,onChange:D,className:"hidden",accept:"image/png, image/jpeg, image/svg+xml"})]})]})]})]})]})}),s.jsx(ze,{title:n("localizationSection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx(ke,{label:n("country"),value:i.localization.country,onChange:j=>N(j.target.value),children:an.map(j=>s.jsx("option",{value:j.code,children:j.name},j.code))}),s.jsx(de,{label:n("currencyFormat"),value:`${i.localization.currency} (${i.localization.currencySymbol})`,disabled:!0}),s.jsxs(ke,{label:n("coordinateFormat"),value:i.localization.coordinateFormat,onChange:j=>g("localization","coordinateFormat",j.target.value),children:[s.jsx("option",{value:"DMS",children:n("coordinateFormat_DMS")}),s.jsx("option",{value:"DD",children:n("coordinateFormat_DD")})]}),s.jsxs(ke,{label:n("thousandsSeparator"),value:i.localization.thousandsSeparator,onChange:j=>g("localization","thousandsSeparator",j.target.value),children:[s.jsx("option",{value:",",children:n("separator_comma")}),s.jsx("option",{value:".",children:n("separator_dot")}),s.jsx("option",{value:" ",children:n("separator_space")})]}),s.jsxs(ke,{label:n("decimalSeparator"),value:i.localization.decimalSeparator,onChange:j=>g("localization","decimalSeparator",j.target.value),children:[s.jsx("option",{value:".",children:n("separator_dot")}),s.jsx("option",{value:",",children:n("separator_comma")})]}),s.jsx(de,{label:n("monetaryDecimals"),type:"number",value:i.localization.monetaryDecimals,onChange:j=>g("localization","monetaryDecimals",parseInt(j.target.value)),error:c.monetaryDecimals})]})}),s.jsxs(ze,{title:n("denominationsSection"),children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:n("denominationsDescriptionNew")}),C.length>0?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:n("coins")}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:C.filter(j=>j.type==="coin").map(j=>s.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[s.jsx(Rt,{checked:i.localization.denominations.some(O=>O.value===j.value&&O.type===j.type),onChange:O=>w(j.value,j.type,O.target.checked)}),s.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(j.value,i.localization)})]},`${j.type}-${j.value}`))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:n("banknotes")}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:C.filter(j=>j.type==="banknote").map(j=>s.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[s.jsx(Rt,{checked:i.localization.denominations.some(O=>O.value===j.value&&O.type===j.type),onChange:O=>w(j.value,j.type,O.target.checked)}),s.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(j.value,i.localization)})]},`${j.type}-${j.value}`))})]})]}):s.jsx("p",{className:"text-gray-500 italic",children:n("noDenominationsForCountry")})]}),s.jsx(ze,{title:n("interfaceSection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs(ke,{label:n("language"),value:i.language,onChange:j=>{const O=j.target.value;e({...i,language:O})},children:[s.jsx("option",{value:Au.EN,children:n("language_en")}),s.jsx("option",{value:Au.FR,children:n("language_fr")})]}),s.jsx(ke,{label:n("visualAppearance"),value:i.theme.id,onChange:j=>{const O=ku.find(A=>A.id===j.target.value);O&&e({...i,theme:O})},children:ku.map(j=>s.jsx("option",{value:j.id,children:j.name},j.id))})]})}),s.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800 dark:text-gray-100",children:n("dataManagementSection")}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 rounded-lg p-4 flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-1",children:n("resetData")}),s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:n("resetDataWarning")})]}),s.jsxs(se,{variant:"danger",onClick:()=>m(!0),className:"ml-4",children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),n("resetData")]})]})]}),h&&s.jsx(Qt,{isOpen:h,onClose:()=>m(!1),onConfirm:k,title:n("confirmDeleteTitle"),message:n("confirmResetData"),confirmText:n("delete")})]})]})},AL=t=>{if(!t||!t.trim())return{deg:"",min:"",sec:"",dir:""};const e=/(-?\d+(?:\.\d+)?)\s*(?:\s*(\d+(?:\.\d+)?)\s*')?(?:\s*(\d+(?:\.\d+)?)\s*")?\s*([NSEW])?/i,n=t.trim().match(e);if(!n){const r=t.trim().match(/(-?\d+(?:\.\d+)?)\s*([NSEW])?/i);return r?{deg:r[1]||"",min:"",sec:"",dir:(r[2]||"").toUpperCase()}:{deg:t,min:"",sec:"",dir:""}}return{deg:n[1]||"",min:n[2]||"",sec:n[3]||"",dir:(n[4]||"").toUpperCase()}},kL=({label:t,value:e,onChange:n,directions:r,error:i})=>{const l=S.useMemo(()=>{const d=AL(e),f=r.includes(d.dir)?d.dir:r[0];return{...d,dir:f}},[e,r]),c=S.useCallback((d,f)=>{const h={deg:l.deg,min:l.min,sec:l.sec,dir:l.dir,[d]:f},{deg:m,min:x,sec:g,dir:N}=h;if(!m.trim()&&!x.trim()&&!g.trim()){n("");return}const T=`${m} ${x}' ${g}" ${N}`;n(T)},[l,n]);return s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),s.jsxs("div",{className:"flex items-start gap-1",children:[s.jsx(de,{type:"number",value:l.deg,onChange:d=>c("deg",d.target.value),placeholder:"","aria-label":`${t} degrees`,containerClassName:"min-w-0",min:"-180",max:"180"}),s.jsx(de,{type:"number",value:l.min,onChange:d=>c("min",d.target.value),placeholder:"'","aria-label":`${t} minutes`,containerClassName:"min-w-0",min:"0",max:"59"}),s.jsx(de,{type:"number",step:"any",value:l.sec,onChange:d=>c("sec",d.target.value),placeholder:'"',"aria-label":`${t} seconds`,containerClassName:"min-w-0",min:"0",max:"59.999"}),s.jsxs(ke,{value:l.dir,onChange:d=>c("dir",d.target.value),"aria-label":`${t} direction`,containerClassName:"min-w-fit",children:[s.jsx("option",{value:r[0],children:r[0]}),s.jsx("option",{value:r[1],children:r[1]})]})]}),i&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},go=({label:t,value:e,onChange:n,axis:r,error:i})=>{const{settings:l}=Ke(),{t:c}=_e(),d=l.localization.coordinateFormat,f=r==="lat",[h,m]=S.useState(e);S.useEffect(()=>{if(d==="DD")try{const g=wn(e);m(String(g))}catch{m(e)}else try{/^-?\d+(\.\d+)?$/.test(e)?m(bC(parseFloat(e),f)):m(e)}catch{m(e)}},[e,d,f]);const x=g=>{const N=g.target.value;m(N),n(N)};if(d==="DMS"){const g=f?["N","S"]:["E","W"];return s.jsx(kL,{label:t,value:h,onChange:n,directions:g,error:i})}return s.jsx(de,{label:`${t} (DD)`,type:"number",step:"any",value:h,onChange:x,error:i,placeholder:f?"-18.1234":"46.5678"})},hu=["#e11d48","#2563eb","#16a34a","#f97316","#9333ea","#ca8a04"],DL=({site:t,modules:e})=>{const{t:n}=_e(),{farmers:r}=qe(),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useMemo(()=>new Map(r.map(h=>[h.id,`${h.firstName} ${h.lastName}`])),[r]);return S.useEffect(()=>(i.current&&!l.current&&(l.current=L.map(i.current).setView([-18.76,46.86],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(l.current),c.current=L.featureGroup().addTo(l.current),d.current=L.featureGroup().addTo(l.current)),()=>{l.current&&(l.current.remove(),l.current=null,c.current=null,d.current=null)}),[]),S.useEffect(()=>{const h=l.current;if(!h||!c.current||!d.current)return;const m=c.current,x=d.current;m.clearLayers(),x.clearLayers(),t.zones&&t.zones.length>0&&t.zones.forEach((T,C)=>{const w=Qp(T.geoPoints);if(w.length>=3){const E=w.reduce((M,j)=>({x:M.x+j.x,y:M.y+j.y}),{x:0,y:0});E.x/=w.length,E.y/=w.length,w.sort((M,j)=>{const O=Math.atan2(M.y-E.y,M.x-E.x),A=Math.atan2(j.y-E.y,j.x-E.x);return O-A});const D=w.map(M=>[M.y,M.x]),I=hu[C%hu.length],k=L.polygon(D,{color:I,weight:2,fillColor:I,fillOpacity:.1});k.bindPopup(`<b>${T.name}</b>`),m.addLayer(k)}}),e.forEach(T=>{if(T.siteId===t.id&&T.latitude&&T.longitude)try{const C=wn(T.latitude),w=wn(T.longitude),E=!!T.farmerId,D=E?"#22c55e":"#9ca3af",I=L.divIcon({className:"",html:`<div style="background-color: ${D}; width: 8px; height: 8px; border: 1px solid white; box-shadow: 0 0 2px rgba(0,0,0,0.3);"></div>`,iconSize:[8,8],iconAnchor:[4,4]}),k=L.marker([C,w],{icon:I});k.bindPopup(`<b>${T.code}</b><br>${n(E?"status_ASSIGNED":"status_FREE")}`),x.addLayer(k)}catch{}});const g=L.featureGroup([m,x]),N=g.getBounds();if(g.getLayers().length>0&&N.isValid())h.fitBounds(N.pad(.1));else try{if(t.location){const[T,C]=t.location.split(",");if(T&&C){const w=wn(T.trim()),E=wn(C.trim());!isNaN(w)&&!isNaN(E)&&h.setView([w,E],13)}}}catch{}},[t.zones,t.location,e,t.id,n]),s.jsxs(ze,{className:"bg-white/30 dark:bg-gray-800/30",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200",children:[n("siteLayout"),": ",t.name]}),s.jsx("div",{ref:i,style:{height:"400px"},className:"rounded-lg mb-4 border border-gray-200 dark:border-gray-700 shadow-inner z-0"}),s.jsx("div",{className:"flex flex-wrap gap-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-900/50",children:t.zones.length>0?t.zones.map((h,m)=>{const x=e.filter(N=>N.zoneId===h.id),g=hu[m%hu.length];return s.jsxs("div",{className:"flex-1 min-w-[250px] p-3 border-l-4 rounded-lg",style:{borderColor:g},children:[s.jsxs("h4",{className:"font-bold mb-3 text-gray-700 dark:text-gray-300",children:[h.name," (",x.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(N=>{const T=!!N.farmerId,C=T?f.get(N.farmerId):null,w=[`${n("code")}: ${N.code}`,`${n("status")}: ${n(T?"status_ASSIGNED":"status_FREE")}`,T&&C?`${n("farmer")}: ${C}`:null].filter(Boolean).join(`
`);return s.jsx("div",{title:w,className:`h-8 w-8 flex items-center justify-center text-[10px] font-mono border border-white/20 shadow-sm
                        ${T?"bg-green-500 text-white":"bg-gray-400 text-white"}
                        transition-transform hover:scale-110 cursor-help`,children:N.code.split("-").pop()},N.id)})})]},h.id)}):s.jsx("p",{className:"text-gray-500 dark:text-gray-400 w-full text-center py-4",children:n("noZonesDefined")})}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"font-semibold mb-2",children:n("legend")}),s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-green-500 border border-white shadow-sm"}),s.jsx("span",{children:n("assignedModule")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-gray-400 border border-white shadow-sm"}),s.jsx("span",{children:n("freeModule")})]})]})]})]})},RL=()=>{const{t}=_e(),{sites:e,deleteSite:n,addSite:r,updateSite:i,employees:l,modules:c}=qe(),[d,f]=S.useState(!1),[h,m]=S.useState(null),[x,g]=S.useState(!1),[N,T]=S.useState(null),C=(I=null)=>{m(I),f(!0)},w=I=>{T(I),g(!0)},E=()=>{N&&n(N),g(!1),T(null)},D=I=>{"id"in I?i(I):r(I),f(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("siteManagementTitle")}),s.jsxs(se,{onClick:()=>C(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addSite")]})]}),s.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.map(I=>{const k=l.find(M=>M.id===I.managerId);return s.jsxs(ze,{children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[I.name,s.jsx("span",{className:"text-sm font-normal text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded",children:I.code})]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t("manager"),": ",k?`${k.firstName} ${k.lastName}`:t("noManager")]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("coordinates"),": ",I.location||"-"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{variant:"ghost",onClick:()=>C(I),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>w(I.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]}),s.jsx(DL,{site:I,modules:c}),s.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[s.jsx("h4",{className:"font-semibold mb-2",children:t("zones")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:I.zones&&I.zones.length>0?I.zones.map(M=>s.jsx("span",{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 px-2 py-1 rounded text-sm border border-blue-200 dark:border-blue-800",children:M.name},M.id)):s.jsx("span",{className:"text-gray-500 text-sm italic",children:t("noZonesDefined")})})]})]},I.id)})}),d&&s.jsx(ML,{isOpen:d,onClose:()=>f(!1),site:h,onSave:D}),x&&s.jsx(Qt,{isOpen:x,onClose:()=>g(!1),onConfirm:E,title:t("confirmDeleteTitle"),message:t("confirmDeleteSite")})]})},ML=({isOpen:t,onClose:e,site:n,onSave:r})=>{const{t:i}=_e(),{employees:l,sites:c}=qe(),{settings:d}=Ke(),[f,h]=S.useState({name:"",code:"",location:"",managerId:"",zones:[]}),[m,x]=S.useState(""),[g,N]=S.useState(""),[T,C]=S.useState({}),[w,E]=S.useState([]),D=S.useCallback(()=>{const z={};f.name.trim()||(z.name=i("validationRequired")),f.code.trim()||(z.code=i("validationRequired"));const J=d.localization.coordinateFormat;if(m.trim())try{if(J==="DD"){const Y=parseFloat(m);if(isNaN(Y)||Y<-90||Y>90)throw new Error(i("validationDDLatitudeRange"))}else wn(m)}catch(Y){z.latitude=Y.message}if(g.trim())try{if(J==="DD"){const Y=parseFloat(g);if(isNaN(Y)||Y<-180||Y>180)throw new Error(i("validationDDLongitudeRange"))}else wn(g)}catch(Y){z.longitude=Y.message}return z},[f.name,f.code,m,g,i,d.localization.coordinateFormat]);S.useEffect(()=>{C(D())},[D]),S.useEffect(()=>{if(n){if(h({name:n.name,code:n.code,location:n.location,managerId:n.managerId||"",zones:n.zones||[]}),E(n.zones||[]),n.location){const z=n.location.split(",");z.length===2&&(x(z[0].trim()),N(z[1].trim()))}}else h({name:"",code:"",location:"",managerId:"",zones:[]}),E([]),x(""),N("")},[n,t]);const I=z=>{const J=z.replace(/[^a-zA-Z]/g,"").toUpperCase();if(J.length<3){const G=J.padEnd(3,"X");return c.some(B=>B.code===G)?"":G}const Y=new Set(c.map(G=>G.code));for(let G=0;G<J.length-2;G++)for(let B=G+1;B<J.length-1;B++)for(let Q=B+1;Q<J.length;Q++){const K=J[G]+J[B]+J[Q];if(!Y.has(K))return K}return""},k=z=>{const J=z.target.value;let Y=f.code;if(!n)if(J.trim().length>0){const G=I(J);G&&(Y=G)}else Y="";h(G=>({...G,name:J,code:Y}))},M=()=>{const z={id:`zone-${Date.now()}`,name:`Zone ${w.length+1}`,geoPoints:[]};E([...w,z])},j=(z,J,Y)=>{E(G=>{const B=[...G];return B[z]={...B[z],[J]:Y},B})},O=z=>{E(w.filter((J,Y)=>Y!==z))},A=z=>{E(J=>{const Y=[...J],G={...Y[z]};return G.geoPoints=[...G.geoPoints,""],Y[z]=G,Y})},F=(z,J,Y)=>{E(G=>{const B=[...G],Q={...B[z]},K=[...Q.geoPoints];return K[J]=Y,Q.geoPoints=K,B[z]=Q,B})},P=(z,J)=>{E(Y=>{const G=[...Y],B={...G[z]};return B.geoPoints=B.geoPoints.filter((Q,K)=>K!==J),G[z]=B,G})},U=()=>{const z=D();if(Object.keys(z).length>0){C(z);return}const J=m&&g?`${m}, ${g}`:"",Y={...f,location:J,zones:w};r(n?{...n,...Y}:Y)},q=Object.keys(T).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editSite":"addSite"),widthClass:"max-w-4xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:i("siteName"),value:f.name,onChange:k,required:!0,error:T.name}),s.jsx(de,{label:i("siteCode"),value:f.code,onChange:z=>h({...f,code:z.target.value.toUpperCase()}),required:!0,error:T.code}),s.jsxs(ke,{label:i("manager"),value:f.managerId,onChange:z=>h({...f,managerId:z.target.value}),children:[s.jsx("option",{value:"",children:i("noManager")}),l.map(z=>s.jsxs("option",{value:z.id,children:[z.firstName," ",z.lastName]},z.id))]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(go,{label:i("latitude"),value:m,onChange:x,axis:"lat",error:T.latitude}),s.jsx(go,{label:i("longitude"),value:g,onChange:N,axis:"lon",error:T.longitude})]}),s.jsxs("div",{className:"border-t pt-4 dark:border-gray-700",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"font-semibold",children:i("zones")}),s.jsxs(se,{variant:"secondary",onClick:M,className:"text-xs",children:[s.jsx(te,{name:"PlusCircle",className:"w-4 h-4 mr-1"}),i("addZone")]})]}),s.jsx("div",{className:"space-y-4 max-h-[40vh] overflow-y-auto pr-2",children:w.map((z,J)=>s.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 dark:bg-gray-800/50 dark:border-gray-700 relative",children:[s.jsx(se,{variant:"danger",className:"absolute top-2 right-2 p-1",onClick:()=>O(J),children:s.jsx(te,{name:"X",className:"w-4 h-4"})}),s.jsx("div",{className:"mb-3 pr-8",children:s.jsx(de,{label:i("zoneName"),value:z.name,onChange:Y=>j(J,"name",Y.target.value)})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("geoPoints")}),s.jsxs(se,{variant:"ghost",className:"text-xs py-0 h-6",onClick:()=>A(J),children:[s.jsx(te,{name:"PlusCircle",className:"w-3 h-3 mr-1"}),i("addPoint")]})]}),s.jsxs("div",{className:"space-y-2 pl-2 border-l-2 border-gray-200 dark:border-gray-700",children:[z.geoPoints.length>0&&s.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 text-xs text-gray-500 font-semibold mb-1",children:[s.jsx("div",{className:"flex items-center justify-center",children:"#"}),s.jsx("div",{children:i("latitude")}),s.jsx("div",{children:i("longitude")}),s.jsx("div",{})]}),z.geoPoints.map((Y,G)=>{const B=Y.split(",").map(re=>re.trim()),Q=B[0]||"",K=B[1]||"";return s.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 items-center",children:[s.jsx("span",{className:"text-xs text-gray-500 text-center",children:G+1}),s.jsx(go,{label:"",value:Q,onChange:re=>{F(J,G,`${re}, ${K}`)},axis:"lat"}),s.jsx(go,{label:"",value:K,onChange:re=>{F(J,G,`${Q}, ${re}`)},axis:"lon"}),s.jsx(se,{variant:"ghost",className:"p-1 text-red-500 hover:text-red-700",onClick:()=>P(J,G),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]},G)}),z.geoPoints.length===0&&s.jsx("p",{className:"text-xs text-gray-400 italic",children:i("noPoints")||"No points"})]})]})]},z.id))})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:U,disabled:q,children:i("save")})]})]})})},PL=({isOpen:t,onClose:e,creditType:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n),[d,f]=S.useState({}),h=S.useCallback(N=>{var C;const T={};return N.name.trim()||(T.name=i("validationRequired")),N.hasQuantity&&!((C=N.unit)!=null&&C.trim())&&(T.unit=i("validationRequired")),T},[i]);S.useEffect(()=>{c(n)},[n,t]),S.useEffect(()=>{f(h(l))},[l,h]);const m=(N,T)=>{c(N==="hasQuantity"&&T===!1?C=>({...C,hasQuantity:!1,unit:""}):C=>({...C,[N]:T}))},x=N=>{N.preventDefault(),Object.keys(d).length===0&&r(l)},g=Object.keys(d).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i("editCreditType"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsx(de,{label:i("creditType"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name}),l.hasQuantity&&s.jsx(de,{label:i("unit"),value:l.unit||"",onChange:N=>m("unit",N.target.value),error:d.unit}),s.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasQuantity,onChange:N=>m("hasQuantity",N.target.checked)}),i("withQuantity")]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasUnitPrice,onChange:N=>m("hasUnitPrice",N.target.checked)}),i("withUnitPrice")]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.isDirectAmount,onChange:N=>m("isDirectAmount",N.target.checked)}),i("directAmount")]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",disabled:g,children:i("save")})]})]})})},OL=()=>{const{t}=_e(),[e,n]=S.useState("status"),r=[{id:"status",label:t("creditStatus")},{id:"record",label:t("recordCredit")},{id:"repayment",label:t("recordRepayment")},{id:"settings",label:t("creditTypeSettings")}];return s.jsxs("div",{className:"pb-20",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("farmerCreditsTitle")}),s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto","aria-label":"Tabs",children:r.map(i=>s.jsx("button",{onClick:()=>n(i.id),className:`${e===i.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:i.label},i.id))})}),s.jsxs("div",{children:[e==="status"&&s.jsx(LL,{}),e==="record"&&s.jsx(FL,{}),e==="repayment"&&s.jsx(UL,{}),e==="settings"&&s.jsx(BL,{})]})]})},LL=()=>{const{t,language:e}=_e(),{farmers:n,farmerCredits:r,deleteFarmer:i,repayments:l,addMultipleFarmerCredits:c,addMultipleRepayments:d,creditTypes:f}=qe(),{settings:h}=Ke(),[m,x]=S.useState(null),[g,N]=S.useState({key:"farmerName",direction:"ascending"}),[T,C]=S.useState(null),[w,E]=S.useState([]),D=S.useRef(null),I=S.useMemo(()=>new Map(f.map(U=>[U.id,U.name])),[f]),k=S.useMemo(()=>{let U=n.map(q=>{const z=r.filter(K=>K.farmerId===q.id),J=l.filter(K=>K.farmerId===q.id),Y=z.reduce((K,re)=>K+re.totalAmount,0),G=J.reduce((K,re)=>K+re.amount,0),B=Y-G;let Q=null;return J.length>0&&(Q=[...J].sort((K,re)=>new Date(re.date).getTime()-new Date(K.date).getTime())[0].date),{farmer:q,farmerName:`${q.firstName} ${q.lastName}`,totalContracted:Y,totalRepayments:G,balance:B,lastRepaymentDate:Q}});return g.key&&U.sort((q,z)=>{const J=q[g.key],Y=z[g.key];return J===null?1:Y===null?-1:J<Y?g.direction==="ascending"?-1:1:J>Y?g.direction==="ascending"?1:-1:0}),U},[n,r,l,g]);S.useEffect(()=>{if(D.current){const U=w.length,q=k.length;D.current.checked=U===q&&q>0,D.current.indeterminate=U>0&&U<q}},[w,k]);const M=U=>{let q="ascending";g.key===U&&g.direction==="ascending"&&(q="descending"),N({key:U,direction:q})},j=U=>g.key!==U?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):g.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),O=({sortKey:U,label:q,className:z})=>s.jsx("th",{className:`p-3 ${z}`,children:s.jsxs("button",{onClick:()=>M(U),className:`group flex items-center gap-2 w-full ${z!=null&&z.includes("text-right")?"justify-end":""}`,children:[q,j(U)]})}),A=U=>{U.target.checked?E(k.map(q=>q.farmer.id)):E([])},F=(U,q)=>{U.target.checked?E(z=>[...z,q]):E(z=>z.filter(J=>J!==q))},P=U=>{C(T===U?null:U)};return s.jsxs(ze,{children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsx("h2",{className:"text-lg font-semibold",children:t("creditStatus")})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{ref:D,onChange:A,"aria-label":t("selectAllFarmers")})}),s.jsx("th",{className:"p-3 w-8"}),s.jsx(O,{sortKey:"farmerName",label:t("farmer")}),s.jsx(O,{sortKey:"totalContracted",label:t("contractedCredits"),className:"text-right"}),s.jsx(O,{sortKey:"totalRepayments",label:t("repayments"),className:"text-right"}),s.jsx(O,{sortKey:"balance",label:t("remainingBalance"),className:"text-right"}),s.jsx(O,{sortKey:"lastRepaymentDate",label:t("lastRepaymentDate")})]})}),s.jsx("tbody",{children:k.map(U=>s.jsxs(gt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:w.includes(U.farmer.id),onChange:q=>F(q,U.farmer.id),"aria-label":t("selectFarmerNamed").replace("{name}",U.farmerName)})}),s.jsx("td",{className:"p-3 text-center",children:s.jsx("button",{onClick:()=>P(U.farmer.id),className:"text-gray-500 hover:text-gray-700",children:s.jsx(te,{name:T===U.farmer.id?"ChevronDown":"ChevronRight",className:"w-4 h-4"})})}),s.jsx("td",{className:"p-3 font-medium",children:U.farmerName}),s.jsx("td",{className:"p-3 text-right",children:Ae(U.totalContracted,h.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(U.totalRepayments,h.localization)}),s.jsx("td",{className:`p-3 text-right font-bold ${U.balance>0?"text-red-600":"text-green-600"}`,children:Ae(U.balance,h.localization)}),s.jsx("td",{className:"p-3",children:U.lastRepaymentDate||"-"})]}),T===U.farmer.id&&s.jsx("tr",{className:"bg-gray-50 dark:bg-gray-900/30",children:s.jsx("td",{colSpan:7,className:"p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-sm mb-2",children:t("creditsTaken")}),s.jsx("ul",{className:"space-y-2 text-sm",children:r.filter(q=>q.farmerId===U.farmer.id).length>0?r.filter(q=>q.farmerId===U.farmer.id).map(q=>s.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[s.jsxs("span",{children:[q.date," - ",I.get(q.creditTypeId)||q.creditTypeId]}),s.jsx("span",{children:Ae(q.totalAmount,h.localization)})]},q.id)):s.jsx("p",{className:"text-gray-500 italic",children:t("noCredits")})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-sm mb-2",children:t("repaymentsMade")}),s.jsx("ul",{className:"space-y-2 text-sm",children:l.filter(q=>q.farmerId===U.farmer.id).length>0?l.filter(q=>q.farmerId===U.farmer.id).map(q=>s.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[s.jsxs("span",{children:[q.date," - ",t(`repaymentMethod_${q.method}`)]}),s.jsx("span",{children:Ae(q.amount,h.localization)})]},q.id)):s.jsx("p",{className:"text-gray-500 italic",children:t("noRepayments")})})]})]})})})]},U.farmer.id))})]})})]})},FL=()=>{const{t}=_e(),{sites:e,farmers:n,creditTypes:r,addFarmerCredit:i,getFarmersBySite:l}=qe(),{settings:c}=Ke(),[d,f]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",creditTypeId:"",quantity:"",unitPrice:"",totalAmount:"",notes:""}),[h,m]=S.useState({}),x=S.useMemo(()=>d.siteId?l(d.siteId):[],[d.siteId,l]),g=S.useMemo(()=>r.find(T=>T.id===d.creditTypeId),[r,d.creditTypeId]);S.useEffect(()=>{if(g&&!(!g.hasQuantity&&!g.hasUnitPrice)){const T=parseFloat(d.quantity),C=parseFloat(d.unitPrice);!isNaN(T)&&!isNaN(C)&&f(w=>({...w,totalAmount:(T*C).toFixed(2)}))}},[d.quantity,d.unitPrice,g]);const N=T=>{T.preventDefault();const C={};if(d.date||(C.date=t("validationRequired")),d.siteId||(C.siteId=t("validationRequired")),d.farmerId||(C.farmerId=t("validationRequired")),d.creditTypeId||(C.creditTypeId=t("validationRequired")),g!=null&&g.hasQuantity&&(!d.quantity||parseFloat(d.quantity)<=0)&&(C.quantity=t("validationPositiveNumber")),g!=null&&g.hasUnitPrice&&(!d.unitPrice||parseFloat(d.unitPrice)<=0)&&(C.unitPrice=t("validationPositiveNumber")),(!d.totalAmount||parseFloat(d.totalAmount)<=0)&&(C.totalAmount=t("validationPositiveNumber")),Object.keys(C).length>0){m(C);return}i({date:d.date,siteId:d.siteId,farmerId:d.farmerId,creditTypeId:d.creditTypeId,quantity:g!=null&&g.hasQuantity?parseFloat(d.quantity):void 0,unitPrice:g!=null&&g.hasUnitPrice?parseFloat(d.unitPrice):void 0,totalAmount:parseFloat(d.totalAmount),notes:d.notes}),alert("Credit recorded successfully"),f(w=>({...w,quantity:"",unitPrice:"",totalAmount:"",notes:""}))};return s.jsx(ze,{title:t("recordCredit"),children:s.jsxs("form",{onSubmit:N,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(de,{label:t("date"),type:"date",value:d.date,onChange:T=>f({...d,date:T.target.value}),error:h.date,required:!0}),s.jsxs(ke,{label:t("site"),value:d.siteId,onChange:T=>f({...d,siteId:T.target.value,farmerId:""}),error:h.siteId,required:!0,children:[s.jsx("option",{value:"",children:t("selectSite")}),e.map(T=>s.jsx("option",{value:T.id,children:T.name},T.id))]}),s.jsxs(ke,{label:t("farmer"),value:d.farmerId,onChange:T=>f({...d,farmerId:T.target.value}),disabled:!d.siteId,error:h.farmerId,required:!0,children:[s.jsx("option",{value:"",children:t("selectFarmer")}),x.map(T=>s.jsxs("option",{value:T.id,children:[T.firstName," ",T.lastName]},T.id))]}),s.jsxs(ke,{label:t("creditType"),value:d.creditTypeId,onChange:T=>f({...d,creditTypeId:T.target.value}),error:h.creditTypeId,required:!0,children:[s.jsx("option",{value:"",children:t("selectType")}),r.map(T=>s.jsx("option",{value:T.id,children:T.name},T.id))]}),(g==null?void 0:g.hasQuantity)&&s.jsx(de,{label:`${t("quantity")} (${g.unit})`,type:"number",step:"any",value:d.quantity,onChange:T=>f({...d,quantity:T.target.value}),error:h.quantity,required:!0}),(g==null?void 0:g.hasUnitPrice)&&s.jsx(de,{label:t("unitPrice"),type:"number",step:"any",value:d.unitPrice,onChange:T=>f({...d,unitPrice:T.target.value}),error:h.unitPrice,required:!0}),s.jsx(de,{label:t("totalAmount"),type:"number",step:"any",value:d.totalAmount,onChange:T=>f({...d,totalAmount:T.target.value}),error:h.totalAmount,required:!0,disabled:!!(g!=null&&g.hasQuantity&&(g!=null&&g.hasUnitPrice))}),s.jsx(de,{label:t("notes"),value:d.notes,onChange:T=>f({...d,notes:T.target.value}),containerClassName:"md:col-span-2 lg:col-span-3"})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(se,{type:"submit",children:t("save")})})]})})},UL=()=>{const{t}=_e(),{sites:e,farmers:n,addRepayment:r,getFarmersBySite:i}=qe(),{settings:l}=Ke(),[c,d]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",amount:"",method:"cash",notes:""}),[f,h]=S.useState({}),m=S.useMemo(()=>c.siteId?i(c.siteId):[],[c.siteId,i]),x=g=>{g.preventDefault();const N={};if(c.date||(N.date=t("validationRequired")),c.siteId||(N.siteId=t("validationRequired")),c.farmerId||(N.farmerId=t("validationRequired")),(!c.amount||parseFloat(c.amount)<=0)&&(N.amount=t("validationPositiveNumber")),Object.keys(N).length>0){h(N);return}r({date:c.date,farmerId:c.farmerId,amount:parseFloat(c.amount),method:c.method,notes:c.notes}),alert(t("repaymentRecorded")),d(T=>({...T,amount:"",notes:""}))};return s.jsx(ze,{title:t("recordRepayment"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(de,{label:t("date"),type:"date",value:c.date,onChange:g=>d({...c,date:g.target.value}),error:f.date,required:!0}),s.jsxs(ke,{label:t("site"),value:c.siteId,onChange:g=>d({...c,siteId:g.target.value,farmerId:""}),error:f.siteId,required:!0,children:[s.jsx("option",{value:"",children:t("selectSite")}),e.map(g=>s.jsx("option",{value:g.id,children:g.name},g.id))]}),s.jsxs(ke,{label:t("farmer"),value:c.farmerId,onChange:g=>d({...c,farmerId:g.target.value}),disabled:!c.siteId,error:f.farmerId,required:!0,children:[s.jsx("option",{value:"",children:t("selectFarmer")}),m.map(g=>s.jsxs("option",{value:g.id,children:[g.firstName," ",g.lastName]},g.id))]}),s.jsx(de,{label:t("repaymentAmount"),type:"number",step:"any",value:c.amount,onChange:g=>d({...c,amount:g.target.value}),error:f.amount,required:!0}),s.jsxs(ke,{label:t("repaymentMethod"),value:c.method,onChange:g=>d({...c,method:g.target.value}),children:[s.jsx("option",{value:"cash",children:t("repaymentMethod_cash")}),s.jsx("option",{value:"harvest_deduction",children:t("repaymentMethod_harvest_deduction")})]}),s.jsx(de,{label:t("notes"),value:c.notes,onChange:g=>d({...c,notes:g.target.value})})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(se,{type:"submit",children:t("save")})})]})})},BL=()=>{const{t}=_e(),{creditTypes:e,addCreditType:n,updateCreditType:r,deleteCreditType:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,T]=S.useState(null),C=()=>{h.trim()&&(n({name:h.trim(),hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0}),m(""))},w=I=>{T(I),g(!0)},E=()=>{N&&i(N),g(!1),T(null)},D=I=>{f(I),c(!0)};return s.jsxs(ze,{title:t("creditTypes"),children:[s.jsxs("div",{className:"flex gap-4 mb-6",children:[s.jsx(de,{placeholder:t("addNewCreditType"),value:h,onChange:I=>m(I.target.value),containerClassName:"flex-grow"}),s.jsxs(se,{onClick:C,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]}),s.jsx("div",{className:"space-y-2",children:e.map(I=>s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded border dark:border-gray-700",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:I.name}),s.jsx("span",{className:"text-xs text-gray-500 ml-2",children:I.isDirectAmount?t("directAmount"):`${t("withQuantity")} (${I.unit})`})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{variant:"ghost",onClick:()=>D(I),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>w(I.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},I.id))}),l&&d&&s.jsx(PL,{isOpen:l,onClose:()=>c(!1),creditType:d,onSave:I=>{r(I),c(!1)}}),x&&s.jsx(Qt,{isOpen:x,onClose:()=>g(!1),onConfirm:E,title:t("confirmDeleteTitle"),message:t("confirmDeleteCreditType")})]})},GL=({isOpen:t,onClose:e,seaweedType:n})=>{const{t:r,language:i}=_e(),{settings:l}=Ke(),{updateSeaweedPrices:c}=qe(),[d,f]=S.useState({wetPrice:"",dryPrice:"",date:new Date().toISOString().split("T")[0]}),[h,m]=S.useState({}),x=S.useMemo(()=>[...n.priceHistory].sort((w,E)=>new Date(E.date).getTime()-new Date(w.date).getTime()),[n.priceHistory]),g=S.useCallback(()=>{const w={};return(isNaN(parseFloat(d.wetPrice))||parseFloat(d.wetPrice)<=0)&&(w.wetPrice=r("validationPositiveNumber")),(isNaN(parseFloat(d.dryPrice))||parseFloat(d.dryPrice)<=0)&&(w.dryPrice=r("validationPositiveNumber")),d.date?new Date(d.date)>new Date&&(w.date=r("validationFutureDate")):w.date=r("validationRequired"),w},[d,r]);S.useEffect(()=>{t&&(f({wetPrice:String(n.wetPrice),dryPrice:String(n.dryPrice),date:new Date().toISOString().split("T")[0]}),m({}))},[t,n]),S.useEffect(()=>{m(g())},[d,g]);const N=(w,E)=>{f(D=>({...D,[w]:E}))},T=()=>{const w=g();if(Object.keys(w).length>0){m(w);return}const E={date:d.date,wetPrice:parseFloat(d.wetPrice),dryPrice:parseFloat(d.dryPrice)};c(n.id,E),f({wetPrice:String(E.wetPrice),dryPrice:String(E.dryPrice),date:new Date().toISOString().split("T")[0]})},C=Object.keys(h).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:`${r("priceHistory")}: ${n.name}`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("addNewPrice")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end p-4 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx(de,{label:r("wetPrice"),type:"number",step:"any",value:d.wetPrice,onChange:w=>N("wetPrice",w.target.value),error:h.wetPrice}),s.jsx(de,{label:r("dryPrice"),type:"number",step:"any",value:d.dryPrice,onChange:w=>N("dryPrice",w.target.value),error:h.dryPrice}),s.jsx(de,{label:r("effectiveDate"),type:"date",value:d.date,onChange:w=>N("date",w.target.value),error:h.date}),s.jsxs(se,{onClick:T,disabled:C,className:"h-10",children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),r("add")]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("history")}),s.jsx("div",{className:"max-h-60 overflow-y-auto border dark:border-gray-700 rounded-lg",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 sticky top-0",children:[s.jsx("th",{className:"p-2",children:r("effectiveDate")}),s.jsx("th",{className:"p-2 text-right",children:r("wetPrice")}),s.jsx("th",{className:"p-2 text-right",children:r("dryPrice")})]})}),s.jsxs("tbody",{children:[x.map((w,E)=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2",children:new Date(w.date).toLocaleDateString(i)}),s.jsx("td",{className:"p-2 text-right",children:Ae(w.wetPrice,l.localization)}),s.jsx("td",{className:"p-2 text-right",children:Ae(w.dryPrice,l.localization)})]},E)),x.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:3,className:"p-4 text-center text-gray-500",children:r("noPriceHistory")})})]})]})})]})]})})},zL=()=>{const{t}=_e(),{seaweedTypes:e,addSeaweedType:n,updateSeaweedType:r,deleteSeaweedType:i}=qe(),{settings:l}=Ke(),c=Qs(),[d,f]=S.useState(!1),[h,m]=S.useState(null),[x,g]=S.useState(!1),[N,T]=S.useState(null),[C,w]=S.useState(!1),[E,D]=S.useState(null),I=(F=null)=>{m(F),f(!0)},k=()=>{m(null),f(!1)},M=F=>{T(F),g(!0)},j=()=>{N&&i(N),g(!1),T(null)},O=F=>{h?r({...h,...F}):n(F),k()},A=F=>{D(F),w(!0)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("seaweedTypeManagementTitle")}),s.jsxs(se,{onClick:()=>I(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addSeaweedType")]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(F=>s.jsxs(ze,{children:[s.jsx("h2",{className:"text-xl font-bold",children:F.name}),s.jsx("p",{className:"italic text-gray-500 dark:text-gray-400",children:F.scientificName}),s.jsx("p",{className:"mt-2 text-sm",children:F.description}),s.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700 space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("wetPrice"),":"]})," ",Ae(F.wetPrice,l.localization)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("dryPrice"),":"]})," ",Ae(F.dryPrice,l.localization)]})]}),s.jsxs("div",{className:"mt-4 flex gap-2 flex-wrap",children:[s.jsxs(se,{variant:"secondary",onClick:()=>c(`/seaweed-types/${F.id}/cultivation`),children:[s.jsx(te,{name:"GitBranch",className:"w-4 h-4"}),t("cycles")]}),s.jsxs(se,{variant:"ghost",onClick:()=>A(F),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"}),t("priceHistory")]}),s.jsx(se,{variant:"secondary",onClick:()=>I(F),children:t("edit")}),s.jsx(se,{variant:"danger",onClick:()=>M(F.id),children:t("delete")})]})]},F.id))}),d&&s.jsx(HL,{isOpen:d,onClose:k,seaweedType:h,onSave:O}),x&&s.jsx(Qt,{isOpen:x,onClose:()=>g(!1),onConfirm:j,title:t("confirmDeleteTitle"),message:t("confirmDeleteSeaweedType")}),C&&E&&s.jsx(GL,{isOpen:C,onClose:()=>w(!1),seaweedType:E})]})},HL=({isOpen:t,onClose:e,seaweedType:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState({name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0}),[d,f]=S.useState({});S.useEffect(()=>{c(n||{name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0})},[n,t]);const h=S.useCallback(()=>{const N={};return l.name.trim()||(N.name=i("validationRequired")),(isNaN(l.wetPrice)||l.wetPrice<=0)&&(N.wetPrice=i("validationPositiveNumber")),(isNaN(l.dryPrice)||l.dryPrice<=0)&&(N.dryPrice=i("validationPositiveNumber")),N},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(N,T)=>{c(C=>({...C,[N]:T}))},x=N=>{N.preventDefault(),!(Object.keys(d).length>0)&&r({...l,wetPrice:Number(l.wetPrice),dryPrice:Number(l.dryPrice)})},g=Object.keys(d).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editSeaweedType":"addSeaweedType"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsx(de,{label:i("name"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name,required:!0}),s.jsx(de,{label:i("scientificName"),value:l.scientificName,onChange:N=>m("scientificName",N.target.value)}),s.jsx(de,{label:i("description"),value:l.description,onChange:N=>m("description",N.target.value)}),s.jsx(de,{label:i("wetPrice"),type:"number",value:l.wetPrice,onChange:N=>m("wetPrice",parseFloat(N.target.value)),error:d.wetPrice,required:!0}),s.jsx(de,{label:i("dryPrice"),type:"number",value:l.dryPrice,onChange:N=>m("dryPrice",parseFloat(N.target.value)),error:d.dryPrice,required:!0}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",disabled:g,children:i("save")})]})]})})},VL=({isOpen:t,onClose:e,data:n,onSave:r})=>{var A,F,P;const{t:i}=_e(),{sites:l,modules:c,cultivationCycles:d}=qe(),[f,h]=S.useState(""),[m,x]=S.useState({siteId:"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),[g,N]=S.useState([]),[T,C]=S.useState({}),[w,E]=S.useState(null);S.useEffect(()=>{var U;n?(x({siteId:n.module.siteId,zoneId:n.module.zoneId,lines:n.module.lines,poles:n.module.poles,latitude:n.module.latitude||"",longitude:n.module.longitude||""}),h(n.module.code)):(x({siteId:((U=l[0])==null?void 0:U.id)||"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),h("")),E(null)},[n,t,l]),S.useEffect(()=>{if(n&&(n.module.siteId!==m.siteId||n.module.zoneId!==m.zoneId)){const U=d.find(q=>q.moduleId===n.module.id&&(q.status===Xe.PLANTED||q.status===Xe.GROWING));E(U?i("moduleMoveActiveCycleWarning"):null)}else E(null)},[n,m.siteId,m.zoneId,d,i]);const D=S.useCallback(()=>{const U={poles:{}};if(m.siteId||(U.siteId=i("validationRequired")),m.zoneId||(U.zoneId=i("validationRequired")),(isNaN(m.lines)||m.lines<=0)&&(U.lines=i("validationPositiveNumber")),m.latitude.trim())try{wn(m.latitude)}catch{U.latitude=i("invalidDMSFormat")}if(m.longitude.trim())try{wn(m.longitude)}catch{U.longitude=i("invalidDMSFormat")}let q=!1;for(const z of["galvanized","wood","plastic"])(isNaN(m.poles[z])||m.poles[z]<0)&&(U.poles[z]=i("validationNonNegative"),q=!0);return q||delete U.poles,U},[m,i]);S.useEffect(()=>{const U=l.find(q=>q.id===m.siteId);N((U==null?void 0:U.zones)||[])},[m.siteId,l]),S.useEffect(()=>{if(m.siteId&&m.zoneId){const U=l.find(z=>z.id===m.siteId),q=U==null?void 0:U.zones.find(z=>z.id===m.zoneId);if(U&&q){const z=U.code||"SITE",J=q.name.replace(/zone/i,"").trim().replace(/[^A-Z0-9]/ig,"").toUpperCase()||"Z";let Y;const G=!!n,B=G&&(n.module.siteId!==m.siteId||n.module.zoneId!==m.zoneId);if(!G||B){const re=c.filter(ue=>ue.zoneId===m.zoneId).map(ue=>{const Ne=ue.code.split("-"),le=Ne[Ne.length-1];return le&&/^\d+$/.test(le)?parseInt(le,10):NaN}).filter(ue=>!isNaN(ue)),ae=(re.length>0?Math.max(...re):0)+1;Y=String(ae).padStart(2,"0")}else{const K=n.module.code.split("-");Y=K[K.length-1]||"01"}const Q=`${z}-${J}-${Y}`;h(Q)}}else n||h("")},[n,m.siteId,m.zoneId,l,c]),S.useEffect(()=>{C(D())},[m,D]);const I=(U,q)=>{x(z=>({...z,[U]:q}))},k=(U,q)=>{x(z=>({...z,poles:{...z.poles,[U]:q}}))},M=U=>{const q=l.find(J=>J.id===U),z=(q==null?void 0:q.zones)||[];x(J=>{var Y;return{...J,siteId:U,zoneId:((Y=z[0])==null?void 0:Y.id)||""}})},j=U=>{U.preventDefault();const q=D();if(Object.keys(q).length>0){C(q);return}if(n){const z={...n.module,code:f,siteId:m.siteId,zoneId:m.zoneId,lines:Number(m.lines),poles:{galvanized:Number(m.poles.galvanized),wood:Number(m.poles.wood),plastic:Number(m.poles.plastic)},latitude:m.latitude.trim()||void 0,longitude:m.longitude.trim()||void 0};r(z)}else{const z={code:f,siteId:m.siteId,zoneId:m.zoneId,lines:Number(m.lines),poles:{galvanized:Number(m.poles.galvanized),wood:Number(m.poles.wood),plastic:Number(m.poles.plastic)},latitude:m.latitude.trim()||void 0,longitude:m.longitude.trim()||void 0};r(z)}},O=Object.keys(T).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editModule":"addModule"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:j,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("moduleCode"),value:f,disabled:!0}),s.jsx(ke,{label:i("site"),value:m.siteId,onChange:U=>M(U.target.value),error:T.siteId,children:l.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))}),s.jsxs(ke,{label:i("zoneName"),value:m.zoneId,onChange:U=>I("zoneId",U.target.value),error:T.zoneId,disabled:!m.siteId,children:[s.jsx("option",{value:"",children:i("selectZone")}),g.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(go,{label:`${i("latitudeDMS")} (${i("optional")})`,value:m.latitude,onChange:U=>I("latitude",U),axis:"lat",error:T.latitude}),s.jsx(go,{label:`${i("longitudeDMS")} (${i("optional")})`,value:m.longitude,onChange:U=>I("longitude",U),axis:"lon",error:T.longitude})]}),w&&s.jsxs("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700 rounded-md text-sm flex items-center gap-2",children:[s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 flex-shrink-0"}),w]}),s.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:i("configuration")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(de,{label:i("lines"),type:"number",value:m.lines,onChange:U=>I("lines",Number(U.target.value)),error:T.lines,required:!0}),s.jsx(de,{label:i("galvanizedPoles"),type:"number",value:m.poles.galvanized,onChange:U=>k("galvanized",Number(U.target.value)),error:(A=T.poles)==null?void 0:A.galvanized,required:!0}),s.jsx(de,{label:i("woodPoles"),type:"number",value:m.poles.wood,onChange:U=>k("wood",Number(U.target.value)),error:(F=T.poles)==null?void 0:F.wood,required:!0}),s.jsx(de,{label:i("plasticPoles"),type:"number",value:m.poles.plastic,onChange:U=>k("plastic",Number(U.target.value)),error:(P=T.poles)==null?void 0:P.plastic,required:!0})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",disabled:O,children:i("save")})]})]})})},SC=({isOpen:t,onClose:e,history:n,moduleCode:r})=>{const{t:i,language:l}=_e(),c=[...n].sort((d,f)=>new Date(f.date).getTime()-new Date(d.date).getTime());return s.jsx(ot,{isOpen:t,onClose:e,title:`${i("moduleStatusHistoryTitle")}: ${r}`,widthClass:"max-w-2xl",children:s.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:s.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:c.map((d,f)=>s.jsxs("li",{className:"mb-8 ml-8",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:s.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),s.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(An,{status:d.status}),s.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(d.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),d.notes&&s.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",d.notes]})]},f))})})})},_C=({qrData:t,title:e,subtitle:n,detail:r,onClose:i})=>{const{settings:l}=Ke(),c=S.useRef(null);S.useEffect(()=>{c.current&&(c.current.innerHTML="",new QRCode(c.current,{text:JSON.stringify(t),width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))},[t]);const d=()=>{window.print()};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-[1100] flex items-center justify-center backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4",children:[s.jsxs("div",{id:"printable-qr-label",className:"border-2 border-black p-4 flex flex-col items-center text-center bg-white w-[300px] h-[200px] mx-auto mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 w-full border-b border-gray-300 pb-2 mb-2",children:[s.jsx("img",{src:l.company.logoUrl,className:"h-8 object-contain"}),s.jsx("span",{className:"text-xs font-bold uppercase truncate",children:l.company.name})]}),s.jsxs("div",{className:"flex-grow flex flex-row items-center gap-4 w-full",children:[s.jsx("div",{ref:c,className:"w-[96px] h-[96px]"}),s.jsxs("div",{className:"text-left flex-1 overflow-hidden",children:[s.jsx("h2",{className:"text-lg font-bold leading-tight uppercase break-words",children:e}),n&&s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:n}),r&&s.jsx("p",{className:"text-[10px] font-mono mt-2",children:r})]})]}),s.jsx("div",{className:"text-[8px] text-gray-400 w-full text-right mt-1",children:new Date().toLocaleDateString()})]}),s.jsxs("div",{className:"flex justify-end gap-2 no-print",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",children:"Close"}),s.jsxs("button",{onClick:d,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Label"]})]})]})})},qL=()=>{const{t}=_e(),{settings:e}=Ke(),{modules:n,cultivationCycles:r,sites:i,seaweedTypes:l,deleteModule:c,addModule:d,updateModule:f,farmers:h,deleteMultipleModules:m,updateModulesFarmer:x}=qe(),[g,N]=S.useState(!1),[T,C]=S.useState(null),[w,E]=S.useState(!1),[D,I]=S.useState(null),[k,M]=S.useState(!1),[j,O]=S.useState(null),[A,F]=S.useState(""),[P,U]=S.useState([]),[q,z]=S.useState(!1),[J,Y]=S.useState(null),[G,B]=S.useState(!1),[Q,K]=wg(),re=Q.get("highlight"),[H,ae]=S.useState("table"),[ue,Ne]=S.useState(null),[le,ne]=S.useState({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),[Te,fe]=S.useState([]);S.useEffect(()=>{if(le.siteId==="all")fe([]);else{const ye=i.find(Fe=>Fe.id===le.siteId);fe((ye==null?void 0:ye.zones)||[])}},[le.siteId,i]);const Z=(ye,Fe)=>{ne(ye==="siteId"?et=>({...et,siteId:Fe,zoneId:"all"}):et=>({...et,[ye]:Fe}))},ee=S.useCallback(()=>{ne({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),U([])},[]),xe=S.useMemo(()=>n.map(ye=>{const Fe=[...r].filter(St=>St.moduleId===ye.id).sort((St,on)=>new Date(on.plantingDate).getTime()-new Date(St.plantingDate).getTime())[0],et=i.find(St=>St.id===ye.siteId),Lt=et==null?void 0:et.zones.find(St=>St.id===ye.zoneId),ut=Fe?l.find(St=>St.id===Fe.seaweedTypeId):void 0,$t=ye.farmerId?h.find(St=>St.id===ye.farmerId):void 0;let Pt;if(!ye.farmerId){const St=r.filter(on=>on.moduleId===ye.id&&on.harvestDate).sort((on,tr)=>new Date(tr.harvestDate).getTime()-new Date(on.harvestDate).getTime());if(St.length>0){const on=new Date(St[0].harvestDate),gr=Math.floor((new Date().getTime()-on.getTime())/(1e3*60*60*24));gr>Ip&&(Pt={type:"unassigned_long",message:t("notification_unassigned").replace("{code}",ye.code).replace("{days}",String(gr))})}}return{module:ye,cycle:Fe,site:et,zone:Lt,seaweedType:ut,farmer:$t,alert:Pt}}).filter(ye=>{const{module:Fe}=ye;if(!Fe)return!1;const et=le.code?Fe.code.toLowerCase().includes(le.code.toLowerCase()):!0,Lt=le.siteId!=="all"?Fe.siteId===le.siteId:!0,ut=le.zoneId!=="all"?Fe.zoneId===le.zoneId:!0,$t=le.farmerId!=="all"?Fe.farmerId===le.farmerId:!0,Pt=(()=>{switch(le.status){case"free":return!Fe.farmerId;case"assigned":return!!Fe.farmerId;case"with_alerts":return!!ye.alert;case"all":default:return!0}})();return et&&Lt&&ut&&$t&&Pt}),[n,r,i,l,h,t,le]);S.useMemo(()=>{if(P.length===0)return{farmers:[],isMultiSite:!1};const ye=n.filter(et=>P.includes(et.id)),Fe=new Set(ye.map(et=>et.siteId));if(Fe.size===1){const[et]=Fe;return{farmers:h.filter(Lt=>Lt.siteId===et),isMultiSite:!1}}return{farmers:[],isMultiSite:Fe.size>1}},[P,n,h]),S.useEffect(()=>{if(re){const ye=xe.find(Fe=>Fe.module.id===re);ye&&(Y(ye),K({},{replace:!0}))}},[re,xe,K]),S.useEffect(()=>{const ye=new Set(xe.map(Fe=>Fe.module.id));U(Fe=>Fe.filter(et=>ye.has(et)))},[xe]),S.useMemo(()=>n.length,[n]),S.useMemo(()=>r.filter(ye=>ye.status===Xe.PLANTED||ye.status===Xe.GROWING).length,[r]),S.useMemo(()=>{const ye=new Date;ye.setHours(0,0,0,0);const Fe=45;return r.filter(et=>{if(et.status===Xe.PLANTED||et.status===Xe.GROWING){const Lt=new Date(et.plantingDate);return Lt.setHours(0,0,0,0),(ye.getTime()-Lt.getTime())/(1e3*60*60*24)>Fe}return!1}).length},[r]),S.useMemo(()=>n.reduce((ye,Fe)=>ye+Fe.lines,0),[n]);const Oe=S.useMemo(()=>[...h].sort((ye,Fe)=>`${ye.firstName} ${ye.lastName}`.localeCompare(`${Fe.firstName} ${Fe.lastName}`)),[h]),De=(ye=null)=>{C(ye),N(!0)},Re=()=>{C(null),N(!1)},$e=ye=>{I(ye),E(!0)},He=()=>{D&&c(D),E(!1),I(null)},Se=ye=>{"id"in ye?f(ye):d(ye),Re()},Le=(ye,Fe)=>{O(ye),F(Fe),M(!0)},be=ye=>{var Fe;Ne({data:{t:"m",id:ye.id},title:ye.code,subtitle:((Fe=i.find(et=>et.id===ye.siteId))==null?void 0:Fe.name)||""})};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("moduleManagementTitle")}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs(se,{onClick:()=>De(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addModule")]})})]}),s.jsxs(ze,{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:t("filtersTitle")}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end",children:[s.jsx(de,{label:t("moduleCode"),value:le.code,onChange:ye=>Z("code",ye.target.value)}),s.jsxs(ke,{label:t("site"),value:le.siteId,onChange:ye=>Z("siteId",ye.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),i.map(ye=>s.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),s.jsxs(ke,{label:t("zoneName"),value:le.zoneId,onChange:ye=>Z("zoneId",ye.target.value),disabled:le.siteId==="all",children:[s.jsx("option",{value:"all",children:t("allZones")}),Te.map(ye=>s.jsx("option",{value:ye.id,children:ye.name},ye.id))]}),s.jsxs(ke,{label:t("farmer"),value:le.farmerId,onChange:ye=>Z("farmerId",ye.target.value),children:[s.jsx("option",{value:"all",children:t("allFarmers")}),Oe.map(ye=>s.jsxs("option",{value:ye.id,children:[ye.firstName," ",ye.lastName]},ye.id))]}),s.jsxs(ke,{label:t("status"),value:le.status,onChange:ye=>Z("status",ye.target.value),children:[s.jsx("option",{value:"all",children:t("allStatuses")}),s.jsx("option",{value:"free",children:t("status_FREE")}),s.jsx("option",{value:"assigned",children:t("status_ASSIGNED")}),s.jsx("option",{value:"with_alerts",children:t("alerts")})]}),s.jsx(se,{variant:"secondary",onClick:ee,className:"h-[42px] w-full",children:t("clearFilters")})]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-16",children:t("status")}),s.jsx("th",{className:"p-3",children:t("moduleCode")}),s.jsx("th",{className:"p-3",children:t("site")}),s.jsx("th",{className:"p-3",children:t("zoneName")}),s.jsx("th",{className:"p-3",children:t("farmer")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:xe.map(ye=>{var Fe,et;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(An,{status:ye.module.farmerId?"ASSIGNED":"FREE"})}),s.jsx("td",{className:"p-3 font-mono font-bold",children:ye.module.code}),s.jsx("td",{className:"p-3",children:(Fe=ye.site)==null?void 0:Fe.name}),s.jsx("td",{className:"p-3",children:(et=ye.zone)==null?void 0:et.name}),s.jsx("td",{className:"p-3",children:ye.farmer?`${ye.farmer.firstName} ${ye.farmer.lastName}`:"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(se,{variant:"ghost",onClick:()=>be(ye.module),title:t("print"),children:s.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),s.jsx(se,{variant:"ghost",onClick:()=>De(ye),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(se,{variant:"ghost",onClick:()=>Le(ye.module.statusHistory,ye.module.code),children:s.jsx(te,{name:"FileText",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>$e(ye.module.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},ye.module.id)})})]})})}),g&&s.jsx(VL,{isOpen:g,onClose:Re,data:T,onSave:Se}),w&&s.jsx(Qt,{isOpen:w,onClose:()=>E(!1),onConfirm:He,title:t("confirmDeleteTitle"),message:t("confirmDeleteModule")}),k&&j&&s.jsx(SC,{isOpen:k,onClose:()=>M(!1),history:j,moduleCode:A}),ue&&s.jsx(_C,{qrData:ue.data,title:ue.title,subtitle:ue.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>Ne(null)})]})},WL=({isOpen:t,onClose:e,cycle:n,module:r})=>{const{t:i,language:l}=_e(),{cuttingOperations:c,serviceProviders:d}=qe(),f=S.useMemo(()=>new Map(d.map(m=>[m.id,m.name])),[d]),h=S.useMemo(()=>{const m=[];if(!n)return[];if(n.cuttingOperationId){const x=c.find(g=>g.id===n.cuttingOperationId);if(x){const g=f.get(x.serviceProviderId),N=g?`Provider: ${g}`:`Operation ID: ${x.id}`;m.push({status:"CUTTING",date:x.date,notes:N})}}if(n.plantingDate&&(m.push({status:"PLANTED",date:n.plantingDate}),!n.harvestDate)){const x=new Date(n.plantingDate);x.setDate(x.getDate()+1),m.push({status:"GROWING",date:x.toISOString().split("T")[0]})}return n.harvestDate&&m.push({status:"HARVESTED",date:n.harvestDate}),n.dryingStartDate&&m.push({status:"DRYING",date:n.dryingStartDate}),n.baggingStartDate&&m.push({status:"BAGGING",date:n.baggingStartDate}),n.stockDate&&m.push({status:"IN_STOCK",date:n.stockDate}),n.exportDate&&m.push({status:"EXPORTED",date:n.exportDate}),m.filter(x=>x.date).sort((x,g)=>new Date(g.date).getTime()-new Date(x.date).getTime())},[n,c,f]);return s.jsx(ot,{isOpen:t,onClose:e,title:`${i("cultivationCycleHistoryTitle")}: ${r.code}`,widthClass:"max-w-2xl",children:s.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:s.jsxs("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:[h.map((m,x)=>s.jsxs("li",{className:"mb-8 ml-8",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:s.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),s.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(An,{status:m.status}),s.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(m.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),m.notes&&s.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",m.notes]})]},x)),h.length===0&&s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:i("noCycleHistoryEvents")})]})})})};var ec={exports:{}},mp={},pp,JN;function $L(){if(JN)return pp;JN=1;function t(e,n){typeof n=="boolean"&&(n={forever:n}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=n||{},this._maxRetryTime=n&&n.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return pp=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var n=new Date().getTime();if(e&&n-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,n){this._fn=e,n&&(n.timeout&&(this._operationTimeout=n.timeout),n.cb&&(this._operationTimeoutCb=n.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},n=null,r=0,i=0;i<this._errors.length;i++){var l=this._errors[i],c=l.message,d=(e[c]||0)+1;e[c]=d,d>=r&&(n=l,r=d)}return n},pp}var XN;function KL(){return XN||(XN=1,(function(t){var e=$L();t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in n)r[i]=n[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var l=[],c=0;c<r.retries;c++)l.push(this.createTimeout(c,r));return n&&n.forever&&!l.length&&l.push(this.createTimeout(c,r)),l.sort(function(d,f){return d-f}),l},t.createTimeout=function(n,r){var i=r.randomize?Math.random()+1:1,l=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return l=Math.min(l,r.maxTimeout),l},t.wrap=function(n,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var l in n)typeof n[l]=="function"&&i.push(l)}for(var c=0;c<i.length;c++){var d=i[c],f=n[d];n[d]=(function(m){var x=t.operation(r),g=Array.prototype.slice.call(arguments,1),N=g.pop();g.push(function(T){x.retry(T)||(T&&(arguments[0]=x.mainError()),N.apply(this,arguments))}),x.attempt(function(){m.apply(n,g)})}).bind(n,f),n[d].options=r}}})(mp)),mp}var gp,QN;function YL(){return QN||(QN=1,gp=KL()),gp}var ZN;function JL(){if(ZN)return ec.exports;ZN=1;const t=YL(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(d){super(),d instanceof Error?(this.originalError=d,{message:d}=d):(this.originalError=new Error(d),this.originalError.stack=this.stack),this.name="AbortError",this.message=d}}const r=(c,d,f)=>{const h=f.retries-(d-1);return c.attemptNumber=d,c.retriesLeft=h,c},i=c=>e.includes(c),l=(c,d)=>new Promise((f,h)=>{d={onFailedAttempt:()=>{},retries:10,...d};const m=t.operation(d);m.attempt(async x=>{try{f(await c(x))}catch(g){if(!(g instanceof Error)){h(new TypeError(`Non-error was thrown: "${g}". You should only throw errors.`));return}if(g instanceof n)m.stop(),h(g.originalError);else if(g instanceof TypeError&&!i(g.message))m.stop(),h(g);else{r(g,x,d);try{await d.onFailedAttempt(g)}catch(N){h(N);return}m.retry(g)||h(m.mainError())}}})});return ec.exports=l,ec.exports.default=l,ec.exports.AbortError=n,ec.exports}var wC=JL();const XL=pg(wC);var QL={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ZL,e3;function t3(){return{geminiUrl:ZL,vertexUrl:e3}}function n3(t,e,n,r){var i,l;if(!(t!=null&&t.baseUrl)){const c=t3();return e?(i=c.vertexUrl)!==null&&i!==void 0?i:n:(l=c.geminiUrl)!==null&&l!==void 0?l:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ei{}function We(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const l=e[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function v(t,e,n){for(let l=0;l<e.length-1;l++){const c=e[l];if(c.endsWith("[]")){const d=c.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[d])){const f=t[d];if(Array.isArray(n))for(let h=0;h<f.length;h++){const m=f[h];v(m,e.slice(l+1),n[h])}else for(const h of f)v(h,e.slice(l+1),n)}return}else if(c.endsWith("[0]")){const d=c.slice(0,-3);d in t||(t[d]=[{}]);const f=t[d];v(f[0],e.slice(l+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const r=e[e.length-1],i=t[r];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function y(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const i=e[r];if(i.endsWith("[]")){const l=i.slice(0,-2);if(l in t){const c=t[l];return Array.isArray(c)?c.map(d=>y(d,e.slice(r+1),n)):n}else return n}else t=t[i]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function s3(t,e){for(const[n,r]of Object.entries(e)){const i=n.split("."),l=r.split("."),c=new Set;let d=-1;for(let f=0;f<i.length;f++)if(i[f]==="*"){d=f;break}if(d!==-1&&l.length>d)for(let f=d;f<l.length;f++){const h=l[f];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}eg(t,i,l,0,c)}}function eg(t,e,n,r,i){if(r>=e.length||typeof t!="object"||t===null)return;const l=e[r];if(l.endsWith("[]")){const c=l.slice(0,-2),d=t;if(c in d&&Array.isArray(d[c]))for(const f of d[c])eg(f,e,n,r+1,i)}else if(l==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,d=Object.keys(c).filter(h=>!h.startsWith("_")&&!i.has(h)),f={};for(const h of d)f[h]=c[h];for(const[h,m]of Object.entries(f)){const x=[];for(const g of n.slice(r))g==="*"?x.push(h):x.push(g);v(c,x,m)}for(const h of d)delete c[h]}}else{const c=t;l in c&&eg(c[l],e,n,r+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Sy(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function r3(t){const e={},n=y(t,["operationName"]);n!=null&&v(e,["operationName"],n);const r=y(t,["resourceName"]);return r!=null&&v(e,["_url","resourceName"],r),e}function i3(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response","generateVideoResponse"]);return c!=null&&v(e,["response"],o3(c)),e}function a3(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],l3(c)),e}function o3(t){const e={},n=y(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>c3(c))),v(e,["generatedVideos"],l)}const r=y(t,["raiMediaFilteredCount"]);r!=null&&v(e,["raiMediaFilteredCount"],r);const i=y(t,["raiMediaFilteredReasons"]);return i!=null&&v(e,["raiMediaFilteredReasons"],i),e}function l3(t){const e={},n=y(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>d3(c))),v(e,["generatedVideos"],l)}const r=y(t,["raiMediaFilteredCount"]);r!=null&&v(e,["raiMediaFilteredCount"],r);const i=y(t,["raiMediaFilteredReasons"]);return i!=null&&v(e,["raiMediaFilteredReasons"],i),e}function c3(t){const e={},n=y(t,["video"]);return n!=null&&v(e,["video"],g3(n)),e}function d3(t){const e={},n=y(t,["_self"]);return n!=null&&v(e,["video"],y3(n)),e}function u3(t){const e={},n=y(t,["operationName"]);return n!=null&&v(e,["_url","operationName"],n),e}function h3(t){const e={},n=y(t,["operationName"]);return n!=null&&v(e,["_url","operationName"],n),e}function f3(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],m3(c)),e}function m3(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function TC(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],p3(c)),e}function p3(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function g3(t){const e={},n=y(t,["uri"]);n!=null&&v(e,["uri"],n);const r=y(t,["encodedVideo"]);r!=null&&v(e,["videoBytes"],Sy(r));const i=y(t,["encoding"]);return i!=null&&v(e,["mimeType"],i),e}function y3(t){const e={},n=y(t,["gcsUri"]);n!=null&&v(e,["uri"],n);const r=y(t,["bytesBase64Encoded"]);r!=null&&v(e,["videoBytes"],Sy(r));const i=y(t,["mimeType"]);return i!=null&&v(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var eS;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(eS||(eS={}));var tS;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(tS||(tS={}));var nS;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(nS||(nS={}));var _n;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(_n||(_n={}));var sS;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(sS||(sS={}));var rS;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(rS||(rS={}));var iS;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(iS||(iS={}));var aS;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(aS||(aS={}));var oS;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(oS||(oS={}));var lS;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(lS||(lS={}));var cS;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(cS||(cS={}));var dS;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(dS||(dS={}));var uS;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(uS||(uS={}));var hS;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(hS||(hS={}));var fS;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(fS||(fS={}));var mS;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(mS||(mS={}));var pS;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(pS||(pS={}));var gS;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(gS||(gS={}));var yS;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(yS||(yS={}));var xS;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(xS||(xS={}));var vS;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(vS||(vS={}));var th;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(th||(th={}));var bS;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(bS||(bS={}));var NS;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(NS||(NS={}));var SS;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(SS||(SS={}));var tg;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(tg||(tg={}));var _S;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(_S||(_S={}));var wS;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(wS||(wS={}));var ng;(function(t){t.COLLECTION="COLLECTION"})(ng||(ng={}));var TS;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(TS||(TS={}));var CS;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(CS||(CS={}));var nh;(function(t){t.PREDICT="PREDICT",t.EMBED_CONTENT="EMBED_CONTENT"})(nh||(nh={}));var ES;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(ES||(ES={}));var IS;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(IS||(IS={}));var jS;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(jS||(jS={}));var AS;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(AS||(AS={}));var kS;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(kS||(kS={}));var DS;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(DS||(DS={}));var RS;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(RS||(RS={}));var MS;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(MS||(MS={}));var PS;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(PS||(PS={}));var OS;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(OS||(OS={}));var LS;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(LS||(LS={}));var FS;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING",t.DISTILLATION="DISTILLATION"})(FS||(FS={}));var US;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(US||(US={}));var BS;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(BS||(BS={}));var GS;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED",t.REGISTERED="REGISTERED"})(GS||(GS={}));var zS;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(zS||(zS={}));var HS;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(HS||(HS={}));var VS;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(VS||(VS={}));var qS;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.ACTIVITY_START="ACTIVITY_START",t.ACTIVITY_END="ACTIVITY_END"})(qS||(qS={}));var WS;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(WS||(WS={}));var $S;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})($S||($S={}));var KS;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(KS||(KS={}));var YS;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(YS||(YS={}));var JS;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(JS||(JS={}));var XS;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(XS||(XS={}));var yo;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(yo||(yo={}));class sg{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class tc{get text(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",m=!1;const x=[];for(const g of(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&f!==void 0?f:[]){for(const[N,T]of Object.entries(g))N!=="text"&&N!=="thought"&&N!=="thoughtSignature"&&(T!==null||T!==void 0)&&x.push(N);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;m=!0,h+=g.text}}return x.length>0&&console.warn(`there are non-text parts ${x} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?h:void 0}get data(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const m=[];for(const x of(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&f!==void 0?f:[]){for(const[g,N]of Object.entries(x))g!=="inlineData"&&(N!==null||N!==void 0)&&m.push(g);x.inlineData&&typeof x.inlineData.data=="string"&&(h+=atob(x.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,n,r,i,l,c,d,f,h;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(x=>x.executableCode).map(x=>x.executableCode).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,n,r,i,l,c,d,f,h;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(x=>x.codeExecutionResult).map(x=>x.codeExecutionResult).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.output}}class QS{}class ZS{}class x3{}class v3{}class b3{}class N3{}class e_{}class t_{}class n_{}class S3{}class sh{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new sh;let i;const l=e;return n?i=a3(l):i=i3(l),Object.assign(r,i),r}}class s_{}class r_{}class i_{}class a_{}class _3{}class w3{}class T3{}class _y{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new _y,l=f3(e);return Object.assign(r,l),r}}class C3{}class E3{}class I3{}class j3{}class o_{}class A3{get text(){var e,n,r;let i="",l=!1;const c=[];for(const d of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[f,h]of Object.entries(d))f!=="text"&&f!=="thought"&&h!==null&&c.push(f);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;l=!0,i+=d.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var e,n,r;let i="";const l=[];for(const c of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[d,f]of Object.entries(c))d!=="inlineData"&&f!==null&&l.push(d);c.inlineData&&typeof c.inlineData.data=="string"&&(i+=atob(c.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class k3{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class wy{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new wy,l=TC(e);return Object.assign(r,l),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mt(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function CC(t,e){const n=Mt(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function EC(t){return Array.isArray(t)?t.map(e=>rh(e)):[rh(t)]}function rh(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function IC(t){const e=rh(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function jC(t){const e=rh(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function l_(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function AC(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>l_(e)):[l_(t)]}function rg(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function c_(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function d_(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Pn(t){if(t==null)throw new Error("ContentUnion is required");return rg(t)?t:{role:"user",parts:AC(t)}}function Ty(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=Pn(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=Pn(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Pn(n)):[Pn(e)]}function Ns(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(c_(t)||d_(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Pn(t)]}const e=[],n=[],r=rg(t[0]);for(const i of t){const l=rg(i);if(l!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(i);else{if(c_(i)||d_(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:AC(n)}),e}function D3(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(_n).includes(n[0].toUpperCase())?n[0].toUpperCase():_n.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(_n).includes(r.toUpperCase())?r.toUpperCase():_n.TYPE_UNSPECIFIED})}}function wo(t){const e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=t.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(e.nullable=!0,t=l[1]):l[1].type==="null"&&(e.nullable=!0,t=l[0])),t.type instanceof Array&&D3(t.type,e);for(const[c,d]of Object.entries(t))if(d!=null)if(c=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(_n).includes(d.toUpperCase())?d.toUpperCase():_n.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=wo(d);else if(r.includes(c)){const f=[];for(const h of d){if(h.type=="null"){e.nullable=!0;continue}f.push(wo(h))}e[c]=f}else if(i.includes(c)){const f={};for(const[h,m]of Object.entries(d))f[h]=wo(m);e[c]=f}else{if(c==="additionalProperties")continue;e[c]=d}return e}function Cy(t){return wo(t)}function Ey(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Iy(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function qo(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=wo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=wo(e.response));return t}function Wo(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function R3(t,e,n,r=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function ti(t,e){if(typeof e!="string")throw new Error("name must be a string");return R3(t,e,"cachedContents")}function kC(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Yi(t){return Sy(t)}function M3(t){return t!=null&&typeof t=="object"&&"name"in t}function P3(t){return t!=null&&typeof t=="object"&&"video"in t}function O3(t){return t!=null&&typeof t=="object"&&"uri"in t}function DC(t){var e;let n;if(M3(t)&&(n=t.name),!(O3(t)&&(n=t.uri,n===void 0))&&!(P3(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function RC(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function MC(t){for(const e of["models","tunedModels","publisherModels"])if(L3(t,e))return t[e];return[]}function L3(t,e){return t!==null&&typeof t=="object"&&e in t}function F3(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function U3(t,e={}){const n=[],r=new Set;for(const i of t){const l=i.name;if(r.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);r.add(l);const c=F3(i,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function PC(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function B3(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function OC(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let l=!1;for(const c of i){if(typeof c!="object"||c===null)continue;const f=c.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){l=!0;break}}return l&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function $o(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function LC(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function G3(t){return t.includes("gemini")&&t!=="gemini-embedding-001"||t.includes("maas")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function z3(t){const e={},n=y(t,["responsesFile"]);n!=null&&v(e,["fileName"],n);const r=y(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>S4(c))),v(e,["inlinedResponses"],l)}const i=y(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["inlinedEmbedContentResponses"],l)}return e}function H3(t){const e={},n=y(t,["predictionsFormat"]);n!=null&&v(e,["format"],n);const r=y(t,["gcsDestination","outputUriPrefix"]);r!=null&&v(e,["gcsUri"],r);const i=y(t,["bigqueryDestination","outputUri"]);return i!=null&&v(e,["bigqueryUri"],i),e}function V3(t){const e={},n=y(t,["format"]);n!=null&&v(e,["predictionsFormat"],n);const r=y(t,["gcsUri"]);r!=null&&v(e,["gcsDestination","outputUriPrefix"],r);const i=y(t,["bigqueryUri"]);if(i!=null&&v(e,["bigqueryDestination","outputUri"],i),y(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(y(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(y(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Eu(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata","displayName"]);r!=null&&v(e,["displayName"],r);const i=y(t,["metadata","state"]);i!=null&&v(e,["state"],LC(i));const l=y(t,["metadata","createTime"]);l!=null&&v(e,["createTime"],l);const c=y(t,["metadata","endTime"]);c!=null&&v(e,["endTime"],c);const d=y(t,["metadata","updateTime"]);d!=null&&v(e,["updateTime"],d);const f=y(t,["metadata","model"]);f!=null&&v(e,["model"],f);const h=y(t,["metadata","output"]);return h!=null&&v(e,["dest"],z3(OC(h))),e}function ig(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["displayName"]);r!=null&&v(e,["displayName"],r);const i=y(t,["state"]);i!=null&&v(e,["state"],LC(i));const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["createTime"]);c!=null&&v(e,["createTime"],c);const d=y(t,["startTime"]);d!=null&&v(e,["startTime"],d);const f=y(t,["endTime"]);f!=null&&v(e,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(e,["updateTime"],h);const m=y(t,["model"]);m!=null&&v(e,["model"],m);const x=y(t,["inputConfig"]);x!=null&&v(e,["src"],q3(x));const g=y(t,["outputConfig"]);g!=null&&v(e,["dest"],H3(OC(g)));const N=y(t,["completionStats"]);return N!=null&&v(e,["completionStats"],N),e}function q3(t){const e={},n=y(t,["instancesFormat"]);n!=null&&v(e,["format"],n);const r=y(t,["gcsSource","uris"]);r!=null&&v(e,["gcsUri"],r);const i=y(t,["bigquerySource","inputUri"]);return i!=null&&v(e,["bigqueryUri"],i),e}function W3(t,e){const n={};if(y(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(y(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(y(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=y(e,["fileName"]);r!=null&&v(n,["fileName"],r);const i=y(e,["inlinedRequests"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>N4(t,c))),v(n,["requests","requests"],l)}return n}function $3(t){const e={},n=y(t,["format"]);n!=null&&v(e,["instancesFormat"],n);const r=y(t,["gcsUri"]);r!=null&&v(e,["gcsSource","uris"],r);const i=y(t,["bigqueryUri"]);if(i!=null&&v(e,["bigquerySource","inputUri"],i),y(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(y(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function K3(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function Y3(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function J3(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function X3(t){const e={},n=y(t,["content"]);n!=null&&v(e,["content"],n);const r=y(t,["citationMetadata"]);r!=null&&v(e,["citationMetadata"],Q3(r));const i=y(t,["tokenCount"]);i!=null&&v(e,["tokenCount"],i);const l=y(t,["finishReason"]);l!=null&&v(e,["finishReason"],l);const c=y(t,["avgLogprobs"]);c!=null&&v(e,["avgLogprobs"],c);const d=y(t,["groundingMetadata"]);d!=null&&v(e,["groundingMetadata"],d);const f=y(t,["index"]);f!=null&&v(e,["index"],f);const h=y(t,["logprobsResult"]);h!=null&&v(e,["logprobsResult"],h);const m=y(t,["safetyRatings"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(N=>N)),v(e,["safetyRatings"],g)}const x=y(t,["urlContextMetadata"]);return x!=null&&v(e,["urlContextMetadata"],x),e}function Q3(t){const e={},n=y(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),v(e,["citations"],r)}return e}function FC(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>j4(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function Z3(t,e){const n={},r=y(t,["displayName"]);if(e!==void 0&&r!=null&&v(e,["batch","displayName"],r),y(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function e4(t,e){const n={},r=y(t,["displayName"]);e!==void 0&&r!=null&&v(e,["displayName"],r);const i=y(t,["dest"]);return e!==void 0&&i!=null&&v(e,["outputConfig"],V3(B3(i))),n}function u_(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["_url","model"],Mt(t,r));const i=y(e,["src"]);i!=null&&v(n,["batch","inputConfig"],W3(t,PC(t,i)));const l=y(e,["config"]);return l!=null&&Z3(l,n),n}function t4(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],Mt(t,r));const i=y(e,["src"]);i!=null&&v(n,["inputConfig"],$3(PC(t,i)));const l=y(e,["config"]);return l!=null&&e4(l,n),n}function n4(t,e){const n={},r=y(t,["displayName"]);return e!==void 0&&r!=null&&v(e,["batch","displayName"],r),n}function s4(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["_url","model"],Mt(t,r));const i=y(e,["src"]);i!=null&&v(n,["batch","inputConfig"],d4(t,i));const l=y(e,["config"]);return l!=null&&n4(l,n),n}function r4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function i4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function a4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);return l!=null&&v(e,["error"],l),e}function o4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);return l!=null&&v(e,["error"],l),e}function l4(t,e){const n={},r=y(e,["contents"]);if(r!=null){let l=Ty(t,r);Array.isArray(l)&&(l=l.map(c=>c)),v(n,["requests[]","request","content"],l)}const i=y(e,["config"]);return i!=null&&(v(n,["_self"],c4(i,n)),s3(n,{"requests[].*":"requests[].request.*"})),n}function c4(t,e){const n={},r=y(t,["taskType"]);e!==void 0&&r!=null&&v(e,["requests[]","taskType"],r);const i=y(t,["title"]);e!==void 0&&i!=null&&v(e,["requests[]","title"],i);const l=y(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&v(e,["requests[]","outputDimensionality"],l),y(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(y(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function d4(t,e){const n={},r=y(e,["fileName"]);r!=null&&v(n,["file_name"],r);const i=y(e,["inlinedRequests"]);return i!=null&&v(n,["requests"],l4(t,i)),n}function u4(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function h4(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function f4(t){const e={},n=y(t,["allowedFunctionNames"]);n!=null&&v(e,["allowedFunctionNames"],n);const r=y(t,["mode"]);if(r!=null&&v(e,["mode"],r),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function m4(t,e,n){const r={},i=y(e,["systemInstruction"]);n!==void 0&&i!=null&&v(n,["systemInstruction"],FC(Pn(i)));const l=y(e,["temperature"]);l!=null&&v(r,["temperature"],l);const c=y(e,["topP"]);c!=null&&v(r,["topP"],c);const d=y(e,["topK"]);d!=null&&v(r,["topK"],d);const f=y(e,["candidateCount"]);f!=null&&v(r,["candidateCount"],f);const h=y(e,["maxOutputTokens"]);h!=null&&v(r,["maxOutputTokens"],h);const m=y(e,["stopSequences"]);m!=null&&v(r,["stopSequences"],m);const x=y(e,["responseLogprobs"]);x!=null&&v(r,["responseLogprobs"],x);const g=y(e,["logprobs"]);g!=null&&v(r,["logprobs"],g);const N=y(e,["presencePenalty"]);N!=null&&v(r,["presencePenalty"],N);const T=y(e,["frequencyPenalty"]);T!=null&&v(r,["frequencyPenalty"],T);const C=y(e,["seed"]);C!=null&&v(r,["seed"],C);const w=y(e,["responseMimeType"]);w!=null&&v(r,["responseMimeType"],w);const E=y(e,["responseSchema"]);E!=null&&v(r,["responseSchema"],Cy(E));const D=y(e,["responseJsonSchema"]);if(D!=null&&v(r,["responseJsonSchema"],D),y(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(y(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const I=y(e,["safetySettings"]);if(n!==void 0&&I!=null){let z=I;Array.isArray(z)&&(z=z.map(J=>A4(J))),v(n,["safetySettings"],z)}const k=y(e,["tools"]);if(n!==void 0&&k!=null){let z=Wo(k);Array.isArray(z)&&(z=z.map(J=>D4(qo(J)))),v(n,["tools"],z)}const M=y(e,["toolConfig"]);if(n!==void 0&&M!=null&&v(n,["toolConfig"],k4(M)),y(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const j=y(e,["cachedContent"]);n!==void 0&&j!=null&&v(n,["cachedContent"],ti(t,j));const O=y(e,["responseModalities"]);O!=null&&v(r,["responseModalities"],O);const A=y(e,["mediaResolution"]);A!=null&&v(r,["mediaResolution"],A);const F=y(e,["speechConfig"]);if(F!=null&&v(r,["speechConfig"],Ey(F)),y(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const P=y(e,["thinkingConfig"]);P!=null&&v(r,["thinkingConfig"],P);const U=y(e,["imageConfig"]);U!=null&&v(r,["imageConfig"],b4(U));const q=y(e,["enableEnhancedCivicAnswers"]);if(q!=null&&v(r,["enableEnhancedCivicAnswers"],q),y(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function p4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(h=>X3(h))),v(e,["candidates"],f)}const i=y(t,["modelVersion"]);i!=null&&v(e,["modelVersion"],i);const l=y(t,["promptFeedback"]);l!=null&&v(e,["promptFeedback"],l);const c=y(t,["responseId"]);c!=null&&v(e,["responseId"],c);const d=y(t,["usageMetadata"]);return d!=null&&v(e,["usageMetadata"],d),e}function g4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function y4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],$o(t,r)),n}function x4(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function v4(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function b4(t){const e={},n=y(t,["aspectRatio"]);n!=null&&v(e,["aspectRatio"],n);const r=y(t,["imageSize"]);if(r!=null&&v(e,["imageSize"],r),y(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(y(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(y(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function N4(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["request","model"],Mt(t,r));const i=y(e,["contents"]);if(i!=null){let d=Ns(i);Array.isArray(d)&&(d=d.map(f=>FC(f))),v(n,["request","contents"],d)}const l=y(e,["metadata"]);l!=null&&v(n,["metadata"],l);const c=y(e,["config"]);return c!=null&&v(n,["request","generationConfig"],m4(t,c,y(n,["request"],{}))),n}function S4(t){const e={},n=y(t,["response"]);n!=null&&v(e,["response"],p4(n));const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["error"]);return i!=null&&v(e,["error"],i),e}function _4(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);if(e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),y(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function w4(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);e!==void 0&&i!=null&&v(e,["_query","pageToken"],i);const l=y(t,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function T4(t){const e={},n=y(t,["config"]);return n!=null&&_4(n,e),e}function C4(t){const e={},n=y(t,["config"]);return n!=null&&w4(n,e),e}function E4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["operations"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Eu(c))),v(e,["batchJobs"],l)}return e}function I4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["batchPredictionJobs"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>ig(c))),v(e,["batchJobs"],l)}return e}function j4(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],u4(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],h4(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],K3(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function A4(t){const e={},n=y(t,["category"]);if(n!=null&&v(e,["category"],n),y(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=y(t,["threshold"]);return r!=null&&v(e,["threshold"],r),e}function k4(t){const e={},n=y(t,["retrievalConfig"]);n!=null&&v(e,["retrievalConfig"],n);const r=y(t,["functionCallingConfig"]);return r!=null&&v(e,["functionCallingConfig"],f4(r)),e}function D4(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],x4(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],v4(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Yr;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Yr||(Yr={}));class ka{constructor(e,n,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,i)}init(e,n,r){var i,l;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!r||Object.keys(r).length===0?c={config:{}}:typeof r=="object"?c=Object.assign({},r):c=r,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(l=(i=c.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class R4 extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ka(Yr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=u_(this.apiClient,e),r=n._url,i=We("{model}:batchGenerateContent",r),d=n.batch.inputConfig.requests,f=d.requests,h=[];for(const m of f){const x=Object.assign({},m);if(x.systemInstruction){const g=x.systemInstruction;delete x.systemInstruction;const N=x.request;N.systemInstruction=g,x.request=N}h.push(x)}return d.requests=h,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){const l=this.getGcsUri(e),c=this.getBigqueryUri(e);if(l)l.endsWith(".jsonl")?r.dest=`${l.slice(0,-6)}/dest`:r.dest=`${l}_dest_${i}`;else if(c)r.dest=`${c}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=t4(this.apiClient,e);return d=We("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>ig(m))}else{const h=u_(this.apiClient,e);return d=We("{model}:batchGenerateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Eu(m))}}async createEmbeddingsInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=s4(this.apiClient,e);return l=We("{model}:asyncBatchEmbedContent",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>Eu(f))}}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=y4(this.apiClient,e);return d=We("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>ig(m))}else{const h=g4(this.apiClient,e);return d=We("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Eu(m))}}async cancel(e){var n,r,i,l;let c="",d={};if(this.apiClient.isVertexAI()){const f=J3(this.apiClient,e);c=We("batchPredictionJobs/{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const f=Y3(this.apiClient,e);c=We("batches/{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=C4(e);return d=We("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=I4(m),g=new o_;return Object.assign(g,x),g})}else{const h=T4(e);return d=We("batches",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=E4(m),g=new o_;return Object.assign(g,x),g})}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=i4(this.apiClient,e);return d=We("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>o4(m))}else{const h=r4(this.apiClient,e);return d=We("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>a4(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function M4(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function h_(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>sF(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function P4(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);e!==void 0&&i!=null&&v(e,["expireTime"],i);const l=y(t,["displayName"]);e!==void 0&&l!=null&&v(e,["displayName"],l);const c=y(t,["contents"]);if(e!==void 0&&c!=null){let m=Ns(c);Array.isArray(m)&&(m=m.map(x=>h_(x))),v(e,["contents"],m)}const d=y(t,["systemInstruction"]);e!==void 0&&d!=null&&v(e,["systemInstruction"],h_(Pn(d)));const f=y(t,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(x=>iF(x))),v(e,["tools"],m)}const h=y(t,["toolConfig"]);if(e!==void 0&&h!=null&&v(e,["toolConfig"],rF(h)),y(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function O4(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);e!==void 0&&i!=null&&v(e,["expireTime"],i);const l=y(t,["displayName"]);e!==void 0&&l!=null&&v(e,["displayName"],l);const c=y(t,["contents"]);if(e!==void 0&&c!=null){let x=Ns(c);Array.isArray(x)&&(x=x.map(g=>g)),v(e,["contents"],x)}const d=y(t,["systemInstruction"]);e!==void 0&&d!=null&&v(e,["systemInstruction"],Pn(d));const f=y(t,["tools"]);if(e!==void 0&&f!=null){let x=f;Array.isArray(x)&&(x=x.map(g=>aF(g))),v(e,["tools"],x)}const h=y(t,["toolConfig"]);e!==void 0&&h!=null&&v(e,["toolConfig"],h);const m=y(t,["kmsKeyName"]);return e!==void 0&&m!=null&&v(e,["encryption_spec","kmsKeyName"],m),n}function L4(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],CC(t,r));const i=y(e,["config"]);return i!=null&&P4(i,n),n}function F4(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],CC(t,r));const i=y(e,["config"]);return i!=null&&O4(i,n),n}function U4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function B4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function G4(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function z4(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function H4(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function V4(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function q4(t){const e={},n=y(t,["allowedFunctionNames"]);n!=null&&v(e,["allowedFunctionNames"],n);const r=y(t,["mode"]);if(r!=null&&v(e,["mode"],r),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function W4(t){const e={},n=y(t,["description"]);n!=null&&v(e,["description"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["parameters"]);i!=null&&v(e,["parameters"],i);const l=y(t,["parametersJsonSchema"]);l!=null&&v(e,["parametersJsonSchema"],l);const c=y(t,["response"]);c!=null&&v(e,["response"],c);const d=y(t,["responseJsonSchema"]);if(d!=null&&v(e,["responseJsonSchema"],d),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function $4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function K4(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function Y4(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function J4(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function X4(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function Q4(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function Z4(t){const e={},n=y(t,["config"]);return n!=null&&X4(n,e),e}function eF(t){const e={},n=y(t,["config"]);return n!=null&&Q4(n,e),e}function tF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["cachedContents"],l)}return e}function nF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["cachedContents"],l)}return e}function sF(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],H4(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],V4(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],M4(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function rF(t){const e={},n=y(t,["retrievalConfig"]);n!=null&&v(e,["retrievalConfig"],n);const r=y(t,["functionCallingConfig"]);return r!=null&&v(e,["functionCallingConfig"],q4(r)),e}function iF(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],Y4(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],J4(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function aF(t){const e={},n=y(t,["retrieval"]);n!=null&&v(e,["retrieval"],n);const r=y(t,["computerUse"]);if(r!=null&&v(e,["computerUse"],r),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=y(t,["codeExecution"]);i!=null&&v(e,["codeExecution"],i);const l=y(t,["enterpriseWebSearch"]);l!=null&&v(e,["enterpriseWebSearch"],l);const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>W4(g))),v(e,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=y(t,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=y(t,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(e,["urlContext"],m),e}function oF(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);return e!==void 0&&i!=null&&v(e,["expireTime"],i),n}function lF(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);return e!==void 0&&i!=null&&v(e,["expireTime"],i),n}function cF(t,e){const n={},r=y(e,["name"]);r!=null&&v(n,["_url","name"],ti(t,r));const i=y(e,["config"]);return i!=null&&oF(i,n),n}function dF(t,e){const n={},r=y(e,["name"]);r!=null&&v(n,["_url","name"],ti(t,r));const i=y(e,["config"]);return i!=null&&lF(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uF extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ka(Yr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=F4(this.apiClient,e);return d=We("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=L4(this.apiClient,e);return d=We("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=K4(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=$4(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=B4(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=z4(m),g=new i_;return Object.assign(g,x),g})}else{const h=U4(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=G4(m),g=new i_;return Object.assign(g,x),g})}}async update(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=dF(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=cF(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=eF(e);return d=We("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=nF(m),g=new a_;return Object.assign(g,x),g})}else{const h=Z4(e);return d=We("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=tF(m),g=new a_;return Object.assign(g,x),g})}}}function ih(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function f_(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function lt(t){return this instanceof lt?(this.v=t,this):new lt(t)}function Ys(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(N){return function(T){return Promise.resolve(T).then(N,x)}}function d(N,T){r[N]&&(i[N]=function(C){return new Promise(function(w,E){l.push([N,C,w,E])>1||f(N,C)})},T&&(i[N]=T(i[N])))}function f(N,T){try{h(r[N](T))}catch(C){g(l[0][3],C)}}function h(N){N.value instanceof lt?Promise.resolve(N.value.v).then(m,x):g(l[0][2],N)}function m(N){f("next",N)}function x(N){f("throw",N)}function g(N,T){N(T),l.shift(),l.length&&f(l[0][0],l[0][1])}}function Js(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof f_=="function"?f_(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(l){n[l]=t[l]&&function(c){return new Promise(function(d,f){c=t[l](c),i(d,f,c.done,c.value)})}}function i(l,c,d,f){Promise.resolve(f).then(function(h){l({value:h,done:d})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hF(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:UC(n)}function UC(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function fF(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function m_(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const i=[];let l=!0;for(;r<n&&t[r].role==="model";)i.push(t[r]),l&&!UC(t[r])&&(l=!1),r++;l?e.push(...i):e.pop()}return e}class mF{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new pF(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class pF{constructor(e,n,r,i={},l=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),fF(l)}async sendMessage(e){var n;await this.sendPromise;const r=Pn(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var l,c,d;const f=await i,h=(c=(l=f.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content,m=f.automaticFunctionCallingHistory,x=this.getHistory(!0).length;let g=[];m!=null&&(g=(d=m.slice(x))!==null&&d!==void 0?d:[]);const N=h?[h]:[];this.recordHistory(r,N,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const r=Pn(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const l=await i;return this.processStreamResponse(l,r)}getHistory(e=!1){const n=e?m_(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return Ys(this,arguments,function*(){var i,l,c,d,f,h;const m=[];try{for(var x=!0,g=Js(e),N;N=yield lt(g.next()),i=N.done,!i;x=!0){d=N.value,x=!1;const T=d;if(hF(T)){const C=(h=(f=T.candidates)===null||f===void 0?void 0:f[0])===null||h===void 0?void 0:h.content;C!==void 0&&m.push(C)}yield yield lt(T)}}catch(T){l={error:T}}finally{try{!x&&!i&&(c=g.return)&&(yield lt(c.call(g)))}finally{if(l)throw l.error}}this.recordHistory(n,m)})}recordHistory(e,n,r){let i=[];n.length>0&&n.every(l=>l.role!==void 0)?i=n:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...m_(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ec extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ec.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gF(t){const e={},n=y(t,["file"]);return n!=null&&v(e,["file"],n),e}function yF(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function xF(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","file"],DC(n)),e}function vF(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function bF(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","file"],DC(n)),e}function NF(t){const e={},n=y(t,["uris"]);return n!=null&&v(e,["uris"],n),e}function SF(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function _F(t){const e={},n=y(t,["config"]);return n!=null&&SF(n,e),e}function wF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["files"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["files"],l)}return e}function TF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["files"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CF extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ka(Yr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=_F(e);return l=We("files",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=wF(f),m=new C3;return Object.assign(m,h),m})}}async createInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=gF(e);return l=We("upload/v1beta/files",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=yF(f),m=new E3;return Object.assign(m,h),m})}}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=bF(e);return l=We("files/{file}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=xF(e);return l=We("files/{file}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=vF(f),m=new I3;return Object.assign(m,h),m})}}async registerFilesInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=NF(e);return l=We("files:register",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=TF(f),m=new j3;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Iu(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function EF(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>HF(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function IF(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function jF(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function AF(t){const e={},n=y(t,["description"]);n!=null&&v(e,["description"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["parameters"]);i!=null&&v(e,["parameters"],i);const l=y(t,["parametersJsonSchema"]);l!=null&&v(e,["parametersJsonSchema"],l);const c=y(t,["response"]);c!=null&&v(e,["response"],c);const d=y(t,["responseJsonSchema"]);if(d!=null&&v(e,["responseJsonSchema"],d),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function kF(t){const e={},n=y(t,["modelSelectionConfig"]);n!=null&&v(e,["modelConfig"],n);const r=y(t,["responseJsonSchema"]);r!=null&&v(e,["responseJsonSchema"],r);const i=y(t,["audioTimestamp"]);i!=null&&v(e,["audioTimestamp"],i);const l=y(t,["candidateCount"]);l!=null&&v(e,["candidateCount"],l);const c=y(t,["enableAffectiveDialog"]);c!=null&&v(e,["enableAffectiveDialog"],c);const d=y(t,["frequencyPenalty"]);d!=null&&v(e,["frequencyPenalty"],d);const f=y(t,["logprobs"]);f!=null&&v(e,["logprobs"],f);const h=y(t,["maxOutputTokens"]);h!=null&&v(e,["maxOutputTokens"],h);const m=y(t,["mediaResolution"]);m!=null&&v(e,["mediaResolution"],m);const x=y(t,["presencePenalty"]);x!=null&&v(e,["presencePenalty"],x);const g=y(t,["responseLogprobs"]);g!=null&&v(e,["responseLogprobs"],g);const N=y(t,["responseMimeType"]);N!=null&&v(e,["responseMimeType"],N);const T=y(t,["responseModalities"]);T!=null&&v(e,["responseModalities"],T);const C=y(t,["responseSchema"]);C!=null&&v(e,["responseSchema"],C);const w=y(t,["routingConfig"]);w!=null&&v(e,["routingConfig"],w);const E=y(t,["seed"]);E!=null&&v(e,["seed"],E);const D=y(t,["speechConfig"]);D!=null&&v(e,["speechConfig"],D);const I=y(t,["stopSequences"]);I!=null&&v(e,["stopSequences"],I);const k=y(t,["temperature"]);k!=null&&v(e,["temperature"],k);const M=y(t,["thinkingConfig"]);M!=null&&v(e,["thinkingConfig"],M);const j=y(t,["topK"]);j!=null&&v(e,["topK"],j);const O=y(t,["topP"]);if(O!=null&&v(e,["topP"],O),y(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function DF(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function RF(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function MF(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],r);const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],Iy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const T=y(t,["systemInstruction"]);e!==void 0&&T!=null&&v(e,["setup","systemInstruction"],EF(Pn(T)));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let j=Wo(C);Array.isArray(j)&&(j=j.map(O=>qF(qo(O)))),v(e,["setup","tools"],j)}const w=y(t,["sessionResumption"]);e!==void 0&&w!=null&&v(e,["setup","sessionResumption"],VF(w));const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const D=y(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&v(e,["setup","outputAudioTranscription"],D);const I=y(t,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);if(e!==void 0&&M!=null&&v(e,["setup","proactivity"],M),y(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function PF(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],kF(r));const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],Iy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const T=y(t,["systemInstruction"]);e!==void 0&&T!=null&&v(e,["setup","systemInstruction"],Pn(T));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let O=Wo(C);Array.isArray(O)&&(O=O.map(A=>WF(qo(A)))),v(e,["setup","tools"],O)}const w=y(t,["sessionResumption"]);e!==void 0&&w!=null&&v(e,["setup","sessionResumption"],w);const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const D=y(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&v(e,["setup","outputAudioTranscription"],D);const I=y(t,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);e!==void 0&&M!=null&&v(e,["setup","proactivity"],M);const j=y(t,["explicitVadSignal"]);return e!==void 0&&j!=null&&v(e,["setup","explicitVadSignal"],j),n}function OF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Mt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],MF(i,n)),n}function LF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Mt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],PF(i,n)),n}function FF(t){const e={},n=y(t,["musicGenerationConfig"]);return n!=null&&v(e,["musicGenerationConfig"],n),e}function UF(t){const e={},n=y(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),v(e,["weightedPrompts"],r)}return e}function BF(t){const e={},n=y(t,["media"]);if(n!=null){let h=EC(n);Array.isArray(h)&&(h=h.map(m=>Iu(m))),v(e,["mediaChunks"],h)}const r=y(t,["audio"]);r!=null&&v(e,["audio"],Iu(jC(r)));const i=y(t,["audioStreamEnd"]);i!=null&&v(e,["audioStreamEnd"],i);const l=y(t,["video"]);l!=null&&v(e,["video"],Iu(IC(l)));const c=y(t,["text"]);c!=null&&v(e,["text"],c);const d=y(t,["activityStart"]);d!=null&&v(e,["activityStart"],d);const f=y(t,["activityEnd"]);return f!=null&&v(e,["activityEnd"],f),e}function GF(t){const e={},n=y(t,["media"]);if(n!=null){let h=EC(n);Array.isArray(h)&&(h=h.map(m=>m)),v(e,["mediaChunks"],h)}const r=y(t,["audio"]);r!=null&&v(e,["audio"],jC(r));const i=y(t,["audioStreamEnd"]);i!=null&&v(e,["audioStreamEnd"],i);const l=y(t,["video"]);l!=null&&v(e,["video"],IC(l));const c=y(t,["text"]);c!=null&&v(e,["text"],c);const d=y(t,["activityStart"]);d!=null&&v(e,["activityStart"],d);const f=y(t,["activityEnd"]);return f!=null&&v(e,["activityEnd"],f),e}function zF(t){const e={},n=y(t,["setupComplete"]);n!=null&&v(e,["setupComplete"],n);const r=y(t,["serverContent"]);r!=null&&v(e,["serverContent"],r);const i=y(t,["toolCall"]);i!=null&&v(e,["toolCall"],i);const l=y(t,["toolCallCancellation"]);l!=null&&v(e,["toolCallCancellation"],l);const c=y(t,["usageMetadata"]);c!=null&&v(e,["usageMetadata"],$F(c));const d=y(t,["goAway"]);d!=null&&v(e,["goAway"],d);const f=y(t,["sessionResumptionUpdate"]);f!=null&&v(e,["sessionResumptionUpdate"],f);const h=y(t,["voiceActivityDetectionSignal"]);h!=null&&v(e,["voiceActivityDetectionSignal"],h);const m=y(t,["voiceActivity"]);return m!=null&&v(e,["voiceActivity"],KF(m)),e}function HF(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],IF(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],jF(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],Iu(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function VF(t){const e={},n=y(t,["handle"]);if(n!=null&&v(e,["handle"],n),y(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function qF(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],DF(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],RF(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function WF(t){const e={},n=y(t,["retrieval"]);n!=null&&v(e,["retrieval"],n);const r=y(t,["computerUse"]);if(r!=null&&v(e,["computerUse"],r),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=y(t,["codeExecution"]);i!=null&&v(e,["codeExecution"],i);const l=y(t,["enterpriseWebSearch"]);l!=null&&v(e,["enterpriseWebSearch"],l);const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>AF(g))),v(e,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=y(t,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=y(t,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(e,["urlContext"],m),e}function $F(t){const e={},n=y(t,["promptTokenCount"]);n!=null&&v(e,["promptTokenCount"],n);const r=y(t,["cachedContentTokenCount"]);r!=null&&v(e,["cachedContentTokenCount"],r);const i=y(t,["candidatesTokenCount"]);i!=null&&v(e,["responseTokenCount"],i);const l=y(t,["toolUsePromptTokenCount"]);l!=null&&v(e,["toolUsePromptTokenCount"],l);const c=y(t,["thoughtsTokenCount"]);c!=null&&v(e,["thoughtsTokenCount"],c);const d=y(t,["totalTokenCount"]);d!=null&&v(e,["totalTokenCount"],d);const f=y(t,["promptTokensDetails"]);if(f!=null){let N=f;Array.isArray(N)&&(N=N.map(T=>T)),v(e,["promptTokensDetails"],N)}const h=y(t,["cacheTokensDetails"]);if(h!=null){let N=h;Array.isArray(N)&&(N=N.map(T=>T)),v(e,["cacheTokensDetails"],N)}const m=y(t,["candidatesTokensDetails"]);if(m!=null){let N=m;Array.isArray(N)&&(N=N.map(T=>T)),v(e,["responseTokensDetails"],N)}const x=y(t,["toolUsePromptTokensDetails"]);if(x!=null){let N=x;Array.isArray(N)&&(N=N.map(T=>T)),v(e,["toolUsePromptTokensDetails"],N)}const g=y(t,["trafficType"]);return g!=null&&v(e,["trafficType"],g),e}function KF(t){const e={},n=y(t,["type"]);return n!=null&&v(e,["voiceActivityType"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YF(t,e){const n={},r=y(t,["data"]);if(r!=null&&v(n,["data"],r),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function JF(t,e){const n={},r=y(t,["content"]);r!=null&&v(n,["content"],r);const i=y(t,["citationMetadata"]);i!=null&&v(n,["citationMetadata"],XF(i));const l=y(t,["tokenCount"]);l!=null&&v(n,["tokenCount"],l);const c=y(t,["finishReason"]);c!=null&&v(n,["finishReason"],c);const d=y(t,["avgLogprobs"]);d!=null&&v(n,["avgLogprobs"],d);const f=y(t,["groundingMetadata"]);f!=null&&v(n,["groundingMetadata"],f);const h=y(t,["index"]);h!=null&&v(n,["index"],h);const m=y(t,["logprobsResult"]);m!=null&&v(n,["logprobsResult"],m);const x=y(t,["safetyRatings"]);if(x!=null){let N=x;Array.isArray(N)&&(N=N.map(T=>T)),v(n,["safetyRatings"],N)}const g=y(t,["urlContextMetadata"]);return g!=null&&v(n,["urlContextMetadata"],g),n}function XF(t,e){const n={},r=y(t,["citationSources"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(n,["citations"],i)}return n}function QF(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let c=Ns(l);Array.isArray(c)&&(c=c.map(d=>d)),v(r,["contents"],c)}return r}function ZF(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["tokensInfo"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(n,["tokensInfo"],l)}return n}function e5(t,e){const n={},r=y(t,["values"]);r!=null&&v(n,["values"],r);const i=y(t,["statistics"]);return i!=null&&v(n,["statistics"],t5(i)),n}function t5(t,e){const n={},r=y(t,["truncated"]);r!=null&&v(n,["truncated"],r);const i=y(t,["token_count"]);return i!=null&&v(n,["tokenCount"],i),n}function Gc(t,e){const n={},r=y(t,["parts"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>dU(c))),v(n,["parts"],l)}const i=y(t,["role"]);return i!=null&&v(n,["role"],i),n}function n5(t,e){const n={},r=y(t,["controlType"]);r!=null&&v(n,["controlType"],r);const i=y(t,["enableControlImageComputation"]);return i!=null&&v(n,["computeControl"],i),n}function s5(t,e){const n={};if(y(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(y(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(y(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return n}function r5(t,e,n){const r={},i=y(t,["systemInstruction"]);e!==void 0&&i!=null&&v(e,["systemInstruction"],Pn(i));const l=y(t,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(f=>HC(f))),v(e,["tools"],d)}const c=y(t,["generationConfig"]);return e!==void 0&&c!=null&&v(e,["generationConfig"],Y5(c)),r}function i5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Ns(l);Array.isArray(d)&&(d=d.map(f=>Gc(f))),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&s5(c),r}function a5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Ns(l);Array.isArray(d)&&(d=d.map(f=>f)),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&r5(c,r),r}function o5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["totalTokens"]);i!=null&&v(n,["totalTokens"],i);const l=y(t,["cachedContentTokenCount"]);return l!=null&&v(n,["cachedContentTokenCount"],l),n}function l5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["totalTokens"]);return i!=null&&v(n,["totalTokens"],i),n}function c5(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Mt(t,i)),r}function d5(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Mt(t,i)),r}function u5(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function h5(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function f5(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["negativePrompt"]);e!==void 0&&l!=null&&v(e,["parameters","negativePrompt"],l);const c=y(t,["numberOfImages"]);e!==void 0&&c!=null&&v(e,["parameters","sampleCount"],c);const d=y(t,["aspectRatio"]);e!==void 0&&d!=null&&v(e,["parameters","aspectRatio"],d);const f=y(t,["guidanceScale"]);e!==void 0&&f!=null&&v(e,["parameters","guidanceScale"],f);const h=y(t,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const m=y(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&v(e,["parameters","safetySetting"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&v(e,["parameters","includeSafetyAttributes"],g);const N=y(t,["includeRaiReason"]);e!==void 0&&N!=null&&v(e,["parameters","includeRaiReason"],N);const T=y(t,["language"]);e!==void 0&&T!=null&&v(e,["parameters","language"],T);const C=y(t,["outputMimeType"]);e!==void 0&&C!=null&&v(e,["parameters","outputOptions","mimeType"],C);const w=y(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&v(e,["parameters","outputOptions","compressionQuality"],w);const E=y(t,["addWatermark"]);e!==void 0&&E!=null&&v(e,["parameters","addWatermark"],E);const D=y(t,["labels"]);e!==void 0&&D!=null&&v(e,["labels"],D);const I=y(t,["editMode"]);e!==void 0&&I!=null&&v(e,["parameters","editMode"],I);const k=y(t,["baseSteps"]);return e!==void 0&&k!=null&&v(e,["parameters","editConfig","baseSteps"],k),r}function m5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["referenceImages"]);if(c!=null){let f=c;Array.isArray(f)&&(f=f.map(h=>gU(h))),v(r,["instances[0]","referenceImages"],f)}const d=y(e,["config"]);return d!=null&&f5(d,r),r}function p5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Eh(c))),v(n,["generatedImages"],l)}return n}function g5(t,e,n){const r={},i=y(t,["taskType"]);e!==void 0&&i!=null&&v(e,["requests[]","taskType"],i);const l=y(t,["title"]);e!==void 0&&l!=null&&v(e,["requests[]","title"],l);const c=y(t,["outputDimensionality"]);if(e!==void 0&&c!=null&&v(e,["requests[]","outputDimensionality"],c),y(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(y(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return r}function y5(t,e,n){const r={};let i=y(n,["embeddingApiType"]);if(i===void 0&&(i="PREDICT"),i==="PREDICT"){const h=y(t,["taskType"]);e!==void 0&&h!=null&&v(e,["instances[]","task_type"],h)}else if(i==="EMBED_CONTENT"){const h=y(t,["taskType"]);e!==void 0&&h!=null&&v(e,["taskType"],h)}let l=y(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const h=y(t,["title"]);e!==void 0&&h!=null&&v(e,["instances[]","title"],h)}else if(l==="EMBED_CONTENT"){const h=y(t,["title"]);e!==void 0&&h!=null&&v(e,["title"],h)}let c=y(n,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="PREDICT"){const h=y(t,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["parameters","outputDimensionality"],h)}else if(c==="EMBED_CONTENT"){const h=y(t,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["outputDimensionality"],h)}let d=y(n,["embeddingApiType"]);if(d===void 0&&(d="PREDICT"),d==="PREDICT"){const h=y(t,["mimeType"]);e!==void 0&&h!=null&&v(e,["instances[]","mimeType"],h)}let f=y(n,["embeddingApiType"]);if(f===void 0&&(f="PREDICT"),f==="PREDICT"){const h=y(t,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["parameters","autoTruncate"],h)}else if(f==="EMBED_CONTENT"){const h=y(t,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["autoTruncate"],h)}return r}function x5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let h=Ty(t,l);Array.isArray(h)&&(h=h.map(m=>m)),v(r,["requests[]","content"],h)}const c=y(e,["content"]);c!=null&&Gc(Pn(c));const d=y(e,["config"]);d!=null&&g5(d,r);const f=y(e,["model"]);return f!==void 0&&v(r,["requests[]","model"],Mt(t,f)),r}function v5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));let l=y(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const f=y(e,["contents"]);if(f!=null){let h=Ty(t,f);Array.isArray(h)&&(h=h.map(m=>m)),v(r,["instances[]","content"],h)}}let c=y(n,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="EMBED_CONTENT"){const f=y(e,["content"]);f!=null&&v(r,["content"],Pn(f))}const d=y(e,["config"]);return d!=null&&y5(d,r,n),r}function b5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>d)),v(n,["embeddings"],c)}const l=y(t,["metadata"]);return l!=null&&v(n,["metadata"],l),n}function N5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions[]","embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>e5(d))),v(n,["embeddings"],c)}const l=y(t,["metadata"]);if(l!=null&&v(n,["metadata"],l),e&&y(e,["embeddingApiType"])==="EMBED_CONTENT"){const c=y(t,["embedding"]),d=y(t,["usageMetadata"]),f=y(t,["truncated"]);if(c){const h={};d&&d.promptTokenCount&&(h.tokenCount=d.promptTokenCount),f&&(h.truncated=f),c.statistics=h,v(n,["embeddings"],[c])}}return n}function S5(t,e){const n={},r=y(t,["endpoint"]);r!=null&&v(n,["name"],r);const i=y(t,["deployedModelId"]);return i!=null&&v(n,["deployedModelId"],i),n}function _5(t,e){const n={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["fileUri"]);r!=null&&v(n,["fileUri"],r);const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function w5(t,e){const n={},r=y(t,["id"]);r!=null&&v(n,["id"],r);const i=y(t,["args"]);i!=null&&v(n,["args"],i);const l=y(t,["name"]);if(l!=null&&v(n,["name"],l),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return n}function T5(t,e){const n={},r=y(t,["allowedFunctionNames"]);r!=null&&v(n,["allowedFunctionNames"],r);const i=y(t,["mode"]);if(i!=null&&v(n,["mode"],i),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return n}function C5(t,e){const n={},r=y(t,["description"]);r!=null&&v(n,["description"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["parameters"]);l!=null&&v(n,["parameters"],l);const c=y(t,["parametersJsonSchema"]);c!=null&&v(n,["parametersJsonSchema"],c);const d=y(t,["response"]);d!=null&&v(n,["response"],d);const f=y(t,["responseJsonSchema"]);if(f!=null&&v(n,["responseJsonSchema"],f),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return n}function E5(t,e,n,r){const i={},l=y(e,["systemInstruction"]);n!==void 0&&l!=null&&v(n,["systemInstruction"],Gc(Pn(l)));const c=y(e,["temperature"]);c!=null&&v(i,["temperature"],c);const d=y(e,["topP"]);d!=null&&v(i,["topP"],d);const f=y(e,["topK"]);f!=null&&v(i,["topK"],f);const h=y(e,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=y(e,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=y(e,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const g=y(e,["responseLogprobs"]);g!=null&&v(i,["responseLogprobs"],g);const N=y(e,["logprobs"]);N!=null&&v(i,["logprobs"],N);const T=y(e,["presencePenalty"]);T!=null&&v(i,["presencePenalty"],T);const C=y(e,["frequencyPenalty"]);C!=null&&v(i,["frequencyPenalty"],C);const w=y(e,["seed"]);w!=null&&v(i,["seed"],w);const E=y(e,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const D=y(e,["responseSchema"]);D!=null&&v(i,["responseSchema"],Cy(D));const I=y(e,["responseJsonSchema"]);if(I!=null&&v(i,["responseJsonSchema"],I),y(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(y(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const k=y(e,["safetySettings"]);if(n!==void 0&&k!=null){let J=k;Array.isArray(J)&&(J=J.map(Y=>yU(Y))),v(n,["safetySettings"],J)}const M=y(e,["tools"]);if(n!==void 0&&M!=null){let J=Wo(M);Array.isArray(J)&&(J=J.map(Y=>wU(qo(Y)))),v(n,["tools"],J)}const j=y(e,["toolConfig"]);if(n!==void 0&&j!=null&&v(n,["toolConfig"],_U(j)),y(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const O=y(e,["cachedContent"]);n!==void 0&&O!=null&&v(n,["cachedContent"],ti(t,O));const A=y(e,["responseModalities"]);A!=null&&v(i,["responseModalities"],A);const F=y(e,["mediaResolution"]);F!=null&&v(i,["mediaResolution"],F);const P=y(e,["speechConfig"]);if(P!=null&&v(i,["speechConfig"],Ey(P)),y(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const U=y(e,["thinkingConfig"]);U!=null&&v(i,["thinkingConfig"],U);const q=y(e,["imageConfig"]);q!=null&&v(i,["imageConfig"],eU(q));const z=y(e,["enableEnhancedCivicAnswers"]);if(z!=null&&v(i,["enableEnhancedCivicAnswers"],z),y(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function I5(t,e,n,r){const i={},l=y(e,["systemInstruction"]);n!==void 0&&l!=null&&v(n,["systemInstruction"],Pn(l));const c=y(e,["temperature"]);c!=null&&v(i,["temperature"],c);const d=y(e,["topP"]);d!=null&&v(i,["topP"],d);const f=y(e,["topK"]);f!=null&&v(i,["topK"],f);const h=y(e,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=y(e,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=y(e,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const g=y(e,["responseLogprobs"]);g!=null&&v(i,["responseLogprobs"],g);const N=y(e,["logprobs"]);N!=null&&v(i,["logprobs"],N);const T=y(e,["presencePenalty"]);T!=null&&v(i,["presencePenalty"],T);const C=y(e,["frequencyPenalty"]);C!=null&&v(i,["frequencyPenalty"],C);const w=y(e,["seed"]);w!=null&&v(i,["seed"],w);const E=y(e,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const D=y(e,["responseSchema"]);D!=null&&v(i,["responseSchema"],Cy(D));const I=y(e,["responseJsonSchema"]);I!=null&&v(i,["responseJsonSchema"],I);const k=y(e,["routingConfig"]);k!=null&&v(i,["routingConfig"],k);const M=y(e,["modelSelectionConfig"]);M!=null&&v(i,["modelConfig"],M);const j=y(e,["safetySettings"]);if(n!==void 0&&j!=null){let Q=j;Array.isArray(Q)&&(Q=Q.map(K=>K)),v(n,["safetySettings"],Q)}const O=y(e,["tools"]);if(n!==void 0&&O!=null){let Q=Wo(O);Array.isArray(Q)&&(Q=Q.map(K=>HC(qo(K)))),v(n,["tools"],Q)}const A=y(e,["toolConfig"]);n!==void 0&&A!=null&&v(n,["toolConfig"],A);const F=y(e,["labels"]);n!==void 0&&F!=null&&v(n,["labels"],F);const P=y(e,["cachedContent"]);n!==void 0&&P!=null&&v(n,["cachedContent"],ti(t,P));const U=y(e,["responseModalities"]);U!=null&&v(i,["responseModalities"],U);const q=y(e,["mediaResolution"]);q!=null&&v(i,["mediaResolution"],q);const z=y(e,["speechConfig"]);z!=null&&v(i,["speechConfig"],Ey(z));const J=y(e,["audioTimestamp"]);J!=null&&v(i,["audioTimestamp"],J);const Y=y(e,["thinkingConfig"]);Y!=null&&v(i,["thinkingConfig"],Y);const G=y(e,["imageConfig"]);if(G!=null&&v(i,["imageConfig"],tU(G)),y(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const B=y(e,["modelArmorConfig"]);return n!==void 0&&B!=null&&v(n,["modelArmorConfig"],B),i}function p_(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Ns(l);Array.isArray(d)&&(d=d.map(f=>Gc(f))),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&v(r,["generationConfig"],E5(t,c,r)),r}function g_(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Ns(l);Array.isArray(d)&&(d=d.map(f=>f)),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&v(r,["generationConfig"],I5(t,c,r)),r}function y_(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["candidates"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(m=>JF(m))),v(n,["candidates"],h)}const l=y(t,["modelVersion"]);l!=null&&v(n,["modelVersion"],l);const c=y(t,["promptFeedback"]);c!=null&&v(n,["promptFeedback"],c);const d=y(t,["responseId"]);d!=null&&v(n,["responseId"],d);const f=y(t,["usageMetadata"]);return f!=null&&v(n,["usageMetadata"],f),n}function x_(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["candidates"]);if(i!=null){let m=i;Array.isArray(m)&&(m=m.map(x=>x)),v(n,["candidates"],m)}const l=y(t,["createTime"]);l!=null&&v(n,["createTime"],l);const c=y(t,["modelVersion"]);c!=null&&v(n,["modelVersion"],c);const d=y(t,["promptFeedback"]);d!=null&&v(n,["promptFeedback"],d);const f=y(t,["responseId"]);f!=null&&v(n,["responseId"],f);const h=y(t,["usageMetadata"]);return h!=null&&v(n,["usageMetadata"],h),n}function j5(t,e,n){const r={};if(y(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(y(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=y(t,["numberOfImages"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["aspectRatio"]);e!==void 0&&l!=null&&v(e,["parameters","aspectRatio"],l);const c=y(t,["guidanceScale"]);if(e!==void 0&&c!=null&&v(e,["parameters","guidanceScale"],c),y(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const d=y(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&v(e,["parameters","safetySetting"],d);const f=y(t,["personGeneration"]);e!==void 0&&f!=null&&v(e,["parameters","personGeneration"],f);const h=y(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&v(e,["parameters","includeSafetyAttributes"],h);const m=y(t,["includeRaiReason"]);e!==void 0&&m!=null&&v(e,["parameters","includeRaiReason"],m);const x=y(t,["language"]);e!==void 0&&x!=null&&v(e,["parameters","language"],x);const g=y(t,["outputMimeType"]);e!==void 0&&g!=null&&v(e,["parameters","outputOptions","mimeType"],g);const N=y(t,["outputCompressionQuality"]);if(e!==void 0&&N!=null&&v(e,["parameters","outputOptions","compressionQuality"],N),y(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(y(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=y(t,["imageSize"]);if(e!==void 0&&T!=null&&v(e,["parameters","sampleImageSize"],T),y(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return r}function A5(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["negativePrompt"]);e!==void 0&&l!=null&&v(e,["parameters","negativePrompt"],l);const c=y(t,["numberOfImages"]);e!==void 0&&c!=null&&v(e,["parameters","sampleCount"],c);const d=y(t,["aspectRatio"]);e!==void 0&&d!=null&&v(e,["parameters","aspectRatio"],d);const f=y(t,["guidanceScale"]);e!==void 0&&f!=null&&v(e,["parameters","guidanceScale"],f);const h=y(t,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const m=y(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&v(e,["parameters","safetySetting"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&v(e,["parameters","includeSafetyAttributes"],g);const N=y(t,["includeRaiReason"]);e!==void 0&&N!=null&&v(e,["parameters","includeRaiReason"],N);const T=y(t,["language"]);e!==void 0&&T!=null&&v(e,["parameters","language"],T);const C=y(t,["outputMimeType"]);e!==void 0&&C!=null&&v(e,["parameters","outputOptions","mimeType"],C);const w=y(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&v(e,["parameters","outputOptions","compressionQuality"],w);const E=y(t,["addWatermark"]);e!==void 0&&E!=null&&v(e,["parameters","addWatermark"],E);const D=y(t,["labels"]);e!==void 0&&D!=null&&v(e,["labels"],D);const I=y(t,["imageSize"]);e!==void 0&&I!=null&&v(e,["parameters","sampleImageSize"],I);const k=y(t,["enhancePrompt"]);return e!==void 0&&k!=null&&v(e,["parameters","enhancePrompt"],k),r}function k5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["config"]);return c!=null&&j5(c,r),r}function D5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["config"]);return c!=null&&A5(c,r),r}function R5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>q5(d))),v(n,["generatedImages"],c)}const l=y(t,["positivePromptSafetyAttributes"]);return l!=null&&v(n,["positivePromptSafetyAttributes"],GC(l)),n}function M5(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>Eh(d))),v(n,["generatedImages"],c)}const l=y(t,["positivePromptSafetyAttributes"]);return l!=null&&v(n,["positivePromptSafetyAttributes"],zC(l)),n}function P5(t,e,n){const r={},i=y(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i),y(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(y(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=y(t,["durationSeconds"]);if(e!==void 0&&l!=null&&v(e,["parameters","durationSeconds"],l),y(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=y(t,["aspectRatio"]);e!==void 0&&c!=null&&v(e,["parameters","aspectRatio"],c);const d=y(t,["resolution"]);e!==void 0&&d!=null&&v(e,["parameters","resolution"],d);const f=y(t,["personGeneration"]);if(e!==void 0&&f!=null&&v(e,["parameters","personGeneration"],f),y(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=y(t,["negativePrompt"]);e!==void 0&&h!=null&&v(e,["parameters","negativePrompt"],h);const m=y(t,["enhancePrompt"]);if(e!==void 0&&m!=null&&v(e,["parameters","enhancePrompt"],m),y(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=y(t,["lastFrame"]);e!==void 0&&x!=null&&v(e,["instances[0]","lastFrame"],Ih(x));const g=y(t,["referenceImages"]);if(e!==void 0&&g!=null){let N=g;Array.isArray(N)&&(N=N.map(T=>LU(T))),v(e,["instances[0]","referenceImages"],N)}if(y(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(y(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return r}function O5(t,e,n){const r={},i=y(t,["numberOfVideos"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["outputGcsUri"]);e!==void 0&&l!=null&&v(e,["parameters","storageUri"],l);const c=y(t,["fps"]);e!==void 0&&c!=null&&v(e,["parameters","fps"],c);const d=y(t,["durationSeconds"]);e!==void 0&&d!=null&&v(e,["parameters","durationSeconds"],d);const f=y(t,["seed"]);e!==void 0&&f!=null&&v(e,["parameters","seed"],f);const h=y(t,["aspectRatio"]);e!==void 0&&h!=null&&v(e,["parameters","aspectRatio"],h);const m=y(t,["resolution"]);e!==void 0&&m!=null&&v(e,["parameters","resolution"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["pubsubTopic"]);e!==void 0&&g!=null&&v(e,["parameters","pubsubTopic"],g);const N=y(t,["negativePrompt"]);e!==void 0&&N!=null&&v(e,["parameters","negativePrompt"],N);const T=y(t,["enhancePrompt"]);e!==void 0&&T!=null&&v(e,["parameters","enhancePrompt"],T);const C=y(t,["generateAudio"]);e!==void 0&&C!=null&&v(e,["parameters","generateAudio"],C);const w=y(t,["lastFrame"]);e!==void 0&&w!=null&&v(e,["instances[0]","lastFrame"],er(w));const E=y(t,["referenceImages"]);if(e!==void 0&&E!=null){let k=E;Array.isArray(k)&&(k=k.map(M=>FU(M))),v(e,["instances[0]","referenceImages"],k)}const D=y(t,["mask"]);e!==void 0&&D!=null&&v(e,["instances[0]","mask"],OU(D));const I=y(t,["compressionQuality"]);return e!==void 0&&I!=null&&v(e,["parameters","compressionQuality"],I),r}function L5(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["metadata"]);i!=null&&v(n,["metadata"],i);const l=y(t,["done"]);l!=null&&v(n,["done"],l);const c=y(t,["error"]);c!=null&&v(n,["error"],c);const d=y(t,["response","generateVideoResponse"]);return d!=null&&v(n,["response"],G5(d)),n}function F5(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["metadata"]);i!=null&&v(n,["metadata"],i);const l=y(t,["done"]);l!=null&&v(n,["done"],l);const c=y(t,["error"]);c!=null&&v(n,["error"],c);const d=y(t,["response"]);return d!=null&&v(n,["response"],z5(d)),n}function U5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["image"]);c!=null&&v(r,["instances[0]","image"],Ih(c));const d=y(e,["video"]);d!=null&&v(r,["instances[0]","video"],VC(d));const f=y(e,["source"]);f!=null&&H5(f,r);const h=y(e,["config"]);return h!=null&&P5(h,r),r}function B5(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["image"]);c!=null&&v(r,["instances[0]","image"],er(c));const d=y(e,["video"]);d!=null&&v(r,["instances[0]","video"],qC(d));const f=y(e,["source"]);f!=null&&V5(f,r);const h=y(e,["config"]);return h!=null&&O5(h,r),r}function G5(t,e){const n={},r=y(t,["generatedSamples"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>$5(d))),v(n,["generatedVideos"],c)}const i=y(t,["raiMediaFilteredCount"]);i!=null&&v(n,["raiMediaFilteredCount"],i);const l=y(t,["raiMediaFilteredReasons"]);return l!=null&&v(n,["raiMediaFilteredReasons"],l),n}function z5(t,e){const n={},r=y(t,["videos"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>K5(d))),v(n,["generatedVideos"],c)}const i=y(t,["raiMediaFilteredCount"]);i!=null&&v(n,["raiMediaFilteredCount"],i);const l=y(t,["raiMediaFilteredReasons"]);return l!=null&&v(n,["raiMediaFilteredReasons"],l),n}function H5(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],Ih(l));const c=y(t,["video"]);return e!==void 0&&c!=null&&v(e,["instances[0]","video"],VC(c)),r}function V5(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],er(l));const c=y(t,["video"]);return e!==void 0&&c!=null&&v(e,["instances[0]","video"],qC(c)),r}function q5(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["image"],nU(r));const i=y(t,["raiFilteredReason"]);i!=null&&v(n,["raiFilteredReason"],i);const l=y(t,["_self"]);return l!=null&&v(n,["safetyAttributes"],GC(l)),n}function Eh(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["image"],BC(r));const i=y(t,["raiFilteredReason"]);i!=null&&v(n,["raiFilteredReason"],i);const l=y(t,["_self"]);l!=null&&v(n,["safetyAttributes"],zC(l));const c=y(t,["prompt"]);return c!=null&&v(n,["enhancedPrompt"],c),n}function W5(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["mask"],BC(r));const i=y(t,["labels"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(n,["labels"],l)}return n}function $5(t,e){const n={},r=y(t,["video"]);return r!=null&&v(n,["video"],MU(r)),n}function K5(t,e){const n={},r=y(t,["_self"]);return r!=null&&v(n,["video"],PU(r)),n}function Y5(t,e){const n={},r=y(t,["modelSelectionConfig"]);r!=null&&v(n,["modelConfig"],r);const i=y(t,["responseJsonSchema"]);i!=null&&v(n,["responseJsonSchema"],i);const l=y(t,["audioTimestamp"]);l!=null&&v(n,["audioTimestamp"],l);const c=y(t,["candidateCount"]);c!=null&&v(n,["candidateCount"],c);const d=y(t,["enableAffectiveDialog"]);d!=null&&v(n,["enableAffectiveDialog"],d);const f=y(t,["frequencyPenalty"]);f!=null&&v(n,["frequencyPenalty"],f);const h=y(t,["logprobs"]);h!=null&&v(n,["logprobs"],h);const m=y(t,["maxOutputTokens"]);m!=null&&v(n,["maxOutputTokens"],m);const x=y(t,["mediaResolution"]);x!=null&&v(n,["mediaResolution"],x);const g=y(t,["presencePenalty"]);g!=null&&v(n,["presencePenalty"],g);const N=y(t,["responseLogprobs"]);N!=null&&v(n,["responseLogprobs"],N);const T=y(t,["responseMimeType"]);T!=null&&v(n,["responseMimeType"],T);const C=y(t,["responseModalities"]);C!=null&&v(n,["responseModalities"],C);const w=y(t,["responseSchema"]);w!=null&&v(n,["responseSchema"],w);const E=y(t,["routingConfig"]);E!=null&&v(n,["routingConfig"],E);const D=y(t,["seed"]);D!=null&&v(n,["seed"],D);const I=y(t,["speechConfig"]);I!=null&&v(n,["speechConfig"],I);const k=y(t,["stopSequences"]);k!=null&&v(n,["stopSequences"],k);const M=y(t,["temperature"]);M!=null&&v(n,["temperature"],M);const j=y(t,["thinkingConfig"]);j!=null&&v(n,["thinkingConfig"],j);const O=y(t,["topK"]);O!=null&&v(n,["topK"],O);const A=y(t,["topP"]);if(A!=null&&v(n,["topP"],A),y(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function J5(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Mt(t,i)),r}function X5(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Mt(t,i)),r}function Q5(t,e){const n={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const r=y(t,["enableWidget"]);return r!=null&&v(n,["enableWidget"],r),n}function Z5(t,e){const n={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const r=y(t,["timeRangeFilter"]);return r!=null&&v(n,["timeRangeFilter"],r),n}function eU(t,e){const n={},r=y(t,["aspectRatio"]);r!=null&&v(n,["aspectRatio"],r);const i=y(t,["imageSize"]);if(i!=null&&v(n,["imageSize"],i),y(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(y(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(y(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return n}function tU(t,e){const n={},r=y(t,["aspectRatio"]);r!=null&&v(n,["aspectRatio"],r);const i=y(t,["imageSize"]);i!=null&&v(n,["imageSize"],i);const l=y(t,["personGeneration"]);l!=null&&v(n,["personGeneration"],l);const c=y(t,["outputMimeType"]);c!=null&&v(n,["imageOutputOptions","mimeType"],c);const d=y(t,["outputCompressionQuality"]);return d!=null&&v(n,["imageOutputOptions","compressionQuality"],d),n}function nU(t,e){const n={},r=y(t,["bytesBase64Encoded"]);r!=null&&v(n,["imageBytes"],Yi(r));const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function BC(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["bytesBase64Encoded"]);i!=null&&v(n,["imageBytes"],Yi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function Ih(t,e){const n={};if(y(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const r=y(t,["imageBytes"]);r!=null&&v(n,["bytesBase64Encoded"],Yi(r));const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function er(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["imageBytes"]);i!=null&&v(n,["bytesBase64Encoded"],Yi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function sU(t,e,n,r){const i={},l=y(e,["pageSize"]);n!==void 0&&l!=null&&v(n,["_query","pageSize"],l);const c=y(e,["pageToken"]);n!==void 0&&c!=null&&v(n,["_query","pageToken"],c);const d=y(e,["filter"]);n!==void 0&&d!=null&&v(n,["_query","filter"],d);const f=y(e,["queryBase"]);return n!==void 0&&f!=null&&v(n,["_url","models_url"],RC(t,f)),i}function rU(t,e,n,r){const i={},l=y(e,["pageSize"]);n!==void 0&&l!=null&&v(n,["_query","pageSize"],l);const c=y(e,["pageToken"]);n!==void 0&&c!=null&&v(n,["_query","pageToken"],c);const d=y(e,["filter"]);n!==void 0&&d!=null&&v(n,["_query","filter"],d);const f=y(e,["queryBase"]);return n!==void 0&&f!=null&&v(n,["_url","models_url"],RC(t,f)),i}function iU(t,e,n){const r={},i=y(e,["config"]);return i!=null&&sU(t,i,r),r}function aU(t,e,n){const r={},i=y(e,["config"]);return i!=null&&rU(t,i,r),r}function oU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["_self"]);if(l!=null){let c=MC(l);Array.isArray(c)&&(c=c.map(d=>ag(d))),v(n,["models"],c)}return n}function lU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["_self"]);if(l!=null){let c=MC(l);Array.isArray(c)&&(c=c.map(d=>og(d))),v(n,["models"],c)}return n}function cU(t,e){const n={},r=y(t,["maskMode"]);r!=null&&v(n,["maskMode"],r);const i=y(t,["segmentationClasses"]);i!=null&&v(n,["maskClasses"],i);const l=y(t,["maskDilation"]);return l!=null&&v(n,["dilation"],l),n}function ag(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["displayName"]);i!=null&&v(n,["displayName"],i);const l=y(t,["description"]);l!=null&&v(n,["description"],l);const c=y(t,["version"]);c!=null&&v(n,["version"],c);const d=y(t,["_self"]);d!=null&&v(n,["tunedModelInfo"],TU(d));const f=y(t,["inputTokenLimit"]);f!=null&&v(n,["inputTokenLimit"],f);const h=y(t,["outputTokenLimit"]);h!=null&&v(n,["outputTokenLimit"],h);const m=y(t,["supportedGenerationMethods"]);m!=null&&v(n,["supportedActions"],m);const x=y(t,["temperature"]);x!=null&&v(n,["temperature"],x);const g=y(t,["maxTemperature"]);g!=null&&v(n,["maxTemperature"],g);const N=y(t,["topP"]);N!=null&&v(n,["topP"],N);const T=y(t,["topK"]);T!=null&&v(n,["topK"],T);const C=y(t,["thinking"]);return C!=null&&v(n,["thinking"],C),n}function og(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["displayName"]);i!=null&&v(n,["displayName"],i);const l=y(t,["description"]);l!=null&&v(n,["description"],l);const c=y(t,["versionId"]);c!=null&&v(n,["version"],c);const d=y(t,["deployedModels"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(N=>S5(N))),v(n,["endpoints"],g)}const f=y(t,["labels"]);f!=null&&v(n,["labels"],f);const h=y(t,["_self"]);h!=null&&v(n,["tunedModelInfo"],CU(h));const m=y(t,["defaultCheckpointId"]);m!=null&&v(n,["defaultCheckpointId"],m);const x=y(t,["checkpoints"]);if(x!=null){let g=x;Array.isArray(g)&&(g=g.map(N=>N)),v(n,["checkpoints"],g)}return n}function dU(t,e){const n={},r=y(t,["mediaResolution"]);r!=null&&v(n,["mediaResolution"],r);const i=y(t,["codeExecutionResult"]);i!=null&&v(n,["codeExecutionResult"],i);const l=y(t,["executableCode"]);l!=null&&v(n,["executableCode"],l);const c=y(t,["fileData"]);c!=null&&v(n,["fileData"],_5(c));const d=y(t,["functionCall"]);d!=null&&v(n,["functionCall"],w5(d));const f=y(t,["functionResponse"]);f!=null&&v(n,["functionResponse"],f);const h=y(t,["inlineData"]);h!=null&&v(n,["inlineData"],YF(h));const m=y(t,["text"]);m!=null&&v(n,["text"],m);const x=y(t,["thought"]);x!=null&&v(n,["thought"],x);const g=y(t,["thoughtSignature"]);g!=null&&v(n,["thoughtSignature"],g);const N=y(t,["videoMetadata"]);return N!=null&&v(n,["videoMetadata"],N),n}function uU(t,e){const n={},r=y(t,["productImage"]);return r!=null&&v(n,["image"],er(r)),n}function hU(t,e,n){const r={},i=y(t,["numberOfImages"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["baseSteps"]);e!==void 0&&l!=null&&v(e,["parameters","baseSteps"],l);const c=y(t,["outputGcsUri"]);e!==void 0&&c!=null&&v(e,["parameters","storageUri"],c);const d=y(t,["seed"]);e!==void 0&&d!=null&&v(e,["parameters","seed"],d);const f=y(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&v(e,["parameters","safetySetting"],f);const h=y(t,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const m=y(t,["addWatermark"]);e!==void 0&&m!=null&&v(e,["parameters","addWatermark"],m);const x=y(t,["outputMimeType"]);e!==void 0&&x!=null&&v(e,["parameters","outputOptions","mimeType"],x);const g=y(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&v(e,["parameters","outputOptions","compressionQuality"],g);const N=y(t,["enhancePrompt"]);e!==void 0&&N!=null&&v(e,["parameters","enhancePrompt"],N);const T=y(t,["labels"]);return e!==void 0&&T!=null&&v(e,["labels"],T),r}function fU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["source"]);l!=null&&pU(l,r);const c=y(e,["config"]);return c!=null&&hU(c,r),r}function mU(t,e){const n={},r=y(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>Eh(l))),v(n,["generatedImages"],i)}return n}function pU(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["personImage"]);e!==void 0&&l!=null&&v(e,["instances[0]","personImage","image"],er(l));const c=y(t,["productImages"]);if(e!==void 0&&c!=null){let d=c;Array.isArray(d)&&(d=d.map(f=>uU(f))),v(e,["instances[0]","productImages"],d)}return r}function gU(t,e){const n={},r=y(t,["referenceImage"]);r!=null&&v(n,["referenceImage"],er(r));const i=y(t,["referenceId"]);i!=null&&v(n,["referenceId"],i);const l=y(t,["referenceType"]);l!=null&&v(n,["referenceType"],l);const c=y(t,["maskImageConfig"]);c!=null&&v(n,["maskImageConfig"],cU(c));const d=y(t,["controlImageConfig"]);d!=null&&v(n,["controlImageConfig"],n5(d));const f=y(t,["styleImageConfig"]);f!=null&&v(n,["styleImageConfig"],f);const h=y(t,["subjectImageConfig"]);return h!=null&&v(n,["subjectImageConfig"],h),n}function GC(t,e){const n={},r=y(t,["safetyAttributes","categories"]);r!=null&&v(n,["categories"],r);const i=y(t,["safetyAttributes","scores"]);i!=null&&v(n,["scores"],i);const l=y(t,["contentType"]);return l!=null&&v(n,["contentType"],l),n}function zC(t,e){const n={},r=y(t,["safetyAttributes","categories"]);r!=null&&v(n,["categories"],r);const i=y(t,["safetyAttributes","scores"]);i!=null&&v(n,["scores"],i);const l=y(t,["contentType"]);return l!=null&&v(n,["contentType"],l),n}function yU(t,e){const n={},r=y(t,["category"]);if(r!=null&&v(n,["category"],r),y(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=y(t,["threshold"]);return i!=null&&v(n,["threshold"],i),n}function xU(t,e){const n={},r=y(t,["image"]);return r!=null&&v(n,["image"],er(r)),n}function vU(t,e,n){const r={},i=y(t,["mode"]);e!==void 0&&i!=null&&v(e,["parameters","mode"],i);const l=y(t,["maxPredictions"]);e!==void 0&&l!=null&&v(e,["parameters","maxPredictions"],l);const c=y(t,["confidenceThreshold"]);e!==void 0&&c!=null&&v(e,["parameters","confidenceThreshold"],c);const d=y(t,["maskDilation"]);e!==void 0&&d!=null&&v(e,["parameters","maskDilation"],d);const f=y(t,["binaryColorThreshold"]);e!==void 0&&f!=null&&v(e,["parameters","binaryColorThreshold"],f);const h=y(t,["labels"]);return e!==void 0&&h!=null&&v(e,["labels"],h),r}function bU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["source"]);l!=null&&SU(l,r);const c=y(e,["config"]);return c!=null&&vU(c,r),r}function NU(t,e){const n={},r=y(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>W5(l))),v(n,["generatedMasks"],i)}return n}function SU(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],er(l));const c=y(t,["scribbleImage"]);return e!==void 0&&c!=null&&v(e,["instances[0]","scribble"],xU(c)),r}function _U(t,e){const n={},r=y(t,["retrievalConfig"]);r!=null&&v(n,["retrievalConfig"],r);const i=y(t,["functionCallingConfig"]);return i!=null&&v(n,["functionCallingConfig"],T5(i)),n}function wU(t,e){const n={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=y(t,["computerUse"]);r!=null&&v(n,["computerUse"],r);const i=y(t,["fileSearch"]);i!=null&&v(n,["fileSearch"],i);const l=y(t,["codeExecution"]);if(l!=null&&v(n,["codeExecution"],l),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>g)),v(n,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(n,["googleMaps"],Q5(d));const f=y(t,["googleSearch"]);f!=null&&v(n,["googleSearch"],Z5(f));const h=y(t,["googleSearchRetrieval"]);h!=null&&v(n,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(n,["urlContext"],m),n}function HC(t,e){const n={},r=y(t,["retrieval"]);r!=null&&v(n,["retrieval"],r);const i=y(t,["computerUse"]);if(i!=null&&v(n,["computerUse"],i),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=y(t,["codeExecution"]);l!=null&&v(n,["codeExecution"],l);const c=y(t,["enterpriseWebSearch"]);c!=null&&v(n,["enterpriseWebSearch"],c);const d=y(t,["functionDeclarations"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(N=>C5(N))),v(n,["functionDeclarations"],g)}const f=y(t,["googleMaps"]);f!=null&&v(n,["googleMaps"],f);const h=y(t,["googleSearch"]);h!=null&&v(n,["googleSearch"],h);const m=y(t,["googleSearchRetrieval"]);m!=null&&v(n,["googleSearchRetrieval"],m);const x=y(t,["urlContext"]);return x!=null&&v(n,["urlContext"],x),n}function TU(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["createTime"]);i!=null&&v(n,["createTime"],i);const l=y(t,["updateTime"]);return l!=null&&v(n,["updateTime"],l),n}function CU(t,e){const n={},r=y(t,["labels","google-vertex-llm-tuning-base-model-id"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["createTime"]);i!=null&&v(n,["createTime"],i);const l=y(t,["updateTime"]);return l!=null&&v(n,["updateTime"],l),n}function EU(t,e,n){const r={},i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);const c=y(t,["defaultCheckpointId"]);return e!==void 0&&c!=null&&v(e,["defaultCheckpointId"],c),r}function IU(t,e,n){const r={},i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);const c=y(t,["defaultCheckpointId"]);return e!==void 0&&c!=null&&v(e,["defaultCheckpointId"],c),r}function jU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","name"],Mt(t,i));const l=y(e,["config"]);return l!=null&&EU(l,r),r}function AU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["config"]);return l!=null&&IU(l,r),r}function kU(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["safetyFilterLevel"]);e!==void 0&&l!=null&&v(e,["parameters","safetySetting"],l);const c=y(t,["personGeneration"]);e!==void 0&&c!=null&&v(e,["parameters","personGeneration"],c);const d=y(t,["includeRaiReason"]);e!==void 0&&d!=null&&v(e,["parameters","includeRaiReason"],d);const f=y(t,["outputMimeType"]);e!==void 0&&f!=null&&v(e,["parameters","outputOptions","mimeType"],f);const h=y(t,["outputCompressionQuality"]);e!==void 0&&h!=null&&v(e,["parameters","outputOptions","compressionQuality"],h);const m=y(t,["enhanceInputImage"]);e!==void 0&&m!=null&&v(e,["parameters","upscaleConfig","enhanceInputImage"],m);const x=y(t,["imagePreservationFactor"]);e!==void 0&&x!=null&&v(e,["parameters","upscaleConfig","imagePreservationFactor"],x);const g=y(t,["labels"]);e!==void 0&&g!=null&&v(e,["labels"],g);const N=y(t,["numberOfImages"]);e!==void 0&&N!=null&&v(e,["parameters","sampleCount"],N);const T=y(t,["mode"]);return e!==void 0&&T!=null&&v(e,["parameters","mode"],T),r}function DU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Mt(t,i));const l=y(e,["image"]);l!=null&&v(r,["instances[0]","image"],er(l));const c=y(e,["upscaleFactor"]);c!=null&&v(r,["parameters","upscaleConfig","upscaleFactor"],c);const d=y(e,["config"]);return d!=null&&kU(d,r),r}function RU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Eh(c))),v(n,["generatedImages"],l)}return n}function MU(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["uri"],r);const i=y(t,["encodedVideo"]);i!=null&&v(n,["videoBytes"],Yi(i));const l=y(t,["encoding"]);return l!=null&&v(n,["mimeType"],l),n}function PU(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["uri"],r);const i=y(t,["bytesBase64Encoded"]);i!=null&&v(n,["videoBytes"],Yi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function OU(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["_self"],er(r));const i=y(t,["maskMode"]);return i!=null&&v(n,["maskMode"],i),n}function LU(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["image"],Ih(r));const i=y(t,["referenceType"]);return i!=null&&v(n,["referenceType"],i),n}function FU(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["image"],er(r));const i=y(t,["referenceType"]);return i!=null&&v(n,["referenceType"],i),n}function VC(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["uri"],r);const i=y(t,["videoBytes"]);i!=null&&v(n,["encodedVideo"],Yi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["encoding"],l),n}function qC(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["videoBytes"]);i!=null&&v(n,["bytesBase64Encoded"],Yi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UU(t,e){const n={},r=y(t,["displayName"]);return e!==void 0&&r!=null&&v(e,["displayName"],r),n}function BU(t){const e={},n=y(t,["config"]);return n!=null&&UU(n,e),e}function GU(t,e){const n={},r=y(t,["force"]);return e!==void 0&&r!=null&&v(e,["_query","force"],r),n}function zU(t){const e={},n=y(t,["name"]);n!=null&&v(e,["_url","name"],n);const r=y(t,["config"]);return r!=null&&GU(r,e),e}function HU(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","name"],n),e}function VU(t,e){const n={},r=y(t,["customMetadata"]);if(e!==void 0&&r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["customMetadata"],l)}const i=y(t,["chunkingConfig"]);return e!==void 0&&i!=null&&v(e,["chunkingConfig"],i),n}function qU(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],$U(c)),e}function WU(t){const e={},n=y(t,["fileSearchStoreName"]);n!=null&&v(e,["_url","file_search_store_name"],n);const r=y(t,["fileName"]);r!=null&&v(e,["fileName"],r);const i=y(t,["config"]);return i!=null&&VU(i,e),e}function $U(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function KU(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function YU(t){const e={},n=y(t,["config"]);return n!=null&&KU(n,e),e}function JU(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["fileSearchStores"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["fileSearchStores"],l)}return e}function WC(t,e){const n={},r=y(t,["mimeType"]);e!==void 0&&r!=null&&v(e,["mimeType"],r);const i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["customMetadata"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(f=>f)),v(e,["customMetadata"],d)}const c=y(t,["chunkingConfig"]);return e!==void 0&&c!=null&&v(e,["chunkingConfig"],c),n}function XU(t){const e={},n=y(t,["fileSearchStoreName"]);n!=null&&v(e,["_url","file_search_store_name"],n);const r=y(t,["config"]);return r!=null&&WC(r,e),e}function QU(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ZU="Content-Type",eB="X-Server-Timeout",tB="User-Agent",lg="x-goog-api-client",nB="1.42.0",sB=`google-genai-sdk/${nB}`,rB="v1beta1",iB="v1beta",aB=5,oB=[408,429,500,502,503,504];class lB{constructor(e){var n,r,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=(n=e.httpOptions)===null||n===void 0?void 0:n.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const l={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const d=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!d?(l.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?l.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(l.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),l.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:rB}else{if(!this.clientOptions.apiKey)throw new Ec({message:"API key must be set when using the Gemini API.",status:403});l.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:iB,l.baseUrl="https://generativelanguage.googleapis.com/"}l.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=l,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(l,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const i=[this.getRequestUrlInternal(n)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,n){return!(n.baseUrl&&n.baseUrlResourceScope===ng.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[c,d]of Object.entries(e.queryParams))i.searchParams.append(c,String(d));let l={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,n,i.toString(),e.abortSignal),this.unaryApiCall(i,l,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[i,l]of Object.entries(n))typeof l=="object"?r[i]=Object.assign(Object.assign({},r[i]),l):l!==void 0&&(r[i]=l);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,n,i.toString(),e.abortSignal),this.streamApiCall(i,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,i){if(n&&n.timeout||i){const l=new AbortController,c=l.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>l.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}i&&i.addEventListener("abort",()=>{l.abort()}),e.signal=c}return n&&n.extraBody!==null&&cB(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await v_(i),new sg(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await v_(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Ys(this,arguments,function*(){var r;const i=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let c="";const d="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:m}=yield lt(i.read());if(h){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const x=l.decode(m,{stream:!0});try{const T=JSON.parse(x);if("error"in T){const C=JSON.parse(JSON.stringify(T.error)),w=C.status,E=C.code,D=`got status: ${w}. ${JSON.stringify(T)}`;if(E>=400&&E<600)throw new Ec({message:D,status:E})}}catch(T){if(T.name==="ApiError")throw T}c+=x;let g=-1,N=0;for(;;){g=-1,N=0;for(const w of f){const E=c.indexOf(w);E!==-1&&(g===-1||E<g)&&(g=E,N=w.length)}if(g===-1)break;const T=c.substring(0,g);c=c.substring(g+N);const C=T.trim();if(C.startsWith(d)){const w=C.substring(d.length).trim();try{const E=new Response(w,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield lt(new sg(E))}catch(E){throw new Error(`exception parsing stream chunk ${w}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,n){var r;if(!this.clientOptions.httpOptions||!this.clientOptions.httpOptions.retryOptions)return fetch(e,n);const i=this.clientOptions.httpOptions.retryOptions;return XL(async()=>{const c=await fetch(e,n);if(c.ok)return c;throw oB.includes(c.status)?new Error(`Retryable HTTP Error: ${c.statusText}`):new wC.AbortError(`Non-retryable exception ${c.statusText} sending request`)},{retries:((r=i.attempts)!==null&&r!==void 0?r:aB)-1})}getDefaultHeaders(){const e={},n=sB+" "+this.clientOptions.userAgentExtra;return e[tB]=n,e[lg]=n,e[ZU]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[i,l]of Object.entries(e.headers))r.append(i,l);e.timeout&&e.timeout>0&&r.append(eB,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,c=await l.stat(e);i.sizeBytes=String(c.size);const d=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:c.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const f={file:i},h=this.getFileName(e),m=We("upload/v1beta/files",f._url),x=await this.fetchUploadUrl(m,i.sizeBytes,i.mimeType,h,f,n==null?void 0:n.httpOptions);return l.upload(e,x,this)}async uploadFileToFileSearchStore(e,n,r){var i;const l=this.clientOptions.uploader,c=await l.stat(n),d=String(c.size),f=(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:c.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,m=this.getFileName(n),x={};r!=null&&WC(r,x);const g=await this.fetchUploadUrl(h,d,f,m,x,r==null?void 0:r.httpOptions);return l.uploadToFileSearchStore(n,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,i,l,c){var d;let f={};c?f=c:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},i?{"X-Goog-Upload-File-Name":i}:{})};const h=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:f});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(d=h==null?void 0:h.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function v_(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(r);throw n>=400&&n<600?new Ec({message:i,status:n}):new Error(i)}}function cB(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const l=JSON.parse(t.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))n=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(l,c){const d=Object.assign({},l);for(const f in c)if(Object.prototype.hasOwnProperty.call(c,f)){const h=c[f],m=d[f];h&&typeof h=="object"&&!Array.isArray(h)&&m&&typeof m=="object"&&!Array.isArray(m)?d[f]=r(m,h):(m&&h&&typeof m!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof m}, New type: ${typeof h}. Overwriting.`),d[f]=h)}return d}const i=r(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dB="mcp_used/unknown";let uB=!1;function $C(t){for(const e of t)if(hB(e)||typeof e=="object"&&"inputSchema"in e)return!0;return uB}function KC(t){var e;const n=(e=t[lg])!==null&&e!==void 0?e:"";t[lg]=(n+` ${dB}`).trimStart()}function hB(t){return t!==null&&typeof t=="object"&&t instanceof jy}function fB(t){return Ys(this,arguments,function*(n,r=100){let i,l=0;for(;l<r;){const c=yield lt(n.listTools({cursor:i}));for(const d of c.tools)yield yield lt(d),l++;if(!c.nextCursor)break;i=c.nextCursor}})}class jy{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new jy(e,n)}async initialize(){var e,n,r,i;if(this.mcpTools.length>0)return;const l={},c=[];for(const m of this.mcpClients)try{for(var d=!0,f=(n=void 0,Js(fB(m))),h;h=await f.next(),e=h.done,!e;d=!0){i=h.value,d=!1;const x=i;c.push(x);const g=x.name;if(l[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);l[g]=m}}catch(x){n={error:x}}finally{try{!d&&!e&&(r=f.return)&&await r.call(f)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),U3(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const c=await i.callTool({name:r.name,arguments:r.args},void 0,l);n.push({functionResponse:{name:r.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function mB(t,e,n){const r=new k3;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(r,i),e(r)}class pB{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),c=xB(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),f=`${i}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${d}`;let h=()=>{};const m=new Promise(I=>{h=I}),x=e.callbacks,g=function(){h({})},N=this.apiClient,T={onopen:g,onmessage:I=>{mB(N,x.onmessage,I)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(I){},onclose:(r=x==null?void 0:x.onclose)!==null&&r!==void 0?r:function(I){}},C=this.webSocketFactory.create(f,yB(c),T);C.connect(),await m;const D={setup:{model:Mt(this.apiClient,e.model)}};return C.send(JSON.stringify(D)),new gB(C,this.apiClient)}}class gB{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=UF(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=FF(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(yo.PLAY)}pause(){this.sendPlaybackControl(yo.PAUSE)}stop(){this.sendPlaybackControl(yo.STOP)}resetContext(){this.sendPlaybackControl(yo.RESET_CONTEXT)}close(){this.conn.close()}}function yB(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function xB(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vB="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function bB(t,e,n){const r=new A3;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const l=JSON.parse(i);if(t.isVertexAI()){const c=zF(l);Object.assign(r,c)}else Object.assign(r,l);e(r)}class NB{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new pB(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,i,l,c,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let m;const x=this.apiClient.getHeaders();e.config&&e.config.tools&&$C(e.config.tools)&&KC(x);const g=TB(x);if(this.apiClient.isVertexAI()){const F=this.apiClient.getProject(),P=this.apiClient.getLocation(),U=this.apiClient.getApiKey(),q=!!F&&!!P||!!U;this.apiClient.getCustomBaseUrl()&&!q?m=f:(m=`${f}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,m))}else{const F=this.apiClient.getApiKey();let P="BidiGenerateContent",U="key";F!=null&&F.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),P="BidiGenerateContentConstrained",U="access_token"),m=`${f}/ws/google.ai.generativelanguage.${h}.GenerativeService.${P}?${U}=${F}`}let N=()=>{};const T=new Promise(F=>{N=F}),C=e.callbacks,w=function(){var F;(F=C==null?void 0:C.onopen)===null||F===void 0||F.call(C),N({})},E=this.apiClient,D={onopen:w,onmessage:F=>{bB(E,C.onmessage,F)},onerror:(n=C==null?void 0:C.onerror)!==null&&n!==void 0?n:function(F){},onclose:(r=C==null?void 0:C.onclose)!==null&&r!==void 0?r:function(F){}},I=this.webSocketFactory.create(m,wB(g),D);I.connect(),await T;let k=Mt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const F=this.apiClient.getProject(),P=this.apiClient.getLocation();F&&P&&(k=`projects/${F}/locations/${P}/`+k)}let M={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[th.AUDIO]}:e.config.responseModalities=[th.AUDIO]),!((l=e.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const j=(d=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[],O=[];for(const F of j)if(this.isCallableTool(F)){const P=F;O.push(await P.tool())}else O.push(F);O.length>0&&(e.config.tools=O);const A={model:k,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?M=LF(this.apiClient,A):M=OF(this.apiClient,A),delete M.config,I.send(JSON.stringify(M)),new _B(I,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const SB={turnComplete:!0};class _B{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=Ns(n.turns),e.isVertexAI()||(r=r.map(i=>Gc(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const l of r){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!e.isVertexAI()&&!("id"in l))throw new Error(vB)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},SB),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:GF(e)}:n={realtimeInput:BF(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function wB(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function TB(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const b_=10;function N_(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(To(c)){i=!0;break}if(!i)return!0;const l=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function To(t){return"callTool"in t&&typeof t.callTool=="function"}function CB(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>To(i)))!==null&&r!==void 0?r:!1}function S_(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,i)=>{if(To(r))return;const l=r;l.functionDeclarations&&l.functionDeclarations.length>0&&n.push(i)}),n}function __(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class EB extends ei{constructor(e){super(),this.apiClient=e,this.embedContent=async n=>{if(!this.apiClient.isVertexAI())return await this.embedContentInternal(n);if(n.model.includes("gemini")&&n.model!=="gemini-embedding-001"||n.model.includes("maas")){const i=Ns(n.contents);if(i.length>1)throw new Error("The embedContent API for this model only supports one content at a time.");const l=Object.assign(Object.assign({},n),{content:i[0],embeddingApiType:nh.EMBED_CONTENT});return await this.embedContentInternal(l)}else{const i=Object.assign(Object.assign({},n),{embeddingApiType:nh.PREDICT});return await this.embedContentInternal(i)}},this.generateContent=async n=>{var r,i,l,c,d;const f=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!CB(n)||N_(n.config))return await this.generateContentInternal(f);const h=S_(n);if(h.length>0){const C=h.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${C}.`)}let m,x;const g=Ns(f.contents),N=(l=(i=(r=f.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&l!==void 0?l:b_;let T=0;for(;T<N&&(m=await this.generateContentInternal(f),!(!m.functionCalls||m.functionCalls.length===0));){const C=m.candidates[0].content,w=[];for(const E of(d=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[])if(To(E)){const I=await E.callTool(m.functionCalls);w.push(...I)}T++,x={role:"user",parts:w},f.contents=Ns(f.contents),f.contents.push(C),f.contents.push(x),__(f.config)&&(g.push(C),g.push(x))}return __(f.config)&&(m.automaticFunctionCallingHistory=g),m},this.generateContentStream=async n=>{var r,i,l,c,d;if(this.maybeMoveToResponseJsonSchem(n),N_(n.config)){const x=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(x)}const f=S_(n);if(f.length>0){const x=f.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${x}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(l=(i=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||l===void 0?void 0:l.streamFunctionCallArguments,m=(d=(c=n==null?void 0:n.config)===null||c===void 0?void 0:c.automaticFunctionCalling)===null||d===void 0?void 0:d.disable;if(h&&!m)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var i;let l;const c=[];if(r!=null&&r.generatedImages)for(const f of r.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((i=f==null?void 0:f.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=f==null?void 0:f.safetyAttributes:c.push(f);let d;return l?d={generatedImages:c,positivePromptSafetyAttributes:l,sdkHttpResponse:r.sdkHttpResponse}:d={generatedImages:c,sdkHttpResponse:r.sdkHttpResponse},d}),this.list=async n=>{var r;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((r=c.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new ka(Yr.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(c),c)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var r,i,l,c,d,f;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(l=n.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.uri&&(!((f=(d=n.source)===null||d===void 0?void 0:d.video)===null||f===void 0)&&f.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,i;const l=(n=e.config)===null||n===void 0?void 0:n.tools;if(!l)return e;const c=await Promise.all(l.map(async f=>To(f)?await f.tool():f)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(d.config.tools=c,e.config&&e.config.tools&&$C(e.config.tools)){const f=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let h=Object.assign({},f);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),KC(h),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return d}async initAfcToolsMap(e){var n,r,i;const l=new Map;for(const c of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(To(c)){const d=c,f=await d.tool();for(const h of(i=f.functionDeclarations)!==null&&i!==void 0?i:[]){if(!h.name)throw new Error("Function declaration name is required.");if(l.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);l.set(h.name,d)}}return l}async processAfcStream(e){var n,r,i;const l=(i=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:b_;let c=!1,d=0;const f=await this.initAfcToolsMap(e);return(function(h,m,x){return Ys(this,arguments,function*(){for(var g,N,T,C,w,E;d<l;){c&&(d++,c=!1);const M=yield lt(h.processParamsMaybeAddMcpUsage(x)),j=yield lt(h.generateContentStreamInternal(M)),O=[],A=[];try{for(var D=!0,I=(N=void 0,Js(j)),k;k=yield lt(I.next()),g=k.done,!g;D=!0){C=k.value,D=!1;const F=C;if(yield yield lt(F),F.candidates&&(!((w=F.candidates[0])===null||w===void 0)&&w.content)){A.push(F.candidates[0].content);for(const P of(E=F.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(d<l&&P.functionCall){if(!P.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(P.functionCall.name)){const U=yield lt(m.get(P.functionCall.name).callTool([P.functionCall]));O.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${P.functionCall.name}`)}}}}catch(F){N={error:F}}finally{try{!D&&!g&&(T=I.return)&&(yield lt(T.call(I)))}finally{if(N)throw N.error}}if(O.length>0){c=!0;const F=new tc;F.candidates=[{content:{role:"user",parts:O}}],yield yield lt(F);const P=[];P.push(...A),P.push({role:"user",parts:O});const U=Ns(x.contents).concat(P);x.contents=U}else break}})})(this,f,e)}async generateContentInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=g_(this.apiClient,e);return d=We("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=x_(m),g=new tc;return Object.assign(g,x),g})}else{const h=p_(this.apiClient,e);return d=We("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=y_(m),g=new tc;return Object.assign(g,x),g})}}async generateContentStreamInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=g_(this.apiClient,e);return d=We("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(x){return Ys(this,arguments,function*(){var g,N,T,C;try{for(var w=!0,E=Js(x),D;D=yield lt(E.next()),g=D.done,!g;w=!0){C=D.value,w=!1;const I=C,k=x_(yield lt(I.json()),e);k.sdkHttpResponse={headers:I.headers};const M=new tc;Object.assign(M,k),yield yield lt(M)}}catch(I){N={error:I}}finally{try{!w&&!g&&(T=E.return)&&(yield lt(T.call(E)))}finally{if(N)throw N.error}}})})}else{const h=p_(this.apiClient,e);return d=We("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}),c.then(function(x){return Ys(this,arguments,function*(){var g,N,T,C;try{for(var w=!0,E=Js(x),D;D=yield lt(E.next()),g=D.done,!g;w=!0){C=D.value,w=!1;const I=C,k=y_(yield lt(I.json()),e);k.sdkHttpResponse={headers:I.headers};const M=new tc;Object.assign(M,k),yield yield lt(M)}}catch(I){N={error:I}}finally{try{!w&&!g&&(T=E.return)&&(yield lt(T.call(E)))}finally{if(N)throw N.error}}})})}}async embedContentInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=v5(this.apiClient,e,e),m=G3(e.model)?"{model}:embedContent":"{model}:predict";return d=We(m,h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(g=>{const N=g;return N.sdkHttpResponse={headers:x.headers},N})),c.then(x=>{const g=N5(x,e),N=new QS;return Object.assign(N,g),N})}else{const h=x5(this.apiClient,e);return d=We("{model}:batchEmbedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=b5(m),g=new QS;return Object.assign(g,x),g})}}async generateImagesInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=D5(this.apiClient,e);return d=We("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=M5(m),g=new ZS;return Object.assign(g,x),g})}else{const h=k5(this.apiClient,e);return d=We("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=R5(m),g=new ZS;return Object.assign(g,x),g})}}async editImageInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=m5(this.apiClient,e);return l=We("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=p5(f),m=new x3;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=DU(this.apiClient,e);return l=We("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=RU(f),m=new v3;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=fU(this.apiClient,e);return l=We("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=mU(f),m=new b3;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=bU(this.apiClient,e);return l=We("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=NU(f),m=new N3;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=X5(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>og(m))}else{const h=J5(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>ag(m))}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=aU(this.apiClient,e);return d=We("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=lU(m),g=new e_;return Object.assign(g,x),g})}else{const h=iU(this.apiClient,e);return d=We("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=oU(m),g=new e_;return Object.assign(g,x),g})}}async update(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=AU(this.apiClient,e);return d=We("{model}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>og(m))}else{const h=jU(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>ag(m))}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=d5(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=h5(m),g=new t_;return Object.assign(g,x),g})}else{const h=c5(this.apiClient,e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=u5(m),g=new t_;return Object.assign(g,x),g})}}async countTokens(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=a5(this.apiClient,e);return d=We("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=l5(m),g=new n_;return Object.assign(g,x),g})}else{const h=i5(this.apiClient,e);return d=We("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=o5(m),g=new n_;return Object.assign(g,x),g})}}async computeTokens(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=QF(this.apiClient,e);return l=We("{model}:computeTokens",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=ZF(f),m=new S3;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=B5(this.apiClient,e);return d=We("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>{const x=F5(m),g=new sh;return Object.assign(g,x),g})}else{const h=U5(this.apiClient,e);return d=We("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>{const x=L5(m),g=new sh;return Object.assign(g,x),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class IB extends ei{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let l;r&&"httpOptions"in r&&(l=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let l;r&&"httpOptions"in r&&(l=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=h3(e);return d=We("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c}else{const h=u3(e);return d=We("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c}}async fetchPredictVideosOperationInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=r3(e);return l=We("{resourceName}:fetchPredictOperation",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jB(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function AB(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>UB(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function kB(t,e,n){const r={},i=y(e,["expireTime"]);n!==void 0&&i!=null&&v(n,["expireTime"],i);const l=y(e,["newSessionExpireTime"]);n!==void 0&&l!=null&&v(n,["newSessionExpireTime"],l);const c=y(e,["uses"]);n!==void 0&&c!=null&&v(n,["uses"],c);const d=y(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&v(n,["bidiGenerateContentSetup"],FB(t,d));const f=y(e,["lockAdditionalFields"]);return n!==void 0&&f!=null&&v(n,["fieldMask"],f),r}function DB(t,e){const n={},r=y(e,["config"]);return r!=null&&v(n,["config"],kB(t,r,n)),n}function RB(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function MB(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function PB(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function OB(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function LB(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],r);const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],Iy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const T=y(t,["systemInstruction"]);e!==void 0&&T!=null&&v(e,["setup","systemInstruction"],AB(Pn(T)));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let j=Wo(C);Array.isArray(j)&&(j=j.map(O=>GB(qo(O)))),v(e,["setup","tools"],j)}const w=y(t,["sessionResumption"]);e!==void 0&&w!=null&&v(e,["setup","sessionResumption"],BB(w));const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const D=y(t,["outputAudioTranscription"]);e!==void 0&&D!=null&&v(e,["setup","outputAudioTranscription"],D);const I=y(t,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);if(e!==void 0&&M!=null&&v(e,["setup","proactivity"],M),y(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function FB(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Mt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],LB(i,n)),n}function UB(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],RB(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],MB(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],jB(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function BB(t){const e={},n=y(t,["handle"]);if(n!=null&&v(e,["handle"],n),y(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function GB(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],PB(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],OB(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zB(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(l=>`${n}.${l}`);e.push(...i)}else e.push(n)}return e.join(",")}function HB(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const l=r.setup;typeof l=="object"&&l!==null?(t.bidiGenerateContentSetup=l,n=l):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const l=zB(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)l?t.fieldMask=l:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];i.length>0&&(d=i.map(h=>c.includes(h)?`generationConfig.${h}`:h));const f=[];l&&f.push(l),d.length>0&&f.push(...d),f.length>0?t.fieldMask=f.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class VB extends ei{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=DB(this.apiClient,e);l=We("auth_tokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const f=HB(d,e.config);return i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),i.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qB(t,e){const n={},r=y(t,["force"]);return e!==void 0&&r!=null&&v(e,["_query","force"],r),n}function WB(t){const e={},n=y(t,["name"]);n!=null&&v(e,["_url","name"],n);const r=y(t,["config"]);return r!=null&&qB(r,e),e}function $B(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","name"],n),e}function KB(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function YB(t){const e={},n=y(t,["parent"]);n!=null&&v(e,["_url","parent"],n);const r=y(t,["config"]);return r!=null&&KB(r,e),e}function JB(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["documents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["documents"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class XB extends ei{constructor(e){super(),this.apiClient=e,this.list=async n=>new ka(Yr.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=$B(e);return l=We("{name}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=WB(e);i=We("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=YB(e);return l=We("{parent}/documents",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=JB(f),m=new _3;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class QB extends ei{constructor(e,n=new XB(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new ka(Yr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=BU(e);return l=We("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=HU(e);return l=We("{name}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=zU(e);i=We("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=YU(e);return l=We("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=JU(f),m=new w3;return Object.assign(m,h),m})}}async uploadToFileSearchStoreInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=XU(e);return l=We("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=QU(f),m=new T3;return Object.assign(m,h),m})}}async importFile(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=WU(e);return l=We("{file_search_store_name}:importFile",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=qU(f),m=new _y;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let YC=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return YC=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const ZB=()=>YC();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cg(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const dg=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Us extends Error{}class ss extends Us{constructor(e,n,r,i){super(`${ss.makeMessage(e,n,r)}`),this.status=e,this.headers=i,this.error=n}static makeMessage(e,n,r){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,r,i){if(!e||!i)return new jh({message:r,cause:dg(n)});const l=n;return e===400?new XC(e,l,r,i):e===401?new QC(e,l,r,i):e===403?new ZC(e,l,r,i):e===404?new eE(e,l,r,i):e===409?new tE(e,l,r,i):e===422?new nE(e,l,r,i):e===429?new sE(e,l,r,i):e>=500?new rE(e,l,r,i):new ss(e,l,r,i)}}class ug extends ss{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class jh extends ss{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class JC extends jh{constructor({message:e}={}){super({message:e??"Request timed out."})}}class XC extends ss{}class QC extends ss{}class ZC extends ss{}class eE extends ss{}class tE extends ss{}class nE extends ss{}class sE extends ss{}class rE extends ss{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e6=/^[a-z][a-z0-9+.-]*:/i,t6=t=>e6.test(t);let hg=t=>(hg=Array.isArray,hg(t));const n6=hg;let s6=n6;const w_=s6;function r6(t){if(!t)return!0;for(const e in t)return!1;return!0}function i6(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const a6=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Us(`${t} must be an integer`);if(e<0)throw new Us(`${t} must be a positive integer`);return e},o6=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const l6=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fo="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function c6(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const d6=()=>{var t,e,n,r,i;const l=c6();if(l==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":C_(Deno.build.os),"X-Stainless-Arch":T_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(l==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":C_((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":T_((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const c=u6();return c?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${c.browser}`,"X-Stainless-Runtime-Version":c.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function u6(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const i=r[1]||0,l=r[2]||0,c=r[3]||0;return{browser:e,version:`${i}.${l}.${c}`}}}return null}const T_=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",C_=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let fu;const h6=()=>fu??(fu=d6());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function f6(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function iE(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function m6(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return iE({start(){},async pull(n){const{done:r,value:i}=await e.next();r?n.close():n.enqueue(i)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function aE(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function p6(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const r=t.getReader(),i=r.cancel();r.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const g6=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oE=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function yp(t,e,n){return oE(),new File(t,e??"unknown_file",n)}function y6(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const x6=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lE=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",v6=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&lE(t),b6=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function N6(t,e,n){if(oE(),t=await t,v6(t))return t instanceof File?t:yp([await t.arrayBuffer()],t.name);if(b6(t)){const i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),yp(await fg(i),e,n)}const r=await fg(t);if(e||(e=y6(t)),!(n!=null&&n.type)){const i=r.find(l=>typeof l=="object"&&"type"in l&&l.type);typeof i=="string"&&(n=Object.assign(Object.assign({},n),{type:i}))}return yp(r,e,n)}async function fg(t){var e,n,r,i,l;let c=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)c.push(t);else if(lE(t))c.push(t instanceof Blob?t:await t.arrayBuffer());else if(x6(t))try{for(var d=!0,f=Js(t),h;h=await f.next(),e=h.done,!e;d=!0){i=h.value,d=!1;const m=i;c.push(...await fg(m))}}catch(m){n={error:m}}finally{try{!d&&!e&&(r=f.return)&&await r.call(f)}finally{if(n)throw n.error}}else{const m=(l=t==null?void 0:t.constructor)===null||l===void 0?void 0:l.name;throw new Error(`Unexpected data type: ${typeof t}${m?`; constructor: ${m}`:""}${S6(t)}`)}return c}function S6(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cE{constructor(e){this._client=e}}cE._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dE(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const E_=Object.freeze(Object.create(null)),_6=(t=dE)=>(function(n,...r){if(n.length===1)return n[0];let i=!1;const l=[],c=n.reduce((m,x,g)=>{var N,T,C;/[?#]/.test(x)&&(i=!0);const w=r[g];let E=(i?encodeURIComponent:t)(""+w);return g!==r.length&&(w==null||typeof w=="object"&&w.toString===((C=Object.getPrototypeOf((T=Object.getPrototypeOf((N=w.hasOwnProperty)!==null&&N!==void 0?N:E_))!==null&&T!==void 0?T:E_))===null||C===void 0?void 0:C.toString))&&(E=w+"",l.push({start:m.length+x.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),m+x+(g===r.length?"":E)},""),d=c.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=f.exec(d))!==null;)l.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(l.sort((m,x)=>m.start-x.start),l.length>0){let m=0;const x=l.reduce((g,N)=>{const T=" ".repeat(N.start-m),C="^".repeat(N.length);return m=N.start+N.length,g+T+C},"");throw new Us(`Path parameters result in path with invalid segments:
${l.map(g=>g.error).join(`
`)}
${c}
${x}`)}return c}),mu=_6(dE);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uE extends cE{create(e,n){var r;const{api_version:i=this._client.apiVersion}=e,l=ih(e,["api_version"]);if("model"in l&&"agent_config"in l)throw new Us("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in l&&"generation_config"in l)throw new Us("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(mu`/${i}/interactions`,Object.assign(Object.assign({body:l},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){const{api_version:i=this._client.apiVersion}=n??{};return this._client.delete(mu`/${i}/interactions/${e}`,r)}cancel(e,n={},r){const{api_version:i=this._client.apiVersion}=n??{};return this._client.post(mu`/${i}/interactions/${e}/cancel`,r)}get(e,n={},r){var i;const l=n??{},{api_version:c=this._client.apiVersion}=l,d=ih(l,["api_version"]);return this._client.get(mu`/${c}/interactions/${e}`,Object.assign(Object.assign({query:d},r),{stream:(i=n==null?void 0:n.stream)!==null&&i!==void 0?i:!1}))}}uE._key=Object.freeze(["interactions"]);class hE extends uE{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w6(t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}let pu;function Ay(t){let e;return(pu??(e=new globalThis.TextEncoder,pu=e.encode.bind(e)))(t)}let gu;function I_(t){let e;return(gu??(e=new globalThis.TextDecoder,gu=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ah{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ay(e):e;this.buffer=w6([this.buffer,n]);const r=[];let i;for(;(i=T6(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){r.push(I_(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const l=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,c=I_(this.buffer.subarray(0,l));r.push(c),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}Ah.NEWLINE_CHARS=new Set([`
`,"\r"]);Ah.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function T6(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function C6(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ah={off:0,error:200,warn:300,info:400,debug:500},j_=(t,e,n)=>{if(t){if(i6(ah,t))return t;Zn(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(ah))}`)}};function sc(){}function yu(t,e,n){return!e||ah[t]>ah[n]?sc:e[t].bind(e)}const E6={error:sc,warn:sc,info:sc,debug:sc};let A_=new WeakMap;function Zn(t){var e;const n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return E6;const i=A_.get(n);if(i&&i[0]===r)return i[1];const l={error:yu("error",n,r),warn:yu("warn",n,r),info:yu("info",n,r),debug:yu("debug",n,r)};return A_.set(n,[r,l]),l}const va=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xo{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let i=!1;const l=r?Zn(r):console;function c(){return Ys(this,arguments,function*(){var f,h,m,x;if(i)throw new Us("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var N=!0,T=Js(I6(e,n)),C;C=yield lt(T.next()),f=C.done,!f;N=!0){x=C.value,N=!1;const w=x;if(!g)if(w.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield lt(JSON.parse(w.data))}catch(E){throw l.error("Could not parse message into JSON:",w.data),l.error("From chunk:",w.raw),E}}}catch(w){h={error:w}}finally{try{!N&&!f&&(m=T.return)&&(yield lt(m.call(T)))}finally{if(h)throw h.error}}g=!0}catch(w){if(cg(w))return yield lt(void 0);throw w}finally{g||n.abort()}})}return new xo(c,n,r)}static fromReadableStream(e,n,r){let i=!1;function l(){return Ys(this,arguments,function*(){var f,h,m,x;const g=new Ah,N=aE(e);try{for(var T=!0,C=Js(N),w;w=yield lt(C.next()),f=w.done,!f;T=!0){x=w.value,T=!1;const E=x;for(const D of g.decode(E))yield yield lt(D)}}catch(E){h={error:E}}finally{try{!T&&!f&&(m=C.return)&&(yield lt(m.call(C)))}finally{if(h)throw h.error}}for(const E of g.flush())yield yield lt(E)})}function c(){return Ys(this,arguments,function*(){var f,h,m,x;if(i)throw new Us("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var N=!0,T=Js(l()),C;C=yield lt(T.next()),f=C.done,!f;N=!0){x=C.value,N=!1;const w=x;g||w&&(yield yield lt(JSON.parse(w)))}}catch(w){h={error:w}}finally{try{!N&&!f&&(m=T.return)&&(yield lt(m.call(T)))}finally{if(h)throw h.error}}g=!0}catch(w){if(cg(w))return yield lt(void 0);throw w}finally{g||n.abort()}})}return new xo(c,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),i=l=>({next:()=>{if(l.length===0){const c=r.next();e.push(c),n.push(c)}return l.shift()}});return[new xo(()=>i(e),this.controller,this.client),new xo(()=>i(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return iE({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:l}=await n.next();if(l)return r.close();const c=Ay(JSON.stringify(i)+`
`);r.enqueue(c)}catch(i){r.error(i)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function I6(t,e){return Ys(this,arguments,function*(){var r,i,l,c;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Us("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Us("Attempted to iterate over a response with no body");const d=new A6,f=new Ah,h=aE(t.body);try{for(var m=!0,x=Js(j6(h)),g;g=yield lt(x.next()),r=g.done,!r;m=!0){c=g.value,m=!1;const N=c;for(const T of f.decode(N)){const C=d.decode(T);C&&(yield yield lt(C))}}}catch(N){i={error:N}}finally{try{!m&&!r&&(l=x.return)&&(yield lt(l.call(x)))}finally{if(i)throw i.error}}for(const N of f.flush()){const T=d.decode(N);T&&(yield yield lt(T))}})}function j6(t){return Ys(this,arguments,function*(){var n,r,i,l;let c=new Uint8Array;try{for(var d=!0,f=Js(t),h;h=yield lt(f.next()),n=h.done,!n;d=!0){l=h.value,d=!1;const m=l;if(m==null)continue;const x=m instanceof ArrayBuffer?new Uint8Array(m):typeof m=="string"?Ay(m):m;let g=new Uint8Array(c.length+x.length);g.set(c),g.set(x,c.length),c=g;let N;for(;(N=C6(c))!==-1;)yield yield lt(c.slice(0,N)),c=c.slice(N)}}catch(m){r={error:m}}finally{try{!d&&!n&&(i=f.return)&&(yield lt(i.call(f)))}finally{if(r)throw r.error}}c.length>0&&(yield yield lt(c))})}class A6{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,i]=k6(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function k6(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function D6(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:l}=e,c=await(async()=>{var d;if(e.options.stream)return Zn(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):xo.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const f=n.headers.get("content-type"),h=(d=f==null?void 0:f.split(";")[0])===null||d===void 0?void 0:d.trim();return(h==null?void 0:h.includes("application/json"))||(h==null?void 0:h.endsWith("+json"))?n.headers.get("content-length")==="0"?void 0:await n.json():await n.text()})();return Zn(t).debug(`[${r}] response parsed`,va({retryOfRequestLogID:i,url:n.url,status:n.status,body:c,durationMs:Date.now()-l})),c}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ky extends Promise{constructor(e,n,r=D6){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new ky(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fE=Symbol("brand.privateNullableHeaders");function*R6(t){if(!t)return;if(fE in t){const{values:r,nulls:i}=t;yield*r.entries();for(const l of i)yield[l,null];return}let e=!1,n;t instanceof Headers?n=t.entries():w_(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const l=w_(r[1])?r[1]:[r[1]];let c=!1;for(const d of l)d!==void 0&&(e&&!c&&(c=!0,yield[i,null]),yield[i,d])}}const nc=t=>{const e=new Headers,n=new Set;for(const r of t){const i=new Set;for(const[l,c]of R6(r)){const d=l.toLowerCase();i.has(d)||(e.delete(l),i.add(d)),c===null?(e.delete(l),n.add(d)):(e.append(l,c),n.delete(d))}}return{[fE]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xp=t=>{var e,n,r,i,l,c;if(typeof globalThis.process<"u")return(r=(n=(e=QL)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(c=(l=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||l===void 0?void 0:l.call(i,t))===null||c===void 0?void 0:c.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var mE;class kh{constructor(e){var n,r,i,l,c,d,f,{baseURL:h=xp("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:m=(n=xp("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:x="v1beta"}=e,g=ih(e,["baseURL","apiKey","apiVersion"]);const N=Object.assign(Object.assign({apiKey:m,apiVersion:x},g),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=N.baseURL,this.timeout=(r=N.timeout)!==null&&r!==void 0?r:kh.DEFAULT_TIMEOUT,this.logger=(i=N.logger)!==null&&i!==void 0?i:console;const T="warn";this.logLevel=T,this.logLevel=(c=(l=j_(N.logLevel,"ClientOptions.logLevel",this))!==null&&l!==void 0?l:j_(xp("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&c!==void 0?c:T,this.fetchOptions=N.fetchOptions,this.maxRetries=(d=N.maxRetries)!==null&&d!==void 0?d:2,this.fetch=(f=N.fetch)!==null&&f!==void 0?f:f6(),this.encoder=g6,this._options=N,this.apiKey=m,this.apiVersion=x,this.clientAdapter=N.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=nc([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return nc([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return nc([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new Us(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${fo}`}defaultIdempotencyKey(){return`stainless-node-retry-${ZB()}`}makeStatusError(e,n,r,i){return ss.generate(e,n,r,i)}buildURL(e,n,r){const i=!this.baseURLOverridden()&&r||this.baseURL,l=t6(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),c=this.defaultQuery();return r6(c)||(n=Object.assign(Object.assign({},c),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(l.search=this.stringifyQuery(n)),l.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(i=>Object.assign({method:e,path:n},i)))}request(e,n=null){return new ky(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var i,l,c;const d=await e,f=(i=d.maxRetries)!==null&&i!==void 0?i:this.maxRetries;n==null&&(n=f),await this.prepareOptions(d);const{req:h,url:m,timeout:x}=await this.buildRequest(d,{retryCount:f-n});await this.prepareRequest(h,{url:m,options:d});const g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),N=r===void 0?"":`, retryOf: ${r}`,T=Date.now();if(Zn(this).debug(`[${g}] sending request`,va({retryOfRequestLogID:r,method:d.method,url:m,options:d,headers:h.headers})),!((l=d.signal)===null||l===void 0)&&l.aborted)throw new ug;const C=new AbortController,w=await this.fetchWithTimeout(m,h,x,C).catch(dg),E=Date.now();if(w instanceof globalThis.Error){const I=`retrying, ${n} attempts remaining`;if(!((c=d.signal)===null||c===void 0)&&c.aborted)throw new ug;const k=cg(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(n)return Zn(this).info(`[${g}] connection ${k?"timed out":"failed"} - ${I}`),Zn(this).debug(`[${g}] connection ${k?"timed out":"failed"} (${I})`,va({retryOfRequestLogID:r,url:m,durationMs:E-T,message:w.message})),this.retryRequest(d,n,r??g);throw Zn(this).info(`[${g}] connection ${k?"timed out":"failed"} - error; no more retries left`),Zn(this).debug(`[${g}] connection ${k?"timed out":"failed"} (error; no more retries left)`,va({retryOfRequestLogID:r,url:m,durationMs:E-T,message:w.message})),k?new JC:new jh({cause:w})}const D=`[${g}${N}] ${h.method} ${m} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${E-T}ms`;if(!w.ok){const I=await this.shouldRetry(w);if(n&&I){const F=`retrying, ${n} attempts remaining`;return await p6(w.body),Zn(this).info(`${D} - ${F}`),Zn(this).debug(`[${g}] response error (${F})`,va({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:E-T})),this.retryRequest(d,n,r??g,w.headers)}const k=I?"error; no more retries left":"error; not retryable";Zn(this).info(`${D} - ${k}`);const M=await w.text().catch(F=>dg(F).message),j=o6(M),O=j?void 0:M;throw Zn(this).debug(`[${g}] response error (${k})`,va({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:O,durationMs:Date.now()-T})),this.makeStatusError(w.status,j,O,w.headers)}return Zn(this).info(D),Zn(this).debug(`[${g}] response start`,va({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:E-T})),{response:w,options:d,controller:C,requestLogID:g,retryOfRequestLogID:r,startTime:T}}async fetchWithTimeout(e,n,r,i){const l=n||{},{signal:c,method:d}=l,f=ih(l,["signal","method"]),h=this._makeAbort(i);c&&c.addEventListener("abort",h,{once:!0});const m=setTimeout(h,r),x=globalThis.ReadableStream&&f.body instanceof globalThis.ReadableStream||typeof f.body=="object"&&f.body!==null&&Symbol.asyncIterator in f.body,g=Object.assign(Object.assign(Object.assign({signal:i.signal},x?{duplex:"half"}:{}),{method:"GET"}),f);d&&(g.method=d.toUpperCase());try{return await this.fetch.call(void 0,e,g)}finally{clearTimeout(m)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,i){var l;let c;const d=i==null?void 0:i.get("retry-after-ms");if(d){const h=parseFloat(d);Number.isNaN(h)||(c=h)}const f=i==null?void 0:i.get("retry-after");if(f&&!c){const h=parseFloat(f);Number.isNaN(h)?c=Date.parse(f)-Date.now():c=h*1e3}if(!(c&&0<=c&&c<60*1e3)){const h=(l=e.maxRetries)!==null&&l!==void 0?l:this.maxRetries;c=this.calculateDefaultRetryTimeoutMillis(n,h)}return await l6(c),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const l=n-e,c=Math.min(.5*Math.pow(2,l),8),d=1-Math.random()*.25;return c*d*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,i,l;const c=Object.assign({},e),{method:d,path:f,query:h,defaultBaseURL:m}=c,x=this.buildURL(f,h,m);"timeout"in c&&a6("timeout",c.timeout),c.timeout=(r=c.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:g,body:N}=this.buildBody({options:c}),T=await this.buildHeaders({options:e,method:d,bodyHeaders:g,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:d,headers:T},c.signal&&{signal:c.signal}),globalThis.ReadableStream&&N instanceof globalThis.ReadableStream&&{duplex:"half"}),N&&{body:N}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(l=c.fetchOptions)!==null&&l!==void 0?l:{}),url:x,timeout:c.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:i}){let l={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),l[this.idempotencyHeader]=e.idempotencyKey);const c=await this.authHeaders(e);let d=nc([l,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),h6()),this._options.defaultHeaders,r,e.headers,c]);return this.validateHeaders(d),d.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=nc([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:m6(e)}:typeof e=="object"&&r.values.get("content-type")==="application/x-www-form-urlencoded"?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(e)}:this.encoder({body:e,headers:r})}}kh.DEFAULT_TIMEOUT=6e4;class On extends kh{constructor(){super(...arguments),this.interactions=new hE(this)}}mE=On;On.GeminiNextGenAPIClient=mE;On.GeminiNextGenAPIClientError=Us;On.APIError=ss;On.APIConnectionError=jh;On.APIConnectionTimeoutError=JC;On.APIUserAbortError=ug;On.NotFoundError=eE;On.ConflictError=tE;On.RateLimitError=sE;On.BadRequestError=XC;On.AuthenticationError=QC;On.InternalServerError=rE;On.PermissionDeniedError=ZC;On.UnprocessableEntityError=nE;On.toFile=N6;On.Interactions=hE;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function M6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function P6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function O6(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function L6(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function F6(t,e,n){const r={};if(y(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=y(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&v(e,["displayName"],i),y(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=y(t,["epochCount"]);e!==void 0&&l!=null&&v(e,["tuningTask","hyperparameters","epochCount"],l);const c=y(t,["learningRateMultiplier"]);if(c!=null&&v(r,["tuningTask","hyperparameters","learningRateMultiplier"],c),y(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(y(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(y(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(y(t,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(y(t,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const d=y(t,["batchSize"]);e!==void 0&&d!=null&&v(e,["tuningTask","hyperparameters","batchSize"],d);const f=y(t,["learningRate"]);if(e!==void 0&&f!=null&&v(e,["tuningTask","hyperparameters","learningRate"],f),y(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(y(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(y(t,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(y(t,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(y(t,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(y(t,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");if(y(t,["encryptionSpec"])!==void 0)throw new Error("encryptionSpec parameter is not supported in Gemini API.");return r}function U6(t,e,n){const r={};let i=y(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const j=y(t,["validationDataset"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec"],vp(j))}else if(i==="PREFERENCE_TUNING"){const j=y(t,["validationDataset"]);e!==void 0&&j!=null&&v(e,["preferenceOptimizationSpec"],vp(j))}else if(i==="DISTILLATION"){const j=y(t,["validationDataset"]);e!==void 0&&j!=null&&v(e,["distillationSpec"],vp(j))}const l=y(t,["tunedModelDisplayName"]);e!==void 0&&l!=null&&v(e,["tunedModelDisplayName"],l);const c=y(t,["description"]);e!==void 0&&c!=null&&v(e,["description"],c);let d=y(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const j=y(t,["epochCount"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","hyperParameters","epochCount"],j)}else if(d==="PREFERENCE_TUNING"){const j=y(t,["epochCount"]);e!==void 0&&j!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],j)}else if(d==="DISTILLATION"){const j=y(t,["epochCount"]);e!==void 0&&j!=null&&v(e,["distillationSpec","hyperParameters","epochCount"],j)}let f=y(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const j=y(t,["learningRateMultiplier"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],j)}else if(f==="PREFERENCE_TUNING"){const j=y(t,["learningRateMultiplier"]);e!==void 0&&j!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],j)}else if(f==="DISTILLATION"){const j=y(t,["learningRateMultiplier"]);e!==void 0&&j!=null&&v(e,["distillationSpec","hyperParameters","learningRateMultiplier"],j)}let h=y(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const j=y(t,["exportLastCheckpointOnly"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","exportLastCheckpointOnly"],j)}else if(h==="PREFERENCE_TUNING"){const j=y(t,["exportLastCheckpointOnly"]);e!==void 0&&j!=null&&v(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],j)}else if(h==="DISTILLATION"){const j=y(t,["exportLastCheckpointOnly"]);e!==void 0&&j!=null&&v(e,["distillationSpec","exportLastCheckpointOnly"],j)}let m=y(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const j=y(t,["adapterSize"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","hyperParameters","adapterSize"],j)}else if(m==="PREFERENCE_TUNING"){const j=y(t,["adapterSize"]);e!==void 0&&j!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],j)}else if(m==="DISTILLATION"){const j=y(t,["adapterSize"]);e!==void 0&&j!=null&&v(e,["distillationSpec","hyperParameters","adapterSize"],j)}let x=y(n,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const j=y(t,["tuningMode"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","tuningMode"],j)}const g=y(t,["customBaseModel"]);e!==void 0&&g!=null&&v(e,["customBaseModel"],g);let N=y(n,["config","method"]);if(N===void 0&&(N="SUPERVISED_FINE_TUNING"),N==="SUPERVISED_FINE_TUNING"){const j=y(t,["batchSize"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","hyperParameters","batchSize"],j)}let T=y(n,["config","method"]);if(T===void 0&&(T="SUPERVISED_FINE_TUNING"),T==="SUPERVISED_FINE_TUNING"){const j=y(t,["learningRate"]);e!==void 0&&j!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRate"],j)}const C=y(t,["labels"]);e!==void 0&&C!=null&&v(e,["labels"],C);const w=y(t,["beta"]);e!==void 0&&w!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","beta"],w);const E=y(t,["baseTeacherModel"]);e!==void 0&&E!=null&&v(e,["distillationSpec","baseTeacherModel"],E);const D=y(t,["tunedTeacherModelSource"]);e!==void 0&&D!=null&&v(e,["distillationSpec","tunedTeacherModelSource"],D);const I=y(t,["sftLossWeightMultiplier"]);e!==void 0&&I!=null&&v(e,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],I);const k=y(t,["outputUri"]);e!==void 0&&k!=null&&v(e,["outputUri"],k);const M=y(t,["encryptionSpec"]);return e!==void 0&&M!=null&&v(e,["encryptionSpec"],M),r}function B6(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["preTunedModel"]);i!=null&&v(n,["preTunedModel"],i);const l=y(t,["trainingDataset"]);l!=null&&X6(l);const c=y(t,["config"]);return c!=null&&F6(c,n),n}function G6(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["preTunedModel"]);i!=null&&v(n,["preTunedModel"],i);const l=y(t,["trainingDataset"]);l!=null&&Q6(l,n,e);const c=y(t,["config"]);return c!=null&&U6(c,n,e),n}function z6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function H6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function V6(t,e,n){const r={},i=y(t,["pageSize"]);e!==void 0&&i!=null&&v(e,["_query","pageSize"],i);const l=y(t,["pageToken"]);e!==void 0&&l!=null&&v(e,["_query","pageToken"],l);const c=y(t,["filter"]);return e!==void 0&&c!=null&&v(e,["_query","filter"],c),r}function q6(t,e,n){const r={},i=y(t,["pageSize"]);e!==void 0&&i!=null&&v(e,["_query","pageSize"],i);const l=y(t,["pageToken"]);e!==void 0&&l!=null&&v(e,["_query","pageToken"],l);const c=y(t,["filter"]);return e!==void 0&&c!=null&&v(e,["_query","filter"],c),r}function W6(t,e){const n={},r=y(t,["config"]);return r!=null&&V6(r,n),n}function $6(t,e){const n={},r=y(t,["config"]);return r!=null&&q6(r,n),n}function K6(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["tunedModels"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>pE(d))),v(n,["tuningJobs"],c)}return n}function Y6(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["tuningJobs"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>mg(d))),v(n,["tuningJobs"],c)}return n}function J6(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["model"],r);const i=y(t,["name"]);return i!=null&&v(n,["endpoint"],i),n}function X6(t,e){const n={};if(y(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(y(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=y(t,["examples"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(n,["examples","examples"],i)}return n}function Q6(t,e,n){const r={};let i=y(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(i==="PREFERENCE_TUNING"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(i==="DISTILLATION"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["distillationSpec","promptDatasetUri"],c)}let l=y(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(l==="PREFERENCE_TUNING"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(l==="DISTILLATION"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["distillationSpec","promptDatasetUri"],c)}if(y(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function pE(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["state"]);l!=null&&v(n,["state"],kC(l));const c=y(t,["createTime"]);c!=null&&v(n,["createTime"],c);const d=y(t,["tuningTask","startTime"]);d!=null&&v(n,["startTime"],d);const f=y(t,["tuningTask","completeTime"]);f!=null&&v(n,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(n,["updateTime"],h);const m=y(t,["description"]);m!=null&&v(n,["description"],m);const x=y(t,["baseModel"]);x!=null&&v(n,["baseModel"],x);const g=y(t,["_self"]);return g!=null&&v(n,["tunedModel"],J6(g)),n}function mg(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["state"]);l!=null&&v(n,["state"],kC(l));const c=y(t,["createTime"]);c!=null&&v(n,["createTime"],c);const d=y(t,["startTime"]);d!=null&&v(n,["startTime"],d);const f=y(t,["endTime"]);f!=null&&v(n,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(n,["updateTime"],h);const m=y(t,["error"]);m!=null&&v(n,["error"],m);const x=y(t,["description"]);x!=null&&v(n,["description"],x);const g=y(t,["baseModel"]);g!=null&&v(n,["baseModel"],g);const N=y(t,["tunedModel"]);N!=null&&v(n,["tunedModel"],N);const T=y(t,["preTunedModel"]);T!=null&&v(n,["preTunedModel"],T);const C=y(t,["supervisedTuningSpec"]);C!=null&&v(n,["supervisedTuningSpec"],C);const w=y(t,["preferenceOptimizationSpec"]);w!=null&&v(n,["preferenceOptimizationSpec"],w);const E=y(t,["distillationSpec"]);E!=null&&v(n,["distillationSpec"],E);const D=y(t,["tuningDataStats"]);D!=null&&v(n,["tuningDataStats"],D);const I=y(t,["encryptionSpec"]);I!=null&&v(n,["encryptionSpec"],I);const k=y(t,["partnerModelTuningSpec"]);k!=null&&v(n,["partnerModelTuningSpec"],k);const M=y(t,["customBaseModel"]);M!=null&&v(n,["customBaseModel"],M);const j=y(t,["experiment"]);j!=null&&v(n,["experiment"],j);const O=y(t,["labels"]);O!=null&&v(n,["labels"],O);const A=y(t,["outputUri"]);A!=null&&v(n,["outputUri"],A);const F=y(t,["pipelineJob"]);F!=null&&v(n,["pipelineJob"],F);const P=y(t,["serviceAccount"]);P!=null&&v(n,["serviceAccount"],P);const U=y(t,["tunedModelDisplayName"]);U!=null&&v(n,["tunedModelDisplayName"],U);const q=y(t,["veoTuningSpec"]);return q!=null&&v(n,["veoTuningSpec"],q),n}function Z6(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["metadata"]);l!=null&&v(n,["metadata"],l);const c=y(t,["done"]);c!=null&&v(n,["done"],c);const d=y(t,["error"]);return d!=null&&v(n,["error"],d),n}function vp(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["validationDatasetUri"],r);const i=y(t,["vertexDatasetResource"]);return i!=null&&v(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eG extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ka(Yr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},n),{preTunedModel:i});return l.baseModel=void 0,await this.tuneInternal(l)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),l=await this.tuneMldevInternal(i);let c="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?c=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(c=l.name.split("/operations/")[0]),{name:c,state:tg.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=H6(e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>mg(m))}else{const h=z6(e);return d=We("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>pE(m))}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=$6(e);return d=We("tuningJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=Y6(m),g=new s_;return Object.assign(g,x),g})}else{const h=W6(e);return d=We("tunedModels",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=K6(m),g=new s_;return Object.assign(g,x),g})}}async cancel(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=P6(e);return d=We("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=L6(m),g=new r_;return Object.assign(g,x),g})}else{const h=M6(e);return d=We("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=O6(m),g=new r_;return Object.assign(g,x),g})}}async tuneInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=G6(e,e);return l=We("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>mg(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=B6(e);return l=We("tunedModels",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>Z6(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tG{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const nG=1024*1024*8,sG=3,rG=1e3,iG=2,oh="x-goog-upload-status";async function aG(t,e,n){var r;const i=await gE(t,e,n),l=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[oh])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return l.file}async function oG(t,e,n){var r;const i=await gE(t,e,n),l=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[oh])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=TC(l),d=new wy;return Object.assign(d,c),d}async function gE(t,e,n){var r,i;let l=0,c=0,d=new sg(new Response),f="upload";for(l=t.size;c<l;){const h=Math.min(nG,l-c),m=t.slice(c,c+h);c+h>=l&&(f+=", finalize");let x=0,g=rG;for(;x<sG&&(d=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((r=d==null?void 0:d.headers)===null||r===void 0)&&r[oh]));)x++,await cG(g),g=g*iG;if(c+=h,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[oh])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function lG(t){return{size:t.size,type:t.type}}function cG(t){return new Promise(e=>setTimeout(e,t))}class dG{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await aG(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await oG(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await lG(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uG{create(e,n,r){return new hG(e,n,r)}}class hG{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k_="x-goog-api-key";class fG{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(k_)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(k_,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mG="gl-node/";class pG{get interactions(){var e;if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const n=this.httpOptions;n!=null&&n.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const r=new On({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:n==null?void 0:n.timeout,maxRetries:(e=n==null?void 0:n.retryOptions)===null||e===void 0?void 0:e.attempts});return this._interactions=r.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=n3(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new fG(this.apiKey);this.apiClient=new lB({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:mG+"web",uploader:new dG,downloader:new tG}),this.models=new EB(this.apiClient),this.live=new NB(this.apiClient,i,new uG),this.batches=new R4(this.apiClient),this.chats=new mF(this.models,this.apiClient),this.caches=new uF(this.apiClient),this.files=new CF(this.apiClient),this.operations=new IB(this.apiClient),this.authTokens=new VB(this.apiClient),this.tunings=new eG(this.apiClient),this.fileSearchStores=new QB(this.apiClient)}}var gG={};const zc=typeof process<"u"&&gG?"your-gemini-api-key-here":"",Dh=new pG({apiKey:zc});async function ws(t){if(!zc)return console.warn("Gemini API Key is missing. Narrative generation skipped."),"API Key missing. Cannot generate narrative.";try{return(await Dh.models.generateContent({model:"gemini-3-flash-preview",contents:t})).text||""}catch(e){return console.error("Gemini API Error:",e),"Error generating content."}}const yG=async(t,e)=>{const n=`
        You are a supportive agricultural advisor for a seaweed farm. Write a monthly performance review for a specific farmer.
        Write in English. Tone: Professional, encouraging, and constructive.

        Farmer: ${t.farmerName} (Site: ${t.siteName})
        Period: ${t.period}

        Data:
        - Planted: ${t.production.plantedLines} lines
        - Harvested: ${t.production.harvestedLines} lines
        - Total Weight: ${t.production.harvestedWeight.toFixed(2)} kg
        - Average Growth Rate: ${t.efficiency.avgGrowthRate.toFixed(2)} %/day
        - Currently Active Cycles: ${t.efficiency.activeCycles}
        - Incidents Reported: ${t.incidentsCount}

        Instructions:
        1. Start with a summary of their production.
        2. Evaluate their efficiency based on growth rate (Standard is ~3-4%).
        3. Mention their engagement based on planted lines.
        4. Address any incidents.
        5. Conclude with advice.
        Format with "###" headings.
    `,r=`
        Vous tes un conseiller agricole bienveillant pour une ferme d'algues. Rdigez un bilan de performance mensuel pour un fermier spcifique.
        Rdigez en franais. Ton : Professionnel, encourageant et constructif.

        Fermier : ${t.farmerName} (Site : ${t.siteName})
        Priode : ${t.period}

        Donnes :
        - Plant : ${t.production.plantedLines} lignes
        - Rcolt : ${t.production.harvestedLines} lignes
        - Poids Total : ${t.production.harvestedWeight.toFixed(2)} kg
        - Taux de Croissance Moyen : ${t.efficiency.avgGrowthRate.toFixed(2)} %/jour
        - Cycles Actuellement Actifs : ${t.efficiency.activeCycles}
        - Incidents Signals : ${t.incidentsCount}

        Instructions :
        1. Commencez par un rsum de leur production.
        2. valuez leur efficacit (Standard ~3-4%).
        3. Mentionnez leur engagement.
        4. Abordez les incidents s'il y en a.
        5. Concluez par un conseil.
        Utilisez "###" pour les titres de section.
    `;return ws(e==="fr"?r:n)},xG=async(t,e)=>{const n=`
        As an aquaculture expert, suggest a drying strategy.
        Language: ${e==="fr"?"French":"English"}
        
        Seaweed Type: ${t.seaweedType}
        Wet Weight: ${t.totalWeight} kg
        Harvest Notes: ${t.notes}
        
        Suggest estimated drying time, target moisture content, and specific precautions.
    `;return ws(n)},vG=async(t,e,n,r,i)=>{if(!zc)return console.warn("Gemini API Key is missing. Incident description analysis skipped."),{};const l=`
        Analyze this incident description from a seaweed farm: "${t}"
        
        Available Incident Types: ${n.map(c=>c.id).join(", ")}
        Available Severities: ${r.map(c=>c.id).join(", ")}
        Available Module Codes: ${e.join(", ")}
        
        Return a JSON object with:
        - suggestedType (string, one of available types)
        - suggestedSeverity (string, one of available severities)
        - suggestedModuleCodes (array of strings, matches found in description)
    `;try{const c=await Dh.models.generateContent({model:"gemini-3-flash-preview",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:_n.OBJECT,properties:{suggestedType:{type:_n.STRING},suggestedSeverity:{type:_n.STRING},suggestedModuleCodes:{type:_n.ARRAY,items:{type:_n.STRING}}}}}});return JSON.parse(c.text||"{}")}catch(c){return console.error("Gemini JSON analysis failed",c),{}}},bG=async(t,e)=>{var r;if(!zc)return console.warn("Gemini API Key is missing. Image analysis skipped."),{description:"API Key missing. Cannot analyze image.",severity:"LOW",type:"OTHER",treatments:""};const n=`
        Analyze this image of seaweed. It might show signs of disease (like Ice-Ice, EFA), pests (grazing), or be healthy.
        
        Identify the most likely issue.
        Output ONLY a JSON object with:
        - type: (one of: "PEST_DISEASE", "ENVIRONMENTAL", "OTHER")
        - severity: (one of: "LOW", "MEDIUM", "HIGH", "CRITICAL")
        - description: A short description of the visual symptoms observed in ${e==="fr"?"French":"English"}.
        - treatments: A concise list of immediate actions or treatments recommended for this specific issue in ${e==="fr"?"French":"English"}.
    `;try{const i=t.split(",")[1]||t;let c=((r=(await Dh.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:i}},{text:n}]}})).text)==null?void 0:r.trim())||"{}";return c.startsWith("```json")?c=c.substring(7,c.length-3).trim():c.startsWith("```")&&(c=c.substring(3,c.length-3).trim()),JSON.parse(c)}catch(i){return console.error("Gemini Image analysis failed",i),{description:"Analysis failed",severity:"LOW",type:"OTHER",treatments:""}}},NG=async(t,e,n,r,i,l)=>{if(!zc)return console.warn("Gemini API Key is missing. Prediction skipped."),null;const c=r.map(h=>({planted:h.plantingDate,harvested:h.harvestDate,yield:h.harvestedWeight})),d=i.map(h=>({temp:h.temperature,salinity:h.salinity,date:h.date})),f=`
        Predict harvest date and yield for a seaweed cycle.
        Language: ${l==="fr"?"French":"English"}
        
        Current Cycle: Planted ${t.plantingDate}, Type ${n.name}, Initial Weight ${t.initialWeight}kg.
        Historical Data: ${JSON.stringify(c.slice(0,10))}
        Recent Weather: ${JSON.stringify(d.slice(0,5))}
        
        Return JSON with:
        - predictedHarvestDateStart (YYYY-MM-DD)
        - predictedHarvestDateEnd (YYYY-MM-DD)
        - predictedYieldKgMin (number)
        - predictedYieldKgMax (number)
        - confidenceScore (0.0 to 1.0)
        - reasoning (string)
    `;try{const h=await Dh.models.generateContent({model:"gemini-3-pro-preview",contents:f,config:{responseMimeType:"application/json",responseSchema:{type:_n.OBJECT,properties:{predictedHarvestDateStart:{type:_n.STRING},predictedHarvestDateEnd:{type:_n.STRING},predictedYieldKgMin:{type:_n.NUMBER},predictedYieldKgMax:{type:_n.NUMBER},confidenceScore:{type:_n.NUMBER},reasoning:{type:_n.STRING}}}}});return JSON.parse(h.text||"{}")}catch(h){return console.error("Gemini harvest prediction failed",h),null}},SG=async(t,e)=>{const n=`
        Analyze monthly production report data.
        Language: ${e==="fr"?"French":"English"}
        Data: ${JSON.stringify(t).substring(0,2e3)}
        
        Highlight top performers, underperforming batches, and duration trends. Use "###" for headings.
    `;return ws(n)},_G=async(t,e,n)=>{const r=`
        Analyze credit report.
        Language: ${n==="fr"?"French":"English"}
        Summary: ${JSON.stringify(e)}
        
        Discuss credit usage trends and top borrowers. Use "###" for headings.
    `;return ws(r)},wG=async(t,e,n)=>{const r=`
        Analyze inventory report.
        Language: ${n==="fr"?"French":"English"}
        Summary: ${JSON.stringify(e)}
        
        Discuss stock composition and value distribution. Use "###" for headings.
    `;return ws(r)},TG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de donnes agricoles. Analysez les donnes JSON fournies qui correspondent au tableau "Aperu Gnral de la Ferme".
        
        INSTRUCTIONS STRICTES :
        1. Ne donnez PAS de conseils gnraux sur l'agriculture.
        2. Ne parlez QUE des chiffres prsents dans les donnes. Assumez que tout champ manquant ou vide a une valeur de zro.
        3. Interprtez les colonnes suivantes : 
           - Comparez le "Total Lignes  l'eau" par rapport aux "Total Lignes Rcoltes".
           - Comparez la "Production (Kg)" entre les sites s'il y en a plusieurs.
           - Analysez le "Taux de croissance moyen" : est-il cohrent avec la production ?
           - Commentez la "Prvision de production" (m1, m2, m3) : la tendance est-elle  la hausse ou  la baisse ?
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais de manire concise et factuelle.
    `;return`${JSON.stringify(t)}`,ws(n)},CG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste RH. Analysez les donnes JSON fournies correspondant au tableau "Rpartition des Salaris par Site".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les effectifs "Permanents" vs "Journaliers".
        2. Identifiez quel site a la masse salariale ("Montant du mois") la plus leve.
        3. Calculez et mentionnez le cot moyen par employ si pertinent bas sur les totaux.
        4. Ne faites aucune supposition extrieure aux chiffres fournis. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},EG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de stock. Analysez les donnes JSON fournies correspondant au tableau "Stocks sur Sites".
        
        INSTRUCTIONS STRICTES :
        1. Pour chaque site/type d'algue, comparez le "Stock Ouverture" au "Stock Fermeture". Le stock a-t-il augment ou diminu ?
        2. Analysez les volumes d'"Entres" (rcoltes) par rapport aux "Sorties" (transferts/ventes).
        3. Signalez tout site o le stock de fermeture semble anormalement lev par rapport aux sorties (accumulation).
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},IG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste logistique. Analysez les donnes JSON fournies correspondant au tableau "Stock Magasin de Presse".
        
        INSTRUCTIONS STRICTES :
        1. Distinguez clairement les "Algues en Vrac" (matire premire) des "Algues Presses" (produit fini).
        2. Commentez le taux de transformation : les sorties de Vrac correspondent-elles aux entres de Press (approximativement) ?
        3. Analysez le stock final de balles prtes  l'export.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},jG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste export. Analysez les donnes JSON fournies correspondant au tableau "Liste des Exportations Ralises".
        
        INSTRUCTIONS STRICTES :
        1. Rsumez le volume total (Kg) et la valeur totale exporte sur la priode.
        2. Comparez ces chiffres aux totaux de l'anne (si fournis).
        3. Mentionnez les principales destinations ou clients bass sur les colonnes "Destinataire" et "Facture N".
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},AG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de production. Analysez les donnes JSON fournies correspondant  la matrice "Production Mensuelle par Site".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez le mois ayant la plus forte production (Kg) et celui avec la plus faible.
        2. Observez la tendance des "Taux de croissance (%)" au fil des mois : y a-t-il une saisonnalit visible ?
        3. Comparez la performance relative des diffrents sites sur les 3 derniers mois affichs.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},kG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste financier. Analysez les donnes JSON fournies correspondant au tableau "Situation des Crdits".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les colonnes du "Mois Prcdent" avec celles du "Mois En Cours" (Priode actuelle).
        2. Le "Solde Crdits" a-t-il augment ou diminu ?
        3. Analysez le ratio entre "Total Remboursements" et l'encours de crdit. Le recouvrement est-il efficace sur cette priode ?
        4. Ne citez que les chiffres du tableau. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},DG=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de performance. Analysez les donnes JSON fournies correspondant au tableau "Statistique Individuelle des Fermiers".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez les 3 fermiers ayant la plus grosse production (Kg) sur la priode la plus rcente (colonne la plus  droite).
        2. Reprez les fermiers ayant des lignes plantes ("P") mais aucune rcolte ("R") ou une production trs faible ("Kg"), signalant un problme potentiel.
        3. Commentez la tendance gnrale : la majorit des fermiers sont-ils en phase de plantation ou de rcolte ?
        4. Ne faites aucune supposition ou conseil. Basez-vous uniquement sur les chiffres. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,ws(n)},Dy=({children:t,content:e,className:n})=>s.jsxs("div",{className:`relative group flex items-center ${n}`,children:[t,s.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs p-3 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-20",children:[e,s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-900 dark:border-t-black"})]})]}),yE=({isOpen:t,onClose:e,operationToEdit:n})=>{const{t:r}=_e(),{sites:i,getFarmersBySite:l,modules:c,seaweedTypes:d,employees:f,serviceProviders:h,startCultivationFromCuttings:m,updateCuttingOperation:x,cultivationCycles:g}=qe(),{settings:N}=Ke(),T=S.useCallback(()=>{var q,z,J,Y,G,B;if(n){const Q=g.find(re=>re.cuttingOperationId===n.id),K=c.find(re=>{var H;return re.id===((H=n.moduleCuts[0])==null?void 0:H.moduleId)});return{serviceProviderId:n.serviceProviderId,siteId:n.siteId,date:n.date,plantingDate:(Q==null?void 0:Q.plantingDate)||n.date,lines:String(((q=n.moduleCuts[0])==null?void 0:q.linesCut)||""),initialWeight:String((Q==null?void 0:Q.initialWeight)||""),seaweedTypeId:n.seaweedTypeId,pricePerLine:String(n.unitPrice),beneficiaryFarmerId:n.beneficiaryFarmerId||(K==null?void 0:K.farmerId)||"",zoneId:(K==null?void 0:K.zoneId)||"",moduleId:(K==null?void 0:K.id)||""}}const U=new Date().toISOString().split("T")[0];return{serviceProviderId:((z=h[0])==null?void 0:z.id)||"",siteId:((J=i[0])==null?void 0:J.id)||"",date:U,plantingDate:U,lines:"",initialWeight:"",seaweedTypeId:((Y=d[0])==null?void 0:Y.id)||"",pricePerLine:"",beneficiaryFarmerId:"",zoneId:((B=(G=i.find(Q=>{var K;return Q.id===(((K=i[0])==null?void 0:K.id)||"")}))==null?void 0:G.zones[0])==null?void 0:B.id)||"",moduleId:""}},[n,i,h,d,g,c]),[C,w]=S.useState(T()),[E,D]=S.useState({});S.useEffect(()=>{t&&w(T())},[t,T]);const I=S.useMemo(()=>{var U;return((U=i.find(q=>q.id===C.siteId))==null?void 0:U.zones)||[]},[i,C.siteId]),k=S.useMemo(()=>l(C.siteId),[l,C.siteId]),M=S.useMemo(()=>c.filter(U=>{var J;if(U.siteId!==C.siteId||C.zoneId&&U.zoneId!==C.zoneId)return!1;const q=U.statusHistory||[],z=q.length>0?q[q.length-1].status:"FREE";return n&&U.id===((J=n.moduleCuts[0])==null?void 0:J.moduleId)?!0:z==="FREE"}),[c,C.siteId,C.zoneId,n]),j=S.useMemo(()=>{const U=parseFloat(C.lines),q=parseFloat(C.pricePerLine);return!isNaN(U)&&!isNaN(q)?U*q:0},[C.lines,C.pricePerLine]),O=U=>{const q=i.find(z=>z.id===U);w(z=>{var J;return{...z,siteId:U,zoneId:((J=q==null?void 0:q.zones[0])==null?void 0:J.id)||"",beneficiaryFarmerId:"",moduleId:""}})},A=S.useCallback(()=>{const U={};return C.serviceProviderId||(U.serviceProviderId=r("validationRequired")),C.siteId||(U.siteId=r("validationRequired")),C.date||(U.date=r("validationRequired")),C.plantingDate||(U.plantingDate=r("validationRequired")),new Date(C.plantingDate)<new Date(C.date)&&(U.plantingDate=r("validationPlantingDateAfterOperation")),(!C.lines||parseFloat(C.lines)<=0)&&(U.lines=r("validationPositiveNumber")),(!C.initialWeight||parseFloat(C.initialWeight)<=0)&&(U.initialWeight=r("validationPositiveNumber")),C.seaweedTypeId||(U.seaweedTypeId=r("validationRequired")),(!C.pricePerLine||parseFloat(C.pricePerLine)<0)&&(U.pricePerLine=r("validationNonNegative")),C.beneficiaryFarmerId||(U.beneficiaryFarmerId=r("validationRequired")),C.zoneId||(U.zoneId=r("validationRequired")),C.moduleId||(U.moduleId=r("validationRequired")),U},[C,r]);S.useEffect(()=>{D(A())},[C,A]);const F=U=>{U.preventDefault();const q=A();if(Object.keys(q).length>0){D(q);return}const z=c.find(J=>J.id===C.moduleId);if(n){const J={date:C.date,siteId:C.siteId,serviceProviderId:C.serviceProviderId,moduleCuts:[{moduleId:C.moduleId,linesCut:parseFloat(C.lines)}],unitPrice:parseFloat(C.pricePerLine),totalAmount:j,notes:r("notes_plantingOperationForModule").replace("{code}",(z==null?void 0:z.code)||""),seaweedTypeId:C.seaweedTypeId,beneficiaryFarmerId:C.beneficiaryFarmerId},Y={...n,...J},G={[C.moduleId]:parseFloat(C.initialWeight)};x(Y,G,C.plantingDate)}else{const J={date:C.date,siteId:C.siteId,serviceProviderId:C.serviceProviderId,moduleCuts:[{moduleId:C.moduleId,linesCut:parseFloat(C.lines)}],unitPrice:parseFloat(C.pricePerLine),totalAmount:j,isPaid:!1,notes:r("notes_plantingOperationForModule").replace("{code}",(z==null?void 0:z.code)||""),seaweedTypeId:C.seaweedTypeId},Y={moduleId:C.moduleId,seaweedTypeId:C.seaweedTypeId,plantingDate:C.plantingDate,status:Xe.PLANTED,initialWeight:parseFloat(C.initialWeight),linesPlanted:parseFloat(C.lines)};m(J,Y,C.beneficiaryFarmerId)}e()},P=Object.keys(E).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:r(n?"editCuttingOperation":"newPlanting"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:F,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:r("serviceProvider"),value:C.serviceProviderId,onChange:U=>w(q=>({...q,serviceProviderId:U.target.value})),error:E.serviceProviderId,required:!0,children:[s.jsx("option",{value:"",children:r("selectProvider")}),h.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsx(de,{label:r("dateOperation"),type:"date",value:C.date,onChange:U=>w(q=>({...q,date:U.target.value})),error:E.date,required:!0}),s.jsx(de,{label:r("pricePerLine"),type:"number",step:"any",value:C.pricePerLine,onChange:U=>w(q=>({...q,pricePerLine:U.target.value})),error:E.pricePerLine,required:!0})]}),s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("detailsModule")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:r("site"),value:C.siteId,onChange:U=>O(U.target.value),error:E.siteId,required:!0,children:[s.jsx("option",{value:"",children:r("selectSite")}),i.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsxs(ke,{label:r("zonePlantation"),value:C.zoneId,onChange:U=>w(q=>({...q,zoneId:U.target.value})),disabled:!C.siteId,error:E.zoneId,required:!0,children:[s.jsx("option",{value:"",children:r("selectZone")}),I.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsxs(ke,{label:r("numModule"),value:C.moduleId,onChange:U=>w(q=>({...q,moduleId:U.target.value})),disabled:!C.zoneId,error:E.moduleId,required:!0,children:[s.jsx("option",{value:"",children:r("selectAModule")}),M.map(U=>s.jsx("option",{value:U.id,children:U.code},U.id))]}),s.jsxs(ke,{label:r("seaweedType"),value:C.seaweedTypeId,onChange:U=>w(q=>({...q,seaweedTypeId:U.target.value})),error:E.seaweedTypeId,required:!0,children:[s.jsx("option",{value:"",children:r("selectType")}),d.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsx(de,{label:r("nombreLignesCoupees"),type:"number",value:C.lines,onChange:U=>w(q=>({...q,lines:U.target.value})),error:E.lines,required:!0}),s.jsx(de,{label:r("poidsInitialLignes"),type:"number",step:"any",value:C.initialWeight,onChange:U=>w(q=>({...q,initialWeight:U.target.value})),error:E.initialWeight,required:!0}),s.jsxs(ke,{label:r("fermierBeneficiaire"),value:C.beneficiaryFarmerId,onChange:U=>w(q=>({...q,beneficiaryFarmerId:U.target.value})),disabled:!C.siteId,error:E.beneficiaryFarmerId,required:!0,children:[s.jsx("option",{value:"",children:r("selectFarmer")}),k.map(U=>s.jsx("option",{value:U.id,children:`${U.firstName} ${U.lastName}`},U.id))]}),s.jsx(de,{label:r("plantingDate"),type:"date",value:C.plantingDate,onChange:U=>w(q=>({...q,plantingDate:U.target.value})),error:E.plantingDate,required:!0})]})]}),s.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg text-right",children:[r("valeurBouturage"),": ",Ae(j,N.localization)]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{type:"submit",disabled:P,children:r("save")})]})]})})},D_=t=>{if(!t||t==="rgba(0, 0, 0, 0)"||t==="transparent"||t==="inherit")return;const e=t.match(/\d+/g);if(!e||e.length<3)return;const[n,r,i]=e.map(Number),l=c=>c.toString(16).padStart(2,"0");return`FF${l(n)}${l(r)}${l(i)}`.toUpperCase()};function xE(t){if(!t)return"";const e=t.trim();if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(/^-?\d+(\.\d+)?%$/.test(e))return parseFloat(e)/100;const n=e.replace(/^[^\d\-\.,]+/,"").replace(/[^\d]+$/,"").replace(/\s/g,"");if(!n)return e;let r;if(/^-?\d+(\.\d+)?$/.test(n))r=parseFloat(n);else if(/^-?\d+(,\d+)?$/.test(n))r=parseFloat(n.replace(",","."));else{const i=n.replace(/,/g,"");if(!isNaN(Number(i))&&i.includes("."))r=parseFloat(i);else{const l=n.replace(/\./g,"").replace(",",".");isNaN(Number(l))||(r=parseFloat(l))}}return r!==void 0&&!isNaN(r)?r:e}const Mo=t=>{var e;return((e=t.innerText)==null?void 0:e.trim())||""};function vE(t){var r;const e=[];if(t.classList.contains("no-print")||t.style.display==="none")return[];if(t.tagName==="HEADER")return[];if(t.tagName==="SCRIPT"||t.tagName==="STYLE"||t.tagName==="BUTTON")return[];if(t.tagName==="TABLE"||t.classList.contains("grid")||t.classList.contains("prose")||/^H[1-6]$/.test(t.tagName))return[t];const n=Array.from(t.children);if(n.length>0)for(const i of n)e.push(...vE(i));else{const i=(r=t.innerText)==null?void 0:r.trim();i&&(t.tagName==="P"||t.tagName==="DIV"||t.tagName==="SPAN")&&i.length>1&&e.push(t)}return e}function RG(t,e,n){const r=t.getCell(e,n);return r.isMerged&&r.master.address!==r.address}function MG(t,e,n){let r=n;return[e.querySelector("thead"),e.querySelector("tbody"),e.querySelector("tfoot")].forEach(l=>{if(!l)return;Array.from(l.querySelectorAll("tr")).forEach(d=>{let f=1;Array.from(d.querySelectorAll("th, td")).forEach(m=>{const x=m,g=Mo(x),N=parseInt(x.getAttribute("colspan")||"1"),T=parseInt(x.getAttribute("rowspan")||"1");for(;RG(t,r,f);)f++;const C=t.getCell(r,f);let w=g;const E=x.tagName==="TH"||l.tagName==="THEAD";E||(w=xE(g)),C.value=w;const D=window.getComputedStyle(x),I=D_(D.backgroundColor),k=D_(D.color),M=E||D.fontWeight==="700"||D.fontWeight==="bold",j=D.textAlign;if(E)C.font={bold:!0,color:{argb:"FFFFFFFF"}},C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},C.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},C.alignment={horizontal:"center",vertical:"middle",wrapText:!0};else{C.font={color:{argb:k||"FF000000"},bold:M},I&&I!=="FFFFFFFF"&&(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:I}}),C.border={top:{style:"thin",color:{argb:"FFD9D9D9"}},left:{style:"thin",color:{argb:"FFD9D9D9"}},bottom:{style:"thin",color:{argb:"FFD9D9D9"}},right:{style:"thin",color:{argb:"FFD9D9D9"}}};let O=j==="center"?"center":j==="right"?"right":"left";typeof w=="number"&&j!=="center"&&(O="right"),C.alignment={horizontal:O,vertical:"middle",wrapText:!0}}if(N>1||T>1)try{t.mergeCells(r,f,r+T-1,f+N-1)}catch(O){console.warn("Merge conflict in Excel export",O)}f+=N}),r++})}),r}function PG(t,e,n){const r=Array.from(e.children);let i=n;if(r.length>0&&r.length<=4){let l=1;return r.forEach(c=>{const d=Mo(c).split(`
`).filter(m=>m.trim()),f=t.getCell(i,l);f.value=d[0],f.font={color:{argb:"FF7F7F7F"},italic:!0};const h=t.getCell(i+1,l);h.value=xE(d[1]||""),h.font={bold:!0,size:12},h.alignment={horizontal:"left"},l+=3}),i+3}return r.forEach(l=>{const c=Mo(l),d=t.getCell(i,1);d.value=c,d.alignment={wrapText:!0},i++}),i}function OG(t,e,n){const r=Mo(e);if(!r)return n;const i=t.getCell(n,1);return i.value=r,e.tagName==="H3"||e.tagName==="H4"||e.classList.contains("font-bold")?i.font={bold:!0,size:11,color:{argb:"FF4472C4"}}:i.alignment={wrapText:!0},t.mergeCells(n,1,n,12),n+1}const LG=async(t,e)=>{const n=document.getElementById("printable-area");if(!n){console.error("No printable area found");return}const r=new ExcelJS.Workbook;r.creator="AlgaManage",r.created=new Date;const i=n.querySelectorAll(".report-page-landscape, .print-page");if(i.length===0){alert("No report content found to export.");return}for(let h=0;h<i.length;h++){const m=i[h];let x=`Page ${h+1}`;const g=m.querySelector("h2")||m.querySelector("h3");if(g){const M=Mo(g).replace(/[\\/?*:[\]]/g," ").substring(0,30);M&&(x=M)}let N=x,T=1;for(;r.getWorksheet(N);)N=`${x} (${T++})`;const C=r.addWorksheet(N,{views:[{showGridLines:!1,zoomScale:85}],pageSetup:{orientation:"landscape",paperSize:9,fitToPage:!0}});C.columns=Array.from({length:50},()=>({width:14})),C.getColumn(1).width=20;let w=1;const E=m.querySelector("header");E&&(Mo(E).split(`
`).filter(j=>j.trim()).forEach(j=>{const A=C.getRow(w).getCell(1);A.value=j,A.font={bold:!0,size:12,color:{argb:"FF2F5597"}},C.mergeCells(w,1,w,12),w++}),w++);const I=m.firstElementChild||m,k=vE(I);for(const M of k)M.tagName==="TABLE"?(w=MG(C,M,w),w+=2):M.classList.contains("grid")?(w=PG(C,M,w),w+=2):w=OG(C,M,w)}const l=await r.xlsx.writeBuffer(),c=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=`${e}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(d)},Ko=async(t,e,n,r="Sheet1")=>{const i=new ExcelJS.Workbook;i.creator="AlgaManage",i.created=new Date;const l=i.addWorksheet(r);l.columns=e.map(x=>({header:x.header,key:x.key,width:x.width||15}));const c=l.getRow(1);c.font={bold:!0,color:{argb:"FFFFFFFF"}},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},t.forEach(x=>{l.addRow(x)});const d=await i.xlsx.writeBuffer(),f=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(f),m=document.createElement("a");m.href=h,m.download=`${n}.xlsx`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(h)},bE=async(t,e)=>{const n=new ExcelJS.Workbook;n.creator="AlgaManage",n.created=new Date,t.forEach(d=>{const f=n.addWorksheet(d.sheetName);f.columns=d.columns.map(m=>({header:m.header,key:m.key,width:m.width||15}));const h=f.getRow(1);h.font={bold:!0,color:{argb:"FFFFFFFF"}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},d.data.forEach(m=>{f.addRow(m)})});const r=await n.xlsx.writeBuffer(),i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`${e}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)},FG=({status:t})=>{const{t:e}=_e();if(t==="normal")return null;const n=t==="nearing"?"text-yellow-500":"text-red-600",r=e(t==="nearing"?"nearingHarvest":"overdueHarvest");return s.jsxs("div",{className:"relative group flex justify-center",children:[s.jsx(te,{name:"AlertTriangle",className:`w-5 h-5 ${n}`}),s.jsx("span",{className:"absolute bottom-full mb-2 w-max px-2 py-1 text-xs text-white bg-gray-900 rounded-md opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:r})]})},Ry=({initialFilters:t,pageTitle:e})=>{var Da;const{t:n,language:r}=_e(),{cultivationCycles:i,modules:l,seaweedTypes:c,farmers:d,sites:f,periodicTests:h,updateCultivationCycle:m,deleteCultivationCycle:x,incidentTypes:g}=qe(),[N,T]=S.useState(!1),[C,w]=S.useState(!1),[E,D]=S.useState(null),[I,k]=S.useState(!1),[M,j]=S.useState(null),[O,A]=S.useState({key:"module.code",direction:"ascending"}),[F,P]=S.useState(!1),[U,q]=S.useState(null),[z,J]=S.useState(!1),[Y,G]=S.useState(null),[B,Q]=S.useState({date:"",notes:"",linesHarvested:"",harvestedWeight:"",cuttingsWeight:""}),[K,re]=S.useState(""),[H,ae]=S.useState({siteId:(t==null?void 0:t.siteId)||"all",seaweedTypeId:(t==null?void 0:t.seaweedTypeId)||"all"}),[ue,Ne]=wg(),le=ue.get("highlight"),ne=S.useRef(new Map),[Te,fe]=S.useState({}),[Z,ee]=S.useState(null),{settings:xe}=Ke();S.useEffect(()=>{if(le){ee(le);const Ge=ne.current.get(le);Ge&&(Ge.scrollIntoView({behavior:"smooth",block:"center"}),Ge.classList.add("highlight-row"),setTimeout(()=>{Ge.classList.remove("highlight-row")},2e3)),Ne({},{replace:!0})}},[le,Ne]);const Oe=(Ge,Je)=>{ae(Ve=>({...Ve,[Ge]:Je}))},De=S.useCallback(()=>{ae({siteId:(t==null?void 0:t.siteId)||"all",seaweedTypeId:(t==null?void 0:t.seaweedTypeId)||"all"})},[t]),Re=S.useMemo(()=>{const Ge=new Date;Ge.setHours(0,0,0,0);let Je=i.map(Ve=>{let jt="normal";const rt=new Date(Ve.plantingDate);rt.setHours(0,0,0,0);const Ft=Ve.harvestDate?new Date(Ve.harvestDate):Ge;Ft.setHours(0,0,0,0);const Ln=Math.ceil((Ft.getTime()-rt.getTime())/(1e3*60*60*24));if(Ve.status===Xe.PLANTED||Ve.status===Xe.GROWING){const ln=(Ge.getTime()-rt.getTime())/864e5;ln>zr?jt="overdue":ln>zr-Eg&&(jt="nearing")}let Fn;if(Ve.harvestDate&&Ve.plantingDate&&Ve.harvestedWeight&&Ve.initialWeight&&Ve.harvestedWeight>0&&Ve.initialWeight>0){const ni=(new Date(Ve.harvestDate).getTime()-new Date(Ve.plantingDate).getTime())/(1e3*60*60*24),sr=Ch(Ve.initialWeight,Ve.harvestedWeight,ni);sr!==null&&(Fn=sr)}const Tn=l.find(ln=>ln.id===Ve.moduleId),nr=Tn?d.find(ln=>ln.id===Tn.farmerId):void 0;return{cycle:Ve,module:Tn,seaweedType:c.find(ln=>ln.id===Ve.seaweedTypeId),farmer:nr,alertStatus:jt,growthRate:Fn,age:Ln}});return H.siteId!=="all"&&(Je=Je.filter(Ve=>{var jt;return((jt=Ve.module)==null?void 0:jt.siteId)===H.siteId})),H.seaweedTypeId!=="all"&&(Je=Je.filter(Ve=>Ve.cycle.seaweedTypeId===H.seaweedTypeId)),Je.sort((Ve,jt)=>{const rt=(Fn,Tn)=>{if(Object.prototype.hasOwnProperty.call(Fn,Tn))return Fn[Tn];if(Object.prototype.hasOwnProperty.call(Fn.cycle,Tn))return Fn.cycle[Tn];const nr=Tn.split(".");let ln=Fn;for(const Ts of nr){if(ln==null)return;ln=ln[Ts]}return ln},Ft=rt(Ve,O.key),Ln=rt(jt,O.key);return Ft==null?1:Ln==null?-1:typeof Ft=="string"&&typeof Ln=="string"?O.direction==="ascending"?Ft.localeCompare(Ln):Ln.localeCompare(Ft):Ft<Ln?O.direction==="ascending"?-1:1:Ft>Ln?O.direction==="ascending"?1:-1:0}),Je},[i,l,c,d,O,H]),$e=S.useCallback(async Ge=>{const Je=Ge.cycle.id;fe(rt=>({...rt,[Je]:{isLoading:!0,error:null,result:null}}));const Ve=i.filter(rt=>rt.seaweedTypeId===Ge.cycle.seaweedTypeId&&rt.id!==Je&&rt.harvestDate),jt=h.filter(rt=>{var Ft;return rt.siteId===((Ft=Ge.module)==null?void 0:Ft.siteId)}).sort((rt,Ft)=>new Date(Ft.date).getTime()-new Date(rt.date).getTime());if(!Ge.module||!Ge.seaweedType){fe(rt=>({...rt,[Je]:{result:null,isLoading:!1,error:n("predictionError")}}));return}try{const rt=await NG(Ge.cycle,Ge.module,Ge.seaweedType,Ve,jt,r);fe(rt?Ft=>({...Ft,[Je]:{result:rt,isLoading:!1,error:null}}):Ft=>({...Ft,[Je]:{result:null,isLoading:!1,error:n("predictionError")}}))}catch(rt){console.error("Prediction failed unexpectedly:",rt),fe(Ft=>({...Ft,[Je]:{result:null,isLoading:!1,error:n("predictionError")}}))}},[i,h,r,n]),He=Ge=>{let Je="ascending";O.key===Ge&&O.direction==="ascending"&&(Je="descending"),A({key:Ge,direction:Je})},Se=Ge=>O.key!==Ge?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):O.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Le=(Ge=null)=>{D(Ge),T(!0)},be=()=>{D(null),T(!1),w(!1)},ye=Ge=>{j(Ge),k(!0)},Fe=()=>{M&&x(M),k(!1),j(null)},et=Ge=>{q(Ge),P(!0)},Lt=Ge=>{m(Ge),be()},ut=async()=>{const Ge=Re.map(Ve=>{var jt,rt,Ft;return{moduleCode:((jt=Ve.module)==null?void 0:jt.code)||n("unknown"),farmerName:Ve.farmer?`${Ve.farmer.firstName} ${Ve.farmer.lastName}`:n("unknown"),seaweedType:((rt=Ve.seaweedType)==null?void 0:rt.name)||n("unknown"),plantingDate:Ve.cycle.plantingDate,initialWeight:Ve.cycle.initialWeight||0,linesPlanted:Ve.cycle.linesPlanted||((Ft=Ve.module)==null?void 0:Ft.lines)||0,age:Ve.age,status:n(`status_${Ve.cycle.status}`),harvestDate:Ve.cycle.harvestDate||"-",harvestedWeight:Ve.cycle.harvestedWeight||0,cuttingsWeight:Ve.cycle.cuttingsTakenAtHarvestKg||0,netWeight:(Ve.cycle.harvestedWeight||0)-(Ve.cycle.cuttingsTakenAtHarvestKg||0),linesHarvested:Ve.cycle.linesHarvested||0,growthRate:Ve.growthRate?`${Ve.growthRate.toFixed(2)}%`:"-",notes:Ve.cycle.processingNotes||""}}),Je=[{header:n("moduleCode"),key:"moduleCode",width:15},{header:n("farmer"),key:"farmerName",width:20},{header:n("seaweedType"),key:"seaweedType",width:15},{header:n("plantingDate"),key:"plantingDate",width:15},{header:`${n("initialWeight")} (Kg)`,key:"initialWeight",width:15},{header:n("linesPlanted"),key:"linesPlanted",width:15},{header:n("ageInDays"),key:"age",width:10},{header:n("status"),key:"status",width:15},{header:n("harvestDate"),key:"harvestDate",width:15},{header:`${n("harvestedWeight")} (Kg)`,key:"harvestedWeight",width:15},{header:`${n("cuttingsWeightKg")} (Kg)`,key:"cuttingsWeight",width:15},{header:`${n("wetProduction")} (Kg)`,key:"netWeight",width:15},{header:n("linesHarvested"),key:"linesHarvested",width:15},{header:n("growthRate"),key:"growthRate",width:15},{header:n("notes"),key:"notes",width:30}];await Ko(Ge,Je,`CultivationCycles_${new Date().toISOString().split("T")[0]}`,"Cultivation Cycles")},$t=Ge=>{var Ve;G(Ge);let Je=new Date().toISOString().split("T")[0];if(Ge.cycle.plantingDate){const jt=new Date(Ge.cycle.plantingDate),rt=new Date(jt);rt.setDate(jt.getDate()+zr),Je=rt.toISOString().split("T")[0]}Q({date:Je,notes:"Harvest for maturity",linesHarvested:String(Ge.cycle.linesPlanted||((Ve=Ge.module)==null?void 0:Ve.lines)||""),harvestedWeight:"",cuttingsWeight:""}),re(""),J(!0)},Pt=()=>{const Ge=B.notes==="Other",Je=parseFloat(B.harvestedWeight),Ve=parseFloat(B.cuttingsWeight);if(Y&&B.date&&(!Ge||K.trim())&&B.linesHarvested&&!isNaN(Je)&&Je>0&&B.cuttingsWeight!==""&&!isNaN(Ve)&&Ve>=0){const jt=Ge?K:B.notes;m({...Y.cycle,status:Xe.HARVESTED,harvestDate:B.date,processingNotes:jt,linesHarvested:Number(B.linesHarvested),harvestedWeight:Je,cuttingsTakenAtHarvestKg:Ve}),J(!1),G(null)}},St=({sortKey:Ge,label:Je,className:Ve=""})=>s.jsx("th",{className:`p-3 ${Ve}`,children:s.jsxs("button",{onClick:()=>He(Ge),className:`group flex items-center gap-2 w-full whitespace-nowrap ${Ve.includes("text-right")?"justify-end":""}`,children:[Je," ",Se(Ge)]})}),on=parseFloat(B.harvestedWeight)||0,tr=parseFloat(B.cuttingsWeight)||0,gr=on-tr;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:e||n("cultivationCycleManagementTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:ut,children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),n("exportExcel")]}),s.jsxs(se,{onClick:()=>w(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),n("addCycle")]})]})]}),s.jsx(ze,{className:"mb-6",title:n("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:n("site"),value:H.siteId,onChange:Ge=>Oe("siteId",Ge.target.value),disabled:!!(t!=null&&t.siteId),children:[s.jsx("option",{value:"all",children:n("allSites")}),f.map(Ge=>s.jsx("option",{value:Ge.id,children:Ge.name},Ge.id))]}),s.jsxs(ke,{label:n("seaweedType"),value:H.seaweedTypeId,onChange:Ge=>Oe("seaweedTypeId",Ge.target.value),disabled:!!(t!=null&&t.seaweedTypeId),children:[s.jsx("option",{value:"all",children:n("allSeaweedTypes")}),c.map(Ge=>s.jsx("option",{value:Ge.id,children:Ge.name},Ge.id))]}),s.jsx(se,{variant:"secondary",onClick:De,className:"h-[42px] w-full",children:n("clearFilters")})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-12"}),s.jsx("th",{className:"p-3 w-16 text-center",children:n("alerts")}),s.jsx(St,{sortKey:"module.code",label:n("module")}),s.jsx(St,{sortKey:"farmer.firstName",label:n("farmer")}),s.jsx(St,{sortKey:"seaweedType.name",label:n("seaweedType")}),s.jsx(St,{sortKey:"plantingDate",label:n("plantingDate")}),s.jsx(St,{sortKey:"age",label:n("ageInDays"),className:"text-right"}),s.jsx(St,{sortKey:"harvestDate",label:n("harvestDate")}),s.jsx(St,{sortKey:"status",label:n("status")}),s.jsx("th",{className:"p-3 text-right",children:n("actions")})]})}),s.jsx("tbody",{children:Re.map(Ge=>{const{cycle:Je,module:Ve,seaweedType:jt,farmer:rt,alertStatus:Ft,age:Ln}=Ge,Fn=Z===Je.id;return s.jsxs(gt.Fragment,{children:[s.jsxs("tr",{ref:Tn=>{Tn?ne.current.set(Je.id,Tn):ne.current.delete(Je.id)},className:`border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 ${Je.id===le?"highlight-row":""}`,children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ee(Fn?null:Je.id),"aria-expanded":Fn,"aria-controls":`details-${Je.id}`,children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${Fn?"rotate-90":""}`})})}),s.jsx("td",{className:"p-3 text-center",children:s.jsx(FG,{status:Ft})}),s.jsx("td",{className:"p-3 font-mono font-semibold whitespace-nowrap",children:(Ve==null?void 0:Ve.code)||n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:rt?`${rt.firstName} ${rt.lastName}`:n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:(jt==null?void 0:jt.name)||n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:Je.plantingDate}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ln>=50?s.jsx(Dy,{content:n("exactAge").replace("{days}",String(Ln)),children:s.jsx("span",{className:"cursor-help border-b border-dotted",children:"+50"})}):Ln}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:Je.harvestDate||"-"}),s.jsx("td",{className:"p-3",children:s.jsx(An,{status:Je.status})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[(Je.status===Xe.PLANTED||Je.status===Xe.GROWING)&&s.jsxs(se,{variant:"primary",onClick:()=>$t(Ge),children:[s.jsx(te,{name:"Scissors",className:"w-4 h-4"}),n("harvest")]}),s.jsxs(se,{variant:"ghost",onClick:()=>et(Ge),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"}),n("history")]}),s.jsx(se,{variant:"ghost",onClick:()=>Le(Je),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>ye(Je.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]}),Fn&&s.jsx("tr",{id:`details-${Je.id}`,children:s.jsx("td",{colSpan:10,className:"p-0",children:s.jsx(UG,{info:Ge,prediction:Te[Je.id]||{isLoading:!1,error:null,result:null},onPredict:()=>$e(Ge)})})})]},Je.id)})})]})})}),C&&s.jsx(yE,{isOpen:C,onClose:be}),N&&s.jsx(BG,{isOpen:N,onClose:be,onSave:Lt,cycle:E}),I&&s.jsx(Qt,{isOpen:I,onClose:()=>k(!1),onConfirm:Fe,title:n("confirmDeleteTitle"),message:n("confirmDeleteCycle")}),F&&U&&U.module&&s.jsx(WL,{isOpen:F,onClose:()=>P(!1),cycle:U.cycle,module:U.module}),z&&Y&&s.jsx(Qt,{isOpen:z,onClose:()=>J(!1),onConfirm:Pt,title:`${n("confirmHarvestTitle")}: ${(Da=Y.module)==null?void 0:Da.code}`,message:s.jsxs("div",{className:"space-y-4 text-left",children:[s.jsx("p",{children:n("confirmHarvestMessage")}),s.jsx(de,{label:n("harvestDate"),type:"date",value:B.date,onChange:Ge=>Q(Je=>({...Je,date:Ge.target.value}))}),s.jsx(de,{label:n("harvestedWeightKg"),type:"number",value:B.harvestedWeight,onChange:Ge=>Q(Je=>({...Je,harvestedWeight:Ge.target.value}))}),s.jsx(de,{label:n("cuttingsWeightKg"),type:"number",value:B.cuttingsWeight,onChange:Ge=>Q(Je=>({...Je,cuttingsWeight:Ge.target.value}))}),s.jsx(de,{label:n("wetProduction"),type:"text",value:`${gr.toFixed(2)} kg`,disabled:!0}),s.jsx(de,{label:n("linesHarvested"),type:"number",value:B.linesHarvested,onChange:Ge=>Q(Je=>({...Je,linesHarvested:Ge.target.value}))}),s.jsxs(ke,{label:n("harvestReason"),value:B.notes,onChange:Ge=>Q(Je=>({...Je,notes:Ge.target.value})),children:[s.jsx("option",{value:"Harvest for maturity",children:n("harvestReason_maturity")}),g.map(Ge=>s.jsx("option",{value:Ge.name,children:Ge.name},Ge.id)),s.jsx("option",{value:"Other",children:n("other")})]}),B.notes==="Other"&&s.jsx(de,{label:n("other"),value:K,onChange:Ge=>re(Ge.target.value),error:K.trim()?"":n("validationReasonRequired"),placeholder:n("otherReasonPlaceholder")})]}),confirmText:n("harvest"),confirmDisabled:!B.date||!B.harvestedWeight||!B.linesHarvested||!B.cuttingsWeight||B.notes==="Other"&&!K.trim()})]})},UG=({info:t,prediction:e,onPredict:n})=>{const{t:r}=_e(),{settings:i}=Ke(),{cycle:l,growthRate:c}=t,d=l.status===Xe.PLANTED||l.status===Xe.GROWING,f=({label:h,value:m})=>s.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h}),s.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:m})]});return s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"md:col-span-2 space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("performance")}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[s.jsx(f,{label:r("initialWeight"),value:`${l.initialWeight} kg`}),s.jsx(f,{label:r("linesPlanted"),value:l.linesPlanted||"-"}),s.jsx(f,{label:r("harvestedWeight"),value:l.harvestedWeight?`${l.harvestedWeight} kg`:"-"}),s.jsx(f,{label:r("linesHarvested"),value:l.linesHarvested||"-"}),c!==void 0&&s.jsx(f,{label:`${r("growthRate")} (SGR)`,value:`${Ue(c,{...i.localization,nonMonetaryDecimals:2})}% / day`})]})]}),l.processingNotes&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("notes")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 p-2 bg-gray-100 dark:bg-gray-800 rounded",children:l.processingNotes})]})]}),s.jsx("div",{className:"md:col-span-1",children:d&&s.jsxs(ze,{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("aiPrediction")}),e.isLoading?s.jsx("div",{className:"flex justify-center items-center h-24",children:s.jsx(te,{name:"Activity",className:"animate-spin w-6 h-6 text-gray-500"})}):e.error?s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-red-500 mb-2",children:e.error}),s.jsxs(se,{onClick:n,className:"!px-2 !py-1 text-sm",children:[s.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),r("retry")]})]}):e.result?s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{label:r("predictedHarvest"),value:`${e.result.predictedHarvestDateStart}  ${e.result.predictedHarvestDateEnd}`}),s.jsx(f,{label:r("predictedYieldKg"),value:`${Ue(e.result.predictedYieldKgMin,{...i.localization,nonMonetaryDecimals:0})} - ${Ue(e.result.predictedYieldKgMax,{...i.localization,nonMonetaryDecimals:0})} kg`}),s.jsx(f,{label:r("confidence"),value:s.jsx(Dy,{content:s.jsx("div",{className:"max-w-xs",children:e.result.reasoning}),children:s.jsxs("span",{className:"font-semibold cursor-help border-b border-dotted",children:[(e.result.confidenceScore*100).toFixed(0),"%"]})})})]}):s.jsxs(se,{onClick:n,className:"w-full",children:[s.jsx(te,{name:"Bot",className:"w-5 h-5"}),r("predict")]})]})})]})},BG=({isOpen:t,onClose:e,onSave:n,cycle:r})=>{const{t:i}=_e(),{modules:l,seaweedTypes:c}=qe(),[d,f]=S.useState({moduleId:"",seaweedTypeId:"",plantingDate:"",initialWeight:"",status:Xe.PLANTED});S.useEffect(()=>{r&&f({moduleId:r.moduleId,seaweedTypeId:r.seaweedTypeId,plantingDate:r.plantingDate,initialWeight:String(r.initialWeight),status:r.status})},[r]);const h=(x,g)=>{f(N=>({...N,[x]:g}))},m=x=>{x.preventDefault(),r&&n({...r,...d,initialWeight:parseFloat(d.initialWeight)})};return s.jsx(ot,{isOpen:t,onClose:e,title:i("editCycle"),children:s.jsxs("form",{onSubmit:m,className:"space-y-4",children:[s.jsx(ke,{label:i("module"),value:d.moduleId,onChange:x=>h("moduleId",x.target.value),required:!0,disabled:!0,children:l.map(x=>s.jsx("option",{value:x.id,children:x.code},x.id))}),s.jsx(ke,{label:i("seaweedType"),value:d.seaweedTypeId,onChange:x=>h("seaweedTypeId",x.target.value),required:!0,children:c.map(x=>s.jsx("option",{value:x.id,children:x.name},x.id))}),s.jsx(de,{label:i("plantingDate"),type:"date",value:d.plantingDate,onChange:x=>h("plantingDate",x.target.value),required:!0}),s.jsx(de,{label:i("initialWeight"),type:"number",value:d.initialWeight,onChange:x=>h("initialWeight",x.target.value),required:!0}),s.jsx(ke,{label:i("status"),value:d.status,onChange:x=>h("status",x.target.value),required:!0,children:Object.values(Xe).map(x=>s.jsx("option",{value:x,children:i(`status_${x}`)},x))}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",children:i("save")})]})]})})},GG=()=>s.jsx(Ry,{}),zG=()=>{var Q;const{t,language:e}=_e(),{settings:n}=Ke(),{cultivationCycles:r,modules:i,seaweedTypes:l,farmers:c,sites:d,updateCultivationCycle:f}=qe(),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all"}),[x,g]=S.useState({key:"module.code",direction:"ascending"}),[N,T]=S.useState(!1),[C,w]=S.useState(null),[E,D]=S.useState(""),[I,k]=S.useState(""),[M,j]=S.useState(!1),[O,A]=S.useState(""),F=(K,re)=>{m(H=>({...H,[K]:re}))},P=S.useCallback(()=>{m({siteId:"all",seaweedTypeId:"all"})},[]),U=S.useMemo(()=>{if(!C||!C.cycle)return null;const{cycle:K}=C;if(K.harvestDate&&K.plantingDate&&K.harvestedWeight&&K.initialWeight&&K.harvestedWeight>0&&K.initialWeight>0){const H=(new Date(K.harvestDate).getTime()-new Date(K.plantingDate).getTime())/(1e3*60*60*24);return Ch(K.initialWeight,K.harvestedWeight,H)}return null},[C]),q=S.useMemo(()=>{let K=r.filter(re=>re.status===Xe.HARVESTED).map(re=>{const H=i.find(Ne=>Ne.id===re.moduleId),ae=H?c.find(Ne=>Ne.id===H.farmerId):void 0,ue=(re.harvestedWeight||0)-(re.cuttingsTakenAtHarvestKg||0);return{cycle:re,module:H,seaweedType:l.find(Ne=>Ne.id===re.seaweedTypeId),farmer:ae,netHarvestedWeight:ue}});return h.siteId!=="all"&&(K=K.filter(re=>{var H;return((H=re.module)==null?void 0:H.siteId)===h.siteId})),h.seaweedTypeId!=="all"&&(K=K.filter(re=>re.cycle.seaweedTypeId===h.seaweedTypeId)),K.sort((re,H)=>{const ae=(le,ne)=>{if(ne==="netHarvestedWeight")return le.netHarvestedWeight;const Te=ne.split(".");let fe=le;for(const Z of Te){if(fe==null)return;fe=fe[Z]}return fe},ue=ae(re,x.key),Ne=ae(H,x.key);return ue==null?1:Ne==null?-1:typeof ue=="string"&&typeof Ne=="string"?x.direction==="ascending"?ue.localeCompare(Ne):Ne.localeCompare(ue):ue<Ne?x.direction==="ascending"?-1:1:ue>Ne?x.direction==="ascending"?1:-1:0}),K},[r,i,l,c,h,x]),z=K=>{let re="ascending";x.key===K&&x.direction==="ascending"&&(re="descending"),g({key:K,direction:re})},J=K=>x.key!==K?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):x.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Y=({sortKey:K,label:re,className:H=""})=>s.jsx("th",{className:`p-3 ${H}`,children:s.jsxs("button",{onClick:()=>z(K),className:`group flex items-center gap-2 w-full ${H.includes("text-right")?"justify-end":""}`,children:[re," ",J(K)]})}),G=S.useCallback(async K=>{var H;w(K),D(K.cycle.harvestDate||new Date().toISOString().split("T")[0]),T(!0),j(!0),k("");const re=await xG({seaweedType:((H=K.seaweedType)==null?void 0:H.name)||t("unknown"),totalWeight:K.netHarvestedWeight||0,notes:K.cycle.processingNotes||""},e);k(re),j(!1)},[e,t]);S.useEffect(()=>{N&&(C!=null&&C.cycle.harvestDate)&&E&&new Date(E)<new Date(C.cycle.harvestDate)?A(t("validationDryingStartDate")):A("")},[N,E,C,t]);const B=()=>{C&&E&&!O&&(f({...C.cycle,status:Xe.DRYING,dryingStartDate:E}),T(!1),w(null))};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("harvestProcessingTitle")}),s.jsx(ze,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:h.siteId,onChange:K=>F("siteId",K.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),d.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:h.seaweedTypeId,onChange:K=>F("seaweedTypeId",K.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),l.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))]}),s.jsx(se,{variant:"secondary",onClick:P,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(Y,{sortKey:"module.code",label:t("module")}),s.jsx(Y,{sortKey:"farmer.firstName",label:t("farmer")}),s.jsx(Y,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(Y,{sortKey:"cycle.harvestDate",label:t("harvestDate")}),s.jsx(Y,{sortKey:"netHarvestedWeight",label:t("netHarvestedWeightKg"),className:"text-right"}),s.jsx(Y,{sortKey:"cycle.linesHarvested",label:t("linesHarvested"),className:"text-right"}),s.jsx("th",{className:"p-3",children:t("harvestReason")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[q.map(K=>{var re,H;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono font-semibold",children:((re=K.module)==null?void 0:re.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:K.farmer?`${K.farmer.firstName} ${K.farmer.lastName}`:t("unknown")}),s.jsx("td",{className:"p-3",children:((H=K.seaweedType)==null?void 0:H.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:K.cycle.harvestDate}),s.jsx("td",{className:"p-3 text-right",children:Ue(K.netHarvestedWeight,n.localization)}),s.jsx("td",{className:"p-3 text-right",children:K.cycle.linesHarvested}),s.jsx("td",{className:"p-3",children:K.cycle.processingNotes}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs(se,{variant:"primary",onClick:()=>G(K),children:[s.jsx(te,{name:"Wind",className:"w-4 h-4"}),t("startDrying")]})})]},K.cycle.id)}),q.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noHarvestedBatches")})})]})]})})}),N&&C&&s.jsx(ot,{isOpen:N,onClose:()=>T(!1),title:`${t("startDryingFor")} ${(Q=C.module)==null?void 0:Q.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:()=>T(!1),children:t("cancel")}),s.jsx(se,{variant:"primary",onClick:B,disabled:!E||!!O,children:t("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[U!==null&&s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t("growthRate")}),s.jsxs("p",{className:"text-xl font-bold",children:[Ue(U,n.localization),t("growthRateUnit")]})]}),s.jsx(de,{label:t("dryingStartDate"),type:"date",value:E,onChange:K=>D(K.target.value),required:!0,error:O}),s.jsx(ze,{title:t("geminiSuggestion"),children:M?s.jsx("p",{children:t("loading")}):s.jsx("p",{className:"whitespace-pre-wrap font-serif",children:I||t("noSuggestion")})})]})})]})},HG=()=>{var q;const{t}=_e(),{settings:e}=Ke(),{cultivationCycles:n,modules:r,seaweedTypes:i,sites:l,updateCultivationCycle:c}=qe(),[d,f]=S.useState({siteId:"all",seaweedTypeId:"all"}),[h,m]=S.useState({key:"module.code",direction:"ascending"}),[x,g]=S.useState(!1),[N,T]=S.useState(null),[C,w]=S.useState({dryingCompletionDate:"",baggingStartDate:"",actualDryWeight:""}),[E,D]=S.useState({}),I=(z,J)=>{f(Y=>({...Y,[z]:J}))},k=S.useCallback(()=>{f({siteId:"all",seaweedTypeId:"all"})},[]),M=S.useMemo(()=>{let z=n.filter(J=>J.status===Xe.DRYING).map(J=>{const Y=r.find(Q=>Q.id===J.moduleId);let G=0;if(J.dryingStartDate){const Q=new Date(J.dryingStartDate);G=Math.ceil((new Date().getTime()-Q.getTime())/864e5)}const B=(J.harvestedWeight||0)-(J.cuttingsTakenAtHarvestKg||0);return{cycle:J,module:Y,seaweedType:i.find(Q=>Q.id===J.seaweedTypeId),dryingDuration:G,netHarvestedWeight:B}});return d.siteId!=="all"&&(z=z.filter(J=>{var Y;return((Y=J.module)==null?void 0:Y.siteId)===d.siteId})),d.seaweedTypeId!=="all"&&(z=z.filter(J=>J.cycle.seaweedTypeId===d.seaweedTypeId)),z.sort((J,Y)=>{const G=(K,re)=>{const H=re.split(".");let ae=K;for(const ue of H){if(ae==null)return;ae=ae[ue]}return ae},B=G(J,h.key),Q=G(Y,h.key);return B==null?1:Q==null?-1:B<Q?h.direction==="ascending"?-1:1:B>Q?h.direction==="ascending"?1:-1:0}),z},[n,r,i,d,h]),j=z=>{let J="ascending";h.key===z&&h.direction==="ascending"&&(J="descending"),m({key:z,direction:J})},O=z=>h.key!==z?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):h.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),A=({sortKey:z,label:J,className:Y=""})=>s.jsx("th",{className:`p-3 ${Y}`,children:s.jsxs("button",{onClick:()=>j(z),className:`group flex items-center gap-2 w-full ${Y.includes("text-right")?"justify-end":""}`,children:[J," ",O(z)]})}),F=S.useCallback(z=>{T(z);let J=new Date;if(z.cycle.dryingStartDate){const G=new Date(z.cycle.dryingStartDate);G.setDate(G.getDate()+5),J=G}const Y=J.toISOString().split("T")[0];w({dryingCompletionDate:Y,baggingStartDate:Y,actualDryWeight:""}),g(!0)},[]),P=S.useCallback(()=>{if(!N)return{};const z={},J=new Date;return J.setHours(23,59,59,999),C.dryingCompletionDate?(new Date(C.dryingCompletionDate)>J&&(z.dryingCompletionDate=t("validationFutureDate")),N.cycle.dryingStartDate&&C.dryingCompletionDate<N.cycle.dryingStartDate&&(z.dryingCompletionDate=t("validationDryingCompletionDate"))):z.dryingCompletionDate=t("validationRequired"),C.baggingStartDate?(new Date(C.baggingStartDate)>J&&(z.baggingStartDate=t("validationFutureDate")),C.dryingCompletionDate&&C.baggingStartDate<C.dryingCompletionDate&&(z.baggingStartDate=t("validationBaggingStartDate"))):z.baggingStartDate=t("validationRequired"),(!C.actualDryWeight||isNaN(parseFloat(C.actualDryWeight))||parseFloat(C.actualDryWeight)<=0)&&(z.actualDryWeight=t("validationPositiveNumber")),z},[C,N,t]);S.useEffect(()=>{x&&D(P())},[C,x,P]);const U=()=>{const z=P();if(Object.keys(z).length>0){D(z);return}N&&C.dryingCompletionDate&&C.baggingStartDate&&(c({...N.cycle,status:Xe.BAGGING,dryingCompletionDate:C.dryingCompletionDate,baggingStartDate:C.baggingStartDate,actualDryWeightKg:parseFloat(C.actualDryWeight)}),g(!1),T(null))};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("dryingManagementTitle")}),s.jsx(ze,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:d.siteId,onChange:z=>I("siteId",z.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),l.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:d.seaweedTypeId,onChange:z=>I("seaweedTypeId",z.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),i.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsx(se,{variant:"secondary",onClick:k,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(A,{sortKey:"module.code",label:t("module")}),s.jsx(A,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(A,{sortKey:"cycle.harvestDate",label:t("harvestDate")}),s.jsx(A,{sortKey:"cycle.dryingStartDate",label:t("dryingStartDate")}),s.jsx(A,{sortKey:"dryingDuration",label:t("dryingDuration"),className:"text-right"}),s.jsx(A,{sortKey:"netHarvestedWeight",label:t("netHarvestedWeightKg"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[M.map(z=>{var J,Y;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono font-semibold",children:((J=z.module)==null?void 0:J.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:((Y=z.seaweedType)==null?void 0:Y.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:z.cycle.harvestDate}),s.jsx("td",{className:"p-3",children:z.cycle.dryingStartDate}),s.jsx("td",{className:"p-3 text-right",children:z.dryingDuration}),s.jsx("td",{className:"p-3 text-right",children:Ue(z.netHarvestedWeight,e.localization)}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs(se,{variant:"primary",onClick:()=>F(z),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeDrying")]})})]},z.cycle.id)}),M.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noBatchesDrying")})})]})]})})}),x&&N&&s.jsx(ot,{isOpen:x,onClose:()=>g(!1),title:`${t("completeDryingFor")} ${(q=N.module)==null?void 0:q.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:()=>g(!1),children:t("cancel")}),s.jsx(se,{variant:"primary",onClick:U,disabled:Object.keys(E).length>0,children:t("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:t("dryingStartDate"),type:"date",value:N.cycle.dryingStartDate||"",disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),s.jsx(de,{label:t("dryingCompletionDate"),type:"date",value:C.dryingCompletionDate,onChange:z=>w(J=>({...J,dryingCompletionDate:z.target.value,baggingStartDate:z.target.value})),error:E.dryingCompletionDate,required:!0}),s.jsx(de,{label:t("baggingStartDate"),type:"date",value:C.baggingStartDate,onChange:z=>w(J=>({...J,baggingStartDate:z.target.value})),error:E.baggingStartDate,required:!0}),s.jsx(de,{label:t("actualDryWeight"),type:"number",step:"any",value:C.actualDryWeight,onChange:z=>w(J=>({...J,actualDryWeight:z.target.value})),error:E.actualDryWeight,required:!0,autoFocus:!0})]})})]})},VG=({weights:t,onChange:e})=>{const{t:n}=_e(),[r,i]=S.useState([]);S.useEffect(()=>{const c=[...t.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[t]);const l=(c,d)=>{const f=[...r];if(f[c]=d,c===f.length-1&&d.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);e(h)};return s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("bagWeights")}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600",children:r.map((c,d)=>s.jsx(de,{type:"number",step:"any",placeholder:`${n("bag")} ${d+1}`,value:c,onChange:f=>l(d,f.target.value)},d))})]})},qG=()=>{const{t,language:e}=_e(),{settings:n}=Ke(),{cultivationCycles:r,modules:i,seaweedTypes:l,sites:c,updateCultivationCycle:d,updateMultipleCultivationCycles:f,addMultipleStockMovements:h}=qe(),[m,x]=S.useState({siteId:"all",seaweedTypeId:"all"}),[g,N]=S.useState({key:"module.code",direction:"ascending"}),[T,C]=S.useState(!1),[w,E]=S.useState(null),[D,I]=S.useState({baggedDate:""}),[k,M]=S.useState([]),[j,O]=S.useState([]),[A,F]=S.useState(!1),P=S.useRef(null),[U,q]=S.useState({}),[z,J]=S.useState(null),Y=S.useMemo(()=>({totalWeightKg:k.reduce((ee,xe)=>ee+xe,0),totalBags:k.length}),[k]),G=(ee,xe)=>{x(Oe=>({...Oe,[ee]:xe}))},B=S.useCallback(()=>{x({siteId:"all",seaweedTypeId:"all"})},[]),Q=S.useCallback(()=>{const ee={},xe=new Date;return xe.setHours(23,59,59,999),D.baggedDate?new Date(D.baggedDate)>xe&&(ee.baggedDate=t("validationFutureDate")):ee.baggedDate=t("validationRequired"),Y.totalBags===0&&(ee.bagWeights=t("validationAtLeastOneRequired")),ee},[D,Y,t]);S.useEffect(()=>{T&&q(Q())},[T,Q,D,Y]);const K=S.useMemo(()=>{let ee=r.filter(xe=>xe.status===Xe.BAGGING).map(xe=>{const Oe=i.find(Re=>Re.id===xe.moduleId);let De=0;if(xe.dryingStartDate&&xe.dryingCompletionDate){const Re=new Date(xe.dryingStartDate),$e=new Date(xe.dryingCompletionDate);De=Math.ceil(($e.getTime()-Re.getTime())/864e5)}return{cycle:xe,module:Oe,seaweedType:l.find(Re=>Re.id===xe.seaweedTypeId),dryingDuration:De}});return m.siteId!=="all"&&(ee=ee.filter(xe=>{var Oe;return((Oe=xe.module)==null?void 0:Oe.siteId)===m.siteId})),m.seaweedTypeId!=="all"&&(ee=ee.filter(xe=>xe.cycle.seaweedTypeId===m.seaweedTypeId)),ee.sort((xe,Oe)=>{const De=(He,Se)=>{const Le=Se.split(".");let be=He;for(const ye of Le){if(be==null)return;be=be[ye]}return be},Re=De(xe,g.key),$e=De(Oe,g.key);return Re==null?1:$e==null?-1:Re<$e?g.direction==="ascending"?-1:1:Re>$e?g.direction==="ascending"?1:-1:0}),ee},[r,i,l,m,g]),re=ee=>{let xe="ascending";g.key===ee&&g.direction==="ascending"&&(xe="descending"),N({key:ee,direction:xe})},H=ee=>g.key!==ee?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):g.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ae=({sortKey:ee,label:xe,className:Oe=""})=>s.jsx("th",{className:`p-3 ${Oe}`,children:s.jsxs("button",{onClick:()=>re(ee),className:`group flex items-center gap-2 w-full ${Oe.includes("text-right")?"justify-end":""}`,children:[xe," ",H(ee)]})}),ue=S.useCallback(ee=>{E(ee),I({baggedDate:ee.cycle.baggingStartDate||new Date().toISOString().split("T")[0]}),M([]),C(!0)},[]),Ne=()=>{const ee=Q();if(Object.keys(ee).length>0){q(ee);return}if(w){const xe={...w.cycle,status:Xe.BAGGED,baggedDate:D.baggedDate,baggedBagsCount:Y.totalBags,baggedWeightKg:Y.totalWeightKg,bagWeights:k};d(xe),C(!1),E(null)}},le=()=>{const ee=new Date().toISOString().split("T")[0],xe=r.filter(De=>j.includes(De.id)).map(De=>({...De,status:Xe.BAGGED,baggedDate:ee,baggedBagsCount:Math.ceil((De.actualDryWeightKg||0)/25),baggedWeightKg:De.actualDryWeightKg})),Oe=xe.map(De=>{const Re=i.find($e=>$e.id===De.moduleId);return{date:ee,siteId:(Re==null?void 0:Re.siteId)||"",seaweedTypeId:De.seaweedTypeId,type:bs.BAGGING_TRANSFER,designation:`From Batch Bagging (Module ${Re==null?void 0:Re.code})`,inKg:De.baggedWeightKg,inBags:De.baggedBagsCount,relatedId:De.id}});f(xe),h(Oe),alert(t("batchBaggingCompleteSuccess")),O([]),F(!1)},ne=ee=>{var xe,Oe;J({data:{t:"b",id:ee.cycle.id},title:`BATCH: ${(xe=ee.module)==null?void 0:xe.code}`,subtitle:`${(Oe=ee.seaweedType)==null?void 0:Oe.name} - ${new Date(ee.cycle.plantingDate).toLocaleDateString()}`})};S.useEffect(()=>{if(P.current){const ee=j.length,xe=K.length;P.current.checked=ee===xe&&xe>0,P.current.indeterminate=ee>0&&ee<xe}},[j,K]);const Te=S.useCallback(ee=>{ee.target.checked?O(K.map(xe=>xe.cycle.id)):O([])},[K]),fe=(ee,xe)=>{ee.target.checked?O(Oe=>[...Oe,xe]):O(Oe=>Oe.filter(De=>De!==xe))},Z=Object.keys(U).length>0;return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("baggingManagementTitle")}),s.jsx(ze,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:m.siteId,onChange:ee=>G("siteId",ee.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),c.map(ee=>s.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:m.seaweedTypeId,onChange:ee=>G("seaweedTypeId",ee.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),l.map(ee=>s.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),s.jsx(se,{variant:"secondary",onClick:B,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{ref:P,onChange:Te})}),s.jsx(ae,{sortKey:"module.code",label:t("module")}),s.jsx(ae,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(ae,{sortKey:"cycle.dryingCompletionDate",label:t("dryingCompletionDate")}),s.jsx(ae,{sortKey:"cycle.baggingStartDate",label:t("baggingStartDate")}),s.jsx(ae,{sortKey:"cycle.actualDryWeightKg",label:t("dryWeightToBag"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[K.map(ee=>{var xe,Oe,De;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:j.includes(ee.cycle.id),onChange:Re=>fe(Re,ee.cycle.id),"aria-label":t("selectBatch").replace("{code}",((xe=ee.module)==null?void 0:xe.code)||"")})}),s.jsx("td",{className:"p-3 font-mono font-semibold",children:((Oe=ee.module)==null?void 0:Oe.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:((De=ee.seaweedType)==null?void 0:De.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:ee.cycle.dryingCompletionDate}),s.jsx("td",{className:"p-3",children:ee.cycle.baggingStartDate}),s.jsx("td",{className:"p-3 text-right",children:Ue(ee.cycle.actualDryWeightKg||0,n.localization)}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(se,{variant:"ghost",onClick:()=>ne(ee),title:t("print"),children:s.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),s.jsxs(se,{variant:"primary",onClick:()=>ue(ee),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeBagging")]})]})})]},ee.cycle.id)}),K.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noBatchesBagging")})})]})]})})}),j.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[s.jsx("span",{className:"font-semibold",children:t("itemsSelected").replace("{count}",String(j.length))}),s.jsxs(se,{onClick:()=>F(!0),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeSelectedBatches").replace("{count}",String(j.length))]})]}),T&&w&&(()=>{var Oe;const ee=w.cycle.actualDryWeightKg||0,xe=ee-Y.totalWeightKg;return s.jsx(ot,{isOpen:T,onClose:()=>C(!1),title:`${t("completeBaggingFor")} ${(Oe=w.module)==null?void 0:Oe.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:()=>C(!1),children:t("cancel")}),s.jsx(se,{variant:"primary",onClick:Ne,disabled:Z,children:t("confirmAndMoveToStock")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:t("baggedDate"),type:"date",value:D.baggedDate,onChange:De=>I(Re=>({...Re,baggedDate:De.target.value})),error:U.baggedDate,required:!0}),s.jsx(de,{label:t("weightToBag"),type:"text",value:`${Ue(xe,n.localization)} / ${Ue(ee,n.localization)} kg`,disabled:!0,containerClassName:`transition-colors rounded-md ${xe<0?"bg-red-100 dark:bg-red-900/50":""}`}),s.jsx(VG,{weights:k,onChange:M}),U.bagWeights&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:U.bagWeights}),s.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg",children:[t("totalBaggedWeightKg"),": ",Y.totalWeightKg.toFixed(2)," kg (",Y.totalBags," ",t("bags"),")"]})]})})})(),A&&s.jsx(Qt,{isOpen:A,onClose:()=>F(!1),onConfirm:le,title:t("confirmBatchBaggingTitle"),message:t("confirmBatchBaggingMessage").replace("{count}",String(j.length)).replace("{date}",new Date().toLocaleDateString(e)),confirmText:t("confirm")}),z&&s.jsx(_C,{qrData:z.data,title:z.title,subtitle:z.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>J(null)})]})},WG=({isOpen:t,onClose:e,onConfirm:n,selectedCount:r,defaultDate:i})=>{const{t:l}=_e(),[c,d]=S.useState(i);return S.useEffect(()=>{t&&d(i)},[t,i]),s.jsx(ot,{isOpen:t,onClose:e,title:l("confirmTransfer"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(se,{onClick:()=>n(c),disabled:!c,children:l("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l("confirmNormalTransferMessage").replace("{count}",String(r))}),s.jsx(de,{label:l("stockTransferDate"),type:"date",value:c,onChange:f=>d(f.target.value),required:!0})]})})},$G=()=>{const{t}=_e(),{cultivationCycles:e,modules:n,transferBaggedToStock:r}=qe(),[i,l]=S.useState([]),[c,d]=S.useState(!1),f=S.useMemo(()=>e.filter(T=>T.status===Xe.BAGGED).map(T=>{const C=n.find(w=>w.id===T.moduleId);return{cycle:T,module:C}}),[e,n]),h=S.useMemo(()=>{const T=e.filter(w=>i.includes(w.id));if(T.length===0)return new Date().toISOString().split("T")[0];const C=T.reduce((w,E)=>E.baggedDate&&E.baggedDate>w?E.baggedDate:w,"0000-00-00");return C==="0000-00-00"?new Date().toISOString().split("T")[0]:C},[i,e]),m=T=>{T.target.checked?l(f.map(C=>C.cycle.id)):l([])},x=(T,C)=>{T.target.checked?l(w=>[...w,C]):l(w=>w.filter(E=>E!==C))},g=()=>{i.length>0&&d(!0)},N=T=>{r(i,T),l([]),d(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("pendingTransfers")}),s.jsxs(se,{onClick:g,disabled:i.length===0,children:[s.jsx(te,{name:"ArrowRightLeft",className:"w-4 h-4"}),t("transferToWarehouse")]})]}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 w-4",children:s.jsx(Rt,{onChange:m,checked:i.length===f.length&&f.length>0})}),s.jsx("th",{className:"p-2 font-semibold",children:t("moduleCode")}),s.jsx("th",{className:"p-2 font-semibold",children:t("baggedDate")}),s.jsx("th",{className:"p-2 font-semibold text-right",children:t("baggedWeightKg")}),s.jsx("th",{className:"p-2 font-semibold text-right",children:t("bags")})]})}),s.jsx("tbody",{children:f.map(({cycle:T,module:C})=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2",children:s.jsx(Rt,{checked:i.includes(T.id),onChange:w=>x(w,T.id)})}),s.jsx("td",{className:"p-2 font-mono",children:C==null?void 0:C.code}),s.jsx("td",{className:"p-2",children:T.baggedDate}),s.jsx("td",{className:"p-2 text-right",children:T.baggedWeightKg}),s.jsx("td",{className:"p-2 text-right",children:T.baggedBagsCount})]},T.id))})]}),f.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noPendingTransfers")})]}),s.jsx(WG,{isOpen:c,onClose:()=>d(!1),onConfirm:N,selectedCount:i.length,defaultDate:h})]})},KG=({isOpen:t,onClose:e,siteId:n,siteName:r,seaweedTypeId:i,seaweedTypeName:l})=>{const{t:c,language:d}=_e(),{settings:f}=Ke(),{stockMovements:h}=qe(),m=S.useRef(null),x=S.useRef(null),g=S.useMemo(()=>{const T=h.filter(E=>E.siteId===n&&E.seaweedTypeId===i).sort((E,D)=>new Date(E.date).getTime()-new Date(D.date).getTime());let C=0,w=0;return T.map(E=>{const D=(E.inKg||0)-(E.outKg||0),I=(E.inBags||0)-(E.outBags||0);return C+=D,w+=I,{...E,balanceKg:C,balanceBags:w}})},[h,n,i]);S.useEffect(()=>{if(!t||!m.current||g.length===0)return;const T=m.current.getContext("2d");if(!T)return;x.current&&x.current.destroy();const C=f.theme.className.includes("dark"),w=C?"#9ca3af":"#4b5563",E=C?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";return window.Chart&&(x.current=new window.Chart(T,{type:"line",data:{labels:g.map(D=>new Date(D.date).toLocaleDateString(d)),datasets:[{label:`${c("stockKg")} - ${l}`,data:g.map(D=>D.balanceKg),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,tension:.1,fill:!0,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{color:w}},tooltip:{mode:"index",intersect:!1}},scales:{x:{ticks:{color:w,maxRotation:45,minRotation:0},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:w},grid:{color:E},title:{display:!0,text:"Kg",color:w}}}}})),()=>{x.current&&x.current.destroy()}},[t,g,l,c,d,f.theme]);const N=[...g].reverse();return s.jsx(ot,{isOpen:t,onClose:e,title:`${c("stockHistory")}: ${l} @ ${r}`,widthClass:"max-w-4xl",footer:s.jsx(se,{onClick:e,children:c("close")}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"h-64 w-full bg-gray-50 dark:bg-gray-800/50 rounded-lg p-2 border border-gray-200 dark:border-gray-700",children:g.length>0?s.jsx("canvas",{ref:m}):s.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:c("noDataForReport")})}),s.jsx("div",{className:"overflow-x-auto max-h-[40vh] border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800 shadow-sm z-10",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-3 whitespace-nowrap",children:c("date")}),s.jsx("th",{className:"p-3",children:c("movementType")}),s.jsx("th",{className:"p-3",children:c("designation")}),s.jsxs("th",{className:"p-3 text-right text-green-600",children:[c("in")," (Kg)"]}),s.jsxs("th",{className:"p-3 text-right text-red-600",children:[c("out")," (Kg)"]}),s.jsxs("th",{className:"p-3 text-right font-bold text-blue-600",children:[c("balance")," (Kg)"]}),s.jsx("th",{className:"p-3 text-right text-gray-500",children:c("bags")})]})}),s.jsxs("tbody",{children:[N.map(T=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30",children:[s.jsx("td",{className:"p-3 whitespace-nowrap font-mono text-xs",children:T.date}),s.jsx("td",{className:"p-3 text-xs font-medium uppercase text-gray-600 dark:text-gray-400",children:c(`stockMovement_${T.type}`)}),s.jsx("td",{className:"p-3 text-xs truncate max-w-[200px]",title:T.designation,children:T.designation}),s.jsx("td",{className:"p-3 text-right text-green-600 font-medium",children:T.inKg?`+${Ue(T.inKg,f.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600 font-medium",children:T.outKg?`-${Ue(T.outKg,f.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right font-bold text-blue-600",children:Ue(T.balanceKg,f.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500 text-xs",children:T.balanceBags})]},T.id)),N.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:c("noDataForReport")})})]})]})})]})})},YG=()=>{const{t}=_e(),{stockMovements:e,sites:n,seaweedTypes:r}=qe(),{settings:i}=Ke(),[l,c]=S.useState({key:"siteName",direction:"ascending"}),[d,f]=S.useState(null),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all",date:""}),x=S.useMemo(()=>{const k=new Map;e.forEach(A=>{if(h.date&&A.date>h.date||h.siteId!=="all"&&A.siteId!==h.siteId||h.seaweedTypeId!=="all"&&A.seaweedTypeId!==h.seaweedTypeId)return;const F=`${A.siteId}|${A.seaweedTypeId}`,P=k.get(F)||{kg:0,bags:0};P.kg+=(A.inKg||0)-(A.outKg||0),P.bags+=(A.inBags||0)-(A.outBags||0),k.set(F,P)});const M=new Map(n.map(A=>[A.id,A.name])),j=new Map(r.map(A=>[A.id,A])),O=[];return k.forEach((A,F)=>{if(A.kg>.01||A.bags>0){const[P,U]=F.split("|"),q=M.get(P)||t("unknown"),z=j.get(U),J=(z==null?void 0:z.name)||t("unknown"),Y=A.kg*((z==null?void 0:z.dryPrice)||0);O.push({siteId:P,siteName:q,seaweedTypeId:U,seaweedTypeName:J,kg:A.kg,bags:A.bags,value:Y})}}),O},[e,n,r,t,h]),g=S.useMemo(()=>[...x].sort((k,M)=>{const j=k[l.key],O=M[l.key];return typeof j=="string"&&typeof O=="string"?l.direction==="ascending"?j.localeCompare(O):O.localeCompare(j):j<O?l.direction==="ascending"?-1:1:j>O?l.direction==="ascending"?1:-1:0}),[x,l]),N=S.useMemo(()=>({totalKg:x.reduce((k,M)=>k+M.kg,0),totalValue:x.reduce((k,M)=>k+M.value,0),distinctItems:x.length}),[x]),T=k=>{let M="ascending";l.key===k&&l.direction==="ascending"&&(M="descending"),c({key:k,direction:M})},C=k=>l.key!==k?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):l.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),w=({sortKey:k,label:M,className:j})=>s.jsx("th",{className:`p-3 ${j}`,children:s.jsxs("button",{onClick:()=>T(k),className:`group flex items-center gap-2 w-full ${j!=null&&j.includes("text-right")?"justify-end":""}`,children:[M,C(k)]})}),E=(k,M)=>{m(j=>({...j,[k]:M}))},D=()=>{m({siteId:"all",seaweedTypeId:"all",date:""})},I=()=>{const k=g.map(O=>({site:O.siteName,seaweedType:O.seaweedTypeName,kg:O.kg,bags:O.bags,value:O.value})),M=[{header:t("site"),key:"site",width:25},{header:t("seaweedType"),key:"seaweedType",width:20},{header:`${t("stockKg")}`,key:"kg",width:15},{header:t("stockBags"),key:"bags",width:15},{header:t("value"),key:"value",width:20}],j=h.date||new Date().toISOString().split("T")[0];Ko(k,M,`OnSite_Stock_${j}`,"Stock Status")};return s.jsxs("div",{children:[s.jsx(ze,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:h.siteId,onChange:k=>E("siteId",k.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),n.filter(k=>k.id!=="pressing-warehouse").map(k=>s.jsx("option",{value:k.id,children:k.name},k.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:h.seaweedTypeId,onChange:k=>E("seaweedTypeId",k.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),r.map(k=>s.jsx("option",{value:k.id,children:k.name},k.id))]}),s.jsx(de,{label:t("stockHistory")+" ("+t("date")+")",type:"date",value:h.date,onChange:k=>E("date",k.target.value),placeholder:"Current"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{variant:"secondary",onClick:D,className:"h-[42px] flex-1",children:t("clearFilters")}),s.jsxs(se,{onClick:I,variant:"secondary",className:"h-[42px] flex-1",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Package",className:"w-10 h-10 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockKgHeader")}),s.jsx("p",{className:"text-3xl font-bold",children:Ue(N.totalKg,i.localization)})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-green-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockValue")}),s.jsx("p",{className:"text-3xl font-bold",children:Ae(N.totalValue,i.localization)})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Archive",className:"w-10 h-10 text-purple-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("distinctStockItems")}),s.jsx("p",{className:"text-3xl font-bold",children:N.distinctItems})]})]})})]}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:t("stockSummaryBySiteAndType")}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 italic",children:t("clickForHistory")}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx(w,{sortKey:"siteName",label:t("site")}),s.jsx(w,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(w,{sortKey:"kg",label:t("stockKg"),className:"text-right"}),s.jsx(w,{sortKey:"bags",label:t("stockBags"),className:"text-right"}),s.jsx(w,{sortKey:"value",label:t("value"),className:"text-right"})]})}),s.jsx("tbody",{children:g.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors cursor-pointer",onClick:()=>f(k),children:[s.jsx("td",{className:"p-3 font-semibold",children:k.siteName}),s.jsx("td",{className:"p-3",children:k.seaweedTypeName}),s.jsx("td",{className:"p-3 text-right",children:Ue(k.kg,i.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ue(k.bags,{...i.localization,nonMonetaryDecimals:0})}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(k.value,i.localization)})]},`${k.siteId}-${k.seaweedTypeId}`))})]}),g.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noStockData")})]}),d&&s.jsx(KG,{isOpen:!!d,onClose:()=>f(null),siteId:d.siteId,siteName:d.siteName,seaweedTypeId:d.seaweedTypeId,seaweedTypeName:d.seaweedTypeName})]})},JG=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{sites:r,seaweedTypes:i,addStockMovement:l}=qe(),[c,d]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",direction:"in",kg:"",bags:"",designation:""}),[f,h]=S.useState({});S.useEffect(()=>{var N,T;t&&(d({date:new Date().toISOString().split("T")[0],siteId:((N=r.find(C=>C.id!=="pressing-warehouse"))==null?void 0:N.id)||"",seaweedTypeId:((T=i[0])==null?void 0:T.id)||"",direction:"in",kg:"",bags:"",designation:""}),h({}))},[t,r,i]);const m=S.useCallback(()=>{const N={};c.designation.trim()||(N.designation=n("validationRequired"));const T=parseFloat(c.kg),C=parseInt(c.bags,10);if(!c.kg&&!c.bags||isNaN(T)&&isNaN(C)){const w=n("validationAtLeastOneRequired");N.kg=w,N.bags=w}return c.kg&&(isNaN(T)||T<=0)&&(N.kg=n("validationPositiveNumber")),c.bags&&(isNaN(C)||C<=0)&&(N.bags=n("validationPositiveNumber")),N},[c,n]);S.useEffect(()=>{h(m())},[c,m]);const x=()=>{const N=m();if(Object.keys(N).length>0){h(N);return}l({date:c.date,siteId:c.siteId,seaweedTypeId:c.seaweedTypeId,type:c.direction==="in"?bs.ADJUSTMENT_IN:bs.ADJUSTMENT_OUT,designation:c.designation,inKg:c.direction==="in"&&parseFloat(c.kg)||void 0,outKg:c.direction==="out"&&parseFloat(c.kg)||void 0,inBags:c.direction==="in"&&parseInt(c.bags)||void 0,outBags:c.direction==="out"&&parseInt(c.bags)||void 0}),e()},g=Object.keys(f).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:n("recordStockAdjustment"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(se,{onClick:x,disabled:g,children:n("save")})]}),children:s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:c.date,onChange:N=>d(T=>({...T,date:N.target.value}))}),s.jsx(ke,{label:n("site"),value:c.siteId,onChange:N=>d(T=>({...T,siteId:N.target.value})),children:r.filter(N=>N.id!=="pressing-warehouse").map(N=>s.jsx("option",{value:N.id,children:N.name},N.id))}),s.jsx(ke,{label:n("seaweedType"),value:c.seaweedTypeId,onChange:N=>d(T=>({...T,seaweedTypeId:N.target.value})),children:i.map(N=>s.jsx("option",{value:N.id,children:N.name},N.id))}),s.jsxs(ke,{label:n("direction"),value:c.direction,onChange:N=>d(T=>({...T,direction:N.target.value})),children:[s.jsx("option",{value:"in",children:n("in")}),s.jsx("option",{value:"out",children:n("out")})]}),s.jsx(de,{label:n("kg"),type:"number",step:"any",value:c.kg,onChange:N=>d(T=>({...T,kg:N.target.value})),error:f.kg}),s.jsx(de,{label:n("bags"),type:"number",value:c.bags,onChange:N=>d(T=>({...T,bags:N.target.value})),error:f.bags}),s.jsx(de,{containerClassName:"col-span-2",label:n("reasonForAdjustment"),value:c.designation,onChange:N=>d(T=>({...T,designation:N.target.value})),required:!0,error:f.designation})]})})},XG=()=>{var T,C;const{t}=_e(),{stockMovements:e,sites:n,seaweedTypes:r}=qe(),{settings:i}=Ke(),[l,c]=S.useState({siteId:((T=n.find(w=>w.id!=="pressing-warehouse"))==null?void 0:T.id)||"",seaweedTypeId:((C=r[0])==null?void 0:C.id)||"",startDate:"",endDate:""}),[d,f]=S.useState({key:"date",direction:"descending"}),h=w=>{let E="ascending";d.key===w&&d.direction==="ascending"&&(E="descending"),f({key:w,direction:E})},m=w=>d.key!==w?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):d.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),x=(w,E)=>{c(D=>({...D,[w]:E}))},g=S.useMemo(()=>{if(!l.siteId||!l.seaweedTypeId)return[];const w=e.filter(M=>M.siteId===l.siteId&&M.seaweedTypeId===l.seaweedTypeId).sort((M,j)=>new Date(M.date).getTime()-new Date(j.date).getTime()||M.id.localeCompare(j.id));let E=0,D=0;const k=w.map(M=>(E+=(M.inKg||0)-(M.outKg||0),D+=(M.inBags||0)-(M.outBags||0),{...M,balanceKg:E,balanceBags:D})).filter(M=>!(l.startDate&&M.date<l.startDate||l.endDate&&M.date>l.endDate));return k.sort((M,j)=>{const O=M[d.key]??"",A=j[d.key]??"";let F=0;return typeof O=="string"&&typeof A=="string"?F=O.localeCompare(A):typeof O=="number"&&typeof A=="number"&&(F=O-A),F!==0?d.direction==="ascending"?F:-F:d.key!=="date"?new Date(j.date).getTime()-new Date(M.date).getTime():0}),k},[e,l.siteId,l.seaweedTypeId,l.startDate,l.endDate,d]),N=async()=>{var k,M;const w=g.map(j=>({date:j.date,type:t(`stockMovement_${j.type}`),designation:j.designation,inKg:j.inKg||0,inBags:j.inBags||0,outKg:j.outKg||0,outBags:j.outBags||0,balanceKg:j.balanceKg,balanceBags:j.balanceBags})).reverse(),E=[{header:t("date"),key:"date",width:15},{header:t("movementType"),key:"type",width:25},{header:t("designation"),key:"designation",width:40},{header:`${t("in")} (${t("kg")})`,key:"inKg",width:15},{header:`${t("in")} (${t("bags")})`,key:"inBags",width:15},{header:`${t("out")} (${t("kg")})`,key:"outKg",width:15},{header:`${t("out")} (${t("bags")})`,key:"outBags",width:15},{header:`${t("balance")} (${t("kg")})`,key:"balanceKg",width:15},{header:`${t("balance")} (${t("bags")})`,key:"balanceBags",width:15}],D=((k=n.find(j=>j.id===l.siteId))==null?void 0:k.name)||l.siteId,I=((M=r.find(j=>j.id===l.seaweedTypeId))==null?void 0:M.name)||l.seaweedTypeId;await Ko(w,E,`Stock_Movement_${D}_${I}_${new Date().toISOString().split("T")[0]}`,"Stock Movements")};return s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4 items-end",children:[s.jsx(ke,{label:t("site"),value:l.siteId,onChange:w=>x("siteId",w.target.value),children:n.filter(w=>w.id!=="pressing-warehouse").map(w=>s.jsx("option",{value:w.id,children:w.name},w.id))}),s.jsx(ke,{label:t("seaweedType"),value:l.seaweedTypeId,onChange:w=>x("seaweedTypeId",w.target.value),children:r.map(w=>s.jsx("option",{value:w.id,children:w.name},w.id))}),s.jsx(de,{label:t("startDate"),type:"date",value:l.startDate,onChange:w=>x("startDate",w.target.value)}),s.jsx(de,{label:t("endDate"),type:"date",value:l.endDate,onChange:w=>x("endDate",w.target.value)}),s.jsxs(se,{onClick:N,variant:"secondary",className:"h-[42px]",disabled:g.length===0,children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsxs("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:[s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("date"),className:"group flex items-center gap-2 w-full",children:[t("date")," ",m("date")]})}),s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("type"),className:"group flex items-center gap-2 w-full",children:[t("movementType")," ",m("type")]})}),s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("designation"),className:"group flex items-center gap-2 w-full",children:[t("designation")," ",m("designation")]})}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("in")}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("out")}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("inKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("inKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("inBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("inBags")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("outKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("outKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("outBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("outBags")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("balanceKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("balanceKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("balanceBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("balanceBags")]})})]})]}),s.jsx("tbody",{children:g.map(w=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[s.jsx("td",{className:"p-3 whitespace-nowrap",children:w.date}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:t(`stockMovement_${w.type}`)}),s.jsx("td",{className:"p-3",children:w.designation}),s.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:w.inKg?`+${Ue(w.inKg,i.localization)}`:""}),s.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:w.inBags?`+${w.inBags}`:""}),s.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:w.outKg?`-${Ue(w.outKg,i.localization)}`:""}),s.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:w.outBags?`-${w.outBags}`:""}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ue(w.balanceKg,i.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:w.balanceBags})]},w.id))})]}),g.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noDataForReport")})]})]})},QG=()=>{const{t}=_e(),[e,n]=S.useState("status"),[r,i]=S.useState(!1);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("onSiteStorageTitle")}),s.jsxs(se,{onClick:()=>i(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordMovement")]})]}),s.jsxs(ze,{children:[s.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[s.jsx("button",{onClick:()=>n("status"),className:`py-2 px-4 text-sm font-medium ${e==="status"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("stockStatus")}),s.jsx("button",{onClick:()=>n("transfer"),className:`py-2 px-4 text-sm font-medium ${e==="transfer"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("normalTransfer")}),s.jsx("button",{onClick:()=>n("history"),className:`py-2 px-4 text-sm font-medium ${e==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("movementHistory")})]}),e==="status"&&s.jsx(YG,{}),e==="transfer"&&s.jsx($G,{}),e==="history"&&s.jsx(XG,{})]}),s.jsx(JG,{isOpen:r,onClose:()=>i(!1)})]})},ZG=({isOpen:t,onClose:e,farmer:n})=>{const{t:r}=_e(),{sites:i}=qe(),l=i.find(d=>d.id===n.siteId),c=({label:d,value:f})=>s.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:d}),s.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:f||"N/A"})]});return s.jsx(ot,{isOpen:t,onClose:e,title:`${r("farmer")}: ${n.firstName} ${n.lastName} (${n.code})`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(c,{label:r("firstName"),value:n.firstName}),s.jsx(c,{label:r("lastName"),value:n.lastName}),s.jsx(c,{label:r("code"),value:n.code}),s.jsx(c,{label:r("gender"),value:r(`gender_${n.gender}`)}),s.jsx(c,{label:r("dob"),value:n.dob}),s.jsx(c,{label:r("birthPlace"),value:n.birthPlace}),s.jsx(c,{label:r("idNumber"),value:n.idNumber}),s.jsx(c,{label:r("address"),value:n.address}),s.jsx(c,{label:r("site"),value:l==null?void 0:l.name}),s.jsx(c,{label:r("maritalStatus"),value:r(`maritalStatus_${n.maritalStatus}`)}),s.jsx(c,{label:r("nationality"),value:n.nationality}),s.jsx(c,{label:r("parentsInfo"),value:n.parentsInfo})]})})},NE=({isOpen:t,onClose:e,onAssign:n,sites:r,selectedCount:i})=>{var h;const{t:l}=_e(),[c,d]=S.useState(((h=r[0])==null?void 0:h.id)||""),f=()=>{c&&n(c)};return s.jsx(ot,{isOpen:t,onClose:e,title:l("assignSiteTitle"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(se,{onClick:f,disabled:!c,children:l("assign")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{children:l("itemsSelected").replace("{count}",String(i))}),s.jsx(ke,{label:l("site"),value:c,onChange:m=>d(m.target.value),children:r.map(m=>s.jsx("option",{value:m.id,children:m.name},m.id))})]})})},ez=({isOpen:t,onClose:e,preselectedFarmerIds:n=[]})=>{const{t:r,language:i}=_e(),{sites:l,farmers:c,addMessageLog:d,messageLogs:f}=qe(),{currentUser:h}=Zs(),[m,x]=S.useState("compose"),[g,N]=S.useState(n.length>0?"SELECTED":"ALL"),[T,C]=S.useState(""),[w,E]=S.useState("SMS"),[D,I]=S.useState(""),[k,M]=S.useState(!1);S.useEffect(()=>{t&&(n.length>0?N("SELECTED"):N("ALL"),I(""),M(!1),x("compose"))},[t,n]);const j=S.useMemo(()=>{switch(g){case"ALL":return c;case"SITE":return c.filter(A=>A.siteId===T);case"SELECTED":return c.filter(A=>n.includes(A.id));default:return[]}},[g,T,c,n]),O=async()=>{if(!D.trim())return;M(!0),await new Promise(F=>setTimeout(F,1500));const A={date:new Date().toISOString(),senderId:(h==null?void 0:h.id)||"unknown",recipientCount:j.length,filterType:g,filterValue:g==="SITE"?T:void 0,channel:w,content:D,status:"SENT"};d(A),M(!1),alert(r("messageSentSuccess")),e()};return s.jsxs(ot,{isOpen:t,onClose:e,title:r("broadcastTitle"),widthClass:"max-w-4xl",footer:m==="compose"?s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsxs(se,{onClick:O,disabled:k||j.length===0||!D.trim(),children:[s.jsx(te,{name:"Send",className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`}),r(k?"sending":"sendMessage")]})]}):s.jsx(se,{variant:"secondary",onClick:e,children:r("close")}),children:[s.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("nav",{className:"-mb-px flex space-x-8",children:[s.jsx("button",{onClick:()=>x("compose"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="compose"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r("composeMessage")}),s.jsx("button",{onClick:()=>x("history"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r("messageHistory")})]})}),m==="compose"&&s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs(ke,{label:r("recipientScope"),value:g,onChange:A=>N(A.target.value),children:[s.jsx("option",{value:"ALL",children:r("scope_ALL")}),s.jsx("option",{value:"SITE",children:r("scope_SITE")}),s.jsxs("option",{value:"SELECTED",disabled:n.length===0,children:[r("scope_SELECTED")," (",n.length,")"]})]}),g==="SITE"&&s.jsxs(ke,{label:r("site"),value:T,onChange:A=>C(A.target.value),children:[s.jsx("option",{value:"",children:r("selectSite")}),l.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))]}),s.jsxs(ke,{label:r("channel"),value:w,onChange:A=>E(A.target.value),children:[s.jsx("option",{value:"SMS",children:r("channel_SMS")}),s.jsx("option",{value:"WHATSAPP",children:r("channel_WHATSAPP")})]}),s.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[s.jsxs("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:[r("recipient")," Count: ",s.jsx("span",{className:"font-bold text-lg",children:j.length})]}),s.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"Farmers with valid phone numbers will receive this message."})]})]}),s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("messageContent")}),s.jsx("textarea",{className:"w-full flex-grow p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none resize-none",placeholder:"Type your message here...",value:D,onChange:A=>I(A.target.value),maxLength:w==="SMS"?160:1e3,rows:6}),s.jsxs("div",{className:"text-right text-xs text-gray-500 mt-1",children:[r("charCount").replace("{count}",String(D.length))," / ",w==="SMS"?160:1e3]})]})]})}),m==="history"&&s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3",children:r("date")}),s.jsx("th",{className:"p-3",children:r("channel")}),s.jsx("th",{className:"p-3",children:r("recipient")}),s.jsx("th",{className:"p-3",children:r("messageContent")}),s.jsx("th",{className:"p-3",children:r("status")})]})}),s.jsx("tbody",{children:f.length>0?f.slice().reverse().map(A=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3 whitespace-nowrap",children:new Date(A.date).toLocaleString()}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${A.channel==="WHATSAPP"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:A.channel})}),s.jsxs("td",{className:"p-3",children:[A.recipientCount," Farmers (",A.filterType,")"]}),s.jsx("td",{className:"p-3 truncate max-w-xs",title:A.content,children:A.content}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"text-green-600 font-semibold",children:A.status})})]},A.id)):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"p-6 text-center text-gray-500",children:r("noHistory")})})})]})})]})},tz=({isOpen:t,onClose:e,farmer:n,onConfirm:r})=>{const{t:i}=_e(),[l,c]=S.useState(new Date().toISOString().split("T")[0]),[d,f]=S.useState(""),[h,m]=S.useState(""),x=()=>{if(!l||!d.trim()){m(i("validationRequired"));return}r(n.id,l,d),e()};return s.jsx(ot,{isOpen:t,onClose:e,title:i("confirmFire"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{variant:"danger",onClick:x,children:i("fire")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i("confirmFireMessage").replace("{name}",`${n.firstName} ${n.lastName}`)}),s.jsx(de,{label:i("exitDate"),type:"date",value:l,onChange:g=>c(g.target.value),required:!0}),s.jsx(de,{label:i("exitReason"),value:d,onChange:g=>f(g.target.value),placeholder:"e.g. Resignation, Performance, Relocation...",required:!0,error:h})]})})},nz=()=>{const{farmers:t,sites:e,addFarmer:n,updateFarmer:r,deleteFarmer:i,deleteMultipleFarmers:l,updateFarmersSite:c}=qe(),{t:d}=_e(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[T,C]=S.useState(null),[w,E]=S.useState(null),[D,I]=S.useState({key:"code",direction:"ascending"}),[k,M]=S.useState([]),[j,O]=S.useState(!1),[A,F]=S.useState(!1),[P,U]=S.useState(!1),[q,z]=S.useState(dr.ACTIVE),[J,Y]=S.useState(!1),[G,B]=S.useState(null),Q=S.useMemo(()=>new Map(e.map(Se=>[Se.id,Se.name])),[e]),K=S.useMemo(()=>q==="ALL"?t:t.filter(Se=>Se.status===q),[t,q]),re=S.useMemo(()=>{let Se=[...K];return Se.sort((Le,be)=>{let ye,Fe;return D.key==="siteName"?(ye=Q.get(Le.siteId)||"",Fe=Q.get(be.siteId)||""):(ye=Le[D.key],Fe=be[D.key]),ye<Fe?D.direction==="ascending"?-1:1:ye>Fe?D.direction==="ascending"?1:-1:0}),Se},[K,D,Q]),H=Se=>{let Le="ascending";D.key===Se&&D.direction==="ascending"&&(Le="descending"),I({key:Se,direction:Le})},ae=Se=>D.key!==Se?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):D.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ue=({sortKey:Se,label:Le})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>H(Se),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[Le,ae(Se)]})}),Ne=(Se=null)=>{x(Se),h(!0)},le=()=>{x(null),h(!1)},ne=()=>{T&&i(T),N(!1),C(null)},Te=Se=>{B(Se),Y(!0)},fe=(Se,Le,be)=>{G&&(r({...G,status:dr.INACTIVE,exitDate:Le,exitReason:be}),B(null))},Z=Se=>{r({...Se,status:dr.ACTIVE,joinDate:new Date().toISOString().split("T")[0],exitDate:void 0,exitReason:void 0})},ee=Se=>{E(Se)},xe=()=>{E(null)},Oe=Se=>{Se.target.checked?M(re.map(Le=>Le.id)):M([])},De=(Se,Le)=>{Se.target.checked?M(be=>[...be,Le]):M(be=>be.filter(ye=>ye!==Le))},Re=()=>{O(!0)},$e=()=>{l(k),M([]),O(!1)},He=Se=>{c(k,Se),M([]),F(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:d("farmerManagementTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:()=>{M([]),U(!0)},children:[s.jsx(te,{name:"Bell",className:"w-5 h-5 mr-2"}),d("broadcastMessage")]}),s.jsxs(se,{onClick:()=>Ne(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),d("addFarmer")]})]})]}),s.jsx(ze,{className:"mb-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm font-medium",children:[d("status"),":"]}),s.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="ACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-green-700 dark:text-green-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z(dr.ACTIVE),children:d("status_ACTIVE")}),s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="INACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-red-700 dark:text-red-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z(dr.INACTIVE),children:d("status_INACTIVE")}),s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${q==="ALL"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>z("ALL"),children:d("all")})]})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{checked:re.length>0&&k.length===re.length,onChange:Oe,"aria-label":d("selectAllFarmers")})}),s.jsx("th",{className:"p-3 w-20",children:d("status")}),s.jsx(ue,{sortKey:"code",label:d("code")}),s.jsx(ue,{sortKey:"firstName",label:d("firstName")}),s.jsx(ue,{sortKey:"lastName",label:d("lastName")}),s.jsx(ue,{sortKey:"siteName",label:d("site")}),s.jsx(ue,{sortKey:"joinDate",label:d("joinDate")}),s.jsx("th",{className:"p-3 text-right",children:d("actions")})]})}),s.jsx("tbody",{children:re.map(Se=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:k.includes(Se.id),onChange:Le=>De(Le,Se.id),"aria-label":d("selectFarmerNamed").replace("{name}",`${Se.firstName} ${Se.lastName}`)})}),s.jsx("td",{className:"p-3",children:s.jsx(An,{status:Se.status})}),s.jsx("td",{className:"p-3 font-mono",children:Se.code}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.firstName})}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.lastName})}),s.jsx("td",{className:"p-3",children:Q.get(Se.siteId)||d("unknown")}),s.jsx("td",{className:"p-3 text-xs",children:Se.joinDate}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(se,{variant:"ghost",onClick:()=>Ne(Se),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),Se.status===dr.ACTIVE?s.jsx(se,{variant:"danger",onClick:()=>Te(Se),title:d("fireFarmer"),children:s.jsx(te,{name:"LogOut",className:"w-4 h-4"})}):s.jsx(se,{variant:"secondary",onClick:()=>Z(Se),title:d("hireFarmer"),children:s.jsx(te,{name:"UserPlus",className:"w-4 h-4"})})]})})]},Se.id))})]})})}),k.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 ml-16",children:[s.jsx("span",{className:"font-semibold",children:d("itemsSelected").replace("{count}",String(k.length))}),s.jsxs(se,{onClick:()=>F(!0),children:[s.jsx(te,{name:"MapPin",className:"w-4 h-4 mr-2"}),d("assignSite")]}),s.jsxs(se,{onClick:()=>U(!0),variant:"secondary",children:[s.jsx(te,{name:"Bell",className:"w-4 h-4 mr-2"}),d("broadcastMessage")]}),s.jsxs(se,{variant:"danger",onClick:Re,children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),d("deleteSelected")]})]}),f&&s.jsx(sz,{isOpen:f,onClose:le,farmer:m,onSave:Se=>{m?r({...m,...Se}):n(Se),le()}}),J&&G&&s.jsx(tz,{isOpen:J,onClose:()=>Y(!1),farmer:G,onConfirm:fe}),P&&s.jsx(ez,{isOpen:P,onClose:()=>U(!1),preselectedFarmerIds:k}),g&&s.jsx(Qt,{isOpen:g,onClose:()=>N(!1),onConfirm:ne,title:d("confirmDeleteTitle"),message:d("confirmDeleteFarmer")}),j&&s.jsx(Qt,{isOpen:j,onClose:()=>O(!1),onConfirm:$e,title:d("confirmBulkDeleteTitle"),message:d("confirmBulkDeleteFarmers").replace("{count}",String(k.length))}),A&&s.jsx(NE,{isOpen:A,onClose:()=>F(!1),onAssign:He,sites:e,selectedCount:k.length}),w&&s.jsx(ZG,{isOpen:!!w,onClose:xe,farmer:w})]})},sz=({isOpen:t,onClose:e,farmer:n,onSave:r})=>{const{t:i}=_e(),{sites:l}=qe(),[c,d]=S.useState({firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:dr.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}),[f,h]=S.useState(""),[m,x]=S.useState({}),g=S.useMemo(()=>{var E;return{firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:((E=l[0])==null?void 0:E.id)||"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:dr.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}},[l]),N=S.useCallback(E=>{const D={};return E.firstName.trim()||(D.firstName=i("validationRequired")),E.lastName.trim()||(D.lastName=i("validationRequired")),E.siteId||(D.siteId=i("validationRequired")),E.joinDate||(D.joinDate=i("validationRequired")),D},[i]);S.useEffect(()=>{if(n){const{code:E,id:D,...I}=n;d(I),h(E)}else d(g),h("")},[n,g,t]),S.useEffect(()=>{if(!n&&c.firstName&&c.lastName){const E=(c.firstName.substring(0,1)+c.lastName.substring(0,2)).toUpperCase();h(E)}},[c.firstName,c.lastName,n]),S.useEffect(()=>{x(N(c))},[c,N]);const T=(E,D)=>{d(I=>({...I,[E]:D}))},C=E=>{E.preventDefault();const D=N(c);Object.keys(D).length===0?r({...c,code:f}):x(D)},w=Object.keys(m).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editFarmer":"addFarmer"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:C,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("firstName"),value:c.firstName,onChange:E=>T("firstName",E.target.value),error:m.firstName,required:!0}),s.jsx(de,{label:i("lastName"),value:c.lastName,onChange:E=>T("lastName",E.target.value),error:m.lastName,required:!0}),s.jsx(de,{label:i("code"),value:f,disabled:!0}),s.jsxs(ke,{label:i("gender"),value:c.gender,onChange:E=>T("gender",E.target.value),children:[s.jsx("option",{value:"Male",children:i("gender_Male")}),s.jsx("option",{value:"Female",children:i("gender_Female")}),s.jsx("option",{value:"Other",children:i("gender_Other")})]}),s.jsxs(ke,{label:i("maritalStatus"),value:c.maritalStatus,onChange:E=>T("maritalStatus",E.target.value),children:[s.jsx("option",{value:"Single",children:i("maritalStatus_Single")}),s.jsx("option",{value:"Married",children:i("maritalStatus_Married")}),s.jsx("option",{value:"Divorced",children:i("maritalStatus_Divorced")}),s.jsx("option",{value:"Widowed",children:i("maritalStatus_Widowed")})]}),s.jsxs(ke,{label:i("site"),value:c.siteId,onChange:E=>T("siteId",E.target.value),error:m.siteId,required:!0,children:[s.jsx("option",{value:"",children:i("selectSite")}),l.map(E=>s.jsx("option",{value:E.id,children:E.name},E.id))]}),s.jsx(de,{label:i("joinDate"),type:"date",value:c.joinDate,onChange:E=>T("joinDate",E.target.value),required:!0,error:m.joinDate}),s.jsx(de,{label:i("phoneNumber"),type:"tel",value:c.phone||"",onChange:E=>T("phone",E.target.value),placeholder:"+261..."}),s.jsx(de,{label:i("dob"),value:c.dob,onChange:E=>T("dob",E.target.value),placeholder:"e.g. 1990-05-15 or Circa 1981"}),s.jsx(de,{label:i("birthPlace"),value:c.birthPlace,onChange:E=>T("birthPlace",E.target.value)}),s.jsx(de,{label:i("nationality"),value:c.nationality,onChange:E=>T("nationality",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("idNumber"),value:c.idNumber,onChange:E=>T("idNumber",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("address"),value:c.address,onChange:E=>T("address",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("parentsInfo"),value:c.parentsInfo,onChange:E=>T("parentsInfo",E.target.value)})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",disabled:w,children:i("save")})]})]})})},rz=({isOpen:t,onClose:e,employee:n})=>{const{t:r}=_e(),{sites:i}=qe(),{settings:l}=Ke(),c=i.find(f=>f.id===n.siteId),d=({label:f,value:h})=>s.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:f}),s.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:h||"N/A"})]});return s.jsx(ot,{isOpen:t,onClose:e,title:`${r("employeeProfile")}: ${n.firstName} ${n.lastName}`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(d,{label:r("firstName"),value:n.firstName}),s.jsx(d,{label:r("lastName"),value:n.lastName}),s.jsx(d,{label:r("code"),value:n.code}),s.jsx(d,{label:r("employeeType"),value:s.jsx(An,{status:n.employeeType})}),s.jsx(d,{label:r("role"),value:n.role}),s.jsx(d,{label:r("category"),value:n.category}),s.jsx(d,{label:r("team"),value:n.team}),s.jsx(d,{label:r("grossWage"),value:Ae(n.grossWage,l.localization)}),s.jsx(d,{label:r("site"),value:c==null?void 0:c.name}),s.jsx(d,{label:r("email"),value:n.email}),s.jsx(d,{label:r("phone"),value:n.phone}),s.jsx(d,{label:r("hireDate"),value:n.hireDate})]})})},iz=({currentPage:t,totalPages:e,onPageChange:n,itemsPerPage:r,totalItems:i,onItemsPerPageChange:l})=>{const{t:c}=_e(),d=i===0?0:(t-1)*r+1,f=Math.min(t*r,i),h=()=>{const m=[];if(e<=7)for(let x=1;x<=e;x++)m.push(x);else m.push(1),t>3&&m.push("..."),t>2&&m.push(t-1),t!==1&&t!==e&&m.push(t),t<e-1&&m.push(t+1),t<e-2&&m.push("..."),m.push(e);return[...new Set(m)]};return e<=1&&i<=r?null:s.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsxs("div",{className:"mb-2 md:mb-0",children:[c("pagination.showing")," ",d,"-",f," ",c("pagination.of")," ",i," ",c("pagination.results")]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:[c("pagination.itemsPerPage"),":"]}),s.jsxs(ke,{value:r,onChange:m=>l(Number(m.target.value)),className:"!w-20",children:[s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:25,children:"25"}),s.jsx("option",{value:50,children:"50"}),s.jsx("option",{value:100,children:"100"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>n(t-1),disabled:t===1,className:"!px-2","aria-label":c("pagination.previous"),children:[s.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:c("pagination.previous")})]}),s.jsx("div",{className:"flex items-center gap-1",children:h().map((m,x)=>typeof m=="number"?s.jsx(se,{variant:t===m?"primary":"ghost",onClick:()=>n(m),className:"!px-3 !py-1","aria-label":`Go to page ${m}`,"aria-current":t===m?"page":void 0,children:m},x):s.jsx("span",{className:"px-2 py-1",children:"..."},x))}),s.jsxs(se,{variant:"ghost",onClick:()=>n(t+1),disabled:t===e||e===0,className:"!px-2","aria-label":c("pagination.next"),children:[s.jsx("span",{className:"hidden sm:inline",children:c("pagination.next")}),s.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})]})]})]})]})},az=({isOpen:t,onClose:e,employee:n,onSave:r})=>{const{t:i}=_e(),{sites:l,roles:c}=qe(),{settings:d}=Ke(),[f,h]=S.useState(!1),m=S.useMemo(()=>({firstName:"",lastName:"",employeeType:"PERMANENT",role:"",team:"",phone:"",email:"",hireDate:new Date().toISOString().split("T")[0],siteId:"",grossWage:"",category:""}),[]),[x,g]=S.useState(m),[N,T]=S.useState(""),[C,w]=S.useState({}),E=S.useCallback(M=>{const j={};M.firstName.trim()||(j.firstName=i("validationRequired")),M.lastName.trim()||(j.lastName=i("validationRequired")),M.role.trim()||(j.role=i("validationRequired")),M.category.trim()||(j.category=i("validationRequired")),M.hireDate||(j.hireDate=i("validationRequired")),M.phone.trim()||(j.phone=i("validationRequired"));const O=typeof M.grossWage=="string"?Zp(M.grossWage,d.localization):M.grossWage;return(isNaN(O)||O<=0)&&(j.grossWage=i("validationPositiveNumber")),M.email&&!/\S+@\S+\.\S+/.test(M.email)&&(j.email=i("validationEmail")),j},[i,d.localization]);S.useEffect(()=>{if(n){const{code:M,id:j,...O}=n;g({...O,team:O.team||"",siteId:O.siteId||"",grossWage:String(O.grossWage)}),T(M)}else g(m),T("")},[n,m,t]),S.useEffect(()=>{if(!n&&x.firstName&&x.lastName){const M=(x.firstName.substring(0,1)+x.lastName.substring(0,2)).toUpperCase();T(M)}},[x.firstName,x.lastName,n]),S.useEffect(()=>{w(E(x))},[x,E]);const D=(M,j)=>{g(O=>({...O,[M]:j}))},I=M=>{M.preventDefault();const j=E(x);if(Object.keys(j).length>0){w(j);return}const O={...x,code:N,siteId:x.siteId||void 0,team:x.team||void 0,grossWage:typeof x.grossWage=="string"?Zp(x.grossWage,d.localization):parseFloat(x.grossWage)||0,status:(n==null?void 0:n.status)||Tg.ACTIVE,exitDate:n==null?void 0:n.exitDate,exitReason:n==null?void 0:n.exitReason,email:x.email,phone:x.phone};r(O)},k=Object.keys(C).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editEmployee":"addEmployee"),widthClass:"max-w-3xl",children:s.jsxs("form",{onSubmit:I,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("firstName"),value:x.firstName,onChange:M=>D("firstName",M.target.value),error:C.firstName,required:!0,autoFocus:!0}),s.jsx(de,{label:i("lastName"),value:x.lastName,onChange:M=>D("lastName",M.target.value),error:C.lastName,required:!0}),s.jsx(de,{label:i("code"),value:N,disabled:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:i("employeeType"),value:x.employeeType,onChange:M=>D("employeeType",M.target.value),children:[s.jsx("option",{value:"PERMANENT",children:i("employeeType_PERMANENT")}),s.jsx("option",{value:"CASUAL",children:i("employeeType_CASUAL")})]}),s.jsxs(ke,{label:i("role"),value:x.role,onChange:M=>D("role",M.target.value),error:C.role,required:!0,children:[s.jsx("option",{value:"",children:i("selectRole")}),c.map(M=>s.jsx("option",{value:M.name,children:M.name},M.id))]}),s.jsx(de,{label:`${i("team")} (${i("optional")})`,value:x.team,onChange:M=>D("team",M.target.value)}),s.jsx(de,{label:i("grossWage"),type:f?"number":"text",value:f?x.grossWage:Ae(parseFloat(x.grossWage)||0,d.localization),onFocus:()=>h(!0),onChange:M=>D("grossWage",M.target.value),onBlur:()=>h(!1),error:C.grossWage,required:!0}),s.jsxs(ke,{label:i("site"),value:x.siteId,onChange:M=>D("siteId",M.target.value),children:[s.jsx("option",{value:"",children:i("noSpecificSite")}),l.map(M=>s.jsx("option",{value:M.id,children:M.name},M.id))]}),s.jsx(de,{label:i("category"),value:x.category,onChange:M=>D("category",M.target.value),error:C.category,required:!0}),s.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:x.email,onChange:M=>D("email",M.target.value),error:C.email}),s.jsx(de,{label:i("phone"),type:"tel",value:x.phone,onChange:M=>D("phone",M.target.value),required:!0,error:C.phone}),s.jsx(de,{label:i("hireDate"),type:"date",value:x.hireDate,onChange:M=>D("hireDate",M.target.value),error:C.hireDate,required:!0})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{type:"submit",disabled:k,children:i("save")})]})]})})},oz=()=>{const{employees:t,sites:e,addEmployee:n,updateEmployee:r,deleteEmployee:i,deleteMultipleEmployees:l,updateEmployeesSite:c,roles:d}=qe(),{t:f}=_e(),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,T]=S.useState(!1),[C,w]=S.useState(null),[E,D]=S.useState(null),[I,k]=S.useState({key:"code",direction:"ascending"}),[M,j]=S.useState({name:"",siteId:"all",role:"all"}),[O,A]=S.useState([]),[F,P]=S.useState(!1),[U,q]=S.useState(!1),z=S.useRef(null),[J,Y]=S.useState(1),[G,B]=S.useState(10),Q=S.useMemo(()=>new Map(e.map(be=>[be.id,be.name])),[e]),K=S.useMemo(()=>[...new Set(t.map(be=>be.role).filter(Boolean))].sort(),[t]),re=S.useMemo(()=>{let be=[...t];if(M.name){const ye=M.name.toLowerCase();be=be.filter(Fe=>`${Fe.firstName} ${Fe.lastName}`.toLowerCase().includes(ye)||Fe.code.toLowerCase().includes(ye))}return M.siteId!=="all"&&(be=be.filter(ye=>ye.siteId===M.siteId)),M.role!=="all"&&(be=be.filter(ye=>ye.role===M.role)),be.sort((ye,Fe)=>{let et,Lt;return I.key==="siteName"?(et=ye.siteId&&Q.get(ye.siteId)||"",Lt=Fe.siteId&&Q.get(Fe.siteId)||""):(et=ye[I.key]||"",Lt=Fe[I.key]||""),et<Lt?I.direction==="ascending"?-1:1:et>Lt?I.direction==="ascending"?1:-1:0}),be},[t,M,I,Q]);S.useEffect(()=>{Y(1)},[M.name,M.siteId,M.role,G]);const H=S.useMemo(()=>{const be=(J-1)*G;return re.slice(be,be+G)},[re,J,G]);S.useEffect(()=>{if(z.current){const be=new Set(H.map(et=>et.id)),ye=O.filter(et=>be.has(et)).length,Fe=ye===H.length&&H.length>0;z.current.checked=Fe,z.current.indeterminate=ye>0&&!Fe}},[O,H]);const ae=(be,ye)=>{j(Fe=>({...Fe,[be]:ye}))},ue=()=>{j({name:"",siteId:"all",role:"all"})},Ne=be=>{let ye="ascending";I.key===be&&I.direction==="ascending"&&(ye="descending"),k({key:be,direction:ye})},le=be=>I.key!==be?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):I.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ne=({sortKey:be,label:ye})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>Ne(be),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[ye,le(be)]})}),Te=(be=null)=>{g(be),m(!0)},fe=()=>{g(null),m(!1)},Z=be=>{w(be),T(!0)},ee=()=>{C&&i(C),T(!1),w(null)},xe=be=>{x?r({...x,...be}):n(be),fe()},Oe=be=>{D(be)},De=()=>{D(null)},Re=S.useCallback(be=>{const ye=H.map(Fe=>Fe.id);if(be.target.checked)A(Fe=>[...new Set([...Fe,...ye])]);else{const Fe=new Set(ye);A(et=>et.filter(Lt=>!Fe.has(Lt)))}},[H]),$e=(be,ye)=>{be.target.checked?A(Fe=>[...Fe,ye]):A(Fe=>Fe.filter(et=>et!==ye))},He=()=>{P(!0)},Se=()=>{l(O),A([]),P(!1)},Le=be=>{c(O,be),A([]),q(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:f("employeeManagementTitle")}),s.jsxs(se,{onClick:()=>Te(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),f("addEmployee")]})]}),s.jsx(ze,{className:"mb-6",title:f("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[s.jsx(de,{label:f("searchByNameOrCode"),value:M.name,onChange:be=>ae("name",be.target.value),placeholder:f("searchByNameOrCode")}),s.jsxs(ke,{label:f("site"),value:M.siteId,onChange:be=>ae("siteId",be.target.value),children:[s.jsx("option",{value:"all",children:f("allSites")}),e.map(be=>s.jsx("option",{value:be.id,children:be.name},be.id))]}),s.jsxs(ke,{label:f("role"),value:M.role,onChange:be=>ae("role",be.target.value),children:[s.jsx("option",{value:"all",children:f("allRoles")}),K.map(be=>s.jsx("option",{value:be,children:be},be))]}),s.jsx(se,{variant:"secondary",onClick:ue,className:"h-[42px]",children:f("clearFilters")})]})}),s.jsxs(ze,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{ref:z,onChange:Re,"aria-label":f("selectAllEmployees")})}),s.jsx(ne,{sortKey:"code",label:f("code")}),s.jsx(ne,{sortKey:"firstName",label:f("firstName")}),s.jsx(ne,{sortKey:"lastName",label:f("lastName")}),s.jsx(ne,{sortKey:"role",label:f("role")}),s.jsx(ne,{sortKey:"team",label:f("team")}),s.jsx(ne,{sortKey:"siteName",label:f("site")}),s.jsx(ne,{sortKey:"phone",label:f("phone")}),s.jsx(ne,{sortKey:"hireDate",label:f("hireDate")}),s.jsx("th",{className:"p-3 text-right",children:f("actions")})]})}),s.jsx("tbody",{children:H.map(be=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:O.includes(be.id),onChange:ye=>$e(ye,be.id),"aria-label":f("selectEmployeeNamed").replace("{name}",`${be.firstName} ${be.lastName}`)})}),s.jsx("td",{className:"p-3 font-mono",children:be.code}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>Oe(be),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:be.firstName})}),s.jsx("td",{className:"p-3 font-semibold",children:be.lastName}),s.jsx("td",{className:"p-3",children:be.role}),s.jsx("td",{className:"p-3",children:be.team||f("none")}),s.jsx("td",{className:"p-3",children:be.siteId?Q.get(be.siteId)||f("unknown"):f("noSpecificSite")}),s.jsx("td",{className:"p-3",children:be.phone}),s.jsx("td",{className:"p-3",children:be.hireDate}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>Te(be),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),f("edit")]}),s.jsxs(se,{variant:"danger",onClick:()=>Z(be.id),children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("delete")]})]})})]},be.id))})]})}),re.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:f("noEmployeesMatchFilters")}),s.jsx(iz,{currentPage:J,totalPages:Math.ceil(re.length/G),onPageChange:Y,itemsPerPage:G,totalItems:re.length,onItemsPerPageChange:be=>{B(be),Y(1)}})]}),O.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[s.jsx("span",{className:"font-semibold",children:f("itemsSelected").replace("{count}",String(O.length))}),s.jsxs(se,{onClick:()=>q(!0),children:[s.jsx(te,{name:"MapPin",className:"w-4 h-4"}),f("assignSite")]}),s.jsxs(se,{variant:"danger",onClick:He,children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("deleteSelected")]})]}),h&&s.jsx(az,{isOpen:h,onClose:fe,employee:x,onSave:xe}),N&&s.jsx(Qt,{isOpen:N,onClose:()=>T(!1),onConfirm:ee,title:f("confirmDeleteTitle"),message:f("confirmDeleteEmployee")}),F&&s.jsx(Qt,{isOpen:F,onClose:()=>P(!1),onConfirm:Se,title:f("confirmBulkDeleteTitle"),message:f("confirmBulkDeleteEmployees").replace("{count}",String(O.length))}),U&&s.jsx(NE,{isOpen:U,onClose:()=>q(!1),onAssign:Le,sites:e,selectedCount:O.length}),E&&s.jsx(rz,{isOpen:!!E,onClose:De,employee:E})]})},lz=({isOpen:t,onClose:e,slip:n})=>{const{t:r}=_e(),{settings:i}=Ke(),{seaweedTypes:l,addPressingSlip:c,updatePressingSlip:d,pressedStockMovements:f}=qe(),h=S.useCallback(()=>{var I;return{date:new Date().toISOString().split("T")[0],seaweedTypeId:((I=l[0])==null?void 0:I.id)||"",sourceSiteId:"pressing-warehouse",consumedWeightKg:"",consumedBags:"",producedWeightKg:"",producedBalesCount:""}},[l]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{t&&(x(n?{date:n.date,seaweedTypeId:n.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:String(n.consumedWeightKg),consumedBags:String(n.consumedBags),producedWeightKg:String(n.producedWeightKg),producedBalesCount:String(n.producedBalesCount)}:h()),N({}))},[t,n,h]);const T=S.useMemo(()=>{if(!m.seaweedTypeId)return{kg:0,bags:0};const I=f.filter(j=>j.seaweedTypeId===m.seaweedTypeId&&j.siteId==="pressing-warehouse");let k=0,M=0;return I.forEach(j=>{[mt.BULK_IN_FROM_SITE,mt.FARMER_DELIVERY].includes(j.type)?(k+=j.inKg||0,M+=j.inBales||0):[mt.PRESSING_CONSUMPTION].includes(j.type)&&(k-=j.outKg||0,M-=j.outBales||0)}),n&&n.seaweedTypeId===m.seaweedTypeId&&(k+=n.consumedWeightKg,M+=n.consumedBags),{kg:Math.max(0,k),bags:Math.max(0,M)}},[f,m.seaweedTypeId,n]),C=S.useCallback(()=>{const I={};m.date||(I.date=r("validationRequired")),m.seaweedTypeId||(I.seaweedTypeId=r("validationRequired"));const k=parseFloat(m.consumedWeightKg);!m.consumedWeightKg||isNaN(k)||k<=0?I.consumedWeightKg=r("validationPositiveNumber"):k>T.kg&&(I.consumedWeightKg=r("validationStockUnavailableBulk").replace("{availableStock}",Ue(T.kg,i.localization)));const M=parseInt(m.consumedBags,10);return!m.consumedBags||isNaN(M)||M<0?I.consumedBags=r("validationNonNegative"):M>T.bags&&(I.consumedBags=r("validationStockUnavailableBags").replace("{availableStock}",String(T.bags))),(!m.producedWeightKg||isNaN(parseFloat(m.producedWeightKg))||parseFloat(m.producedWeightKg)<=0)&&(I.producedWeightKg=r("validationPositiveNumber")),(!m.producedBalesCount||isNaN(parseInt(m.producedBalesCount,10))||parseInt(m.producedBalesCount,10)<=0)&&(I.producedBalesCount=r("validationPositiveNumber")),I},[m,r,T,i.localization]);S.useEffect(()=>{N(C())},[m,C]);const w=(I,k)=>{x(M=>({...M,[I]:k}))},E=I=>{I.preventDefault();const k=C();if(Object.keys(k).length>0){N(k);return}const M={date:m.date,seaweedTypeId:m.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:parseFloat(m.consumedWeightKg),consumedBags:parseInt(m.consumedBags,10)||0,producedWeightKg:parseFloat(m.producedWeightKg),producedBalesCount:parseInt(m.producedBalesCount,10)};n?d({...n,...M}):c(M),e()},D=Object.keys(g).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:r(n?"editPressingSlip":"newPressingSlip"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{onClick:E,disabled:D,children:r("save")})]}),children:s.jsx("form",{onSubmit:E,className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:I=>w("date",I.target.value),error:g.date,required:!0}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:I=>w("seaweedTypeId",I.target.value),error:g.seaweedTypeId,required:!0,children:l.map(I=>s.jsx("option",{value:I.id,children:I.name},I.id))}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("originInformation")}),s.jsx("div",{className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-bold",children:r("pressedWarehouseTitle")})]}),s.jsx("div",{className:"md:col-span-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:[r("availableBulkStock"),":"]}),s.jsxs("span",{className:"font-bold text-lg text-blue-900 dark:text-blue-100",children:[Ue(T.kg,i.localization)," kg (",T.bags," ",r("bags"),")"]})]})}),s.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-700 space-y-4",children:[s.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-red-700 dark:text-red-200 border-b border-red-300 pb-1 mb-2",children:r("bulkWeightConsumed")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:`${r("warehouse_weightKg")}`,type:"number",step:"any",value:m.consumedWeightKg,onChange:I=>w("consumedWeightKg",I.target.value),error:g.consumedWeightKg,required:!0}),s.jsx(de,{label:r("sac"),type:"number",value:m.consumedBags,onChange:I=>w("consumedBags",I.target.value),error:g.consumedBags,required:!0})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-700 space-y-4",children:[s.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-green-700 dark:text-green-200 border-b border-green-300 pb-1 mb-2",children:r("pressedWeightObtained")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:`${r("warehouse_weightKg")}`,type:"number",step:"any",value:m.producedWeightKg,onChange:I=>w("producedWeightKg",I.target.value),error:g.producedWeightKg,required:!0}),s.jsx(de,{label:r("baleSingular"),type:"number",value:m.producedBalesCount,onChange:I=>w("producedBalesCount",I.target.value),error:g.producedBalesCount,required:!0})]})]})]})})})},cz=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{seaweedTypes:r,addPressedStockAdjustment:i}=qe(),[l,c]=S.useState({date:new Date().toISOString().split("T")[0],seaweedTypeId:"",direction:"in",kg:"",bales:"",designation:""}),[d,f]=S.useState({});S.useEffect(()=>{var g;t&&(c({date:new Date().toISOString().split("T")[0],seaweedTypeId:((g=r[0])==null?void 0:g.id)||"",direction:"in",kg:"",bales:"",designation:""}),f({}))},[t,r]);const h=S.useCallback(()=>{const g={};l.seaweedTypeId||(g.seaweedTypeId=n("validationRequired")),l.designation.trim()||(g.designation=n("validationRequired"));const N=parseFloat(l.kg),T=parseInt(l.bales,10);if(!l.kg&&!l.bales||isNaN(N)&&isNaN(T)){const C=n("validationAtLeastOneRequired");g.kg=C,g.bales=C}return l.kg&&(isNaN(N)||N<=0)&&(g.kg=n("validationPositiveNumber")),l.bales&&(isNaN(T)||T<=0)&&(g.bales=n("validationPositiveNumber")),g},[l,n]);S.useEffect(()=>{f(h())},[l,h]);const m=()=>{const g=h();if(Object.keys(g).length>0){f(g);return}i({date:l.date,siteId:"pressing-warehouse",seaweedTypeId:l.seaweedTypeId,type:l.direction==="in"?mt.ADJUSTMENT_IN:mt.ADJUSTMENT_OUT,designation:l.designation,inKg:l.direction==="in"&&parseFloat(l.kg)||void 0,outKg:l.direction==="out"&&parseFloat(l.kg)||void 0,inBales:l.direction==="in"&&parseInt(l.bales)||void 0,outBales:l.direction==="out"&&parseInt(l.bales)||void 0}),e()},x=Object.keys(d).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:`${n("recordStockAdjustment")} (${n("pressedSeaweed")})`,footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(se,{onClick:m,disabled:x,children:n("save")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:l.date,onChange:g=>c(N=>({...N,date:g.target.value}))}),s.jsx(ke,{label:n("seaweedType"),value:l.seaweedTypeId,onChange:g=>c(N=>({...N,seaweedTypeId:g.target.value})),children:r.map(g=>s.jsx("option",{value:g.id,children:g.name},g.id))})]}),s.jsxs(ke,{label:n("direction"),value:l.direction,onChange:g=>c(N=>({...N,direction:g.target.value})),children:[s.jsx("option",{value:"in",children:n("in")}),s.jsx("option",{value:"out",children:n("out")})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("kg"),type:"number",step:"any",value:l.kg,onChange:g=>c(N=>({...N,kg:g.target.value})),error:d.kg}),s.jsx(de,{label:n("baleSingular"),type:"number",value:l.bales,onChange:g=>c(N=>({...N,bales:g.target.value})),error:d.bales})]}),s.jsx(de,{label:n("reasonForAdjustment"),value:l.designation,onChange:g=>c(N=>({...N,designation:g.target.value})),required:!0,error:d.designation,placeholder:"e.g. Initial Stock, Correction, Found Stock..."})]})})},dz=()=>{const{t}=_e(),{settings:e}=Ke(),{pressedStockMovements:n,seaweedTypes:r}=qe(),{bulkStock:i,pressedStock:l,totals:c}=S.useMemo(()=>{const f=new Map,h=new Map;n.forEach(w=>{const E=w.seaweedTypeId;let D=f.get(E)||{kg:0,bags:0},I=h.get(E)||{bales:0,kg:0};switch(w.type){case mt.BULK_IN_FROM_SITE:case mt.FARMER_DELIVERY:D.kg+=w.inKg||0,D.bags+=w.inBales||0;break;case mt.PRESSING_CONSUMPTION:D.kg-=w.outKg||0,D.bags-=w.outBales||0;break;case mt.PRESSING_IN:case mt.INITIAL_STOCK:case mt.ADJUSTMENT_IN:I.bales+=w.inBales||0,I.kg+=w.inKg||0;break;case mt.EXPORT_OUT:case mt.RETURN_TO_SITE:case mt.ADJUSTMENT_OUT:I.bales-=w.outBales||0,I.kg-=w.outKg||0;break}f.set(E,D),h.set(E,I)});const m=(w,E)=>Array.from(w.entries()).map(([D,I])=>{const k=r.find(j=>j.id===D),M=I.kg*((k==null?void 0:k.dryPrice)||0);return{seaweedTypeId:D,name:(k==null?void 0:k.name)||t("unknown"),siteName:t("pressedWarehouseTitle"),...I,value:M}}).filter(D=>D.kg>.01||(E?D.bales>0:D.bags>0)),x=m(f,!1),g=m(h,!0),N=x.reduce((w,E)=>w+E.value,0),T=g.reduce((w,E)=>w+E.value,0),C={pressedBales:g.reduce((w,E)=>w+E.bales,0),pressedKg:g.reduce((w,E)=>w+E.kg,0),pressedValue:T,totalValue:N+T};return{bulkStock:x,pressedStock:g,totals:C}},[n,r,t]),d=()=>{const f=i.map(x=>({name:x.name,kg:x.kg,bags:x.bags,value:x.value})),h=l.map(x=>({name:x.name,kg:x.kg,bales:x.bales,value:x.value})),m=[{sheetName:t("bulkSeaweed"),columns:[{header:t("seaweedType"),key:"name",width:25},{header:t("warehouse_weightKg"),key:"kg",width:15},{header:t("bags"),key:"bags",width:15},{header:t("value"),key:"value",width:20}],data:f},{sheetName:t("pressedSeaweed"),columns:[{header:t("seaweedType"),key:"name",width:25},{header:t("warehouse_weightKg"),key:"kg",width:15},{header:t("bales"),key:"bales",width:15},{header:t("value"),key:"value",width:20}],data:h}];bE(m,"Pressed_Warehouse_Summary")};return s.jsxs("div",{children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(se,{onClick:d,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Archive",className:"w-10 h-10 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("warehouse_totalBalesInStock")}),s.jsx("p",{className:"text-3xl font-bold",children:c.pressedBales})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Package",className:"w-10 h-10 text-green-500 mr-4"}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-gray-500",children:[t("totalStockKg")," (",t("pressedSeaweed"),")"]}),s.jsx("p",{className:"text-3xl font-bold",children:Ue(c.pressedKg,e.localization)})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-yellow-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockValue")}),s.jsx("p",{className:"text-3xl font-bold",children:Ae(c.totalValue,e.localization)})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6",children:[s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"w-2 h-6 bg-red-500 rounded-sm mr-2"}),s.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:t("bulkSeaweed")})]}),s.jsx(ze,{className:"flex-grow border-t-4 border-t-red-500",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[s.jsx("th",{className:"p-2 pl-0",children:t("seaweedType")}),s.jsx("th",{className:"p-2 text-right",children:t("kg")}),s.jsx("th",{className:"p-2 text-right",children:t("bags")})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[i.map(f=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[s.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ue(f.kg,e.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bags})]},f.seaweedTypeId)),i.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:3,className:"p-6 text-center text-sm text-gray-400 italic",children:t("noStockData")})})]})]})})})]}),s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"w-2 h-6 bg-green-500 rounded-sm mr-2"}),s.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:t("pressedSeaweed")})]}),s.jsx(ze,{className:"flex-grow border-t-4 border-t-green-500",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[s.jsx("th",{className:"p-2 pl-0",children:t("seaweedType")}),s.jsx("th",{className:"p-2 text-right",children:t("kg")}),s.jsx("th",{className:"p-2 text-right",children:t("bales")}),s.jsx("th",{className:"p-2 text-right",children:t("value")})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[l.map(f=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[s.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ue(f.kg,e.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bales}),s.jsx("td",{className:"p-3 text-right font-medium text-green-600 dark:text-green-400",children:Ae(f.value,e.localization)})]},f.seaweedTypeId)),l.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-6 text-center text-sm text-gray-400 italic",children:t("noStockData")})})]})]})})})]})]})]})},uz=({onEdit:t,onDelete:e})=>{const{t:n}=_e(),{pressingSlips:r,seaweedTypes:i,exportDocuments:l}=qe(),[c,d]=S.useState({key:"date",direction:"descending"}),f=S.useMemo(()=>new Map(l.map(T=>[T.id,T])),[l]),h=S.useMemo(()=>new Map(i.map(T=>[T.id,T.name])),[i]),m=S.useMemo(()=>[...r].sort((T,C)=>{const w=T[c.key],E=C[c.key];return w<E?c.direction==="ascending"?-1:1:w>E?c.direction==="ascending"?1:-1:0}),[r,c]),x=T=>{let C="ascending";c.key===T&&c.direction==="ascending"&&(C="descending"),d({key:T,direction:C})},g=T=>c.key!==T?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):c.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),N=()=>{const T=m.map(w=>{var E;return{slipNo:w.slipNo,date:w.date,seaweedType:h.get(w.seaweedTypeId)||n("unknown"),consumedWeightKg:w.consumedWeightKg,producedWeightKg:w.producedWeightKg,producedBalesCount:w.producedBalesCount,linkedExport:w.exportDocId?((E=f.get(w.exportDocId))==null?void 0:E.docNo)||"Linked":"No"}}),C=[{header:n("slipNo"),key:"slipNo",width:20},{header:n("date"),key:"date",width:15},{header:n("seaweedType"),key:"seaweedType",width:20},{header:n("bulkWeightConsumed"),key:"consumedWeightKg",width:20},{header:n("pressedWeightObtained"),key:"producedWeightKg",width:20},{header:n("bales"),key:"producedBalesCount",width:15},{header:n("linkedExport"),key:"linkedExport",width:20}];Ko(T,C,`PressingSlips_${new Date().toISOString().split("T")[0]}`,"Pressing Slips")};return s.jsxs("div",{className:"overflow-x-auto",children:[s.jsx("div",{className:"flex justify-end mb-2",children:s.jsxs(se,{onClick:N,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"})," ",n("exportExcel")]})}),s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 font-bold bg-gray-50 dark:bg-gray-800",children:[s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>x("slipNo"),className:"group flex items-center gap-2",children:[n("slipNo")," ",g("slipNo")]})}),s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>x("date"),className:"group flex items-center gap-2",children:[n("date")," ",g("date")]})}),s.jsx("th",{className:"p-3",children:n("seaweedType")}),s.jsx("th",{className:"p-3 text-right text-red-600",children:n("bulkWeightConsumed")}),s.jsx("th",{className:"p-3 text-right text-green-600",children:n("pressedWeightObtained")}),s.jsx("th",{className:"p-3 text-right",children:n("bales")}),s.jsx("th",{className:"p-3",children:n("linkedExport")}),s.jsx("th",{className:"p-3 text-right",children:n("actions")})]})}),s.jsx("tbody",{children:m.map(T=>{const C=T.exportDocId?f.get(T.exportDocId):null,w=!!C;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:T.slipNo}),s.jsx("td",{className:"p-3",children:T.date}),s.jsx("td",{className:"p-3 font-semibold",children:h.get(T.seaweedTypeId)||n("unknown")}),s.jsxs("td",{className:"p-3 text-right text-red-600 font-medium",children:["-",T.consumedWeightKg," kg"]}),s.jsxs("td",{className:"p-3 text-right text-green-600 font-bold",children:["+",T.producedWeightKg," kg"]}),s.jsx("td",{className:"p-3 text-right font-semibold",children:T.producedBalesCount}),s.jsx("td",{className:"p-3",children:C?s.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:C.docNo}):"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(se,{variant:"ghost",onClick:()=>t(T),disabled:w,children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(Dy,{content:n(w?"cannotDeleteLinkedSlip":"delete"),children:s.jsx(se,{variant:"danger",onClick:()=>e(T),disabled:w,children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})]})})]},T.id)})})]})]})},hz=()=>{const{t}=_e(),{pressedStockMovements:e,seaweedTypes:n}=qe(),{settings:r}=Ke(),[i,l]=S.useState({seaweedTypeId:"all",startDate:"",endDate:""}),{filteredBulkHistory:c,filteredPressedHistory:d}=S.useMemo(()=>{const h=i.seaweedTypeId==="all"?[...e]:e.filter(w=>w.seaweedTypeId===i.seaweedTypeId);h.sort((w,E)=>new Date(w.date).getTime()-new Date(E.date).getTime()||w.id.localeCompare(E.id));let m=0,x=0,g=0,N=0;const C=h.map(w=>{const E=[mt.BULK_IN_FROM_SITE,mt.FARMER_DELIVERY,mt.PRESSING_CONSUMPTION].includes(w.type);return E?(m+=(w.inKg||0)-(w.outKg||0),x+=(w.inBales||0)-(w.outBales||0),{...w,isBulk:E,balanceKg:m,balanceUnits:x}):(g+=(w.inKg||0)-(w.outKg||0),N+=(w.inBales||0)-(w.outBales||0),{...w,isBulk:E,balanceKg:g,balanceUnits:N})}).filter(w=>!(i.startDate&&w.date<i.startDate||i.endDate&&w.date>i.endDate));return{filteredBulkHistory:C.filter(w=>w.isBulk).reverse(),filteredPressedHistory:C.filter(w=>!w.isBulk).reverse()}},[e,i.seaweedTypeId,i.startDate,i.endDate]),f=()=>{const h=c.map(g=>({date:g.date,designation:`${t(`pressedStockMovement_${g.type}`)}: ${g.designation}`,inKg:g.inKg,inBags:g.inBales,outKg:g.outKg,outBags:g.outBales,balanceKg:g.balanceKg,balanceBags:g.balanceUnits})).reverse(),m=d.map(g=>({date:g.date,designation:`${t(`pressedStockMovement_${g.type}`)}: ${g.designation}`,inKg:g.inKg,inBales:g.inBales,outKg:g.outKg,outBales:g.outBales,balanceKg:g.balanceKg,balanceBales:g.balanceUnits})).reverse(),x=[{sheetName:t("bulkSeaweed"),columns:[{header:t("date"),key:"date",width:15},{header:t("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bags)",key:"inBags",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bags)",key:"outBags",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bags)",key:"balanceBags",width:15}],data:h},{sheetName:t("pressedSeaweed"),columns:[{header:t("date"),key:"date",width:15},{header:t("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bales)",key:"inBales",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bales)",key:"outBales",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bales)",key:"balanceBales",width:15}],data:m}];bE(x,`Warehouse_Movement_History_${new Date().toISOString().split("T")[0]}`)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 items-end",children:[s.jsxs(ke,{label:t("seaweedType"),value:i.seaweedTypeId,onChange:h=>l(m=>({...m,seaweedTypeId:h.target.value})),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),n.map(h=>s.jsx("option",{value:h.id,children:h.name},h.id))]}),s.jsx(de,{label:t("startDate"),type:"date",value:i.startDate,onChange:h=>l(m=>({...m,startDate:h.target.value}))}),s.jsx(de,{label:t("endDate"),type:"date",value:i.endDate,onChange:h=>l(m=>({...m,endDate:h.target.value}))}),s.jsxs(se,{onClick:f,variant:"secondary",className:"h-[42px]",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[s.jsx(ze,{title:`${t("bulkSeaweed")} (${t("forPressing")})`,children:s.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:s.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[s.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:t("date")}),s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:t("designation")}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("bags")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("bags")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center",children:t("bags")})]})]}),s.jsx("tbody",{children:c.map(h=>s.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),s.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[t(`pressedStockMovement_${h.type}`),": ",h.designation]}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${Ue(h.inKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales?`+${h.inBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${Ue(h.outKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:Ue(h.balanceKg,r.localization)}),s.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})}),s.jsx(ze,{title:`${t("pressedSeaweed")} (${t("bales")})`,children:s.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:s.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[s.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:t("date")}),s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:t("designation")}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("baleSingular")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("baleSingular")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center",children:t("baleSingular")})]})]}),s.jsx("tbody",{children:d.map(h=>s.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),s.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[t(`pressedStockMovement_${h.type}`),": ",h.designation]}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${Ue(h.inKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales||""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${Ue(h.outKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:Ue(h.balanceKg,r.localization)}),s.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})})]})]})},fz=()=>{const{t}=_e(),{deletePressingSlip:e}=qe(),[n,r]=S.useState("summary"),[i,l]=S.useState(!1),[c,d]=S.useState(null),[f,h]=S.useState(!1),[m,x]=S.useState(!1),[g,N]=S.useState(null),T=E=>{d(E),l(!0)},C=E=>{N(E),x(!0)},w=()=>{g&&!g.exportDocId&&e(g.id),x(!1),N(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("pressedWarehouseTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:()=>h(!0),children:[s.jsx(te,{name:"SlidersHorizontal",className:"w-5 h-5"}),t("recordStockAdjustment")]}),s.jsxs(se,{onClick:()=>T(null),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordPressingSlip")]})]})]}),s.jsxs(ze,{children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:s.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[s.jsx("button",{onClick:()=>r("summary"),className:`py-2 px-4 text-sm font-medium ${n==="summary"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("summaryView")}),s.jsx("button",{onClick:()=>r("slips"),className:`py-2 px-4 text-sm font-medium ${n==="slips"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("pressingSlips")}),s.jsx("button",{onClick:()=>r("history"),className:`py-2 px-4 text-sm font-medium ${n==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("movementHistory")})]})}),n==="summary"&&s.jsx(dz,{}),n==="slips"&&s.jsx(uz,{onEdit:E=>T(E),onDelete:C}),n==="history"&&s.jsx(hz,{})]}),s.jsx(lz,{isOpen:i,onClose:()=>l(!1),slip:c}),s.jsx(cz,{isOpen:f,onClose:()=>h(!1)}),m&&s.jsx(Qt,{isOpen:m,onClose:()=>x(!1),onConfirm:w,title:t("confirmDeleteTitle"),message:g!=null&&g.exportDocId?t("confirmDeletePressingSlipLinked"):t("confirmDeletePressingSlip"),confirmDisabled:!!(g!=null&&g.exportDocId)})]})},mz=({isOpen:t,onClose:e,doc:n})=>{const{t:r}=_e(),{seaweedTypes:i,pressingSlips:l,addExportDocument:c,updateExportDocument:d,pressedStockMovements:f}=qe(),h=S.useCallback(()=>{var P,U,q;return{docType:Cp.COMMERCIAL_INVOICE,invoiceNo:"",date:new Date().toISOString().split("T")[0],seaweedTypeId:((P=i[0])==null?void 0:P.id)||"",nature:"",poNo:"",domiciliationNo:"",destinationCountry:"",city:"",notifyParty:"",debtor:"",vessel:"",seaWaybill:"",voyageNo:"",currency:"EUR",localExchangeRate:"",pressingSlipIds:[],containers:[],customsNomenclature:"12, 122, 100, 000",countryOfOrigin:((U=an.find(z=>z.code==="MG"))==null?void 0:U.code)||((q=an[0])==null?void 0:q.code)||"",incoterms:kb[0]||"",paymentTerms:Db[0]||"",swiftBank:"",rexReference:""}},[i]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{x(n?{...h(),...n,localExchangeRate:String(n.localExchangeRate),containers:n.containers,rexReference:n.rexReference||""}:h())},[n,t,h]);const T=S.useMemo(()=>l.filter(P=>P.seaweedTypeId===m.seaweedTypeId&&(!P.exportDocId||P.exportDocId===(n==null?void 0:n.id))),[l,m.seaweedTypeId,n]),C=S.useMemo(()=>l.filter(P=>m.pressingSlipIds.includes(P.id)),[l,m.pressingSlipIds]),w=S.useMemo(()=>{const P=C.reduce((q,z)=>q+z.producedWeightKg,0),U=C.reduce((q,z)=>q+z.producedBalesCount,0);return{totalWeightKg:P,totalBales:U}},[C]),E=S.useMemo(()=>{const P=m.containers.reduce((q,z)=>q+Number(z.seaweedWeightKg||0),0),U=m.containers.reduce((q,z)=>q+Number(z.packagesCount||0),0);return{totalWeightKg:P,totalBales:U}},[m.containers]),D=S.useCallback(()=>{const P={};m.invoiceNo||(P.invoiceNo=r("validationRequired")),m.date||(P.date=r("validationRequired")),m.seaweedTypeId||(P.seaweedTypeId=r("validationRequired")),m.nature||(P.nature=r("validationRequired")),m.destinationCountry||(P.destinationCountry=r("validationRequired")),(!m.localExchangeRate||isNaN(parseFloat(m.localExchangeRate))||parseFloat(m.localExchangeRate)<=0)&&(P.localExchangeRate=r("validationPositiveNumber")),m.pressingSlipIds.length===0&&(P.pressingSlipIds=r("validationRequired")),m.containers.length===0&&(P.containers=r("validationRequired")),m.customsNomenclature||(P.customsNomenclature=r("validationRequired")),m.countryOfOrigin||(P.countryOfOrigin=r("validationRequired")),m.incoterms||(P.incoterms=r("validationRequired")),m.paymentTerms||(P.paymentTerms=r("validationRequired")),m.swiftBank||(P.swiftBank=r("validationRequired")),Math.abs(E.totalWeightKg-w.totalWeightKg)>.01&&(P.containers=r("validationContainerWeights")),E.totalBales!==w.totalBales&&(P.containers||(P.containers=r("validationContainerBales")));const U=m.containers.map(q=>{const z={};return q.containerNo||(z.containerNo=r("validationRequired")),q.sealNo||(z.sealNo=r("validationRequired")),z});return U.some(q=>Object.keys(q).length>0)&&(P.containerErrors=U),P},[m,r,E,w]);S.useEffect(()=>{N(D())},[m,D]);const I=(P,U)=>{const q={...m,[P]:U};P==="seaweedTypeId"&&(q.pressingSlipIds=[]),x(q)},k=P=>{const U=m.pressingSlipIds.includes(P)?m.pressingSlipIds.filter(q=>q!==P):[...m.pressingSlipIds,P];x(q=>({...q,pressingSlipIds:U}))},M=(P,U,q)=>{const z=[...m.containers],J={...z[P],[U]:q},Y=Number(J.tareKg)||0,G=Number(J.seaweedWeightKg)||0,B=Number(J.packageWeightKg)||0;J.grossWeightKg=Y+G+B;const Q=Number(J.unitPrice)||0;J.value=G*Q,z[P]=J,x(K=>({...K,containers:z}))},j=()=>{const P={id:`new-container-${Date.now()}`,containerNo:"",sealNo:"",containerType:Ep.GP40,volumeM3:0,tareKg:0,packageWeightKg:0,seaweedWeightKg:0,packagesCount:0,grossWeightKg:0,unitPrice:0,value:0};x(U=>({...U,containers:[...U.containers,P]}))},O=P=>{x(U=>({...U,containers:U.containers.filter((q,z)=>z!==P)}))},A=P=>{P.preventDefault();const U=D();if(Object.keys(U).length>0){N(U);return}const q={...m,localExchangeRate:parseFloat(m.localExchangeRate),containers:m.containers.map(Y=>({...Y,volumeM3:Number(Y.volumeM3)||0,tareKg:Number(Y.tareKg)||0,packageWeightKg:Number(Y.packageWeightKg)||0,seaweedWeightKg:Number(Y.seaweedWeightKg)||0,packagesCount:Number(Y.packagesCount)||0,grossWeightKg:Number(Y.grossWeightKg)||0,unitPrice:Number(Y.unitPrice)||0,value:Number(Y.value)||0}))},z=l.find(Y=>Y.id===q.pressingSlipIds[0]);if(!z){alert(r("alert_noValidSlips"));return}let J=z.sourceSiteId;if(!J){const Y=f.filter(G=>G.type===mt.BULK_IN_FROM_SITE&&G.seaweedTypeId===z.seaweedTypeId).sort((G,B)=>new Date(B.date).getTime()-new Date(G.date).getTime())[0];J=Y==null?void 0:Y.siteId}if(!J){console.error("Critical Error: Could not determine the origin site for the selected pressing slips.",z),alert(r("alert_cannotDetermineSourceSite"));return}n?d({...n,...q}):c(q,J),e()},F=Object.keys(g).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:r(n?"editExportDocument":"createExportDocument"),widthClass:"max-w-7xl",children:s.jsxs("form",{onSubmit:A,className:"flex flex-col max-h-[calc(90vh-130px)]",children:[s.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-6",children:[s.jsx(ze,{title:r("documentDetails"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(ke,{label:r("docType"),value:m.docType,onChange:P=>I("docType",P.target.value),children:Object.values(Cp).map(P=>s.jsx("option",{value:P,children:r(P)},P))}),s.jsx(de,{label:r("invoiceNo"),value:m.invoiceNo,onChange:P=>I("invoiceNo",P.target.value),error:g.invoiceNo}),s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:P=>I("date",P.target.value),error:g.date}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:P=>I("seaweedTypeId",P.target.value),error:g.seaweedTypeId,children:i.map(P=>s.jsx("option",{value:P.id,children:P.name},P.id))}),s.jsx(de,{containerClassName:"lg:col-span-2",label:r("natureLabel"),value:m.nature,onChange:P=>I("nature",P.target.value),error:g.nature}),s.jsx(de,{label:r("poNo"),value:m.poNo,onChange:P=>I("poNo",P.target.value)}),s.jsx(de,{label:r("domiciliationNo"),value:m.domiciliationNo,onChange:P=>I("domiciliationNo",P.target.value)}),s.jsx(de,{label:r("rexReference"),value:m.rexReference,onChange:P=>I("rexReference",P.target.value)}),s.jsx(de,{label:r("destinationCountry"),value:m.destinationCountry,onChange:P=>I("destinationCountry",P.target.value),error:g.destinationCountry}),s.jsx(de,{label:r("city"),value:m.city,onChange:P=>I("city",P.target.value)}),s.jsx(de,{label:r("notifyParty"),value:m.notifyParty,onChange:P=>I("notifyParty",P.target.value)}),s.jsx(de,{label:r("debtor"),value:m.debtor,onChange:P=>I("debtor",P.target.value)}),s.jsx(de,{label:r("vessel"),value:m.vessel,onChange:P=>I("vessel",P.target.value)}),s.jsx(de,{label:r("seaWaybill"),value:m.seaWaybill,onChange:P=>I("seaWaybill",P.target.value)}),s.jsx(de,{label:r("voyageNo"),value:m.voyageNo,onChange:P=>I("voyageNo",P.target.value)}),s.jsxs(ke,{label:r("currency"),value:m.currency,onChange:P=>I("currency",P.target.value),children:[s.jsx("option",{value:"EUR",children:"EUR"}),s.jsx("option",{value:"USD",children:"USD"})]}),s.jsx(de,{label:r("localExchangeRate"),type:"number",step:"any",value:m.localExchangeRate,onChange:P=>I("localExchangeRate",P.target.value),error:g.localExchangeRate}),s.jsx(de,{label:r("customsNomenclature"),value:m.customsNomenclature,onChange:P=>I("customsNomenclature",P.target.value),error:g.customsNomenclature,containerClassName:"lg:col-span-2"}),s.jsx(ke,{label:r("countryOfOrigin"),value:m.countryOfOrigin,onChange:P=>I("countryOfOrigin",P.target.value),error:g.countryOfOrigin,containerClassName:"lg:col-span-2",children:an.map(P=>s.jsx("option",{value:P.code,children:P.name},P.code))}),s.jsx(ke,{label:r("incoterms"),value:m.incoterms,onChange:P=>I("incoterms",P.target.value),error:g.incoterms,containerClassName:"lg:col-span-2",children:kb.map(P=>s.jsx("option",{value:P,children:r(P)},P))}),s.jsx(ke,{label:r("paymentTerms"),value:m.paymentTerms,onChange:P=>I("paymentTerms",P.target.value),error:g.paymentTerms,containerClassName:"lg:col-span-2",children:Db.map(P=>s.jsx("option",{value:P,children:r(P)},P))}),s.jsx(de,{label:r("swiftBank"),value:m.swiftBank,onChange:P=>I("swiftBank",P.target.value),error:g.swiftBank,containerClassName:"lg:col-span-4"})]})}),s.jsxs(ze,{title:r("selectPressingSlips"),children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:r("availableSlips")}),s.jsxs("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:[T.filter(P=>!m.pressingSlipIds.includes(P.id)).map(P=>s.jsxs("div",{onClick:()=>k(P.id),className:"p-2 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/50 cursor-pointer flex justify-between",children:[s.jsxs("span",{children:[P.slipNo," (",P.producedBalesCount," ",r("bales"),")"]}),s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 text-green-500"})]},P.id)),T.length===0&&s.jsx("p",{className:"text-sm text-gray-500 p-2",children:r("noSlipsAvailable")})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:r("selectedSlips")}),s.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:C.map(P=>s.jsxs("div",{onClick:()=>k(P.id),className:"p-2 rounded-md bg-blue-50 dark:bg-blue-900/30 hover:bg-red-50 dark:hover:bg-red-900/30 cursor-pointer flex justify-between",children:[s.jsxs("span",{children:[P.slipNo," (",P.producedBalesCount," ",r("bales"),")"]}),s.jsx(te,{name:"X",className:"w-5 h-5 text-red-500"})]},P.id))})]})]}),g.pressingSlipIds&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:g.pressingSlipIds}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[s.jsxs("div",{children:[r("totalSelectedWeight"),": ",w.totalWeightKg.toFixed(2)," kg"]}),s.jsxs("div",{children:[r("totalSelectedBales"),": ",w.totalBales]})]})]}),s.jsxs(ze,{title:r("containerManagement"),children:[s.jsx("div",{className:"space-y-4",children:m.containers.map((P,U)=>{var q,z,J,Y;return s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg relative",children:[s.jsx(se,{type:"button",variant:"danger",onClick:()=>O(U),className:"absolute top-2 right-2 p-1 !rounded-full h-8 w-8",children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})}),s.jsxs("h5",{className:"font-semibold mb-3 text-lg",children:[r("container")," #",U+1]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-3 gap-x-6 gap-y-4",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("identification")}),s.jsx(de,{label:r("containerNo"),value:P.containerNo,onChange:G=>M(U,"containerNo",G.target.value),error:(z=(q=g.containerErrors)==null?void 0:q[U])==null?void 0:z.containerNo}),s.jsx(de,{label:r("sealNo"),value:P.sealNo,onChange:G=>M(U,"sealNo",G.target.value),error:(Y=(J=g.containerErrors)==null?void 0:J[U])==null?void 0:Y.sealNo}),s.jsx(ke,{label:r("containerType"),value:P.containerType,onChange:G=>M(U,"containerType",G.target.value),children:Object.values(Ep).map(G=>s.jsx("option",{value:G,children:G},G))}),s.jsx(de,{label:r("volumeM3"),type:"number",value:P.volumeM3,onChange:G=>M(U,"volumeM3",G.target.value)})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("weights")}),s.jsx(de,{label:r("tareKg"),type:"number",value:P.tareKg,onChange:G=>M(U,"tareKg",G.target.value)}),s.jsx(de,{label:r("packageWeightKg"),type:"number",value:P.packageWeightKg||"",onChange:G=>M(U,"packageWeightKg",G.target.value)}),s.jsx(de,{label:r("seaweedWeightKg"),type:"number",value:P.seaweedWeightKg,onChange:G=>M(U,"seaweedWeightKg",G.target.value)}),s.jsx(de,{label:r("grossWeightKg"),type:"number",value:P.grossWeightKg,disabled:!0})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("contentsAndValue")}),s.jsx(de,{label:r("packagesCount"),type:"number",value:P.packagesCount,onChange:G=>M(U,"packagesCount",G.target.value)}),s.jsx(de,{label:r("unitPrice"),type:"number",step:"any",value:P.unitPrice,onChange:G=>M(U,"unitPrice",G.target.value)}),s.jsx(de,{label:r("value"),type:"number",value:P.value,disabled:!0})]})]})})]},P.id||U)})}),g.containers&&s.jsx("p",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:g.containers}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[s.jsxs("div",{children:[r("totalContainerWeight"),": ",E.totalWeightKg.toFixed(2)," kg"]}),s.jsxs("div",{children:[r("totalContainerBales"),": ",E.totalBales]})]}),s.jsxs(se,{type:"button",variant:"secondary",onClick:j,className:"mt-4",children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),r("addContainer")]})]})]}),s.jsxs("footer",{className:"flex-shrink-0 flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700 mt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{type:"submit",disabled:F,children:r("save")})]})]})})},Xs=({children:t,landscape:e=!1})=>e?s.jsx("div",{className:"print-page report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col",children:t}):s.jsx("div",{className:"print-page bg-white shadow-lg mx-auto my-8",children:s.jsx("div",{className:"p-12 text-black font-serif",children:t})}),Ai={units:["","one","two","three","four","five","six","seven","eight","nine"],teens:["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],tens:["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],scales:["","thousand","million","billion","trillion"],and:"and",zero:"zero"},Qn={units:["zro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],teens:["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],tens:["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"],scales:["","mille","million","milliard","billion"]},R_=t=>{if(t===0)return Qn.units[0];const e=c=>{if(c===0)return"";if(c<10)return Qn.units[c];if(c<20)return Qn.teens[c-10];const d=Math.floor(c/10),f=c%10;if(d===7||d===9)return`${Qn.tens[d-1]}-${Qn.teens[f]}`;let h=Qn.tens[d];return f>0?f===1&&d<8&&d>1?h+=" et un":h+=`-${Qn.units[f]}`:d===8&&(h+="s"),h},n=c=>{const d=Math.floor(c/100),f=c%100;let h="";return d>0&&(h=d>1?`${Qn.units[d]} cent`:"cent",f===0&&d>1&&(h+="s")),f>0&&(h+=(h?" ":"")+e(f)),h};let r=[],i=0;for(;t>0;){const c=t%1e3;if(c>0){let d=n(c);if(i>0){c===1&&i===1&&(d="");let f=Qn.scales[i];c>1&&i>1&&(f+="s"),r.unshift(f)}d&&r.unshift(d)}t=Math.floor(t/1e3),i++}let l=r.join(" ").trim();l=l.replace(/quatre-vingt(?!\S)/g,"quatre-vingts"),l=l.replace(/quatre-vingts-un/g,"quatre-vingt-un"),l=l.replace(/quatre-vingts-onze/g,"quatre-vingt-onze"),l=l.replace(/cent(?!\S)/g,"cents");for(let c=1;c<10;c++)l=l.replace(new RegExp(`cents ${Qn.units[c]}`,"g"),`cent ${Qn.units[c]}`),l=l.replace(new RegExp(`cents ${Qn.teens[c-1]}`,"g"),`cent ${Qn.teens[c-1]}`);for(let c=2;c<10;c++)l=l.replace(new RegExp(`cents ${Qn.tens[c]}`,"g"),`cent ${Qn.tens[c]}`);return l=l.replace(/cents et un/g,"cent et un"),l=l.replace(/cents mille/g,"cent mille"),l.replace("un mille","mille")},M_=t=>{if(t===0)return Ai.zero;const e=l=>{if(l===0)return"";if(l<10)return Ai.units[l];if(l<20)return Ai.teens[l-10];const c=Math.floor(l/10),d=l%10;return Ai.tens[c]+(d>0?`-${Ai.units[d]}`:"")},n=l=>{const c=Math.floor(l/100),d=l%100;let f="";return c>0&&(f=`${Ai.units[c]} hundred`),d>0&&(f+=(f?` ${Ai.and} `:"")+e(d)),f};let r=[],i=0;for(;t>0;){const l=t%1e3;l>0&&(r.unshift(Ai.scales[i]),r.unshift(n(l))),t=Math.floor(t/1e3),i++}return r.filter(Boolean).join(" ").trim()},SE=(t,e="en",n)=>{const r=Math.floor(t),i=Math.round((t-r)*10**((n==null?void 0:n.monetaryDecimals)||2));let l;e==="fr"?l=R_(r):l=M_(r);let c=l;if(n!=null&&n.currency&&(c+=` ${n.currency}`),i>0){let d;e==="fr"?d=R_(i):d=M_(i),c+=` ${e==="fr"?"et":"and"} ${d} ${e==="fr"?"centimes":"cents"}`}return c&&(c=c.charAt(0).toUpperCase()+c.slice(1)),c},pz=({doc:t})=>{var x;const{settings:e}=Ke(),{t:n,language:r}=_e(),{seaweedTypes:i}=qe();i.find(g=>g.id===t.seaweedTypeId);const l=t.containers.reduce((g,N)=>g+N.packagesCount,0),c=t.containers.reduce((g,N)=>g+N.seaweedWeightKg,0),d=t.containers.reduce((g,N)=>g+N.value,0),f=t.currency==="EUR"?"":t.currency==="USD"?"$":t.currency,h=SE(d,r,{currency:t.currency,monetaryDecimals:2}),m=new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB");return s.jsxs(Xs,{children:[s.jsxs("header",{className:"flex justify-between items-start mb-8",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),s.jsx("h1",{className:"font-bold text-lg",children:e.company.name}),s.jsx("p",{className:"text-xs",children:e.company.address}),s.jsxs("p",{className:"text-xs",children:["NIF: ",e.company.nif," / STAT: ",e.company.stat," / RC: ",e.company.rc]}),s.jsxs("p",{className:"text-xs",children:["Tel: ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("h2",{className:"text-3xl font-bold uppercase",children:[n("COMMERCIAL_INVOICE")," N ",t.invoiceNo]}),s.jsxs("div",{className:"mt-4 space-y-1",children:[t.rexReference&&s.jsxs("p",{children:[n("rexReference"),": ",t.rexReference]}),s.jsxs("p",{children:[n("domiciliationNo")," N ",t.domiciliationNo]}),s.jsxs("p",{children:[n("dateLabel")," ",m]})]})]})]}),s.jsxs("section",{className:"mb-8",children:[s.jsx("table",{className:"w-full text-sm",children:s.jsx("tbody",{children:s.jsxs("tr",{children:[s.jsxs("td",{className:"w-1/2 align-top pr-4",children:[s.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:n("debtor")}),s.jsxs("div",{className:"border p-2 min-h-[100px]",children:[s.jsx("p",{className:"font-bold text-base",children:t.debtor}),t.debtorAddress&&s.jsx("p",{className:"whitespace-pre-wrap",children:t.debtorAddress}),(t.debtorPhone||t.debtorEmail)&&s.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[t.debtorPhone&&s.jsxs("span",{children:["Tel: ",t.debtorPhone," "]}),t.debtorEmail&&s.jsxs("span",{children:["Email: ",t.debtorEmail]})]})]})]}),s.jsxs("td",{className:"w-1/2 align-top pl-4",children:[s.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:n("notifyParty")}),s.jsxs("div",{className:"border p-2 min-h-[100px]",children:[s.jsx("p",{className:"font-bold text-base",children:t.notifyParty}),t.notifyPartyAddress?s.jsx("p",{className:"whitespace-pre-wrap",children:t.notifyPartyAddress}):s.jsxs("p",{children:[t.city,", ",t.destinationCountry]}),(t.notifyPartyPhone||t.notifyPartyEmail)&&s.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[t.notifyPartyPhone&&s.jsxs("span",{children:["Tel: ",t.notifyPartyPhone," "]}),t.notifyPartyEmail&&s.jsxs("span",{children:["Email: ",t.notifyPartyEmail]})]})]})]})]})})}),s.jsxs("p",{className:"text-sm mt-4",children:[s.jsxs("span",{className:"font-bold",children:[n("orderRef"),":"]})," ",t.poNo]})]}),s.jsx("section",{children:s.jsxs("table",{className:"w-full border-collapse border border-black text-sm text-black",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border border-black p-1",children:n("description")}),s.jsx("th",{className:"border border-black p-1",children:n("packages")}),s.jsxs("th",{className:"border border-black p-1",children:[n("netWeight")," (Kg)"]}),s.jsxs("th",{className:"border border-black p-1",children:[n("unitPrice")," (",t.currency,")"]}),s.jsxs("th",{className:"border border-black p-1",children:[n("amount")," (",t.currency,")"]})]})}),s.jsx("tbody",{children:s.jsxs("tr",{children:[s.jsxs("td",{className:"border border-black p-1 h-32 align-top",children:[s.jsx("p",{children:t.nature}),s.jsxs("p",{children:["Incoterm: ",t.incoterms]}),s.jsxs("p",{children:["HS Code: ",t.customsNomenclature]}),s.jsxs("p",{children:["Country of Origin: ",t.countryOfOrigin]})]}),s.jsx("td",{className:"border border-black p-1 align-top text-center",children:l}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ue(c,e.localization)}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(((x=t.containers[0])==null?void 0:x.unitPrice)||0,{...e.localization,currencySymbol:""})}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(d,{...e.localization,currencySymbol:""})})]})}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold",children:[s.jsx("td",{colSpan:3,className:"border border-black p-1",children:n("totalExclTax")}),s.jsx("td",{colSpan:2,className:"border border-black p-1 text-right",children:Ae(d,{...e.localization,currencySymbol:f})})]})})]})}),s.jsx("section",{className:"mt-4 text-sm",children:s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("amountInWords"),":"]})," ",h]})}),s.jsxs("section",{className:"mt-8 text-xs space-y-1",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("paymentTerms"),":"]})," ",t.paymentTerms]}),s.jsx("p",{children:s.jsxs("span",{className:"font-bold",children:[n("bankDetails"),":"]})}),s.jsx("p",{className:"pl-4",children:e.company.name}),s.jsxs("p",{className:"pl-4",children:["SWIFT: ",t.swiftBank]})]}),s.jsx("footer",{className:"mt-16 text-right",children:s.jsxs("div",{className:"inline-block text-center",children:[s.jsx("p",{className:"mb-12",children:n("theManager")}),s.jsx("hr",{className:"border-black"})]})})]})},gz=({doc:t})=>{var x;const{settings:e}=Ke(),{t:n,language:r}=_e(),{seaweedTypes:i}=qe(),l=i.find(g=>g.id===t.seaweedTypeId),c=t.containers.reduce((g,N)=>g+N.packagesCount,0),d=t.containers.reduce((g,N)=>g+N.seaweedWeightKg,0),f=t.containers.reduce((g,N)=>g+N.grossWeightKg,0),h=new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB"),m=((x=an.find(g=>g.name.toLowerCase()===t.destinationCountry.toLowerCase()))==null?void 0:x.name)||t.destinationCountry;return s.jsxs(Xs,{children:[s.jsxs("header",{className:"flex justify-between items-start mb-8",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),s.jsx("h1",{className:"font-bold text-lg",children:e.company.name}),s.jsx("p",{className:"text-xs",children:e.company.address}),s.jsxs("p",{className:"text-xs",children:["NIF: ",e.company.nif," / STAT: ",e.company.stat," / RC: ",e.company.rc]}),s.jsxs("p",{className:"text-xs",children:["Tel: ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("h2",{className:"text-2xl font-bold uppercase",children:n("packingAndWeightList")}),s.jsxs("p",{className:"mt-2",children:[n("invoiceNoLabel"),": ",t.invoiceNo]}),s.jsxs("p",{className:"mt-1",children:[n("dateLabel"),": ",h]})]})]}),s.jsxs("section",{className:"text-sm mb-8 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("senderLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[e.company.name," / PC ",t.debtor]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("recipientLabel"),":"]}),s.jsxs("div",{className:"col-span-4",children:[s.jsx("p",{children:t.notifyParty}),s.jsxs("p",{children:[t.city,", ",m]})]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("natureLabel"),":"]}),s.jsx("span",{className:"col-span-4",children:t.nature})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("packageCountLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[c," ",n("bales")]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("grossWeightLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[Ue(f,e.localization)," Kg"]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("netWeightLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[Ue(d,e.localization)," Kg"]})]})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-sm mb-8 text-black",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border border-black p-1",children:n("containerNo")}),s.jsx("th",{className:"border border-black p-1",children:n("sealNo")}),s.jsx("th",{className:"border border-black p-1",children:n("tareKg")}),s.jsx("th",{className:"border border-black p-1",children:n("packageWeightKg")}),s.jsx("th",{className:"border border-black p-1",children:n("seaweedType")}),s.jsx("th",{className:"border border-black p-1",children:n("netWeightLabel")}),s.jsx("th",{className:"border border-black p-1",children:n("packages")}),s.jsx("th",{className:"border border-black p-1",children:n("grossWeightLabel")})]})}),s.jsxs("tbody",{children:[t.containers.map(g=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-black p-1",children:g.containerNo}),s.jsx("td",{className:"border border-black p-1",children:g.sealNo}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(g.tareKg,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(g.packageWeightKg||0,e.localization)," Kg"]}),s.jsx("td",{className:"border border-black p-1",children:l==null?void 0:l.name}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(g.seaweedWeightKg,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[g.packagesCount," ",n("bales")]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(g.grossWeightKg,e.localization)," Kg"]})]},g.id)),s.jsxs("tr",{className:"font-bold bg-gray-100",children:[s.jsx("td",{colSpan:5,className:"border border-black p-1"}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(d,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[c," ",n("bales")]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[Ue(f,e.localization)," Kg"]})]})]})]}),s.jsx("p",{className:"text-sm mb-16",children:n("customsWeighingStatement")}),s.jsx("p",{className:"text-sm mb-8 text-center",children:n("signedAtLocation").replace("{location}","Antsiranana").replace("{date}",h)}),s.jsx("footer",{className:"mt-16 text-right",children:s.jsxs("div",{className:"inline-block text-center",children:[s.jsx("p",{className:"mb-16",children:n("theManager")}),s.jsx("hr",{className:"border-black"}),s.jsxs("p",{className:"text-sm",children:[n("perProcurationem")," ",e.company.name]})]})})]})},yz=({doc:t})=>{var f,h;const{settings:e}=Ke(),{t:n}=_e(),r=t.containers.reduce((m,x)=>m+x.packagesCount,0),i=t.containers.reduce((m,x)=>m+x.seaweedWeightKg,0),l=t.containers.reduce((m,x)=>m+x.grossWeightKg,0),c=((f=an.find(m=>m.code===t.countryOfOrigin))==null?void 0:f.name)||t.countryOfOrigin,d=((h=an.find(m=>m.name.toLowerCase()===t.destinationCountry.toLowerCase()))==null?void 0:h.name)||t.destinationCountry;return s.jsx(Xs,{children:s.jsxs("div",{className:"border-2 border-black p-4",children:[s.jsx("header",{className:"text-center mb-6",children:s.jsx("h1",{className:"text-2xl font-bold uppercase",children:n("CERTIFICATE_OF_ORIGIN")})}),s.jsx("table",{className:"w-full border-collapse text-xs text-black",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black w-1/2",children:[s.jsxs("p",{className:"font-bold",children:["1. ",n("exporter")]}),s.jsx("p",{className:"pl-4",children:e.company.name}),s.jsx("p",{className:"pl-4",children:e.company.address})]}),s.jsxs("td",{className:"p-2 border border-black w-1/2",rowSpan:2,children:[s.jsx("p",{className:"font-bold text-center",children:n("CERTIFICATE_OF_ORIGIN").toUpperCase()}),s.jsxs("p",{className:"text-center",children:[n("refNo")," ",t.docNo]})]})]}),s.jsx("tr",{children:s.jsxs("td",{className:"p-2 border border-black w-1/2",children:[s.jsxs("p",{className:"font-bold",children:["2. ",n("consignee")]}),s.jsx("p",{className:"pl-4 font-semibold",children:t.notifyParty}),t.notifyPartyAddress?s.jsx("p",{className:"pl-4 whitespace-pre-wrap",children:t.notifyPartyAddress}):s.jsxs("p",{className:"pl-4",children:[t.city,", ",d]}),(t.notifyPartyPhone||t.notifyPartyEmail)&&s.jsxs("p",{className:"pl-4 mt-1 text-xs",children:[t.notifyPartyPhone&&s.jsxs("span",{children:["Tel: ",t.notifyPartyPhone," "]}),t.notifyPartyEmail&&s.jsxs("span",{children:["Email: ",t.notifyPartyEmail]})]})]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,className:"p-2 border border-black",children:[s.jsxs("p",{className:"font-bold",children:["3. ",n("transportDetails")]}),s.jsxs("p",{className:"pl-4",children:[n("vessel"),": ",t.vessel," / ",n("voyageNo"),": ",t.voyageNo]}),s.jsxs("p",{className:"pl-4",children:[n("seaWaybill"),": ",t.seaWaybill]})]})}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["4. ",n("marksAndNumbers")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["5. ",n("packagesAndDescription")]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"p-2 border border-black align-top h-24",children:t.containers.map(m=>s.jsx("p",{children:m.containerNo},m.id))}),s.jsxs("td",{className:"p-2 border border-black align-top h-24",children:[s.jsxs("p",{children:[r," ",n("bales")]}),s.jsx("p",{children:t.nature}),s.jsxs("p",{children:["HS Code: ",t.customsNomenclature]})]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["6. ",n("originCriterion")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["7. ",n("quantity")]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"p-2 border border-black align-top h-16",children:n("originCriterionA")}),s.jsxs("td",{className:"p-2 border border-black align-top h-16",children:[s.jsxs("p",{children:[n("netWeightLabel"),": ",Ue(i,e.localization)," KGS"]}),s.jsxs("p",{children:[n("grossWeightLabel"),": ",Ue(l,e.localization)," KGS"]})]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["8. ",n("invoiceNumberAndDate")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["9. ",n("remarks")]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black align-top h-12",children:[t.invoiceNo," / ",t.date]}),s.jsx("td",{className:"p-2 border border-black align-top h-12"})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[s.jsxs("p",{className:"font-bold",children:["10. ",n("declarationByExporter")]}),s.jsx("p",{className:"mt-1",children:n("exporterDeclarationText")}),s.jsx("p",{className:"font-bold text-center mt-2",children:c}),s.jsx("div",{className:"mt-8 text-right",children:s.jsx("p",{className:"border-t border-black pt-1 inline-block",children:n("placeDateSignature")})})]}),s.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[s.jsxs("p",{className:"font-bold",children:["11. ",n("certification")]}),s.jsx("p",{className:"mt-1",children:n("certificationText")}),s.jsx("div",{className:"mt-16 text-right",children:s.jsx("p",{className:"border-t border-black pt-1 inline-block",children:n("placeDateSignature")})})]})]})]})})]})})},xz=({isOpen:t,onClose:e,doc:n,docTypeToShow:r})=>{const{t:i}=_e(),{settings:l}=Ke(),[c,d]=S.useState(!1),f=()=>{switch(r){case"invoice":return`${i("printInvoice")} - ${n.docNo}`;case"packing-list":return`${i("printPackingList")} - ${n.docNo}`;case"cert-of-origin":return`${i("printCertOfOrigin")} - ${n.docNo}`;case"all":default:return`${i("printDocumentsFor")} ${n.docNo}`}},h=()=>{window.print()},m=async()=>{d(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:x}=window.jspdf,g=window.html2canvas,N=document.getElementById("printable-area");if(!N)throw new Error("Printable area not found");const T=new x({orientation:"p",unit:"mm",format:"a4",compress:!0});T.setProperties({title:`Export Documents - ${n.docNo}`,subject:"Export Documentation",author:l.company.name,creator:"AlgaManage"});const C=N.getElementsByClassName("print-page");for(let w=0;w<C.length;w++){const D=(await g(C[w],{scale:4,useCORS:!0,windowWidth:1200,backgroundColor:"#ffffff"})).toDataURL("image/png");w>0&&T.addPage();const I=T.getImageProperties(D),k=T.internal.pageSize.getWidth(),M=I.height*k/I.width;T.addImage(D,"PNG",0,0,k,M,void 0,"FAST")}T.save(`Export-Documents-${n.docNo}.pdf`)}catch(x){console.error("Error generating PDF:",x),alert(i("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),d(!1)}};return s.jsxs(ot,{isOpen:t,onClose:e,title:f(),widthClass:"max-w-screen-lg",children:[s.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(se,{onClick:m,disabled:c,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:c?"Activity":"Download",className:`w-5 h-5 ${c?"animate-spin":""}`}),s.jsx("span",{className:"ml-2",children:i(c?"downloading":"downloadPdf")})]}),s.jsxs(se,{onClick:h,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2",children:i("print")})]})]})}),s.jsxs("div",{id:"printable-area",className:"bg-gray-200 dark:bg-gray-700 p-4 sm:p-8",children:[(r==="invoice"||r==="all")&&s.jsx(pz,{doc:n}),(r==="packing-list"||r==="all")&&s.jsx(gz,{doc:n}),(r==="cert-of-origin"||r==="all")&&s.jsx(yz,{doc:n})]})]})},vz=()=>{const{t}=_e(),{settings:e}=Ke(),{exportDocuments:n,seaweedTypes:r,deleteExportDocument:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,T]=S.useState({key:"date",direction:"descending"}),[C,w]=S.useState(!1),[E,D]=S.useState(null),[I,k]=S.useState("all"),[M,j]=S.useState(null),O=S.useRef(null),A=S.useMemo(()=>new Map(r.map(Q=>[Q.id,Q.name])),[r]),F=S.useMemo(()=>{let Q=n.map(K=>({...K,totalValue:K.containers.reduce((re,H)=>re+H.value,0)}));return Q.sort((K,re)=>{let H,ae;switch(N.key){case"seaweedTypeName":H=A.get(K.seaweedTypeId)||"",ae=A.get(re.seaweedTypeId)||"";break;case"totalValue":H=K.totalValue,ae=re.totalValue;break;default:H=K[N.key],ae=re[N.key]}return H==null?1:ae==null?-1:H<ae?N.direction==="ascending"?-1:1:H>ae?N.direction==="ascending"?1:-1:0}),Q},[n,N,A]);S.useEffect(()=>{const Q=K=>{O.current&&!O.current.contains(K.target)&&j(null)};return document.addEventListener("mousedown",Q),()=>{document.removeEventListener("mousedown",Q)}},[]);const P=Q=>{let K="ascending";N.key===Q&&N.direction==="ascending"&&(K="descending"),T({key:Q,direction:K})},U=Q=>N.key!==Q?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),q=({sortKey:Q,label:K,className:re})=>s.jsx("th",{className:`p-3 ${re}`,children:s.jsxs("button",{onClick:()=>P(Q),className:`group flex items-center gap-2 w-full ${re!=null&&re.includes("text-right")?"justify-end":""}`,children:[K,U(Q)]})}),z=(Q=null)=>{f(Q),c(!0)},J=()=>{f(null),c(!1)},Y=Q=>{g(Q),m(!0)},G=()=>{x&&i(x),m(!1),g(null)},B=(Q,K)=>{D(Q),k(K),w(!0),j(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("exports")}),s.jsxs(se,{onClick:()=>z(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("createExportDocument")]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(q,{sortKey:"docNo",label:t("docNo")}),s.jsx(q,{sortKey:"date",label:t("date")}),s.jsx(q,{sortKey:"invoiceNo",label:t("invoiceNo")}),s.jsx(q,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(q,{sortKey:"destinationCountry",label:t("destination")}),s.jsx("th",{className:"p-3 text-center",children:t("containers")}),s.jsx(q,{sortKey:"totalValue",label:t("totalValue"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[F.map(Q=>{const K=Q.currency==="EUR"?"":Q.currency==="USD"?"$":Q.currency;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:Q.docNo}),s.jsx("td",{className:"p-3",children:Q.date}),s.jsx("td",{className:"p-3",children:Q.invoiceNo}),s.jsx("td",{className:"p-3",children:A.get(Q.seaweedTypeId)||Q.seaweedTypeId}),s.jsx("td",{className:"p-3",children:Q.destinationCountry}),s.jsx("td",{className:"p-3 text-center",children:Q.containers.length}),s.jsx("td",{className:"p-3 text-right",children:Ae(Q.totalValue,{...e.localization,currencySymbol:K})}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"relative flex justify-end gap-1",ref:M===Q.id?O:null,children:[s.jsxs(se,{variant:"ghost",onClick:()=>j(M===Q.id?null:Q.id),children:[t("documents"),s.jsx(te,{name:"ChevronDown",className:"w-4 h-4"})]}),M===Q.id&&s.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-md shadow-lg z-10 p-1",children:[s.jsxs("button",{onClick:()=>B(Q,"invoice"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"})," ",t("printInvoice")]}),s.jsxs("button",{onClick:()=>B(Q,"packing-list"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Package",className:"w-4 h-4"})," ",t("printPackingList")]}),s.jsxs("button",{onClick:()=>B(Q,"cert-of-origin"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Globe",className:"w-4 h-4"})," ",t("printCertOfOrigin")]}),s.jsx("div",{className:"my-1 border-t dark:border-gray-600"}),s.jsxs("button",{onClick:()=>B(Q,"all"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Printer",className:"w-4 h-4"})," ",t("printAllDocuments")]})]}),s.jsx(se,{variant:"ghost",onClick:()=>z(Q),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>Y(Q.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},Q.id)}),F.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:t("noDataForReport")})})]})]})})}),l&&s.jsx(mz,{isOpen:l,onClose:J,doc:d}),C&&E&&s.jsx(xz,{isOpen:C,onClose:()=>w(!1),doc:E,docTypeToShow:I}),h&&s.jsx(Qt,{isOpen:h,onClose:()=>m(!1),onConfirm:G,title:t("confirmDeleteTitle"),message:t("confirmDeleteExport")})]})},bz=()=>{const{t}=_e(),{serviceProviders:e,addServiceProvider:n,updateServiceProvider:r,deleteServiceProvider:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,T]=S.useState({key:"name",direction:"ascending"}),C=S.useMemo(()=>{let O=[...e];return O.sort((A,F)=>{const P=A[N.key]||"",U=F[N.key]||"";return P<U?N.direction==="ascending"?-1:1:P>U?N.direction==="ascending"?1:-1:0}),O},[e,N]),w=O=>{let A="ascending";N.key===O&&N.direction==="ascending"&&(A="descending"),T({key:O,direction:A})},E=O=>N.key!==O?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),D=({sortKey:O,label:A,className:F})=>s.jsx("th",{className:`p-3 ${F}`,children:s.jsxs("button",{onClick:()=>w(O),className:`group flex items-center gap-2 w-full ${F!=null&&F.includes("text-right")?"justify-end":""}`,children:[A,E(O)]})}),I=(O=null)=>{f(O),c(!0)},k=()=>{f(null),c(!1)},M=O=>{g(O),m(!0)},j=()=>{x&&i(x),m(!1),g(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("serviceProvidersTitle")}),s.jsxs(se,{onClick:()=>I(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addProvider")]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(D,{sortKey:"name",label:t("name")}),s.jsx(D,{sortKey:"serviceType",label:t("serviceType")}),s.jsx(D,{sortKey:"contactPerson",label:t("contactPerson")}),s.jsx(D,{sortKey:"phone",label:t("phone")}),s.jsx(D,{sortKey:"email",label:t("email")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[C.map(O=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-semibold",children:O.name}),s.jsx("td",{className:"p-3",children:O.serviceType}),s.jsx("td",{className:"p-3",children:O.contactPerson||"-"}),s.jsx("td",{className:"p-3",children:O.phone}),s.jsx("td",{className:"p-3",children:O.email||"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>I(O),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("edit")]}),s.jsx(se,{variant:"danger",onClick:()=>M(O.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},O.id)),C.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"p-6 text-center text-gray-500",children:t("noProviders")})})]})]})})}),l&&s.jsx(Nz,{isOpen:l,onClose:k,provider:d,onSave:O=>{d?r({...d,...O}):n(O),k()}}),h&&s.jsx(Qt,{isOpen:h,onClose:()=>m(!1),onConfirm:j,title:t("confirmDeleteTitle"),message:t("confirmDeleteProvider")})]})},Nz=({isOpen:t,onClose:e,provider:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState({name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]}),[d,f]=S.useState({});S.useEffect(()=>{c(n?{name:n.name,serviceType:n.serviceType,contactPerson:n.contactPerson||"",phone:n.phone,email:n.email||"",address:n.address||"",joinDate:n.joinDate||new Date().toISOString().split("T")[0]}:{name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]})},[n,t]);const h=S.useCallback(()=>{const N={};return l.name.trim()||(N.name=i("validationRequired")),l.serviceType.trim()||(N.serviceType=i("validationRequired")),l.phone.trim()||(N.phone=i("validationRequired")),l.email&&!/\S+@\S+\.\S+/.test(l.email)&&(N.email=i("validationEmail")),N},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(N,T)=>{c(C=>({...C,[N]:T}))},x=N=>{N.preventDefault();const T=h();if(Object.keys(T).length>0){f(T);return}r({...l,status:(n==null?void 0:n.status)||Cg.ACTIVE,contactPerson:l.contactPerson||void 0,email:l.email||void 0,address:l.address||void 0})},g=Object.keys(d).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i(n?"editProvider":"addProvider"),widthClass:"max-w-3xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:x,disabled:g,children:i("save")})]}),children:s.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:i("name"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name,required:!0,autoFocus:!0}),s.jsx(de,{label:i("serviceType"),value:l.serviceType,onChange:N=>m("serviceType",N.target.value),error:d.serviceType,required:!0}),s.jsx(de,{label:`${i("contactPerson")} (${i("optional")})`,value:l.contactPerson,onChange:N=>m("contactPerson",N.target.value)}),s.jsx(de,{label:i("phone"),value:l.phone,onChange:N=>m("phone",N.target.value),error:d.phone,required:!0}),s.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:l.email,onChange:N=>m("email",N.target.value),error:d.email}),s.jsx(de,{label:i("hireDate"),type:"date",value:l.joinDate,onChange:N=>m("joinDate",N.target.value),required:!0}),s.jsx(de,{containerClassName:"md:col-span-2",label:`${i("address")} (${i("optional")})`,value:l.address,onChange:N=>m("address",N.target.value)})]})})},Sz=({weights:t,onChange:e})=>{const{t:n}=_e(),[r,i]=S.useState([]);S.useEffect(()=>{const c=[...t.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[t.length]);const l=(c,d)=>{const f=[...r];if(f[c]=d,c===f.length-1&&d.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);e(h)};return s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("bagWeights")}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:r.map((c,d)=>s.jsx(de,{type:"number",step:"any",placeholder:`${n("sac")} ${d+1}`,value:c,onChange:f=>l(d,f.target.value),className:"text-center"},d))})]})},_z=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Ke(),{sites:i,farmers:l,seaweedTypes:c,addFarmerDelivery:d,getFarmersBySite:f,stockMovements:h}=qe(),[m,x]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",seaweedTypeId:"",destination:"PRESSING_WAREHOUSE_BULK"}),[g,N]=S.useState([]),[T,C]=S.useState([]),[w,E]=S.useState({});S.useEffect(()=>{var F,P;if(t){const U=((F=i.find(q=>q.id!=="pressing-warehouse"))==null?void 0:F.id)||"";x({date:new Date().toISOString().split("T")[0],siteId:U,farmerId:"",seaweedTypeId:((P=c[0])==null?void 0:P.id)||"",destination:"PRESSING_WAREHOUSE_BULK"}),N([]),C(f(U)),E({})}},[t,i,c,f]);const D=S.useMemo(()=>({totalWeightKg:g.reduce((F,P)=>F+P,0),totalBags:g.length}),[g]),I=S.useMemo(()=>{if(!m.siteId||!m.seaweedTypeId)return{kg:0,bags:0};const F=h.filter(J=>J.siteId===m.siteId&&J.seaweedTypeId===m.seaweedTypeId),P=F.reduce((J,Y)=>J+(Y.inKg||0),0),U=F.reduce((J,Y)=>J+(Y.outKg||0),0),q=F.reduce((J,Y)=>J+(Y.inBags||0),0),z=F.reduce((J,Y)=>J+(Y.outBags||0),0);return{kg:P-U,bags:q-z}},[m.siteId,m.seaweedTypeId,h]),k=S.useCallback(()=>{const F={};return m.date||(F.date=n("validationRequired")),m.siteId||(F.siteId=n("validationRequired")),m.farmerId||(F.farmerId=n("validationRequired")),m.seaweedTypeId||(F.seaweedTypeId=n("validationRequired")),D.totalWeightKg<=0&&(F.bagWeights=n("validationAtLeastOneRequired")),F},[m,D,n]);S.useEffect(()=>{E(k())},[m,D,k]);const M=(F,P)=>{x(U=>({...U,[F]:P}))},j=F=>{x(P=>({...P,siteId:F,farmerId:""})),C(f(F))},O=F=>{F.preventDefault();const P=k();if(Object.keys(P).length>0){E(P);return}d({...m,totalWeightKg:D.totalWeightKg,totalBags:D.totalBags,bagWeights:g}),e()},A=Object.keys(w).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:n("newDelivery"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(se,{onClick:O,disabled:A,children:n("receivedAtWarehouse")})]}),children:s.jsxs("form",{onSubmit:O,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:m.date,onChange:F=>M("date",F.target.value),error:w.date,required:!0}),s.jsxs(ke,{label:n("site"),value:m.siteId,onChange:F=>j(F.target.value),error:w.siteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectSite")}),i.filter(F=>F.id!=="pressing-warehouse").map(F=>s.jsx("option",{value:F.id,children:F.name},F.id))]}),s.jsxs(ke,{label:n("farmerLabel"),value:m.farmerId,onChange:F=>M("farmerId",F.target.value),error:w.farmerId,disabled:!m.siteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectFarmer")}),T.map(F=>s.jsxs("option",{value:F.id,children:[F.firstName," ",F.lastName]},F.id))]}),s.jsxs(ke,{label:n("seaweedType"),value:m.seaweedTypeId,onChange:F=>M("seaweedTypeId",F.target.value),error:w.seaweedTypeId,required:!0,children:[s.jsx("option",{value:"",children:n("selectType")}),c.map(F=>s.jsx("option",{value:F.id,children:F.name},F.id))]}),s.jsxs(ke,{containerClassName:"md:col-span-2",label:n("destination"),value:m.destination,onChange:F=>M("destination",F.target.value),children:[s.jsx("option",{value:"PRESSING_WAREHOUSE_BULK",children:n("pressedWarehouseTitle")}),s.jsx("option",{value:"SITE_STORAGE",children:n("onSiteStorageTitle")})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsxs("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:[n("currentStock")," (",n("kg"),")"]}),s.jsx("p",{className:"text-xl font-bold",children:Ue(I.kg,r.localization)})]}),s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:n("stockBags")}),s.jsx("p",{className:"text-xl font-bold",children:Ue(I.bags,{...r.localization,nonMonetaryDecimals:0})})]})]}),s.jsx(Sz,{weights:g,onChange:N}),w.bagWeights&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:w.bagWeights}),s.jsx("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[s.jsxs("span",{children:[n("totalWeightKgDelivery"),":"]}),s.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[D.totalWeightKg.toFixed(2)," kg ",s.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",D.totalBags," ",n("bags"),")"]})]})]})})]})})},wz=()=>{const{t}=_e(),{settings:e}=Ke(),{farmerDeliveries:n,sites:r,farmers:i,seaweedTypes:l,deleteFarmerDelivery:c}=qe(),[d,f]=S.useState(!1),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,T]=S.useState({key:"date",direction:"descending"}),C=S.useMemo(()=>new Map(r.map(A=>[A.id,A.name])),[r]),w=S.useMemo(()=>new Map(i.map(A=>[A.id,`${A.firstName} ${A.lastName}`])),[i]),E=S.useMemo(()=>new Map(l.map(A=>[A.id,A.name])),[l]),D=S.useMemo(()=>{let A=[...n];return A.sort((F,P)=>{let U,q;return N.key==="siteName"?U=C.get(F.siteId)||"":N.key==="farmerName"?U=w.get(F.farmerId)||"":N.key==="seaweedTypeName"?U=E.get(F.seaweedTypeId)||"":U=F[N.key],N.key==="siteName"?q=C.get(P.siteId)||"":N.key==="farmerName"?q=w.get(P.farmerId)||"":N.key==="seaweedTypeName"?q=E.get(P.seaweedTypeId)||"":q=P[N.key],U==null?1:q==null?-1:U<q?N.direction==="ascending"?-1:1:U>q?N.direction==="ascending"?1:-1:0}),A},[n,N,C,w,E]),I=A=>{let F="ascending";N.key===A&&N.direction==="ascending"&&(F="descending"),T({key:A,direction:F})},k=A=>N.key!==A?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),M=({sortKey:A,label:F,className:P})=>s.jsx("th",{className:`p-3 ${P}`,children:s.jsxs("button",{onClick:()=>I(A),className:`group flex items-center gap-2 w-full ${P!=null&&P.includes("text-right")?"justify-end":""}`,children:[F,k(A)]})}),j=A=>{g(A),m(!0)},O=()=>{x&&c(x),m(!1),g(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("farmerDeliveriesTitle")}),s.jsxs(se,{onClick:()=>f(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordDelivery")]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(M,{sortKey:"slipNo",label:t("slipNo")}),s.jsx(M,{sortKey:"date",label:t("date")}),s.jsx(M,{sortKey:"siteName",label:t("site")}),s.jsx(M,{sortKey:"farmerName",label:t("farmerLabel")}),s.jsx(M,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(M,{sortKey:"totalWeightKg",label:t("totalWeightKgDelivery"),className:"text-right"}),s.jsx(M,{sortKey:"totalBags",label:t("totalBags"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[D.map(A=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:A.slipNo}),s.jsx("td",{className:"p-3",children:A.date}),s.jsx("td",{className:"p-3",children:C.get(A.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:w.get(A.farmerId)||t("unknown")}),s.jsx("td",{className:"p-3",children:E.get(A.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right",children:Ue(A.totalWeightKg,e.localization)}),s.jsx("td",{className:"p-3 text-right",children:A.totalBags}),s.jsx("td",{className:"p-3 text-right",children:s.jsx("div",{className:"flex justify-end gap-2",children:s.jsx(se,{variant:"danger",onClick:()=>j(A.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})})]},A.id)),D.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:t("noDeliveriesRecorded")})})]})]})})}),d&&s.jsx(_z,{isOpen:d,onClose:()=>f(!1)}),h&&s.jsx(Qt,{isOpen:h,onClose:()=>m(!1),onConfirm:O,title:t("confirmDeleteTitle"),message:t("confirmDeleteDelivery")})]})},Tz=()=>{const{t}=_e(),{settings:e}=Ke(),{cuttingOperations:n,sites:r,serviceProviders:i,modules:l,farmers:c,deleteCuttingOperation:d}=qe(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[T,C]=S.useState(null),[w,E]=S.useState({key:"date",direction:"descending"}),D=S.useMemo(()=>new Map(r.map(Y=>[Y.id,Y.name])),[r]),I=S.useMemo(()=>new Map(i.map(Y=>[Y.id,Y.name])),[i]),k=S.useMemo(()=>new Map(c.map(Y=>[Y.id,`${Y.firstName} ${Y.lastName}`])),[c]),M=S.useMemo(()=>{const Y=new Map;return l.forEach(G=>{const B=G.farmerId?k.get(G.farmerId):void 0;Y.set(G.id,{code:G.code,farmerName:B})}),Y},[l,k]),j=S.useMemo(()=>{let Y=[...n];return Y.sort((G,B)=>{let Q,K;return w.key==="siteName"?(Q=D.get(G.siteId)||"",K=D.get(B.siteId)||""):w.key==="providerName"?(Q=I.get(G.serviceProviderId)||"",K=I.get(B.serviceProviderId)||""):(Q=G[w.key],K=B[w.key]),Q<K?w.direction==="ascending"?-1:1:Q>K?w.direction==="ascending"?1:-1:0}),Y},[n,w,D,I]),O=Y=>{let G="ascending";w.key===Y&&w.direction==="ascending"&&(G="descending"),E({key:Y,direction:G})},A=Y=>w.key!==Y?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):w.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),F=({sortKey:Y,label:G,className:B})=>s.jsx("th",{className:`p-3 ${B}`,children:s.jsxs("button",{onClick:()=>O(Y),className:`group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors w-full ${B!=null&&B.includes("text-right")?"justify-end":""} ${B!=null&&B.includes("text-center")?"justify-center":""}`,children:[G,A(Y)]})}),P=Y=>{x(Y),h(!0)},U=()=>{x(null),h(!0)},q=()=>{x(null),h(!1)},z=Y=>{C(Y),N(!0)},J=()=>{T&&d(T),N(!1),C(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("cuttingOperationsTitle")}),s.jsxs(se,{onClick:U,children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("newPlanting")]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(F,{sortKey:"date",label:t("date")}),s.jsx(F,{sortKey:"siteName",label:t("site")}),s.jsx(F,{sortKey:"providerName",label:t("serviceProvider")}),s.jsx("th",{className:"p-3",children:t("beneficiaryFarmers")}),s.jsx("th",{className:"p-3",children:t("modules")}),s.jsx(F,{sortKey:"totalAmount",label:t("totalAmount"),className:"text-right"}),s.jsx(F,{sortKey:"isPaid",label:t("status"),className:"text-center"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:j.map(Y=>{const G=(()=>{if(Y.beneficiaryFarmerId){const re=k.get(Y.beneficiaryFarmerId);return re?[re]:[]}const K=Y.moduleCuts.map(re=>re.moduleId).map(re=>{var H;return(H=l.find(ae=>ae.id===re))==null?void 0:H.farmerId}).filter(re=>!!re);return[...new Set(K)].map(re=>k.get(re)).filter(re=>!!re)})(),B=Y.moduleCuts.map(Q=>{const K=M.get(Q.moduleId);return K?`${K.code} (${Q.linesCut} l.)`:s.jsxs("span",{className:"font-mono text-[10px] text-gray-500",children:[t("unknown")," (ID: ",Q.moduleId.substring(0,6),")"]})});return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700",children:[s.jsx("td",{className:"p-3",children:Y.date}),s.jsx("td",{className:"p-3",title:Y.siteId,children:D.get(Y.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",title:Y.serviceProviderId,children:I.get(Y.serviceProviderId)||t("unknown")}),s.jsx("td",{className:"p-3",children:G.length>0?s.jsxs("div",{className:"relative group",children:[s.jsx("span",{className:"truncate",children:G[0]}),G.length>1&&s.jsxs("span",{className:"ml-1 text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full",children:["+",G.length-1]}),s.jsx("div",{className:"absolute bottom-full mb-2 w-max max-w-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10 p-2 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg",children:G.join(", ")})]}):s.jsx("span",{className:"text-gray-500 italic",children:t("noBeneficiary")})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[B.slice(0,3).map((Q,K)=>s.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full whitespace-nowrap flex items-center",children:Q},K)),B.length>3&&s.jsx("div",{className:"relative group",children:s.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full cursor-pointer",children:"..."})})]})}),s.jsx("td",{className:"p-3 text-right",children:Ae(Y.totalAmount,e.localization)}),s.jsx("td",{className:"p-3 text-center",children:Y.isPaid?s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:t("paid")}):s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",children:t("unpaid")})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>P(Y),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("edit")]}),s.jsxs(se,{variant:"danger",onClick:()=>z(Y.id),children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),t("delete")]})]})})]},Y.id)})})]})})}),f&&s.jsx(yE,{isOpen:f,onClose:q,operationToEdit:m}),g&&s.jsx(Qt,{isOpen:g,onClose:()=>N(!1),onConfirm:J,title:t("confirmDeleteTitle"),message:t("confirmDeleteCuttingOperation")})]})},Cz=({weights:t,onChange:e})=>{const{t:n}=_e(),r=S.useMemo(()=>{const l=[...t.map(String)],c=Math.max(1,Math.ceil((l.length+1)/10));for(;l.length<c*10;)l.push("");return l},[t]),i=(l,c)=>{const d=[...r];d[l]=c;const f=d.map(h=>parseFloat(h)).filter(h=>!isNaN(h)&&h>0);e(f)};return s.jsxs("div",{className:"space-y-2 col-span-1 md:col-span-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("bagWeights")," (Kg)"]}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-48 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:r.map((l,c)=>s.jsx(de,{type:"number",step:"0.01",placeholder:`${n("sac")} ${c+1}`,value:l,onChange:d=>i(c,d.target.value),className:"text-center text-xs"},c))}),s.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[n("totalBags"),": ",t.length]})]})},Ez=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Ke(),{sites:i,seaweedTypes:l,employees:c,addSiteTransfer:d,stockMovements:f}=qe(),h=S.useMemo(()=>({date:new Date().toISOString().split("T")[0],sourceSiteId:"",destinationSiteId:"",seaweedTypeId:"",managerId:"",transporter:"",transport:"Truck",representative:""}),[]),[m,x]=S.useState(h),[g,N]=S.useState([]),[T,C]=S.useState({});S.useEffect(()=>{var A,F;t&&(x({...h,sourceSiteId:((A=i.find(P=>P.id!=="pressing-warehouse"))==null?void 0:A.id)||"",seaweedTypeId:((F=l[0])==null?void 0:F.id)||""}),N([]),C({}))},[t,i,l,h]);const w=S.useMemo(()=>({totalWeightKg:g.reduce((A,F)=>A+F,0),totalBags:g.length}),[g]),E=S.useMemo(()=>{if(!m.sourceSiteId||!m.seaweedTypeId)return{kg:0,bags:0};const A=f.filter(z=>z.siteId===m.sourceSiteId&&z.seaweedTypeId===m.seaweedTypeId),F=A.reduce((z,J)=>z+(J.inKg||0),0),P=A.reduce((z,J)=>z+(J.outKg||0),0),U=A.reduce((z,J)=>z+(J.inBags||0),0),q=A.reduce((z,J)=>z+(J.outBags||0),0);return{kg:F-P,bags:U-q}},[m.sourceSiteId,m.seaweedTypeId,f]),D=S.useMemo(()=>({kg:E.kg-w.totalWeightKg,bags:E.bags-w.totalBags}),[E,w]),I=S.useMemo(()=>{const A={id:"pressing-warehouse",name:n("pressedWarehouseTitle")};return[...i.filter(P=>P.id!==m.sourceSiteId&&P.id!=="pressing-warehouse"),A]},[i,m.sourceSiteId,n]),k=S.useCallback(()=>{const A={};return m.date||(A.date=n("validationRequired")),m.sourceSiteId||(A.sourceSiteId=n("validationRequired")),m.destinationSiteId||(A.destinationSiteId=n("validationRequired")),m.sourceSiteId===m.destinationSiteId&&(A.destinationSiteId=n("validationSameSite")),m.seaweedTypeId||(A.seaweedTypeId=n("validationRequired")),m.transporter||(A.transporter=n("validationRequired")),w.totalBags===0&&(A.bagWeights=n("validationAtLeastOneRequired")),D.kg<0?A.bagWeights=n("validationStockUnavailableWeight").replace("{availableStock}",Ue(E.kg,r.localization)):D.bags<0&&(A.bagWeights=n("validationStockUnavailableBags").replace("{availableStock}",String(E.bags))),A},[m,w,D,E,n,r.localization]);S.useEffect(()=>{C(k())},[m,w,k]);const M=(A,F)=>{const P={...m,[A]:F};A==="sourceSiteId"&&F===P.destinationSiteId&&(P.destinationSiteId=""),x(P)},j=A=>{A.preventDefault();const F=k();if(Object.keys(F).length>0){C(F);return}const P={...m,managerId:m.managerId||void 0,representative:m.representative||void 0,weightKg:w.totalWeightKg,bags:w.totalBags,bagWeights:g};d(P),e()},O=Object.keys(T).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:n("createShippingSlip"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(se,{onClick:j,disabled:O,children:n("save")})]}),children:s.jsxs("form",{onSubmit:j,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:n("originInformation")}),s.jsx(de,{label:n("date"),type:"date",value:m.date,onChange:A=>M("date",A.target.value),error:T.date,required:!0}),s.jsx(ke,{label:n("sourceSite"),value:m.sourceSiteId,onChange:A=>M("sourceSiteId",A.target.value),error:T.sourceSiteId,required:!0,children:i.filter(A=>A.id!=="pressing-warehouse").map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))}),s.jsx(ke,{label:n("seaweedType"),value:m.seaweedTypeId,onChange:A=>M("seaweedTypeId",A.target.value),error:T.seaweedTypeId,required:!0,children:l.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))}),s.jsxs("div",{className:`p-4 rounded-lg border ${D.kg<0?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-700/50":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[n("currentStock"),":"]}),s.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:[Ue(E.kg,r.localization)," Kg"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[n("stockBags"),":"]}),s.jsx("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:E.bags})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:n("destination")+" & Transport"}),s.jsxs(ke,{label:n("destinationSite"),value:m.destinationSiteId,onChange:A=>M("destinationSiteId",A.target.value),error:T.destinationSiteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectSite")}),I.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs(ke,{label:n("transport"),value:m.transport,onChange:A=>M("transport",A.target.value),children:[s.jsx("option",{value:"Truck",children:n("transport_Truck")}),s.jsx("option",{value:"Boat",children:n("transport_Boat")})]}),s.jsx(de,{label:n("transporter"),value:m.transporter,onChange:A=>M("transporter",A.target.value),error:T.transporter,required:!0})]}),s.jsx(de,{label:n("representative"),value:m.representative,onChange:A=>M("representative",A.target.value),placeholder:"Nom du capitaine / chauffeur"}),s.jsxs(ke,{label:n("manager"),value:m.managerId,onChange:A=>M("managerId",A.target.value),children:[s.jsx("option",{value:"",children:n("noManager")}),c.map(A=>s.jsxs("option",{value:A.id,children:[A.firstName," ",A.lastName]},A.id))]})]}),s.jsxs("div",{className:"md:col-span-2 border-t pt-4",children:[s.jsx(Cz,{weights:g,onChange:N}),T.bagWeights&&s.jsx("p",{className:"mt-2 text-sm text-red-600 font-medium",children:T.bagWeights})]}),s.jsxs("div",{className:"md:col-span-2 flex justify-end gap-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:n("shippedBags")}),s.jsx("p",{className:"text-xl font-bold",children:w.totalBags})]}),s.jsxs("div",{className:"text-right border-l pl-6 border-gray-300 dark:border-gray-600",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:n("shippedWeightKg")}),s.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[Ue(w.totalWeightKg,r.localization)," Kg"]})]})]})]})})},Iz=({isOpen:t,onClose:e,transfer:n,action:r,onConfirm:i})=>{const{t:l}=_e(),c=r===Jt.COMPLETED,[d,f]=S.useState({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:"",receivedBags:"",notes:""}),[h,m]=S.useState({});S.useEffect(()=>{t&&(f({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:String(n.weightKg),receivedBags:String(n.bags),notes:""}),m({}))},[t,n]);const x=S.useCallback(()=>{const w={};return d.completionDate||(w.completionDate=l("validationRequired")),c?((!d.receivedWeightKg||isNaN(parseFloat(d.receivedWeightKg))||parseFloat(d.receivedWeightKg)<0)&&(w.receivedWeightKg=l("validationNonNegative")),(!d.receivedBags||isNaN(parseInt(d.receivedBags,10))||parseInt(d.receivedBags,10)<0)&&(w.receivedBags=l("validationNonNegative"))):d.notes.trim()||(w.notes=l("validationRequired")),w},[d,c,l]);S.useEffect(()=>{m(x())},[d,x]);const g=(w,E)=>{f(D=>({...D,[w]:E}))},N=()=>{const w=x();if(Object.keys(w).length>0){m(w);return}const E={...n,status:r,completionDate:d.completionDate,notes:d.notes,receivedWeightKg:c?parseFloat(d.receivedWeightKg):void 0,receivedBags:c?parseInt(d.receivedBags,10):void 0};i(E)},T=l(c?"confirmCompleteTransferTitle":"confirmCancelTransferTitle"),C=c?parseFloat(d.receivedWeightKg||"0")-n.weightKg:0;return s.jsx(ot,{isOpen:t,onClose:e,title:T,footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(se,{onClick:N,disabled:Object.keys(h).length>0,children:l("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:l(c?"completionDate":"cancellationDate"),type:"date",value:d.completionDate,onChange:w=>g("completionDate",w.target.value),error:h.completionDate,required:!0}),c?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800 text-sm mb-4",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[l("shippedWeightKg"),":"]})," ",n.weightKg," Kg"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[l("shippedBags"),":"]})," ",n.bags]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:l("receivedWeightKg"),type:"number",step:"0.01",value:d.receivedWeightKg,onChange:w=>g("receivedWeightKg",w.target.value),error:h.receivedWeightKg,required:!0}),s.jsx(de,{label:l("receivedBags"),type:"number",value:d.receivedBags,onChange:w=>g("receivedBags",w.target.value),error:h.receivedBags,required:!0})]}),C!==0&&s.jsxs("p",{className:`text-xs font-bold text-right ${C<0?"text-red-500":"text-green-500"}`,children:["Difference: ",C>0?"+":"",C.toFixed(2)," Kg"]}),s.jsx(de,{label:`${l("notes")} (${l("optional")})`,value:d.notes,onChange:w=>g("notes",w.target.value),placeholder:"e.g. Broken bags, moisture loss..."})]}):s.jsx(de,{label:l("cancellationReason"),value:d.notes,onChange:w=>g("notes",w.target.value),error:h.notes,required:!0,autoFocus:!0})]})})},jz=({history:t})=>{const{t:e,language:n}=_e();if(!t||t.length===0)return s.jsx("p",{className:"p-4 text-gray-500",children:e("noHistory")});const r=[...t].sort((i,l)=>new Date(l.date).getTime()-new Date(i.date).getTime());return s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-bold uppercase text-gray-500 mb-3",children:e("siteTransferHistoryTitle")}),s.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-2",children:r.map((i,l)=>s.jsxs("li",{className:"mb-6 ml-6",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-3 h-3 bg-blue-100 rounded-full -left-1.5 ring-4 ring-white dark:ring-gray-800 dark:bg-blue-900"}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(An,{status:i.status}),s.jsx("time",{className:"block ml-4 text-xs font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(i.date).toLocaleString(n,{dateStyle:"long",timeStyle:"short"})})]}),i.notes&&s.jsx("p",{className:"text-sm font-normal text-gray-600 dark:text-gray-300 mt-1",children:i.notes})]},l))})]})},Az=()=>{const{t}=_e(),{siteTransfers:e,sites:n,seaweedTypes:r,updateSiteTransfer:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(!1),[h,m]=S.useState(null),[x,g]=S.useState(null),[N,T]=S.useState({key:"date",direction:"descending"}),[C,w]=S.useState(null),E=S.useMemo(()=>{const P=new Map(n.map(U=>[U.id,U.name]));return P.set("pressing-warehouse",t("pressedWarehouseTitle")),P},[n,t]),D=S.useMemo(()=>new Map(r.map(P=>[P.id,P.name])),[r]),I=S.useMemo(()=>{let P=[...e];return P.sort((U,q)=>{let z,J;return N.key==="sourceSiteName"?z=E.get(U.sourceSiteId)||"":N.key==="destinationSiteName"?z=E.get(U.destinationSiteId)||"":N.key==="seaweedTypeName"?z=D.get(U.seaweedTypeId)||"":z=U[N.key],N.key==="sourceSiteName"?J=E.get(q.sourceSiteId)||"":N.key==="destinationSiteName"?J=E.get(q.destinationSiteId)||"":N.key==="seaweedTypeName"?J=D.get(q.seaweedTypeId)||"":J=q[N.key],z==null?1:J==null?-1:z<J?N.direction==="ascending"?-1:1:z>J?N.direction==="ascending"?1:-1:0}),P},[e,N,E,D]),k=P=>{let U="ascending";N.key===P&&N.direction==="ascending"&&(U="descending"),T({key:P,direction:U})},M=({sortKey:P,label:U,className:q})=>s.jsx("th",{className:`p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${q}`,onClick:()=>k(P),children:s.jsxs("div",{className:`flex items-center gap-2 ${q!=null&&q.includes("text-right")?"justify-end":""}`,children:[U,N.key===P&&s.jsx(te,{name:N.direction==="ascending"?"ArrowUp":"ArrowDown",className:"w-3 h-3"})]})}),j=(P,U)=>{m(P),U===Jt.IN_TRANSIT||U===Jt.PENDING_RECEPTION?i({...P,status:U}):(g(U),f(!0))},O=P=>{i(P),f(!1),m(null),g(null)},A=P=>{const U="w-4 h-4 mr-1";switch(P.status){case Jt.AWAITING_OUTBOUND:return s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsxs(se,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>j(P,Jt.IN_TRANSIT),children:[s.jsx(te,{name:"Truck",className:U})," ",t("status_IN_TRANSIT")]}),s.jsxs(se,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>j(P,Jt.CANCELLED),children:[s.jsx(te,{name:"X",className:U})," ",t("cancel")]})]});case Jt.IN_TRANSIT:return s.jsxs(se,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>j(P,Jt.PENDING_RECEPTION),children:[s.jsx(te,{name:"MapPin",className:U})," ",t("status_PENDING_RECEPTION")]});case Jt.PENDING_RECEPTION:return s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsxs(se,{variant:"primary",className:"!px-2 !py-1 text-xs",onClick:()=>j(P,Jt.COMPLETED),children:[s.jsx(te,{name:"Check",className:U})," ",t("confirm")]}),s.jsxs(se,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>j(P,Jt.CANCELLED),children:[s.jsx(te,{name:"X",className:U})," ",t("cancel")]})]});default:return s.jsx("span",{className:"text-xs text-gray-500 italic",children:t("noActions")})}},F=P=>P.startsWith("st-")?`SLIP-${P.split("-")[1].slice(-6)}`:P;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("siteTransfersTitle")}),s.jsxs(se,{onClick:()=>c(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),t("createShippingSlip")]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto min-h-[400px]",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 w-10"}),s.jsx(M,{sortKey:"id",label:t("slipNo")}),s.jsx(M,{sortKey:"date",label:t("date")}),s.jsx(M,{sortKey:"sourceSiteName",label:t("sourceSite")}),s.jsx(M,{sortKey:"destinationSiteName",label:t("destinationSite")}),s.jsx(M,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(M,{sortKey:"weightKg",label:t("shippedWeightKg"),className:"text-right"}),s.jsx(M,{sortKey:"status",label:t("status")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[I.map(P=>{const U=C===P.id;return s.jsxs(gt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx("button",{onClick:()=>w(U?null:P.id),className:"text-gray-500 hover:text-blue-600 focus:outline-none",children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${U?"rotate-90":""}`})})}),s.jsx("td",{className:"p-3 font-mono font-medium text-blue-600 dark:text-blue-400",children:F(P.id)}),s.jsx("td",{className:"p-3",children:P.date}),s.jsx("td",{className:"p-3",children:E.get(P.sourceSiteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:E.get(P.destinationSiteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:D.get(P.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right font-medium",children:P.weightKg.toFixed(2)}),s.jsx("td",{className:"p-3",children:s.jsx(An,{status:P.status})}),s.jsx("td",{className:"p-3 text-right",children:A(P)})]}),U&&s.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/30",children:s.jsx("td",{colSpan:9,className:"p-0 border-b dark:border-gray-700/50",children:s.jsxs("div",{className:"p-4 pl-12 grid grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:t("transportDetails")}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("transporter"),":"]})," ",P.transporter]}),s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("transport"),":"]})," ",P.transport||"-"]}),s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("representative"),":"]})," ",P.representative||"-"]})]})]}),s.jsx("div",{children:s.jsx(jz,{history:P.history})})]})})})]},P.id)}),I.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500",children:t("noDataForReport")})})]})]})})}),l&&s.jsx(Ez,{isOpen:l,onClose:()=>c(!1)}),d&&h&&x&&s.jsx(Iz,{isOpen:d,onClose:()=>f(!1),transfer:h,action:x,onConfirm:O})]})},kz=()=>s.jsx(Az,{}),Dz=()=>{const{t,language:e}=_e(),{incidents:n,sites:r,employees:i,deleteIncident:l,incidentTypes:c,incidentSeverities:d}=qe(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[T,C]=S.useState(null),[w,E]=S.useState({key:"date",direction:"descending"}),[D,I]=S.useState({siteId:"all",type:"all",severity:"all",status:"all"}),k=S.useMemo(()=>new Map(r.map(B=>[B.id,B.name])),[r]),M=S.useMemo(()=>new Map(i.map(B=>[B.id,`${B.firstName} ${B.lastName}`])),[i]),j=S.useMemo(()=>new Map(c.map(B=>[B.id,B.name])),[c]);S.useMemo(()=>new Map(d.map(B=>[B.id,B.name])),[d]);const O=S.useMemo(()=>{const B=n.filter(re=>re.status===Ps.OPEN).length,Q=n.filter(re=>re.status===Ps.IN_PROGRESS).length,K=n.filter(re=>re.severity==="CRITICAL"&&(re.status===Ps.OPEN||re.status===Ps.IN_PROGRESS)).length;return{open:B,inProgress:Q,critical:K}},[n]),A=(B,Q)=>{I(K=>({...K,[B]:Q}))},F=()=>{I({siteId:"all",type:"all",severity:"all",status:"all"})},P=S.useMemo(()=>{let B=[...n].filter(Q=>{const K=D.siteId==="all"||Q.siteId===D.siteId,re=D.type==="all"||Q.type===D.type,H=D.severity==="all"||Q.severity===D.severity,ae=D.status==="all"||Q.status===D.status;return K&&re&&H&&ae});return B.sort((Q,K)=>{let re,H;return w.key==="siteName"?re=k.get(Q.siteId)||"":w.key==="reportedByName"?re=M.get(Q.reportedById)||"":re=Q[w.key],w.key==="siteName"?H=k.get(K.siteId)||"":w.key==="reportedByName"?H=M.get(K.reportedById)||"":H=K[w.key],re==null?1:H==null?-1:re<H?w.direction==="ascending"?-1:1:re>H?w.direction==="ascending"?1:-1:0}),B},[n,D,w,k,M]),U=B=>{let Q="ascending";w.key===B&&w.direction==="ascending"&&(Q="descending"),E({key:B,direction:Q})},q=B=>w.key!==B?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):w.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),z=({sortKey:B,label:Q,className:K})=>s.jsx("th",{className:`p-3 ${K}`,children:s.jsxs("button",{onClick:()=>U(B),className:`group flex items-center gap-2 w-full ${K!=null&&K.includes("text-right")?"justify-end":""}`,children:[Q,q(B)]})}),J=(B=null)=>{x(B),h(!0)},Y=B=>{C(B),N(!0)},G=()=>{T&&l(T),N(!1),C(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("incidentManagementTitle")}),s.jsxs(se,{onClick:()=>J(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("reportIncident")]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Bell",className:"w-8 h-8 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("openIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:O.open})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Activity",className:"w-8 h-8 text-purple-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("inProgressIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:O.inProgress})]})]})}),s.jsx(ze,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"AlertTriangle",className:"w-8 h-8 text-red-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("criticalIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:O.critical})]})]})})]}),s.jsx(ze,{children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end mb-4",children:[s.jsxs(ke,{label:t("site"),value:D.siteId,onChange:B=>A("siteId",B.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),r.map(B=>s.jsx("option",{value:B.id,children:B.name},B.id))]}),s.jsxs(ke,{label:t("incidentType"),value:D.type,onChange:B=>A("type",B.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),c.map(B=>s.jsx("option",{value:B.id,children:B.name},B.id))]}),s.jsxs(ke,{label:t("severity"),value:D.severity,onChange:B=>A("severity",B.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),d.map(B=>s.jsx("option",{value:B.id,children:B.name},B.id))]}),s.jsxs(ke,{label:t("status"),value:D.status,onChange:B=>A("status",B.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),Object.values(Ps).map(B=>s.jsx("option",{value:B,children:t(`status_${B}`)},B))]}),s.jsx(se,{variant:"secondary",onClick:F,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(z,{sortKey:"date",label:t("date")}),s.jsx(z,{sortKey:"siteName",label:t("site")}),s.jsx(z,{sortKey:"type",label:t("incidentType")}),s.jsx(z,{sortKey:"severity",label:t("severity")}),s.jsx(z,{sortKey:"reportedByName",label:t("reportedBy")}),s.jsx(z,{sortKey:"status",label:t("status")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[P.map(B=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:B.date}),s.jsx("td",{className:"p-3",children:k.get(B.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:j.get(B.type)||B.type}),s.jsx("td",{className:"p-3",children:s.jsx(An,{status:B.severity})}),s.jsx("td",{className:"p-3",children:M.get(B.reportedById)||t("unknown")}),s.jsx("td",{className:"p-3",children:s.jsx(An,{status:B.status})}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(se,{variant:"ghost",onClick:()=>J(B),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>Y(B.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},B.id)),P.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:t("noIncidents")})})]})]})})}),f&&s.jsx(Rz,{isOpen:f,onClose:()=>h(!1),incident:m}),g&&s.jsx(Qt,{isOpen:g,onClose:()=>N(!1),onConfirm:G,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncident")})]})},Rz=({isOpen:t,onClose:e,incident:n})=>{var G,B,Q;const{t:r,language:i}=_e(),{sites:l,employees:c,incidentTypes:d,incidentSeverities:f,modules:h,addIncident:m,updateIncident:x}=qe(),g=S.useRef(null),[N,T]=S.useState({date:new Date().toISOString().split("T")[0],siteId:((G=l[0])==null?void 0:G.id)||"",type:((B=d.find(K=>!K.isDefault&&K.id!=="OTHER"))==null?void 0:B.id)||"PEST_DISEASE",severity:"LOW",affectedModuleIds:[],reportedById:((Q=c[0])==null?void 0:Q.id)||"",description:"",status:Ps.OPEN,resolutionNotes:"",resolvedDate:""}),[C,w]=S.useState(null),[E,D]=S.useState(!1),[I,k]=S.useState(null),[M,j]=S.useState({});S.useEffect(()=>{T(n?{date:n.date,siteId:n.siteId,type:n.type,severity:n.severity,affectedModuleIds:n.affectedModuleIds,reportedById:n.reportedById,description:n.description,status:n.status,resolutionNotes:n.resolutionNotes||"",resolvedDate:n.resolvedDate||""}:K=>{var re,H,ae;return{...K,siteId:((re=l[0])==null?void 0:re.id)||"",reportedById:((H=c[0])==null?void 0:H.id)||"",type:((ae=d[0])==null?void 0:ae.id)||"PEST_DISEASE"}}),w(null),k(null),j({})},[n,t,l,c,d]);const O=S.useMemo(()=>h.filter(K=>K.siteId===N.siteId),[h,N.siteId]),A=S.useCallback(()=>{const K={};return N.date||(K.date=r("validationRequired")),N.siteId||(K.siteId=r("validationRequired")),N.type||(K.type=r("validationRequired")),N.reportedById||(K.reportedById=r("validationRequired")),N.description.trim()||(K.description=r("validationRequired")),(N.status===Ps.RESOLVED||N.status===Ps.CLOSED)&&(N.resolvedDate||(K.resolvedDate=r("validationRequired")),N.resolutionNotes.trim()||(K.resolutionNotes=r("validationRequired"))),K},[N,r]);S.useEffect(()=>{j(A())},[N,A]);const F=(K,re)=>{T(H=>({...H,[K]:re}))},P=K=>{T(re=>{const H=re.affectedModuleIds.includes(K)?re.affectedModuleIds.filter(ae=>ae!==K):[...re.affectedModuleIds,K];return{...re,affectedModuleIds:H}})},U=K=>{var H;const re=(H=K.target.files)==null?void 0:H[0];if(re){const ae=new FileReader;ae.onloadend=()=>{w(ae.result),z(ae.result)},ae.readAsDataURL(re)}},q=async()=>{if(N.description){D(!0);try{const K=await vG(N.description,O.map(re=>re.code),d,f,i);if(k(K),K.suggestedType&&T(re=>({...re,type:K.suggestedType})),K.suggestedSeverity&&T(re=>({...re,severity:K.suggestedSeverity})),K.suggestedModuleCodes&&K.suggestedModuleCodes.length>0){const re=O.filter(H=>K.suggestedModuleCodes.includes(H.code)).map(H=>H.id);T(H=>({...H,affectedModuleIds:[...new Set([...H.affectedModuleIds,...re])]}))}}catch(K){console.error("AI Analysis failed",K)}finally{D(!1)}}},z=async K=>{D(!0);try{const re=await bG(K,i);if(re){if(k({...I,imageAnalysis:re}),re.type==="PEST_DISEASE"){const H=d.find(ae=>ae.id==="PEST_DISEASE");H&&T(ae=>({...ae,type:H.id}))}if(re.severity){const H=f.find(ae=>ae.id===re.severity.toUpperCase());H&&T(ae=>({...ae,severity:H.id}))}re.description&&T(H=>({...H,description:(H.description?H.description+`

`:"")+`[AI Analysis]: ${re.description}`}))}}catch(re){console.error("Image Analysis failed",re)}finally{D(!1)}},J=K=>{K.preventDefault();const re=A();if(Object.keys(re).length>0){j(re);return}const H={...N,resolutionNotes:N.resolutionNotes||void 0,resolvedDate:N.resolvedDate||void 0};n?x({...n,...H}):m(H),e()},Y=Object.keys(M).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:r(n?"editIncident":"reportIncident"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:J,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:r("date"),type:"date",value:N.date,onChange:K=>F("date",K.target.value),error:M.date,required:!0}),s.jsx(ke,{label:r("site"),value:N.siteId,onChange:K=>F("siteId",K.target.value),error:M.siteId,required:!0,children:l.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))}),s.jsx(ke,{label:r("incidentType"),value:N.type,onChange:K=>F("type",K.target.value),error:M.type,required:!0,children:d.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))}),s.jsx(ke,{label:r("severity"),value:N.severity,onChange:K=>F("severity",K.target.value),required:!0,children:f.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))}),s.jsx(ke,{label:r("reportedBy"),value:N.reportedById,onChange:K=>F("reportedById",K.target.value),error:M.reportedById,required:!0,children:c.map(K=>s.jsxs("option",{value:K.id,children:[K.firstName," ",K.lastName]},K.id))}),s.jsx(ke,{label:r("status"),value:N.status,onChange:K=>F("status",K.target.value),required:!0,children:Object.values(Ps).map(K=>s.jsx("option",{value:K,children:r(`status_${K}`)},K))})]}),s.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:r("description")}),s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsxs(se,{type:"button",variant:"secondary",onClick:()=>{var K;return(K=g.current)==null?void 0:K.click()},className:"text-xs",children:[s.jsx(te,{name:"Image",className:"w-4 h-4 mr-1"})," ",r("uploadPhoto")]}),s.jsx("input",{type:"file",ref:g,onChange:U,accept:"image/*",className:"hidden"}),s.jsxs(se,{type:"button",variant:"ghost",onClick:q,disabled:E||!N.description,className:"text-xs",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4 mr-1"})," ",r("analyzeWithAI")]})]}),C&&s.jsx("div",{className:"mb-2",children:s.jsx("img",{src:C,alt:"Preview",className:"h-32 w-auto object-cover rounded border"})}),s.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-blue-500",rows:4,value:N.description,onChange:K=>F("description",K.target.value),placeholder:r("descriptionPlaceholder")}),M.description&&s.jsx("p",{className:"text-xs text-red-600",children:M.description}),E&&s.jsxs("p",{className:"text-xs text-blue-600 mt-1 animate-pulse",children:[r("analyzingSatellite"),"..."]}),I&&s.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded text-sm",children:[s.jsxs("h4",{className:"font-bold flex items-center gap-1 text-blue-800 dark:text-blue-200",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4"})," ",r("aiSuggestions")]}),I.imageAnalysis&&s.jsxs("div",{className:"mt-1",children:[s.jsxs("p",{className:"font-semibold",children:[r("suggestedType"),": ",I.imageAnalysis.type]}),s.jsx("p",{children:I.imageAnalysis.description}),s.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[s.jsxs("strong",{children:[r("suggestedTreatment"),":"]})," ",I.imageAnalysis.treatments]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:r("affectedModules")}),s.jsxs("div",{className:"max-h-32 overflow-y-auto border rounded p-2 grid grid-cols-3 gap-2",children:[O.map(K=>s.jsxs("label",{className:"flex items-center space-x-2 text-sm cursor-pointer",children:[s.jsx(Rt,{checked:N.affectedModuleIds.includes(K.id),onChange:()=>P(K.id)}),s.jsx("span",{children:K.code})]},K.id)),O.length===0&&s.jsx("p",{className:"text-gray-500 text-sm col-span-3 text-center",children:"Select a site to view modules"})]})]}),(N.status===Ps.RESOLVED||N.status===Ps.CLOSED)&&s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:r("status_RESOLVED")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:r("resolvedDate"),type:"date",value:N.resolvedDate,onChange:K=>F("resolvedDate",K.target.value),error:M.resolvedDate,required:!0}),s.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600",rows:3,value:N.resolutionNotes,onChange:K=>F("resolutionNotes",K.target.value),placeholder:r("resolutionNotes")}),M.resolutionNotes&&s.jsx("p",{className:"text-xs text-red-600",children:M.resolutionNotes})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700 mt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{type:"submit",disabled:Y,children:r("save")})]})]})})},Mz=()=>{const{t}=_e(),{incidentTypes:e,addIncidentType:n,updateIncidentType:r,deleteIncidentType:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,T]=S.useState(null),C=k=>{k.isDefault||(f(k),c(!0))},w=()=>{d&&i(d.id),c(!1),f(null)},E=()=>{h.trim()&&(n({name:h.trim()}),m(""))},D=k=>{T(k),g(!0)},I=k=>{r(k),g(!1)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("incidentTypeManagementTitle")}),s.jsxs(ze,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(k=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:k.name}),k.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>D(k),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),k.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(se,{variant:"danger",className:"p-2",onClick:()=>C(k),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},k.id))}),s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addIncidentType")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("typeName"),value:h,onChange:k=>m(k.target.value)}),s.jsxs(se,{onClick:E,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})]}),x&&N&&s.jsx(Pz,{isOpen:x,onClose:()=>g(!1),type:N,onSave:I}),l&&d&&s.jsx(Qt,{isOpen:l,onClose:()=>c(!1),onConfirm:w,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncidentType")})]})},Pz=({isOpen:t,onClose:e,type:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ot,{isOpen:t,onClose:e,title:i("editIncidentType"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("typeName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},Oz=()=>{const{t}=_e(),{incidentSeverities:e,addIncidentSeverity:n,updateIncidentSeverity:r,deleteIncidentSeverity:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,T]=S.useState(null),C=k=>{k.isDefault||(f(k),c(!0))},w=()=>{d&&i(d.id),c(!1),f(null)},E=()=>{h.trim()&&(n({name:h.trim()}),m(""))},D=k=>{T(k),g(!0)},I=k=>{r(k),g(!1)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("incidentSeverityManagementTitle")}),s.jsxs(ze,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(k=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:k.name}),k.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>D(k),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),k.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(se,{variant:"danger",className:"p-2",onClick:()=>C(k),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},k.id))}),s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addIncidentSeverity")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("severityName"),value:h,onChange:k=>m(k.target.value)}),s.jsxs(se,{onClick:E,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})]}),x&&N&&s.jsx(Lz,{isOpen:x,onClose:()=>g(!1),severity:N,onSave:I}),l&&d&&s.jsx(Qt,{isOpen:l,onClose:()=>c(!1),onConfirm:w,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncidentSeverity")})]})},Lz=({isOpen:t,onClose:e,severity:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ot,{isOpen:t,onClose:e,title:i("editIncidentSeverity"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("severityName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},Fz=({isOpen:t,onClose:e,payment:n})=>{const{t:r}=_e(),{farmers:i,employees:l,serviceProviders:c,addMonthlyPayment:d,updateMonthlyPayment:f}=qe(),h=S.useCallback(()=>{const I=new Date,k=I.getFullYear(),M=String(I.getMonth()+1).padStart(2,"0");return{date:I.toISOString().split("T")[0],period:`${k}-${M}`,recipientType:rn.FARMER,recipientId:"",amount:"",method:"cash",notes:"",paymentStatus:"PENDING",mobileProvider:"",phoneNumber:""}},[]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{t&&(x(n?{...n,amount:String(n.amount),notes:n.notes||"",mobileProvider:n.mobileProvider||"",phoneNumber:n.phoneNumber||"",paymentStatus:n.paymentStatus||"PENDING"}:h()),N({}))},[t,n,h]);const T=S.useMemo(()=>{switch(m.recipientType){case rn.FARMER:return i.map(I=>({value:I.id,label:`${I.firstName} ${I.lastName}`}));case rn.EMPLOYEE:return l.map(I=>({value:I.id,label:`${I.firstName} ${I.lastName}`}));case rn.SERVICE_PROVIDER:return c.map(I=>({value:I.id,label:I.name}));default:return[]}},[m.recipientType,i,l,c]),C=S.useCallback(()=>{const I={};return m.date||(I.date=r("validationRequired")),m.period||(I.period=r("validationRequired")),m.recipientType||(I.recipientType=r("validationRequired")),m.recipientId||(I.recipientId=r("validationRequired")),(!m.amount||isNaN(parseFloat(m.amount))||parseFloat(m.amount)<=0)&&(I.amount=r("validationPositiveNumber")),m.method==="mobile_money"&&(m.mobileProvider||(I.mobileProvider=r("validationRequired")),m.phoneNumber||(I.phoneNumber=r("validationRequired"))),I},[m,r]);S.useEffect(()=>{N(C())},[m,C]);const w=(I,k)=>{const M={...m,[I]:k};I==="recipientType"&&(M.recipientId=""),x(M)},E=I=>{var j;I.preventDefault();const k=C();if(Object.keys(k).length>0){N(k);return}const M={...m,amount:parseFloat(m.amount),notes:((j=m.notes)==null?void 0:j.trim())||void 0,mobileProvider:m.method==="mobile_money"?m.mobileProvider:void 0,phoneNumber:m.method==="mobile_money"?m.phoneNumber:void 0};n?f({...n,...M}):d(M),e()},D=Object.keys(g).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:r(n?"editPayment":"newPayment"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{onClick:E,disabled:D,children:r("save")})]}),children:s.jsxs("form",{onSubmit:E,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:r("paymentDate"),type:"date",value:m.date,onChange:I=>w("date",I.target.value),error:g.date,required:!0}),s.jsx(de,{label:r("period"),type:"month",value:m.period,onChange:I=>w("period",I.target.value),error:g.period,required:!0}),s.jsxs(ke,{label:r("recipientType"),value:m.recipientType,onChange:I=>w("recipientType",I.target.value),error:g.recipientType,required:!0,children:[s.jsx("option",{value:"",children:r("selectRecipientType")}),Object.values(rn).map(I=>s.jsx("option",{value:I,children:r(`recipientType_${I}`)},I))]}),s.jsxs(ke,{label:r("recipient"),value:m.recipientId,onChange:I=>w("recipientId",I.target.value),error:g.recipientId,disabled:!m.recipientType,required:!0,children:[s.jsx("option",{value:"",children:r("selectRecipient")}),T.map(I=>s.jsx("option",{value:I.value,children:I.label},I.value))]}),s.jsx(de,{label:r("amount"),type:"number",step:"any",value:m.amount,onChange:I=>w("amount",I.target.value),error:g.amount,required:!0}),s.jsxs(ke,{label:r("paymentMethod"),value:m.method,onChange:I=>w("method",I.target.value),children:[s.jsx("option",{value:"cash",children:r("paymentMethod_cash")}),s.jsx("option",{value:"bank_transfer",children:r("paymentMethod_bank_transfer")}),s.jsx("option",{value:"mobile_money",children:r("paymentMethod_mobile_money")})]})]}),m.method==="mobile_money"&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs(ke,{label:"Mobile Money Provider",value:m.mobileProvider,onChange:I=>w("mobileProvider",I.target.value),error:g.mobileProvider,required:!0,children:[s.jsx("option",{value:"",children:"Select Provider"}),s.jsx("option",{value:"Orange Money",children:"Orange Money"}),s.jsx("option",{value:"M-Pesa",children:"M-Pesa"}),s.jsx("option",{value:"Airtel Money",children:"Airtel Money"}),s.jsx("option",{value:"Telma MVola",children:"Telma MVola"})]}),s.jsx(de,{label:"Phone Number",type:"tel",value:m.phoneNumber,onChange:I=>w("phoneNumber",I.target.value),error:g.phoneNumber,required:!0,placeholder:"+261..."})]}),n&&n.paymentStatus&&s.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:[s.jsxs("strong",{children:[r("paymentStatus"),": "]})," ",r(`status_${n.paymentStatus}`),n.transactionId&&s.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:[r("transactionId"),": ",n.transactionId]})]}),s.jsx(de,{label:`${r("notes")} (${r("optional")})`,value:m.notes,onChange:I=>w("notes",I.target.value)})]})})},hc=(t,e,n,r,i,l={})=>{var I,k;let c=(I=an.find(M=>M.code===i.country))==null?void 0:I.payroll;if(c||(c=(k=an.find(M=>M.code==="MG"))==null?void 0:k.payroll),!c){const M=t+e+n,j=r,O=M-j;return{baseSalary:t,bonuses:e,overtime:n,totalGross:M,deductions:[],otherDeductions:r,totalDeductions:j,netPay:O}}const{constants:d,labels:f}=c,h=d.socialContributions.map(M=>M.key),m=l.appliedDeductions===void 0?h:l.appliedDeductions,x=t+e+n,g=[];let N=0;m.length>0&&d.socialContributions.forEach(M=>{var j;if(m.includes(M.key)){const A=(M.cap?Math.min(x,M.cap):x)*M.rate;N+=A;const F=((j=f.socialContributions.find(P=>P.key===M.key))==null?void 0:j.label)||M.key;g.push({label:F,amount:A})}});const T=x-N;let C=0;if(T>0){for(const M of d.incomeTax.brackets)if(T>M.from){const j=Math.min(T,M.to===1/0?T:M.to)-M.from;j>0&&(C+=j*M.rate)}}d.incomeTax.minimumPerception&&C>0&&(C=Math.max(C,d.incomeTax.minimumPerception)),C>0&&g.push({label:f.incomeTax,amount:C});const E=g.reduce((M,j)=>M+j.amount,0)+r,D=x-E;return{baseSalary:t,bonuses:e,overtime:n,totalGross:x,deductions:g,otherDeductions:r,totalDeductions:E,netPay:D}},Vn=({label:t,children:e})=>s.jsxs("div",{className:"text-[10px] text-black",children:[s.jsxs("div",{className:"flex items-baseline",children:[s.jsx("span",{className:"w-auto mr-2 whitespace-nowrap",children:t}),s.jsx("div",{className:"flex-grow font-semibold truncate pl-1",children:e||s.jsx(s.Fragment,{children:""})})]}),s.jsx("div",{className:"border-b border-black mt-0.5"})]}),P_=({rows:t,periodName:e,pageIndex:n,totalPages:r,data:i})=>{var N,T,C,w,E;const{settings:l}=Ke(),{t:c}=_e(),d=S.useMemo(()=>{var D;return((D=an.find(I=>I.code===l.localization.country))==null?void 0:D.name)||l.localization.country},[l.localization.country]),f=i.columns.some(D=>D.key==="dryPrice"),h=(N=i.headerInfo.find(D=>D.label===c("site")))==null?void 0:N.value,m=(T=i.headerInfo.find(D=>D.label===c("seaweedType")))==null?void 0:T.value,x=(C=i.headerInfo.find(D=>D.label===c("date")))==null?void 0:C.value,g=n===r-1;return s.jsx(Xs,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&s.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),s.jsxs("span",{children:[c("address"),": ",l.company.address]}),s.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),s.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),s.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),s.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),s.jsxs("span",{children:[c("email"),": ",l.company.email]}),s.jsxs("span",{children:[c("country"),": ",d]})]})]}),s.jsx("div",{className:"col-span-1"})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Vn,{label:`${c("exploitationSite")}:`,children:h}),s.jsx(Vn,{label:`${c("dateLabel")} du paiement:`,children:x}),s.jsx(Vn,{label:`${c("totalPaymentAmount")}:`,children:Ae(i.totalValue,l.localization)}),s.jsx(Vn,{label:`(${c("totalAmountInWords")})`})]}),s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Vn,{label:`${c("seaweedType")}:`,children:m}),s.jsx(Vn,{label:`${c("checkNumber")}:`}),s.jsx(Vn,{label:`${c("pricePerKg")}:`,children:Ae(f?((w=t[0])==null?void 0:w.dryPrice)||0:((E=t[0])==null?void 0:E.wetPrice)||0,l.localization)})]}),s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Vn,{label:`${c("deliveryPeriod")}:`,children:e}),s.jsx(Vn,{label:`${c("checkAmount")}:`})]})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Trans. Date"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Farmer"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Weight"}),f&&s.jsx("th",{className:"px-1 py-1 border border-black",children:"Bags"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Value"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Credits"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),s.jsx("tbody",{children:t.map((D,I)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:x}),s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:D.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ue(D.netWeightKg??D.totalWeightKg,l.localization)}),f&&s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:D.totalBags}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(D.baseAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(D.deduction,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(D.netAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),s.jsx("td",{className:"px-1 py-0.5 border border-black"})]},I))}),g&&s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:f?5:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),s.jsx("td",{colSpan:3,className:"px-1 py-1 border border-black"})]})})]}),s.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:s.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:c("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",n+1,"/",r]})]})]})]})})},Uz=({rows:t,periodName:e,pageIndex:n,totalPages:r,data:i})=>{var g,N,T;const{settings:l}=Ke(),{t:c}=_e(),d=S.useMemo(()=>{var C;return((C=an.find(w=>w.code===l.localization.country))==null?void 0:C.name)||l.localization.country},[l.localization.country]),f=(g=i.headerInfo.find(C=>C.label===c("site")))==null?void 0:g.value,h=(N=i.headerInfo.find(C=>C.label===c("seaweedType")))==null?void 0:N.value,m=(T=i.headerInfo.find(C=>C.label===c("paymentDate")))==null?void 0:T.value,x=n===r-1;return s.jsx(Xs,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&s.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),s.jsxs("span",{children:[c("address"),": ",l.company.address]}),s.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),s.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),s.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),s.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),s.jsxs("span",{children:[c("email"),": ",l.company.email]}),s.jsxs("span",{children:[c("country"),": ",d]})]})]})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),s.jsxs("div",{className:"grid grid-cols-4 gap-x-4 mb-2",children:[s.jsx(Vn,{label:`${c("exploitationSite")}:`,children:f}),s.jsx(Vn,{label:`${c("seaweedType")}:`,children:h}),s.jsx(Vn,{label:`${c("deliveryPeriod")}:`,children:e}),s.jsx(Vn,{label:`${c("paymentDate")}:`,children:m})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:c("serviceDate")}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Provider"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Number of Lines"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Unit Price"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount to Pay"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),s.jsx("tbody",{children:t.map((C,w)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:C.date}),s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:C.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:C.totalLines}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:C.averageUnitPrice!==null?Ae(C.averageUnitPrice,l.localization):c("various")}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(C.netAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),s.jsx("td",{className:"px-1 py-0.5 border border-black"})]},w))}),x&&s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),s.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black"})]})})]}),s.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:s.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:c("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",n+1,"/",r]})]})]})]})})},Bz=({beneficiaryRows:t,pageIndex:e,totalPages:n,isLastPage:r,summaryData:i,denominations:l,data:c,periodName:d})=>{var T,C,w;const{settings:f}=Ke(),{t:h}=_e(),m=S.useMemo(()=>{var E;return((E=an.find(D=>D.code===f.localization.country))==null?void 0:E.name)||f.localization.country},[f.localization.country]),x=(T=c.headerInfo.find(E=>E.label===h("site")))==null?void 0:T.value,g=(C=c.headerInfo.find(E=>E.label===h("seaweedType")))==null?void 0:C.value,N=(w=c.headerInfo.find(E=>E.label===h("date")))==null?void 0:w.value;return s.jsx(Xs,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:f.company.logoUrl&&s.jsx("img",{src:f.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:f.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[h("capital"),": ",Ae(f.company.capital,f.localization)]}),s.jsxs("span",{children:[h("address"),": ",f.company.address]}),s.jsxs("span",{children:[h("nif"),": ",f.company.nif]}),s.jsxs("span",{children:[h("stat"),": ",f.company.stat]}),s.jsxs("span",{children:[h("rc"),": ",f.company.rc]}),s.jsxs("span",{children:[h("phone"),": ",f.company.phone]}),s.jsxs("span",{children:[h("email"),": ",f.company.email]}),s.jsxs("span",{children:[h("country"),": ",m]})]})]}),s.jsx("div",{className:"col-span-1"})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:h("denominationBreakdown")})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[s.jsx(Vn,{label:`${h("exploitationSite")}:`,children:x}),s.jsx(Vn,{label:`${h("seaweedType")}:`,children:g}),s.jsx(Vn,{label:`${h("deliveryPeriod")}:`,children:d}),s.jsx(Vn,{label:`${h("dateLabel")} du paiement:`,children:N})]}),s.jsx("h3",{className:"font-bold text-[10px] my-1",children:h("breakdownByBeneficiary")}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Beneficiary"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),l.map(E=>s.jsx("th",{className:"p-1 border border-black font-normal whitespace-nowrap",style:{fontSize:"8px"},children:Ae(E.value,f.localization)},E.id))]})}),s.jsx("tbody",{children:t.map((E,D)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[120px]",children:E.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(E.netAmount,f.localization)}),l.map(I=>s.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.breakdown[I.value]||""},I.id))]},D))})]}),r&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"font-bold text-[10px] my-1 mt-4",children:h("summaryTable")}),s.jsxs("table",{className:"w-1/3 border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Denomination"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Quantity"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount"})]})}),s.jsx("tbody",{children:i.map(E=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.value,f.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.count}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.total,f.localization)})]},E.value))}),s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black text-right",children:h("total")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(c.totalValue,f.localization)})]})})]})]}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:h("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[f.company.name," - ",f.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",e+1,"/",n]})]})]})]})})},Gz=({data:t,autoDownload:e})=>{const{t:n}=_e(),{settings:r}=Ke(),[i,l]=S.useState(!1),c=S.useRef(!1),d=30,f=25,h=S.useMemo(()=>{switch(t.beneficiaryTypeLabel){case n("farmer"):return P_;case n("provider"):return Uz;default:return P_}},[t.beneficiaryTypeLabel,n]),m=S.useMemo(()=>{if(t.rows.length===0)return[[]];const k=[];for(let M=0;M<t.rows.length;M+=d)k.push(t.rows.slice(M,M+d));return k},[t.rows]),x=m.length,g=S.useMemo(()=>[...r.localization.denominations].sort((k,M)=>M.value-k.value),[r.localization.denominations]),N=S.useMemo(()=>t.rows.map(k=>{let M=k.netAmount;const j={};return g.forEach(O=>{const A=Math.floor(M/O.value);A>0&&(j[O.value]=A,M-=A*O.value,M=parseFloat(M.toFixed(r.localization.monetaryDecimals)))}),{beneficiaryName:k.beneficiaryName,netAmount:k.netAmount,breakdown:j}}),[t.rows,g,r.localization.monetaryDecimals]),T=S.useMemo(()=>{const k=new Map;return g.forEach(M=>k.set(M.value,{count:0,total:0})),N.forEach(M=>{for(const[j,O]of Object.entries(M.breakdown)){const A=parseFloat(j),F=k.get(A);F&&(F.count+=O,F.total+=O*A)}}),Array.from(k.entries()).map(([M,j])=>({value:M,...j})).filter(M=>M.count>0).sort((M,j)=>j.value-M.value)},[N,g]),C=S.useMemo(()=>{if(N.length===0)return[[]];const k=[];for(let M=0;M<N.length;M+=f)k.push(N.slice(M,M+f));return k},[N]),w=C.length,E=()=>{window.print()},D=S.useCallback(async()=>{if(!i){l(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:k}=window.jspdf,M=window.html2canvas,j=document.getElementById("printable-area");if(!j)throw new Error("Printable area not found");const O=new k({orientation:"l",unit:"mm",format:"a4",compress:!0});O.setProperties({title:t.title,subject:"Payment Sheet",author:r.company.name,creator:"AlgaManage"});const A=j.getElementsByClassName("print-page");for(let F=0;F<A.length;F++){const U=(await M(A[F],{scale:4,useCORS:!0,windowWidth:1920,backgroundColor:"#ffffff"})).toDataURL("image/png");F>0&&O.addPage();const q=O.getImageProperties(U),z=O.internal.pageSize.getWidth(),J=q.height*z/q.width;O.addImage(U,"PNG",0,0,z,J,void 0,"FAST")}O.save(`PaymentSheet-${t.title.replace(/ /g,"_")}-${t.periodName.replace(/ /g,"_")}.pdf`)}catch(k){console.error("Error generating PDF:",k),alert(n("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),l(!1)}}},[i,t.title,t.periodName,n,r.company.name]);S.useEffect(()=>{e&&!c.current&&(c.current=!0,setTimeout(()=>{D()},500))},[e,D]);const I=h;return s.jsxs("div",{children:[s.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(se,{onClick:D,disabled:i,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:i?"Activity":"Download",className:`w-5 h-5 ${i?"animate-spin":""}`}),s.jsx("span",{className:"ml-2",children:n(i?"downloading":"downloadPdf")})]}),s.jsxs(se,{onClick:E,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2",children:n("print")})]})]})}),s.jsxs("div",{id:"printable-area",className:"text-black font-sans text-sm bg-gray-200 p-4 sm:p-8",children:[m.map((k,M)=>s.jsx(I,{rows:k,periodName:t.periodName,pageIndex:M,totalPages:x+w,data:t},`main-page-${M}`)),C.map((k,M)=>s.jsx(Bz,{beneficiaryRows:k,pageIndex:x+M,totalPages:x+w,isLastPage:M===w-1,summaryData:T,denominations:g,data:t,periodName:t.periodName},`breakdown-page-${M}`))]})]})},zz=async t=>new Promise(e=>{setTimeout(()=>{if(Math.random()>.1){const r=`TXN-${Date.now().toString(36).toUpperCase()}-${Math.floor(Math.random()*1e4)}`;e({success:!0,transactionId:r})}else e({success:!1,message:"Transaction failed: Insufficient funds or network timeout."})},2e3)}),Hz=({data:t})=>{var c;const{settings:e}=Ke(),{t:n,language:r}=_e();S.useMemo(()=>{var d;return((d=an.find(f=>f.code===e.localization.country))==null?void 0:d.name)||e.localization.country},[e.localization.country]);const i=new Date(t.payment.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB"),l=t.payment.id.includes("pay-")?`PAY-${(c=t.payment.id.split("-").pop())==null?void 0:c.substring(0,6).toUpperCase()}`:`PAY-${t.payment.id.substring(0,8).toUpperCase()}`;return s.jsx(Xs,{children:s.jsxs("div",{className:"max-w-xl mx-auto border border-gray-400 p-6 bg-white",children:[s.jsxs("header",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Logo",className:"h-12 mb-2 object-contain"}),s.jsx("h1",{className:"font-bold text-sm uppercase",children:e.company.name}),s.jsx("p",{className:"text-[10px] text-gray-600",children:e.company.address}),s.jsxs("p",{className:"text-[10px] text-gray-600",children:[n("phone"),": ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("h2",{className:"text-xl font-bold uppercase",children:n("payslip")}),s.jsxs("p",{className:"text-xs text-gray-500",children:[n("receiptNo"),": ",l]}),s.jsxs("p",{className:"text-xs text-gray-500",children:[n("dateLabel"),": ",i]})]})]}),s.jsx("section",{className:"mb-6 bg-gray-50 p-3 rounded border border-gray-200",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("farmer")}),s.jsxs("span",{className:"font-bold",children:[t.farmer.firstName," ",t.farmer.lastName]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("code")}),s.jsx("span",{className:"font-mono",children:t.farmer.code})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("site")}),s.jsx("span",{children:t.siteName})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("period")}),s.jsx("span",{children:t.payment.period})]})]})}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1",children:n("paymentDetails")}),s.jsxs("table",{className:"w-full text-xs mb-4",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-1",children:n("description")}),s.jsx("th",{className:"text-right py-1",children:n("weightKg")}),s.jsx("th",{className:"text-right py-1",children:n("unitPrice")}),s.jsx("th",{className:"text-right py-1",children:n("amount")})]})}),s.jsxs("tbody",{children:[t.grossDetails.map((d,f)=>s.jsxs("tr",{className:"border-b border-gray-100",children:[s.jsx("td",{className:"py-1",children:d.description}),s.jsx("td",{className:"text-right py-1",children:d.weight?Ue(d.weight,e.localization):"-"}),s.jsx("td",{className:"text-right py-1",children:d.unitPrice?Ae(d.unitPrice,e.localization):"-"}),s.jsx("td",{className:"text-right py-1",children:Ae(d.amount,e.localization)})]},f)),s.jsxs("tr",{className:"font-bold bg-gray-50",children:[s.jsx("td",{colSpan:3,className:"py-2 text-right",children:n("grossAmount")}),s.jsx("td",{className:"py-2 text-right",children:Ae(t.totalGross,e.localization)})]})]})]}),t.deductions.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1 text-red-600",children:n("deductions")}),s.jsx("table",{className:"w-full text-xs mb-4",children:s.jsxs("tbody",{children:[t.deductions.map((d,f)=>s.jsxs("tr",{className:"border-b border-gray-100 text-red-600",children:[s.jsx("td",{className:"py-1",children:d.description}),s.jsxs("td",{className:"text-right py-1",children:["-",Ae(d.amount,e.localization)]})]},f)),s.jsxs("tr",{className:"font-bold bg-red-50 text-red-700",children:[s.jsx("td",{className:"py-2 text-right",children:n("totalDeductions")}),s.jsxs("td",{className:"py-2 text-right",children:["-",Ae(t.totalDeductions,e.localization)]})]})]})})]})]}),s.jsxs("section",{className:"mb-8 bg-blue-50 p-4 rounded border border-blue-200 flex justify-between items-center",children:[s.jsx("span",{className:"text-lg font-bold text-blue-900 uppercase",children:n("netPaid")}),s.jsx("span",{className:"text-2xl font-bold text-blue-900",children:Ae(t.netPaid,e.localization)})]}),s.jsxs("section",{className:"mb-8 text-xs text-gray-600",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("paymentMethod"),":"]})," ",n(`paymentMethod_${t.payment.method}`)]}),t.payment.method==="mobile_money"&&s.jsxs(s.Fragment,{children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("mobileMoneyRef"),":"]})," ",t.payment.transactionId||"N/A"]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("phone"),":"]})," ",t.payment.phoneNumber]})]}),t.payment.notes&&s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("notes"),":"]})," ",t.payment.notes]})]}),s.jsxs("footer",{className:"flex justify-between text-xs mt-12 pt-4 border-t border-gray-300",children:[s.jsxs("div",{className:"text-center w-1/3",children:[s.jsx("p",{className:"font-bold mb-8",children:n("paidBy")}),s.jsx("p",{children:e.company.name})]}),s.jsxs("div",{className:"text-center w-1/3",children:[s.jsx("p",{className:"font-bold mb-8",children:n("receivedBy")}),s.jsxs("p",{children:[t.farmer.firstName," ",t.farmer.lastName]})]})]})]})})},Vz=(t,e,n)=>{try{const[r,i]=t.split("-").map(Number);return new Date(r,i-1).toLocaleDateString(e,{month:"long",year:"numeric"})}catch{return t}},qz=()=>null,Rh=({onSelectAll:t,allSelected:e,header:n,children:r,footer:i})=>s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{checked:e,onChange:l=>t(l.target.checked)})}),n]})}),s.jsx("tbody",{children:r}),i&&s.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-bold border-t-2 border-gray-200 dark:border-gray-600",children:i})]}),Wz=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Ke(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.netWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[t]);return s.jsx(Rh,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("farmer")}),s.jsx("th",{className:"p-3 text-right",children:l("netWeightKg")}),s.jsx("th",{className:"p-3 text-right",children:l("wetPrice")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:Ue(d.weight,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ue(f.netWeightKg,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.wetPrice,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},$z=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Ke(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.totalWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[t]);return s.jsx(Rh,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("farmer")}),s.jsx("th",{className:"p-3 text-right",children:l("totalWeightKg")}),s.jsx("th",{className:"p-3 text-right",children:l("dryPrice")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:Ue(d.weight,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ue(f.totalWeightKg,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.dryPrice,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},Kz=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Ke(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({lines:f.lines+h.totalLines,base:f.base+h.baseAmount,net:f.net+h.netAmount}),{lines:0,base:0,net:0}),[t]);return s.jsx(Rh,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("serviceDate")}),s.jsx("th",{className:"p-3",children:l("serviceProvider")}),s.jsx("th",{className:"p-3 text-right",children:l("numberOfLines")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:3,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:d.lines}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.date}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:f.totalLines}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},Yz=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Ke(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({base:f.base+h.baseSalary,gross:f.gross+h.totalGross,deduction:f.deduction+h.totalDeductions,net:f.net+h.netPay}),{base:0,gross:0,deduction:0,net:0}),[t]);return s.jsx(Rh,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("employee")}),s.jsx("th",{className:"p-3 text-right",children:l("grossSalary")}),s.jsx("th",{className:"p-3 w-32 text-right",children:l("bonuses")}),s.jsx("th",{className:"p-3 w-32 text-right",children:l("overtime")}),s.jsx("th",{className:"p-3 text-right",children:l("totalGross")}),s.jsx("th",{className:"p-3 text-right",children:l("totalDeductions")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPay")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.gross,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseSalary,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.bonuses,onChange:h=>i(f.id,"bonuses",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.overtime,onChange:h=>i(f.id,"overtime",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.totalGross,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.totalDeductions,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netPay,c.localization)})]},f.id))})},Jz=({onCancel:t,onConfirmSuccess:e,config:n})=>{const{t:r,language:i}=_e(),{settings:l}=Ke(),{farmers:c,sites:d,seaweedTypes:f,cultivationCycles:h,modules:m,farmerCredits:x,repayments:g,farmerDeliveries:N,cuttingOperations:T,serviceProviders:C,employees:w,addMultipleMonthlyPayments:E,addMultipleRepayments:D,updateMultipleCuttingOperations:I,markCyclesAsPaid:k,markDeliveriesAsPaid:M}=qe(),[j,O]=S.useState([]),[A,F]=S.useState({enabled:!0,type:"percentage",value:100}),[P,U]=S.useState(!1),[q,z]=S.useState(!1),[J,Y]=S.useState(!1),[G,B]=S.useState(null),Q=S.useCallback(()=>{var $e;let fe=[];const{paymentType:Z,startDate:ee,endDate:xe,siteId:Oe,seaweedTypeId:De}=n,Re=He=>{const Se=x.filter(be=>be.farmerId===He).reduce((be,ye)=>be+ye.totalAmount,0),Le=g.filter(be=>be.farmerId===He).reduce((be,ye)=>be+ye.amount,0);return Se-Le};if(Z==="farmer_wet")fe=c.filter(Se=>Oe==="all"||Se.siteId===Oe).map(Se=>{var Lt;const Le=h.filter(ut=>{const $t=m.find(Pt=>Pt.id===ut.moduleId);return($t==null?void 0:$t.farmerId)===Se.id&&ut.harvestDate&&ut.harvestDate>=ee&&ut.harvestDate<=xe&&!ut.paymentRunId&&(De==="all"||ut.seaweedTypeId===De)});if(Le.length===0)return null;const be=Le.reduce((ut,$t)=>{var on;const Pt=($t.harvestedWeight||0)-($t.cuttingsTakenAtHarvestKg||0),St=((on=f.find(tr=>tr.id===$t.seaweedTypeId))==null?void 0:on.wetPrice)||0;return ut+Pt*St},0),ye=Le.reduce((ut,$t)=>ut+(($t.harvestedWeight||0)-($t.cuttingsTakenAtHarvestKg||0)),0),Fe=ye>0?be/ye:0;return{id:Se.id,type:rn.FARMER,name:`${Se.firstName} ${Se.lastName}`,siteName:((Lt=d.find(ut=>ut.id===Se.siteId))==null?void 0:Lt.name)||"",baseAmount:be,adjustment:0,deduction:0,netAmount:be,creditBalance:Re(Se.id),selected:!0,cycleIds:Le.map(ut=>ut.id),harvestedWeightKg:Le.reduce((ut,$t)=>ut+($t.harvestedWeight||0),0),cuttingsWeightKg:Le.reduce((ut,$t)=>ut+($t.cuttingsTakenAtHarvestKg||0),0),netWeightKg:ye,wetPrice:Fe}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Z==="farmer_dry"){const He=c.filter(Le=>Oe==="all"||Le.siteId===Oe),Se=new Map(f.map(Le=>[Le.id,Le.dryPrice]));fe=He.map(Le=>{var $t;const be=N.filter(Pt=>Pt.farmerId===Le.id&&Pt.date>=ee&&Pt.date<=xe&&!Pt.paymentRunId&&(De==="all"||Pt.seaweedTypeId===De));if(be.length===0)return null;const ye=be.reduce((Pt,St)=>{const on=Se.get(St.seaweedTypeId)||0;return Pt+St.totalWeightKg*on},0),Fe=be.reduce((Pt,St)=>Pt+St.totalWeightKg,0),et=be.reduce((Pt,St)=>Pt+St.totalBags,0),Lt=be.length>0&&Fe>0?ye/Fe:0;return{id:Le.id,type:rn.FARMER,name:`${Le.firstName} ${Le.lastName}`,siteName:(($t=d.find(Pt=>Pt.id===Le.siteId))==null?void 0:$t.name)||"",totalWeightKg:Fe,dryPrice:Lt,baseAmount:ye,totalBags:et,adjustment:0,deduction:0,netAmount:ye,creditBalance:Re(Le.id),selected:!0,deliveryIds:be.map(Pt=>Pt.id)}}).filter(Le=>Le!==null&&Le.baseAmount>0)}else if(Z==="service_provider")fe=T.filter(Se=>!Se.isPaid&&Se.date>=ee&&Se.date<=xe&&(Oe==="all"||Se.siteId===Oe)&&(De==="all"||Se.seaweedTypeId===De)).map(Se=>{const Le=C.find(Fe=>Fe.id===Se.serviceProviderId),be=Se.moduleCuts.reduce((Fe,et)=>Fe+et.linesCut,0);return{id:Se.id,serviceProviderId:Se.serviceProviderId,type:rn.SERVICE_PROVIDER,name:(Le==null?void 0:Le.name)||"Unknown",date:Se.date,unpaidOperations:1,baseAmount:Se.totalAmount,adjustment:0,deduction:0,netAmount:Se.totalAmount,selected:!0,operationIds:[Se.id],totalLines:be,averageUnitPrice:Se.unitPrice}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Z==="employee_payroll"){if(!(($e=an.find(Le=>Le.code===l.localization.country))==null?void 0:$e.payroll)){alert(r("alert_noPayrollConfig"));return}fe=w.filter(Le=>Oe==="all"||Le.siteId===Oe).map(Le=>{var Fe;const be=hc(Le.grossWage,0,0,0,l.localization);return{id:Le.id,type:rn.EMPLOYEE,name:`${Le.firstName} ${Le.lastName}`,siteName:((Fe=d.find(et=>et.id===Le.siteId))==null?void 0:Fe.name)||"",selected:!0,baseAmount:be.totalGross,deduction:be.totalDeductions,netAmount:be.netPay,...be}})}O(fe)},[n,c,d,f,h,m,x,g,N,T,C,w,l.localization,r]);S.useEffect(()=>{Q()},[Q]);const K=(fe,Z,ee)=>{const xe=parseFloat(ee)||0;O(Oe=>Oe.map(De=>{if(De.id===fe){if(De.type===rn.EMPLOYEE){const Re={...De,[Z]:xe},$e=hc(Re.baseSalary,Re.bonuses,Re.overtime,Re.otherDeductions,l.localization);return{...Re,...$e,baseAmount:$e.totalGross,deduction:$e.totalDeductions,netAmount:$e.netPay}}else if("adjustment"in De){const Re=De.baseAmount-De.adjustment+xe;return{...De,adjustment:xe,netAmount:Re-De.deduction}}}return De}))};S.useEffect(()=>{O(fe=>fe.map(Z=>{if(Z.type===rn.FARMER&&Z.selected){let ee=0;const xe=Z.baseAmount+Z.adjustment;return A.enabled&&Z.creditBalance&&Z.creditBalance>0&&(A.type==="percentage"?ee=xe*A.value/100:ee=A.value,ee=Math.min(ee,xe,Z.creditBalance)),{...Z,deduction:ee,netAmount:xe-ee}}return Z}))},[A,j.map(fe=>fe.baseAmount+(fe.type!==rn.EMPLOYEE?fe.adjustment:0)).join(",")]);const re=fe=>{F(fe)},H=(fe,Z)=>{O(ee=>ee.map(xe=>xe.id===fe?{...xe,selected:Z}:xe))},ae=fe=>{O(Z=>Z.map(ee=>({...ee,selected:fe})))},ue=j.filter(fe=>fe.selected),Ne=j.length>0&&ue.length===j.length,le=S.useMemo(()=>ue.reduce((fe,Z)=>(fe.base+=Z.baseAmount+(Z.type!==rn.EMPLOYEE?Z.adjustment:0),fe.deduction+=Z.deduction,fe.net+=Z.netAmount,fe),{base:0,deduction:0,net:0}),[ue]),ne=()=>{const fe=`pr-${Date.now()}`,Z=new Date().toISOString().split("T")[0],ee=[],xe=[],Oe=[],De=[],Re=[];ue.forEach($e=>{$e.netAmount<=0&&$e.deduction<=0||($e.netAmount>0&&ee.push({date:Z,period:n.periodName,recipientType:$e.type,recipientId:$e.serviceProviderId||$e.id,amount:$e.netAmount,method:"cash",notes:`Payment for period: ${n.startDate} to ${n.endDate}`,paymentRunId:fe,paymentStatus:"PENDING"}),"deduction"in $e&&$e.deduction>0&&$e.type===rn.FARMER&&xe.push({date:Z,farmerId:$e.id,amount:$e.deduction,method:"harvest_deduction",notes:`Deduction from payment run: ${n.periodName}`,paymentRunId:fe}),$e.type===rn.SERVICE_PROVIDER&&"operationIds"in $e?Oe.push(...$e.operationIds):n.paymentType==="farmer_wet"&&"cycleIds"in $e?De.push(...$e.cycleIds):n.paymentType==="farmer_dry"&&"deliveryIds"in $e&&Re.push(...$e.deliveryIds))}),ee.length>0&&E(ee),xe.length>0&&D(xe),Oe.length>0&&I(Oe,Z),De.length>0&&k(De,fe),Re.length>0&&M(Re,fe),e()},Te=()=>{var Re,$e;let fe="",Z="",ee=[];switch(n.paymentType){case"farmer_wet":fe=r("wetDeliveryPaymentSheetTitle"),Z=r("farmer"),ee=[{key:"name",label:r("farmer"),width:"25%"},{key:"harvestedWeightKg",label:r("harvestedWeightKg"),align:"right",format:"number",width:"12%"},{key:"cuttingsWeightKg",label:r("cuttingsWeightKg"),align:"right",format:"number",width:"12%"},{key:"netWeightKg",label:r("netWeightKg"),align:"right",format:"number",width:"12%"},{key:"wetPrice",label:r("wetPrice"),align:"right",format:"currency",width:"10%"},{key:"baseAmount",label:r("baseAmount"),align:"right",format:"currency",width:"12%"},{key:"deduction",label:r("creditDeduction"),align:"right",format:"currency",width:"12%"},{key:"netAmount",label:r("netPayable"),align:"right",format:"currency",width:"15%"}];break;case"farmer_dry":fe=r("dryDeliveryPaymentSheetTitle"),Z=r("farmer"),ee=[{key:"name",label:r("farmer"),width:"30%"},{key:"totalWeightKg",label:r("totalWeightKg"),align:"right",format:"number",width:"15%"},{key:"dryPrice",label:r("pricePerKg"),align:"right",format:"currency",width:"15%"},{key:"baseAmount",label:r("baseAmount"),align:"right",format:"currency",width:"15%"},{key:"deduction",label:r("creditDeduction"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:r("netPayable"),align:"right",format:"currency",width:"20%"}];break;case"service_provider":fe=r("cuttingPaymentSheetTitle"),Z=r("provider"),ee=[{key:"date",label:r("dateTrans"),width:"10%"},{key:"name",label:r("provider"),width:"30%"},{key:"totalLines",label:r("numberOfLines"),align:"right",format:"number",width:"15%"},{key:"averageUnitPrice",label:r("unitPrice"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:r("montantAPayer"),align:"right",format:"currency",width:"15%"}];break;case"employee_payroll":fe=r("employeePayroll"),Z=r("employee"),ee=[{key:"name",label:r("employee"),width:"25%"},{key:"baseSalary",label:r("grossSalary"),align:"right",format:"currency",width:"15%"},{key:"totalGross",label:r("totalGross"),align:"right",format:"currency",width:"15%"},{key:"totalDeductions",label:r("totalDeductions"),align:"right",format:"currency",width:"15%"},{key:"netPay",label:r("netPay"),align:"right",format:"currency",width:"15%"}];break}const xe=ue.reduce((He,Se)=>He+Se.netAmount,0),Oe=n.seaweedTypeId!=="all"?(Re=f.find(He=>He.id===n.seaweedTypeId))==null?void 0:Re.name:r("various"),De={title:fe,periodName:n.periodName,headerInfo:[{label:r("date"),value:new Date().toLocaleDateString(i)},{label:r("period"),value:`${n.startDate} - ${n.endDate}`},{label:r("site"),value:n.siteId==="all"?r("allSites"):($e=d.find(He=>He.id===n.siteId))==null?void 0:$e.name},{label:r("seaweedType"),value:Oe}],columns:ee,rows:ue.map(He=>({beneficiaryName:He.name,...He})),totalLabel:r("totalToPay"),totalValue:xe,totalValueInWords:SE(xe,i,l.localization),denominations:l.localization.denominations,beneficiaryTypeLabel:Z,status:"Unpaid"};B(De),Y(!0)};return s.jsxs(ze,{title:r("reviewPaymentRun"),children:[s.jsxs("p",{className:"mb-4",children:[n.periodName," (",n.startDate," to ",n.endDate,")"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalPayees")}),s.jsx("p",{className:"text-2xl font-bold",children:ue.length})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalBaseAmount")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(le.base,l.localization)})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalDeductions")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(le.deduction,l.localization)})]}),s.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:r("totalNetPayable")}),s.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(le.net,l.localization)})]})]}),s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex gap-4",children:[n.paymentType.startsWith("farmer")&&s.jsxs(se,{variant:"secondary",onClick:()=>U(!0),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),r("configureDeductions")]}),s.jsxs(se,{onClick:Te,children:[s.jsx(te,{name:"Download",className:"w-4 h-4"}),r("downloadPdf")]}),s.jsxs(se,{onClick:()=>z(!0),disabled:ue.length===0,children:[s.jsx(te,{name:"Check",className:"w-4 h-4"}),r("confirmAndPay")]})]}),s.jsxs(se,{variant:"secondary",onClick:t,children:[s.jsx(te,{name:"ChevronLeft",className:"w-4 h-4"}),r("back")]})]}),s.jsxs("div",{className:"overflow-x-auto",children:[n.paymentType==="farmer_wet"&&s.jsx(Wz,{payees:j,onSelectOne:H,onSelectAll:ae,allSelected:Ne,onUpdate:K}),n.paymentType==="farmer_dry"&&s.jsx($z,{payees:j,onSelectOne:H,onSelectAll:ae,allSelected:Ne,onUpdate:K}),n.paymentType==="service_provider"&&s.jsx(Kz,{payees:j,onSelectOne:H,onSelectAll:ae,allSelected:Ne,onUpdate:K}),n.paymentType==="employee_payroll"&&s.jsx(Yz,{payees:j,onSelectOne:H,onSelectAll:ae,allSelected:Ne,onUpdate:K})]}),G&&s.jsx(ot,{isOpen:J,onClose:()=>Y(!1),title:r("printDocuments"),widthClass:"max-w-screen-xl",children:s.jsx(Gz,{data:G})}),q&&s.jsx(Qt,{isOpen:q,onClose:()=>z(!1),onConfirm:ne,title:r("confirmPayment"),message:r("confirmPaymentMessage").replace("{count}",String(ue.length)),confirmText:r("confirm")}),P&&s.jsx(qz,{isOpen:P,onClose:()=>U(!1),initialConfig:A,onSave:fe=>{re(fe),U(!1)}})]})},Xz=()=>{const{t,language:e}=_e(),{settings:n}=Ke(),{monthlyPayments:r,farmers:i,employees:l,serviceProviders:c,deleteMonthlyPayment:d,updateMonthlyPayment:f,repayments:h,cultivationCycles:m,farmerDeliveries:x,seaweedTypes:g,sites:N}=qe(),[T,C]=S.useState(!1),[w,E]=S.useState(null),[D,I]=S.useState(!1),[k,M]=S.useState(null),[j,O]=S.useState({key:"date",direction:"descending"}),[A,F]=S.useState(new Set),[P,U]=S.useState(!1),[q,z]=S.useState(null),J=S.useMemo(()=>{const le=new Map;return i.forEach(ne=>le.set(`${rn.FARMER}-${ne.id}`,`${ne.firstName} ${ne.lastName}`)),l.forEach(ne=>le.set(`${rn.EMPLOYEE}-${ne.id}`,`${ne.firstName} ${ne.lastName}`)),c.forEach(ne=>le.set(`${rn.SERVICE_PROVIDER}-${ne.id}`,ne.name)),le},[i,l,c]),Y=S.useMemo(()=>{let le=[...r];return le.sort((ne,Te)=>{let fe,Z;return j.key==="recipientName"?(fe=J.get(`${ne.recipientType}-${ne.recipientId}`)||"",Z=J.get(`${Te.recipientType}-${Te.recipientId}`)||""):(fe=ne[j.key],Z=Te[j.key]),fe<Z?j.direction==="ascending"?-1:1:fe>Z?j.direction==="ascending"?1:-1:0}),le},[r,j,J]),G=le=>{let ne="ascending";j.key===le&&j.direction==="ascending"&&(ne="descending"),O({key:le,direction:ne})},B=le=>j.key!==le?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):j.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Q=({sortKey:le,label:ne})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>G(le),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[ne,B(le)]})}),K=(le=null)=>{E(le),C(!0)},re=le=>{M(le),I(!0)},H=()=>{k&&d(k),I(!1),M(null)},ae=async le=>{if(!A.has(le.id)){F(ne=>new Set(ne).add(le.id)),f({...le,paymentStatus:"PROCESSING"});try{const ne=await zz(le);ne.success?(f({...le,paymentStatus:"COMPLETED",transactionId:ne.transactionId}),alert(`Payment Successful! Transaction ID: ${ne.transactionId}`)):(f({...le,paymentStatus:"FAILED"}),alert(`Payment Failed: ${ne.message}`))}catch(ne){console.error("Payment processing error",ne),f({...le,paymentStatus:"FAILED"}),alert("An unexpected error occurred.")}finally{F(ne=>{const Te=new Set(ne);return Te.delete(le.id),Te})}}},ue=le=>{if(le.recipientType!==rn.FARMER){alert("Only Farmer receipts are currently supported for detailed printing.");return}const ne=i.find(He=>He.id===le.recipientId);if(!ne)return;const Te=N.find(He=>He.id===ne.siteId),fe=le.paymentRunId,Z=h.filter(He=>He.farmerId===ne.id&&He.paymentRunId===fe),ee=[];m.filter(He=>He.paymentRunId===fe).forEach(He=>{const Se=(He.harvestedWeight||0)-(He.cuttingsTakenAtHarvestKg||0),Le=g.find(be=>be.id===He.seaweedTypeId);ee.push({description:`Harvest: ${Le==null?void 0:Le.name} (${He.harvestDate})`,weight:Se,unitPrice:Le==null?void 0:Le.wetPrice,amount:Se*((Le==null?void 0:Le.wetPrice)||0)})}),x.filter(He=>He.paymentRunId===fe).forEach(He=>{const Se=g.find(Le=>Le.id===He.seaweedTypeId);ee.push({description:`Delivery: ${Se==null?void 0:Se.name} (${He.date})`,weight:He.totalWeightKg,unitPrice:Se==null?void 0:Se.dryPrice,amount:He.totalWeightKg*((Se==null?void 0:Se.dryPrice)||0)})}),ee.length===0&&ee.push({description:"Manual Payment / Adjustment",amount:le.amount+Z.reduce((He,Se)=>He+Se.amount,0)});const De=Z.map(He=>({description:He.notes||"Credit Repayment",amount:He.amount})),Re=ee.reduce((He,Se)=>He+Se.amount,0),$e=De.reduce((He,Se)=>He+Se.amount,0);z({payment:le,farmer:ne,siteName:(Te==null?void 0:Te.name)||"",grossDetails:ee,deductions:De,totalGross:Re,totalDeductions:$e,netPaid:le.amount}),U(!0)},Ne=(le,ne)=>{const Te=`${le}-${ne}`,fe=J.get(Te);return fe||s.jsx("span",{className:"text-gray-500 italic",children:t("unknown")})};return s.jsxs(ze,{title:t("paymentHistory"),children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(Q,{sortKey:"date",label:t("paymentDate")}),s.jsx(Q,{sortKey:"period",label:t("period")}),s.jsx(Q,{sortKey:"recipientName",label:t("recipient")}),s.jsx(Q,{sortKey:"recipientType",label:t("recipientType")}),s.jsx("th",{className:"p-3 text-right",children:t("amount")}),s.jsx("th",{className:"p-3",children:t("paymentMethod")}),s.jsx("th",{className:"p-3",children:t("paymentStatus")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:Y.map(le=>{const ne=A.has(le.id);return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:le.date}),s.jsx("td",{className:"p-3",children:Vz(le.period,e)}),s.jsx("td",{className:"p-3 font-semibold",children:Ne(le.recipientType,le.recipientId)}),s.jsx("td",{className:"p-3",children:t(`recipientType_${le.recipientType}`)}),s.jsx("td",{className:"p-3 text-right",children:Ae(le.amount,n.localization)}),s.jsx("td",{className:"p-3",children:t(`paymentMethod_${le.method}`)}),s.jsxs("td",{className:"p-3",children:[le.paymentStatus?s.jsx(An,{status:le.paymentStatus}):"-",le.transactionId&&s.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate max-w-[100px]",title:le.transactionId,children:le.transactionId})]}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[le.recipientType===rn.FARMER&&s.jsx(se,{variant:"ghost",onClick:()=>ue(le),title:t("print"),children:s.jsx(te,{name:"Printer",className:"w-4 h-4"})}),le.method==="mobile_money"&&(le.paymentStatus==="PENDING"||le.paymentStatus==="FAILED")&&s.jsx(se,{variant:"primary",className:"!py-1 !px-2 text-xs",onClick:()=>ae(le),disabled:ne,children:ne?s.jsx(te,{name:"Activity",className:"w-3 h-3 animate-spin"}):t("payNow")}),s.jsx(se,{variant:"ghost",onClick:()=>K(le),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",onClick:()=>re(le.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},le.id)})})]})}),T&&s.jsx(Fz,{isOpen:T,onClose:()=>C(!1),payment:w}),D&&s.jsx(Qt,{isOpen:D,onClose:()=>I(!1),onConfirm:H,title:t("confirmDeletePayment"),message:t("confirmDeletePaymentMessage")}),q&&s.jsx(ot,{isOpen:P,onClose:()=>U(!1),title:t("farmerReceipt"),widthClass:"max-w-screen-md",children:s.jsx(Hz,{data:q})})]})},Qz=({onPrepare:t})=>{const{t:e}=_e(),{sites:n,seaweedTypes:r}=qe(),[i,l]=S.useState({periodName:"",startDate:"",endDate:new Date().toISOString().split("T")[0],paymentType:"farmer_wet",siteId:"all",seaweedTypeId:"all"}),c=i.paymentType.startsWith("farmer")||i.paymentType==="service_provider";return s.jsxs(ze,{title:e("paymentRunSetup"),children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[s.jsx(de,{label:e("periodName"),value:i.periodName,onChange:d=>l(f=>({...f,periodName:d.target.value})),placeholder:"e.g. July 2024 Payments",required:!0}),s.jsx(de,{label:e("startDate"),type:"date",value:i.startDate,onChange:d=>l(f=>({...f,startDate:d.target.value})),required:!0}),s.jsx(de,{label:e("endDate"),type:"date",value:i.endDate,onChange:d=>l(f=>({...f,endDate:d.target.value})),required:!0}),s.jsxs(ke,{label:e("paymentType"),value:i.paymentType,onChange:d=>l(f=>({...f,paymentType:d.target.value})),children:[s.jsx("option",{value:"farmer_wet",children:e("wetDeliveryPayment")}),s.jsx("option",{value:"farmer_dry",children:e("dryDeliveryPayment")}),s.jsx("option",{value:"service_provider",children:e("serviceProviderPayment")}),s.jsx("option",{value:"employee_payroll",children:e("employeePayroll")})]}),s.jsxs(ke,{label:e("site"),value:i.siteId,onChange:d=>l(f=>({...f,siteId:d.target.value})),children:[s.jsx("option",{value:"all",children:e("allSites")}),n.map(d=>s.jsx("option",{value:d.id,children:d.name},d.id))]}),c&&s.jsxs(ke,{label:e("seaweedType"),value:i.seaweedTypeId,onChange:d=>l(f=>({...f,seaweedTypeId:d.target.value})),children:[s.jsx("option",{value:"all",children:e("allSeaweedTypes")}),r.map(d=>s.jsx("option",{value:d.id,children:d.name},d.id))]})]}),s.jsx("div",{className:"mt-6",children:s.jsx(se,{onClick:()=>t(i),disabled:!i.periodName||!i.startDate||!i.endDate,children:e("preparePaymentRun")})})]})},Zz=()=>{const{t}=_e(),[e,n]=S.useState("setup"),[r,i]=S.useState(null),l=f=>{i(f),n("review")},c=()=>{i(null),n("setup")},d=()=>{alert(t("paymentsRecordedSuccess")),i(null),n("setup")};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("documentPaymentsTitle")}),e==="setup"&&s.jsx(Qz,{onPrepare:l}),e==="review"&&r&&s.jsx(Jz,{onCancel:c,onConfirmSuccess:d,config:r}),s.jsx("div",{className:"mt-8",children:s.jsx(Xz,{})})]})},bp=["PLANTING","PERIOD_1","PERIOD_2","PERIOD_3","PERIOD_4","PERIOD_5"],eH=({isOpen:t,onClose:e,test:n})=>{const{t:r}=_e(),{sites:i,seaweedTypes:l,employees:c,addPeriodicTest:d,updatePeriodicTest:f,periodicTests:h}=qe(),[m,x]=S.useState({identity:"",date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",zoneId:"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:""}),[g,N]=S.useState([]),[T,C]=S.useState({}),[w,E]=S.useState(!1),[D,I]=S.useState(null),k=S.useCallback(()=>{const A={};return m.identity.trim()||(A.identity=r("validationRequired")),m.date||(A.date=r("validationRequired")),m.siteId||(A.siteId=r("validationRequired")),m.seaweedTypeId||(A.seaweedTypeId=r("validationRequired")),m.zoneId||(A.zoneId=r("validationRequired")),m.conductorId||(A.conductorId=r("validationRequired")),(isNaN(m.weightKg)||m.weightKg<0)&&(A.weightKg=r("validationNonNegative")),A},[m,r]);S.useEffect(()=>{var A,F,P,U,q;x(n||{identity:"",date:new Date().toISOString().split("T")[0],siteId:((A=i[0])==null?void 0:A.id)||"",seaweedTypeId:((F=l[0])==null?void 0:F.id)||"",zoneId:((U=(P=i[0])==null?void 0:P.zones[0])==null?void 0:U.id)||"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:((q=c[0])==null?void 0:q.id)||""}),C({}),E(!1),I(null)},[n,t,i,l,c]),S.useEffect(()=>{if(m.period==="PLANTING"||!m.identity||!m.date||m.weightKg<=0){m.growthRate!==null&&x(U=>({...U,growthRate:null}));return}const A=bp.indexOf(m.period);if(A<=0)return;const F=bp[A-1],P=h.find(U=>U.identity.toLowerCase()===m.identity.toLowerCase()&&U.period===F&&U.siteId===m.siteId);if(P&&P.weightKg>0&&P.date){const U=new Date(P.date).getTime(),z=(new Date(m.date).getTime()-U)/(1e3*60*60*24);if(z>0){const J=P.weightKg,Y=m.weightKg,G=(Math.log(Y)-Math.log(J))/z*100,B=parseFloat(G.toFixed(2));m.growthRate!==B&&x(Q=>({...Q,growthRate:B}))}else m.growthRate!==null&&x(J=>({...J,growthRate:null}))}else m.growthRate!==null&&x(U=>({...U,growthRate:null}))},[m.period,m.identity,m.weightKg,m.date,m.siteId,h,m.growthRate]),S.useEffect(()=>{C(k())},[m,k]),S.useEffect(()=>{const A=i.find(F=>F.id===m.siteId);N((A==null?void 0:A.zones)||[]),A&&!A.zones.some(F=>F.id===m.zoneId)&&x(F=>{var P;return{...F,zoneId:((P=A.zones[0])==null?void 0:P.id)||""}})},[m.siteId,i]);const M=async()=>{var F,P,U,q,z,J,Y,G;E(!0),I(null);const A=i.find(B=>B.id===m.siteId);if(!A||!A.location||!m.date){I({type:"error",message:r("weatherFetchMissingInfo")}),E(!1);return}try{const[B,Q]=A.location.split(","),K=wn(B.trim()),re=wn(Q.trim()),H=m.date,ae=`https://archive-api.open-meteo.com/v1/archive?latitude=${K.toFixed(4)}&longitude=${re.toFixed(4)}&start_date=${H}&end_date=${H}&daily=temperature_2m_mean,precipitation_sum,wind_speed_10m_max,wind_direction_10m_dominant&timezone=auto`,ue=await fetch(ae);if(!ue.ok)throw new Error("Failed to fetch weather data from API.");const Ne=await ue.json();if(Ne.daily){const le=Ne.daily,ne={...m};((F=le.temperature_2m_mean)==null?void 0:F[0])!==null&&((P=le.temperature_2m_mean)==null?void 0:P[0])!==void 0&&(ne.temperature=le.temperature_2m_mean[0]),((U=le.precipitation_sum)==null?void 0:U[0])!==null&&((q=le.precipitation_sum)==null?void 0:q[0])!==void 0&&(ne.precipitation=le.precipitation_sum[0]),((z=le.wind_speed_10m_max)==null?void 0:z[0])!==null&&((J=le.wind_speed_10m_max)==null?void 0:J[0])!==void 0&&(ne.windSpeed=le.wind_speed_10m_max[0]),((Y=le.wind_direction_10m_dominant)==null?void 0:Y[0])!==null&&((G=le.wind_direction_10m_dominant)==null?void 0:G[0])!==void 0&&(ne.windDirection=le.wind_direction_10m_dominant[0]),ne.waveHeight=null,ne.salinity=null,x(ne),I({type:"success",message:r("weatherFetchSuccess")})}else throw new Error("No daily data in weather API response.")}catch(B){console.error("Error fetching weather data:",B),I({type:"error",message:r("weatherFetchError")})}finally{E(!1)}},j=()=>{const A=k();if(Object.keys(A).length>0){C(A);return}n?f({...n,...m}):d(m),e()},O=Object.keys(T).length>0;return s.jsxs(ot,{isOpen:t,onClose:e,title:r(n?"editTest":"addTest"),widthClass:"max-w-4xl",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(ze,{title:r("sheetInfo"),className:"lg:col-span-1",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:r("identity"),value:m.identity,onChange:A=>x(F=>({...F,identity:A.target.value})),error:T.identity,required:!0}),s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:A=>x(F=>({...F,date:A.target.value})),error:T.date,required:!0}),s.jsx(ke,{label:r("site"),value:m.siteId,onChange:A=>x(F=>({...F,siteId:A.target.value})),error:T.siteId,required:!0,children:i.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:A=>x(F=>({...F,seaweedTypeId:A.target.value})),error:T.seaweedTypeId,required:!0,children:l.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))}),s.jsx(ke,{label:r("zoneName"),value:m.zoneId,onChange:A=>x(F=>({...F,zoneId:A.target.value})),disabled:!m.siteId,error:T.zoneId,required:!0,children:g.map(A=>s.jsx("option",{value:A.id,children:A.name},A.id))}),s.jsx(ke,{label:r("period"),value:m.period,onChange:A=>x(F=>({...F,period:A.target.value})),required:!0,children:bp.map(A=>s.jsx("option",{value:A,children:r(`period_${A}`)},A))}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(de,{label:r("weightKg"),type:"number",value:m.weightKg,onChange:A=>x(F=>({...F,weightKg:parseFloat(A.target.value)||0})),error:T.weightKg,required:!0}),s.jsx(de,{label:`${r("growthRate")} (%)`,type:"number",value:m.growthRate!==null?m.growthRate:"",disabled:!0,placeholder:"Auto"})]}),s.jsx(ke,{label:r("conductor"),value:m.conductorId,onChange:A=>x(F=>({...F,conductorId:A.target.value})),error:T.conductorId,required:!0,children:c.map(A=>s.jsxs("option",{value:A.id,children:[A.firstName," ",A.lastName]},A.id))})]})}),s.jsx(ze,{title:r("weatherData"),className:"lg:col-span-2",children:s.jsxs("div",{className:"space-y-4",children:[D&&s.jsx("p",{className:`text-xs ${D.type==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:D.message}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"weatherDataSource",value:"manual",checked:m.weatherDataSource==="manual",onChange:()=>x(A=>({...A,weatherDataSource:"manual"}))}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:r("manualEntry")})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"weatherDataSource",value:"auto",checked:m.weatherDataSource==="auto",onChange:()=>x(A=>({...A,weatherDataSource:"auto"}))}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:r("autoFill")})]})]}),m.weatherDataSource==="auto"&&s.jsxs(se,{type:"button",variant:"secondary",className:"w-full",onClick:M,disabled:w||!m.siteId||!m.date,children:[s.jsx(te,{name:w?"Activity":"Download",className:`w-5 h-5 ${w?"animate-spin":""}`}),r(w?"fetchingWeather":"fetchWeather")]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:`${r("temperature")} (C)`,type:"number",step:"any",value:m.temperature??"",onChange:A=>x(F=>({...F,temperature:A.target.value===""?null:parseFloat(A.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("salinity")} ()`,type:"number",step:"any",value:m.salinity??"",onChange:A=>x(F=>({...F,salinity:A.target.value===""?null:parseFloat(A.target.value)}))}),s.jsx(de,{label:`${r("precipitation")} (mm)`,type:"number",step:"any",value:m.precipitation??"",onChange:A=>x(F=>({...F,precipitation:A.target.value===""?null:parseFloat(A.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("windSpeed")} (km/h)`,type:"number",step:"any",value:m.windSpeed??"",onChange:A=>x(F=>({...F,windSpeed:A.target.value===""?null:parseFloat(A.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("windDirection")} ()`,type:"number",step:"any",value:m.windDirection??"",onChange:A=>x(F=>({...F,windDirection:A.target.value===""?null:parseFloat(A.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("waveHeight")} (m)`,type:"number",step:"any",value:m.waveHeight??"",onChange:A=>x(F=>({...F,waveHeight:A.target.value===""?null:parseFloat(A.target.value)}))})]})]})})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 mt-4 border-t dark:border-gray-700",children:[s.jsx(se,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(se,{onClick:j,disabled:O,children:r("save")})]})]})},tH=()=>{const{t}=_e(),{periodicTests:e,sites:n,seaweedTypes:r,employees:i,deletePeriodicTest:l}=qe(),[c,d]=S.useState(!1),[f,h]=S.useState(null),[m,x]=S.useState(!1),[g,N]=S.useState(null),[T,C]=S.useState({key:"date",direction:"descending"}),{settings:w}=Ke(),E=S.useMemo(()=>new Map(n.map(z=>[z.id,z.name])),[n]),D=S.useMemo(()=>new Map(r.map(z=>[z.id,z.name])),[r]),I=S.useMemo(()=>new Map(i.map(z=>[z.id,`${z.firstName} ${z.lastName}`])),[i]),k=S.useMemo(()=>{const z=new Map;return n.forEach(J=>J.zones.forEach(Y=>z.set(Y.id,Y.name))),z},[n]),M=S.useMemo(()=>{let z=[...e];return z.sort((J,Y)=>{let G,B;return T.key==="siteName"?G=E.get(J.siteId)||"":T.key==="seaweedTypeName"?G=D.get(J.seaweedTypeId)||"":T.key==="zoneName"?G=k.get(J.zoneId)||"":T.key==="conductorName"?G=I.get(J.conductorId)||"":G=J[T.key],T.key==="siteName"?B=E.get(Y.siteId)||"":T.key==="seaweedTypeName"?B=D.get(Y.seaweedTypeId)||"":T.key==="zoneName"?B=k.get(Y.zoneId)||"":T.key==="conductorName"?B=I.get(Y.conductorId)||"":B=Y[T.key],G===null?1:B===null?-1:G<B?T.direction==="ascending"?-1:1:G>B?T.direction==="ascending"?1:-1:0}),z},[e,T,E,D,k,I]),j=z=>{let J="ascending";T.key===z&&T.direction==="ascending"&&(J="descending"),C({key:z,direction:J})},O=z=>T.key!==z?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):T.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),A=({sortKey:z,label:J,className:Y})=>s.jsx("th",{className:`p-3 ${Y}`,children:s.jsxs("button",{onClick:()=>j(z),className:`group flex items-center gap-2 w-full ${Y!=null&&Y.includes("text-right")?"justify-end":""}`,children:[J,O(z)]})}),F=(z=null)=>{h(z),d(!0)},P=z=>{N(z),x(!0)},U=()=>{g&&l(g),x(!1),N(null)},q=async()=>{const z=M.map(Y=>({identity:Y.identity,date:Y.date,site:E.get(Y.siteId)||t("unknown"),seaweedType:D.get(Y.seaweedTypeId)||t("unknown"),zone:k.get(Y.zoneId)||t("unknown"),period:t(`period_${Y.period}`),weightKg:Y.weightKg,growthRate:Y.growthRate,temperature:Y.temperature,salinity:Y.salinity,precipitation:Y.precipitation,windSpeed:Y.windSpeed,windDirection:Y.windDirection,waveHeight:Y.waveHeight,conductor:I.get(Y.conductorId)||t("unknown"),source:Y.weatherDataSource==="auto"?t("autoFill"):t("manualEntry")})),J=[{header:t("identity"),key:"identity",width:15},{header:t("date"),key:"date",width:15},{header:t("site"),key:"site",width:20},{header:t("seaweedType"),key:"seaweedType",width:20},{header:t("zoning"),key:"zone",width:15},{header:t("period"),key:"period",width:15},{header:`${t("weightKg")} (Kg)`,key:"weightKg",width:15},{header:`${t("growthRate")} (%)`,key:"growthRate",width:15},{header:`${t("temperature")} (C)`,key:"temperature",width:15},{header:`${t("salinity")} ()`,key:"salinity",width:15},{header:`${t("precipitation")} (mm)`,key:"precipitation",width:15},{header:`${t("windSpeed")} (km/h)`,key:"windSpeed",width:15},{header:`${t("windDirection")} ()`,key:"windDirection",width:15},{header:`${t("waveHeight")} (m)`,key:"waveHeight",width:15},{header:t("conductor"),key:"conductor",width:20},{header:"Source",key:"source",width:15}];await Ko(z,J,`PeriodicTests_${new Date().toISOString().split("T")[0]}`,"Periodic Tests")};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("periodicTestsTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(se,{onClick:q,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]}),s.jsxs(se,{onClick:()=>F(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addTest")]})]})]}),s.jsx(ze,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"text-xs uppercase bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx(A,{sortKey:"identity",label:t("identity")}),s.jsx(A,{sortKey:"date",label:t("date")}),s.jsx(A,{sortKey:"siteName",label:t("site")}),s.jsx(A,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(A,{sortKey:"zoneName",label:t("zoning")}),s.jsx(A,{sortKey:"period",label:t("period")}),s.jsx(A,{sortKey:"weightKg",label:`${t("weightKg")} (Kg)`,className:"text-right"}),s.jsx(A,{sortKey:"growthRate",label:`${t("growthRate")} (%)`,className:"text-right"}),s.jsx(A,{sortKey:"temperature",label:`${t("temperature")} (C)`,className:"text-right"}),s.jsx(A,{sortKey:"salinity",label:`${t("salinity")} ()`,className:"text-right"}),s.jsx(A,{sortKey:"precipitation",label:`${t("precipitation")} (mm)`,className:"text-right"}),s.jsx(A,{sortKey:"windSpeed",label:`${t("windSpeed")} (km/h)`,className:"text-right"}),s.jsx(A,{sortKey:"windDirection",label:`${t("windDirection")} ()`,className:"text-right"}),s.jsx(A,{sortKey:"waveHeight",label:`${t("waveHeight")} (m)`,className:"text-right"}),s.jsx(A,{sortKey:"conductorName",label:t("conductor")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:M.map(z=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 align-middle",children:[s.jsx("td",{className:"p-3 font-mono",children:z.identity}),s.jsx("td",{className:"p-3",children:z.date}),s.jsx("td",{className:"p-3",children:E.get(z.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:D.get(z.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3",children:k.get(z.zoneId)||t("unknown")}),s.jsx("td",{className:"p-3",children:t(`period_${z.period}`)}),s.jsx("td",{className:"p-3 text-right",children:Ue(z.weightKg,w.localization)}),s.jsx("td",{className:"p-3 text-right font-semibold",children:z.growthRate!==null?`${Ue(z.growthRate,w.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right",children:z.temperature!==null?Ue(z.temperature,w.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:z.salinity!==null?Ue(z.salinity,w.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:z.precipitation!==null?Ue(z.precipitation,w.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:z.windSpeed!==null?Ue(z.windSpeed,w.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:z.windDirection!==null?Ue(z.windDirection,w.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:z.waveHeight!==null?Ue(z.waveHeight,w.localization):"-"}),s.jsx("td",{className:"p-3",children:I.get(z.conductorId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(se,{variant:"ghost",className:"p-2",onClick:()=>F(z),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(se,{variant:"danger",className:"p-2",onClick:()=>P(z.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},z.id))})]})})}),c&&s.jsx(eH,{isOpen:c,onClose:()=>d(!1),test:f}),m&&s.jsx(Qt,{isOpen:m,onClose:()=>x(!1),onConfirm:U,title:t("confirmDeleteTitle"),message:t("confirmDeleteTest")})]})},Ms=({icon:t,label:e,value:n,fullWidth:r})=>s.jsxs("div",{className:`flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50 ${r?"col-span-2":""}`,children:[s.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[s.jsx(te,{name:t,className:"w-4 h-4 mr-2"}),s.jsx("span",{children:e})]}),s.jsx("div",{className:"mt-1 text-md font-semibold text-gray-900 dark:text-gray-100 truncate",children:n||"N/A"})]}),nH=({data:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Ke(),[i,l]=S.useState(!1),c=!!t,{module:d,site:f,zone:h,farmer:m,cycle:x,seaweedType:g}=t||{},N=r.localization.coordinateFormat;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`fixed inset-0 bg-black/30 z-40 transition-opacity duration-300 ${c?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e,"aria-hidden":"true"}),s.jsxs("div",{className:`fixed top-0 right-0 h-full w-full max-w-md bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-l border-gray-200 dark:border-gray-700/50 shadow-2xl flex flex-col z-50 transform transition-transform duration-300 ease-in-out ${c?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"module-detail-panel-title",children:[s.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-inherit z-10",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n("moduleDetails")}),s.jsx("h2",{id:"module-detail-panel-title",className:"text-xl font-bold font-mono",children:d==null?void 0:d.code})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"ghost",onClick:()=>l(!0),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4 mr-1"}),n("history")]}),s.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":n("close"),children:s.jsx(te,{name:"X",className:"w-6 h-6"})})]})]}),c&&s.jsxs("main",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("generalInformation")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Ms,{icon:"MapPin",label:n("site"),value:f==null?void 0:f.name}),s.jsx(Ms,{icon:"Grid",label:n("zoneName"),value:h==null?void 0:h.name}),s.jsx(Ms,{icon:"User",label:n("farmer"),value:m?`${m.firstName} ${m.lastName}`:n("status_FREE")}),s.jsxs("div",{className:"flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50",children:[s.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[s.jsx(te,{name:"Activity",className:"w-4 h-4 mr-2"}),s.jsx("span",{children:n("status")})]}),s.jsx("div",{className:"mt-1",children:s.jsx(An,{status:m?"ASSIGNED":"FREE"})})]}),s.jsx(Ms,{icon:"MapPin",label:n("latitude"),value:KN(d.latitude||"",N,!0)}),s.jsx(Ms,{icon:"MapPin",label:n("longitude"),value:KN(d.longitude||"",N,!1)})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("configuration")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Ms,{icon:"Layers",label:n("lines"),value:d.lines}),s.jsx(Ms,{icon:"Package",label:n("galvanizedPoles"),value:d.poles.galvanized}),s.jsx(Ms,{icon:"Package",label:n("woodPoles"),value:d.poles.wood}),s.jsx(Ms,{icon:"Package",label:n("plasticPoles"),value:d.poles.plastic})]})]}),x&&s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("cultivationCycle")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Ms,{icon:"Beaker",label:n("seaweedType"),value:g==null?void 0:g.name}),s.jsx(Ms,{icon:"Calendar",label:n("plantingDate"),value:x.plantingDate}),s.jsx(Ms,{icon:"Archive",label:n("initialWeight"),value:`${x.initialWeight} kg`})]})]})]})]}),c&&d&&s.jsx(SC,{isOpen:i,onClose:()=>l(!1),history:d.statusHistory,moduleCode:d.code})]})},sH=()=>{const{t}=_e(),{settings:e}=Ke(),n=e.localization.coordinateFormat,r=S.useRef(null),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useRef(null),h=S.useRef(null),m=S.useRef(new Map),{sites:x,modules:g,cultivationCycles:N,farmers:T,employees:C,seaweedTypes:w}=qe(),[E,D]=S.useState(null),[I,k]=S.useState(!1),M=(A,F)=>{if(!A)return{color:"#808080",label:"Unknown"};const P=A.statusHistory||[],U=P.length>0?P[P.length-1].status:Xe.FREE;if(U===Xe.FREE)return{color:"#6b7280",label:t("status_FREE")};if(F&&(F.status===Xe.PLANTED||F.status===Xe.GROWING)){const q=new Date(F.plantingDate),J=Math.floor((new Date().getTime()-q.getTime())/(1e3*3600*24));return J>zr?{color:"#ef4444",label:t("overdueHarvest")}:J>zr-Eg?{color:"#f59e0b",label:t("nearingHarvest")}:{color:"#22c55e",label:t("status_GROWING")}}return U===Xe.HARVESTED||U===Xe.DRYING||U===Xe.BAGGING?{color:"#3b82f6",label:t(`status_${U}`)}:U===Xe.MAINTENANCE?{color:"#f97316",label:t("status_MAINTENANCE")}:A.farmerId?{color:"#a855f7",label:t("status_ASSIGNED")}:{color:"#6b7280",label:t("status_FREE")}},j=[{color:"#22c55e",label:t("status_GROWING")},{color:"#f59e0b",label:t("nearingHarvest")},{color:"#ef4444",label:t("overdueHarvest")},{color:"#3b82f6",label:`${t("status_HARVESTED")} / ${t("status_DRYING")}`},{color:"#a855f7",label:t("status_ASSIGNED")},{color:"#6b7280",label:t("status_FREE")},{color:"#f97316",label:t("status_MAINTENANCE")}];S.useEffect(()=>{if(r.current&&!i.current){const A=L.map(r.current,{center:[-18.7669,46.8691],zoom:6,zoomControl:!1});L.control.zoom({position:"topleft"}).addTo(A);const F=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A),P=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),U=L.featureGroup().addTo(A),q=L.featureGroup().addTo(A),z=L.featureGroup().addTo(A),J=L.featureGroup().addTo(A),Y=L.layerGroup().addTo(A);l.current=U,c.current=q,d.current=z,f.current=J,h.current=Y,i.current=A;const G={[t("streetView")]:F,[t("satelliteView")]:P},B={[`<i class="icon-sites"></i> ${t("sites")}`]:U,[`<i class="icon-zones"></i> ${t("zones")}`]:q,[`<i class="icon-modules"></i> ${t("modules")}`]:z};L.control.layers(G,B,{collapsed:!0,position:"topright"}).addTo(A)}},[t]),S.useEffect(()=>{const A=i.current;if(!A)return;l.current.clearLayers(),c.current.clearLayers(),d.current.clearLayers(),m.current.clear();const F=[];x.forEach(P=>{if(P.location)try{const q=P.location.split(",");if(q.length===2){const z=q[0].trim(),J=q[1].trim(),Y=wn(z),G=wn(J),B=[Y,G];F.push(B);const Q=g.filter(fe=>fe.siteId===P.id),K=Q.length,re=T.filter(fe=>fe.siteId===P.id).length,ae=C.filter(fe=>fe.siteId===P.id).length,ue=new Set(Q.map(fe=>fe.id)),Ne=N.filter(fe=>ue.has(fe.moduleId)&&(fe.status==="PLANTED"||fe.status==="GROWING")).reduce((fe,Z)=>fe+(Z.linesPlanted||0),0),le=C.find(fe=>fe.id===P.managerId),ne=le?`${le.firstName} ${le.lastName}`:t("noManager"),Te=L.marker(B);Te.bindPopup(`
                            <div class="font-sans text-xs min-w-[240px]">
                                <div class="bg-blue-600 text-white px-3 py-2 rounded-t flex justify-between items-center">
                                    <h3 class="font-bold text-sm truncate max-w-[160px]">${P.name}</h3>
                                    <span class="text-[10px] bg-blue-700 px-1.5 py-0.5 rounded opacity-90">${P.code}</span>
                                </div>
                                <div class="p-3 bg-white border border-gray-200 rounded-b shadow-sm">
                                    <div class="mb-3 flex justify-between items-center border-b border-gray-100 pb-2">
                                        <span class="text-gray-500 flex items-center gap-1"><i class="w-3 h-3 bg-gray-400 rounded-full block"></i> ${t("manager")}:</span>
                                        <span class="font-medium text-right truncate max-w-[120px] text-gray-800">${ne}</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-blue-600 text-lg leading-none">${K}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("modules")}</span>
                                        </div>
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-green-600 text-lg leading-none">${re}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("farmers")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-purple-600 text-lg leading-none">${ae}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("employees")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-orange-600 text-lg leading-none">${Ne}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("activeLines")}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,{closeButton:!1,minWidth:240}),l.current.addLayer(Te)}}catch(q){console.error(`Could not parse location for site ${P.name}: ${P.location}`,q)}(P.zones||[]).forEach(q=>{const z=Qp(q.geoPoints);if(z.length>=3){const J=z.reduce((B,Q)=>({x:B.x+Q.x,y:B.y+Q.y}),{x:0,y:0});J.x/=z.length,J.y/=z.length,z.sort((B,Q)=>{const K=Math.atan2(B.y-J.y,B.x-J.x),re=Math.atan2(Q.y-J.y,Q.x-J.x);return K-re});const Y=z.map(B=>[B.y,B.x]);F.push(...Y);const G=L.polygon(Y,{color:"blue",weight:2,fillOpacity:.1});G.bindTooltip(q.name,{permanent:!0,direction:"center",className:"bg-transparent border-none shadow-none font-bold text-blue-800"}),c.current.addLayer(G)}})}),g.forEach(P=>{let U=null;if(P.latitude&&P.longitude)try{const B=wn(P.latitude),Q=wn(P.longitude);U=L.latLng(B,Q)}catch{}if(!U){const B=x.flatMap(Q=>Q.zones).find(Q=>Q.id===P.zoneId);if(B&&B.geoPoints&&B.geoPoints.length>0){const Q=Qp(B.geoPoints);if(Q.length>0){const K=Q.map(ae=>[ae.y,ae.x]),H=L.polygon(K).getBounds();H&&H.isValid()&&(U=H.getCenter())}}}if(!U)return;m.current.set(P.id,U);const q=N.find(B=>B.moduleId===P.id&&(B.status===Xe.PLANTED||B.status===Xe.GROWING||B.status===Xe.CUTTING)),z=T.find(B=>B.id===P.farmerId),J=M(P,q),Y=L.divIcon({html:`<div style="background-color: ${J.color}; width: 10px; height: 10px; border: 1px solid #fff; opacity: 1; box-shadow: 1px 1px 2px rgba(0,0,0,0.5);"></div>`,iconSize:[10,10],iconAnchor:[5,5],className:""}),G=L.marker(U,{icon:Y});G.bindTooltip(`${P.code}`,{direction:"top",offset:[0,-5],className:"text-xs"}),G.on("click",()=>{const B=x.find(ae=>ae.id===P.siteId),Q=B==null?void 0:B.zones.find(ae=>ae.id===P.zoneId),K=q?w.find(ae=>ae.id===q.seaweedTypeId):void 0,re=q||N.filter(ae=>ae.moduleId===P.id).sort((ae,ue)=>new Date(ue.plantingDate).getTime()-new Date(ae.plantingDate).getTime())[0];D({module:P,cycle:re,site:B,zone:Q,seaweedType:K,farmer:z})}),d.current.addLayer(G)}),F.length>0&&A.fitBounds(F,{padding:[50,50]})},[x,g,N,T,C,w,t,n]),S.useEffect(()=>{const A=f.current;if(A&&(A.clearLayers(),E&&E.module)){const F=m.current.get(E.module.id);F&&L.circleMarker(F,{radius:16,color:"#facc15",fill:!1,weight:4,opacity:.8}).addTo(A)}},[E,g]);const O=()=>{k(!0),setTimeout(()=>{if(!i.current||!h.current){k(!1);return}const A=h.current;A.clearLayers();const F=i.current.getCenter();if(F){const P=F.lat,U=F.lng,q=L.circle([P+.005,U+.005],{color:"green",fillColor:"#22c55e",fillOpacity:.4,radius:1500,weight:1}).bindPopup(`<b>${t("biomassLegendHigh")}</b><br>NDVI: 0.75<br>${t("satelliteSource")}`),z=L.circle([P-.005,U-.005],{color:"red",fillColor:"#ef4444",fillOpacity:.4,radius:1e3,weight:1}).bindPopup(`<b>${t("algalBloomRisk")}</b><br>Chlorophyll-a: High<br>${t("satelliteSource")}`);A.addLayer(q),A.addLayer(z),i.current.setView([P,U],Math.max(i.current.getZoom(),13))}k(!1)},2e3)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("farmMapTitle")}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(se,{onClick:O,disabled:I,variant:"secondary",children:[s.jsx(te,{name:I?"Activity":"Eye",className:`w-5 h-5 mr-2 ${I?"animate-spin":""}`}),t(I?"analyzingSatellite":"loadSatelliteData")]})})]}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{ref:r,style:{height:"70vh"},className:"rounded-lg shadow-lg bg-blue-50 z-0"}),s.jsx("div",{className:"absolute bottom-8 left-4 z-[500] no-print hidden sm:block",children:s.jsx(ze,{title:t("legend"),className:"p-3 !bg-white/90 backdrop-blur-sm border border-gray-200 shadow-lg",children:s.jsxs("div",{className:"space-y-2",children:[j.map(A=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm",style:{backgroundColor:A.color}}),s.jsx("span",{className:"text-[10px] font-medium",children:A.label})]},A.label)),s.jsx("hr",{className:"my-2 border-gray-300"}),s.jsx("h4",{className:"text-[10px] font-bold mb-1",children:t("satelliteAnalysisTitle")}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-green-500/50 border-green-600"}),s.jsx("span",{className:"text-[10px] font-medium",children:t("biomassLegendHigh")})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-red-500/50 border-red-600"}),s.jsx("span",{className:"text-[10px] font-medium",children:t("algalBloomRisk")})]})]})})})]}),s.jsx(nH,{data:E,onClose:()=>D(null)})]})},lh=({permission:t,children:e,fallback:n=null})=>{const{can:r}=Zs();return r(t)?s.jsx(s.Fragment,{children:e}):s.jsx(s.Fragment,{children:n})},rH=({isOpen:t,onClose:e,role:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(new Set);S.useEffect(()=>{t&&c(new Set(n.permissions))},[t,n]);const d=(h,m)=>{c(x=>{const g=new Set(x);return m?g.add(h):g.delete(h),g})},f=()=>{r({...n,permissions:Array.from(l)})};return s.jsx(ot,{isOpen:t,onClose:e,title:`${i("managePermissionsFor")} "${n.name}"`,widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:f,children:i("save")})]}),children:s.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:iw.map(h=>s.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700",children:[s.jsx("h3",{className:"font-semibold mb-3",children:h.name}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:h.permissions.map(m=>s.jsxs("label",{className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50 cursor-pointer",children:[s.jsx(Rt,{checked:l.has(m.id),onChange:x=>d(m.id,x.target.checked)}),s.jsx("span",{className:"ml-2 text-sm",children:m.label})]},m.id))})]},h.name))})})},iH=()=>{const{t}=_e(),{roles:e,addRole:n,updateRole:r,deleteRole:i}=qe(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,T]=S.useState(null),[C,w]=S.useState(!1),E=O=>{O.isDefault||(f(O),c(!0))},D=()=>{d&&i(d.id),c(!1),f(null)},I=()=>{h.trim()&&(n({name:h.trim(),permissions:[]}),m(""))},k=O=>{T(O),g(!0)},M=O=>{T(O),w(!0)},j=O=>{r(O),g(!1),w(!1),T(null)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("roleManagementTitle")}),s.jsxs(ze,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(O=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:O.name}),O.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsx(lh,{permission:Ce.ROLES_MANAGE,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:()=>M(O),children:[s.jsx(te,{name:"UserCog",className:"w-4 h-4"}),t("managePermissions")]}),s.jsxs(se,{variant:"ghost",onClick:()=>k(O),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),O.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(se,{variant:"danger",className:"p-2",onClick:()=>E(O),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},O.id))}),s.jsx(lh,{permission:Ce.ROLES_MANAGE,children:s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addRole")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("roleName"),value:h,onChange:O=>m(O.target.value)}),s.jsxs(se,{onClick:I,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})})]}),x&&N&&s.jsx(aH,{isOpen:x,onClose:()=>g(!1),role:N,onSave:j}),C&&N&&s.jsx(rH,{isOpen:C,onClose:()=>w(!1),role:N,onSave:j}),l&&d&&s.jsx(Qt,{isOpen:l,onClose:()=>c(!1),onConfirm:D,title:t("confirmDeleteTitle"),message:t("confirmDeleteRole")})]})},aH=({isOpen:t,onClose:e,role:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ot,{isOpen:t,onClose:e,title:i("editRole"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("roleName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},oH=({employeeId:t,appliedDeductions:e,onToggle:n})=>{const{settings:r}=Ke(),[i,l]=S.useState(!1),c=S.useRef(null),d=S.useMemo(()=>{var f;return((f=an.find(h=>h.code===r.localization.country))==null?void 0:f.payroll)||an.find(h=>h.code==="MG").payroll},[r.localization.country]);return S.useEffect(()=>{const f=h=>{c.current&&!c.current.contains(h.target)&&l(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),s.jsxs("div",{ref:c,className:"relative inline-flex",children:[s.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>l(!i),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),i&&s.jsx("div",{className:"absolute right-0 bottom-full mb-2 z-10 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 p-2 space-y-2",children:d.constants.socialContributions.map(f=>{var h;return s.jsxs("label",{className:"flex items-center text-sm cursor-pointer",children:[s.jsx(Rt,{checked:e.includes(f.key),onChange:m=>n(t,f.key,m.target.checked)}),s.jsx("span",{className:"ml-2",children:((h=d.labels.socialContributions.find(m=>m.key===f.key))==null?void 0:h.label)||f.key})]},f.key)})})]})},lH=({isOpen:t,onClose:e,onApply:n,sites:r,roles:i,payrollConfig:l})=>{const{t:c}=_e(),[d,f]=S.useState({applyTo:"all",filterValue:"",action:"set",values:{bonuses:"",overtime:"",other:""},configureSocialDeductions:!1,deductionsToApply:{},showAffectedEmployees:!0});S.useEffect(()=>{if(t){const m=l.constants.socialContributions.reduce((x,g)=>(x[g.key]=!0,x),{});f(x=>({...x,filterValue:"",deductionsToApply:m}))}},[t,l]);const h=()=>{n(d)};return s.jsx(ot,{isOpen:t,onClose:e,title:c("bulkConfigure"),footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:c("cancel")}),s.jsx(se,{onClick:h,children:c("applyChanges")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(ke,{label:c("applyTo"),value:d.applyTo,onChange:m=>f(x=>({...x,applyTo:m.target.value})),children:[s.jsx("option",{value:"all",children:c("allSelectedEmployees")}),s.jsx("option",{value:"site",children:c("bySite")}),s.jsx("option",{value:"role",children:c("byRole")})]}),d.applyTo==="site"&&s.jsxs(ke,{label:c("site"),value:d.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[s.jsx("option",{value:"",children:c("selectSite")}),r.map(m=>s.jsx("option",{value:m.id,children:m.name},m.id))]}),d.applyTo==="role"&&s.jsxs(ke,{label:c("role"),value:d.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[s.jsx("option",{value:"",children:c("selectRole")}),i.map(m=>s.jsx("option",{value:m,children:m},m))]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs(ke,{label:"Action",value:d.action,onChange:m=>f(x=>({...x,action:m.target.value})),children:[s.jsx("option",{value:"set",children:c("setValue")}),s.jsx("option",{value:"add",children:c("addToExisting")})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[s.jsx(de,{label:c("bonuses"),type:"number",placeholder:c("optional"),value:d.values.bonuses,onChange:m=>f(x=>({...x,values:{...x.values,bonuses:m.target.value}}))}),s.jsx(de,{label:c("overtime"),type:"number",placeholder:c("optional"),value:d.values.overtime,onChange:m=>f(x=>({...x,values:{...x.values,overtime:m.target.value}}))}),s.jsx(de,{label:c("otherDeductions"),type:"number",placeholder:c("optional"),value:d.values.other,onChange:m=>f(x=>({...x,values:{...x.values,other:m.target.value}}))})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("label",{className:"flex items-center space-x-2 font-semibold",children:[s.jsx(Rt,{checked:d.configureSocialDeductions,onChange:m=>f(x=>({...x,configureSocialDeductions:m.target.checked}))}),s.jsx("span",{children:c("configureSocialDeductions")})]}),d.configureSocialDeductions&&s.jsx("div",{className:"pl-6 mt-2 space-y-2",children:l.constants.socialContributions.map(m=>{var x;return s.jsxs("label",{className:"flex items-center text-sm",children:[s.jsx(Rt,{checked:d.deductionsToApply[m.key]??!1,onChange:g=>f(N=>({...N,deductionsToApply:{...N.deductionsToApply,[m.key]:g.target.checked}}))}),s.jsx("span",{className:"ml-2",children:((x=l.labels.socialContributions.find(g=>g.key===m.key))==null?void 0:x.label)||m.key})]},m.key)})})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx(Rt,{checked:d.showAffectedEmployees,onChange:m=>f(x=>({...x,showAffectedEmployees:m.target.checked}))}),s.jsx("span",{children:c("showAffectedEmployeesAfterUpdate")})]})})]})})},cH=({isOpen:t,onClose:e,employeeNames:n})=>{const{t:r}=_e();return s.jsxs(ot,{isOpen:t,onClose:e,title:r("bulkUpdateSummary"),footer:s.jsx(se,{onClick:e,children:r("close")}),children:[s.jsx("p",{className:"mb-4",children:r("affectedEmployees").replace("{count}",String(n.length))}),s.jsx("div",{className:"max-h-60 overflow-y-auto bg-gray-100 dark:bg-gray-800/50 p-3 rounded-md",children:s.jsx("ul",{className:"list-disc list-inside",children:n.map(i=>s.jsx("li",{children:i},i))})})]})},dH=()=>{const{t}=_e(),{employees:e,sites:n,addMultipleMonthlyPayments:r}=qe(),{settings:i}=Ke(),[l,c]=S.useState(new Date().getMonth()),[d,f]=S.useState(new Date().getFullYear()),[h,m]=S.useState("all"),[x,g]=S.useState(new Set),[N,T]=S.useState([]),[C,w]=S.useState(new Set),E=S.useRef(null),[D,I]=S.useState(!1),[k,M]=S.useState(!1),[j,O]=S.useState(null),A=S.useMemo(()=>Array.from({length:10},(ne,Te)=>new Date().getFullYear()-5+Te),[]),F=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),P=S.useMemo(()=>Array.from({length:12},(ne,Te)=>Te),[]),U=`${t(F[l])} ${d}`,q=S.useMemo(()=>{var ne;return((ne=an.find(Te=>Te.code===i.localization.country))==null?void 0:ne.payroll)||an.find(Te=>Te.code==="MG").payroll},[i.localization.country]),z=S.useMemo(()=>{const ne=new Date(d,l+1,0);let Te=e.filter(fe=>{if(!fe.hireDate)return!1;const Z=new Date(fe.hireDate);return!isNaN(Z.getTime())&&Z<=ne});return h==="all"?Te:Te.filter(fe=>fe.siteId===h)},[e,h,d,l]),J=ne=>{g(Te=>{const fe=new Set(Te);return fe.has(ne)?fe.delete(ne):fe.add(ne),fe})},Y=ne=>{ne.target.checked?g(new Set(z.map(Te=>Te.id))):g(new Set)};S.useEffect(()=>{if(E.current){const ne=x.size,Te=z.length;E.current.checked=ne===Te&&Te>0,E.current.indeterminate=ne>0&&ne<Te}},[x,z]);const G=ne=>{const Te=parseFloat(ne.inputs.bonuses)||0,fe=parseFloat(ne.inputs.overtime)||0,Z=parseFloat(ne.inputs.other)||0;return{...hc(ne.employee.grossWage,Te,fe,Z,i.localization,{appliedDeductions:ne.appliedDeductions}),employee:ne.employee,inputs:ne.inputs,appliedDeductions:ne.appliedDeductions}},B=()=>{const ne=e.filter(Z=>x.has(Z.id)),Te=q?q.constants.socialContributions.map(Z=>Z.key):[],fe=ne.map(Z=>{const ee={bonuses:"0",overtime:"0",other:"0"};return{...hc(Z.grossWage,0,0,0,i.localization,{appliedDeductions:Te}),employee:Z,inputs:ee,appliedDeductions:Te}});T(fe),w(new Set)},Q=(ne,Te,fe)=>{T(Z=>Z.map(ee=>{if(ee.employee.id===ne){const xe={...ee,inputs:{...ee.inputs,[Te]:fe}};return G(xe)}return ee}))},K=(ne,Te,fe)=>{T(Z=>Z.map(ee=>{if(ee.employee.id===ne){const xe=new Set(ee.appliedDeductions);fe?xe.add(Te):xe.delete(Te);const Oe={...ee,appliedDeductions:Array.from(xe)};return G(Oe)}return ee}))},re=ne=>{const Te=[];T(fe=>fe.map(Z=>{const ee=Z.employee;let xe=!1;switch(ne.applyTo){case"all":xe=!0;break;case"site":xe=ee.siteId===ne.filterValue;break;case"role":xe=ee.role===ne.filterValue;break}if(xe){Te.push(`${ee.firstName} ${ee.lastName}`);let Oe={...Z.inputs},De=[...Z.appliedDeductions];["bonuses","overtime","other"].forEach(Le=>{const be=Le;if(ne.values[be]){const ye=parseFloat(ne.values[be])||0,Fe=parseFloat(Oe[be])||0,et=ne.action==="add"?Fe+ye:ye;Oe[be]=String(et)}}),ne.configureSocialDeductions&&(De=Object.entries(ne.deductionsToApply).filter(([,Le])=>Le).map(([Le])=>Le));const Re=parseFloat(Oe.bonuses)||0,$e=parseFloat(Oe.overtime)||0,He=parseFloat(Oe.other)||0;return{...hc(ee.grossWage,Re,$e,He,i.localization,{appliedDeductions:De}),employee:ee,inputs:Oe,appliedDeductions:De}}return Z})),I(!1),ne.showAffectedEmployees?O(Te):O(null)},H=()=>{const ne=`${d}-${String(l+1).padStart(2,"0")}`,Te=new Date().toISOString().split("T")[0],fe=`payroll-${Date.now()}`,Z=N.map(ee=>({date:Te,period:ne,recipientType:rn.EMPLOYEE,recipientId:ee.employee.id,amount:ee.netPay,method:"cash",notes:JSON.stringify({type:"payroll_run",details:{gross:ee.totalGross,base:ee.baseSalary,bonuses:ee.inputs.bonuses,overtime:ee.inputs.overtime,deductions:ee.totalDeductions,otherDeductions:ee.inputs.other}}),paymentRunId:fe,paymentStatus:"PENDING"}));r(Z),M(!1),alert(t("payrollSavedSuccess"))},ae=ne=>{w(Te=>{const fe=new Set(Te);return fe.has(ne)?fe.delete(ne):fe.add(ne),fe})},ue=S.useMemo(()=>N.reduce((ne,Te)=>({totalGross:ne.totalGross+Te.totalGross,totalDeductions:ne.totalDeductions+Te.totalDeductions,totalNet:ne.totalNet+Te.netPay}),{totalGross:0,totalDeductions:0,totalNet:0}),[N]),{uniqueSites:Ne,uniqueRoles:le}=S.useMemo(()=>{const ne=new Set,Te=new Set;N.forEach(ee=>{ee.employee.siteId&&ne.add(ee.employee.siteId),ee.employee.role&&Te.add(ee.employee.role)});const fe=n.filter(ee=>ne.has(ee.id)),Z=Array.from(Te).sort();return{uniqueSites:fe,uniqueRoles:Z}},[N,n]);return s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("payrollCalculator")}),s.jsx(ze,{className:"mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("period")}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(ke,{value:l,onChange:ne=>c(parseInt(ne.target.value)),children:P.map(ne=>s.jsx("option",{value:ne,children:t(F[ne])},ne))}),s.jsx(ke,{value:d,onChange:ne=>f(parseInt(ne.target.value)),children:A.map(ne=>s.jsx("option",{value:ne,children:ne},ne))})]})]}),s.jsxs(ke,{label:t("filterBySite"),value:h,onChange:ne=>m(ne.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),n.map(ne=>s.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]})}),s.jsxs(ze,{title:t("employeeSelection"),children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:t("selectEmployeesAndCalculate")}),s.jsx("div",{className:"max-h-96 overflow-y-auto border dark:border-gray-700 rounded-lg",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm",children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Rt,{ref:E,onChange:Y,"aria-label":t("selectAllEmployees")})}),s.jsx("th",{className:"p-3",children:t("name")}),s.jsx("th",{className:"p-3",children:t("site")}),s.jsx("th",{className:"p-3",children:t("role")}),s.jsx("th",{className:"p-3 text-right",children:t("grossWage")})]})}),s.jsx("tbody",{children:z.length>0?z.map(ne=>{var Te;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rt,{checked:x.has(ne.id),onChange:()=>J(ne.id)})}),s.jsxs("td",{className:"p-3 font-semibold",children:[ne.firstName," ",ne.lastName]}),s.jsx("td",{className:"p-3",children:((Te=n.find(fe=>fe.id===ne.siteId))==null?void 0:Te.name)||"N/A"}),s.jsx("td",{className:"p-3",children:ne.role}),s.jsx("td",{className:"p-3 text-right",children:Ae(ne.grossWage,i.localization)})]},ne.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:t("noEmployeesMatchFilters")})})})]})}),s.jsx("div",{className:"mt-4",children:s.jsxs(se,{onClick:B,disabled:x.size===0,children:[s.jsx(te,{name:"Calculator",className:"w-5 h-5"}),t("processPayrollFor").replace("{count}",String(x.size))]})})]}),N.length>0&&s.jsxs(ze,{className:"mt-6",title:t("payrollResults"),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("payrollSummaryForPeriod").replace("{period}",U)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:()=>I(!0),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("bulkConfigure")]}),s.jsxs(se,{onClick:()=>M(!0),children:[s.jsx(te,{name:"Save",className:"w-4 h-4"}),t("save")]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:t("totalGrossPay")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalGross,i.localization)})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:t("totalAllDeductions")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalDeductions,i.localization)})]}),s.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:t("totalNetPay")}),s.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(ue.totalNet,i.localization)})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-12"}),s.jsx("th",{className:"p-3 min-w-[150px]",children:t("employee")}),s.jsx("th",{className:"p-3 w-28 text-center",children:t("socialDeductions")}),s.jsx("th",{className:"p-3 text-right",children:t("grossSalary")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("bonuses")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("overtime")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("otherDeductions")}),s.jsx("th",{className:"p-3 text-right font-semibold",children:t("totalGross")}),s.jsx("th",{className:"p-3 text-right font-semibold",children:t("payrollTotalDeductions")}),s.jsx("th",{className:"p-3 text-right font-bold text-lg",children:t("netPay")})]})}),s.jsx("tbody",{children:N.map(ne=>{const Te=C.has(ne.employee.id);return s.jsxs(gt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx(se,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ae(ne.employee.id),children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${Te?"rotate-90":""}`})})}),s.jsxs("td",{className:"p-3 font-semibold",children:[ne.employee.firstName," ",ne.employee.lastName]}),s.jsx("td",{className:"p-3 text-center",children:s.jsx(oH,{employeeId:ne.employee.id,appliedDeductions:ne.appliedDeductions,onToggle:K})}),s.jsx("td",{className:"p-3 text-right",children:Ae(ne.baseSalary,i.localization)}),s.jsx("td",{children:s.jsx(de,{type:"number",value:ne.inputs.bonuses,onChange:fe=>Q(ne.employee.id,"bonuses",fe.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{children:s.jsx(de,{type:"number",value:ne.inputs.overtime,onChange:fe=>Q(ne.employee.id,"overtime",fe.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{children:s.jsx(de,{type:"number",value:ne.inputs.other,onChange:fe=>Q(ne.employee.id,"other",fe.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(ne.totalGross,i.localization)}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(ne.totalDeductions,i.localization)}),s.jsx("td",{className:"p-3 text-right font-bold text-lg",children:Ae(ne.netPay,i.localization)})]}),Te&&s.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/50",children:s.jsxs("td",{colSpan:10,className:"p-4",children:[s.jsx("h4",{className:"font-semibold text-md mb-2",children:t("deductionDetails")}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pl-6",children:[ne.deductions.map(fe=>s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[fe.label,":"]}),s.jsx("span",{children:Ae(fe.amount,i.localization)})]},fe.label)),ne.deductions.length===0&&s.jsx("span",{className:"text-gray-500 text-xs",children:t("noStatutoryDeductions")})]})]})})]},ne.employee.id)})})]})})]}),s.jsx(lH,{isOpen:D,onClose:()=>I(!1),onApply:re,sites:Ne,roles:le,payrollConfig:q}),j&&s.jsx(cH,{isOpen:!!j,onClose:()=>O(null),employeeNames:j}),k&&s.jsx(Qt,{isOpen:k,onClose:()=>M(!1),onConfirm:H,title:t("confirmSavePayroll"),message:t("confirmSavePayrollMessage"),confirmText:t("save")})]})},uH=()=>{const{siteId:t}=Y_(),{sites:e}=qe(),{t:n}=_e(),r=e.find(l=>l.id===t),i=r?`${n("cultivationCycleManagementTitle")} - ${r.name}`:n("cultivationCycleManagementTitle");return t?s.jsx(Ry,{initialFilters:{siteId:t},pageTitle:i}):s.jsx("div",{children:"Site not found"})},hH=()=>{const{typeId:t}=Y_(),{seaweedTypes:e}=qe(),{t:n}=_e(),r=e.find(l=>l.id===t),i=r?`${n("cultivationCycleManagementTitle")} - ${r.name}`:n("cultivationCycleManagementTitle");return t?s.jsx(Ry,{initialFilters:{seaweedTypeId:t},pageTitle:i}):s.jsx("div",{children:"Seaweed type not found"})},xu=({steps:t})=>s.jsxs("div",{className:"flex flex-col md:flex-row items-stretch justify-between gap-2 my-8 relative",children:[s.jsx("div",{className:"hidden md:block absolute top-6 left-0 w-full h-1 bg-gray-200 dark:bg-gray-700 -z-10 transform translate-y-1/2"}),t.map((e,n)=>s.jsxs("div",{className:"flex-1 flex flex-col items-center text-center group relative",children:[n!==t.length-1&&s.jsx("div",{className:"md:hidden absolute left-1/2 bottom-0 w-1 h-8 bg-gray-200 dark:bg-gray-700 transform translate-y-full -translate-x-1/2"}),s.jsx("div",{className:"w-12 h-12 rounded-full bg-white dark:bg-gray-800 border-4 border-blue-100 dark:border-blue-900 flex items-center justify-center shadow-sm mb-3 z-10 group-hover:border-blue-500 transition-colors duration-300",children:s.jsx(te,{name:e.icon,className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200 mb-1",children:e.title}),e.desc&&s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2",children:e.desc})]},n))]}),vu=({title:t,fields:e})=>s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-4 my-4",children:[s.jsxs("h4",{className:"font-bold text-sm text-blue-800 dark:text-blue-300 mb-3 flex items-center",children:[s.jsx(te,{name:"Edit",className:"w-4 h-4 mr-2"}),t]}),s.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.map((n,r)=>s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-baseline text-xs",children:[s.jsxs("span",{className:"font-mono font-semibold text-gray-700 dark:text-gray-300 w-32 shrink-0",children:[n.name," ",n.required&&s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("span",{className:"text-gray-600 dark:text-gray-400 italic border-l-2 border-gray-200 dark:border-gray-600 pl-2 sm:ml-2",children:n.description})]},r))})]}),Np=({title:t,subItems:e,color:n})=>{const r={blue:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",green:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",orange:"bg-orange-50 border-orange-200 dark:bg-orange-900/20 dark:border-orange-800"};return s.jsxs("div",{className:`p-4 rounded-lg border ${r[n]} flex-1 min-w-[200px]`,children:[s.jsx("h4",{className:"font-bold mb-3 text-center uppercase text-sm",children:t}),s.jsx("ul",{className:"space-y-2",children:e.map((i,l)=>s.jsxs("li",{className:"flex items-center text-xs bg-white dark:bg-gray-800 p-2 rounded shadow-sm",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mr-2 bg-${n}-500`}),i]},l))})]})},Sp=({text:t})=>{const{t:e}=_e();return s.jsxs("div",{className:"flex items-start p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 rounded-r text-xs my-4",children:[s.jsx(te,{name:"Sun",className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-bold block mb-1",children:e("tip_title")}),t]})]})},fH=()=>{const{t}=_e();return s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:t("legend_module_status")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["FREE","ASSIGNED","PLANTED","GROWING","HARVESTED","DRYING"].map(e=>s.jsx(An,{status:e},e))}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:t("legend_module_desc")})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:t("legend_incident_severity")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["LOW","MEDIUM","HIGH","CRITICAL"].map(e=>s.jsx(An,{status:e},e))}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:t("legend_incident_desc")})]})]})},ki=({title:t,children:e,defaultOpen:n=!1})=>{const[r,i]=S.useState(n);return s.jsxs(ze,{className:"mb-4 overflow-hidden transition-all hover:shadow-md",children:[s.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none p-1",onClick:()=>i(!r),children:[s.jsx("h2",{className:"text-lg font-bold uppercase tracking-wide text-gray-800 dark:text-gray-100",children:t}),s.jsx(te,{name:"ChevronDown",className:`w-6 h-6 transition-transform duration-200 ${r?"rotate-180":""}`})]}),s.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r?"max-h-[3000px] opacity-100 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700/50":"max-h-0 opacity-0"}`,children:e})]})},mH=()=>{const{t}=_e();return s.jsxs("div",{className:"pb-20 max-w-5xl mx-auto font-sans",children:[s.jsxs("div",{className:"mb-8 text-center",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-blue-900 dark:text-blue-100",children:t("userManual")}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-2xl mx-auto text-sm",children:t("manual_introduction_text").replace(/<[^>]*>?/gm,"")})]}),s.jsx(ki,{title:t("manual_architecture_title"),defaultOpen:!0,children:s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx(Np,{title:t("operations"),color:"green",subItems:[t("siteManagementTitle"),t("moduleManagementTitle"),t("cultivationCycleManagementTitle"),t("harvestProcessingTitle")]}),s.jsx(Np,{title:t("inventory"),color:"orange",subItems:[t("onSiteStorageTitle"),t("siteTransfersTitle"),t("pressedWarehouseTitle"),t("exports")]}),s.jsx(Np,{title:t("stakeholders"),color:"blue",subItems:[t("farmerManagementTitle"),t("farmerCreditsTitle"),t("documentPaymentsTitle"),t("reports")]})]})}),s.jsxs(ki,{title:t("manual_setup_title"),children:[s.jsx("p",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:t("manual_setup_desc")}),s.jsx(xu,{steps:[{title:t("step_sites"),icon:"MapPin",desc:t("step_desc_define_locations")},{title:t("step_modules"),icon:"Grid",desc:t("step_desc_create_infra")},{title:t("step_farmers"),icon:"User",desc:t("step_desc_add_personnel")},{title:t("step_assign"),icon:"UserCog",desc:t("step_desc_link_farmers")}]}),s.jsx(vu,{title:t("siteManagementTitle"),fields:[{name:t("siteName"),description:t("field_site_name"),required:!0},{name:t("manager"),description:t("field_manager")},{name:t("zones"),description:t("field_zones")}]}),s.jsx(Sp,{text:t("tip_map_interaction")})]}),s.jsxs(ki,{title:t("manual_production_title"),children:[s.jsx("h3",{className:"font-bold text-md mb-2 text-gray-800 dark:text-gray-200",children:t("cyclePerformance")}),s.jsx(xu,{steps:[{title:t("flow_planting"),icon:"GitBranch"},{title:t("flow_growing"),icon:"Sun"},{title:t("flow_harvest"),icon:"Scissors"},{title:t("flow_drying"),icon:"Wind"},{title:t("flow_bagging"),icon:"Archive"},{title:t("flow_stock"),icon:"Warehouse"}]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(vu,{title:t("guide_how_to_harvest"),fields:[{name:t("date"),description:t("date"),required:!0},{name:t("harvestedWeight"),description:t("field_harvest_weight"),required:!0},{name:t("cuttingsTaken"),description:t("field_cuttings_taken")},{name:t("linesHarvested"),description:t("numberOfLines"),required:!0}]}),s.jsxs("div",{className:"p-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("h4",{className:"font-bold mb-2",children:t("notes")}),s.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[s.jsx("li",{children:t("manual_desc_planting")}),s.jsx("li",{children:t("manual_desc_harvest")}),s.jsx("li",{children:t("manual_desc_processing")})]})]})]}),s.jsx(Sp,{text:t("tip_auto_growth")})]}),s.jsxs(ki,{title:t("manual_inventory_title"),children:[s.jsx(xu,{steps:[{title:t("stocks_sur_sites"),icon:"MapPin",desc:t("step_desc_collection")},{title:t("flow_transfer"),icon:"Truck",desc:t("step_desc_shipping_slip")},{title:t("flow_warehouse"),icon:"Building",desc:t("step_desc_reception")},{title:t("flow_pressing"),icon:"Archive",desc:t("step_desc_processing")},{title:t("flow_export"),icon:"Globe",desc:t("step_desc_shipping")}]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 p-2 border-l-2 border-blue-500 bg-blue-50 dark:bg-blue-900/10",children:[s.jsxs("strong",{children:[t("notes"),":"]})," ",t("manual_inventory_note")]})]}),s.jsxs(ki,{title:t("manual_finance_title"),children:[s.jsx("p",{className:"text-sm mb-4",children:t("manual_finance_desc")}),s.jsx(vu,{title:t("guide_how_to_pay"),fields:[{name:t("period"),description:t("deliveryPeriod"),required:!0},{name:t("paymentType"),description:t("desc_select_payment_type"),required:!0},{name:t("site"),description:t("desc_filter_site")}]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"p-3 border rounded-lg bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[s.jsx("h5",{className:"font-bold text-xs uppercase text-green-800 dark:text-green-300 mb-2",children:t("manual_finance_formula_title")}),s.jsx("p",{className:"text-xs font-mono whitespace-pre-line",children:s.jsx("strong",{children:t("manual_finance_formula_text")})})]}),s.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800",children:[s.jsx("h5",{className:"font-bold text-xs uppercase text-blue-800 dark:text-blue-300 mb-2",children:t("reports")}),s.jsx("p",{className:"text-xs",children:t("manual_finance_reports_text")})]})]})]}),s.jsxs(ki,{title:t("manual_monitoring_title"),children:[s.jsx(xu,{steps:[{title:t("step_log_test"),icon:"Beaker",desc:t("step_desc_weekly")},{title:t("step_analyze_pest"),icon:"Camera",desc:t("step_desc_ai")},{title:t("step_resolve_incident"),icon:"Check",desc:t("step_desc_action")}]}),s.jsx(vu,{title:t("guide_periodic_test"),fields:[{name:t("date"),description:t("date"),required:!0},{name:t("period"),description:t("desc_select_period"),required:!0},{name:t("field_water_temp"),description:t("desc_optional_api")},{name:t("field_salinity"),description:t("desc_manual_entry")}]}),s.jsx(Sp,{text:t("tip_ai_pest")})]}),s.jsx(ki,{title:t("manual_reports_title"),children:s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("globalFarmReport")}),": ",t("report_type_global")]}),s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("individualFarmerReport")}),": ",t("report_type_farmer")]}),s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("documentPaymentsTitle")}),": ",t("report_type_payment")]})]})}),s.jsx(ki,{title:t("status_legend_title"),children:s.jsx(fH,{})}),s.jsx("div",{className:"mt-8 text-center text-xs text-gray-400",children:s.jsxs("p",{children:[t("appName")," v1.1 - ",t("manual_introduction")]})})]})},pH=(t,e)=>new Date(t,e+1,0).getDate(),gH=(t,e)=>{const n=new Date(t,e,1).getDay();return n===0?6:n-1},O_=(t,e)=>t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear(),yH=()=>{const{t,language:e}=_e(),{cultivationCycles:n,monthlyPayments:r,incidents:i,periodicTests:l,modules:c,seaweedTypes:d,incidentTypes:f,sites:h}=qe(),[m,x]=S.useState(new Date),[g,N]=S.useState(null),[T,C]=S.useState({HARVEST:!0,PAYMENT:!0,INCIDENT:!0,TEST:!0}),[w,E]=S.useState(!1),D=S.useMemo(()=>{const J=[];n.forEach(G=>{if(G.status===Xe.PLANTED||G.status===Xe.GROWING){const B=new Date(G.plantingDate),Q=new Date(B);Q.setDate(B.getDate()+zr);const K=c.find(H=>H.id===G.moduleId),re=d.find(H=>H.id===G.seaweedTypeId);J.push({id:`harvest-${G.id}`,date:Q,type:"HARVEST",title:`${t("projectedHarvest")}: ${K==null?void 0:K.code}`,colorClass:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/50 dark:text-green-200 dark:border-green-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("module"),":"]})," ",K==null?void 0:K.code]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("seaweedType"),":"]})," ",re==null?void 0:re.name]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("plantingDate"),":"]})," ",G.plantingDate]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("initialWeight"),":"]})," ",G.initialWeight," kg"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("status"),":"]})," ",s.jsx(An,{status:G.status})]})]})})}});const Y=new Set;return r.forEach(G=>{const B=G.paymentRunId||G.date;Y.has(B)||(Y.add(B),J.push({id:`pay-${G.id}`,date:new Date(G.date),type:"PAYMENT",title:`${t("paymentRun")}`,colorClass:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/50 dark:text-blue-200 dark:border-blue-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("date"),":"]})," ",G.date]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("period"),":"]})," ",G.period]}),s.jsx("p",{className:"text-sm text-gray-500",children:"Details available in Document Payments."})]})}))}),i.forEach(G=>{var K,re;const B=((K=f.find(H=>H.id===G.type))==null?void 0:K.name)||G.type,Q=((re=h.find(H=>H.id===G.siteId))==null?void 0:re.name)||"Unknown Site";J.push({id:`inc-${G.id}`,date:new Date(G.date),type:"INCIDENT",title:`${t("incidentsLabel")}: ${B}`,colorClass:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/50 dark:text-red-200 dark:border-red-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("site"),":"]})," ",Q]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("type"),":"]})," ",B]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("severity"),":"]})," ",s.jsx(An,{status:G.severity})]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("status"),":"]})," ",s.jsx(An,{status:G.status})]}),s.jsxs("p",{className:"italic",children:['"',G.description,'"']})]})})}),l.forEach(G=>{var Q;const B=((Q=h.find(K=>K.id===G.siteId))==null?void 0:Q.name)||"Unknown Site";J.push({id:`test-${G.id}`,date:new Date(G.date),type:"TEST",title:`${t("periodicTest")}: ${G.identity}`,colorClass:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/50 dark:text-purple-200 dark:border-purple-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("identity"),":"]})," ",G.identity]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("site"),":"]})," ",B]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("growthRate"),":"]})," ",G.growthRate?`${G.growthRate}%`:"-"]})]})})}),J.filter(G=>T[G.type])},[n,r,i,l,c,d,f,h,t,T]),I=()=>{x(new Date(m.getFullYear(),m.getMonth()+1,1))},k=()=>{x(new Date(m.getFullYear(),m.getMonth()-1,1))},M=()=>{x(new Date)},j=async()=>{const J=new Date(m.getFullYear(),m.getMonth(),1),Y=new Date(m.getFullYear(),m.getMonth()+1,0),G=D.filter(B=>B.date>=J&&B.date<=Y).map(B=>({date:B.date.toLocaleDateString(e),type:B.type,title:B.title}));if(G.length===0){alert(t("noDataForReport"));return}await Ko(G,[{header:t("date"),key:"date",width:15},{header:t("category"),key:"type",width:15},{header:t("description"),key:"title",width:50}],`Calendar_${m.toLocaleDateString(e,{month:"long",year:"numeric"})}`,"Calendar Events")},O=m.getFullYear(),A=m.getMonth(),F=pH(O,A),P=gH(O,A),U=[];for(let J=0;J<P;J++)U.push(null);for(let J=1;J<=F;J++)U.push(new Date(O,A,J));const q=m.toLocaleDateString(e,{month:"long",year:"numeric"}),z=["mon","tue","wed","thu","fri","sat","sun"].map(J=>t(J));return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[s.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[s.jsx(te,{name:"Calendar",className:"w-8 h-8 text-blue-600"}),t("operationalCalendarTitle")]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(se,{variant:"secondary",onClick:j,className:"hidden sm:flex",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]}),s.jsxs("div",{className:"flex items-center bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-1",children:[s.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:s.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"})}),s.jsx("span",{className:"px-4 font-bold min-w-[150px] text-center capitalize",children:q}),s.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:s.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),s.jsx("button",{onClick:M,className:"px-3 py-1 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-md",children:"Today"}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>E(!w),className:`p-2 rounded-md ${w?"bg-blue-100 text-blue-700":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:t("filterEvents"),children:s.jsx(te,{name:"Filter",className:"w-5 h-5"})}),w&&s.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-20",children:s.jsx("div",{className:"space-y-1",children:["HARVEST","PAYMENT","INCIDENT","TEST"].map(J=>s.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:T[J],onChange:Y=>C(G=>({...G,[J]:Y.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm capitalize",children:J.toLowerCase()})]},J))})})]})]})]})]}),s.jsxs(ze,{className:"flex-grow flex flex-col p-0 overflow-hidden",children:[s.jsx("div",{className:"grid grid-cols-7 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:z.map(J=>s.jsx("div",{className:"py-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:J},J))}),s.jsx("div",{className:"grid grid-cols-7 flex-grow auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:U.map((J,Y)=>{if(!J)return s.jsx("div",{className:"bg-gray-50/50 dark:bg-gray-900/50 min-h-[120px]"},`empty-${Y}`);const G=D.filter(Q=>O_(Q.date,J)),B=O_(J,new Date);return s.jsxs("div",{className:`bg-white dark:bg-gray-900 min-h-[120px] p-2 flex flex-col transition-colors hover:bg-gray-50 dark:hover:bg-gray-800 relative ${B?"bg-blue-50/30":""}`,children:[s.jsx("span",{className:`text-sm font-medium mb-1 w-7 h-7 flex items-center justify-center rounded-full ${B?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300"}`,children:J.getDate()}),s.jsx("div",{className:"flex-grow space-y-1 overflow-y-auto max-h-[120px] custom-scrollbar",children:G.map(Q=>s.jsx("div",{onClick:()=>N(Q),className:`text-xs px-2 py-1 rounded border truncate cursor-pointer shadow-sm hover:opacity-80 transition-opacity ${Q.colorClass}`,title:Q.title,children:Q.title},Q.id))})]},J.toISOString())})})]}),g&&s.jsx(ot,{isOpen:!!g,onClose:()=>N(null),title:g.title,widthClass:"max-w-md",footer:s.jsx(se,{onClick:()=>N(null),children:t("close")}),children:s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:`p-3 rounded-lg mb-4 border ${g.colorClass}`,children:s.jsx("span",{className:"font-bold uppercase tracking-wider text-xs",children:g.type})}),g.details]})})]})},L_=({year:t,siteName:e})=>{const{t:n}=_e(),{settings:r}=Ke(),i=S.useMemo(()=>{var l;return((l=an.find(c=>c.code===r.localization.country))==null?void 0:l.name)||r.localization.country},[r.localization.country]);return s.jsxs("header",{className:"mb-4",children:[s.jsxs("div",{className:"grid grid-cols-4 items-center",children:[s.jsx("div",{className:"col-span-1",children:s.jsx("img",{src:r.company.logoUrl,alt:`${r.company.name} logo`,className:"h-10 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:r.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700",children:[s.jsxs("p",{children:[n("capital"),": ",Ae(r.company.capital,r.localization)]}),s.jsxs("p",{children:[n("address"),": ",r.company.address]}),s.jsxs("p",{children:[n("nif"),": ",r.company.nif," / ",n("stat"),": ",r.company.stat," / ",n("rc"),": ",r.company.rc]}),s.jsxs("p",{children:[n("phone"),": ",r.company.phone," / ",n("email"),": ",r.company.email]}),s.jsxs("p",{children:[n("country"),": ",i]})]})]}),s.jsx("div",{className:"col-span-1 text-right",children:s.jsx("p",{className:"font-bold text-xs",children:t})})]}),s.jsx("div",{className:"border-b-2 border-black mt-1 mb-2"}),s.jsx("h2",{className:"text-center text-base font-bold uppercase underline mb-1",children:n("farmerMonthlyReport")}),e&&s.jsx("h3",{className:"text-center text-sm font-bold text-blue-800 uppercase",children:e})]})},xH=({year:t})=>{const{t:e,language:n}=_e(),{settings:r}=Ke(),{cultivationCycles:i,modules:l,sites:c,seaweedTypes:d,farmers:f}=qe(),h=S.useMemo(()=>{const x={},g=new Date(t,0,1),N=new Date(t,11,31,23,59,59);return i.forEach(C=>{const w=l.find(j=>j.id===C.moduleId);if(!w||!w.farmerId||!w.siteId)return;const E=w.siteId,D=C.seaweedTypeId,I=w.farmerId,k=f.find(j=>j.id===I);if(!k)return;x[E]||(x[E]={}),x[E][D]||(x[E][D]={}),x[E][D][I]||(x[E][D][I]={name:`${k.lastName} ${k.firstName}`,months:Array.from({length:12},()=>({planted:0,harvested:0,production:0}))});const M=new Date(C.plantingDate);if(M>=g&&M<=N){const j=M.getMonth();x[E][D][I].months[j].planted+=C.linesPlanted||w.lines||0}if(C.harvestDate){const j=new Date(C.harvestDate);if(j>=g&&j<=N){const O=j.getMonth();x[E][D][I].months[O].harvested+=C.linesHarvested||0;const A=(C.harvestedWeight||0)-(C.cuttingsTakenAtHarvestKg||0);x[E][D][I].months[O].production+=A}}}),Object.keys(x).map(C=>{var D;const w=((D=c.find(I=>I.id===C))==null?void 0:D.name)||"Unknown Site",E=Object.keys(x[C]).map(I=>{var O;const k=((O=d.find(A=>A.id===I))==null?void 0:O.name)||"Unknown Type",M=Object.values(x[C][I]).sort((A,F)=>A.name.localeCompare(F.name)),j=Array.from({length:12},()=>({planted:0,harvested:0,production:0}));return M.forEach(A=>{A.months.forEach((F,P)=>{j[P].planted+=F.planted,j[P].harvested+=F.harvested,j[P].production+=F.production})}),{id:I,name:k,farmers:M,totals:j}}).sort((I,k)=>I.name.localeCompare(k.name));return{id:C,name:w,types:E}}).sort((C,w)=>C.name.localeCompare(w.name))},[f,i,l,t,c,d]),m=S.useMemo(()=>{const x=[];for(let g=0;g<12;g++)x.push(new Date(t,g,1).toLocaleDateString(n,{month:"short",year:"2-digit"}));return x},[t,n]);return h.length===0?s.jsxs(Xs,{landscape:!0,children:[s.jsx(L_,{year:t}),s.jsxs("div",{className:"p-8 text-center border border-dashed border-gray-300 rounded-lg bg-gray-50",children:[s.jsx("p",{className:"text-sm text-gray-500",children:e("noDataForReport")}),s.jsx("div",{className:"mt-4 overflow-x-auto opacity-50",children:s.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:e("farmer")}),m.map((x,g)=>s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:x},g))]})}),s.jsx("tbody",{children:s.jsx("tr",{children:s.jsx("td",{className:"border border-black p-4 text-center",colSpan:25,children:"-"})})})]})})]})]}):s.jsx(s.Fragment,{children:h.map(x=>s.jsxs(Xs,{landscape:!0,children:[s.jsx(L_,{year:t,siteName:x.name}),x.types.map(g=>s.jsxs("div",{className:"mb-8 break-inside-avoid",children:[s.jsxs("h4",{className:"font-bold text-xs mb-2 pl-2 border-l-4 border-green-500 bg-gray-50 p-1",children:[e("seaweedType"),": ",g.name]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:e("farmer")}),m.map((N,T)=>s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:N},T))]})}),s.jsx("tbody",{children:g.farmers.map(N=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-black p-1 font-bold",children:N.name}),N.months.map((T,C)=>s.jsxs(gt.Fragment,{children:[s.jsx("td",{className:"border border-black p-0.5 text-center align-middle",style:{width:"30px"},children:s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-blue-600 font-semibold",children:T.planted||"-"}),s.jsx("span",{className:"border-t border-gray-300 my-0.5"}),s.jsx("span",{className:"text-red-600 font-semibold",children:T.harvested||"-"})]})}),s.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold bg-gray-50/50",style:{width:"30px"},children:T.production?Ue(T.production,{...r.localization,nonMonetaryDecimals:0}):"-"})]},C))]},N.name))}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("td",{className:"border border-black p-1 font-bold",children:e("total")}),g.totals.map((N,T)=>s.jsxs(gt.Fragment,{children:[s.jsx("td",{className:"border border-black p-0.5 text-center align-middle",children:s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-blue-600 font-bold",children:N.planted}),s.jsx("span",{className:"border-t border-gray-400 my-0.5"}),s.jsx("span",{className:"text-red-600 font-bold",children:N.harvested})]})}),s.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold",children:Ue(N.production,{...r.localization,nonMonetaryDecimals:0})})]},T))]})})]})})]},g.id)),s.jsxs("div",{className:"mt-auto pt-4 flex gap-4 text-[8px] border-t border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-blue-600 font-bold",children:e("legendColorBlue")})," ",e("legendPlantedLines")]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-red-600 font-bold",children:e("legendColorRed")})," ",e("legendHarvestedLines")]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-bold",children:e("legendColorBlack")})," ",e("legendProductionKg")]})]})]},x.id))})},fc=({title:t,generator:e,className:n,minimal:r=!1})=>{const{t:i}=_e(),[l,c]=S.useState(""),[d,f]=S.useState(!1),[h,m]=S.useState(""),x=async()=>{f(!0),m("");try{const N=(await e()).split("###").map(T=>{if(!T.trim())return"";const[C,...w]=T.trim().split(`
`);return`
${`**${C.replace(/^[0-9.]+\s*/,"")}**`}
${w.join(`
`).trim()}`}).join(`
`).trim();c(N)}catch(g){console.error("Error generating narrative",g),m(i("errorGeneratingNarrative"))}finally{f(!1)}};return s.jsxs("div",{className:`flex flex-col h-full ${n||"mt-4"}`,children:[s.jsx("div",{className:"no-print mb-1 flex-shrink-0",children:s.jsxs(se,{onClick:x,disabled:d,className:"!text-xs !py-0.5 !px-2 h-6",children:[s.jsx(te,{name:d?"Activity":"Bot",className:`w-3 h-3 ${d?"animate-spin":""}`}),t]})}),s.jsxs("div",{className:`${r?"flex-grow overflow-hidden":"p-4 bg-white rounded-lg border border-gray-200"} min-h-[20px]`,children:[d&&s.jsxs("p",{className:"text-xs italic text-center text-black",children:[i("loading"),"..."]}),h&&s.jsx("p",{className:"text-xs text-red-600 text-center",children:h}),l&&s.jsx("div",{className:r?"text-xs leading-normal text-black whitespace-pre-wrap font-normal h-full text-justify":"prose prose-sm max-w-none whitespace-pre-wrap text-black",dangerouslySetInnerHTML:{__html:l.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />")}})]})]})},vH=({month:t,year:e,farmerId:n})=>{const{t:r,language:i}=_e(),{settings:l}=Ke(),{farmers:c,sites:d,cultivationCycles:f,modules:h,incidents:m}=qe(),x=new Date(e,t).toLocaleDateString(i,{month:"long",year:"numeric"}),g=new Date(e,t,1),N=new Date(e,t+1,0,23,59,59);S.useMemo(()=>{var I;return((I=an.find(k=>k.code===l.localization.country))==null?void 0:I.name)||l.localization.country},[l.localization.country]);const T=S.useMemo(()=>c.find(I=>I.id===n),[c,n]),C=S.useMemo(()=>d.find(I=>I.id===(T==null?void 0:T.siteId)),[d,T]),w=S.useMemo(()=>h.filter(I=>I.farmerId===n),[h,n]),E=S.useMemo(()=>{const I=f.filter(F=>{const P=h.find(U=>U.id===F.moduleId);return(P==null?void 0:P.farmerId)===n&&(new Date(F.plantingDate)<=N&&new Date(F.plantingDate)>=g||F.harvestDate&&new Date(F.harvestDate)<=N&&new Date(F.harvestDate)>=g)}),k=I.filter(F=>F.harvestDate&&new Date(F.harvestDate)>=g&&new Date(F.harvestDate)<=N),M=I.filter(F=>new Date(F.plantingDate)>=g&&new Date(F.plantingDate)<=N),j=k.reduce((F,P)=>F+(P.harvestedWeight||0),0),O=I.filter(F=>F.status==="PLANTED"||F.status==="GROWING").length,A=m.filter(F=>new Date(F.date)>=g&&new Date(F.date)<=N&&F.affectedModuleIds.some(P=>w.some(U=>U.id===P)));return{plantedLines:M.reduce((F,P)=>F+(P.linesPlanted||0),0),harvestedLines:k.reduce((F,P)=>F+(P.linesHarvested||0),0),harvestedWeight:j,activeCycles:O,incidentsCount:A.length,incidents:A,harvestedCycles:k}},[f,h,n,g,N,m,w]),D=S.useMemo(()=>{const I=[];return E.harvestedCycles.forEach(M=>{if(M.harvestDate&&M.plantingDate&&M.harvestedWeight&&M.initialWeight){const j=(new Date(M.harvestDate).getTime()-new Date(M.plantingDate).getTime())/864e5,O=Ch(M.initialWeight,M.harvestedWeight,j);O!==null&&I.push(O)}}),{avgGrowthRate:I.length>0?I.reduce((M,j)=>M+j,0)/I.length:0}},[E.harvestedCycles]);return T?s.jsxs(Xs,{children:[s.jsxs("header",{className:"mb-6 border-b pb-4",children:[s.jsx("h1",{className:"text-xl font-bold text-center uppercase mb-2",children:r("individualFarmerReport")}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("farmer"),":"]})," ",T.firstName," ",T.lastName]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("code"),":"]})," ",T.code]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("site"),":"]})," ",C==null?void 0:C.name]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("period"),":"]})," ",x]}),s.jsx("p",{children:l.company.name})]})]})]}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:r("productionSummary")}),s.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalPlantedLines")}),s.jsx("p",{className:"text-xl font-bold",children:E.plantedLines})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalHarvestedLines")}),s.jsx("p",{className:"text-xl font-bold",children:E.harvestedLines})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalHarvestedWeight")}),s.jsxs("p",{className:"text-xl font-bold",children:[Ue(E.harvestedWeight,l.localization)," kg"]})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("growthRate")}),s.jsxs("p",{className:"text-xl font-bold",children:[D.avgGrowthRate.toFixed(2),"%"]})]})]})]}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:r("incidentsReported")}),E.incidents.length>0?s.jsxs("table",{className:"w-full text-sm text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50",children:[s.jsx("th",{className:"p-2",children:r("date")}),s.jsx("th",{className:"p-2",children:r("type")}),s.jsx("th",{className:"p-2",children:r("severity")})]})}),s.jsx("tbody",{children:E.incidents.map(I=>s.jsxs("tr",{className:"border-b border-gray-100",children:[s.jsx("td",{className:"p-2",children:I.date}),s.jsx("td",{className:"p-2",children:I.type}),s.jsx("td",{className:"p-2",children:I.severity})]},I.id))})]}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:r("noIncidentsForFarmer")})]}),s.jsx("section",{children:s.jsx(fc,{title:r("narrativeFarmerPerformance"),generator:()=>yG({farmerName:`${T.firstName} ${T.lastName}`,siteName:(C==null?void 0:C.name)||"",period:x,production:E,efficiency:D,incidentsCount:E.incidentsCount},i)})})]}):s.jsx("div",{children:r("noDataForReport")})},bH=({month:t,year:e,sections:n})=>{const{t:r,language:i}=_e(),{settings:l}=Ke(),{cultivationCycles:c,modules:d,sites:f,seaweedTypes:h,farmerCredits:m,repayments:x,farmers:g,creditTypes:N,stockMovements:T,employees:C,incidents:w,incidentTypes:E}=qe(),D=new Date(e,t).toLocaleDateString(i,{month:"long",year:"numeric"}),I=new Date(e,t,1),k=new Date(e,t+1,0,23,59,59),M=S.useMemo(()=>{var q;return((q=an.find(z=>z.code===l.localization.country))==null?void 0:q.name)||l.localization.country},[l.localization.country]),j=S.useMemo(()=>n.includes("production")?c.filter(q=>q.harvestDate&&new Date(q.harvestDate)>=I&&new Date(q.harvestDate)<=k).map(q=>{const z=d.find(G=>G.id===q.moduleId),J=q.harvestDate?(new Date(q.harvestDate).getTime()-new Date(q.plantingDate).getTime())/(1e3*3600*24):0,Y=(q.harvestedWeight||0)-(q.cuttingsTakenAtHarvestKg||0);return{cycle:{...q,harvestedWeight:Y},module:z,site:f.find(G=>G.id===(z==null?void 0:z.siteId)),seaweedType:h.find(G=>G.id===q.seaweedTypeId),duration:Math.round(J)}}).sort((q,z)=>new Date(q.cycle.harvestDate).getTime()-new Date(z.cycle.harvestDate).getTime()):[],[n,c,d,f,h,I,k]),O=S.useMemo(()=>{if(!n.includes("finance"))return{reportData:[],summaryStats:{totalCredits:0,totalAmount:0,topFarmers:[]}};const q=new Map(g.map(B=>[B.id,`${B.firstName} ${B.lastName}`])),z=new Map(N.map(B=>[B.id,B.name])),J=m.filter(B=>B.date&&new Date(B.date)>=I&&new Date(B.date)<=k).map(B=>({...B,farmerName:q.get(B.farmerId)||r("unknown"),creditTypeName:z.get(B.creditTypeId)||r("unknown")})),Y=new Map;J.forEach(B=>{Y.set(B.farmerName,(Y.get(B.farmerName)||0)+B.totalAmount)});const G=Array.from(Y.entries()).sort(([,B],[,Q])=>Q-B).slice(0,5).map(([B,Q])=>({name:B,total:Q}));return{reportData:J,summaryStats:{totalCredits:J.length,totalAmount:J.reduce((B,Q)=>B+Q.totalAmount,0),topFarmers:G}}},[n,m,g,N,I,k,r]),A=S.useMemo(()=>{if(!n.includes("inventory"))return{reportData:[],summaryStats:{totalKg:0,totalBags:0,totalValue:0}};const q=new Map;T.forEach(G=>{if(new Date(G.date)<=k){const B=`${G.siteId}|${G.seaweedTypeId}`,Q=q.get(B)||{kg:0,bags:0};Q.kg+=(G.inKg||0)-(G.outKg||0),Q.bags+=(G.inBags||0)-(G.outBags||0),q.set(B,Q)}});const z=new Map(f.map(G=>[G.id,G.name])),J=new Map(h.map(G=>[G.id,{name:G.name,dryPrice:G.dryPrice}])),Y=Array.from(q.entries()).map(([G,B])=>{const[Q,K]=G.split("|"),re=z.get(Q)||r("unknown"),H=J.get(K),ae=(H==null?void 0:H.name)||r("unknown"),ue=B.kg*((H==null?void 0:H.dryPrice)||0);return{siteName:re,seaweedTypeName:ae,currentStockKg:Math.max(0,B.kg),currentStockBags:Math.max(0,B.bags),value:ue}}).filter(G=>G.currentStockKg>.01||G.currentStockBags>0);return{reportData:Y,summaryStats:{totalKg:Y.reduce((G,B)=>G+B.currentStockKg,0),totalBags:Y.reduce((G,B)=>G+B.currentStockBags,0),totalValue:Y.reduce((G,B)=>G+B.value,0)}}},[n,T,f,h,k,r]),F=S.useCallback(async()=>j.length===0?r("noDataForReport"):await SG(j,i),[j,i,r]),P=S.useCallback(async()=>O.reportData.length===0?r("noDataForReport"):await _G(O.reportData,O.summaryStats,i),[O,i,r]),U=S.useCallback(async()=>A.reportData.length===0?r("noDataForReport"):await wG(A.reportData,A.summaryStats,i),[A,i,r]);return s.jsxs(Xs,{children:[s.jsx("header",{className:"mb-8 border-b-2 border-gray-800 dark:border-gray-200 pb-4",children:s.jsxs("div",{className:"grid grid-cols-4 items-center",children:[s.jsx("div",{className:"col-span-1",children:s.jsx("img",{src:l.company.logoUrl,alt:`${l.company.name} logo`,className:"h-14 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-xl uppercase mb-1 text-gray-900 dark:text-gray-100",children:l.company.name}),s.jsxs("div",{className:"text-[9px] leading-tight space-y-0 text-gray-600 dark:text-gray-400",children:[s.jsxs("p",{children:[r("address"),": ",l.company.address]}),s.jsxs("p",{children:[r("nif"),": ",l.company.nif," / ",r("stat"),": ",l.company.stat]}),s.jsxs("p",{children:[r("country"),": ",M]})]})]}),s.jsxs("div",{className:"col-span-1 text-right",children:[s.jsx("h2",{className:"text-xl font-bold uppercase text-gray-900 dark:text-gray-100",children:r("customReportTitle")}),s.jsx("p",{className:"font-bold text-sm mt-1 text-blue-600 dark:text-blue-400",children:D})]})]})}),n.includes("production")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-blue-500 mb-4 pb-1 text-blue-800 dark:text-blue-300 flex items-center",children:[s.jsx("span",{className:"bg-blue-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_production")]}),s.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-xs",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-blue-50 dark:bg-blue-900/30 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("site")}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("module")}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("seaweedType")}),s.jsxs("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:[r("harvestedWeight")," (Net Kg)"]}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:r("duration")})]})}),s.jsx("tbody",{children:j.length>0?j.map((q,z)=>{var J,Y,G;return s.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${z%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(J=q.site)==null?void 0:J.name}),s.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:(Y=q.module)==null?void 0:Y.code}),s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(G=q.seaweedType)==null?void 0:G.name}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Ue(q.cycle.harvestedWeight||0,l.localization)}),s.jsxs("td",{className:"p-2 text-right text-gray-600 dark:text-gray-400",children:[q.duration," ",r("days")]})]},q.cycle.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:r("noDataForReport")})})})]})}),j.length>0&&s.jsx(fc,{title:r("aiAnalysis"),generator:F,minimal:!0})]}),n.includes("finance")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-green-500 mb-4 pb-1 text-green-800 dark:text-green-300 flex items-center",children:[s.jsx("span",{className:"bg-green-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_finance")]}),s.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 text-center",children:[s.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[s.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:r("totalCreditsIssued")}),s.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:O.summaryStats.totalCredits})]}),s.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[s.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:r("totalCreditAmount")}),s.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:Ae(O.summaryStats.totalAmount,l.localization)})]})]}),O.reportData.length>0&&s.jsx(fc,{title:r("aiAnalysis"),generator:P,minimal:!0})]}),n.includes("inventory")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-yellow-500 mb-4 pb-1 text-yellow-800 dark:text-yellow-300 flex items-center",children:[s.jsx("span",{className:"bg-yellow-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_inventory")]}),s.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-xs",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800",children:[s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:r("site")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:r("seaweedType")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:r("stockKg")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:r("stockBales")})]})}),s.jsx("tbody",{children:A.reportData.length>0?A.reportData.map((q,z)=>s.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${z%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:q.siteName}),s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:q.seaweedTypeName}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Ue(q.currentStockKg,l.localization)}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:Ue(q.currentStockBags,{...l.localization,nonMonetaryDecimals:0})})]},`${q.siteName}-${q.seaweedTypeName}`)):s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:r("noDataForReport")})})})]})}),A.reportData.length>0&&s.jsx(fc,{title:r("aiAnalysis"),generator:U,minimal:!0})]}),n.includes("incidents")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-red-500 mb-4 pb-1 text-red-800 dark:text-red-300 flex items-center",children:[s.jsx("span",{className:"bg-red-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_incidents")]}),s.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-center",children:s.jsx("p",{className:"text-sm italic text-gray-500 dark:text-gray-400",children:r("noMajorIncidents")})})]})]})},Yo=({children:t,className:e=""})=>s.jsx("div",{className:`report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col h-auto min-h-[210mm] overflow-visible print:overflow-visible print:shadow-none ${e}`,children:s.jsx("div",{className:"flex-grow flex flex-col font-sans text-xs leading-normal text-black p-6 box-border w-full",children:t})}),Jo=({period:t,title:e})=>{const{settings:n}=Ke(),{t:r}=_e();return s.jsxs("header",{className:"flex-shrink-0 text-black relative mb-4 border-b-2 border-gray-800 pb-2",children:[s.jsx("div",{className:"absolute top-0 right-0 text-[9px] font-bold text-gray-600",children:t}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:n.company.logoUrl,alt:"Logo",className:"h-10 w-auto object-contain"})}),s.jsxs("div",{className:"flex-grow text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-1 tracking-wide",children:n.company.name}),s.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight",children:[s.jsxs("span",{children:[r("company_sarl")," ",Ae(n.company.capital,n.localization)]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["NIF: ",n.company.nif]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["STAT: ",n.company.stat]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["RCS: ",n.company.rc]})]}),s.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight mt-0.5",children:[s.jsx("span",{children:n.company.address}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:[r("phone"),": ",n.company.phone]})]})]}),s.jsx("div",{className:"w-20"})," "]}),s.jsx("div",{className:"text-center mt-3",children:e&&s.jsx("h2",{className:"font-bold text-sm uppercase tracking-wider inline-block pb-0.5",children:e})})]})},Xo=({page:t,totalPages:e})=>s.jsxs("div",{className:"mt-auto pt-4 text-center text-[8px] text-gray-500 border-t border-gray-300 print:mt-auto break-before-avoid",children:["Page ",t," / ",e]}),oe=({children:t,className:e="",colSpan:n,rowSpan:r,header:i=!1,align:l="center",bold:c=!1,title:d})=>s.jsx("td",{colSpan:n,rowSpan:r,title:d,className:`px-1 py-0.5 border border-gray-400 text-[8px] text-black align-middle text-${l} ${i?"font-bold bg-gray-100 text-gray-900":""} ${c?"font-bold":""} ${e}`,children:t||s.jsx(s.Fragment,{children:""})}),qi=({generator:t,className:e="",title:n})=>{const{t:r}=_e();return s.jsxs("div",{className:`text-black flex flex-col mt-4 break-inside-avoid ${e}`,children:[s.jsxs("div",{className:"font-bold text-[9px] mb-1 uppercase text-blue-800 border-b border-blue-200 inline-block self-start",children:[n," :"]}),s.jsx("div",{className:"relative text-[9pt] leading-snug text-justify text-gray-800 bg-gray-50 p-2 rounded border border-gray-200",children:s.jsx(fc,{title:r("narratif_explicatif_tableau"),generator:t,minimal:!0,className:"mt-0 !h-auto"})})]})},NH=({month:t,year:e})=>{const{t:n,language:r}=_e(),i=qe(),{sites:l,seaweedTypes:c,cultivationCycles:d,modules:f,incidents:h,periodicTests:m,farmers:x,stockMovements:g,pressedStockMovements:N,exportDocuments:T,creditTypes:C,farmerCredits:w,repayments:E,employees:D,roles:I,monthlyPayments:k,incidentTypes:M}=i,j=S.useMemo(()=>{const B=new Date(e,t,1),Q=new Date(e,t+1,0,23,59,59),K=new Date(e,t).toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),re=[];for(let fe=0;fe<12;fe++){const Z=new Date(e,fe),ee=Z.toLocaleString(r,{month:"short"}).replace(".","").toUpperCase(),xe=Z.getFullYear().toString().slice(-2);re.push(`${ee} ${xe}`)}const H=[];for(let fe=5;fe>=0;fe--)H.push(new Date(e,t-fe));const ae=new Date(e,t+1),ue=new Date(e,t+2),Ne=new Date(e,t+3),le=[ae.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),ue.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),Ne.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase()],Te=new Date(e,t-1,1).toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase();return{startDate:B,endDate:Q,period:K,year:e,month:t,months:re,sixMonths:H,prevMonthName:Te,nextMonths:le}},[e,t,r]),{pivotData:O,sortedIncidentTypes:A,displaySites:F,displaySeaweedTypes:P,onSiteStockReportData:U,pressedWarehouseReportData:q,monthlyProductionData:z}=S.useMemo(()=>{const B={},Q=()=>({farmerCount:0,lineAge:{"0-10":0,"11-20":0,"21-30":0,"30-40":0,"40-50":0,">50":0},totalLinesInWater:0,totalLinesHarvested:0,totalLinesPlanted:0,productionKg:0,avgGrowthRate:0,growthRateCount:0,forecast:{m1:0,m2:0,m3:0},incidents:{},weather:{tempSum:0,tempCount:0,salinitySum:0,salinityCount:0,rainSum:0,rainCount:0,windSpeedSum:0,windSpeedCount:0,windDirSum:0,windDirCount:0}});c.forEach(Z=>{B[Z.id]={},l.forEach(ee=>{B[Z.id][ee.id]=Q()}),B[Z.id].TOTAL=Q()});const K={};l.forEach(Z=>{K[Z.id]={},c.forEach(ee=>{K[Z.id][ee.id]=Array.from({length:12},()=>({production:0,growthRateSum:0,growthRateCount:0}))})}),d.forEach(Z=>{const ee=f.find(Re=>Re.id===Z.moduleId);if(!ee)return;const xe=Z.seaweedTypeId,Oe=ee.siteId;if(Z.harvestDate&&Z.harvestedWeight&&K[Oe]&&K[Oe][xe]){const Re=new Date(Z.harvestDate);if(Re.getFullYear()===e){const $e=Re.getMonth(),He=K[Oe][xe][$e],Se=(Z.harvestedWeight||0)-(Z.cuttingsTakenAtHarvestKg||0);if(He.production+=Se,Z.initialWeight&&Z.initialWeight>0){const Le=(Re.getTime()-new Date(Z.plantingDate).getTime())/864e5;if(Le>0){const be=(Math.log(Z.harvestedWeight)-Math.log(Z.initialWeight))/Le*100;He.growthRateSum+=be,He.growthRateCount++}}}}if(!B[xe]||!B[xe][Oe])return;[B[xe][Oe],B[xe].TOTAL].forEach(Re=>{if((Z.status===Xe.PLANTED||Z.status===Xe.GROWING)&&new Date(Z.plantingDate)<=j.endDate){const $e=Z.linesPlanted||ee.lines||0,He=(j.endDate.getTime()-new Date(Z.plantingDate).getTime())/(1e3*60*60*24);Re.totalLinesInWater+=$e;let Se=">50";He<=10?Se="0-10":He<=20?Se="11-20":He<=30?Se="21-30":He<=40?Se="30-40":He<=50&&(Se="40-50"),Re.lineAge[Se]+=$e;const be=new Date(new Date(Z.plantingDate).getTime()+zr*24*60*60*1e3).getMonth(),ye=new Date(e,t+1).getMonth(),Fe=new Date(e,t+2).getMonth(),et=new Date(e,t+3).getMonth(),Lt=$e*.8;be===ye?Re.forecast.m1+=Lt:be===Fe?Re.forecast.m2+=Lt:be===et&&(Re.forecast.m3+=Lt)}if(Z.harvestDate&&new Date(Z.harvestDate)>=j.startDate&&new Date(Z.harvestDate)<=j.endDate){Re.totalLinesHarvested+=Z.linesHarvested||0;const $e=(Z.harvestedWeight||0)-(Z.cuttingsTakenAtHarvestKg||0);if(Re.productionKg+=$e,Z.harvestedWeight&&Z.initialWeight&&Z.initialWeight>0){const He=(new Date(Z.harvestDate).getTime()-new Date(Z.plantingDate).getTime())/864e5;if(He>0){const Se=(Math.log(Z.harvestedWeight)-Math.log(Z.initialWeight))/He*100;Re.avgGrowthRate=(Re.avgGrowthRate*Re.growthRateCount+Se)/(Re.growthRateCount+1),Re.growthRateCount++}}}new Date(Z.plantingDate)>=j.startDate&&new Date(Z.plantingDate)<=j.endDate&&(Re.totalLinesPlanted+=Z.linesPlanted||ee.lines||0)})});const re={};f.forEach(Z=>{var ee;if(Z.farmerId&&Z.siteId){const xe=d.find(De=>De.moduleId===Z.id&&(De.status==="PLANTED"||De.status==="GROWING")),Oe=xe?xe.seaweedTypeId:(ee=c[0])==null?void 0:ee.id;if(Oe){const De=`${Oe}-${Z.siteId}`,Re=`${Oe}-TOTAL`;re[De]||(re[De]=new Set),re[Re]||(re[Re]=new Set),re[De].add(Z.farmerId),re[Re].add(Z.farmerId)}}}),Object.entries(re).forEach(([Z,ee])=>{const[xe,Oe]=Z.split("-");B[xe]&&B[xe][Oe]&&(B[xe][Oe].farmerCount=ee.size)});const H={};h.forEach(Z=>{const ee=new Date(Z.date);if(ee>=j.startDate&&ee<=j.endDate){H[Z.type]=(H[Z.type]||0)+1;const xe=new Set;Z.affectedModuleIds&&Z.affectedModuleIds.length>0&&Z.affectedModuleIds.forEach(Oe=>{var He;const De=f.find(Se=>Se.id===Oe);if(!De)return;let Re=d.find(Se=>Se.moduleId===De.id&&new Date(Se.plantingDate)<=ee&&(!Se.harvestDate||new Date(Se.harvestDate)>=ee));Re||(Re=d.filter(Le=>Le.moduleId===De.id&&new Date(Le.plantingDate)<=ee).sort((Le,be)=>new Date(be.plantingDate).getTime()-new Date(Le.plantingDate).getTime())[0]);const $e=Re?Re.seaweedTypeId:(He=c[0])==null?void 0:He.id;$e&&De.siteId&&xe.add(`${$e}|${De.siteId}`)}),xe.forEach(Oe=>{const[De,Re]=Oe.split("|");B[De]&&B[De][Re]&&(B[De][Re].incidents[Z.type]=(B[De][Re].incidents[Z.type]||0)+1,B[De].TOTAL.incidents[Z.type]=(B[De].TOTAL.incidents[Z.type]||0)+1)})}}),m.forEach(Z=>{var ee,xe;new Date(Z.date)>=j.startDate&&new Date(Z.date)<=j.endDate&&[(ee=B[Z.seaweedTypeId])==null?void 0:ee[Z.siteId],(xe=B[Z.seaweedTypeId])==null?void 0:xe.TOTAL].forEach(De=>{De&&(Z.temperature&&(De.weather.tempSum+=Z.temperature,De.weather.tempCount++),Z.salinity&&(De.weather.salinitySum+=Z.salinity,De.weather.salinityCount++),Z.precipitation&&(De.weather.rainSum+=Z.precipitation,De.weather.rainCount++),Z.windSpeed&&(De.weather.windSpeedSum+=Z.windSpeed,De.weather.windSpeedCount++),Z.windDirection&&(De.weather.windDirSum+=Z.windDirection,De.weather.windDirCount++))})});const ae={};l.forEach(Z=>{Z.id!=="pressing-warehouse"&&(ae[Z.id]={},c.forEach(ee=>{ae[Z.id][ee.id]={openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0}}))}),g.forEach(Z=>{if(Z.siteId==="pressing-warehouse"||!ae[Z.siteId]||!ae[Z.siteId][Z.seaweedTypeId])return;const ee=new Date(Z.date),xe=ae[Z.siteId][Z.seaweedTypeId];ee<j.startDate?(xe.openingKg+=(Z.inKg||0)-(Z.outKg||0),xe.openingBags+=(Z.inBags||0)-(Z.outBags||0)):ee<=j.endDate&&(xe.entriesKg+=Z.inKg||0,xe.entriesBags+=Z.inBags||0,xe.exitsKg+=Z.outKg||0,xe.exitsBags+=Z.outBags||0)}),Object.values(ae).forEach(Z=>{Object.values(Z).forEach(ee=>{ee.closingKg=ee.openingKg+ee.entriesKg-ee.exitsKg,ee.closingBags=ee.openingBags+ee.entriesBags-ee.exitsBags})});const ue={};c.forEach(Z=>{ue[Z.id]={bulk:{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},pressed:{openingKg:0,openingBales:0,entriesKg:0,entriesBales:0,exitsKg:0,exitsBales:0,closingKg:0,closingBales:0}}}),N.forEach(Z=>{if(!ue[Z.seaweedTypeId])return;const ee=new Date(Z.date)<j.startDate,xe=new Date(Z.date)>=j.startDate&&new Date(Z.date)<=j.endDate;if(Z.type===mt.BULK_IN_FROM_SITE||Z.type===mt.FARMER_DELIVERY){const Oe=Z.inBales||0;ee&&(ue[Z.seaweedTypeId].bulk.openingKg+=Z.inKg||0,ue[Z.seaweedTypeId].bulk.openingBags+=Oe),xe&&(ue[Z.seaweedTypeId].bulk.entriesKg+=Z.inKg||0,ue[Z.seaweedTypeId].bulk.entriesBags+=Oe)}if(Z.type===mt.PRESSING_CONSUMPTION){const Oe=Z.outBales||0;ee&&(ue[Z.seaweedTypeId].bulk.openingKg-=Z.outKg||0,ue[Z.seaweedTypeId].bulk.openingBags-=Oe),xe&&(ue[Z.seaweedTypeId].bulk.exitsKg+=Z.outKg||0,ue[Z.seaweedTypeId].bulk.exitsBags+=Oe)}(Z.type===mt.INITIAL_STOCK||Z.type===mt.PRESSING_IN)&&(ee&&(ue[Z.seaweedTypeId].pressed.openingKg+=Z.inKg||0,ue[Z.seaweedTypeId].pressed.openingBales+=Z.inBales||0),xe&&Z.type===mt.PRESSING_IN&&(ue[Z.seaweedTypeId].pressed.entriesKg+=Z.inKg||0,ue[Z.seaweedTypeId].pressed.entriesBales+=Z.inBales||0)),(Z.type===mt.EXPORT_OUT||Z.type===mt.RETURN_TO_SITE)&&(ee&&(ue[Z.seaweedTypeId].pressed.openingKg-=Z.outKg||0,ue[Z.seaweedTypeId].pressed.openingBales-=Z.outBales||0),xe&&(ue[Z.seaweedTypeId].pressed.exitsKg+=Z.outKg||0,ue[Z.seaweedTypeId].pressed.exitsBales+=Z.outBales||0))}),Object.keys(ue).forEach(Z=>{const ee=ue[Z];ee.bulk.closingKg=ee.bulk.openingKg+ee.bulk.entriesKg-ee.bulk.exitsKg,ee.bulk.closingBags=ee.bulk.openingBags+ee.bulk.entriesBags-ee.bulk.exitsBags,ee.pressed.closingKg=ee.pressed.openingKg+ee.pressed.entriesKg-ee.pressed.exitsKg,ee.pressed.closingBales=ee.pressed.openingBales+ee.pressed.entriesBales-ee.pressed.exitsBales});const Ne=l.filter(Z=>Z.id!=="pressing-warehouse");let le=c;c.length===0&&(le=[{id:"default",name:n("allSeaweedTypes"),dryPrice:0,wetPrice:0,scientificName:"",description:"",priceHistory:[]}]);const Te=Object.keys(H).sort((Z,ee)=>H[ee]-H[Z]).slice(0,3).map(Z=>{var ee;return((ee=M.find(xe=>xe.id===Z))==null?void 0:ee.name)||Z}),fe={totalLinesInWater:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesInWater,0),totalHarvestedLines:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesHarvested,0),totalPlantedLines:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.totalLinesPlanted,0),totalProductionKg:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.productionKg,0),avgGrowthRate:Object.values(B).reduce((Z,ee)=>Z+ee.TOTAL.avgGrowthRate,0)/(Object.keys(B).length||1),incidentCount:Object.values(H).reduce((Z,ee)=>Z+ee,0)};return{pivotData:B,sortedIncidentTypes:Te,displaySites:Ne,displaySeaweedTypes:le,onSiteStockReportData:ae,pressedWarehouseReportData:ue,monthlyProductionData:K,page1Data:fe}},[d,f,x,h,m,l,c,j,g,N,e,t,M,n]),{groupedFarmerStats:J,totals:Y}=S.useMemo(()=>{const B=new Map,Q=ue=>`${ue.getFullYear()}-${ue.getMonth()}`,K=(ue,Ne,le)=>{B.has(ue)||B.set(ue,new Map);const ne=B.get(ue);ne.has(Ne)||ne.set(Ne,new Map);const Te=ne.get(Ne);return Te.has(le)||Te.set(le,{planted:0,harvested:0,production:0}),Te.get(le)};d.forEach(ue=>{const Ne=f.find(ee=>ee.id===ue.moduleId);if(!(Ne!=null&&Ne.farmerId))return;const le=Ne.farmerId,ne=ue.seaweedTypeId,Te=new Date(ue.plantingDate),fe=Q(Te),Z=K(le,ne,fe);if(Z.planted+=ue.linesPlanted||Ne.lines||0,ue.harvestDate){const ee=new Date(ue.harvestDate),xe=Q(ee),Oe=K(le,ne,xe);Oe.harvested+=ue.linesHarvested||0;const De=(ue.harvestedWeight||0)-(ue.cuttingsTakenAtHarvestKg||0);Oe.production+=De}});const re={};x.forEach(ue=>{const Ne=l.find(ne=>ne.id===ue.siteId);if(!Ne)return;const le=B.get(ue.id);le&&le.forEach((ne,Te)=>{const fe=j.sixMonths.map(ee=>{const xe=Q(ee);return ne.get(xe)||{planted:0,harvested:0,production:0}});if(fe.some(ee=>ee.planted>0||ee.harvested>0||ee.production>0)){const ee=c.find(xe=>xe.id===Te);if(!ee)return;re[Ne.id]||(re[Ne.id]={siteName:Ne.name,seaweedTypes:{}}),re[Ne.id].seaweedTypes[Te]||(re[Ne.id].seaweedTypes[Te]={typeName:ee.name,farmers:[]}),re[Ne.id].seaweedTypes[Te].farmers.push({id:ue.id,name:`${ue.lastName} ${ue.firstName}`,stats:fe})}})});const H=Object.values(re).map(ue=>({...ue,seaweedTypes:Object.values(ue.seaweedTypes).map(Ne=>({...Ne,farmers:Ne.farmers.sort((le,ne)=>le.name.localeCompare(ne.name))})).sort((Ne,le)=>Ne.typeName.localeCompare(le.typeName))})).sort((ue,Ne)=>ue.siteName.localeCompare(Ne.siteName)),ae=j.sixMonths.map((ue,Ne)=>H.reduce((le,ne)=>(ne.seaweedTypes.forEach(Te=>{Te.farmers.forEach(fe=>{const Z=fe.stats[Ne];le.planted+=Z.planted,le.harvested+=Z.harvested,le.production+=Z.production})}),le),{planted:0,harvested:0,production:0}));return{groupedFarmerStats:H,totals:ae}},[x,j.sixMonths,d,f,l,c]),G=6;return s.jsxs(s.Fragment,{children:[s.jsx(SH,{period:j.period,pivotData:O,displaySites:F,displaySeaweedTypes:P,incidentTypes:A,nextMonths:j.nextMonths,t:n,page:1,totalPages:G}),s.jsx(_H,{period:j.period,employees:D,sites:F,roles:I,page:2,totalPages:G,monthlyPayments:k,month:t,year:e}),s.jsx(wH,{period:j.period,onSiteData:U,warehouseData:q,sites:F,seaweedTypes:c,page:3,totalPages:G}),s.jsx(TH,{period:j.period,year:j.year,exportDocuments:T,seaweedTypes:c,page:4,totalPages:G}),s.jsx(CH,{period:j.period,months:j.months,monthlyData:z,year:e,sites:F,seaweedTypes:c,page:5,totalPages:G}),s.jsx(EH,{period:j.period,sixMonths:j.sixMonths,prevMonthName:j.prevMonthName,creditTypes:C,farmerCredits:w,repayments:E,year:e,month:t,groupedData:J,totals:Y,page:6,totalPages:G})]})},SH=({period:t,pivotData:e,displaySites:n,displaySeaweedTypes:r,incidentTypes:i,nextMonths:l,t:c,page:d,totalPages:f})=>{const{settings:h}=Ke(),m=(N,T)=>{var C;return(C=e[N])==null?void 0:C[T]},x=N=>{const T=c("days");return N.includes(">")?`> 50 ${T}`:`${N} ${T}`},g=1+(n.length+1)*r.length;return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t,title:c("globalFarmReport")}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"w-full overflow-hidden",children:s.jsxs("table",{className:"w-full border-collapse mb-2 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"150px"}}),Array.from({length:g-1}).map((N,T)=>s.jsx("col",{},T))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsxs(oe,{rowSpan:2,header:!0,className:"align-middle bg-gray-200 border-b-2 border-gray-500 text-center",children:[c("period"),":",s.jsx("br",{}),t]}),r.map(N=>s.jsx(oe,{colSpan:n.length+1,header:!0,className:"bg-blue-50 border-b border-blue-300 text-blue-900 uppercase tracking-widest",children:N.name},N.id))]}),s.jsx("tr",{children:r.map(N=>s.jsxs(gt.Fragment,{children:[n.map(T=>s.jsx(oe,{header:!0,className:"bg-gray-50 text-gray-700 font-semibold",children:T.name},T.id)),s.jsx(oe,{header:!0,className:"bg-blue-100 text-blue-900 font-bold border-l border-blue-200",children:c("total")})]},N.id))})]}),s.jsxs("tbody",{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[9px] tracking-wider border-t-2 border-gray-600 font-bold",children:c("apercuGeneralDeLaFerme")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"font-semibold bg-gray-50 pl-2",children:c("fermier_effectif")}),r.map(N=>{var T;return s.jsxs(gt.Fragment,{children:[n.map(C=>{var w;return s.jsx(oe,{children:((w=m(N.id,C.id))==null?void 0:w.farmerCount)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-100 border-l border-gray-300",children:((T=m(N.id,"TOTAL"))==null?void 0:T.farmerCount)||"-"})]},N.id)})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("tranche_age_lignes")})}),["0-10","11-20","21-30","30-40","40-50",">50"].map((N,T)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:x(N)}),r.map(C=>{var w;return s.jsxs(gt.Fragment,{children:[n.map(E=>{var D;return s.jsx(oe,{children:((D=m(C.id,E.id))==null?void 0:D.lineAge[N])||"-"},E.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((w=m(C.id,"TOTAL"))==null?void 0:w.lineAge[N])||"-"})]},C.id)})]},N)),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("bilan_lignes")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 font-bold text-blue-900 border-r border-gray-300",children:c("total_lignes_eau")}),r.map(N=>{var T;return s.jsxs(gt.Fragment,{children:[n.map(C=>{var w;return s.jsx(oe,{bold:!0,className:"text-blue-900",children:((w=m(N.id,C.id))==null?void 0:w.totalLinesInWater)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-blue-900 border-l border-blue-200",children:((T=m(N.id,"TOTAL"))==null?void 0:T.totalLinesInWater)||"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_recoltees")}),r.map(N=>{var T;return s.jsxs(gt.Fragment,{children:[n.map(C=>{var w;return s.jsx(oe,{children:((w=m(N.id,C.id))==null?void 0:w.totalLinesHarvested)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(N.id,"TOTAL"))==null?void 0:T.totalLinesHarvested)||"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_plantees")}),r.map(N=>{var T;return s.jsxs(gt.Fragment,{children:[n.map(C=>{var w;return s.jsx(oe,{children:((w=m(N.id,C.id))==null?void 0:w.totalLinesPlanted)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(N.id,"TOTAL"))==null?void 0:T.totalLinesPlanted)||"-"})]},N.id)})]}),s.jsxs("tr",{className:"border-t-2 border-gray-400",children:[s.jsx(oe,{header:!0,align:"left",className:"bg-green-100 text-green-900 uppercase font-bold pl-2",children:c("production_periode_kg")}),r.map(N=>{var T,C;return s.jsxs(gt.Fragment,{children:[n.map(w=>{var E,D;return s.jsx(oe,{className:"font-bold bg-green-50",children:(E=m(N.id,w.id))!=null&&E.productionKg?Ue((D=m(N.id,w.id))==null?void 0:D.productionKg,h.localization):"-"},w.id)}),s.jsx(oe,{bold:!0,className:"bg-green-100 text-green-900 border-l border-green-300",children:(T=m(N.id,"TOTAL"))!=null&&T.productionKg?Ue((C=m(N.id,"TOTAL"))==null?void 0:C.productionKg,h.localization):"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,align:"left",className:"bg-yellow-100 text-yellow-900 uppercase font-bold pl-2",children:c("taux_croissance_moyen")}),r.map(N=>{var T,C;return s.jsxs(gt.Fragment,{children:[n.map(w=>{var E,D;return s.jsx(oe,{className:"bg-yellow-50",children:(((E=m(N.id,w.id))==null?void 0:E.avgGrowthRate)||0)>0?`${(((D=m(N.id,w.id))==null?void 0:D.avgGrowthRate)||0).toFixed(2)}%`:"-"},w.id)}),s.jsx(oe,{bold:!0,className:"bg-yellow-100 text-yellow-900 border-l border-yellow-300",children:(((T=m(N.id,"TOTAL"))==null?void 0:T.avgGrowthRate)||0)>0?`${(((C=m(N.id,"TOTAL"))==null?void 0:C.avgGrowthRate)||0).toFixed(2)}%`:"-"})]},N.id)})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("prevision_production")})}),["m1","m2","m3"].map((N,T)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:l[T]}),r.map(C=>{var w,E;return s.jsxs(gt.Fragment,{children:[n.map(D=>{var I,k;return s.jsx(oe,{children:(I=m(C.id,D.id))!=null&&I.forecast[N]?Ue((k=m(C.id,D.id))==null?void 0:k.forecast[N],h.localization):"-"},D.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:(w=m(C.id,"TOTAL"))!=null&&w.forecast[N]?Ue((E=m(C.id,"TOTAL"))==null?void 0:E.forecast[N],h.localization):"-"})]},C.id)})]},N)),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,className:"bg-gray-200 text-black font-bold py-1.5 text-center text-[9px] border-t-2 border-gray-600 tracking-widest",children:c("monitoringReport").toUpperCase()})}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[8px] tracking-wider font-bold",children:c("incidentsLabel")})}),i.length>0?i.map((N,T)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-red-700 font-medium border-r border-gray-300",children:N}),r.map(C=>{var w;return s.jsxs(gt.Fragment,{children:[n.map(E=>{var D,I;return s.jsx(oe,{className:(D=m(C.id,E.id))!=null&&D.incidents[N]?"bg-red-50 font-bold text-red-600":"",children:((I=m(C.id,E.id))==null?void 0:I.incidents[N])||"-"},E.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((w=m(C.id,"TOTAL"))==null?void 0:w.incidents[N])||"-"})]},C.id)})]},N)):s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-green-600 italic bg-green-50",children:c("noMajorIncidents")}),s.jsx(oe,{colSpan:g-1,className:"bg-gray-50",children:"-"})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("vent")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("vitesse_kmh")}),r.map(N=>s.jsxs(gt.Fragment,{children:[n.map(T=>{const C=m(N.id,T.id);return s.jsx(oe,{children:C&&C.weather.windSpeedCount?(C.weather.windSpeedSum/C.weather.windSpeedCount).toFixed(1):"-"},T.id)}),s.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},N.id))]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("direction_deg")}),r.map(N=>s.jsxs(gt.Fragment,{children:[n.map(T=>{const C=m(N.id,T.id);return s.jsx(oe,{children:C&&C.weather.windDirCount?(C.weather.windDirSum/C.weather.windDirCount).toFixed(0):"-"},T.id)}),s.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},N.id))]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("autres_parametres")})}),[{label:"temperature_c",key:"temp"},{label:"salinite_ppt",key:"salinity"},{label:"pluviometrie_mm",key:"rain"}].map((N,T)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c(N.label)}),r.map(C=>s.jsxs(gt.Fragment,{children:[n.map(w=>{const E=m(C.id,w.id),D=E==null?void 0:E.weather[`${N.key}Count`],I=E==null?void 0:E.weather[`${N.key}Sum`];return s.jsx(oe,{children:D?(I/D).toFixed(1):"-"},w.id)}),s.jsx(oe,{bold:!0,align:"center",className:"bg-gray-50 border-l border-gray-300",children:c("averageShort")})]},C.id))]},N.label))]})]})}),s.jsx(qi,{title:c("narratif_explicatif_tableau"),generator:async()=>TG({})})]}),s.jsx(Xo,{page:d,totalPages:f})]})},_H=({period:t,employees:e,sites:n,roles:r,page:i,totalPages:l,monthlyPayments:c,month:d,year:f})=>{const{t:h}=_e(),{settings:m}=Ke(),x=S.useMemo(()=>{const w=new Map;if(!c)return w;const E=`${f}-${String(d+1).padStart(2,"0")}`;return c.filter(I=>I.period.startsWith(E)&&I.recipientType===rn.EMPLOYEE).forEach(I=>{try{const k=JSON.parse(I.notes||"{}");k.type==="payroll_run"&&k.details&&k.details.gross!==void 0&&w.set(I.recipientId,parseFloat(k.details.gross)||0)}catch{}}),w},[c,f,d]),g=S.useCallback((w,E,D)=>{const I=e.filter(O=>O.role===w&&O.employeeType===E&&(D?O.siteId===D:!0)),k=I.length,M=O=>x.get(O.id)??0,j=I.reduce((O,A)=>O+M(A),0);return{count:k,amount:j}},[e,x]),N=["PERMANENT","CASUAL"],T=r.map(w=>w.name).sort(),C=S.useMemo(()=>{const w={};return N.forEach(E=>{w[E]={totalCount:0,totalAmount:0,sites:{}},n.forEach(D=>w[E].sites[D.id]={count:0,amount:0}),T.forEach(D=>{const I=g(D,E);w[E].totalCount+=I.count,w[E].totalAmount+=I.amount,n.forEach(k=>{const M=g(D,E,k.id);w[E].sites[k.id].count+=M.count,w[E].sites[k.id].amount+=M.amount})})}),w},[r,n,g]);return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t,title:h("repartition_salaries_site")}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"w-full",children:s.jsxs("table",{className:"w-full border-collapse text-[7px] table-fixed border border-gray-400",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"20%"}}),s.jsx("col",{style:{width:"8%"}}),s.jsx("col",{style:{width:"12%"}}),n.map(w=>s.jsxs(gt.Fragment,{children:[s.jsx("col",{}),s.jsx("col",{})]},w.id))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"w-[20%] border-gray-400 bg-gray-100"}),s.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 text-blue-900 font-bold border-b border-gray-400 uppercase text-center",children:h("total")}),n.map(w=>s.jsx(oe,{colSpan:2,header:!0,className:"bg-gray-50 border-b border-gray-400 uppercase text-center font-bold",children:w.name},w.id))]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-blue-50 text-center border-r border-blue-200",children:h("effectif")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-center",children:h("montant_du_mois")}),n.map(w=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{header:!0,className:"bg-gray-50 text-center border-l border-gray-300",children:h("effectif")}),s.jsx(oe,{header:!0,className:"bg-gray-50 text-center",children:h("montant_du_mois")})]},`sub-${w.id}`))]})]}),s.jsx("tbody",{children:N.map(w=>s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:3+n.length*2,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase tracking-widest border-t-2 border-gray-400 font-bold",children:h(w==="CASUAL"?"journalier":"permanent")})}),T.map(E=>{const D=g(E,w);return D.count===0?null:s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{align:"left",className:"pl-2 font-medium border-r border-gray-300",children:E}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center border-r border-blue-100",children:D.count}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right pr-2",children:D.amount?Ae(D.amount,m.localization):"-"}),n.map(I=>{const k=g(E,w,I.id);return s.jsxs(gt.Fragment,{children:[s.jsx(oe,{className:`text-center border-l border-gray-300 ${k.count?"":"text-gray-300"}`,children:k.count||"-"}),s.jsx(oe,{className:`text-right pr-2 ${k.amount?"":"text-gray-300"}`,children:k.amount?Ae(k.amount,m.localization):"-"})]},I.id)})]},`${w}-${E}`)}),s.jsxs("tr",{className:"bg-gray-100 font-bold border-t-2 border-gray-400",children:[s.jsx(oe,{align:"left",className:"pl-2 uppercase border-r border-gray-400",children:h(w==="CASUAL"?"total_journalier":"total_permanent")}),s.jsx(oe,{className:"bg-blue-200 text-center border-r border-blue-300",children:C[w].totalCount}),s.jsx(oe,{className:"bg-blue-200 text-right pr-2",children:Ae(C[w].totalAmount,m.localization)}),n.map(E=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{className:"text-center border-l border-gray-400 bg-gray-50",children:C[w].sites[E.id].count}),s.jsx(oe,{className:"text-right pr-2 bg-gray-50",children:Ae(C[w].sites[E.id].amount,m.localization)})]},`tot-${E.id}`))]})]},w))})]})}),s.jsx("div",{className:"w-full",children:s.jsx(qi,{title:h("narratif_repartition_salaries"),generator:async()=>CG({})})})]}),s.jsx(Xo,{page:i,totalPages:l})]})},wH=({period:t,onSiteData:e,warehouseData:n,sites:r,seaweedTypes:i,page:l,totalPages:c})=>{const{t:d}=_e(),{settings:f}=Ke(),h=s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"16%"}}),s.jsx("col",{style:{width:"6%"}})," ",s.jsx("col",{style:{width:"5%"}})," ",s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}})," ",s.jsx("col",{style:{width:"5%"}})," ",s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}})," ",s.jsx("col",{style:{width:"5%"}})," ",s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}})," ",s.jsx("col",{style:{width:"5%"}})," ",s.jsx("col",{style:{width:"10%"}})]});return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t}),s.jsxs("div",{className:"flex flex-col gap-6 mt-2",children:[s.jsxs("section",{children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-green-600 pl-2",children:[d("stocks_sur_sites")," :"]}),s.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:d("stock_ouverture")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:d("entrees")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:d("sorties")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:d("stock_fermeture")})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("valeur")})]})]}),s.jsx("tbody",{children:r.map(m=>s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-500 font-bold pl-2",children:m.name})}),i.map(x=>{var T;const g=((T=e[m.id])==null?void 0:T[x.id])||{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},N=x.dryPrice||0;return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium border-r border-gray-300",align:"left",children:x.name}),s.jsx(oe,{className:"text-right",children:g.openingKg?Ue(g.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.openingBags||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.openingKg?Ae(g.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.entriesKg?Ue(g.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.entriesBags||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.entriesKg?Ae(g.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.exitsKg?Ue(g.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.exitsBags||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.exitsKg?Ae(g.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.closingKg?Ue(g.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.closingBags||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.closingKg?Ae(g.closingKg*N,f.localization):"-"})]},x.id)})]},m.id))})]}),s.jsx(qi,{title:d("narratif_stocks_sites"),generator:async()=>EG({})})]}),s.jsxs("section",{children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-orange-500 pl-2",children:[d("stock_magasin_presse")," :"]}),s.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:d("stock_ouverture")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:d("entrees")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:d("sorties")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:d("stock_fermeture")})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("valeur")})]})]}),s.jsx("tbody",{children:i.map((m,x)=>{const g=n[m.id],N=m.dryPrice||0;return g?s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-400 font-bold pl-2",children:m.name.toUpperCase()})}),s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:d("algues_en_vrac")}),s.jsx(oe,{className:"text-right",children:g.bulk.openingKg?Ue(g.bulk.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.bulk.openingBags||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.bulk.openingKg?Ae(g.bulk.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.bulk.entriesKg?Ue(g.bulk.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.bulk.entriesBags||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.bulk.entriesKg?Ae(g.bulk.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.bulk.exitsKg?Ue(g.bulk.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.bulk.exitsBags||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.bulk.exitsKg?Ae(g.bulk.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.bulk.closingKg?Ue(g.bulk.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.bulk.closingBags||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.bulk.closingKg?Ae(g.bulk.closingKg*N,f.localization):"-"})]}),s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:d("algues_pressees")}),s.jsx(oe,{className:"text-right",children:g.pressed.openingKg?Ue(g.pressed.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.pressed.openingBales||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.pressed.openingKg?Ae(g.pressed.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.pressed.entriesKg?Ue(g.pressed.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.pressed.entriesBales||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.pressed.entriesKg?Ae(g.pressed.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.pressed.exitsKg?Ue(g.pressed.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.pressed.exitsBales||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.pressed.exitsKg?Ae(g.pressed.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.pressed.closingKg?Ue(g.pressed.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.pressed.closingBales||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.pressed.closingKg?Ae(g.pressed.closingKg*N,f.localization):"-"})]})]},`presse-algue-${m.id}`):null})})]}),s.jsx(qi,{title:d("narratif_stocks_magasin"),generator:async()=>IG({})})]})]}),s.jsx(Xo,{page:l,totalPages:c})]})},TH=({period:t,year:e,exportDocuments:n,seaweedTypes:r,page:i,totalPages:l})=>{const{t:c}=_e(),{settings:d}=Ke(),f=g=>{if(g.length===0)return s.jsx("tr",{children:s.jsx(oe,{colSpan:8,align:"center",className:"italic text-gray-500 py-4 bg-gray-50",children:"- No exports -"})});const N={};return r.forEach(T=>N[T.id]=[]),g.forEach(T=>{N[T.seaweedTypeId]||(N[T.seaweedTypeId]=[]),N[T.seaweedTypeId].push(T)}),r.map(T=>{var M;const C=N[T.id]||[];if(C.length===0)return null;const w=C.reduce((j,O)=>j+O.containers.reduce((A,F)=>A+F.seaweedWeightKg,0),0),E=C.reduce((j,O)=>j+O.containers.reduce((A,F)=>A+F.packagesCount,0),0),D=C.reduce((j,O)=>j+O.containers.length,0),I=C.reduce((j,O)=>j+O.containers.reduce((A,F)=>A+F.value,0),0),k=((M=C[0])==null?void 0:M.currency)||d.localization.currency;return s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:7,className:"bg-gray-200 uppercase font-bold tracking-wider border-t-2 border-gray-500 pl-2",children:T.name.toUpperCase()})}),C.map(j=>{const O=j.containers.reduce((U,q)=>U+q.seaweedWeightKg,0),A=j.containers.reduce((U,q)=>U+q.packagesCount,0),F=j.containers.length,P=j.containers.reduce((U,q)=>U+q.value,0);return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"text-right pr-4",children:Ue(O,d.localization)}),s.jsx(oe,{className:"text-right pr-4",children:Ue(A,{...d.localization,nonMonetaryDecimals:0})}),s.jsx(oe,{className:"text-center",children:F}),s.jsx(oe,{className:"text-right pr-4",children:Ae(P,{...d.localization,currencySymbol:j.currency})}),s.jsx(oe,{children:j.invoiceNo}),s.jsx(oe,{children:j.poNo}),s.jsx(oe,{children:j.destinationCountry})]},j.id)}),s.jsxs("tr",{className:"border-t border-gray-400 font-bold bg-gray-50",children:[s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Ue(w,d.localization)}),s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Ue(E,{...d.localization,nonMonetaryDecimals:0})}),s.jsx(oe,{bold:!0,className:"text-center border-r border-gray-300",children:D}),s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Ae(I,{...d.localization,currencySymbol:k})}),s.jsx(oe,{colSpan:3,align:"left",className:"bg-gray-100 pl-2 italic text-gray-500",children:c("total")})]})]},T.id)})},h=S.useMemo(()=>n.filter(g=>g.date.includes(String(e))),[n,t,e]),m=S.useMemo(()=>n.filter(g=>new Date(g.date).getFullYear()===e),[n,e]),x=({title:g,docs:N})=>s.jsxs("section",{className:"mb-4 flex-shrink-0",children:[s.jsx("p",{className:"text-xs mb-2 text-black font-bold uppercase border-b border-black inline-block",children:g}),s.jsxs("table",{className:"w-full border-collapse border border-gray-400 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"12%"}}),s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"8%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"25%"}})]}),s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("quantite_expedie")," (Kg)"]}),s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("colis")," (",c("baleSingular"),")"]}),s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("nombre_conteneur")," (TC)"]}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("valeur_totale")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("facture_n")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("po")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("destinataire")})]})}),s.jsx("tbody",{children:f(N)})]})]});return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t}),s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-purple-600 pl-2",children:[c("liste_exportations_realisees")," :"]}),s.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[s.jsx(x,{title:`${c("de_la_periode")} (${t})`,docs:h}),s.jsx(x,{title:`${c("de_annee")} (${e})`,docs:m}),s.jsx(qi,{title:c("narratif_exportations_realisees"),generator:async()=>jG({})})]}),s.jsx(Xo,{page:i,totalPages:l})]})},CH=({period:t,months:e,monthlyData:n,year:r,sites:i,seaweedTypes:l,page:c,totalPages:d})=>{const{t:f}=_e(),{settings:h}=Ke();return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t,title:f("production_mensuelle_par_site")}),s.jsxs("div",{className:"flex-grow flex flex-col gap-2 mt-2 overflow-visible",children:[s.jsxs("table",{className:"w-full border-collapse text-[6px] flex-shrink-0 table-fixed border border-gray-400",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"14%"}}),e.map((m,x)=>s.jsxs(gt.Fragment,{children:[s.jsx("col",{style:{width:"3.5%"}}),s.jsx("col",{style:{width:"3.6%"}})]},x))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-gray-200 border-gray-400"}),e.map((m,x)=>s.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 border-gray-400 border-b text-blue-900 uppercase font-bold text-[7px]",children:m},x))]}),s.jsx("tr",{children:e.map((m,x)=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0 border-r",children:"%"}),s.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0",children:"Kg"})]},`sub-h-${x}`))})]}),s.jsx("tbody",{children:i.map(m=>s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+e.length*2,header:!0,align:"left",className:"bg-gray-200 py-1 px-2 uppercase font-bold border-t-2 border-gray-400",children:m.name})}),l.map(x=>{var N;const g=((N=n[m.id])==null?void 0:N[x.id])||[];return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-semibold bg-gray-50 border-r border-gray-300",align:"left",children:x.name}),e.map((T,C)=>{const w=g[C],E=w&&w.growthRateCount>0?w.growthRateSum/w.growthRateCount:0;return s.jsxs(gt.Fragment,{children:[s.jsx(oe,{className:"border-r border-gray-200 text-[6px] text-center",children:E>0?`${E.toFixed(1)}`:"-"}),s.jsx(oe,{className:"border-r border-gray-300 text-[6px] text-center bg-gray-50 font-medium",children:w&&w.production>0?Ue(w.production,{...h.localization,nonMonetaryDecimals:0}):"-"})]},C)})]},x.id)})]},m.id))})]}),s.jsx(qi,{title:f("narratif_production_mensuelle"),generator:async()=>AG({})})]}),s.jsx(Xo,{page:c,totalPages:d})]})},EH=({period:t,sixMonths:e,prevMonthName:n,creditTypes:r,farmerCredits:i,repayments:l,year:c,month:d,groupedData:f,totals:h,page:m,totalPages:x})=>{const{t:g,language:N}=_e(),{settings:T}=Ke(),C=e.map(D=>{const I=D.toLocaleString(N,{month:"short"}).replace(".","").toUpperCase(),k=D.getFullYear().toString().slice(-2);return`${I} ${k}`}),w=s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"20%"}}),C.map((D,I)=>s.jsxs(gt.Fragment,{children:[s.jsx("col",{style:{width:"4%"}}),s.jsx("col",{style:{width:"4%"}}),s.jsx("col",{style:{width:"5%"}})]},I))]}),E=S.useMemo(()=>{const D=F=>{const P={},U={balance:0,farmers:new Set},q=i.filter(G=>new Date(G.date)<=F),z=l.filter(G=>new Date(G.date)<=F),J=q.reduce((G,B)=>G+B.totalAmount,0),Y=z.reduce((G,B)=>G+B.amount,0);return U.balance=J-Y,r.forEach(G=>{const B=q.filter(H=>H.creditTypeId===G.id),Q=B.reduce((H,ae)=>H+ae.totalAmount,0),K=J>0?Q/J:0,re=Y*K;P[G.id]={balance:Q-re,farmers:new Set(B.map(H=>H.farmerId)).size},B.forEach(H=>U.farmers.add(H.farmerId))}),{stats:P,totalStats:{balance:U.balance,farmers:U.farmers.size}}},I=new Date(c,d,0,23,59,59),k=new Date(c,d+1,0,23,59,59),M=D(I),j=D(k),O=l.filter(F=>new Date(F.date)<new Date(c,d,1)&&new Date(F.date)>=new Date(c,d-1,1)).reduce((F,P)=>F+P.amount,0),A=l.filter(F=>new Date(F.date)>=new Date(c,d,1)&&new Date(F.date)<=k).reduce((F,P)=>F+P.amount,0);return{prevMonthStats:M,currMonthStats:j,prevMonthRepayments:O,currMonthRepayments:A}},[i,l,r,c,d]);return s.jsxs(Yo,{children:[s.jsx(Jo,{period:t}),s.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[s.jsxs("section",{className:"flex flex-col",children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-yellow-500 pl-2",children:[g("situation_credits")," :"]}),s.jsxs("table",{className:"w-full border-collapse flex-shrink-0 mb-2 border border-gray-400 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"25%"}}),s.jsx("col",{style:{width:"12.5%"}})," ",s.jsx("col",{style:{width:"12.5%"}})," ",s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}})," ",s.jsx("col",{style:{width:"12.5%"}})," ",s.jsx("col",{style:{width:"12.5%"}})]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-100 border-gray-400"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 text-gray-600 uppercase font-bold border-gray-400 border-b text-center",children:n}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 text-blue-900 uppercase font-bold border-gray-400 border-b border-l-2 border-l-blue-300 text-center",children:t})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("effectif_fermiers_concernes")}),s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("solde_credits")}),s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("total_remboursements")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px] border-l-2 border-l-blue-300",children:g("effectif_fermiers_concernes")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:g("solde_credits")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:g("total_remboursements")})]})]}),s.jsx("tbody",{children:r.map(D=>{const I=E.prevMonthStats.stats[D.id],k=E.currMonthStats.stats[D.id];return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{header:!0,align:"left",className:"pl-2 text-gray-700 border-r border-gray-300",children:D.name}),s.jsx(oe,{className:"text-center",children:(I==null?void 0:I.farmers)||"-"}),s.jsx(oe,{className:"text-right pr-2",children:I!=null&&I.balance?Ae(I.balance,T.localization):"-"}),s.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-center text-blue-900",children:(k==null?void 0:k.farmers)||"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:k!=null&&k.balance?Ae(k.balance,T.localization):"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:"-"})]},D.id)})}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold bg-gray-100 border-t-2 border-gray-400",children:[s.jsx(oe,{header:!0,align:"left",className:"pl-2 border-r border-gray-300",children:g("total")}),s.jsx(oe,{className:"text-center",children:E.prevMonthStats.totalStats.farmers}),s.jsx(oe,{className:"text-right pr-2",children:Ae(E.prevMonthStats.totalStats.balance,T.localization)}),s.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:Ae(E.prevMonthRepayments,T.localization)}),s.jsx(oe,{className:"bg-blue-100 font-bold text-center text-blue-900",children:E.currMonthStats.totalStats.farmers}),s.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthStats.totalStats.balance,T.localization)}),s.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthRepayments,T.localization)})]})})]}),s.jsx(qi,{title:g("narratif_situation_credits"),generator:async()=>kG(E)})]}),s.jsxs("section",{className:"flex flex-col mt-4",children:[s.jsx("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-indigo-500 pl-2",children:g("statistique_individuelle_fermiers")}),s.jsx("div",{className:"border border-gray-400 overflow-hidden",children:s.jsxs("table",{className:"w-full border-collapse text-[6px] table-fixed",children:[w,s.jsxs("thead",{className:"sticky top-0 z-10",children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-200 align-middle text-[8px] border-b-2 border-gray-500",children:g("farmer")}),C.map((D,I)=>s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-100 border-b border-gray-400 font-bold",children:D},I))]}),s.jsx("tr",{children:C.map((D,I)=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:g("status_PLANTED"),children:g("status_PLANTED").charAt(0)}),s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:g("status_HARVESTED"),children:g("status_HARVESTED").charAt(0)}),s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-400 bg-white font-normal",children:"Kg"})]},`sub-h-${I}`))})]}),s.jsx("tbody",{children:f.map(D=>s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+C.length*3,header:!0,align:"left",className:"bg-blue-100 py-1 text-[8px] uppercase tracking-widest border-t-2 border-gray-500 font-bold pl-2",children:D.siteName})}),D.seaweedTypes.map(I=>s.jsxs(gt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+C.length*3,header:!0,align:"left",className:"bg-green-50 py-0.5 pl-4 text-[7px] text-green-800 italic border-t border-gray-300 font-medium",children:I.typeName})}),I.farmers.map(k=>s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{align:"left",className:"align-middle truncate px-1 border-r border-gray-300 bg-white font-normal",title:k.name,children:k.name}),k.stats.map((M,j)=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-blue-600 font-semibold",children:M.planted||"-"}),s.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-red-600 font-semibold",children:M.harvested||"-"}),s.jsx(oe,{className:"font-bold border-r border-gray-300 text-right pr-1 align-middle bg-gray-50/50",children:M.production?Ue(M.production,{...T.localization,nonMonetaryDecimals:0}):"-"})]},`cell-group-${j}`))]},k.id))]},I.typeName))]},D.siteName))}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold border-t-2 border-gray-500",children:[s.jsx(oe,{header:!0,className:"align-middle uppercase tracking-widest text-[8px] border-r border-gray-400",children:g("total")}),h.map((D,I)=>s.jsxs(gt.Fragment,{children:[s.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-blue-600 font-bold",children:D.planted}),s.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-red-600 font-bold",children:D.harvested}),s.jsx(oe,{header:!0,className:"font-bold border-r border-gray-400 text-right pr-1 align-middle bg-gray-100",children:Ue(D.production,{...T.localization,nonMonetaryDecimals:0})})]},`total-cell-group-${I}`))]})})]})}),s.jsx(qi,{title:g("narratif_statistique_individuelle"),generator:async()=>DG(f)})]})]}),s.jsx(Xo,{page:m,totalPages:x})]})},IH=()=>{const{t}=_e(),{farmers:e}=qe(),{settings:n}=Ke(),[r,i]=S.useState("global_farm_report"),[l,c]=S.useState(()=>new Date().getMonth()),[d,f]=S.useState(()=>new Date().getFullYear()),[h,m]=S.useState(""),[x,g]=S.useState(["production","finance","inventory"]),[N,T]=S.useState(!1),[C,w]=S.useState(!1),[E,D]=S.useState(!1),I=S.useMemo(()=>Array.from({length:10},(Y,G)=>new Date().getFullYear()-5+G),[]),k=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),M=S.useMemo(()=>Array.from({length:12},(Y,G)=>G),[]),j=S.useMemo(()=>[...e].sort((Y,G)=>Y.firstName.localeCompare(G.firstName)),[e]);S.useEffect(()=>{j.length>0&&!h&&m(j[0].id)},[j,h]);const O=()=>{T(!0)},A=()=>{window.print()},F=async()=>{D(!0);try{const Y=`${r}_${d}_${l+1}`,G=t("reportsTitle");await LG(G,Y)}catch(Y){console.error("Excel export failed",Y),alert("Export failed. See console for details.")}finally{D(!1)}},P=async()=>{w(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:Y}=window.jspdf,G=window.html2canvas,B=document.getElementById("printable-area");if(!B)throw new Error("Printable area not found");const Q=["farmer_monthly","global_farm_report"].includes(r),K=Q?"l":"p",re=new Y({orientation:K,unit:"mm",format:"a4",compress:!0});re.setProperties({title:`${r.replace(/_/g," ").toUpperCase()} - ${d}-${(l+1).toString().padStart(2,"0")}`,subject:"AlgaManage Report",author:n.company.name||"AlgaManage",creator:"AlgaManage System"});const H=B.getElementsByClassName(Q?"report-page-landscape":"print-page"),ae=H.length>0?H:B.getElementsByClassName("print-page");for(let le=0;le<ae.length;le++){const ne=ae[le],Te=await G(ne,{scale:3,useCORS:!0,logging:!1,windowWidth:Q?1920:1200,windowHeight:ne.scrollHeight+50,backgroundColor:"#ffffff"}),fe=Te.toDataURL("image/jpeg",.95),Z=Te.width,ee=Te.height,xe=re.internal.pageSize.getWidth(),Oe=re.internal.pageSize.getHeight(),De=xe/Z,Re=ee*De;le>0&&re.addPage(),Re<=Oe+2,re.addImage(fe,"JPEG",0,0,xe,Re,void 0,"FAST")}const ue=(l+1).toString().padStart(2,"0"),Ne=r.split("_").map(le=>le.charAt(0).toUpperCase()+le.slice(1)).join("_");re.save(`${Ne}_${d}_${ue}.pdf`)}catch(Y){console.error("Error generating PDF:",Y),alert(t("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),w(!1)}},U=Y=>{g(G=>G.includes(Y)?G.filter(B=>B!==Y):[...G,Y]),T(!1)},q=["individual_farmer","custom","global_farm_report"].includes(r),z=["farmer_monthly"].includes(r),J=()=>{if(!N)return s.jsx("div",{className:"text-center p-8 text-gray-500 no-print",children:t("selectFiltersAndGenerate")});switch(r){case"global_farm_report":return s.jsx(NH,{month:l,year:d});case"farmer_monthly":return s.jsx(xH,{year:d});case"individual_farmer":return s.jsx(vH,{month:l,year:d,farmerId:h});case"custom":return s.jsx(bH,{month:l,year:d,sections:x});default:return null}};return s.jsxs("div",{className:"pb-20",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reportsTitle")}),s.jsx(ze,{title:t("selectReportType"),className:"mb-6 no-print",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[s.jsxs(ke,{label:t("selectReportType"),value:r,onChange:Y=>{i(Y.target.value),T(!1)},children:[s.jsx("option",{value:"global_farm_report",children:t("globalFarmReport")}),s.jsx("option",{value:"custom",children:t("customReport")}),s.jsx("option",{value:"farmer_monthly",children:t("farmerMonthlyReport")}),s.jsx("option",{value:"individual_farmer",children:t("individualFarmerReport")})]}),q&&s.jsxs(s.Fragment,{children:[s.jsx(ke,{label:t("month"),value:l,onChange:Y=>c(parseInt(Y.target.value)),children:M.map(Y=>s.jsx("option",{value:Y,children:t(k[Y])},Y))}),s.jsx(ke,{label:t("year"),value:d,onChange:Y=>f(parseInt(Y.target.value)),children:I.map(Y=>s.jsx("option",{value:Y,children:Y},Y))})]}),z&&s.jsx(ke,{label:t("year"),value:d,onChange:Y=>f(parseInt(Y.target.value)),children:I.map(Y=>s.jsx("option",{value:Y,children:Y},Y))}),r==="individual_farmer"&&s.jsx(ke,{label:t("selectFarmer"),value:h,onChange:Y=>m(Y.target.value),children:j.map(Y=>s.jsxs("option",{value:Y.id,children:[Y.firstName," ",Y.lastName]},Y.id))}),s.jsx("div",{className:q||z?"":"xl:col-start-5",children:s.jsxs(se,{onClick:O,className:"w-full h-[42px]",children:[s.jsx(te,{name:"FileText",className:"w-5 h-5"}),t("generateReport")]})})]}),r==="custom"&&s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("h4",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:t("selectSections")}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Rt,{checked:x.includes("production"),onChange:()=>U("production")}),s.jsx("span",{className:"text-sm",children:t("section_production")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Rt,{checked:x.includes("finance"),onChange:()=>U("finance")}),s.jsx("span",{className:"text-sm",children:t("section_finance")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Rt,{checked:x.includes("inventory"),onChange:()=>U("inventory")}),s.jsx("span",{className:"text-sm",children:t("section_inventory")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Rt,{checked:x.includes("hr"),onChange:()=>U("hr")}),s.jsx("span",{className:"text-sm",children:t("section_hr")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Rt,{checked:x.includes("incidents"),onChange:()=>U("incidents")}),s.jsx("span",{className:"text-sm",children:t("section_incidents")})]})]})]})]})}),N&&s.jsx("div",{className:"fixed bottom-6 right-6 z-50 no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(se,{variant:"secondary",onClick:F,disabled:E,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:E?"Activity":"FileSpreadsheet",className:`w-5 h-5 ${E?"animate-spin":""}`}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t("exportExcel")})]}),s.jsxs(se,{variant:"secondary",onClick:P,disabled:C,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:C?"Activity":"Download",className:`w-5 h-5 ${C?"animate-spin":""}`}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t(C?"downloading":"downloadPdf")})]}),s.jsxs(se,{variant:"primary",onClick:A,className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t("print")})]})]})}),s.jsx("div",{id:"printable-area",className:"overflow-x-auto pb-8",children:J()})]})},jH=({isOpen:t,onClose:e,currentUser:n,onInviteSent:r})=>{const{t:i}=_e(),{roles:l,addInvitation:c,addRole:d}=qe(),[f,h]=S.useState({recipient:"",channel:"EMAIL",roleId:""}),[m,x]=S.useState({}),[g,N]=S.useState("role"),[T,C]=S.useState(new Set),[w,E]=S.useState(new Set);S.useEffect(()=>{var j,O;t&&(h({recipient:"",channel:"EMAIL",roleId:((j=l.find(A=>A.isDefault))==null?void 0:j.id)||((O=l[0])==null?void 0:O.id)||""}),C(new Set),N("role"),x({}))},[t,l]);const D=S.useCallback(()=>{const j={};return f.recipient.trim()?f.channel==="EMAIL"&&!/\S+@\S+\.\S+/.test(f.recipient)?j.recipient=i("validationEmail"):f.channel==="WHATSAPP"&&!/^\+?\d{7,15}$/.test(f.recipient)&&(j.recipient=i("validationPhone")):j.recipient=i("validationRequired"),g==="role"&&!f.roleId&&(j.roleId=i("validationRequired")),g==="custom"&&T.size===0&&(j.customPermissions=i("validationSelectAtLeastOne")),j},[f,i,g,T]);S.useEffect(()=>{x(D())},[f,g,T,D]);const I=()=>{if(Object.keys(m).length>0||!n)return;let j=f.roleId;if(g==="custom"){const P=i("customRoleFor").replace("{recipient}",f.recipient),U=d({name:P,permissions:Array.from(T)});if(U)j=U.id;else return}const O=c({recipient:f.recipient,channel:f.channel,roleId:j,invitedBy:n.id,status:pc.PENDING,expiresAt:new Date(Date.now()+10080*60*1e3).toISOString()}),F=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${O.token}`;r(F,f.channel),e()},k=j=>{E(O=>{const A=new Set(O);return A.has(j)?A.delete(j):A.add(j),A})},M=Object.keys(m).length>0;return s.jsx(ot,{isOpen:t,onClose:e,title:i("inviteUser"),widthClass:"max-w-3xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(se,{onClick:I,disabled:M,children:i("sendInvitation")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("inviteMode")}),s.jsxs("div",{className:"flex gap-4 p-1 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[s.jsx(se,{variant:g==="role"?"primary":"ghost",onClick:()=>N("role"),className:"flex-1",children:i("selectRoleMode")}),s.jsx(se,{variant:g==="custom"?"primary":"ghost",onClick:()=>N("custom"),className:"flex-1",children:i("customPermissionsMode")})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(ke,{label:i("channel"),value:f.channel,onChange:j=>h(O=>({...O,channel:j.target.value,recipient:""})),children:[s.jsx("option",{value:"EMAIL",children:"Email"}),s.jsx("option",{value:"WHATSAPP",children:"WhatsApp"})]}),s.jsx(de,{label:f.channel==="EMAIL"?i("email"):i("phoneNumber"),type:f.channel==="EMAIL"?"email":"tel",value:f.recipient,onChange:j=>h(O=>({...O,recipient:j.target.value})),error:m.recipient,placeholder:f.channel==="WHATSAPP"?"+261...":"name@example.com",required:!0})]}),g==="role"&&s.jsxs(ke,{label:i("role"),value:f.roleId,onChange:j=>h(O=>({...O,roleId:j.target.value})),error:m.roleId,required:!0,children:[s.jsx("option",{value:"",children:i("selectRole")}),l.map(j=>s.jsx("option",{value:j.id,children:j.name},j.id))]}),g==="custom"&&s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto border p-2 rounded-lg dark:border-gray-600",children:[iw.map(j=>s.jsxs("div",{children:[s.jsxs("div",{onClick:()=>k(j.name),className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer",children:[s.jsx("h4",{className:"font-semibold text-sm",children:j.name}),s.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${w.has(j.name)?"rotate-180":""}`})]}),w.has(j.name)&&s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 p-2",children:j.permissions.map(O=>s.jsxs("label",{className:"flex items-center p-1 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded cursor-pointer",children:[s.jsx(Rt,{checked:T.has(O.id),onChange:A=>{C(F=>{const P=new Set(F);return A.target.checked?P.add(O.id):P.delete(O.id),P})}}),s.jsx("span",{className:"ml-2 text-sm",children:O.label})]},O.id))})]},j.name)),m.customPermissions&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:m.customPermissions})]})]})})},AH=()=>{const{t,language:e}=_e(),{users:n,roles:r,invitations:i,deleteInvitation:l}=qe(),{currentUser:c}=Zs(),[d,f]=S.useState(!1),[h,m]=S.useState("users"),[x,g]=S.useState(null),[N,T]=S.useState(null),C=S.useMemo(()=>new Map(r.map(k=>[k.id,k.name])),[r]),w=k=>{l(k),g(null)},E=k=>{const j=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${k.token}`;if(k.channel==="WHATSAPP"){const O=t("resendWhatsAppMessage").replace("{link}",j),A=`https://wa.me/${k.recipient.replace(/\+/g,"")}?text=${encodeURIComponent(O)}`;T({link:A,channel:"WHATSAPP"})}else T({link:j,channel:"EMAIL"})},D=i.filter(k=>k.status===pc.PENDING&&new Date(k.expiresAt)>new Date),I=S.useMemo(()=>new Map(n.map(k=>[k.id,`${k.firstName} ${k.lastName}`])),[n]);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("userManagement")}),s.jsx(lh,{permission:Ce.USERS_INVITE,children:s.jsxs(se,{onClick:()=>f(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("inviteUser")]})})]}),s.jsxs(ze,{children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[s.jsx("button",{onClick:()=>m("users"),className:`${h==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:t("currentUsers")}),s.jsxs("button",{onClick:()=>m("invitations"),className:`${h==="invitations"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[t("pendingInvitations")," (",D.length,")"]})]})}),h==="users"&&s.jsx("div",{className:"overflow-x-auto mt-4",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3",children:t("name")}),s.jsx("th",{className:"p-3",children:t("email")}),s.jsx("th",{className:"p-3",children:t("role")})]})}),s.jsx("tbody",{children:n.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsxs("td",{className:"p-3",children:[k.firstName," ",k.lastName]}),s.jsx("td",{className:"p-3",children:k.email}),s.jsx("td",{className:"p-3",children:C.get(k.roleId)||k.roleId})]},k.id))})]})}),h==="invitations"&&s.jsx("div",{className:"overflow-x-auto mt-4",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3",children:t("recipient")}),s.jsx("th",{className:"p-3",children:t("channel")}),s.jsx("th",{className:"p-3",children:t("role")}),s.jsx("th",{className:"p-3",children:t("expiresAt")}),s.jsx("th",{className:"p-3",children:t("invitedBy")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[D.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:k.recipient}),s.jsx("td",{className:"p-3",children:k.channel}),s.jsx("td",{className:"p-3",children:C.get(k.roleId)||k.roleId}),s.jsx("td",{className:"p-3",children:new Date(k.expiresAt).toLocaleDateString(e)}),s.jsx("td",{className:"p-3",children:I.get(k.invitedBy)||"N/A"}),s.jsx("td",{className:"p-3 text-right",children:s.jsx(lh,{permission:Ce.USERS_INVITE,children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(se,{variant:"secondary",onClick:()=>E(k),children:t("resend")}),s.jsx(se,{variant:"danger",onClick:()=>g(k.id),children:t("revoke")})]})})})]},k.id)),D.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"text-center p-8 text-gray-500",children:t("noPendingInvitations")})})]})]})})]}),s.jsx(jH,{isOpen:d,onClose:()=>f(!1),currentUser:c,onInviteSent:(k,M)=>T({link:k,channel:M})}),x&&s.jsx(Qt,{isOpen:!!x,onClose:()=>g(null),onConfirm:()=>w(x),title:t("revokeInvitation"),message:t("confirmRevokeInvitation"),confirmText:t("revoke")}),N&&s.jsxs(ot,{isOpen:!!N,onClose:()=>T(null),title:t("invitationSent"),children:[s.jsx("p",{children:N.channel==="EMAIL"?t("invitationLinkMessage"):t("invitationWhatsAppMessage")}),N.channel==="EMAIL"?s.jsx(de,{value:N.link,readOnly:!0,className:"mt-2"}):s.jsx("a",{href:N.link,target:"_blank",rel:"noopener noreferrer",children:s.jsx(se,{className:"mt-2 w-full",children:t("openWhatsApp")})})]})]})},kH=()=>{const{t}=_e(),{currentUser:e,updateProfile:n}=Zs(),[r,i]=S.useState({firstName:"",lastName:"",email:"",phone:""}),[l,c]=S.useState(!1),[d,f]=S.useState(null);S.useEffect(()=>{e&&i({firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||""})},[e]);const h=x=>{i(g=>({...g,[x.target.name]:x.target.value}))},m=x=>{if(x.preventDefault(),!r.firstName||!r.lastName||!r.email){f({type:"error",text:t("validationRequired")});return}try{n({firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone}),f({type:"success",text:t("profileUpdatedSuccess")}),c(!1),setTimeout(()=>f(null),3e3)}catch{f({type:"error",text:"Failed to update profile"})}};return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("userProfileTitle")}),!l&&s.jsxs(se,{onClick:()=>c(!0),variant:"secondary",children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("editProfile")]})]}),s.jsxs(ze,{children:[s.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"w-20 h-20 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl font-bold shadow-md",children:[r.firstName.charAt(0),r.lastName.charAt(0)]}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold",children:[e==null?void 0:e.firstName," ",e==null?void 0:e.lastName]}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm uppercase",children:((e==null?void 0:e.roleId)||"").replace(/_/g," ")})]})]}),d&&s.jsx("div",{className:`p-3 mb-4 rounded-md text-sm text-center ${d.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.text}),s.jsxs("form",{onSubmit:m,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:t("firstName"),name:"firstName",value:r.firstName,onChange:h,disabled:!l,required:!0}),s.jsx(de,{label:t("lastName"),name:"lastName",value:r.lastName,onChange:h,disabled:!l,required:!0})]}),s.jsx(de,{label:t("email"),name:"email",type:"email",value:r.email,onChange:h,disabled:!l,required:!0}),s.jsx(de,{label:t("phoneNumber"),name:"phone",type:"tel",value:r.phone,onChange:h,disabled:!l,placeholder:"+123456789"}),l&&s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:()=>{c(!1),f(null)},children:t("cancel")}),s.jsx(se,{type:"submit",children:t("saveChanges")})]})]})]})]})},DH=()=>{const{t,language:e}=_e(),n=Qs();S.useEffect(()=>{window.scrollTo(0,0)},[]);const r=t("appName"),i="LANXIS S.a.r.l";return s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans",children:[s.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-20 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-sm",children:r.charAt(0)}),s.jsx("span",{className:"font-bold text-lg hidden sm:block",children:r})]}),s.jsxs(se,{variant:"secondary",onClick:()=>n(-1),children:[s.jsx(te,{name:"X",className:"w-5 h-5 mr-2"}),t("close")]})]})}),s.jsx("main",{className:"max-w-5xl mx-auto px-4 py-8 md:py-12",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 md:p-12 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-8 mb-8",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-white",children:e==="fr"?"Conditions Gnrales d'Utilisation":"Terms of Use"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e==="fr"?`diteur du service : ${i}`:`Service Provider: ${i}`}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:e==="fr"?`Dernire mise  jour : ${new Date().toLocaleDateString("fr-FR")}`:`Last Updated: ${new Date().toLocaleDateString("en-US")}`})]}),s.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm md:text-base leading-relaxed text-justify space-y-8",children:e==="fr"?s.jsxs(s.Fragment,{children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptation des Conditions"}),s.jsxs("p",{children:["Bienvenue sur ",s.jsx("strong",{children:r}),", un logiciel dit et fourni par ",s.jsx("strong",{children:i}),". En accdant  ce logiciel, en crant un compte ou en utilisant toute partie du Service pour la gestion de vos activits agricoles, vous acceptez d'tre li par les prsentes Conditions Gnrales d'Utilisation (CGU)."]}),s.jsxs("p",{className:"mt-2",children:["Si vous n'acceptez pas ces termes, vous ne devez pas accder  l'Application ni l'utiliser. Ces conditions rgissent la relation contractuelle entre vous (l'Utilisateur ou l'Entit Agricole) et ",i,"."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description du Service"}),s.jsxs("p",{children:[i," met  disposition ",r,", un systme logiciel de gestion (ERP) conu pour l'aquaculture et la culture d'algues. Le Service fournit des outils numriques pour la gestion des sites de production, le suivi des cycles de culture, la gestion des stocks, le suivi des ressources humaines et la gestion financire."]}),s.jsxs("p",{className:"mt-2",children:[`L'Application est fournie "telle quelle". `,i," se rserve le droit de modifier, suspendre ou interrompre tout aspect du Service (mises  jour, nouvelles fonctionnalits)  tout moment pour amliorer l'exprience utilisateur ou pour des raisons techniques."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Comptes et Scurit"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Identifiants :"})," Vous tes responsable de la confidentialit de vos identifiants de connexion. Toute action effectue via votre compte est rpute avoir t effectue par vous ou votre organisation."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Exactitude :"})," Vous vous engagez  fournir des informations exactes concernant votre entit agricole (nom, identifiants fiscaux) dans les paramtres de l'Application."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Scurit :"})," Vous devez informer ",i," immdiatement de toute violation de scurit ou utilisation non autorise de votre compte."]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. Licence d'Utilisation et Proprit Intellectuelle"}),s.jsxs("p",{children:[i," vous accorde une licence limite, non exclusive, non transfrable et rvocable pour utiliser ",r," uniquement pour vos besoins internes de gestion agricole."]}),s.jsxs("p",{className:"mt-2",children:["Tous les droits de proprit intellectuelle relatifs au logiciel, y compris le code source, les bases de donnes, les algorithmes et l'interface utilisateur, demeurent la proprit exclusive de ",s.jsx("strong",{children:i}),"."]}),s.jsx("p",{className:"mt-2",children:"Vous ne pouvez pas :"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[s.jsxs("li",{children:["Revendre, sous-licencier ou distribuer l'Application  des tiers sans accord crit de ",i,"."]}),s.jsx("li",{children:"Copier, modifier ou crer des uvres drives bases sur le logiciel."}),s.jsx("li",{children:"Tenter de dcompiler ou d'extraire le code source de l'Application."})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Proprit des Donnes"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Vos Donnes :"})," Vous conservez tous les droits, titres et intrts sur les donnes que vous saisissez dans ",r," (donnes de rcolte, informations sur vos fermiers, donnes financires, etc.)."]}),s.jsxs("p",{className:"mt-2",children:[s.jsx("strong",{children:"Usage :"})," En utilisant le Service, vous accordez  ",i," le droit d'hberger, de traiter et d'afficher vos donnes uniquement dans le but de vous fournir le Service (par exemple, pour gnrer vos rapports ou vos tableaux de bord). ",i," s'engage  ne pas vendre vos donnes agricoles  des tiers."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation de Responsabilit"}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[s.jsx("p",{className:"font-semibold mb-2",children:"Avertissement sur les prdictions :"}),s.jsxs("p",{children:[r," inclut des outils d'analyse et de prdiction (via IA ou algorithmes) concernant les rcoltes, la mto ou les risques biologiques. Ces informations sont fournies  titre indicatif uniquement pour aider  la prise de dcision.",i," ne garantit pas l'exactitude de ces prdictions et ne saurait tre tenu responsable des pertes de rcoltes, des pertes financires ou des dcisions agricoles prises sur la base de ces donnes."]})]}),s.jsxs("p",{className:"mt-4",children:["Dans toute la mesure permise par la loi, ",i," ne sera pas responsable des dommages indirects, incidents ou conscutifs rsultant de votre utilisation du Service."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Rsiliation"}),s.jsxs("p",{children:[i," peut suspendre ou rsilier votre accs au Service immdiatement, sans pravis ni responsabilit, en cas de violation des prsentes Conditions."]}),s.jsx("p",{className:"mt-2",children:"Vous pouvez cesser d'utiliser l'Application  tout moment. Sur demande, vos donnes peuvent tre supprimes de nos serveurs, sous rserve des obligations lgales de conservation."})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Droit Applicable"}),s.jsxs("p",{children:["Tout litige relatif  l'interprtation ou  l'excution des prsentes conditions sera soumis  la comptence exclusive des tribunaux du lieu du sige social de ",i,"."]})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptance of Terms"}),s.jsxs("p",{children:["Welcome to ",s.jsx("strong",{children:r}),", a software provided and published by ",s.jsx("strong",{children:i}),". By accessing this software, creating an account, or using any part of the Service for managing your agricultural activities, you agree to be bound by these Terms of Use."]}),s.jsxs("p",{className:"mt-2",children:["If you do not agree to these terms, you must not access or use the Application. These terms govern the contractual relationship between you (the User or Agricultural Entity) and ",i,"."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description of Service"}),s.jsxs("p",{children:[i," provides ",r,", an ERP (Enterprise Resource Planning) management system designed for aquaculture and seaweed farming. The Service provides digital tools for production site management, cultivation cycle tracking, inventory management, human resources tracking, and financial management."]}),s.jsxs("p",{className:"mt-2",children:['The Application is provided "as is". ',i," reserves the right to modify, suspend, or discontinue any aspect of the Service (updates, new features) at any time to improve user experience or for technical reasons."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Accounts and Security"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Credentials:"})," You are responsible for the confidentiality of your login credentials. Any action performed via your account is deemed to have been performed by you or your organization."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Accuracy:"})," You agree to provide accurate information regarding your agricultural entity (name, tax IDs) within the Application settings."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Security:"})," You must notify ",i," immediately of any security breach or unauthorized use of your account."]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. License to Use and Intellectual Property"}),s.jsxs("p",{children:[i," grants you a limited, non-exclusive, non-transferable, and revocable license to use ",r," solely for your internal agricultural management needs."]}),s.jsxs("p",{className:"mt-2",children:["All intellectual property rights related to the software, including source code, databases, algorithms, and the user interface, remain the exclusive property of ",s.jsx("strong",{children:i}),"."]}),s.jsx("p",{className:"mt-2",children:"You may not:"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[s.jsxs("li",{children:["Resell, sublicense, or distribute the Application to third parties without written consent from ",i,"."]}),s.jsx("li",{children:"Copy, modify, or create derivative works based on the software."}),s.jsx("li",{children:"Attempt to decompile or extract the source code of the Application."})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Data Ownership"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Your Data:"})," You retain all rights, title, and interest in the data you enter into ",r," (harvest data, farmer information, financial records, etc.)."]}),s.jsxs("p",{className:"mt-2",children:[s.jsx("strong",{children:"Usage:"})," By using the Service, you grant ",i," the right to host, process, and display your data solely for the purpose of providing the Service to you (e.g., generating your reports or dashboards). ",i," commits not to sell your agricultural data to third parties."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation of Liability"}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[s.jsx("p",{className:"font-semibold mb-2",children:"Disclaimer regarding predictions:"}),s.jsxs("p",{children:[r," includes analysis and prediction tools (via AI or algorithms) regarding harvests, weather, or biological risks. This information is provided for indicative purposes only to assist in decision-making.",i," does not guarantee the accuracy of these predictions and shall not be held liable for crop losses, financial losses, or agricultural decisions made based on this data."]})]}),s.jsxs("p",{className:"mt-4",children:["To the fullest extent permitted by law, ",i," shall not be liable for any indirect, incidental, or consequential damages arising from your use of the Service."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Termination"}),s.jsxs("p",{children:[i," may suspend or terminate your access to the Service immediately, without prior notice or liability, in the event of a breach of these Terms."]}),s.jsx("p",{className:"mt-2",children:"You may stop using the Application at any time. Upon request, your data can be deleted from our servers, subject to legal retention obligations."})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Governing Law"}),s.jsxs("p",{children:["Any dispute relating to the interpretation or execution of these terms shall be subject to the exclusive jurisdiction of the courts where ",i," is registered."]})]})]})})]})})]})},RH=()=>s.jsx(ho,{children:s.jsx(xk,{children:s.jsx(wk,{children:s.jsx(iL,{children:s.jsx(aL,{children:s.jsx(lL,{children:s.jsx(MH,{})})})})})})}),MH=()=>s.jsx(ik,{children:s.jsxs(MA,{children:[s.jsx(nt,{path:"/login",element:s.jsx(gL,{})}),s.jsx(nt,{path:"/signup",element:s.jsx(vL,{})}),s.jsx(nt,{path:"/forgot-password",element:s.jsx(bL,{})}),s.jsx(nt,{path:"/reset-password",element:s.jsx(NL,{})}),s.jsx(nt,{path:"/terms",element:s.jsx(DH,{})}),s.jsxs(nt,{element:s.jsx(pL,{}),children:[s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.DASHBOARD_VIEW}),children:[s.jsx(nt,{path:"/",element:s.jsx(rc,{to:"/dashboard",replace:!0})}),s.jsx(nt,{path:"/dashboard",element:s.jsx(IL,{})})]}),s.jsx(nt,{element:s.jsx(Or,{}),children:s.jsx(nt,{path:"/profile",element:s.jsx(kH,{})})}),s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.SETTINGS_VIEW}),children:[s.jsx(nt,{path:"/settings",element:s.jsx(rc,{to:"/settings/general"})}),s.jsx(nt,{path:"/settings/general",element:s.jsx(jL,{})}),s.jsx(nt,{path:"/settings/users",element:s.jsx(AH,{})}),s.jsx(nt,{path:"/settings/roles",element:s.jsx(iH,{})}),s.jsx(nt,{path:"/settings/incident-types",element:s.jsx(Mz,{})}),s.jsx(nt,{path:"/settings/incident-severities",element:s.jsx(Oz,{})})]}),s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.OPERATIONS_VIEW}),children:[s.jsx(nt,{path:"/sites",element:s.jsx(ho,{children:s.jsx(RL,{})})}),s.jsx(nt,{path:"/sites/:siteId/cultivation",element:s.jsx(ho,{children:s.jsx(uH,{})})}),s.jsx(nt,{path:"/seaweed-types",element:s.jsx(ho,{children:s.jsx(zL,{})})}),s.jsx(nt,{path:"/seaweed-types/:typeId/cultivation",element:s.jsx(ho,{children:s.jsx(hH,{})})}),s.jsx(nt,{path:"/modules",element:s.jsx(ho,{children:s.jsx(qL,{})})}),s.jsx(nt,{path:"/operations/cutting",element:s.jsx(Tz,{})}),s.jsx(nt,{path:"/operations/map",element:s.jsx(sH,{})}),s.jsx(nt,{path:"/operations/calendar",element:s.jsx(yH,{})}),s.jsx(nt,{path:"/cultivation",element:s.jsx(GG,{})}),s.jsx(nt,{path:"/harvesting",element:s.jsx(zG,{})}),s.jsx(nt,{path:"/drying",element:s.jsx(HG,{})}),s.jsx(nt,{path:"/bagging",element:s.jsx(qG,{})})]}),s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.INVENTORY_VIEW}),children:[s.jsx(nt,{path:"/inventory/on-site-storage",element:s.jsx(QG,{})}),s.jsx(nt,{path:"/inventory/farmer-deliveries",element:s.jsx(wz,{})}),s.jsx(nt,{path:"/inventory/site-transfers",element:s.jsx(kz,{})}),s.jsx(nt,{path:"/inventory/pressed-warehouse",element:s.jsx(fz,{})}),s.jsx(nt,{path:"/exports",element:s.jsx(vz,{})})]}),s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.STAKEHOLDERS_VIEW}),children:[s.jsx(nt,{path:"/farmers",element:s.jsx(nz,{})}),s.jsx(nt,{path:"/employees",element:s.jsx(oz,{})}),s.jsx(nt,{path:"/providers",element:s.jsx(bz,{})}),s.jsx(nt,{path:"/farmer-credits",element:s.jsx(OL,{})}),s.jsx(nt,{path:"/document-payments",element:s.jsx(Zz,{})}),s.jsx(nt,{path:"/payroll-calculator",element:s.jsx(dH,{})})]}),s.jsxs(nt,{element:s.jsx(Or,{permission:Ce.MONITORING_VIEW}),children:[s.jsx(nt,{path:"/monitoring/incidents",element:s.jsx(Dz,{})}),s.jsx(nt,{path:"/monitoring/tests",element:s.jsx(tH,{})})]}),s.jsx(nt,{element:s.jsx(Or,{permission:Ce.REPORTS_VIEW}),children:s.jsx(nt,{path:"/reports",element:s.jsx(IH,{})})}),s.jsx(nt,{element:s.jsx(Or,{}),children:s.jsx(nt,{path:"/manual",element:s.jsx(mH,{})})})]}),s.jsx(nt,{path:"*",element:s.jsx(rc,{to:"/login",replace:!0})})]})}),_E=document.getElementById("root");if(!_E)throw new Error("Could not find root element to mount to");const PH=Pj.createRoot(_E);PH.render(s.jsx(gt.StrictMode,{children:s.jsx(RH,{})}));
